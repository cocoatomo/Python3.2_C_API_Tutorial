<html>
<head>
<title>Modules/zlib/gzio.c</title>
<meta name='robots' content='noindex,nofollow'>
<meta name='generator' content='GLOBAL-5.8.1'>
</head>
<body text='#191970' bgcolor='#f5f5dc' vlink='gray'>
<a name='TOP'><h2><a href='../mains.html'>root</a>/<a href='../files/3353.html'>Modules</a>/<a href='../files/3390.html'>zlib</a>/gzio.c</h2>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L93'>[^]</a><a href='#L1017'>[v]</a>[top]<a href='#BOTTOM'>[bottom]</a><a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
<hr>
<h2>DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href='#L93' title='Defined at 93.'>gz_open</a>
<li><a href='#L208' title='Defined at 208.'>gzopen</a>
<li><a href='#L219' title='Defined at 219.'>gzdopen</a>
<li><a href='#L234' title='Defined at 234.'>gzsetparams</a>
<li><a href='#L261' title='Defined at 261.'>get_byte</a>
<li><a href='#L288' title='Defined at 288.'>check_header</a>
<li><a href='#L355' title='Defined at 355.'>destroy</a>
<li><a href='#L394' title='Defined at 394.'>gzread</a>
<li><a href='#L503' title='Defined at 503.'>gzgetc</a>
<li><a href='#L515' title='Defined at 515.'>gzungetc</a>
<li><a href='#L540' title='Defined at 540.'>gzgets</a>
<li><a href='#L559' title='Defined at 559.'>gzwrite</a>
<li><a href='#L603' title='Defined at 603.'>gzprintf</a>
<li><a href='#L637' title='Defined at 637.'>gzprintf</a>
<li><a href='#L678' title='Defined at 678.'>gzputc</a>
<li><a href='#L693' title='Defined at 693.'>gzputs</a>
<li><a href='#L705' title='Defined at 705.'>do_flush</a>
<li><a href='#L746' title='Defined at 746.'>gzflush</a>
<li><a href='#L767' title='Defined at 767.'>gzseek</a>
<li><a href='#L857' title='Defined at 857.'>gzrewind</a>
<li><a href='#L881' title='Defined at 881.'>gztell</a>
<li><a href='#L891' title='Defined at 891.'>gzeof</a>
<li><a href='#L908' title='Defined at 908.'>gzdirect</a>
<li><a href='#L920' title='Defined at 920.'>putLong</a>
<li><a href='#L935' title='Defined at 935.'>getLong</a>
<li><a href='#L953' title='Defined at 953.'>gzclose</a>
<li><a href='#L987' title='Defined at 987.'>gzerror</a>
<li><a href='#L1017' title='Defined at 1017.'>gzclearerr</a>
</ol>
<hr>
<pre>
<a name='L1'><i><font color='green'>/* gzio.c -- IO on .gz files</font></i>
<a name='L2'><i><font color='green'> * Copyright (C) 1995-2005 Jean-loup Gailly.</font></i>
<a name='L3'><i><font color='green'> * For conditions of distribution and use, see copyright notice in zlib.h</font></i>
<a name='L4'><i><font color='green'> *</font></i>
<a name='L5'><i><font color='green'> * Compile this file with -DNO_GZCOMPRESS to avoid the compression code.</font></i>
<a name='L6'><i><font color='green'> */</font></i>
<a name='L7'>
<a name='L8'><i><font color='green'>/* @(#) $Id$ */</font></i>
<a name='L9'>
<a name='L10'><font color='darkred'>#include</font> &lt;stdio.h&gt;
<a name='L11'>
<a name='L12'><font color='darkred'>#include</font> "<a href='2773.html'>zutil.h</a>"
<a name='L13'>
<a name='L14'><font color='darkred'>#ifdef</font> NO_DEFLATE       <i><font color='green'>/* for compatibility with old definition */</font></i>
<a name='L15'><font color='darkred'>#  define</font> <a href='../R/2112.html' title='Multiple refered from 9 places.'>NO_GZCOMPRESS</a>
<a name='L16'><font color='darkred'>#endif</font>
<a name='L17'>
<a name='L18'><font color='darkred'>#ifndef</font> <a href='../D/2327.html' title='Multiple defined in 2 places.'>NO_DUMMY_DECL</a>
<a name='L19'><b>struct</b> <a href='../R/8457.html' title='Multiple refered from 7 places.'>internal_state</a> <font color='red'>{</font><b>int</b> dummy;<font color='red'>}</font>; <i><font color='green'>/* for buggy compilers */</font></i>
<a name='L20'><font color='darkred'>#endif</font>
<a name='L21'>
<a name='L22'><font color='darkred'>#ifndef</font> <a href='../D/5941.html' title='Multiple defined in 2 places.'>Z_BUFSIZE</a>
<a name='L23'><font color='darkred'>#  ifdef</font> <a href='../D/2045.html' title='Multiple defined in 2 places.'>MAXSEG_64K</a>
<a name='L24'><font color='darkred'>#    define</font> <a href='../R/5272.html' title='Multiple refered from 20 places.'>Z_BUFSIZE</a> 4096 <i><font color='green'>/* minimize memory usage for 16-bit DOS */</font></i>
<a name='L25'><font color='darkred'>#  else</font>
<a name='L26'><font color='darkred'>#    define</font> <a href='../R/5272.html' title='Multiple refered from 20 places.'>Z_BUFSIZE</a> 16384
<a name='L27'><font color='darkred'>#  endif</font>
<a name='L28'><font color='darkred'>#endif</font>
<a name='L29'><font color='darkred'>#ifndef</font> <a href='../S/2743.html#L30' title='Defined at 30 in Modules/zlib/gzio.c.'>Z_PRINTF_BUFSIZE</a>
<a name='L30'><font color='darkred'>#  define</font> <a href='../R/5292.html' title='Multiple refered from 3 places.'>Z_PRINTF_BUFSIZE</a> 4096
<a name='L31'><font color='darkred'>#endif</font>
<a name='L32'>
<a name='L33'><font color='darkred'>#ifdef</font> __MVS__
<a name='L34'><font color='darkred'>#  pragma</font> map (fdopen , "\174\174FDOPEN")
<a name='L35'>   FILE *<a href='../D/8463.html' title='Multiple defined in 4 places.'>fdopen</a>(<b>int</b>, <b>const</b> <b>char</b> *);
<a name='L36'><font color='darkred'>#endif</font>
<a name='L37'>
<a name='L38'><font color='darkred'>#ifndef</font> <a href='../D/4951.html' title='Multiple defined in 12 places.'>STDC</a>
<a name='L39'><b>extern</b> <a href='../D/12265.html' title='Multiple defined in 6 places.'>voidp</a>  malloc <a href='../D/2401.html' title='Multiple defined in 9 places.'>OF</a>((uInt size));
<a name='L40'><b>extern</b> <b>void</b>   free   <a href='../D/2401.html' title='Multiple defined in 9 places.'>OF</a>((voidpf ptr));
<a name='L41'><font color='darkred'>#endif</font>
<a name='L42'>
<a name='L43'><font color='darkred'>#define</font> <a href='../R/51.html' title='Multiple refered from 10 places.'>ALLOC</a>(size) malloc(size)
<a name='L44'><font color='darkred'>#define</font> <a href='../R/4568.html' title='Multiple refered from 6 places.'>TRYFREE</a>(p) <font color='red'>{</font><b>if</b> (p) free(p);<font color='red'>}</font>
<a name='L45'>
<a name='L46'><b>static</b> <b>int</b> <b>const</b> gz_magic[2] = <font color='red'>{</font>0x1f, 0x8b<font color='red'>}</font>; <i><font color='green'>/* gzip magic header */</font></i>
<a name='L47'>
<a name='L48'><i><font color='green'>/* gzip flag byte */</font></i>
<a name='L49'><font color='darkred'>#define</font> ASCII_FLAG   0x01 <i><font color='green'>/* bit 0 set: file probably ascii text */</font></i>
<a name='L50'><font color='darkred'>#define</font> <a href='../S/2743.html#L345' title='Refered from 345 in Modules/zlib/gzio.c.'>HEAD_CRC</a>     0x02 <i><font color='green'>/* bit 1 set: header CRC present */</font></i>
<a name='L51'><font color='darkred'>#define</font> <a href='../S/2743.html#L333' title='Refered from 333 in Modules/zlib/gzio.c.'>EXTRA_FIELD</a>  0x04 <i><font color='green'>/* bit 2 set: extra field present */</font></i>
<a name='L52'><font color='darkred'>#define</font> <a href='../S/2743.html#L339' title='Refered from 339 in Modules/zlib/gzio.c.'>ORIG_NAME</a>    0x08 <i><font color='green'>/* bit 3 set: original file name present */</font></i>
<a name='L53'><font color='darkred'>#define</font> <a href='../R/545.html' title='Multiple refered from 3 places.'>COMMENT</a>      0x10 <i><font color='green'>/* bit 4 set: file comment present */</font></i>
<a name='L54'><font color='darkred'>#define</font> <a href='../S/2743.html#L325' title='Refered from 325 in Modules/zlib/gzio.c.'>RESERVED</a>     0xE0 <i><font color='green'>/* bits 5..7: reserved */</font></i>
<a name='L55'>
<a name='L56'><b>typedef</b> <b>struct</b> <a href='../R/8211.html' title='Multiple refered from 17 places.'>gz_stream</a> <font color='red'>{</font>
<a name='L57'>    <a href='../S/2769.html#L104' title='Defined at 104 in Modules/zlib/zlib.h.'>z_stream</a> stream;
<a name='L58'>    <b>int</b>      z_err;   <i><font color='green'>/* error code for last stream operation */</font></i>
<a name='L59'>    <b>int</b>      z_eof;   <i><font color='green'>/* set if end of input file */</font></i>
<a name='L60'>    FILE     *file;   <i><font color='green'>/* .gz file */</font></i>
<a name='L61'>    <a href='../D/458.html' title='Multiple defined in 4 places.'>Byte</a>     *inbuf;  <i><font color='green'>/* input buffer */</font></i>
<a name='L62'>    <a href='../D/458.html' title='Multiple defined in 4 places.'>Byte</a>     *outbuf; <i><font color='green'>/* output buffer */</font></i>
<a name='L63'>    <a href='../D/11920.html' title='Multiple defined in 4 places.'>uLong</a>    crc;     <i><font color='green'>/* crc32 of uncompressed data */</font></i>
<a name='L64'>    <b>char</b>     *msg;    <i><font color='green'>/* error message */</font></i>
<a name='L65'>    <b>char</b>     *path;   <i><font color='green'>/* path name for debugging only */</font></i>
<a name='L66'>    <b>int</b>      transparent; <i><font color='green'>/* 1 if input file is not a .gz file */</font></i>
<a name='L67'>    <b>char</b>     mode;    <i><font color='green'>/* 'w' or 'r' */</font></i>
<a name='L68'>    <a href='../D/12437.html' title='Multiple defined in 4 places.'>z_off_t</a>  start;   <i><font color='green'>/* start of compressed data in file (header skipped) */</font></i>
<a name='L69'>    <a href='../D/12437.html' title='Multiple defined in 4 places.'>z_off_t</a>  in;      <i><font color='green'>/* bytes into deflate or inflate */</font></i>
<a name='L70'>    <a href='../D/12437.html' title='Multiple defined in 4 places.'>z_off_t</a>  out;     <i><font color='green'>/* bytes out of deflate or inflate */</font></i>
<a name='L71'>    <b>int</b>      back;    <i><font color='green'>/* one character push-back */</font></i>
<a name='L72'>    <b>int</b>      last;    <i><font color='green'>/* true if push-back is last character */</font></i>
<a name='L73'><font color='red'>}</font> <a href='../R/8211.html' title='Multiple refered from 17 places.'>gz_stream</a>;
<a name='L74'>
<a name='L75'>
<a name='L76'><a href='../D/9558.html' title='Multiple defined in 6 places.'>local</a> <a href='../D/8993.html' title='Multiple defined in 2 places.'>gzFile</a> <a href='../D/9009.html' title='Multiple defined in 2 places.'>gz_open</a>      <a href='../D/2401.html' title='Multiple defined in 9 places.'>OF</a>((<b>const</b> <b>char</b> *path, <b>const</b> <b>char</b> *mode, <b>int</b>  fd));
<a name='L77'><a href='../D/9558.html' title='Multiple defined in 6 places.'>local</a> <b>int</b> <a href='../S/2743.html#L705' title='Defined at 705 in Modules/zlib/gzio.c.'>do_flush</a>        <a href='../D/2401.html' title='Multiple defined in 9 places.'>OF</a>((gzFile file, <b>int</b> flush));
<a name='L78'><a href='../D/9558.html' title='Multiple defined in 6 places.'>local</a> <b>int</b>    <a href='../S/2743.html#L261' title='Defined at 261 in Modules/zlib/gzio.c.'>get_byte</a>     <a href='../D/2401.html' title='Multiple defined in 9 places.'>OF</a>((gz_stream *s));
<a name='L79'><a href='../D/9558.html' title='Multiple defined in 6 places.'>local</a> <b>void</b>   <a href='../S/2743.html#L288' title='Defined at 288 in Modules/zlib/gzio.c.'>check_header</a> <a href='../D/2401.html' title='Multiple defined in 9 places.'>OF</a>((gz_stream *s));
<a name='L80'><a href='../D/9558.html' title='Multiple defined in 6 places.'>local</a> <b>int</b>    <a href='../S/2743.html#L355' title='Defined at 355 in Modules/zlib/gzio.c.'>destroy</a>      <a href='../D/2401.html' title='Multiple defined in 9 places.'>OF</a>((gz_stream *s));
<a name='L81'><a href='../D/9558.html' title='Multiple defined in 6 places.'>local</a> <b>void</b>   <a href='../S/2743.html#L920' title='Defined at 920 in Modules/zlib/gzio.c.'>putLong</a>      <a href='../D/2401.html' title='Multiple defined in 9 places.'>OF</a>((FILE *file, uLong x));
<a name='L82'><a href='../D/9558.html' title='Multiple defined in 6 places.'>local</a> <a href='../D/11920.html' title='Multiple defined in 4 places.'>uLong</a>  <a href='../S/2743.html#L935' title='Defined at 935 in Modules/zlib/gzio.c.'>getLong</a>      <a href='../D/2401.html' title='Multiple defined in 9 places.'>OF</a>((gz_stream *s));
<a name='L83'>
<a name='L84'><i><font color='green'>/* ===========================================================================</font></i>
<a name='L85'><i><font color='green'>     Opens a gzip (.gz) file for reading or writing. The mode parameter</font></i>
<a name='L86'><i><font color='green'>   is as in fopen ("rb" or "wb"). The file is given either by file descriptor</font></i>
<a name='L87'><i><font color='green'>   or path name (if fd == -1).</font></i>
<a name='L88'><i><font color='green'>     gz_open returns NULL if the file could not be opened or if there was</font></i>
<a name='L89'><i><font color='green'>   insufficient memory to allocate the (de)compression state; errno</font></i>
<a name='L90'><i><font color='green'>   can be checked to distinguish the two cases (if errno is zero, the</font></i>
<a name='L91'><i><font color='green'>   zlib error is Z_MEM_ERROR).</font></i>
<a name='L92'><i><font color='green'>*/</font></i>
<a name='L93'><a href='../D/9558.html' title='Multiple defined in 6 places.'>local</a> <a href='../D/8993.html' title='Multiple defined in 2 places.'>gzFile</a> <a href='../R/8206.html' title='Multiple refered from 7 places.'>gz_open</a> (path, mode, fd)
<a name='L94'>    <b>const</b> <b>char</b> *path;
<a name='L95'>    <b>const</b> <b>char</b> *mode;
<a name='L96'>    <b>int</b>  fd;
<a name='L97'><font color='red'>{</font>
<a name='L98'>    <b>int</b> err;
<a name='L99'>    <b>int</b> level = <a href='../S/2769.html#L189' title='Defined at 189 in Modules/zlib/zlib.h.'>Z_DEFAULT_COMPRESSION</a>; <i><font color='green'>/* compression level */</font></i>
<a name='L100'>    <b>int</b> strategy = <a href='../S/2769.html#L196' title='Defined at 196 in Modules/zlib/zlib.h.'>Z_DEFAULT_STRATEGY</a>; <i><font color='green'>/* compression strategy */</font></i>
<a name='L101'>    <b>char</b> *p = (<b>char</b>*)mode;
<a name='L102'>    <a href='../D/9014.html' title='Multiple defined in 2 places.'>gz_stream</a> *s;
<a name='L103'>    <b>char</b> fmode[80]; <i><font color='green'>/* copy of mode, without the compression level */</font></i>
<a name='L104'>    <b>char</b> *m = fmode;
<a name='L105'>
<a name='L106'>    <b>if</b> (!path || !mode) <b>return</b> <a href='../S/2769.html#L208' title='Defined at 208 in Modules/zlib/zlib.h.'>Z_NULL</a>;
<a name='L107'>
<a name='L108'>    s = (<a href='../D/9014.html' title='Multiple defined in 2 places.'>gz_stream</a> *)<a href='../D/61.html' title='Multiple defined in 3 places.'>ALLOC</a>(<b>sizeof</b>(<a href='../D/9014.html' title='Multiple defined in 2 places.'>gz_stream</a>));
<a name='L109'>    <b>if</b> (!s) <b>return</b> <a href='../S/2769.html#L208' title='Defined at 208 in Modules/zlib/zlib.h.'>Z_NULL</a>;
<a name='L110'>
<a name='L111'>    s-&gt;stream.zalloc = (<a href='../D/6713.html' title='Multiple defined in 2 places.'>alloc_func</a>)0;
<a name='L112'>    s-&gt;stream.zfree = (<a href='../D/8725.html' title='Multiple defined in 2 places.'>free_func</a>)0;
<a name='L113'>    s-&gt;stream.opaque = (<a href='../D/12267.html' title='Multiple defined in 6 places.'>voidpf</a>)0;
<a name='L114'>    s-&gt;stream.next_in = s-&gt;inbuf = <a href='../S/2769.html#L208' title='Defined at 208 in Modules/zlib/zlib.h.'>Z_NULL</a>;
<a name='L115'>    s-&gt;stream.next_out = s-&gt;outbuf = <a href='../S/2769.html#L208' title='Defined at 208 in Modules/zlib/zlib.h.'>Z_NULL</a>;
<a name='L116'>    s-&gt;stream.avail_in = s-&gt;stream.avail_out = 0;
<a name='L117'>    s-&gt;file = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L118'>    s-&gt;z_err = <a href='../S/2769.html#L173' title='Defined at 173 in Modules/zlib/zlib.h.'>Z_OK</a>;
<a name='L119'>    s-&gt;z_eof = 0;
<a name='L120'>    s-&gt;in = 0;
<a name='L121'>    s-&gt;out = 0;
<a name='L122'>    s-&gt;back = EOF;
<a name='L123'>    s-&gt;crc = <a href='../D/7813.html' title='Multiple defined in 3 places.'>crc32</a>(0L, <a href='../S/2769.html#L208' title='Defined at 208 in Modules/zlib/zlib.h.'>Z_NULL</a>, 0);
<a name='L124'>    s-&gt;msg = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L125'>    s-&gt;transparent = 0;
<a name='L126'>
<a name='L127'>    s-&gt;path = (<b>char</b>*)<a href='../D/61.html' title='Multiple defined in 3 places.'>ALLOC</a>(strlen(path)+1);
<a name='L128'>    <b>if</b> (s-&gt;path == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L129'>        <b>return</b> <a href='../S/2743.html#L355' title='Defined at 355 in Modules/zlib/gzio.c.'>destroy</a>(s), (<a href='../D/8993.html' title='Multiple defined in 2 places.'>gzFile</a>)<a href='../S/2769.html#L208' title='Defined at 208 in Modules/zlib/zlib.h.'>Z_NULL</a>;
<a name='L130'>    <font color='red'>}</font>
<a name='L131'>    strcpy(s-&gt;path, path); <i><font color='green'>/* do this early for debugging */</font></i>
<a name='L132'>
<a name='L133'>    s-&gt;mode = '\0';
<a name='L134'>    <b>do</b> <font color='red'>{</font>
<a name='L135'>        <b>if</b> (*p == 'r') s-&gt;mode = 'r';
<a name='L136'>        <b>if</b> (*p == 'w' || *p == 'a') s-&gt;mode = 'w';
<a name='L137'>        <b>if</b> (*p &gt;= '0' &amp;&amp; *p &lt;= '9') <font color='red'>{</font>
<a name='L138'>            level = *p - '0';
<a name='L139'>        <font color='red'>}</font> <b>else</b> <b>if</b> (*p == 'f') <font color='red'>{</font>
<a name='L140'>          strategy = <a href='../S/2769.html#L192' title='Defined at 192 in Modules/zlib/zlib.h.'>Z_FILTERED</a>;
<a name='L141'>        <font color='red'>}</font> <b>else</b> <b>if</b> (*p == 'h') <font color='red'>{</font>
<a name='L142'>          strategy = <a href='../S/2769.html#L193' title='Defined at 193 in Modules/zlib/zlib.h.'>Z_HUFFMAN_ONLY</a>;
<a name='L143'>        <font color='red'>}</font> <b>else</b> <b>if</b> (*p == 'R') <font color='red'>{</font>
<a name='L144'>          strategy = <a href='../S/2769.html#L194' title='Defined at 194 in Modules/zlib/zlib.h.'>Z_RLE</a>;
<a name='L145'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L146'>            *m++ = *p; <i><font color='green'>/* copy the mode */</font></i>
<a name='L147'>        <font color='red'>}</font>
<a name='L148'>    <font color='red'>}</font> <b>while</b> (*p++ &amp;&amp; m != fmode + <b>sizeof</b>(fmode));
<a name='L149'>    <b>if</b> (s-&gt;mode == '\0') <b>return</b> <a href='../S/2743.html#L355' title='Defined at 355 in Modules/zlib/gzio.c.'>destroy</a>(s), (<a href='../D/8993.html' title='Multiple defined in 2 places.'>gzFile</a>)<a href='../S/2769.html#L208' title='Defined at 208 in Modules/zlib/zlib.h.'>Z_NULL</a>;
<a name='L150'>
<a name='L151'>    <b>if</b> (s-&gt;mode == 'w') <font color='red'>{</font>
<a name='L152'><font color='darkred'>#ifdef</font> <a href='../D/2330.html' title='Multiple defined in 2 places.'>NO_GZCOMPRESS</a>
<a name='L153'>        err = <a href='../S/2769.html#L177' title='Defined at 177 in Modules/zlib/zlib.h.'>Z_STREAM_ERROR</a>;
<a name='L154'><font color='darkred'>#else</font>
<a name='L155'>        err = <a href='../S/2769.html#L1550' title='Defined at 1550 in Modules/zlib/zlib.h.'>deflateInit2</a>(&amp;(s-&gt;stream), level,
<a name='L156'>                           <a href='../S/2769.html#L205' title='Defined at 205 in Modules/zlib/zlib.h.'>Z_DEFLATED</a>, -<a href='../D/2084.html' title='Multiple defined in 2 places.'>MAX_WBITS</a>, <a href='../D/768.html' title='Multiple defined in 4 places.'>DEF_MEM_LEVEL</a>, strategy);
<a name='L157'>        <i><font color='green'>/* windowBits is passed &lt; 0 to suppress zlib header */</font></i>
<a name='L158'>
<a name='L159'>        s-&gt;stream.next_out = s-&gt;outbuf = (<a href='../D/458.html' title='Multiple defined in 4 places.'>Byte</a>*)<a href='../D/61.html' title='Multiple defined in 3 places.'>ALLOC</a>(<a href='../D/5941.html' title='Multiple defined in 2 places.'>Z_BUFSIZE</a>);
<a name='L160'><font color='darkred'>#endif</font>
<a name='L161'>        <b>if</b> (err != <a href='../S/2769.html#L173' title='Defined at 173 in Modules/zlib/zlib.h.'>Z_OK</a> || s-&gt;outbuf == <a href='../S/2769.html#L208' title='Defined at 208 in Modules/zlib/zlib.h.'>Z_NULL</a>) <font color='red'>{</font>
<a name='L162'>            <b>return</b> <a href='../S/2743.html#L355' title='Defined at 355 in Modules/zlib/gzio.c.'>destroy</a>(s), (<a href='../D/8993.html' title='Multiple defined in 2 places.'>gzFile</a>)<a href='../S/2769.html#L208' title='Defined at 208 in Modules/zlib/zlib.h.'>Z_NULL</a>;
<a name='L163'>        <font color='red'>}</font>
<a name='L164'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L165'>        s-&gt;stream.next_in  = s-&gt;inbuf = (<a href='../D/458.html' title='Multiple defined in 4 places.'>Byte</a>*)<a href='../D/61.html' title='Multiple defined in 3 places.'>ALLOC</a>(<a href='../D/5941.html' title='Multiple defined in 2 places.'>Z_BUFSIZE</a>);
<a name='L166'>
<a name='L167'>        err = <a href='../S/2769.html#L1553' title='Defined at 1553 in Modules/zlib/zlib.h.'>inflateInit2</a>(&amp;(s-&gt;stream), -<a href='../D/2084.html' title='Multiple defined in 2 places.'>MAX_WBITS</a>);
<a name='L168'>        <i><font color='green'>/* windowBits is passed &lt; 0 to tell that there is no zlib header.</font></i>
<a name='L169'><i><font color='green'>         * Note that in this case inflate *requires* an extra "dummy" byte</font></i>
<a name='L170'><i><font color='green'>         * after the compressed stream in order to complete decompression and</font></i>
<a name='L171'><i><font color='green'>         * return Z_STREAM_END. Here the gzip CRC32 ensures that 4 bytes are</font></i>
<a name='L172'><i><font color='green'>         * present after the compressed stream.</font></i>
<a name='L173'><i><font color='green'>         */</font></i>
<a name='L174'>        <b>if</b> (err != <a href='../S/2769.html#L173' title='Defined at 173 in Modules/zlib/zlib.h.'>Z_OK</a> || s-&gt;inbuf == <a href='../S/2769.html#L208' title='Defined at 208 in Modules/zlib/zlib.h.'>Z_NULL</a>) <font color='red'>{</font>
<a name='L175'>            <b>return</b> <a href='../S/2743.html#L355' title='Defined at 355 in Modules/zlib/gzio.c.'>destroy</a>(s), (<a href='../D/8993.html' title='Multiple defined in 2 places.'>gzFile</a>)<a href='../S/2769.html#L208' title='Defined at 208 in Modules/zlib/zlib.h.'>Z_NULL</a>;
<a name='L176'>        <font color='red'>}</font>
<a name='L177'>    <font color='red'>}</font>
<a name='L178'>    s-&gt;stream.avail_out = <a href='../D/5941.html' title='Multiple defined in 2 places.'>Z_BUFSIZE</a>;
<a name='L179'>
<a name='L180'>    errno = 0;
<a name='L181'>    s-&gt;file = fd &lt; 0 ? <a href='../D/1332.html' title='Multiple defined in 2 places.'>F_OPEN</a>(path, fmode) : (FILE*)<a href='../D/8463.html' title='Multiple defined in 4 places.'>fdopen</a>(fd, fmode);
<a name='L182'>
<a name='L183'>    <b>if</b> (s-&gt;file == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L184'>        <b>return</b> <a href='../S/2743.html#L355' title='Defined at 355 in Modules/zlib/gzio.c.'>destroy</a>(s), (<a href='../D/8993.html' title='Multiple defined in 2 places.'>gzFile</a>)<a href='../S/2769.html#L208' title='Defined at 208 in Modules/zlib/zlib.h.'>Z_NULL</a>;
<a name='L185'>    <font color='red'>}</font>
<a name='L186'>    <b>if</b> (s-&gt;mode == 'w') <font color='red'>{</font>
<a name='L187'>        <i><font color='green'>/* Write a very simple .gz header:</font></i>
<a name='L188'><i><font color='green'>         */</font></i>
<a name='L189'>        fprintf(s-&gt;file, "%c%c%c%c%c%c%c%c%c%c", gz_magic[0], gz_magic[1],
<a name='L190'>             <a href='../S/2769.html#L205' title='Defined at 205 in Modules/zlib/zlib.h.'>Z_DEFLATED</a>, 0 <i><font color='green'>/*flags*/</font></i>, 0,0,0,0 <i><font color='green'>/*time*/</font></i>, 0 <i><font color='green'>/*xflags*/</font></i>, <a href='../D/2429.html' title='Multiple defined in 10 places.'>OS_CODE</a>);
<a name='L191'>        s-&gt;start = 10L;
<a name='L192'>        <i><font color='green'>/* We use 10L instead of ftell(s-&gt;file) to because ftell causes an</font></i>
<a name='L193'><i><font color='green'>         * fflush on some systems. This version of the library doesn't use</font></i>
<a name='L194'><i><font color='green'>         * start anyway in write mode, so this initialization is not</font></i>
<a name='L195'><i><font color='green'>         * necessary.</font></i>
<a name='L196'><i><font color='green'>         */</font></i>
<a name='L197'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L198'>        <a href='../S/2743.html#L288' title='Defined at 288 in Modules/zlib/gzio.c.'>check_header</a>(s); <i><font color='green'>/* skip the .gz header */</font></i>
<a name='L199'>        s-&gt;start = ftell(s-&gt;file) - s-&gt;stream.avail_in;
<a name='L200'>    <font color='red'>}</font>
<a name='L201'>
<a name='L202'>    <b>return</b> (<a href='../D/8993.html' title='Multiple defined in 2 places.'>gzFile</a>)s;
<a name='L203'><font color='red'>}</font>
<a name='L204'>
<a name='L205'><i><font color='green'>/* ===========================================================================</font></i>
<a name='L206'><i><font color='green'>     Opens a gzip (.gz) file for reading or writing.</font></i>
<a name='L207'><i><font color='green'>*/</font></i>
<a name='L208'><a href='../D/8993.html' title='Multiple defined in 2 places.'>gzFile</a> <a href='../D/5922.html' title='Multiple defined in 8 places.'>ZEXPORT</a> <a href='../R/8229.html' title='Multiple refered from 6 places.'>gzopen</a> (path, mode)
<a name='L209'>    <b>const</b> <b>char</b> *path;
<a name='L210'>    <b>const</b> <b>char</b> *mode;
<a name='L211'><font color='red'>{</font>
<a name='L212'>    <b>return</b> <a href='../D/9009.html' title='Multiple defined in 2 places.'>gz_open</a> (path, mode, -1);
<a name='L213'><font color='red'>}</font>
<a name='L214'>
<a name='L215'><i><font color='green'>/* ===========================================================================</font></i>
<a name='L216'><i><font color='green'>     Associate a gzFile with the file descriptor fd. fd is not dup'ed here</font></i>
<a name='L217'><i><font color='green'>   to mimic the behavio(u)r of fdopen.</font></i>
<a name='L218'><i><font color='green'>*/</font></i>
<a name='L219'><a href='../D/8993.html' title='Multiple defined in 2 places.'>gzFile</a> <a href='../D/5922.html' title='Multiple defined in 8 places.'>ZEXPORT</a> <a href='../R/8221.html' title='Multiple refered from 4 places.'>gzdopen</a> (fd, mode)
<a name='L220'>    <b>int</b> fd;
<a name='L221'>    <b>const</b> <b>char</b> *mode;
<a name='L222'><font color='red'>{</font>
<a name='L223'>    <b>char</b> name[46];      <i><font color='green'>/* allow for up to 128-bit integers */</font></i>
<a name='L224'>
<a name='L225'>    <b>if</b> (fd &lt; 0) <b>return</b> (<a href='../D/8993.html' title='Multiple defined in 2 places.'>gzFile</a>)<a href='../S/2769.html#L208' title='Defined at 208 in Modules/zlib/zlib.h.'>Z_NULL</a>;
<a name='L226'>    sprintf(name, "&lt;fd:%d&gt;", fd); <i><font color='green'>/* for debugging */</font></i>
<a name='L227'>
<a name='L228'>    <b>return</b> <a href='../D/9009.html' title='Multiple defined in 2 places.'>gz_open</a> (name, mode, fd);
<a name='L229'><font color='red'>}</font>
<a name='L230'>
<a name='L231'><i><font color='green'>/* ===========================================================================</font></i>
<a name='L232'><i><font color='green'> * Update the compression level and strategy</font></i>
<a name='L233'><i><font color='green'> */</font></i>
<a name='L234'><b>int</b> <a href='../D/5922.html' title='Multiple defined in 8 places.'>ZEXPORT</a> <a href='../S/2769.html#L1226' title='Refered from 1226 in Modules/zlib/zlib.h.'>gzsetparams</a> (file, level, strategy)
<a name='L235'>    gzFile file;
<a name='L236'>    <b>int</b> level;
<a name='L237'>    <b>int</b> strategy;
<a name='L238'><font color='red'>{</font>
<a name='L239'>    <a href='../D/9014.html' title='Multiple defined in 2 places.'>gz_stream</a> *s = (<a href='../D/9014.html' title='Multiple defined in 2 places.'>gz_stream</a>*)file;
<a name='L240'>
<a name='L241'>    <b>if</b> (s == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> || s-&gt;mode != 'w') <b>return</b> <a href='../S/2769.html#L177' title='Defined at 177 in Modules/zlib/zlib.h.'>Z_STREAM_ERROR</a>;
<a name='L242'>
<a name='L243'>    <i><font color='green'>/* Make room to allow flushing */</font></i>
<a name='L244'>    <b>if</b> (s-&gt;stream.avail_out == 0) <font color='red'>{</font>
<a name='L245'>
<a name='L246'>        s-&gt;stream.next_out = s-&gt;outbuf;
<a name='L247'>        <b>if</b> (fwrite(s-&gt;outbuf, 1, <a href='../D/5941.html' title='Multiple defined in 2 places.'>Z_BUFSIZE</a>, s-&gt;file) != <a href='../D/5941.html' title='Multiple defined in 2 places.'>Z_BUFSIZE</a>) <font color='red'>{</font>
<a name='L248'>            s-&gt;z_err = <a href='../S/2769.html#L176' title='Defined at 176 in Modules/zlib/zlib.h.'>Z_ERRNO</a>;
<a name='L249'>        <font color='red'>}</font>
<a name='L250'>        s-&gt;stream.avail_out = <a href='../D/5941.html' title='Multiple defined in 2 places.'>Z_BUFSIZE</a>;
<a name='L251'>    <font color='red'>}</font>
<a name='L252'>
<a name='L253'>    <b>return</b> <a href='../D/8012.html' title='Multiple defined in 3 places.'>deflateParams</a> (&amp;(s-&gt;stream), level, strategy);
<a name='L254'><font color='red'>}</font>
<a name='L255'>
<a name='L256'><i><font color='green'>/* ===========================================================================</font></i>
<a name='L257'><i><font color='green'>     Read a byte from a gz_stream; update next_in and avail_in. Return EOF</font></i>
<a name='L258'><i><font color='green'>   for end of file.</font></i>
<a name='L259'><i><font color='green'>   IN assertion: the stream s has been sucessfully opened for reading.</font></i>
<a name='L260'><i><font color='green'>*/</font></i>
<a name='L261'><a href='../D/9558.html' title='Multiple defined in 6 places.'>local</a> <b>int</b> <a href='../R/8029.html' title='Multiple refered from 14 places.'>get_byte</a>(s)
<a name='L262'>    gz_stream *s;
<a name='L263'><font color='red'>{</font>
<a name='L264'>    <b>if</b> (s-&gt;z_eof) <b>return</b> EOF;
<a name='L265'>    <b>if</b> (s-&gt;stream.avail_in == 0) <font color='red'>{</font>
<a name='L266'>        errno = 0;
<a name='L267'>        s-&gt;stream.avail_in = (<a href='../D/11918.html' title='Multiple defined in 4 places.'>uInt</a>)fread(s-&gt;inbuf, 1, <a href='../D/5941.html' title='Multiple defined in 2 places.'>Z_BUFSIZE</a>, s-&gt;file);
<a name='L268'>        <b>if</b> (s-&gt;stream.avail_in == 0) <font color='red'>{</font>
<a name='L269'>            s-&gt;z_eof = 1;
<a name='L270'>            <b>if</b> (ferror(s-&gt;file)) s-&gt;z_err = <a href='../S/2769.html#L176' title='Defined at 176 in Modules/zlib/zlib.h.'>Z_ERRNO</a>;
<a name='L271'>            <b>return</b> EOF;
<a name='L272'>        <font color='red'>}</font>
<a name='L273'>        s-&gt;stream.next_in = s-&gt;inbuf;
<a name='L274'>    <font color='red'>}</font>
<a name='L275'>    s-&gt;stream.avail_in--;
<a name='L276'>    <b>return</b> *(s-&gt;stream.next_in)++;
<a name='L277'><font color='red'>}</font>
<a name='L278'>
<a name='L279'><i><font color='green'>/* ===========================================================================</font></i>
<a name='L280'><i><font color='green'>      Check the gzip header of a gz_stream opened for reading. Set the stream</font></i>
<a name='L281'><i><font color='green'>    mode to transparent if the gzip magic header is not present; set s-&gt;err</font></i>
<a name='L282'><i><font color='green'>    to Z_DATA_ERROR if the magic header is present but the rest of the header</font></i>
<a name='L283'><i><font color='green'>    is incorrect.</font></i>
<a name='L284'><i><font color='green'>    IN assertion: the stream s has already been created sucessfully;</font></i>
<a name='L285'><i><font color='green'>       s-&gt;stream.avail_in is zero for the first time, but may be non-zero</font></i>
<a name='L286'><i><font color='green'>       for concatenated .gz files.</font></i>
<a name='L287'><i><font color='green'>*/</font></i>
<a name='L288'><a href='../D/9558.html' title='Multiple defined in 6 places.'>local</a> <b>void</b> <a href='../R/6631.html' title='Multiple refered from 3 places.'>check_header</a>(s)
<a name='L289'>    gz_stream *s;
<a name='L290'><font color='red'>{</font>
<a name='L291'>    <b>int</b> method; <i><font color='green'>/* method byte */</font></i>
<a name='L292'>    <b>int</b> <a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a>;  <i><font color='green'>/* flags byte */</font></i>
<a name='L293'>    <a href='../D/11918.html' title='Multiple defined in 4 places.'>uInt</a> len;
<a name='L294'>    <b>int</b> c;
<a name='L295'>
<a name='L296'>    <i><font color='green'>/* Assure two bytes in the buffer so we can peek ahead -- handle case</font></i>
<a name='L297'><i><font color='green'>       where first byte of header is at the end of the buffer after the last</font></i>
<a name='L298'><i><font color='green'>       gzip segment */</font></i>
<a name='L299'>    len = s-&gt;stream.avail_in;
<a name='L300'>    <b>if</b> (len &lt; 2) <font color='red'>{</font>
<a name='L301'>        <b>if</b> (len) s-&gt;inbuf[0] = s-&gt;stream.next_in[0];
<a name='L302'>        errno = 0;
<a name='L303'>        len = (<a href='../D/11918.html' title='Multiple defined in 4 places.'>uInt</a>)fread(s-&gt;inbuf + len, 1, <a href='../D/5941.html' title='Multiple defined in 2 places.'>Z_BUFSIZE</a> &gt;&gt; len, s-&gt;file);
<a name='L304'>        <b>if</b> (len == 0 &amp;&amp; ferror(s-&gt;file)) s-&gt;z_err = <a href='../S/2769.html#L176' title='Defined at 176 in Modules/zlib/zlib.h.'>Z_ERRNO</a>;
<a name='L305'>        s-&gt;stream.avail_in += len;
<a name='L306'>        s-&gt;stream.next_in = s-&gt;inbuf;
<a name='L307'>        <b>if</b> (s-&gt;stream.avail_in &lt; 2) <font color='red'>{</font>
<a name='L308'>            s-&gt;transparent = s-&gt;stream.avail_in;
<a name='L309'>            <b>return</b>;
<a name='L310'>        <font color='red'>}</font>
<a name='L311'>    <font color='red'>}</font>
<a name='L312'>
<a name='L313'>    <i><font color='green'>/* Peek ahead to check the gzip magic header */</font></i>
<a name='L314'>    <b>if</b> (s-&gt;stream.next_in[0] != gz_magic[0] ||
<a name='L315'>        s-&gt;stream.next_in[1] != gz_magic[1]) <font color='red'>{</font>
<a name='L316'>        s-&gt;transparent = 1;
<a name='L317'>        <b>return</b>;
<a name='L318'>    <font color='red'>}</font>
<a name='L319'>    s-&gt;stream.avail_in -= 2;
<a name='L320'>    s-&gt;stream.next_in += 2;
<a name='L321'>
<a name='L322'>    <i><font color='green'>/* Check the rest of the gzip header */</font></i>
<a name='L323'>    method = <a href='../S/2743.html#L261' title='Defined at 261 in Modules/zlib/gzio.c.'>get_byte</a>(s);
<a name='L324'>    <a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> = <a href='../S/2743.html#L261' title='Defined at 261 in Modules/zlib/gzio.c.'>get_byte</a>(s);
<a name='L325'>    <b>if</b> (method != <a href='../S/2769.html#L205' title='Defined at 205 in Modules/zlib/zlib.h.'>Z_DEFLATED</a> || (<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> &amp; <a href='../S/2743.html#L54' title='Defined at 54 in Modules/zlib/gzio.c.'>RESERVED</a>) != 0) <font color='red'>{</font>
<a name='L326'>        s-&gt;z_err = <a href='../S/2769.html#L178' title='Defined at 178 in Modules/zlib/zlib.h.'>Z_DATA_ERROR</a>;
<a name='L327'>        <b>return</b>;
<a name='L328'>    <font color='red'>}</font>
<a name='L329'>
<a name='L330'>    <i><font color='green'>/* Discard time, xflags and OS code: */</font></i>
<a name='L331'>    <b>for</b> (len = 0; len &lt; 6; len++) (<b>void</b>)<a href='../S/2743.html#L261' title='Defined at 261 in Modules/zlib/gzio.c.'>get_byte</a>(s);
<a name='L332'>
<a name='L333'>    <b>if</b> ((<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> &amp; <a href='../S/2743.html#L51' title='Defined at 51 in Modules/zlib/gzio.c.'>EXTRA_FIELD</a>) != 0) <font color='red'>{</font> <i><font color='green'>/* skip the extra field */</font></i>
<a name='L334'>        len  =  (<a href='../D/11918.html' title='Multiple defined in 4 places.'>uInt</a>)<a href='../S/2743.html#L261' title='Defined at 261 in Modules/zlib/gzio.c.'>get_byte</a>(s);
<a name='L335'>        len += ((<a href='../D/11918.html' title='Multiple defined in 4 places.'>uInt</a>)<a href='../S/2743.html#L261' title='Defined at 261 in Modules/zlib/gzio.c.'>get_byte</a>(s))&lt;&lt;8;
<a name='L336'>        <i><font color='green'>/* len is garbage if EOF but the loop below will quit anyway */</font></i>
<a name='L337'>        <b>while</b> (len-- != 0 &amp;&amp; <a href='../S/2743.html#L261' title='Defined at 261 in Modules/zlib/gzio.c.'>get_byte</a>(s) != EOF) ;
<a name='L338'>    <font color='red'>}</font>
<a name='L339'>    <b>if</b> ((<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> &amp; <a href='../S/2743.html#L52' title='Defined at 52 in Modules/zlib/gzio.c.'>ORIG_NAME</a>) != 0) <font color='red'>{</font> <i><font color='green'>/* skip the original file name */</font></i>
<a name='L340'>        <b>while</b> ((c = <a href='../S/2743.html#L261' title='Defined at 261 in Modules/zlib/gzio.c.'>get_byte</a>(s)) != 0 &amp;&amp; c != EOF) ;
<a name='L341'>    <font color='red'>}</font>
<a name='L342'>    <b>if</b> ((<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> &amp; <a href='../D/584.html' title='Multiple defined in 2 places.'>COMMENT</a>) != 0) <font color='red'>{</font>   <i><font color='green'>/* skip the .gz file comment */</font></i>
<a name='L343'>        <b>while</b> ((c = <a href='../S/2743.html#L261' title='Defined at 261 in Modules/zlib/gzio.c.'>get_byte</a>(s)) != 0 &amp;&amp; c != EOF) ;
<a name='L344'>    <font color='red'>}</font>
<a name='L345'>    <b>if</b> ((<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> &amp; <a href='../S/2743.html#L50' title='Defined at 50 in Modules/zlib/gzio.c.'>HEAD_CRC</a>) != 0) <font color='red'>{</font>  <i><font color='green'>/* skip the header crc */</font></i>
<a name='L346'>        <b>for</b> (len = 0; len &lt; 2; len++) (<b>void</b>)<a href='../S/2743.html#L261' title='Defined at 261 in Modules/zlib/gzio.c.'>get_byte</a>(s);
<a name='L347'>    <font color='red'>}</font>
<a name='L348'>    s-&gt;z_err = s-&gt;z_eof ? <a href='../S/2769.html#L178' title='Defined at 178 in Modules/zlib/zlib.h.'>Z_DATA_ERROR</a> : <a href='../S/2769.html#L173' title='Defined at 173 in Modules/zlib/zlib.h.'>Z_OK</a>;
<a name='L349'><font color='red'>}</font>
<a name='L350'>
<a name='L351'> <i><font color='green'>/* ===========================================================================</font></i>
<a name='L352'><i><font color='green'> * Cleanup then free the given gz_stream. Return a zlib error code.</font></i>
<a name='L353'><i><font color='green'>   Try freeing in the reverse order of allocations.</font></i>
<a name='L354'><i><font color='green'> */</font></i>
<a name='L355'><a href='../D/9558.html' title='Multiple defined in 6 places.'>local</a> <b>int</b> <a href='../R/7311.html' title='Multiple refered from 8 places.'>destroy</a> (s)
<a name='L356'>    gz_stream *s;
<a name='L357'><font color='red'>{</font>
<a name='L358'>    <b>int</b> err = <a href='../S/2769.html#L173' title='Defined at 173 in Modules/zlib/zlib.h.'>Z_OK</a>;
<a name='L359'>
<a name='L360'>    <b>if</b> (!s) <b>return</b> <a href='../S/2769.html#L177' title='Defined at 177 in Modules/zlib/zlib.h.'>Z_STREAM_ERROR</a>;
<a name='L361'>
<a name='L362'>    <a href='../S/2743.html#L44' title='Defined at 44 in Modules/zlib/gzio.c.'>TRYFREE</a>(s-&gt;msg);
<a name='L363'>
<a name='L364'>    <b>if</b> (s-&gt;stream.<a href='../S/530.html#L46' title='Defined at 46 in Include/grammar.h.'>state</a> != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L365'>        <b>if</b> (s-&gt;mode == 'w') <font color='red'>{</font>
<a name='L366'><font color='darkred'>#ifdef</font> <a href='../D/2330.html' title='Multiple defined in 2 places.'>NO_GZCOMPRESS</a>
<a name='L367'>            err = <a href='../S/2769.html#L177' title='Defined at 177 in Modules/zlib/zlib.h.'>Z_STREAM_ERROR</a>;
<a name='L368'><font color='darkred'>#else</font>
<a name='L369'>            err = <a href='../D/8007.html' title='Multiple defined in 3 places.'>deflateEnd</a>(&amp;(s-&gt;stream));
<a name='L370'><font color='darkred'>#endif</font>
<a name='L371'>        <font color='red'>}</font> <b>else</b> <b>if</b> (s-&gt;mode == 'r') <font color='red'>{</font>
<a name='L372'>            err = <a href='../D/9162.html' title='Multiple defined in 3 places.'>inflateEnd</a>(&amp;(s-&gt;stream));
<a name='L373'>        <font color='red'>}</font>
<a name='L374'>    <font color='red'>}</font>
<a name='L375'>    <b>if</b> (s-&gt;file != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; fclose(s-&gt;file)) <font color='red'>{</font>
<a name='L376'><font color='darkred'>#ifdef</font> ESPIPE
<a name='L377'>        <b>if</b> (errno != ESPIPE) <i><font color='green'>/* fclose is broken for pipes in HP/UX */</font></i>
<a name='L378'><font color='darkred'>#endif</font>
<a name='L379'>            err = <a href='../S/2769.html#L176' title='Defined at 176 in Modules/zlib/zlib.h.'>Z_ERRNO</a>;
<a name='L380'>    <font color='red'>}</font>
<a name='L381'>    <b>if</b> (s-&gt;z_err &lt; 0) err = s-&gt;z_err;
<a name='L382'>
<a name='L383'>    <a href='../S/2743.html#L44' title='Defined at 44 in Modules/zlib/gzio.c.'>TRYFREE</a>(s-&gt;inbuf);
<a name='L384'>    <a href='../S/2743.html#L44' title='Defined at 44 in Modules/zlib/gzio.c.'>TRYFREE</a>(s-&gt;outbuf);
<a name='L385'>    <a href='../S/2743.html#L44' title='Defined at 44 in Modules/zlib/gzio.c.'>TRYFREE</a>(s-&gt;path);
<a name='L386'>    <a href='../S/2743.html#L44' title='Defined at 44 in Modules/zlib/gzio.c.'>TRYFREE</a>(s);
<a name='L387'>    <b>return</b> err;
<a name='L388'><font color='red'>}</font>
<a name='L389'>
<a name='L390'><i><font color='green'>/* ===========================================================================</font></i>
<a name='L391'><i><font color='green'>     Reads the given number of uncompressed bytes from the compressed file.</font></i>
<a name='L392'><i><font color='green'>   gzread returns the number of bytes actually read (0 for end of file).</font></i>
<a name='L393'><i><font color='green'>*/</font></i>
<a name='L394'><b>int</b> <a href='../D/5922.html' title='Multiple defined in 8 places.'>ZEXPORT</a> <a href='../R/8234.html' title='Multiple refered from 7 places.'>gzread</a> (file, buf, len)
<a name='L395'>    gzFile file;
<a name='L396'>    voidp buf;
<a name='L397'>    <b>unsigned</b> len;
<a name='L398'><font color='red'>{</font>
<a name='L399'>    <a href='../D/9014.html' title='Multiple defined in 2 places.'>gz_stream</a> *s = (<a href='../D/9014.html' title='Multiple defined in 2 places.'>gz_stream</a>*)file;
<a name='L400'>    <a href='../D/459.html' title='Multiple defined in 6 places.'>Bytef</a> *start = (<a href='../D/459.html' title='Multiple defined in 6 places.'>Bytef</a>*)buf; <i><font color='green'>/* starting point for crc computation */</font></i>
<a name='L401'>    <a href='../D/458.html' title='Multiple defined in 4 places.'>Byte</a>  *next_out; <i><font color='green'>/* == stream.next_out but not forced far (for MSDOS) */</font></i>
<a name='L402'>
<a name='L403'>    <b>if</b> (s == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> || s-&gt;mode != 'r') <b>return</b> <a href='../S/2769.html#L177' title='Defined at 177 in Modules/zlib/zlib.h.'>Z_STREAM_ERROR</a>;
<a name='L404'>
<a name='L405'>    <b>if</b> (s-&gt;z_err == <a href='../S/2769.html#L178' title='Defined at 178 in Modules/zlib/zlib.h.'>Z_DATA_ERROR</a> || s-&gt;z_err == <a href='../S/2769.html#L176' title='Defined at 176 in Modules/zlib/zlib.h.'>Z_ERRNO</a>) <b>return</b> -1;
<a name='L406'>    <b>if</b> (s-&gt;z_err == <a href='../S/2769.html#L174' title='Defined at 174 in Modules/zlib/zlib.h.'>Z_STREAM_END</a>) <b>return</b> 0;  <i><font color='green'>/* EOF */</font></i>
<a name='L407'>
<a name='L408'>    next_out = (<a href='../D/458.html' title='Multiple defined in 4 places.'>Byte</a>*)buf;
<a name='L409'>    s-&gt;stream.next_out = (<a href='../D/459.html' title='Multiple defined in 6 places.'>Bytef</a>*)buf;
<a name='L410'>    s-&gt;stream.avail_out = len;
<a name='L411'>
<a name='L412'>    <b>if</b> (s-&gt;stream.avail_out &amp;&amp; s-&gt;back != EOF) <font color='red'>{</font>
<a name='L413'>        *next_out++ = s-&gt;back;
<a name='L414'>        s-&gt;stream.next_out++;
<a name='L415'>        s-&gt;stream.avail_out--;
<a name='L416'>        s-&gt;back = EOF;
<a name='L417'>        s-&gt;out++;
<a name='L418'>        start++;
<a name='L419'>        <b>if</b> (s-&gt;last) <font color='red'>{</font>
<a name='L420'>            s-&gt;z_err = <a href='../S/2769.html#L174' title='Defined at 174 in Modules/zlib/zlib.h.'>Z_STREAM_END</a>;
<a name='L421'>            <b>return</b> 1;
<a name='L422'>        <font color='red'>}</font>
<a name='L423'>    <font color='red'>}</font>
<a name='L424'>
<a name='L425'>    <b>while</b> (s-&gt;stream.avail_out != 0) <font color='red'>{</font>
<a name='L426'>
<a name='L427'>        <b>if</b> (s-&gt;transparent) <font color='red'>{</font>
<a name='L428'>            <i><font color='green'>/* Copy first the lookahead bytes: */</font></i>
<a name='L429'>            <a href='../D/11918.html' title='Multiple defined in 4 places.'>uInt</a> n = s-&gt;stream.avail_in;
<a name='L430'>            <b>if</b> (n &gt; s-&gt;stream.avail_out) n = s-&gt;stream.avail_out;
<a name='L431'>            <b>if</b> (n &gt; 0) <font color='red'>{</font>
<a name='L432'>                <a href='../D/12472.html' title='Multiple defined in 3 places.'>zmemcpy</a>(s-&gt;stream.next_out, s-&gt;stream.next_in, n);
<a name='L433'>                next_out += n;
<a name='L434'>                s-&gt;stream.next_out = next_out;
<a name='L435'>                s-&gt;stream.next_in   += n;
<a name='L436'>                s-&gt;stream.avail_out -= n;
<a name='L437'>                s-&gt;stream.avail_in  -= n;
<a name='L438'>            <font color='red'>}</font>
<a name='L439'>            <b>if</b> (s-&gt;stream.avail_out &gt; 0) <font color='red'>{</font>
<a name='L440'>                s-&gt;stream.avail_out -=
<a name='L441'>                    (<a href='../D/11918.html' title='Multiple defined in 4 places.'>uInt</a>)fread(next_out, 1, s-&gt;stream.avail_out, s-&gt;file);
<a name='L442'>            <font color='red'>}</font>
<a name='L443'>            len -= s-&gt;stream.avail_out;
<a name='L444'>            s-&gt;in  += len;
<a name='L445'>            s-&gt;out += len;
<a name='L446'>            <b>if</b> (len == 0) s-&gt;z_eof = 1;
<a name='L447'>            <b>return</b> (<b>int</b>)len;
<a name='L448'>        <font color='red'>}</font>
<a name='L449'>        <b>if</b> (s-&gt;stream.avail_in == 0 &amp;&amp; !s-&gt;z_eof) <font color='red'>{</font>
<a name='L450'>
<a name='L451'>            errno = 0;
<a name='L452'>            s-&gt;stream.avail_in = (<a href='../D/11918.html' title='Multiple defined in 4 places.'>uInt</a>)fread(s-&gt;inbuf, 1, <a href='../D/5941.html' title='Multiple defined in 2 places.'>Z_BUFSIZE</a>, s-&gt;file);
<a name='L453'>            <b>if</b> (s-&gt;stream.avail_in == 0) <font color='red'>{</font>
<a name='L454'>                s-&gt;z_eof = 1;
<a name='L455'>                <b>if</b> (ferror(s-&gt;file)) <font color='red'>{</font>
<a name='L456'>                    s-&gt;z_err = <a href='../S/2769.html#L176' title='Defined at 176 in Modules/zlib/zlib.h.'>Z_ERRNO</a>;
<a name='L457'>                    <b>break</b>;
<a name='L458'>                <font color='red'>}</font>
<a name='L459'>            <font color='red'>}</font>
<a name='L460'>            s-&gt;stream.next_in = s-&gt;inbuf;
<a name='L461'>        <font color='red'>}</font>
<a name='L462'>        s-&gt;in += s-&gt;stream.avail_in;
<a name='L463'>        s-&gt;out += s-&gt;stream.avail_out;
<a name='L464'>        s-&gt;z_err = <a href='../D/9156.html' title='Multiple defined in 3 places.'>inflate</a>(&amp;(s-&gt;stream), <a href='../S/2769.html#L164' title='Defined at 164 in Modules/zlib/zlib.h.'>Z_NO_FLUSH</a>);
<a name='L465'>        s-&gt;in -= s-&gt;stream.avail_in;
<a name='L466'>        s-&gt;out -= s-&gt;stream.avail_out;
<a name='L467'>
<a name='L468'>        <b>if</b> (s-&gt;z_err == <a href='../S/2769.html#L174' title='Defined at 174 in Modules/zlib/zlib.h.'>Z_STREAM_END</a>) <font color='red'>{</font>
<a name='L469'>            <i><font color='green'>/* Check CRC and original size */</font></i>
<a name='L470'>            s-&gt;crc = <a href='../D/7813.html' title='Multiple defined in 3 places.'>crc32</a>(s-&gt;crc, start, (<a href='../D/11918.html' title='Multiple defined in 4 places.'>uInt</a>)(s-&gt;stream.next_out - start));
<a name='L471'>            start = s-&gt;stream.next_out;
<a name='L472'>
<a name='L473'>            <b>if</b> (<a href='../S/2743.html#L935' title='Defined at 935 in Modules/zlib/gzio.c.'>getLong</a>(s) != s-&gt;crc) <font color='red'>{</font>
<a name='L474'>                s-&gt;z_err = <a href='../S/2769.html#L178' title='Defined at 178 in Modules/zlib/zlib.h.'>Z_DATA_ERROR</a>;
<a name='L475'>            <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L476'>                (<b>void</b>)<a href='../S/2743.html#L935' title='Defined at 935 in Modules/zlib/gzio.c.'>getLong</a>(s);
<a name='L477'>                <i><font color='green'>/* The uncompressed length returned by above getlong() may be</font></i>
<a name='L478'><i><font color='green'>                 * different from s-&gt;out in case of concatenated .gz files.</font></i>
<a name='L479'><i><font color='green'>                 * Check for such files:</font></i>
<a name='L480'><i><font color='green'>                 */</font></i>
<a name='L481'>                <a href='../S/2743.html#L288' title='Defined at 288 in Modules/zlib/gzio.c.'>check_header</a>(s);
<a name='L482'>                <b>if</b> (s-&gt;z_err == <a href='../S/2769.html#L173' title='Defined at 173 in Modules/zlib/zlib.h.'>Z_OK</a>) <font color='red'>{</font>
<a name='L483'>                    <a href='../D/9170.html' title='Multiple defined in 3 places.'>inflateReset</a>(&amp;(s-&gt;stream));
<a name='L484'>                    s-&gt;crc = <a href='../D/7813.html' title='Multiple defined in 3 places.'>crc32</a>(0L, <a href='../S/2769.html#L208' title='Defined at 208 in Modules/zlib/zlib.h.'>Z_NULL</a>, 0);
<a name='L485'>                <font color='red'>}</font>
<a name='L486'>            <font color='red'>}</font>
<a name='L487'>        <font color='red'>}</font>
<a name='L488'>        <b>if</b> (s-&gt;z_err != <a href='../S/2769.html#L173' title='Defined at 173 in Modules/zlib/zlib.h.'>Z_OK</a> || s-&gt;z_eof) <b>break</b>;
<a name='L489'>    <font color='red'>}</font>
<a name='L490'>    s-&gt;crc = <a href='../D/7813.html' title='Multiple defined in 3 places.'>crc32</a>(s-&gt;crc, start, (<a href='../D/11918.html' title='Multiple defined in 4 places.'>uInt</a>)(s-&gt;stream.next_out - start));
<a name='L491'>
<a name='L492'>    <b>if</b> (len == s-&gt;stream.avail_out &amp;&amp;
<a name='L493'>        (s-&gt;z_err == <a href='../S/2769.html#L178' title='Defined at 178 in Modules/zlib/zlib.h.'>Z_DATA_ERROR</a> || s-&gt;z_err == <a href='../S/2769.html#L176' title='Defined at 176 in Modules/zlib/zlib.h.'>Z_ERRNO</a>))
<a name='L494'>        <b>return</b> -1;
<a name='L495'>    <b>return</b> (<b>int</b>)(len - s-&gt;stream.avail_out);
<a name='L496'><font color='red'>}</font>
<a name='L497'>
<a name='L498'>
<a name='L499'><i><font color='green'>/* ===========================================================================</font></i>
<a name='L500'><i><font color='green'>      Reads one byte from the compressed file. gzgetc returns this byte</font></i>
<a name='L501'><i><font color='green'>   or -1 in case of end of file or error.</font></i>
<a name='L502'><i><font color='green'>*/</font></i>
<a name='L503'><b>int</b> <a href='../D/5922.html' title='Multiple defined in 8 places.'>ZEXPORT</a> <a href='../R/8225.html' title='Multiple refered from 2 places.'>gzgetc</a>(file)
<a name='L504'>    gzFile file;
<a name='L505'><font color='red'>{</font>
<a name='L506'>    <b>unsigned</b> <b>char</b> c;
<a name='L507'>
<a name='L508'>    <b>return</b> <a href='../D/9037.html' title='Multiple defined in 3 places.'>gzread</a>(file, &amp;c, 1) == 1 ? c : -1;
<a name='L509'><font color='red'>}</font>
<a name='L510'>
<a name='L511'>
<a name='L512'><i><font color='green'>/* ===========================================================================</font></i>
<a name='L513'><i><font color='green'>      Push one byte back onto the stream.</font></i>
<a name='L514'><i><font color='green'>*/</font></i>
<a name='L515'><b>int</b> <a href='../D/5922.html' title='Multiple defined in 8 places.'>ZEXPORT</a> <a href='../R/8241.html' title='Multiple refered from 2 places.'>gzungetc</a>(c, file)
<a name='L516'>    <b>int</b> c;
<a name='L517'>    gzFile file;
<a name='L518'><font color='red'>{</font>
<a name='L519'>    <a href='../D/9014.html' title='Multiple defined in 2 places.'>gz_stream</a> *s = (<a href='../D/9014.html' title='Multiple defined in 2 places.'>gz_stream</a>*)file;
<a name='L520'>
<a name='L521'>    <b>if</b> (s == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> || s-&gt;mode != 'r' || c == EOF || s-&gt;back != EOF) <b>return</b> EOF;
<a name='L522'>    s-&gt;back = c;
<a name='L523'>    s-&gt;out--;
<a name='L524'>    s-&gt;last = (s-&gt;z_err == <a href='../S/2769.html#L174' title='Defined at 174 in Modules/zlib/zlib.h.'>Z_STREAM_END</a>);
<a name='L525'>    <b>if</b> (s-&gt;last) s-&gt;z_err = <a href='../S/2769.html#L173' title='Defined at 173 in Modules/zlib/zlib.h.'>Z_OK</a>;
<a name='L526'>    s-&gt;z_eof = 0;
<a name='L527'>    <b>return</b> c;
<a name='L528'><font color='red'>}</font>
<a name='L529'>
<a name='L530'>
<a name='L531'><i><font color='green'>/* ===========================================================================</font></i>
<a name='L532'><i><font color='green'>      Reads bytes from the compressed file until len-1 characters are</font></i>
<a name='L533'><i><font color='green'>   read, or a newline character is read and transferred to buf, or an</font></i>
<a name='L534'><i><font color='green'>   end-of-file condition is encountered.  The string is then terminated</font></i>
<a name='L535'><i><font color='green'>   with a null character.</font></i>
<a name='L536'><i><font color='green'>      gzgets returns buf, or Z_NULL in case of error.</font></i>
<a name='L537'><i><font color='green'></font></i>
<a name='L538'><i><font color='green'>      The current implementation is not optimized at all.</font></i>
<a name='L539'><i><font color='green'>*/</font></i>
<a name='L540'><b>char</b> * <a href='../D/5922.html' title='Multiple defined in 8 places.'>ZEXPORT</a> <a href='../R/8226.html' title='Multiple refered from 2 places.'>gzgets</a>(file, buf, len)
<a name='L541'>    gzFile file;
<a name='L542'>    <b>char</b> *buf;
<a name='L543'>    <b>int</b> len;
<a name='L544'><font color='red'>{</font>
<a name='L545'>    <b>char</b> *<a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a> = buf;
<a name='L546'>    <b>if</b> (buf == <a href='../S/2769.html#L208' title='Defined at 208 in Modules/zlib/zlib.h.'>Z_NULL</a> || len &lt;= 0) <b>return</b> <a href='../S/2769.html#L208' title='Defined at 208 in Modules/zlib/zlib.h.'>Z_NULL</a>;
<a name='L547'>
<a name='L548'>    <b>while</b> (--len &gt; 0 &amp;&amp; <a href='../D/9037.html' title='Multiple defined in 3 places.'>gzread</a>(file, buf, 1) == 1 &amp;&amp; *buf++ != '\n') ;
<a name='L549'>    *buf = '\0';
<a name='L550'>    <b>return</b> <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a> == buf &amp;&amp; len &gt; 0 ? <a href='../S/2769.html#L208' title='Defined at 208 in Modules/zlib/zlib.h.'>Z_NULL</a> : <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a>;
<a name='L551'><font color='red'>}</font>
<a name='L552'>
<a name='L553'>
<a name='L554'><font color='darkred'>#ifndef</font> <a href='../D/2330.html' title='Multiple defined in 2 places.'>NO_GZCOMPRESS</a>
<a name='L555'><i><font color='green'>/* ===========================================================================</font></i>
<a name='L556'><i><font color='green'>     Writes the given number of uncompressed bytes into the compressed file.</font></i>
<a name='L557'><i><font color='green'>   gzwrite returns the number of bytes actually written (0 in case of error).</font></i>
<a name='L558'><i><font color='green'>*/</font></i>
<a name='L559'><b>int</b> <a href='../D/5922.html' title='Multiple defined in 8 places.'>ZEXPORT</a> <a href='../R/8242.html' title='Multiple refered from 10 places.'>gzwrite</a> (file, buf, len)
<a name='L560'>    gzFile file;
<a name='L561'>    voidpc buf;
<a name='L562'>    <b>unsigned</b> len;
<a name='L563'><font color='red'>{</font>
<a name='L564'>    <a href='../D/9014.html' title='Multiple defined in 2 places.'>gz_stream</a> *s = (<a href='../D/9014.html' title='Multiple defined in 2 places.'>gz_stream</a>*)file;
<a name='L565'>
<a name='L566'>    <b>if</b> (s == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> || s-&gt;mode != 'w') <b>return</b> <a href='../S/2769.html#L177' title='Defined at 177 in Modules/zlib/zlib.h.'>Z_STREAM_ERROR</a>;
<a name='L567'>
<a name='L568'>    s-&gt;stream.next_in = (<a href='../D/459.html' title='Multiple defined in 6 places.'>Bytef</a>*)buf;
<a name='L569'>    s-&gt;stream.avail_in = len;
<a name='L570'>
<a name='L571'>    <b>while</b> (s-&gt;stream.avail_in != 0) <font color='red'>{</font>
<a name='L572'>
<a name='L573'>        <b>if</b> (s-&gt;stream.avail_out == 0) <font color='red'>{</font>
<a name='L574'>
<a name='L575'>            s-&gt;stream.next_out = s-&gt;outbuf;
<a name='L576'>            <b>if</b> (fwrite(s-&gt;outbuf, 1, <a href='../D/5941.html' title='Multiple defined in 2 places.'>Z_BUFSIZE</a>, s-&gt;file) != <a href='../D/5941.html' title='Multiple defined in 2 places.'>Z_BUFSIZE</a>) <font color='red'>{</font>
<a name='L577'>                s-&gt;z_err = <a href='../S/2769.html#L176' title='Defined at 176 in Modules/zlib/zlib.h.'>Z_ERRNO</a>;
<a name='L578'>                <b>break</b>;
<a name='L579'>            <font color='red'>}</font>
<a name='L580'>            s-&gt;stream.avail_out = <a href='../D/5941.html' title='Multiple defined in 2 places.'>Z_BUFSIZE</a>;
<a name='L581'>        <font color='red'>}</font>
<a name='L582'>        s-&gt;in += s-&gt;stream.avail_in;
<a name='L583'>        s-&gt;out += s-&gt;stream.avail_out;
<a name='L584'>        s-&gt;z_err = <a href='../D/8004.html' title='Multiple defined in 3 places.'>deflate</a>(&amp;(s-&gt;stream), <a href='../S/2769.html#L164' title='Defined at 164 in Modules/zlib/zlib.h.'>Z_NO_FLUSH</a>);
<a name='L585'>        s-&gt;in -= s-&gt;stream.avail_in;
<a name='L586'>        s-&gt;out -= s-&gt;stream.avail_out;
<a name='L587'>        <b>if</b> (s-&gt;z_err != <a href='../S/2769.html#L173' title='Defined at 173 in Modules/zlib/zlib.h.'>Z_OK</a>) <b>break</b>;
<a name='L588'>    <font color='red'>}</font>
<a name='L589'>    s-&gt;crc = <a href='../D/7813.html' title='Multiple defined in 3 places.'>crc32</a>(s-&gt;crc, (<b>const</b> <a href='../D/459.html' title='Multiple defined in 6 places.'>Bytef</a> *)buf, len);
<a name='L590'>
<a name='L591'>    <b>return</b> (<b>int</b>)(len - s-&gt;stream.avail_in);
<a name='L592'><font color='red'>}</font>
<a name='L593'>
<a name='L594'>
<a name='L595'><i><font color='green'>/* ===========================================================================</font></i>
<a name='L596'><i><font color='green'>     Converts, formats, and writes the args to the compressed file under</font></i>
<a name='L597'><i><font color='green'>   control of the format string, as in fprintf. gzprintf returns the number of</font></i>
<a name='L598'><i><font color='green'>   uncompressed bytes actually written (0 in case of error).</font></i>
<a name='L599'><i><font color='green'>*/</font></i>
<a name='L600'><font color='darkred'>#ifdef</font> <a href='../D/4951.html' title='Multiple defined in 12 places.'>STDC</a>
<a name='L601'><font color='darkred'>#include</font> &lt;stdarg.h&gt;
<a name='L602'>
<a name='L603'><b>int</b> <a href='../D/5923.html' title='Multiple defined in 10 places.'>ZEXPORTVA</a> <a href='../R/8231.html' title='Multiple refered from 2 places.'>gzprintf</a> (gzFile file, <b>const</b> <b>char</b> *format, <i><font color='green'>/* args */</font></i> ...)
<a name='L604'><font color='red'>{</font>
<a name='L605'>    <b>char</b> buf[<a href='../S/2743.html#L30' title='Defined at 30 in Modules/zlib/gzio.c.'>Z_PRINTF_BUFSIZE</a>];
<a name='L606'>    va_list va;
<a name='L607'>    <b>int</b> len;
<a name='L608'>
<a name='L609'>    buf[<b>sizeof</b>(buf) - 1] = 0;
<a name='L610'>    va_start(va, format);
<a name='L611'><font color='darkred'>#ifdef</font> <a href='../D/2334.html' title='Multiple defined in 8 places.'>NO_vsnprintf</a>
<a name='L612'><font color='darkred'>#  ifdef</font> HAS_vsprintf_void
<a name='L613'>    (<b>void</b>)vsprintf(buf, format, va);
<a name='L614'>    va_end(va);
<a name='L615'>    <b>for</b> (len = 0; len &lt; <b>sizeof</b>(buf); len++)
<a name='L616'>        <b>if</b> (buf[len] == 0) <b>break</b>;
<a name='L617'><font color='darkred'>#  else</font>
<a name='L618'>    len = vsprintf(buf, format, va);
<a name='L619'>    va_end(va);
<a name='L620'><font color='darkred'>#  endif</font>
<a name='L621'><font color='darkred'>#else</font>
<a name='L622'><font color='darkred'>#  ifdef</font> HAS_vsnprintf_void
<a name='L623'>    (<b>void</b>)<a href='../D/12268.html' title='Multiple defined in 2 places.'>vsnprintf</a>(buf, <b>sizeof</b>(buf), format, va);
<a name='L624'>    va_end(va);
<a name='L625'>    len = strlen(buf);
<a name='L626'><font color='darkred'>#  else</font>
<a name='L627'>    len = <a href='../D/12268.html' title='Multiple defined in 2 places.'>vsnprintf</a>(buf, <b>sizeof</b>(buf), format, va);
<a name='L628'>    va_end(va);
<a name='L629'><font color='darkred'>#  endif</font>
<a name='L630'><font color='darkred'>#endif</font>
<a name='L631'>    <b>if</b> (len &lt;= 0 || len &gt;= (<b>int</b>)<b>sizeof</b>(buf) || buf[<b>sizeof</b>(buf) - 1] != 0)
<a name='L632'>        <b>return</b> 0;
<a name='L633'>    <b>return</b> <a href='../D/9045.html' title='Multiple defined in 3 places.'>gzwrite</a>(file, buf, (<b>unsigned</b>)len);
<a name='L634'><font color='red'>}</font>
<a name='L635'><font color='darkred'>#else</font> <i><font color='green'>/* not ANSI C */</font></i>
<a name='L636'>
<a name='L637'><b>int</b> <a href='../D/5923.html' title='Multiple defined in 10 places.'>ZEXPORTVA</a> <a href='../R/8231.html' title='Multiple refered from 2 places.'>gzprintf</a> (file, format, a1, a2, a3, a4, a5, a6, a7, a8, a9, a10,
<a name='L638'>                       a11, a12, a13, a14, a15, a16, a17, a18, a19, a20)
<a name='L639'>    gzFile file;
<a name='L640'>    <b>const</b> <b>char</b> *format;
<a name='L641'>    <b>int</b> a1, a2, a3, a4, a5, a6, a7, a8, a9, a10,
<a name='L642'>        a11, a12, a13, a14, a15, a16, a17, a18, a19, a20;
<a name='L643'><font color='red'>{</font>
<a name='L644'>    <b>char</b> buf[<a href='../S/2743.html#L30' title='Defined at 30 in Modules/zlib/gzio.c.'>Z_PRINTF_BUFSIZE</a>];
<a name='L645'>    <b>int</b> len;
<a name='L646'>
<a name='L647'>    buf[<b>sizeof</b>(buf) - 1] = 0;
<a name='L648'><font color='darkred'>#ifdef</font> NO_snprintf
<a name='L649'><font color='darkred'>#  ifdef</font> HAS_sprintf_void
<a name='L650'>    sprintf(buf, format, <a href='../S/2333.html#L115' title='Defined at 115 in Modules/_ctypes/libffi/src/mips/ffitarget.h.'>a1</a>, <a href='../S/2333.html#L116' title='Defined at 116 in Modules/_ctypes/libffi/src/mips/ffitarget.h.'>a2</a>, <a href='../S/2333.html#L117' title='Defined at 117 in Modules/_ctypes/libffi/src/mips/ffitarget.h.'>a3</a>, <a href='../S/2333.html#L118' title='Defined at 118 in Modules/_ctypes/libffi/src/mips/ffitarget.h.'>a4</a>, <a href='../S/2333.html#L119' title='Defined at 119 in Modules/_ctypes/libffi/src/mips/ffitarget.h.'>a5</a>, <a href='../S/2333.html#L120' title='Defined at 120 in Modules/_ctypes/libffi/src/mips/ffitarget.h.'>a6</a>, <a href='../S/2333.html#L121' title='Defined at 121 in Modules/_ctypes/libffi/src/mips/ffitarget.h.'>a7</a>, a8,
<a name='L651'>            a9, a10, a11, a12, a13, a14, a15, a16, a17, a18, a19, a20);
<a name='L652'>    <b>for</b> (len = 0; len &lt; <b>sizeof</b>(buf); len++)
<a name='L653'>        <b>if</b> (buf[len] == 0) <b>break</b>;
<a name='L654'><font color='darkred'>#  else</font>
<a name='L655'>    len = sprintf(buf, format, <a href='../S/2333.html#L115' title='Defined at 115 in Modules/_ctypes/libffi/src/mips/ffitarget.h.'>a1</a>, <a href='../S/2333.html#L116' title='Defined at 116 in Modules/_ctypes/libffi/src/mips/ffitarget.h.'>a2</a>, <a href='../S/2333.html#L117' title='Defined at 117 in Modules/_ctypes/libffi/src/mips/ffitarget.h.'>a3</a>, <a href='../S/2333.html#L118' title='Defined at 118 in Modules/_ctypes/libffi/src/mips/ffitarget.h.'>a4</a>, <a href='../S/2333.html#L119' title='Defined at 119 in Modules/_ctypes/libffi/src/mips/ffitarget.h.'>a5</a>, <a href='../S/2333.html#L120' title='Defined at 120 in Modules/_ctypes/libffi/src/mips/ffitarget.h.'>a6</a>, <a href='../S/2333.html#L121' title='Defined at 121 in Modules/_ctypes/libffi/src/mips/ffitarget.h.'>a7</a>, a8,
<a name='L656'>                a9, a10, a11, a12, a13, a14, a15, a16, a17, a18, a19, a20);
<a name='L657'><font color='darkred'>#  endif</font>
<a name='L658'><font color='darkred'>#else</font>
<a name='L659'><font color='darkred'>#  ifdef</font> HAS_snprintf_void
<a name='L660'>    <a href='../S/2711.html#L370' title='Defined at 370 in Modules/socketmodule.c.'>snprintf</a>(buf, <b>sizeof</b>(buf), format, <a href='../S/2333.html#L115' title='Defined at 115 in Modules/_ctypes/libffi/src/mips/ffitarget.h.'>a1</a>, <a href='../S/2333.html#L116' title='Defined at 116 in Modules/_ctypes/libffi/src/mips/ffitarget.h.'>a2</a>, <a href='../S/2333.html#L117' title='Defined at 117 in Modules/_ctypes/libffi/src/mips/ffitarget.h.'>a3</a>, <a href='../S/2333.html#L118' title='Defined at 118 in Modules/_ctypes/libffi/src/mips/ffitarget.h.'>a4</a>, <a href='../S/2333.html#L119' title='Defined at 119 in Modules/_ctypes/libffi/src/mips/ffitarget.h.'>a5</a>, <a href='../S/2333.html#L120' title='Defined at 120 in Modules/_ctypes/libffi/src/mips/ffitarget.h.'>a6</a>, <a href='../S/2333.html#L121' title='Defined at 121 in Modules/_ctypes/libffi/src/mips/ffitarget.h.'>a7</a>, a8,
<a name='L661'>             a9, a10, a11, a12, a13, a14, a15, a16, a17, a18, a19, a20);
<a name='L662'>    len = strlen(buf);
<a name='L663'><font color='darkred'>#  else</font>
<a name='L664'>    len = <a href='../S/2711.html#L370' title='Defined at 370 in Modules/socketmodule.c.'>snprintf</a>(buf, <b>sizeof</b>(buf), format, <a href='../S/2333.html#L115' title='Defined at 115 in Modules/_ctypes/libffi/src/mips/ffitarget.h.'>a1</a>, <a href='../S/2333.html#L116' title='Defined at 116 in Modules/_ctypes/libffi/src/mips/ffitarget.h.'>a2</a>, <a href='../S/2333.html#L117' title='Defined at 117 in Modules/_ctypes/libffi/src/mips/ffitarget.h.'>a3</a>, <a href='../S/2333.html#L118' title='Defined at 118 in Modules/_ctypes/libffi/src/mips/ffitarget.h.'>a4</a>, <a href='../S/2333.html#L119' title='Defined at 119 in Modules/_ctypes/libffi/src/mips/ffitarget.h.'>a5</a>, <a href='../S/2333.html#L120' title='Defined at 120 in Modules/_ctypes/libffi/src/mips/ffitarget.h.'>a6</a>, <a href='../S/2333.html#L121' title='Defined at 121 in Modules/_ctypes/libffi/src/mips/ffitarget.h.'>a7</a>, a8,
<a name='L665'>                 a9, a10, a11, a12, a13, a14, a15, a16, a17, a18, a19, a20);
<a name='L666'><font color='darkred'>#  endif</font>
<a name='L667'><font color='darkred'>#endif</font>
<a name='L668'>    <b>if</b> (len &lt;= 0 || len &gt;= <b>sizeof</b>(buf) || buf[<b>sizeof</b>(buf) - 1] != 0)
<a name='L669'>        <b>return</b> 0;
<a name='L670'>    <b>return</b> <a href='../D/9045.html' title='Multiple defined in 3 places.'>gzwrite</a>(file, buf, len);
<a name='L671'><font color='red'>}</font>
<a name='L672'><font color='darkred'>#endif</font>
<a name='L673'>
<a name='L674'><i><font color='green'>/* ===========================================================================</font></i>
<a name='L675'><i><font color='green'>      Writes c, converted to an unsigned char, into the compressed file.</font></i>
<a name='L676'><i><font color='green'>   gzputc returns the value that was written, or -1 in case of error.</font></i>
<a name='L677'><i><font color='green'>*/</font></i>
<a name='L678'><b>int</b> <a href='../D/5922.html' title='Multiple defined in 8 places.'>ZEXPORT</a> <a href='../R/8232.html' title='Multiple refered from 2 places.'>gzputc</a>(file, c)
<a name='L679'>    gzFile file;
<a name='L680'>    <b>int</b> c;
<a name='L681'><font color='red'>{</font>
<a name='L682'>    <b>unsigned</b> <b>char</b> cc = (<b>unsigned</b> <b>char</b>) c; <i><font color='green'>/* required for big endian systems */</font></i>
<a name='L683'>
<a name='L684'>    <b>return</b> <a href='../D/9045.html' title='Multiple defined in 3 places.'>gzwrite</a>(file, &amp;cc, 1) == 1 ? (<b>int</b>)cc : -1;
<a name='L685'><font color='red'>}</font>
<a name='L686'>
<a name='L687'>
<a name='L688'><i><font color='green'>/* ===========================================================================</font></i>
<a name='L689'><i><font color='green'>      Writes the given null-terminated string to the compressed file, excluding</font></i>
<a name='L690'><i><font color='green'>   the terminating null character.</font></i>
<a name='L691'><i><font color='green'>      gzputs returns the number of characters written, or -1 in case of error.</font></i>
<a name='L692'><i><font color='green'>*/</font></i>
<a name='L693'><b>int</b> <a href='../D/5922.html' title='Multiple defined in 8 places.'>ZEXPORT</a> <a href='../R/8233.html' title='Multiple refered from 2 places.'>gzputs</a>(file, s)
<a name='L694'>    gzFile file;
<a name='L695'>    <b>const</b> <b>char</b> *s;
<a name='L696'><font color='red'>{</font>
<a name='L697'>    <b>return</b> <a href='../D/9045.html' title='Multiple defined in 3 places.'>gzwrite</a>(file, (<b>char</b>*)s, (<b>unsigned</b>)strlen(s));
<a name='L698'><font color='red'>}</font>
<a name='L699'>
<a name='L700'>
<a name='L701'><i><font color='green'>/* ===========================================================================</font></i>
<a name='L702'><i><font color='green'>     Flushes all pending output into the compressed file. The parameter</font></i>
<a name='L703'><i><font color='green'>   flush is as in the deflate() function.</font></i>
<a name='L704'><i><font color='green'>*/</font></i>
<a name='L705'><a href='../D/9558.html' title='Multiple defined in 6 places.'>local</a> <b>int</b> <a href='../R/7438.html' title='Multiple refered from 3 places.'>do_flush</a> (file, flush)
<a name='L706'>    gzFile file;
<a name='L707'>    <b>int</b> flush;
<a name='L708'><font color='red'>{</font>
<a name='L709'>    <a href='../D/11918.html' title='Multiple defined in 4 places.'>uInt</a> len;
<a name='L710'>    <b>int</b> done = 0;
<a name='L711'>    <a href='../D/9014.html' title='Multiple defined in 2 places.'>gz_stream</a> *s = (<a href='../D/9014.html' title='Multiple defined in 2 places.'>gz_stream</a>*)file;
<a name='L712'>
<a name='L713'>    <b>if</b> (s == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> || s-&gt;mode != 'w') <b>return</b> <a href='../S/2769.html#L177' title='Defined at 177 in Modules/zlib/zlib.h.'>Z_STREAM_ERROR</a>;
<a name='L714'>
<a name='L715'>    s-&gt;stream.avail_in = 0; <i><font color='green'>/* should be zero already anyway */</font></i>
<a name='L716'>
<a name='L717'>    <b>for</b> (;;) <font color='red'>{</font>
<a name='L718'>        len = <a href='../D/5941.html' title='Multiple defined in 2 places.'>Z_BUFSIZE</a> - s-&gt;stream.avail_out;
<a name='L719'>
<a name='L720'>        <b>if</b> (len != 0) <font color='red'>{</font>
<a name='L721'>            <b>if</b> ((<a href='../D/11918.html' title='Multiple defined in 4 places.'>uInt</a>)fwrite(s-&gt;outbuf, 1, len, s-&gt;file) != len) <font color='red'>{</font>
<a name='L722'>                s-&gt;z_err = <a href='../S/2769.html#L176' title='Defined at 176 in Modules/zlib/zlib.h.'>Z_ERRNO</a>;
<a name='L723'>                <b>return</b> <a href='../S/2769.html#L176' title='Defined at 176 in Modules/zlib/zlib.h.'>Z_ERRNO</a>;
<a name='L724'>            <font color='red'>}</font>
<a name='L725'>            s-&gt;stream.next_out = s-&gt;outbuf;
<a name='L726'>            s-&gt;stream.avail_out = <a href='../D/5941.html' title='Multiple defined in 2 places.'>Z_BUFSIZE</a>;
<a name='L727'>        <font color='red'>}</font>
<a name='L728'>        <b>if</b> (done) <b>break</b>;
<a name='L729'>        s-&gt;out += s-&gt;stream.avail_out;
<a name='L730'>        s-&gt;z_err = <a href='../D/8004.html' title='Multiple defined in 3 places.'>deflate</a>(&amp;(s-&gt;stream), flush);
<a name='L731'>        s-&gt;out -= s-&gt;stream.avail_out;
<a name='L732'>
<a name='L733'>        <i><font color='green'>/* Ignore the second of two consecutive flushes: */</font></i>
<a name='L734'>        <b>if</b> (len == 0 &amp;&amp; s-&gt;z_err == <a href='../S/2769.html#L180' title='Defined at 180 in Modules/zlib/zlib.h.'>Z_BUF_ERROR</a>) s-&gt;z_err = <a href='../S/2769.html#L173' title='Defined at 173 in Modules/zlib/zlib.h.'>Z_OK</a>;
<a name='L735'>
<a name='L736'>        <i><font color='green'>/* deflate has finished flushing only when it hasn't used up</font></i>
<a name='L737'><i><font color='green'>         * all the available space in the output buffer:</font></i>
<a name='L738'><i><font color='green'>         */</font></i>
<a name='L739'>        done = (s-&gt;stream.avail_out != 0 || s-&gt;z_err == <a href='../S/2769.html#L174' title='Defined at 174 in Modules/zlib/zlib.h.'>Z_STREAM_END</a>);
<a name='L740'>
<a name='L741'>        <b>if</b> (s-&gt;z_err != <a href='../S/2769.html#L173' title='Defined at 173 in Modules/zlib/zlib.h.'>Z_OK</a> &amp;&amp; s-&gt;z_err != <a href='../S/2769.html#L174' title='Defined at 174 in Modules/zlib/zlib.h.'>Z_STREAM_END</a>) <b>break</b>;
<a name='L742'>    <font color='red'>}</font>
<a name='L743'>    <b>return</b>  s-&gt;z_err == <a href='../S/2769.html#L174' title='Defined at 174 in Modules/zlib/zlib.h.'>Z_STREAM_END</a> ? <a href='../S/2769.html#L173' title='Defined at 173 in Modules/zlib/zlib.h.'>Z_OK</a> : s-&gt;z_err;
<a name='L744'><font color='red'>}</font>
<a name='L745'>
<a name='L746'><b>int</b> <a href='../D/5922.html' title='Multiple defined in 8 places.'>ZEXPORT</a> <a href='../S/2769.html#L1319' title='Refered from 1319 in Modules/zlib/zlib.h.'>gzflush</a> (file, flush)
<a name='L747'>     gzFile file;
<a name='L748'>     <b>int</b> flush;
<a name='L749'><font color='red'>{</font>
<a name='L750'>    <a href='../D/9014.html' title='Multiple defined in 2 places.'>gz_stream</a> *s = (<a href='../D/9014.html' title='Multiple defined in 2 places.'>gz_stream</a>*)file;
<a name='L751'>    <b>int</b> err = <a href='../S/2743.html#L705' title='Defined at 705 in Modules/zlib/gzio.c.'>do_flush</a> (file, flush);
<a name='L752'>
<a name='L753'>    <b>if</b> (err) <b>return</b> err;
<a name='L754'>    fflush(s-&gt;file);
<a name='L755'>    <b>return</b>  s-&gt;z_err == <a href='../S/2769.html#L174' title='Defined at 174 in Modules/zlib/zlib.h.'>Z_STREAM_END</a> ? <a href='../S/2769.html#L173' title='Defined at 173 in Modules/zlib/zlib.h.'>Z_OK</a> : s-&gt;z_err;
<a name='L756'><font color='red'>}</font>
<a name='L757'><font color='darkred'>#endif</font> <i><font color='green'>/* NO_GZCOMPRESS */</font></i>
<a name='L758'>
<a name='L759'><i><font color='green'>/* ===========================================================================</font></i>
<a name='L760'><i><font color='green'>      Sets the starting position for the next gzread or gzwrite on the given</font></i>
<a name='L761'><i><font color='green'>   compressed file. The offset represents a number of bytes in the</font></i>
<a name='L762'><i><font color='green'>      gzseek returns the resulting offset location as measured in bytes from</font></i>
<a name='L763'><i><font color='green'>   the beginning of the uncompressed stream, or -1 in case of error.</font></i>
<a name='L764'><i><font color='green'>      SEEK_END is not implemented, returns error.</font></i>
<a name='L765'><i><font color='green'>      In this version of the library, gzseek can be extremely slow.</font></i>
<a name='L766'><i><font color='green'>*/</font></i>
<a name='L767'><a href='../D/12437.html' title='Multiple defined in 4 places.'>z_off_t</a> <a href='../D/5922.html' title='Multiple defined in 8 places.'>ZEXPORT</a> <a href='../R/8236.html' title='Multiple refered from 4 places.'>gzseek</a> (file, offset, whence)
<a name='L768'>    gzFile file;
<a name='L769'>    <a href='../D/12437.html' title='Multiple defined in 4 places.'>z_off_t</a> offset;
<a name='L770'>    <b>int</b> whence;
<a name='L771'><font color='red'>{</font>
<a name='L772'>    <a href='../D/9014.html' title='Multiple defined in 2 places.'>gz_stream</a> *s = (<a href='../D/9014.html' title='Multiple defined in 2 places.'>gz_stream</a>*)file;
<a name='L773'>
<a name='L774'>    <b>if</b> (s == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> || whence == <a href='../D/4575.html' title='Multiple defined in 2 places.'>SEEK_END</a> ||
<a name='L775'>        s-&gt;z_err == <a href='../S/2769.html#L176' title='Defined at 176 in Modules/zlib/zlib.h.'>Z_ERRNO</a> || s-&gt;z_err == <a href='../S/2769.html#L178' title='Defined at 178 in Modules/zlib/zlib.h.'>Z_DATA_ERROR</a>) <font color='red'>{</font>
<a name='L776'>        <b>return</b> -1L;
<a name='L777'>    <font color='red'>}</font>
<a name='L778'>
<a name='L779'>    <b>if</b> (s-&gt;mode == 'w') <font color='red'>{</font>
<a name='L780'><font color='darkred'>#ifdef</font> <a href='../D/2330.html' title='Multiple defined in 2 places.'>NO_GZCOMPRESS</a>
<a name='L781'>        <b>return</b> -1L;
<a name='L782'><font color='darkred'>#else</font>
<a name='L783'>        <b>if</b> (whence == <a href='../D/4576.html' title='Multiple defined in 2 places.'>SEEK_SET</a>) <font color='red'>{</font>
<a name='L784'>            offset -= s-&gt;in;
<a name='L785'>        <font color='red'>}</font>
<a name='L786'>        <b>if</b> (offset &lt; 0) <b>return</b> -1L;
<a name='L787'>
<a name='L788'>        <i><font color='green'>/* At this point, offset is the number of zero bytes to write. */</font></i>
<a name='L789'>        <b>if</b> (s-&gt;inbuf == <a href='../S/2769.html#L208' title='Defined at 208 in Modules/zlib/zlib.h.'>Z_NULL</a>) <font color='red'>{</font>
<a name='L790'>            s-&gt;inbuf = (<a href='../D/458.html' title='Multiple defined in 4 places.'>Byte</a>*)<a href='../D/61.html' title='Multiple defined in 3 places.'>ALLOC</a>(<a href='../D/5941.html' title='Multiple defined in 2 places.'>Z_BUFSIZE</a>); <i><font color='green'>/* for seeking */</font></i>
<a name='L791'>            <b>if</b> (s-&gt;inbuf == <a href='../S/2769.html#L208' title='Defined at 208 in Modules/zlib/zlib.h.'>Z_NULL</a>) <b>return</b> -1L;
<a name='L792'>            <a href='../D/12473.html' title='Multiple defined in 3 places.'>zmemzero</a>(s-&gt;inbuf, <a href='../D/5941.html' title='Multiple defined in 2 places.'>Z_BUFSIZE</a>);
<a name='L793'>        <font color='red'>}</font>
<a name='L794'>        <b>while</b> (offset &gt; 0)  <font color='red'>{</font>
<a name='L795'>            <a href='../D/11918.html' title='Multiple defined in 4 places.'>uInt</a> size = <a href='../D/5941.html' title='Multiple defined in 2 places.'>Z_BUFSIZE</a>;
<a name='L796'>            <b>if</b> (offset &lt; <a href='../D/5941.html' title='Multiple defined in 2 places.'>Z_BUFSIZE</a>) size = (<a href='../D/11918.html' title='Multiple defined in 4 places.'>uInt</a>)offset;
<a name='L797'>
<a name='L798'>            size = <a href='../D/9045.html' title='Multiple defined in 3 places.'>gzwrite</a>(file, s-&gt;inbuf, size);
<a name='L799'>            <b>if</b> (size == 0) <b>return</b> -1L;
<a name='L800'>
<a name='L801'>            offset -= size;
<a name='L802'>        <font color='red'>}</font>
<a name='L803'>        <b>return</b> s-&gt;in;
<a name='L804'><font color='darkred'>#endif</font>
<a name='L805'>    <font color='red'>}</font>
<a name='L806'>    <i><font color='green'>/* Rest of function is for reading only */</font></i>
<a name='L807'>
<a name='L808'>    <i><font color='green'>/* compute absolute position */</font></i>
<a name='L809'>    <b>if</b> (whence == <a href='../D/4574.html' title='Multiple defined in 2 places.'>SEEK_CUR</a>) <font color='red'>{</font>
<a name='L810'>        offset += s-&gt;out;
<a name='L811'>    <font color='red'>}</font>
<a name='L812'>    <b>if</b> (offset &lt; 0) <b>return</b> -1L;
<a name='L813'>
<a name='L814'>    <b>if</b> (s-&gt;transparent) <font color='red'>{</font>
<a name='L815'>        <i><font color='green'>/* map to fseek */</font></i>
<a name='L816'>        s-&gt;back = EOF;
<a name='L817'>        s-&gt;stream.avail_in = 0;
<a name='L818'>        s-&gt;stream.next_in = s-&gt;inbuf;
<a name='L819'>        <b>if</b> (fseek(s-&gt;file, offset, <a href='../D/4576.html' title='Multiple defined in 2 places.'>SEEK_SET</a>) &lt; 0) <b>return</b> -1L;
<a name='L820'>
<a name='L821'>        s-&gt;in = s-&gt;out = offset;
<a name='L822'>        <b>return</b> offset;
<a name='L823'>    <font color='red'>}</font>
<a name='L824'>
<a name='L825'>    <i><font color='green'>/* For a negative seek, rewind and use positive seek */</font></i>
<a name='L826'>    <b>if</b> (offset &gt;= s-&gt;out) <font color='red'>{</font>
<a name='L827'>        offset -= s-&gt;out;
<a name='L828'>    <font color='red'>}</font> <b>else</b> <b>if</b> (<a href='../D/9038.html' title='Multiple defined in 3 places.'>gzrewind</a>(file) &lt; 0) <font color='red'>{</font>
<a name='L829'>        <b>return</b> -1L;
<a name='L830'>    <font color='red'>}</font>
<a name='L831'>    <i><font color='green'>/* offset is now the number of bytes to skip. */</font></i>
<a name='L832'>
<a name='L833'>    <b>if</b> (offset != 0 &amp;&amp; s-&gt;outbuf == <a href='../S/2769.html#L208' title='Defined at 208 in Modules/zlib/zlib.h.'>Z_NULL</a>) <font color='red'>{</font>
<a name='L834'>        s-&gt;outbuf = (<a href='../D/458.html' title='Multiple defined in 4 places.'>Byte</a>*)<a href='../D/61.html' title='Multiple defined in 3 places.'>ALLOC</a>(<a href='../D/5941.html' title='Multiple defined in 2 places.'>Z_BUFSIZE</a>);
<a name='L835'>        <b>if</b> (s-&gt;outbuf == <a href='../S/2769.html#L208' title='Defined at 208 in Modules/zlib/zlib.h.'>Z_NULL</a>) <b>return</b> -1L;
<a name='L836'>    <font color='red'>}</font>
<a name='L837'>    <b>if</b> (offset &amp;&amp; s-&gt;back != EOF) <font color='red'>{</font>
<a name='L838'>        s-&gt;back = EOF;
<a name='L839'>        s-&gt;out++;
<a name='L840'>        offset--;
<a name='L841'>        <b>if</b> (s-&gt;last) s-&gt;z_err = <a href='../S/2769.html#L174' title='Defined at 174 in Modules/zlib/zlib.h.'>Z_STREAM_END</a>;
<a name='L842'>    <font color='red'>}</font>
<a name='L843'>    <b>while</b> (offset &gt; 0)  <font color='red'>{</font>
<a name='L844'>        <b>int</b> size = <a href='../D/5941.html' title='Multiple defined in 2 places.'>Z_BUFSIZE</a>;
<a name='L845'>        <b>if</b> (offset &lt; <a href='../D/5941.html' title='Multiple defined in 2 places.'>Z_BUFSIZE</a>) size = (<b>int</b>)offset;
<a name='L846'>
<a name='L847'>        size = <a href='../D/9037.html' title='Multiple defined in 3 places.'>gzread</a>(file, s-&gt;outbuf, (<a href='../D/11918.html' title='Multiple defined in 4 places.'>uInt</a>)size);
<a name='L848'>        <b>if</b> (size &lt;= 0) <b>return</b> -1L;
<a name='L849'>        offset -= size;
<a name='L850'>    <font color='red'>}</font>
<a name='L851'>    <b>return</b> s-&gt;out;
<a name='L852'><font color='red'>}</font>
<a name='L853'>
<a name='L854'><i><font color='green'>/* ===========================================================================</font></i>
<a name='L855'><i><font color='green'>     Rewinds input file.</font></i>
<a name='L856'><i><font color='green'>*/</font></i>
<a name='L857'><b>int</b> <a href='../D/5922.html' title='Multiple defined in 8 places.'>ZEXPORT</a> <a href='../R/8235.html' title='Multiple refered from 3 places.'>gzrewind</a> (file)
<a name='L858'>    gzFile file;
<a name='L859'><font color='red'>{</font>
<a name='L860'>    <a href='../D/9014.html' title='Multiple defined in 2 places.'>gz_stream</a> *s = (<a href='../D/9014.html' title='Multiple defined in 2 places.'>gz_stream</a>*)file;
<a name='L861'>
<a name='L862'>    <b>if</b> (s == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> || s-&gt;mode != 'r') <b>return</b> -1;
<a name='L863'>
<a name='L864'>    s-&gt;z_err = <a href='../S/2769.html#L173' title='Defined at 173 in Modules/zlib/zlib.h.'>Z_OK</a>;
<a name='L865'>    s-&gt;z_eof = 0;
<a name='L866'>    s-&gt;back = EOF;
<a name='L867'>    s-&gt;stream.avail_in = 0;
<a name='L868'>    s-&gt;stream.next_in = s-&gt;inbuf;
<a name='L869'>    s-&gt;crc = <a href='../D/7813.html' title='Multiple defined in 3 places.'>crc32</a>(0L, <a href='../S/2769.html#L208' title='Defined at 208 in Modules/zlib/zlib.h.'>Z_NULL</a>, 0);
<a name='L870'>    <b>if</b> (!s-&gt;transparent) (<b>void</b>)<a href='../D/9170.html' title='Multiple defined in 3 places.'>inflateReset</a>(&amp;s-&gt;stream);
<a name='L871'>    s-&gt;in = 0;
<a name='L872'>    s-&gt;out = 0;
<a name='L873'>    <b>return</b> fseek(s-&gt;file, s-&gt;start, <a href='../D/4576.html' title='Multiple defined in 2 places.'>SEEK_SET</a>);
<a name='L874'><font color='red'>}</font>
<a name='L875'>
<a name='L876'><i><font color='green'>/* ===========================================================================</font></i>
<a name='L877'><i><font color='green'>     Returns the starting position for the next gzread or gzwrite on the</font></i>
<a name='L878'><i><font color='green'>   given compressed file. This position represents a number of bytes in the</font></i>
<a name='L879'><i><font color='green'>   uncompressed data stream.</font></i>
<a name='L880'><i><font color='green'>*/</font></i>
<a name='L881'><a href='../D/12437.html' title='Multiple defined in 4 places.'>z_off_t</a> <a href='../D/5922.html' title='Multiple defined in 8 places.'>ZEXPORT</a> <a href='../R/8239.html' title='Multiple refered from 3 places.'>gztell</a> (file)
<a name='L882'>    gzFile file;
<a name='L883'><font color='red'>{</font>
<a name='L884'>    <b>return</b> <a href='../D/9039.html' title='Multiple defined in 4 places.'>gzseek</a>(file, 0L, <a href='../D/4574.html' title='Multiple defined in 2 places.'>SEEK_CUR</a>);
<a name='L885'><font color='red'>}</font>
<a name='L886'>
<a name='L887'><i><font color='green'>/* ===========================================================================</font></i>
<a name='L888'><i><font color='green'>     Returns 1 when EOF has previously been detected reading the given</font></i>
<a name='L889'><i><font color='green'>   input stream, otherwise zero.</font></i>
<a name='L890'><i><font color='green'>*/</font></i>
<a name='L891'><b>int</b> <a href='../D/5922.html' title='Multiple defined in 8 places.'>ZEXPORT</a> <a href='../S/2769.html#L1382' title='Refered from 1382 in Modules/zlib/zlib.h.'>gzeof</a> (file)
<a name='L892'>    gzFile file;
<a name='L893'><font color='red'>{</font>
<a name='L894'>    <a href='../D/9014.html' title='Multiple defined in 2 places.'>gz_stream</a> *s = (<a href='../D/9014.html' title='Multiple defined in 2 places.'>gz_stream</a>*)file;
<a name='L895'>
<a name='L896'>    <i><font color='green'>/* With concatenated compressed files that can have embedded</font></i>
<a name='L897'><i><font color='green'>     * crc trailers, z_eof is no longer the only/best indicator of EOF</font></i>
<a name='L898'><i><font color='green'>     * on a gz_stream. Handle end-of-stream error explicitly here.</font></i>
<a name='L899'><i><font color='green'>     */</font></i>
<a name='L900'>    <b>if</b> (s == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> || s-&gt;mode != 'r') <b>return</b> 0;
<a name='L901'>    <b>if</b> (s-&gt;z_eof) <b>return</b> 1;
<a name='L902'>    <b>return</b> s-&gt;z_err == <a href='../S/2769.html#L174' title='Defined at 174 in Modules/zlib/zlib.h.'>Z_STREAM_END</a>;
<a name='L903'><font color='red'>}</font>
<a name='L904'>
<a name='L905'><i><font color='green'>/* ===========================================================================</font></i>
<a name='L906'><i><font color='green'>     Returns 1 if reading and doing so transparently, otherwise zero.</font></i>
<a name='L907'><i><font color='green'>*/</font></i>
<a name='L908'><b>int</b> <a href='../D/5922.html' title='Multiple defined in 8 places.'>ZEXPORT</a> <a href='../S/2769.html#L1397' title='Refered from 1397 in Modules/zlib/zlib.h.'>gzdirect</a> (file)
<a name='L909'>    gzFile file;
<a name='L910'><font color='red'>{</font>
<a name='L911'>    <a href='../D/9014.html' title='Multiple defined in 2 places.'>gz_stream</a> *s = (<a href='../D/9014.html' title='Multiple defined in 2 places.'>gz_stream</a>*)file;
<a name='L912'>
<a name='L913'>    <b>if</b> (s == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> || s-&gt;mode != 'r') <b>return</b> 0;
<a name='L914'>    <b>return</b> s-&gt;transparent;
<a name='L915'><font color='red'>}</font>
<a name='L916'>
<a name='L917'><i><font color='green'>/* ===========================================================================</font></i>
<a name='L918'><i><font color='green'>   Outputs a long in LSB order to the given file</font></i>
<a name='L919'><i><font color='green'>*/</font></i>
<a name='L920'><a href='../D/9558.html' title='Multiple defined in 6 places.'>local</a> <b>void</b> <a href='../R/9787.html' title='Multiple refered from 3 places.'>putLong</a> (file, x)
<a name='L921'>    FILE *file;
<a name='L922'>    uLong x;
<a name='L923'><font color='red'>{</font>
<a name='L924'>    <b>int</b> n;
<a name='L925'>    <b>for</b> (n = 0; n &lt; 4; n++) <font color='red'>{</font>
<a name='L926'>        fputc((<b>int</b>)(x &amp; 0xff), file);
<a name='L927'>        x &gt;&gt;= 8;
<a name='L928'>    <font color='red'>}</font>
<a name='L929'><font color='red'>}</font>
<a name='L930'>
<a name='L931'><i><font color='green'>/* ===========================================================================</font></i>
<a name='L932'><i><font color='green'>   Reads a long in LSB order from the given gz_stream. Sets z_err in case</font></i>
<a name='L933'><i><font color='green'>   of error.</font></i>
<a name='L934'><i><font color='green'>*/</font></i>
<a name='L935'><a href='../D/9558.html' title='Multiple defined in 6 places.'>local</a> <a href='../D/11920.html' title='Multiple defined in 4 places.'>uLong</a> <a href='../R/8023.html' title='Multiple refered from 3 places.'>getLong</a> (s)
<a name='L936'>    gz_stream *s;
<a name='L937'><font color='red'>{</font>
<a name='L938'>    <a href='../D/11920.html' title='Multiple defined in 4 places.'>uLong</a> x = (<a href='../D/11920.html' title='Multiple defined in 4 places.'>uLong</a>)<a href='../S/2743.html#L261' title='Defined at 261 in Modules/zlib/gzio.c.'>get_byte</a>(s);
<a name='L939'>    <b>int</b> c;
<a name='L940'>
<a name='L941'>    x += ((<a href='../D/11920.html' title='Multiple defined in 4 places.'>uLong</a>)<a href='../S/2743.html#L261' title='Defined at 261 in Modules/zlib/gzio.c.'>get_byte</a>(s))&lt;&lt;8;
<a name='L942'>    x += ((<a href='../D/11920.html' title='Multiple defined in 4 places.'>uLong</a>)<a href='../S/2743.html#L261' title='Defined at 261 in Modules/zlib/gzio.c.'>get_byte</a>(s))&lt;&lt;16;
<a name='L943'>    c = <a href='../S/2743.html#L261' title='Defined at 261 in Modules/zlib/gzio.c.'>get_byte</a>(s);
<a name='L944'>    <b>if</b> (c == EOF) s-&gt;z_err = <a href='../S/2769.html#L178' title='Defined at 178 in Modules/zlib/zlib.h.'>Z_DATA_ERROR</a>;
<a name='L945'>    x += ((<a href='../D/11920.html' title='Multiple defined in 4 places.'>uLong</a>)c)&lt;&lt;24;
<a name='L946'>    <b>return</b> x;
<a name='L947'><font color='red'>}</font>
<a name='L948'>
<a name='L949'><i><font color='green'>/* ===========================================================================</font></i>
<a name='L950'><i><font color='green'>     Flushes all pending output if necessary, closes the compressed file</font></i>
<a name='L951'><i><font color='green'>   and deallocates all the (de)compression state.</font></i>
<a name='L952'><i><font color='green'>*/</font></i>
<a name='L953'><b>int</b> <a href='../D/5922.html' title='Multiple defined in 8 places.'>ZEXPORT</a> <a href='../R/8217.html' title='Multiple refered from 6 places.'>gzclose</a> (file)
<a name='L954'>    gzFile file;
<a name='L955'><font color='red'>{</font>
<a name='L956'>    <a href='../D/9014.html' title='Multiple defined in 2 places.'>gz_stream</a> *s = (<a href='../D/9014.html' title='Multiple defined in 2 places.'>gz_stream</a>*)file;
<a name='L957'>
<a name='L958'>    <b>if</b> (s == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <b>return</b> <a href='../S/2769.html#L177' title='Defined at 177 in Modules/zlib/zlib.h.'>Z_STREAM_ERROR</a>;
<a name='L959'>
<a name='L960'>    <b>if</b> (s-&gt;mode == 'w') <font color='red'>{</font>
<a name='L961'><font color='darkred'>#ifdef</font> <a href='../D/2330.html' title='Multiple defined in 2 places.'>NO_GZCOMPRESS</a>
<a name='L962'>        <b>return</b> <a href='../S/2769.html#L177' title='Defined at 177 in Modules/zlib/zlib.h.'>Z_STREAM_ERROR</a>;
<a name='L963'><font color='darkred'>#else</font>
<a name='L964'>        <b>if</b> (<a href='../S/2743.html#L705' title='Defined at 705 in Modules/zlib/gzio.c.'>do_flush</a> (file, <a href='../S/2769.html#L168' title='Defined at 168 in Modules/zlib/zlib.h.'>Z_FINISH</a>) != <a href='../S/2769.html#L173' title='Defined at 173 in Modules/zlib/zlib.h.'>Z_OK</a>)
<a name='L965'>            <b>return</b> <a href='../S/2743.html#L355' title='Defined at 355 in Modules/zlib/gzio.c.'>destroy</a>((<a href='../D/9014.html' title='Multiple defined in 2 places.'>gz_stream</a>*)file);
<a name='L966'>
<a name='L967'>        <a href='../S/2743.html#L920' title='Defined at 920 in Modules/zlib/gzio.c.'>putLong</a> (s-&gt;file, s-&gt;crc);
<a name='L968'>        <a href='../S/2743.html#L920' title='Defined at 920 in Modules/zlib/gzio.c.'>putLong</a> (s-&gt;file, (<a href='../D/11920.html' title='Multiple defined in 4 places.'>uLong</a>)(s-&gt;in &amp; 0xffffffff));
<a name='L969'><font color='darkred'>#endif</font>
<a name='L970'>    <font color='red'>}</font>
<a name='L971'>    <b>return</b> <a href='../S/2743.html#L355' title='Defined at 355 in Modules/zlib/gzio.c.'>destroy</a>((<a href='../D/9014.html' title='Multiple defined in 2 places.'>gz_stream</a>*)file);
<a name='L972'><font color='red'>}</font>
<a name='L973'>
<a name='L974'><font color='darkred'>#ifdef</font> <a href='../D/4951.html' title='Multiple defined in 12 places.'>STDC</a>
<a name='L975'><font color='darkred'>#  define</font> <a href='../R/11562.html' title='Multiple refered from 3 places.'>zstrerror</a>(errnum) strerror(errnum)
<a name='L976'><font color='darkred'>#else</font>
<a name='L977'><font color='darkred'>#  define</font> <a href='../R/11562.html' title='Multiple refered from 3 places.'>zstrerror</a>(errnum) ""
<a name='L978'><font color='darkred'>#endif</font>
<a name='L979'>
<a name='L980'><i><font color='green'>/* ===========================================================================</font></i>
<a name='L981'><i><font color='green'>     Returns the error message for the last error which occurred on the</font></i>
<a name='L982'><i><font color='green'>   given compressed file. errnum is set to zlib error number. If an</font></i>
<a name='L983'><i><font color='green'>   error occurred in the file system and not in the compression library,</font></i>
<a name='L984'><i><font color='green'>   errnum is set to Z_ERRNO and the application may consult errno</font></i>
<a name='L985'><i><font color='green'>   to get the exact error code.</font></i>
<a name='L986'><i><font color='green'>*/</font></i>
<a name='L987'><b>const</b> <b>char</b> * <a href='../D/5922.html' title='Multiple defined in 8 places.'>ZEXPORT</a> <a href='../R/8223.html' title='Multiple refered from 8 places.'>gzerror</a> (file, errnum)
<a name='L988'>    gzFile file;
<a name='L989'>    <b>int</b> *errnum;
<a name='L990'><font color='red'>{</font>
<a name='L991'>    <b>char</b> *m;
<a name='L992'>    <a href='../D/9014.html' title='Multiple defined in 2 places.'>gz_stream</a> *s = (<a href='../D/9014.html' title='Multiple defined in 2 places.'>gz_stream</a>*)file;
<a name='L993'>
<a name='L994'>    <b>if</b> (s == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L995'>        *errnum = <a href='../S/2769.html#L177' title='Defined at 177 in Modules/zlib/zlib.h.'>Z_STREAM_ERROR</a>;
<a name='L996'>        <b>return</b> (<b>const</b> <b>char</b>*)<a href='../S/2773.html#L46' title='Defined at 46 in Modules/zlib/zutil.h.'>ERR_MSG</a>(<a href='../S/2769.html#L177' title='Defined at 177 in Modules/zlib/zlib.h.'>Z_STREAM_ERROR</a>);
<a name='L997'>    <font color='red'>}</font>
<a name='L998'>    *errnum = s-&gt;z_err;
<a name='L999'>    <b>if</b> (*errnum == <a href='../S/2769.html#L173' title='Defined at 173 in Modules/zlib/zlib.h.'>Z_OK</a>) <b>return</b> (<b>const</b> <b>char</b>*)"";
<a name='L1000'>
<a name='L1001'>    m = (<b>char</b>*)(*errnum == <a href='../S/2769.html#L176' title='Defined at 176 in Modules/zlib/zlib.h.'>Z_ERRNO</a> ? <a href='../D/12474.html' title='Multiple defined in 5 places.'>zstrerror</a>(errno) : s-&gt;stream.msg);
<a name='L1002'>
<a name='L1003'>    <b>if</b> (m == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> || *m == '\0') m = (<b>char</b>*)<a href='../S/2773.html#L46' title='Defined at 46 in Modules/zlib/zutil.h.'>ERR_MSG</a>(s-&gt;z_err);
<a name='L1004'>
<a name='L1005'>    <a href='../S/2743.html#L44' title='Defined at 44 in Modules/zlib/gzio.c.'>TRYFREE</a>(s-&gt;msg);
<a name='L1006'>    s-&gt;msg = (<b>char</b>*)<a href='../D/61.html' title='Multiple defined in 3 places.'>ALLOC</a>(strlen(s-&gt;path) + strlen(m) + 3);
<a name='L1007'>    <b>if</b> (s-&gt;msg == <a href='../S/2769.html#L208' title='Defined at 208 in Modules/zlib/zlib.h.'>Z_NULL</a>) <b>return</b> (<b>const</b> <b>char</b>*)<a href='../S/2773.html#L46' title='Defined at 46 in Modules/zlib/zutil.h.'>ERR_MSG</a>(<a href='../S/2769.html#L179' title='Defined at 179 in Modules/zlib/zlib.h.'>Z_MEM_ERROR</a>);
<a name='L1008'>    strcpy(s-&gt;msg, s-&gt;path);
<a name='L1009'>    strcat(s-&gt;msg, ": ");
<a name='L1010'>    strcat(s-&gt;msg, m);
<a name='L1011'>    <b>return</b> (<b>const</b> <b>char</b>*)s-&gt;msg;
<a name='L1012'><font color='red'>}</font>
<a name='L1013'>
<a name='L1014'><i><font color='green'>/* ===========================================================================</font></i>
<a name='L1015'><i><font color='green'>     Clear the error and end-of-file flags, and do the same for the real file.</font></i>
<a name='L1016'><i><font color='green'>*/</font></i>
<a name='L1017'><b>void</b> <a href='../D/5922.html' title='Multiple defined in 8 places.'>ZEXPORT</a> <a href='../S/2769.html#L1453' title='Refered from 1453 in Modules/zlib/zlib.h.'>gzclearerr</a> (file)
<a name='L1018'>    gzFile file;
<a name='L1019'><font color='red'>{</font>
<a name='L1020'>    <a href='../D/9014.html' title='Multiple defined in 2 places.'>gz_stream</a> *s = (<a href='../D/9014.html' title='Multiple defined in 2 places.'>gz_stream</a>*)file;
<a name='L1021'>
<a name='L1022'>    <b>if</b> (s == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <b>return</b>;
<a name='L1023'>    <b>if</b> (s-&gt;z_err != <a href='../S/2769.html#L174' title='Defined at 174 in Modules/zlib/zlib.h.'>Z_STREAM_END</a>) s-&gt;z_err = <a href='../S/2769.html#L173' title='Defined at 173 in Modules/zlib/zlib.h.'>Z_OK</a>;
<a name='L1024'>    s-&gt;z_eof = 0;
<a name='L1025'>    clearerr(s-&gt;file);
<a name='L1026'><font color='red'>}</font>
</pre>
<hr>
<a name='BOTTOM'>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L93'>[^]</a><a href='#L1017'>[v]</a><a href='#TOP'>[top]</a>[bottom]<a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
</body>
</html>
