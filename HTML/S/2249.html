<html>
<head>
<title>Modules/_ctypes/callbacks.c</title>
<meta name='robots' content='noindex,nofollow'>
<meta name='generator' content='GLOBAL-5.8.1'>
</head>
<body text='#191970' bgcolor='#f5f5dc' vlink='gray'>
<a name='TOP'><h2><a href='../mains.html'>root</a>/<a href='../files/3353.html'>Modules</a>/<a href='../files/3354.html'>_ctypes</a>/callbacks.c</h2>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L13'>[^]</a><a href='#L595'>[v]</a>[top]<a href='#BOTTOM'>[bottom]</a><a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
<hr>
<h2>DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href='#L13' title='Defined at 13.'>CThunkObject_dealloc</a>
<li><a href='#L25' title='Defined at 25.'>CThunkObject_traverse</a>
<li><a href='#L35' title='Defined at 35.'>CThunkObject_clear</a>
<li><a href='#L79' title='Defined at 79.'>PrintError</a>
<li><a href='#L95' title='Defined at 95.'>_ctypes_add_traceback</a>
<li><a href='#L132' title='Defined at 132.'>TryAddRef</a>
<li><a href='#L151' title='Defined at 151.'>_CallPythonObject</a>
<li><a href='#L314' title='Defined at 314.'>closure_fcn</a>
<li><a href='#L330' title='Defined at 330.'>CThunkObject_new</a>
<li><a href='#L355' title='Defined at 355.'>_ctypes_alloc_callback</a>
<li><a href='#L445' title='Defined at 445.'>LoadPython</a>
<li><a href='#L457' title='Defined at 457.'>Call_GetClassObject</a>
<li><a href='#L516' title='Defined at 516.'>DllGetClassObject</a>
<li><a href='#L536' title='Defined at 536.'>Call_CanUnloadNow</a>
<li><a href='#L581' title='Defined at 581.'>DllCanUnloadNow</a>
<li><a href='#L595' title='Defined at 595.'>DllMain</a>
</ol>
<hr>
<pre>
<a name='L1'><font color='darkred'>#include</font> "<a href='570.html'>Python.h</a>"
<a name='L2'><font color='darkred'>#include</font> "<a href='526.html'>frameobject.h</a>"
<a name='L3'>
<a name='L4'><font color='darkred'>#include</font> &lt;<a href='../I/325.html'>ffi.h</a>&gt;
<a name='L5'><font color='darkred'>#ifdef</font> <a href='../S/2906.html#L80' title='Defined at 80 in PC/pyconfig.h.'>MS_WIN32</a>
<a name='L6'><font color='darkred'>#include</font> &lt;windows.h&gt;
<a name='L7'><font color='darkred'>#endif</font>
<a name='L8'><font color='darkred'>#include</font> "<a href='2252.html'>ctypes.h</a>"
<a name='L9'>
<a name='L10'><i><font color='green'>/**************************************************************/</font></i>
<a name='L11'>
<a name='L12'><b>static</b> <b>void</b>
<a name='L13'><a href='../S/2249.html#L49' title='Refered from 49 in Modules/_ctypes/callbacks.c.'>CThunkObject_dealloc</a>(PyObject *_self)
<a name='L14'><font color='red'>{</font>
<a name='L15'>    <a href='../S/2252.html#L71' title='Defined at 71 in Modules/_ctypes/ctypes.h.'>CThunkObject</a> *self = (<a href='../S/2252.html#L71' title='Defined at 71 in Modules/_ctypes/ctypes.h.'>CThunkObject</a> *)_self;
<a name='L16'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(self-&gt;converters);
<a name='L17'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(self-&gt;callable);
<a name='L18'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(self-&gt;restype);
<a name='L19'>    <b>if</b> (self-&gt;pcl_write)
<a name='L20'>        <a href='../D/8483.html' title='Multiple defined in 3 places.'>ffi_closure_free</a>(self-&gt;pcl_write);
<a name='L21'>    <a href='../D/3617.html' title='Multiple defined in 2 places.'>PyObject_GC_Del</a>(self);
<a name='L22'><font color='red'>}</font>
<a name='L23'>
<a name='L24'><b>static</b> <b>int</b>
<a name='L25'><a href='../S/2249.html#L66' title='Refered from 66 in Modules/_ctypes/callbacks.c.'>CThunkObject_traverse</a>(PyObject *_self, visitproc visit, <b>void</b> *arg)
<a name='L26'><font color='red'>{</font>
<a name='L27'>    <a href='../S/2252.html#L71' title='Defined at 71 in Modules/_ctypes/ctypes.h.'>CThunkObject</a> *self = (<a href='../S/2252.html#L71' title='Defined at 71 in Modules/_ctypes/ctypes.h.'>CThunkObject</a> *)_self;
<a name='L28'>    Py_VISIT(self-&gt;converters);
<a name='L29'>    Py_VISIT(self-&gt;callable);
<a name='L30'>    Py_VISIT(self-&gt;restype);
<a name='L31'>    <b>return</b> 0;
<a name='L32'><font color='red'>}</font>
<a name='L33'>
<a name='L34'><b>static</b> <b>int</b>
<a name='L35'><a href='../S/2249.html#L67' title='Refered from 67 in Modules/_ctypes/callbacks.c.'>CThunkObject_clear</a>(PyObject *_self)
<a name='L36'><font color='red'>{</font>
<a name='L37'>    <a href='../S/2252.html#L71' title='Defined at 71 in Modules/_ctypes/ctypes.h.'>CThunkObject</a> *self = (<a href='../S/2252.html#L71' title='Defined at 71 in Modules/_ctypes/ctypes.h.'>CThunkObject</a> *)_self;
<a name='L38'>    <a href='../D/4095.html' title='Multiple defined in 2 places.'>Py_CLEAR</a>(self-&gt;converters);
<a name='L39'>    <a href='../D/4095.html' title='Multiple defined in 2 places.'>Py_CLEAR</a>(self-&gt;callable);
<a name='L40'>    <a href='../D/4095.html' title='Multiple defined in 2 places.'>Py_CLEAR</a>(self-&gt;restype);
<a name='L41'>    <b>return</b> 0;
<a name='L42'><font color='red'>}</font>
<a name='L43'>
<a name='L44'><a href='../D/3899.html' title='Multiple defined in 3 places.'>PyTypeObject</a> PyCThunk_Type = <font color='red'>{</font>
<a name='L45'>    <a href='../D/4042.html' title='Multiple defined in 3 places.'>PyVarObject_HEAD_INIT</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, 0)
<a name='L46'>    "_ctypes.CThunkObject",
<a name='L47'>    <b>sizeof</b>(<a href='../S/2252.html#L71' title='Defined at 71 in Modules/_ctypes/ctypes.h.'>CThunkObject</a>),                       <i><font color='green'>/* tp_basicsize */</font></i>
<a name='L48'>    <b>sizeof</b>(<a href='../D/8534.html' title='Multiple defined in 3 places.'>ffi_type</a>),                           <i><font color='green'>/* tp_itemsize */</font></i>
<a name='L49'>    <a href='../S/2249.html#L13' title='Defined at 13 in Modules/_ctypes/callbacks.c.'>CThunkObject_dealloc</a>,                       <i><font color='green'>/* tp_dealloc */</font></i>
<a name='L50'>    0,                                          <i><font color='green'>/* tp_print */</font></i>
<a name='L51'>    0,                                          <i><font color='green'>/* tp_getattr */</font></i>
<a name='L52'>    0,                                          <i><font color='green'>/* tp_setattr */</font></i>
<a name='L53'>    0,                                          <i><font color='green'>/* tp_reserved */</font></i>
<a name='L54'>    0,                                          <i><font color='green'>/* tp_repr */</font></i>
<a name='L55'>    0,                                          <i><font color='green'>/* tp_as_number */</font></i>
<a name='L56'>    0,                                          <i><font color='green'>/* tp_as_sequence */</font></i>
<a name='L57'>    0,                                          <i><font color='green'>/* tp_as_mapping */</font></i>
<a name='L58'>    0,                                          <i><font color='green'>/* tp_hash */</font></i>
<a name='L59'>    0,                                          <i><font color='green'>/* tp_call */</font></i>
<a name='L60'>    0,                                          <i><font color='green'>/* tp_str */</font></i>
<a name='L61'>    0,                                          <i><font color='green'>/* tp_getattro */</font></i>
<a name='L62'>    0,                                          <i><font color='green'>/* tp_setattro */</font></i>
<a name='L63'>    0,                                          <i><font color='green'>/* tp_as_buffer */</font></i>
<a name='L64'>    Py_TPFLAGS_DEFAULT | Py_TPFLAGS_HAVE_GC,                            <i><font color='green'>/* tp_flags */</font></i>
<a name='L65'>    "CThunkObject",                             <i><font color='green'>/* tp_doc */</font></i>
<a name='L66'>    <a href='../S/2249.html#L25' title='Defined at 25 in Modules/_ctypes/callbacks.c.'>CThunkObject_traverse</a>,                      <i><font color='green'>/* tp_traverse */</font></i>
<a name='L67'>    <a href='../S/2249.html#L35' title='Defined at 35 in Modules/_ctypes/callbacks.c.'>CThunkObject_clear</a>,                         <i><font color='green'>/* tp_clear */</font></i>
<a name='L68'>    0,                                          <i><font color='green'>/* tp_richcompare */</font></i>
<a name='L69'>    0,                                          <i><font color='green'>/* tp_weaklistoffset */</font></i>
<a name='L70'>    0,                                          <i><font color='green'>/* tp_iter */</font></i>
<a name='L71'>    0,                                          <i><font color='green'>/* tp_iternext */</font></i>
<a name='L72'>    0,                                          <i><font color='green'>/* tp_methods */</font></i>
<a name='L73'>    0,                                          <i><font color='green'>/* tp_members */</font></i>
<a name='L74'><font color='red'>}</font>;
<a name='L75'>
<a name='L76'><i><font color='green'>/**************************************************************/</font></i>
<a name='L77'>
<a name='L78'><b>static</b> <b>void</b>
<a name='L79'><a href='../R/2466.html' title='Multiple refered from 7 places.'>PrintError</a>(<b>char</b> *msg, ...)
<a name='L80'><font color='red'>{</font>
<a name='L81'>    <b>char</b> buf[512];
<a name='L82'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *f = <a href='../S/3144.html#L44' title='Defined at 44 in Python/sysmodule.c.'>PySys_GetObject</a>("stderr");
<a name='L83'>    va_list <a href='../S/2588.html#L3787' title='Defined at 3787 in Modules/_pickle.c.'>marker</a>;
<a name='L84'>
<a name='L85'>    va_start(<a href='../S/2588.html#L3787' title='Defined at 3787 in Modules/_pickle.c.'>marker</a>, msg);
<a name='L86'>    <a href='../D/12268.html' title='Multiple defined in 2 places.'>vsnprintf</a>(buf, <b>sizeof</b>(buf), msg, <a href='../S/2588.html#L3787' title='Defined at 3787 in Modules/_pickle.c.'>marker</a>);
<a name='L87'>    va_end(<a href='../S/2588.html#L3787' title='Defined at 3787 in Modules/_pickle.c.'>marker</a>);
<a name='L88'>    <b>if</b> (f != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; f != Py_None)
<a name='L89'>        <a href='../S/2790.html#L167' title='Defined at 167 in Objects/fileobject.c.'>PyFile_WriteString</a>(buf, f);
<a name='L90'>    <a href='../S/3138.html#L1342' title='Defined at 1342 in Python/pythonrun.c.'>PyErr_Print</a>();
<a name='L91'><font color='red'>}</font>
<a name='L92'>
<a name='L93'>
<a name='L94'><i><font color='green'>/* after code that pyrex generates */</font></i>
<a name='L95'><b>void</b> <a href='../R/5734.html' title='Multiple refered from 3 places.'>_ctypes_add_traceback</a>(<b>char</b> *funcname, <b>char</b> *filename, <b>int</b> lineno)
<a name='L96'><font color='red'>{</font>
<a name='L97'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *py_globals = 0;
<a name='L98'>    <a href='../S/511.html#L32' title='Defined at 32 in Include/code.h.'>PyCodeObject</a> *py_code = 0;
<a name='L99'>    <a href='../S/526.html#L51' title='Defined at 51 in Include/frameobject.h.'>PyFrameObject</a> *py_frame = 0;
<a name='L100'>
<a name='L101'>    py_globals = <a href='../S/2787.html#L233' title='Defined at 233 in Objects/dictobject.c.'>PyDict_New</a>();
<a name='L102'>    <b>if</b> (!py_globals) <b>goto</b> bad;
<a name='L103'>    py_code = <a href='../S/2783.html#L117' title='Defined at 117 in Objects/codeobject.c.'>PyCode_NewEmpty</a>(filename, funcname, lineno);
<a name='L104'>    <b>if</b> (!py_code) <b>goto</b> bad;
<a name='L105'>    py_frame = <a href='../S/2792.html#L595' title='Defined at 595 in Objects/frameobject.c.'>PyFrame_New</a>(
<a name='L106'>        <a href='../S/3134.html#L368' title='Defined at 368 in Python/pystate.c.'>PyThreadState_Get</a>(), <i><font color='green'>/*PyThreadState *tstate,*/</font></i>
<a name='L107'>        py_code,             <i><font color='green'>/*PyCodeObject *code,*/</font></i>
<a name='L108'>        py_globals,          <i><font color='green'>/*PyObject *globals,*/</font></i>
<a name='L109'>        0                    <i><font color='green'>/*PyObject *locals*/</font></i>
<a name='L110'>        );
<a name='L111'>    <b>if</b> (!py_frame) <b>goto</b> bad;
<a name='L112'>    py_frame-&gt;f_lineno = lineno;
<a name='L113'>    <a href='../S/3156.html#L123' title='Defined at 123 in Python/traceback.c.'>PyTraceBack_Here</a>(py_frame);
<a name='L114'>  bad:
<a name='L115'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(py_globals);
<a name='L116'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(py_code);
<a name='L117'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(py_frame);
<a name='L118'><font color='red'>}</font>
<a name='L119'>
<a name='L120'><font color='darkred'>#ifdef</font> <a href='../S/2906.html#L80' title='Defined at 80 in PC/pyconfig.h.'>MS_WIN32</a>
<a name='L121'><i><font color='green'>/*</font></i>
<a name='L122'><i><font color='green'> * We must call AddRef() on non-NULL COM pointers we receive as arguments</font></i>
<a name='L123'><i><font color='green'> * to callback functions - these functions are COM method implementations.</font></i>
<a name='L124'><i><font color='green'> * The Python instances we create have a __del__ method which calls Release().</font></i>
<a name='L125'><i><font color='green'> *</font></i>
<a name='L126'><i><font color='green'> * The presence of a class attribute named '_needs_com_addref_' triggers this</font></i>
<a name='L127'><i><font color='green'> * behaviour.  It would also be possible to call the AddRef() Python method,</font></i>
<a name='L128'><i><font color='green'> * after checking for PyObject_IsTrue(), but this would probably be somewhat</font></i>
<a name='L129'><i><font color='green'> * slower.</font></i>
<a name='L130'><i><font color='green'> */</font></i>
<a name='L131'><b>static</b> <b>void</b>
<a name='L132'><a href='../S/2249.html#L224' title='Refered from 224 in Modules/_ctypes/callbacks.c.'>TryAddRef</a>(StgDictObject *dict, CDataObject *obj)
<a name='L133'><font color='red'>{</font>
<a name='L134'>    IUnknown *punk;
<a name='L135'>
<a name='L136'>    <b>if</b> (<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> == <a href='../S/2787.html#L2168' title='Defined at 2168 in Objects/dictobject.c.'>PyDict_GetItemString</a>((<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *)dict, "_needs_com_addref_"))
<a name='L137'>        <b>return</b>;
<a name='L138'>
<a name='L139'>    punk = *(IUnknown **)obj-&gt;b_ptr;
<a name='L140'>    <b>if</b> (punk)
<a name='L141'>        punk-&gt;lpVtbl-&gt;AddRef(punk);
<a name='L142'>    <b>return</b>;
<a name='L143'><font color='red'>}</font>
<a name='L144'><font color='darkred'>#endif</font>
<a name='L145'>
<a name='L146'><i><font color='green'>/******************************************************************************</font></i>
<a name='L147'><i><font color='green'> *</font></i>
<a name='L148'><i><font color='green'> * Call the python object with all arguments</font></i>
<a name='L149'><i><font color='green'> *</font></i>
<a name='L150'><i><font color='green'> */</font></i>
<a name='L151'><b>static</b> <b>void</b> <a href='../S/2249.html#L321' title='Refered from 321 in Modules/_ctypes/callbacks.c.'>_CallPythonObject</a>(<b>void</b> *mem,
<a name='L152'>                              ffi_type *restype,
<a name='L153'>                              SETFUNC setfunc,
<a name='L154'>                              PyObject *callable,
<a name='L155'>                              PyObject *converters,
<a name='L156'>                              <b>int</b> flags,
<a name='L157'>                              <b>void</b> **pArgs)
<a name='L158'><font color='red'>{</font>
<a name='L159'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> i;
<a name='L160'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L161'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *<a href='../D/6732.html' title='Multiple defined in 2 places.'>arglist</a> = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L162'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> nArgs;
<a name='L163'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *error_object = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L164'>    <b>int</b> *space;
<a name='L165'><font color='darkred'>#ifdef</font> <a href='../D/5537.html' title='Multiple defined in 3 places.'>WITH_THREAD</a>
<a name='L166'>    PyGILState_STATE <a href='../S/530.html#L46' title='Defined at 46 in Include/grammar.h.'>state</a> = <a href='../S/3134.html#L633' title='Defined at 633 in Python/pystate.c.'>PyGILState_Ensure</a>();
<a name='L167'><font color='darkred'>#endif</font>
<a name='L168'>
<a name='L169'>    nArgs = <a href='../D/3757.html' title='Multiple defined in 3 places.'>PySequence_Length</a>(converters);
<a name='L170'>    <i><font color='green'>/* Hm. What to return in case of error?</font></i>
<a name='L171'><i><font color='green'>       For COM, 0xFFFFFFFF seems better than 0.</font></i>
<a name='L172'><i><font color='green'>    */</font></i>
<a name='L173'>    <b>if</b> (nArgs &lt; 0) <font color='red'>{</font>
<a name='L174'>        <a href='../S/2249.html#L79' title='Defined at 79 in Modules/_ctypes/callbacks.c.'>PrintError</a>("BUG: PySequence_Length");
<a name='L175'>        <b>goto</b> Done;
<a name='L176'>    <font color='red'>}</font>
<a name='L177'>
<a name='L178'>    <a href='../D/6732.html' title='Multiple defined in 2 places.'>arglist</a> = <a href='../S/2823.html#L49' title='Defined at 49 in Objects/tupleobject.c.'>PyTuple_New</a>(nArgs);
<a name='L179'>    <b>if</b> (!<a href='../D/6732.html' title='Multiple defined in 2 places.'>arglist</a>) <font color='red'>{</font>
<a name='L180'>        <a href='../S/2249.html#L79' title='Defined at 79 in Modules/_ctypes/callbacks.c.'>PrintError</a>("PyTuple_New()");
<a name='L181'>        <b>goto</b> Done;
<a name='L182'>    <font color='red'>}</font>
<a name='L183'>    <b>for</b> (i = 0; i &lt; nArgs; ++i) <font color='red'>{</font>
<a name='L184'>        <i><font color='green'>/* Note: new reference! */</font></i>
<a name='L185'>        <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *cnv = <a href='../S/2775.html#L1584' title='Defined at 1584 in Objects/abstract.c.'>PySequence_GetItem</a>(converters, i);
<a name='L186'>        <a href='../S/2252.html#L219' title='Defined at 219 in Modules/_ctypes/ctypes.h.'>StgDictObject</a> *dict;
<a name='L187'>        <b>if</b> (cnv)
<a name='L188'>            dict = <a href='../S/2557.html#L149' title='Defined at 149 in Modules/_ctypes/stgdict.c.'>PyType_stgdict</a>(cnv);
<a name='L189'>        <b>else</b> <font color='red'>{</font>
<a name='L190'>            <a href='../S/2249.html#L79' title='Defined at 79 in Modules/_ctypes/callbacks.c.'>PrintError</a>("Getting argument converter %d\n", i);
<a name='L191'>            <b>goto</b> Done;
<a name='L192'>        <font color='red'>}</font>
<a name='L193'>
<a name='L194'>        <b>if</b> (dict &amp;&amp; dict-&gt;getfunc &amp;&amp; !<a href='../S/2246.html#L2686' title='Defined at 2686 in Modules/_ctypes/_ctypes.c.'>_ctypes_simple_instance</a>(cnv)) <font color='red'>{</font>
<a name='L195'>            <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *v = dict-&gt;getfunc(*pArgs, dict-&gt;size);
<a name='L196'>            <b>if</b> (!v) <font color='red'>{</font>
<a name='L197'>                <a href='../S/2249.html#L79' title='Defined at 79 in Modules/_ctypes/callbacks.c.'>PrintError</a>("create argument %d:\n", i);
<a name='L198'>                Py_DECREF(cnv);
<a name='L199'>                <b>goto</b> Done;
<a name='L200'>            <font color='red'>}</font>
<a name='L201'>            PyTuple_SET_ITEM(<a href='../D/6732.html' title='Multiple defined in 2 places.'>arglist</a>, i, v);
<a name='L202'>            <i><font color='green'>/* XXX XXX XX</font></i>
<a name='L203'><i><font color='green'>               We have the problem that c_byte or c_short have dict-&gt;size of</font></i>
<a name='L204'><i><font color='green'>               1 resp. 4, but these parameters are pushed as sizeof(int) bytes.</font></i>
<a name='L205'><i><font color='green'>               BTW, the same problem occurrs when they are pushed as parameters</font></i>
<a name='L206'><i><font color='green'>            */</font></i>
<a name='L207'>        <font color='red'>}</font> <b>else</b> <b>if</b> (dict) <font color='red'>{</font>
<a name='L208'>            <i><font color='green'>/* Hm, shouldn't we use PyCData_AtAddress() or something like that instead? */</font></i>
<a name='L209'>            <a href='../S/2252.html#L15' title='Defined at 15 in Modules/_ctypes/ctypes.h.'>CDataObject</a> *obj = (<a href='../S/2252.html#L15' title='Defined at 15 in Modules/_ctypes/ctypes.h.'>CDataObject</a> *)<a href='../S/2775.html#L2358' title='Defined at 2358 in Objects/abstract.c.'>PyObject_CallFunctionObjArgs</a>(cnv, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L210'>            <b>if</b> (!obj) <font color='red'>{</font>
<a name='L211'>                <a href='../S/2249.html#L79' title='Defined at 79 in Modules/_ctypes/callbacks.c.'>PrintError</a>("create argument %d:\n", i);
<a name='L212'>                Py_DECREF(cnv);
<a name='L213'>                <b>goto</b> Done;
<a name='L214'>            <font color='red'>}</font>
<a name='L215'>            <b>if</b> (!<a href='../S/2252.html#L118' title='Defined at 118 in Modules/_ctypes/ctypes.h.'>CDataObject_Check</a>(obj)) <font color='red'>{</font>
<a name='L216'>                Py_DECREF(obj);
<a name='L217'>                Py_DECREF(cnv);
<a name='L218'>                <a href='../S/2249.html#L79' title='Defined at 79 in Modules/_ctypes/callbacks.c.'>PrintError</a>("unexpected result of create argument %d:\n", i);
<a name='L219'>                <b>goto</b> Done;
<a name='L220'>            <font color='red'>}</font>
<a name='L221'>            <a href='../D/9803.html' title='Multiple defined in 4 places.'>memcpy</a>(obj-&gt;b_ptr, *pArgs, dict-&gt;size);
<a name='L222'>            PyTuple_SET_ITEM(<a href='../D/6732.html' title='Multiple defined in 2 places.'>arglist</a>, i, (<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *)obj);
<a name='L223'><font color='darkred'>#ifdef</font> <a href='../S/2906.html#L80' title='Defined at 80 in PC/pyconfig.h.'>MS_WIN32</a>
<a name='L224'>            <a href='../S/2249.html#L132' title='Defined at 132 in Modules/_ctypes/callbacks.c.'>TryAddRef</a>(dict, obj);
<a name='L225'><font color='darkred'>#endif</font>
<a name='L226'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L227'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_TypeError,
<a name='L228'>                            "cannot build parameter");
<a name='L229'>            <a href='../S/2249.html#L79' title='Defined at 79 in Modules/_ctypes/callbacks.c.'>PrintError</a>("Parsing argument %d\n", i);
<a name='L230'>            Py_DECREF(cnv);
<a name='L231'>            <b>goto</b> Done;
<a name='L232'>        <font color='red'>}</font>
<a name='L233'>        Py_DECREF(cnv);
<a name='L234'>        <i><font color='green'>/* XXX error handling! */</font></i>
<a name='L235'>        pArgs++;
<a name='L236'>    <font color='red'>}</font>
<a name='L237'>
<a name='L238'><font color='darkred'>#define</font> <a href='../R/483.html' title='Multiple refered from 349 places.'>CHECK</a>(what, x) \
<a name='L239'><b>if</b> (x == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <a href='../S/2249.html#L95' title='Defined at 95 in Modules/_ctypes/callbacks.c.'>_ctypes_add_traceback</a>(what, "_ctypes/callbacks.c", __LINE__ - 1), <a href='../S/3138.html#L1342' title='Defined at 1342 in Python/pythonrun.c.'>PyErr_Print</a>()
<a name='L240'>
<a name='L241'>    <b>if</b> (<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> &amp; (<a href='../S/2252.html#L287' title='Defined at 287 in Modules/_ctypes/ctypes.h.'>FUNCFLAG_USE_ERRNO</a> | <a href='../S/2252.html#L288' title='Defined at 288 in Modules/_ctypes/ctypes.h.'>FUNCFLAG_USE_LASTERROR</a>)) <font color='red'>{</font>
<a name='L242'>        error_object = <a href='../S/2250.html#L126' title='Defined at 126 in Modules/_ctypes/callproc.c.'>_ctypes_get_errobj</a>(&amp;space);
<a name='L243'>        <b>if</b> (error_object == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L244'>            <b>goto</b> Done;
<a name='L245'>        <b>if</b> (<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> &amp; <a href='../S/2252.html#L287' title='Defined at 287 in Modules/_ctypes/ctypes.h.'>FUNCFLAG_USE_ERRNO</a>) <font color='red'>{</font>
<a name='L246'>            <b>int</b> temp = space[0];
<a name='L247'>            space[0] = errno;
<a name='L248'>            errno = temp;
<a name='L249'>        <font color='red'>}</font>
<a name='L250'><font color='darkred'>#ifdef</font> <a href='../S/2906.html#L80' title='Defined at 80 in PC/pyconfig.h.'>MS_WIN32</a>
<a name='L251'>        <b>if</b> (<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> &amp; <a href='../S/2252.html#L288' title='Defined at 288 in Modules/_ctypes/ctypes.h.'>FUNCFLAG_USE_LASTERROR</a>) <font color='red'>{</font>
<a name='L252'>            <b>int</b> temp = space[1];
<a name='L253'>            space[1] = GetLastError();
<a name='L254'>            SetLastError(temp);
<a name='L255'>        <font color='red'>}</font>
<a name='L256'><font color='darkred'>#endif</font>
<a name='L257'>    <font color='red'>}</font>
<a name='L258'>
<a name='L259'>    <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = <a href='../S/2775.html#L2135' title='Defined at 2135 in Objects/abstract.c.'>PyObject_CallObject</a>(callable, <a href='../D/6732.html' title='Multiple defined in 2 places.'>arglist</a>);
<a name='L260'>    <a href='../D/517.html' title='Multiple defined in 4 places.'>CHECK</a>("'calling callback function'", <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>);
<a name='L261'>
<a name='L262'><font color='darkred'>#ifdef</font> <a href='../S/2906.html#L80' title='Defined at 80 in PC/pyconfig.h.'>MS_WIN32</a>
<a name='L263'>    <b>if</b> (<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> &amp; <a href='../S/2252.html#L288' title='Defined at 288 in Modules/_ctypes/ctypes.h.'>FUNCFLAG_USE_LASTERROR</a>) <font color='red'>{</font>
<a name='L264'>        <b>int</b> temp = space[1];
<a name='L265'>        space[1] = GetLastError();
<a name='L266'>        SetLastError(temp);
<a name='L267'>    <font color='red'>}</font>
<a name='L268'><font color='darkred'>#endif</font>
<a name='L269'>    <b>if</b> (<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> &amp; <a href='../S/2252.html#L287' title='Defined at 287 in Modules/_ctypes/ctypes.h.'>FUNCFLAG_USE_ERRNO</a>) <font color='red'>{</font>
<a name='L270'>        <b>int</b> temp = space[0];
<a name='L271'>        space[0] = errno;
<a name='L272'>        errno = temp;
<a name='L273'>    <font color='red'>}</font>
<a name='L274'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(error_object);
<a name='L275'>
<a name='L276'>    <b>if</b> ((restype != &amp;ffi_type_void) &amp;&amp; <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>) <font color='red'>{</font>
<a name='L277'>        <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *keep;
<a name='L278'>        <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(setfunc);
<a name='L279'><font color='darkred'>#ifdef</font> <a href='../D/5540.html' title='Multiple defined in 8 places.'>WORDS_BIGENDIAN</a>
<a name='L280'>        <i><font color='green'>/* See the corresponding code in callproc.c, around line 961 */</font></i>
<a name='L281'>        <b>if</b> (restype-&gt;type != <a href='../D/1181.html' title='Multiple defined in 3 places.'>FFI_TYPE_FLOAT</a> &amp;&amp; restype-&gt;size &lt; <b>sizeof</b>(<a href='../D/8471.html' title='Multiple defined in 27 places.'>ffi_arg</a>))
<a name='L282'>            mem = (<b>char</b> *)mem + <b>sizeof</b>(<a href='../D/8471.html' title='Multiple defined in 27 places.'>ffi_arg</a>) - restype-&gt;size;
<a name='L283'><font color='darkred'>#endif</font>
<a name='L284'>        keep = setfunc(mem, <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>, 0);
<a name='L285'>        <a href='../D/517.html' title='Multiple defined in 4 places.'>CHECK</a>("'converting callback result'", keep);
<a name='L286'>        <i><font color='green'>/* keep is an object we have to keep alive so that the result</font></i>
<a name='L287'><i><font color='green'>           stays valid.  If there is no such object, the setfunc will</font></i>
<a name='L288'><i><font color='green'>           have returned Py_None.</font></i>
<a name='L289'><i><font color='green'></font></i>
<a name='L290'><i><font color='green'>           If there is such an object, we have no choice than to keep</font></i>
<a name='L291'><i><font color='green'>           it alive forever - but a refcount and/or memory leak will</font></i>
<a name='L292'><i><font color='green'>           be the result.  EXCEPT when restype is py_object - Python</font></i>
<a name='L293'><i><font color='green'>           itself knows how to manage the refcount of these objects.</font></i>
<a name='L294'><i><font color='green'>        */</font></i>
<a name='L295'>        <b>if</b> (keep == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <i><font color='green'>/* Could not convert callback result. */</font></i>
<a name='L296'>            <a href='../S/3106.html#L708' title='Defined at 708 in Python/errors.c.'>PyErr_WriteUnraisable</a>(callable);
<a name='L297'>        <b>else</b> <b>if</b> (keep == Py_None) <i><font color='green'>/* Nothing to keep */</font></i>
<a name='L298'>            Py_DECREF(keep);
<a name='L299'>        <b>else</b> <b>if</b> (setfunc != <a href='../S/2251.html#L1645' title='Defined at 1645 in Modules/_ctypes/cfield.c.'>_ctypes_get_fielddesc</a>("O")-&gt;setfunc) <font color='red'>{</font>
<a name='L300'>            <b>if</b> (-1 == <a href='../S/3087.html#L756' title='Defined at 756 in Python/_warnings.c.'>PyErr_WarnEx</a>(PyExc_RuntimeWarning,
<a name='L301'>                                   "memory leak in callback function.",
<a name='L302'>                                   1))
<a name='L303'>                <a href='../S/3106.html#L708' title='Defined at 708 in Python/errors.c.'>PyErr_WriteUnraisable</a>(callable);
<a name='L304'>        <font color='red'>}</font>
<a name='L305'>    <font color='red'>}</font>
<a name='L306'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>);
<a name='L307'>  Done:
<a name='L308'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(<a href='../D/6732.html' title='Multiple defined in 2 places.'>arglist</a>);
<a name='L309'><font color='darkred'>#ifdef</font> <a href='../D/5537.html' title='Multiple defined in 3 places.'>WITH_THREAD</a>
<a name='L310'>    <a href='../S/3134.html#L668' title='Defined at 668 in Python/pystate.c.'>PyGILState_Release</a>(<a href='../S/530.html#L46' title='Defined at 46 in Include/grammar.h.'>state</a>);
<a name='L311'><font color='darkred'>#endif</font>
<a name='L312'><font color='red'>}</font>
<a name='L313'>
<a name='L314'><b>static</b> <b>void</b> <a href='../R/6677.html' title='Multiple refered from 2 places.'>closure_fcn</a>(ffi_cif *cif,
<a name='L315'>                        <b>void</b> *resp,
<a name='L316'>                        <b>void</b> **args,
<a name='L317'>                        <b>void</b> *userdata)
<a name='L318'><font color='red'>{</font>
<a name='L319'>    <a href='../S/2252.html#L71' title='Defined at 71 in Modules/_ctypes/ctypes.h.'>CThunkObject</a> *p = (<a href='../S/2252.html#L71' title='Defined at 71 in Modules/_ctypes/ctypes.h.'>CThunkObject</a> *)userdata;
<a name='L320'>
<a name='L321'>    <a href='../S/2249.html#L151' title='Defined at 151 in Modules/_ctypes/callbacks.c.'>_CallPythonObject</a>(resp,
<a name='L322'>                      p-&gt;ffi_restype,
<a name='L323'>                      p-&gt;setfunc,
<a name='L324'>                      p-&gt;callable,
<a name='L325'>                      p-&gt;converters,
<a name='L326'>                      p-&gt;<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a>,
<a name='L327'>                      <a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>);
<a name='L328'><font color='red'>}</font>
<a name='L329'>
<a name='L330'><b>static</b> <a href='../S/2252.html#L71' title='Defined at 71 in Modules/_ctypes/ctypes.h.'>CThunkObject</a>* <a href='../S/2249.html#L366' title='Refered from 366 in Modules/_ctypes/callbacks.c.'>CThunkObject_new</a>(<a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> nArgs)
<a name='L331'><font color='red'>{</font>
<a name='L332'>    <a href='../S/2252.html#L71' title='Defined at 71 in Modules/_ctypes/ctypes.h.'>CThunkObject</a> *p;
<a name='L333'>    <b>int</b> i;
<a name='L334'>
<a name='L335'>    p = PyObject_GC_NewVar(<a href='../S/2252.html#L71' title='Defined at 71 in Modules/_ctypes/ctypes.h.'>CThunkObject</a>, &amp;PyCThunk_Type, nArgs);
<a name='L336'>    <b>if</b> (p == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L337'>        <a href='../S/3106.html#L334' title='Defined at 334 in Python/errors.c.'>PyErr_NoMemory</a>();
<a name='L338'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L339'>    <font color='red'>}</font>
<a name='L340'>
<a name='L341'>    p-&gt;pcl_exec = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L342'>    p-&gt;pcl_write = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L343'>    memset(&amp;p-&gt;cif, 0, <b>sizeof</b>(p-&gt;cif));
<a name='L344'>    p-&gt;converters = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L345'>    p-&gt;callable = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L346'>    p-&gt;setfunc = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L347'>    p-&gt;ffi_restype = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L348'>
<a name='L349'>    <b>for</b> (i = 0; i &lt; nArgs + 1; ++i)
<a name='L350'>        p-&gt;atypes[i] = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L351'>    <a href='../D/3618.html' title='Multiple defined in 2 places.'>PyObject_GC_Track</a>((<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *)p);
<a name='L352'>    <b>return</b> p;
<a name='L353'><font color='red'>}</font>
<a name='L354'>
<a name='L355'><a href='../S/2252.html#L71' title='Defined at 71 in Modules/_ctypes/ctypes.h.'>CThunkObject</a> *<a href='../R/5735.html' title='Multiple refered from 2 places.'>_ctypes_alloc_callback</a>(PyObject *callable,
<a name='L356'>                                    PyObject *converters,
<a name='L357'>                                    PyObject *restype,
<a name='L358'>                                    <b>int</b> flags)
<a name='L359'><font color='red'>{</font>
<a name='L360'>    <b>int</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L361'>    <a href='../S/2252.html#L71' title='Defined at 71 in Modules/_ctypes/ctypes.h.'>CThunkObject</a> *p;
<a name='L362'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> nArgs, i;
<a name='L363'>    <a href='../D/8469.html' title='Multiple defined in 42 places.'>ffi_abi</a> cc;
<a name='L364'>
<a name='L365'>    nArgs = <a href='../S/2775.html#L1452' title='Defined at 1452 in Objects/abstract.c.'>PySequence_Size</a>(converters);
<a name='L366'>    p = <a href='../S/2249.html#L330' title='Defined at 330 in Modules/_ctypes/callbacks.c.'>CThunkObject_new</a>(nArgs);
<a name='L367'>    <b>if</b> (p == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L368'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L369'>
<a name='L370'>    <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../S/2252.html#L73' title='Defined at 73 in Modules/_ctypes/ctypes.h.'>CThunk_CheckExact</a>((<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *)p));
<a name='L371'>
<a name='L372'>    p-&gt;pcl_write = <a href='../D/8481.html' title='Multiple defined in 3 places.'>ffi_closure_alloc</a>(<b>sizeof</b>(<a href='../D/8478.html' title='Multiple defined in 4 places.'>ffi_closure</a>),
<a name='L373'>                                                                         &amp;p-&gt;pcl_exec);
<a name='L374'>    <b>if</b> (p-&gt;pcl_write == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L375'>        <a href='../S/3106.html#L334' title='Defined at 334 in Python/errors.c.'>PyErr_NoMemory</a>();
<a name='L376'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L377'>    <font color='red'>}</font>
<a name='L378'>
<a name='L379'>    p-&gt;<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> = <a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a>;
<a name='L380'>    <b>for</b> (i = 0; i &lt; nArgs; ++i) <font color='red'>{</font>
<a name='L381'>        <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *cnv = <a href='../S/2775.html#L1584' title='Defined at 1584 in Objects/abstract.c.'>PySequence_GetItem</a>(converters, i);
<a name='L382'>        <b>if</b> (cnv == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L383'>            <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L384'>        p-&gt;atypes[i] = <a href='../S/2250.html#L704' title='Defined at 704 in Modules/_ctypes/callproc.c.'>_ctypes_get_ffi_type</a>(cnv);
<a name='L385'>        Py_DECREF(cnv);
<a name='L386'>    <font color='red'>}</font>
<a name='L387'>    p-&gt;atypes[i] = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L388'>
<a name='L389'>    Py_INCREF(restype);
<a name='L390'>    p-&gt;restype = restype;
<a name='L391'>    <b>if</b> (restype == Py_None) <font color='red'>{</font>
<a name='L392'>        p-&gt;setfunc = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L393'>        p-&gt;ffi_restype = &amp;ffi_type_void;
<a name='L394'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L395'>        <a href='../S/2252.html#L219' title='Defined at 219 in Modules/_ctypes/ctypes.h.'>StgDictObject</a> *dict = <a href='../S/2557.html#L149' title='Defined at 149 in Modules/_ctypes/stgdict.c.'>PyType_stgdict</a>(restype);
<a name='L396'>        <b>if</b> (dict == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> || dict-&gt;setfunc == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L397'>          <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_TypeError,
<a name='L398'>                          "invalid result type for callback function");
<a name='L399'>          <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L400'>        <font color='red'>}</font>
<a name='L401'>        p-&gt;setfunc = dict-&gt;setfunc;
<a name='L402'>        p-&gt;ffi_restype = &amp;dict-&gt;ffi_type_pointer;
<a name='L403'>    <font color='red'>}</font>
<a name='L404'>
<a name='L405'>    cc = <a href='../D/1131.html' title='Multiple defined in 63 places.'>FFI_DEFAULT_ABI</a>;
<a name='L406'><font color='darkred'>#if</font> <b>defined</b>(<a href='../S/2906.html#L80' title='Defined at 80 in PC/pyconfig.h.'>MS_WIN32</a>) &amp;&amp; !<b>defined</b>(_WIN32_WCE) &amp;&amp; !<b>defined</b>(<a href='../S/2906.html#L142' title='Defined at 142 in PC/pyconfig.h.'>MS_WIN64</a>)
<a name='L407'>    <b>if</b> ((<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> &amp; <a href='../S/2252.html#L284' title='Defined at 284 in Modules/_ctypes/ctypes.h.'>FUNCFLAG_CDECL</a>) == 0)
<a name='L408'>        cc = <a href='../D/1171.html' title='Multiple defined in 3 places.'>FFI_STDCALL</a>;
<a name='L409'><font color='darkred'>#endif</font>
<a name='L410'>    <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = <a href='../D/8512.html' title='Multiple defined in 5 places.'>ffi_prep_cif</a>(&amp;p-&gt;cif, cc,
<a name='L411'>                          <a href='../D/4230.html' title='Multiple defined in 2 places.'>Py_SAFE_DOWNCAST</a>(nArgs, <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a>, <b>int</b>),
<a name='L412'>                          <a href='../S/2250.html#L704' title='Defined at 704 in Modules/_ctypes/callproc.c.'>_ctypes_get_ffi_type</a>(restype),
<a name='L413'>                          &amp;p-&gt;atypes[0]);
<a name='L414'>    <b>if</b> (<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> != <a href='../D/1165.html' title='Multiple defined in 3 places.'>FFI_OK</a>) <font color='red'>{</font>
<a name='L415'>        <a href='../S/3106.html#L600' title='Defined at 600 in Python/errors.c.'>PyErr_Format</a>(PyExc_RuntimeError,
<a name='L416'>                     "ffi_prep_cif failed with %d", <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>);
<a name='L417'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L418'>    <font color='red'>}</font>
<a name='L419'><font color='darkred'>#if</font> <b>defined</b>(<a href='../S/2537.html#L61' title='Defined at 61 in Modules/_ctypes/libffi_osx/include/ffi.h.'>X86_DARWIN</a>) || <b>defined</b>(<a href='../S/2537.html#L63' title='Defined at 63 in Modules/_ctypes/libffi_osx/include/ffi.h.'>POWERPC_DARWIN</a>)
<a name='L420'>    <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = <a href='../D/8514.html' title='Multiple defined in 5 places.'>ffi_prep_closure</a>(p-&gt;pcl_write, &amp;p-&gt;cif, <a href='../S/2249.html#L314' title='Defined at 314 in Modules/_ctypes/callbacks.c.'>closure_fcn</a>, p);
<a name='L421'><font color='darkred'>#else</font>
<a name='L422'>    <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = <a href='../D/8516.html' title='Multiple defined in 19 places.'>ffi_prep_closure_loc</a>(p-&gt;pcl_write, &amp;p-&gt;cif, <a href='../S/2249.html#L314' title='Defined at 314 in Modules/_ctypes/callbacks.c.'>closure_fcn</a>,
<a name='L423'>                                  p,
<a name='L424'>                                  p-&gt;pcl_exec);
<a name='L425'><font color='darkred'>#endif</font>
<a name='L426'>    <b>if</b> (<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> != <a href='../D/1165.html' title='Multiple defined in 3 places.'>FFI_OK</a>) <font color='red'>{</font>
<a name='L427'>        <a href='../S/3106.html#L600' title='Defined at 600 in Python/errors.c.'>PyErr_Format</a>(PyExc_RuntimeError,
<a name='L428'>                     "ffi_prep_closure failed with %d", <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>);
<a name='L429'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L430'>    <font color='red'>}</font>
<a name='L431'>
<a name='L432'>    Py_INCREF(converters);
<a name='L433'>    p-&gt;converters = converters;
<a name='L434'>    Py_INCREF(callable);
<a name='L435'>    p-&gt;callable = callable;
<a name='L436'>    <b>return</b> p;
<a name='L437'>
<a name='L438'>  <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>:
<a name='L439'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(p);
<a name='L440'>    <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L441'><font color='red'>}</font>
<a name='L442'>
<a name='L443'><font color='darkred'>#ifdef</font> <a href='../S/2906.html#L80' title='Defined at 80 in PC/pyconfig.h.'>MS_WIN32</a>
<a name='L444'>
<a name='L445'><b>static</b> <b>void</b> <a href='../S/2249.html#L525' title='Refered from 525 in Modules/_ctypes/callbacks.c.'>LoadPython</a>(<b>void</b>)
<a name='L446'><font color='red'>{</font>
<a name='L447'>    <b>if</b> (!<a href='../S/3138.html#L106' title='Defined at 106 in Python/pythonrun.c.'>Py_IsInitialized</a>()) <font color='red'>{</font>
<a name='L448'><font color='darkred'>#ifdef</font> <a href='../D/5537.html' title='Multiple defined in 3 places.'>WITH_THREAD</a>
<a name='L449'>        <a href='../S/3091.html#L304' title='Defined at 304 in Python/ceval.c.'>PyEval_InitThreads</a>();
<a name='L450'><font color='darkred'>#endif</font>
<a name='L451'>        <a href='../S/3138.html#L319' title='Defined at 319 in Python/pythonrun.c.'>Py_Initialize</a>();
<a name='L452'>    <font color='red'>}</font>
<a name='L453'><font color='red'>}</font>
<a name='L454'>
<a name='L455'><i><font color='green'>/******************************************************************/</font></i>
<a name='L456'>
<a name='L457'><b>long</b> <a href='../S/2249.html#L529' title='Refered from 529 in Modules/_ctypes/callbacks.c.'>Call_GetClassObject</a>(REFCLSID rclsid, REFIID riid, LPVOID *ppv)
<a name='L458'><font color='red'>{</font>
<a name='L459'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *mod, *func, *<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L460'>    <b>long</b> retval;
<a name='L461'>    <b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *context;
<a name='L462'>
<a name='L463'>    <b>if</b> (context == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L464'>        context = <a href='../S/2828.html#L10060' title='Defined at 10060 in Objects/unicodeobject.c.'>PyUnicode_InternFromString</a>("_ctypes.DllGetClassObject");
<a name='L465'>
<a name='L466'>    mod = <a href='../S/3120.html#L2348' title='Defined at 2348 in Python/import.c.'>PyImport_ImportModuleNoBlock</a>("ctypes");
<a name='L467'>    <b>if</b> (!mod) <font color='red'>{</font>
<a name='L468'>        <a href='../S/3106.html#L708' title='Defined at 708 in Python/errors.c.'>PyErr_WriteUnraisable</a>(context ? context : Py_None);
<a name='L469'>        <i><font color='green'>/* There has been a warning before about this already */</font></i>
<a name='L470'>        <b>return</b> E_FAIL;
<a name='L471'>    <font color='red'>}</font>
<a name='L472'>
<a name='L473'>    func = <a href='../S/2803.html#L779' title='Defined at 779 in Objects/object.c.'>PyObject_GetAttrString</a>(mod, "DllGetClassObject");
<a name='L474'>    Py_DECREF(mod);
<a name='L475'>    <b>if</b> (!func) <font color='red'>{</font>
<a name='L476'>        <a href='../S/3106.html#L708' title='Defined at 708 in Python/errors.c.'>PyErr_WriteUnraisable</a>(context ? context : Py_None);
<a name='L477'>        <b>return</b> E_FAIL;
<a name='L478'>    <font color='red'>}</font>
<a name='L479'>
<a name='L480'>    <font color='red'>{</font>
<a name='L481'>        <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *py_rclsid = <a href='../S/2799.html#L929' title='Defined at 929 in Objects/longobject.c.'>PyLong_FromVoidPtr</a>((<b>void</b> *)rclsid);
<a name='L482'>        <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *py_riid = <a href='../S/2799.html#L929' title='Defined at 929 in Objects/longobject.c.'>PyLong_FromVoidPtr</a>((<b>void</b> *)riid);
<a name='L483'>        <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *py_ppv = <a href='../S/2799.html#L929' title='Defined at 929 in Objects/longobject.c.'>PyLong_FromVoidPtr</a>(ppv);
<a name='L484'>        <b>if</b> (!py_rclsid || !py_riid || !py_ppv) <font color='red'>{</font>
<a name='L485'>            <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(py_rclsid);
<a name='L486'>            <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(py_riid);
<a name='L487'>            <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(py_ppv);
<a name='L488'>            Py_DECREF(func);
<a name='L489'>            <a href='../S/3106.html#L708' title='Defined at 708 in Python/errors.c.'>PyErr_WriteUnraisable</a>(context ? context : Py_None);
<a name='L490'>            <b>return</b> E_FAIL;
<a name='L491'>        <font color='red'>}</font>
<a name='L492'>        <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = <a href='../S/2775.html#L2358' title='Defined at 2358 in Objects/abstract.c.'>PyObject_CallFunctionObjArgs</a>(func,
<a name='L493'>                                              py_rclsid,
<a name='L494'>                                              py_riid,
<a name='L495'>                                              py_ppv,
<a name='L496'>                                              <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L497'>        Py_DECREF(py_rclsid);
<a name='L498'>        Py_DECREF(py_riid);
<a name='L499'>        Py_DECREF(py_ppv);
<a name='L500'>    <font color='red'>}</font>
<a name='L501'>    Py_DECREF(func);
<a name='L502'>    <b>if</b> (!<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>) <font color='red'>{</font>
<a name='L503'>        <a href='../S/3106.html#L708' title='Defined at 708 in Python/errors.c.'>PyErr_WriteUnraisable</a>(context ? context : Py_None);
<a name='L504'>        <b>return</b> E_FAIL;
<a name='L505'>    <font color='red'>}</font>
<a name='L506'>
<a name='L507'>    retval = <a href='../S/2799.html#L416' title='Defined at 416 in Objects/longobject.c.'>PyLong_AsLong</a>(<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>);
<a name='L508'>    <b>if</b> (<a href='../D/3154.html' title='Multiple defined in 2 places.'>PyErr_Occurred</a>()) <font color='red'>{</font>
<a name='L509'>        <a href='../S/3106.html#L708' title='Defined at 708 in Python/errors.c.'>PyErr_WriteUnraisable</a>(context ? context : Py_None);
<a name='L510'>        retval = E_FAIL;
<a name='L511'>    <font color='red'>}</font>
<a name='L512'>    Py_DECREF(<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>);
<a name='L513'>    <b>return</b> retval;
<a name='L514'><font color='red'>}</font>
<a name='L515'>
<a name='L516'>STDAPI DllGetClassObject(REFCLSID rclsid,
<a name='L517'>                         REFIID riid,
<a name='L518'>                         LPVOID *ppv)
<a name='L519'><font color='red'>{</font>
<a name='L520'>    <b>long</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L521'><font color='darkred'>#ifdef</font> <a href='../D/5537.html' title='Multiple defined in 3 places.'>WITH_THREAD</a>
<a name='L522'>    PyGILState_STATE <a href='../S/530.html#L46' title='Defined at 46 in Include/grammar.h.'>state</a>;
<a name='L523'><font color='darkred'>#endif</font>
<a name='L524'>
<a name='L525'>    <a href='../S/2249.html#L445' title='Defined at 445 in Modules/_ctypes/callbacks.c.'>LoadPython</a>();
<a name='L526'><font color='darkred'>#ifdef</font> <a href='../D/5537.html' title='Multiple defined in 3 places.'>WITH_THREAD</a>
<a name='L527'>    <a href='../S/530.html#L46' title='Defined at 46 in Include/grammar.h.'>state</a> = <a href='../S/3134.html#L633' title='Defined at 633 in Python/pystate.c.'>PyGILState_Ensure</a>();
<a name='L528'><font color='darkred'>#endif</font>
<a name='L529'>    <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = <a href='../S/2249.html#L457' title='Defined at 457 in Modules/_ctypes/callbacks.c.'>Call_GetClassObject</a>(rclsid, riid, ppv);
<a name='L530'><font color='darkred'>#ifdef</font> <a href='../D/5537.html' title='Multiple defined in 3 places.'>WITH_THREAD</a>
<a name='L531'>    <a href='../S/3134.html#L668' title='Defined at 668 in Python/pystate.c.'>PyGILState_Release</a>(<a href='../S/530.html#L46' title='Defined at 46 in Include/grammar.h.'>state</a>);
<a name='L532'><font color='darkred'>#endif</font>
<a name='L533'>    <b>return</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L534'><font color='red'>}</font>
<a name='L535'>
<a name='L536'><b>long</b> <a href='../S/2249.html#L587' title='Refered from 587 in Modules/_ctypes/callbacks.c.'>Call_CanUnloadNow</a>(<b>void</b>)
<a name='L537'><font color='red'>{</font>
<a name='L538'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *mod, *func, *<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L539'>    <b>long</b> retval;
<a name='L540'>    <b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *context;
<a name='L541'>
<a name='L542'>    <b>if</b> (context == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L543'>        context = <a href='../S/2828.html#L10060' title='Defined at 10060 in Objects/unicodeobject.c.'>PyUnicode_InternFromString</a>("_ctypes.DllCanUnloadNow");
<a name='L544'>
<a name='L545'>    mod = <a href='../S/3120.html#L2348' title='Defined at 2348 in Python/import.c.'>PyImport_ImportModuleNoBlock</a>("ctypes");
<a name='L546'>    <b>if</b> (!mod) <font color='red'>{</font>
<a name='L547'><i><font color='green'>/*              OutputDebugString("Could not import ctypes"); */</font></i>
<a name='L548'>        <i><font color='green'>/* We assume that this error can only occur when shutting</font></i>
<a name='L549'><i><font color='green'>           down, so we silently ignore it */</font></i>
<a name='L550'>        <a href='../S/3106.html#L318' title='Defined at 318 in Python/errors.c.'>PyErr_Clear</a>();
<a name='L551'>        <b>return</b> E_FAIL;
<a name='L552'>    <font color='red'>}</font>
<a name='L553'>    <i><font color='green'>/* Other errors cannot be raised, but are printed to stderr */</font></i>
<a name='L554'>    func = <a href='../S/2803.html#L779' title='Defined at 779 in Objects/object.c.'>PyObject_GetAttrString</a>(mod, "DllCanUnloadNow");
<a name='L555'>    Py_DECREF(mod);
<a name='L556'>    <b>if</b> (!func) <font color='red'>{</font>
<a name='L557'>        <a href='../S/3106.html#L708' title='Defined at 708 in Python/errors.c.'>PyErr_WriteUnraisable</a>(context ? context : Py_None);
<a name='L558'>        <b>return</b> E_FAIL;
<a name='L559'>    <font color='red'>}</font>
<a name='L560'>
<a name='L561'>    <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = <a href='../D/3601.html' title='Multiple defined in 2 places.'>PyObject_CallFunction</a>(func, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L562'>    Py_DECREF(func);
<a name='L563'>    <b>if</b> (!<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>) <font color='red'>{</font>
<a name='L564'>        <a href='../S/3106.html#L708' title='Defined at 708 in Python/errors.c.'>PyErr_WriteUnraisable</a>(context ? context : Py_None);
<a name='L565'>        <b>return</b> E_FAIL;
<a name='L566'>    <font color='red'>}</font>
<a name='L567'>
<a name='L568'>    retval = <a href='../S/2799.html#L416' title='Defined at 416 in Objects/longobject.c.'>PyLong_AsLong</a>(<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>);
<a name='L569'>    <b>if</b> (<a href='../D/3154.html' title='Multiple defined in 2 places.'>PyErr_Occurred</a>()) <font color='red'>{</font>
<a name='L570'>        <a href='../S/3106.html#L708' title='Defined at 708 in Python/errors.c.'>PyErr_WriteUnraisable</a>(context ? context : Py_None);
<a name='L571'>        retval = E_FAIL;
<a name='L572'>    <font color='red'>}</font>
<a name='L573'>    Py_DECREF(<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>);
<a name='L574'>    <b>return</b> retval;
<a name='L575'><font color='red'>}</font>
<a name='L576'>
<a name='L577'><i><font color='green'>/*</font></i>
<a name='L578'><i><font color='green'>  DllRegisterServer and DllUnregisterServer still missing</font></i>
<a name='L579'><i><font color='green'>*/</font></i>
<a name='L580'>
<a name='L581'>STDAPI DllCanUnloadNow(<b>void</b>)
<a name='L582'><font color='red'>{</font>
<a name='L583'>    <b>long</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L584'><font color='darkred'>#ifdef</font> <a href='../D/5537.html' title='Multiple defined in 3 places.'>WITH_THREAD</a>
<a name='L585'>    PyGILState_STATE <a href='../S/530.html#L46' title='Defined at 46 in Include/grammar.h.'>state</a> = <a href='../S/3134.html#L633' title='Defined at 633 in Python/pystate.c.'>PyGILState_Ensure</a>();
<a name='L586'><font color='darkred'>#endif</font>
<a name='L587'>    <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = <a href='../S/2249.html#L536' title='Defined at 536 in Modules/_ctypes/callbacks.c.'>Call_CanUnloadNow</a>();
<a name='L588'><font color='darkred'>#ifdef</font> <a href='../D/5537.html' title='Multiple defined in 3 places.'>WITH_THREAD</a>
<a name='L589'>    <a href='../S/3134.html#L668' title='Defined at 668 in Python/pystate.c.'>PyGILState_Release</a>(<a href='../S/530.html#L46' title='Defined at 46 in Include/grammar.h.'>state</a>);
<a name='L590'><font color='darkred'>#endif</font>
<a name='L591'>    <b>return</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L592'><font color='red'>}</font>
<a name='L593'>
<a name='L594'><font color='darkred'>#ifndef</font> Py_NO_ENABLE_SHARED
<a name='L595'><a href='../S/2583.html#L42' title='Defined at 42 in Modules/_multiprocessing/multiprocessing.h.'>BOOL</a> WINAPI DllMain(HINSTANCE hinstDLL, DWORD fdwReason, LPVOID lpvRes)
<a name='L596'><font color='red'>{</font>
<a name='L597'>    <b>switch</b>(fdwReason) <font color='red'>{</font>
<a name='L598'>    <b>case</b> DLL_PROCESS_ATTACH:
<a name='L599'>        DisableThreadLibraryCalls(hinstDLL);
<a name='L600'>        <b>break</b>;
<a name='L601'>    <font color='red'>}</font>
<a name='L602'>    <b>return</b> <a href='../D/5177.html' title='Multiple defined in 3 places.'>TRUE</a>;
<a name='L603'><font color='red'>}</font>
<a name='L604'><font color='darkred'>#endif</font>
<a name='L605'>
<a name='L606'><font color='darkred'>#endif</font>
<a name='L607'>
<a name='L608'><i><font color='green'>/*</font></i>
<a name='L609'><i><font color='green'> Local Variables:</font></i>
<a name='L610'><i><font color='green'> compile-command: "cd .. &amp;&amp; python setup.py -q build_ext"</font></i>
<a name='L611'><i><font color='green'> End:</font></i>
<a name='L612'><i><font color='green'>*/</font></i>
</pre>
<hr>
<a name='BOTTOM'>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L13'>[^]</a><a href='#L595'>[v]</a><a href='#TOP'>[top]</a>[bottom]<a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
</body>
</html>
