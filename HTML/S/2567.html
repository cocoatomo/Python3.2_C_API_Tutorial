<html>
<head>
<title>Modules/_heapqmodule.c</title>
<meta name='robots' content='noindex,nofollow'>
<meta name='generator' content='GLOBAL-5.8.1'>
</head>
<body text='#191970' bgcolor='#f5f5dc' vlink='gray'>
<a name='TOP'><h2><a href='../mains.html'>root</a>/<a href='../files/3353.html'>Modules</a>/_heapqmodule.c</h2>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L12'>[^]</a><a href='#L679'>[v]</a>[top]<a href='#BOTTOM'>[bottom]</a><a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
<hr>
<h2>DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href='#L12' title='Defined at 12.'>_siftdown</a>
<li><a href='#L49' title='Defined at 49.'>_siftup</a>
<li><a href='#L99' title='Defined at 99.'>heappush</a>
<li><a href='#L124' title='Defined at 124.'>heappop</a>
<li><a href='#L161' title='Defined at 161.'>heapreplace</a>
<li><a href='#L199' title='Defined at 199.'>heappushpop</a>
<li><a href='#L241' title='Defined at 241.'>heapify</a>
<li><a href='#L269' title='Defined at 269.'>nlargest</a>
<li><a href='#L352' title='Defined at 352.'>_siftdownmax</a>
<li><a href='#L389' title='Defined at 389.'>_siftupmax</a>
<li><a href='#L439' title='Defined at 439.'>nsmallest</a>
<li><a href='#L679' title='Defined at 679.'>PyInit__heapq</a>
</ol>
<hr>
<pre>
<a name='L1'><i><font color='green'>/* Drop in replacement for heapq.py</font></i>
<a name='L2'><i><font color='green'></font></i>
<a name='L3'><i><font color='green'>C implementation derived directly from heapq.py in Py2.3</font></i>
<a name='L4'><i><font color='green'>which was written by Kevin O'Connor, augmented by Tim Peters,</font></i>
<a name='L5'><i><font color='green'>annotated by Fran√ßois Pinard, and converted to C by Raymond Hettinger.</font></i>
<a name='L6'><i><font color='green'></font></i>
<a name='L7'><i><font color='green'>*/</font></i>
<a name='L8'>
<a name='L9'><font color='darkred'>#include</font> "<a href='570.html'>Python.h</a>"
<a name='L10'>
<a name='L11'><b>static</b> <b>int</b>
<a name='L12'><a href='../R/5843.html' title='Multiple refered from 2 places.'>_siftdown</a>(PyListObject *heap, <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> startpos, <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> pos)
<a name='L13'><font color='red'>{</font>
<a name='L14'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *newitem, *parent;
<a name='L15'>    <b>int</b> <a href='../S/3095.html#L873' title='Defined at 873 in Python/dtoa.c.'>cmp</a>;
<a name='L16'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> parentpos;
<a name='L17'>
<a name='L18'>    <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(PyList_Check(heap));
<a name='L19'>    <b>if</b> (pos &gt;= <a href='../S/534.html#L71' title='Defined at 71 in Include/listobject.h.'>PyList_GET_SIZE</a>(heap)) <font color='red'>{</font>
<a name='L20'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_IndexError, "index out of range");
<a name='L21'>        <b>return</b> -1;
<a name='L22'>    <font color='red'>}</font>
<a name='L23'>
<a name='L24'>    newitem = PyList_GET_ITEM(heap, pos);
<a name='L25'>    Py_INCREF(newitem);
<a name='L26'>    <i><font color='green'>/* Follow the path to the root, moving parents down until finding</font></i>
<a name='L27'><i><font color='green'>       a place newitem fits. */</font></i>
<a name='L28'>    <b>while</b> (pos &gt; startpos)<font color='red'>{</font>
<a name='L29'>        parentpos = (pos - 1) &gt;&gt; 1;
<a name='L30'>        parent = PyList_GET_ITEM(heap, parentpos);
<a name='L31'>        <a href='../S/3095.html#L873' title='Defined at 873 in Python/dtoa.c.'>cmp</a> = <a href='../S/2803.html#L607' title='Defined at 607 in Objects/object.c.'>PyObject_RichCompareBool</a>(newitem, parent, <a href='../S/546.html#L151' title='Defined at 151 in Include/opcode.h.'>Py_LT</a>);
<a name='L32'>        <b>if</b> (<a href='../S/3095.html#L873' title='Defined at 873 in Python/dtoa.c.'>cmp</a> == -1) <font color='red'>{</font>
<a name='L33'>            Py_DECREF(newitem);
<a name='L34'>            <b>return</b> -1;
<a name='L35'>        <font color='red'>}</font>
<a name='L36'>        <b>if</b> (<a href='../S/3095.html#L873' title='Defined at 873 in Python/dtoa.c.'>cmp</a> == 0)
<a name='L37'>            <b>break</b>;
<a name='L38'>        Py_INCREF(parent);
<a name='L39'>        Py_DECREF(PyList_GET_ITEM(heap, pos));
<a name='L40'>        PyList_SET_ITEM(heap, pos, parent);
<a name='L41'>        pos = parentpos;
<a name='L42'>    <font color='red'>}</font>
<a name='L43'>    Py_DECREF(PyList_GET_ITEM(heap, pos));
<a name='L44'>    PyList_SET_ITEM(heap, pos, newitem);
<a name='L45'>    <b>return</b> 0;
<a name='L46'><font color='red'>}</font>
<a name='L47'>
<a name='L48'><b>static</b> <b>int</b>
<a name='L49'><a href='../R/5845.html' title='Multiple refered from 6 places.'>_siftup</a>(PyListObject *heap, <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> pos)
<a name='L50'><font color='red'>{</font>
<a name='L51'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> startpos, endpos, childpos, rightpos;
<a name='L52'>    <b>int</b> <a href='../S/3095.html#L873' title='Defined at 873 in Python/dtoa.c.'>cmp</a>;
<a name='L53'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *newitem, *tmp;
<a name='L54'>
<a name='L55'>    <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(PyList_Check(heap));
<a name='L56'>    endpos = <a href='../S/534.html#L71' title='Defined at 71 in Include/listobject.h.'>PyList_GET_SIZE</a>(heap);
<a name='L57'>    startpos = pos;
<a name='L58'>    <b>if</b> (pos &gt;= endpos) <font color='red'>{</font>
<a name='L59'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_IndexError, "index out of range");
<a name='L60'>        <b>return</b> -1;
<a name='L61'>    <font color='red'>}</font>
<a name='L62'>    newitem = PyList_GET_ITEM(heap, pos);
<a name='L63'>    Py_INCREF(newitem);
<a name='L64'>
<a name='L65'>    <i><font color='green'>/* Bubble up the smaller child until hitting a leaf. */</font></i>
<a name='L66'>    childpos = 2*pos + 1;    <i><font color='green'>/* leftmost child position  */</font></i>
<a name='L67'>    <b>while</b> (childpos &lt; endpos) <font color='red'>{</font>
<a name='L68'>        <i><font color='green'>/* Set childpos to index of smaller child.   */</font></i>
<a name='L69'>        rightpos = childpos + 1;
<a name='L70'>        <b>if</b> (rightpos &lt; endpos) <font color='red'>{</font>
<a name='L71'>            <a href='../S/3095.html#L873' title='Defined at 873 in Python/dtoa.c.'>cmp</a> = <a href='../S/2803.html#L607' title='Defined at 607 in Objects/object.c.'>PyObject_RichCompareBool</a>(
<a name='L72'>                PyList_GET_ITEM(heap, childpos),
<a name='L73'>                PyList_GET_ITEM(heap, rightpos),
<a name='L74'>                <a href='../S/546.html#L151' title='Defined at 151 in Include/opcode.h.'>Py_LT</a>);
<a name='L75'>            <b>if</b> (<a href='../S/3095.html#L873' title='Defined at 873 in Python/dtoa.c.'>cmp</a> == -1) <font color='red'>{</font>
<a name='L76'>                Py_DECREF(newitem);
<a name='L77'>                <b>return</b> -1;
<a name='L78'>            <font color='red'>}</font>
<a name='L79'>            <b>if</b> (<a href='../S/3095.html#L873' title='Defined at 873 in Python/dtoa.c.'>cmp</a> == 0)
<a name='L80'>                childpos = rightpos;
<a name='L81'>        <font color='red'>}</font>
<a name='L82'>        <i><font color='green'>/* Move the smaller child up. */</font></i>
<a name='L83'>        tmp = PyList_GET_ITEM(heap, childpos);
<a name='L84'>        Py_INCREF(tmp);
<a name='L85'>        Py_DECREF(PyList_GET_ITEM(heap, pos));
<a name='L86'>        PyList_SET_ITEM(heap, pos, tmp);
<a name='L87'>        pos = childpos;
<a name='L88'>        childpos = 2*pos + 1;
<a name='L89'>    <font color='red'>}</font>
<a name='L90'>
<a name='L91'>    <i><font color='green'>/* The leaf at pos is empty now.  Put newitem there, and and bubble</font></i>
<a name='L92'><i><font color='green'>       it up to its final resting place (by sifting its parents down). */</font></i>
<a name='L93'>    Py_DECREF(PyList_GET_ITEM(heap, pos));
<a name='L94'>    PyList_SET_ITEM(heap, pos, newitem);
<a name='L95'>    <b>return</b> <a href='../S/2567.html#L12' title='Defined at 12 in Modules/_heapqmodule.c.'>_siftdown</a>(heap, startpos, pos);
<a name='L96'><font color='red'>}</font>
<a name='L97'>
<a name='L98'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L99'><a href='../S/2567.html#L523' title='Refered from 523 in Modules/_heapqmodule.c.'>heappush</a>(PyObject *self, PyObject *args)
<a name='L100'><font color='red'>{</font>
<a name='L101'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *heap, *item;
<a name='L102'>
<a name='L103'>    <b>if</b> (!<a href='../S/3112.html#L1712' title='Defined at 1712 in Python/getargs.c.'>PyArg_UnpackTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "heappush", 2, 2, &amp;heap, &amp;item))
<a name='L104'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L105'>
<a name='L106'>    <b>if</b> (!PyList_Check(heap)) <font color='red'>{</font>
<a name='L107'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_TypeError, "heap argument must be a list");
<a name='L108'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L109'>    <font color='red'>}</font>
<a name='L110'>
<a name='L111'>    <b>if</b> (<a href='../S/2796.html#L286' title='Defined at 286 in Objects/listobject.c.'>PyList_Append</a>(heap, item) == -1)
<a name='L112'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L113'>
<a name='L114'>    <b>if</b> (<a href='../S/2567.html#L12' title='Defined at 12 in Modules/_heapqmodule.c.'>_siftdown</a>((<a href='../S/534.html#L40' title='Defined at 40 in Include/listobject.h.'>PyListObject</a> *)heap, 0, <a href='../S/534.html#L71' title='Defined at 71 in Include/listobject.h.'>PyList_GET_SIZE</a>(heap)-1) == -1)
<a name='L115'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L116'>    Py_INCREF(Py_None);
<a name='L117'>    <b>return</b> Py_None;
<a name='L118'><font color='red'>}</font>
<a name='L119'>
<a name='L120'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(heappush_doc,
<a name='L121'>"Push item onto heap, maintaining the heap invariant.");
<a name='L122'>
<a name='L123'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L124'><a href='../S/2567.html#L527' title='Refered from 527 in Modules/_heapqmodule.c.'>heappop</a>(PyObject *self, PyObject *heap)
<a name='L125'><font color='red'>{</font>
<a name='L126'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *lastelt, *returnitem;
<a name='L127'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> n;
<a name='L128'>
<a name='L129'>    <b>if</b> (!PyList_Check(heap)) <font color='red'>{</font>
<a name='L130'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_TypeError, "heap argument must be a list");
<a name='L131'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L132'>    <font color='red'>}</font>
<a name='L133'>
<a name='L134'>    <i><font color='green'>/* # raises appropriate IndexError if heap is empty */</font></i>
<a name='L135'>    n = <a href='../S/534.html#L71' title='Defined at 71 in Include/listobject.h.'>PyList_GET_SIZE</a>(heap);
<a name='L136'>    <b>if</b> (n == 0) <font color='red'>{</font>
<a name='L137'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_IndexError, "index out of range");
<a name='L138'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L139'>    <font color='red'>}</font>
<a name='L140'>
<a name='L141'>    lastelt = PyList_GET_ITEM(heap, n-1) ;
<a name='L142'>    Py_INCREF(lastelt);
<a name='L143'>    <a href='../S/2796.html#L671' title='Defined at 671 in Objects/listobject.c.'>PyList_SetSlice</a>(heap, n-1, n, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L144'>    n--;
<a name='L145'>
<a name='L146'>    <b>if</b> (!n)
<a name='L147'>        <b>return</b> lastelt;
<a name='L148'>    returnitem = PyList_GET_ITEM(heap, 0);
<a name='L149'>    PyList_SET_ITEM(heap, 0, lastelt);
<a name='L150'>    <b>if</b> (<a href='../S/2567.html#L49' title='Defined at 49 in Modules/_heapqmodule.c.'>_siftup</a>((<a href='../S/534.html#L40' title='Defined at 40 in Include/listobject.h.'>PyListObject</a> *)heap, 0) == -1) <font color='red'>{</font>
<a name='L151'>        Py_DECREF(returnitem);
<a name='L152'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L153'>    <font color='red'>}</font>
<a name='L154'>    <b>return</b> returnitem;
<a name='L155'><font color='red'>}</font>
<a name='L156'>
<a name='L157'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(heappop_doc,
<a name='L158'>"Pop the smallest item off the heap, maintaining the heap invariant.");
<a name='L159'>
<a name='L160'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L161'><a href='../S/2567.html#L529' title='Refered from 529 in Modules/_heapqmodule.c.'>heapreplace</a>(PyObject *self, PyObject *args)
<a name='L162'><font color='red'>{</font>
<a name='L163'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *heap, *item, *returnitem;
<a name='L164'>
<a name='L165'>    <b>if</b> (!<a href='../S/3112.html#L1712' title='Defined at 1712 in Python/getargs.c.'>PyArg_UnpackTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "heapreplace", 2, 2, &amp;heap, &amp;item))
<a name='L166'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L167'>
<a name='L168'>    <b>if</b> (!PyList_Check(heap)) <font color='red'>{</font>
<a name='L169'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_TypeError, "heap argument must be a list");
<a name='L170'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L171'>    <font color='red'>}</font>
<a name='L172'>
<a name='L173'>    <b>if</b> (<a href='../S/534.html#L71' title='Defined at 71 in Include/listobject.h.'>PyList_GET_SIZE</a>(heap) &lt; 1) <font color='red'>{</font>
<a name='L174'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_IndexError, "index out of range");
<a name='L175'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L176'>    <font color='red'>}</font>
<a name='L177'>
<a name='L178'>    returnitem = PyList_GET_ITEM(heap, 0);
<a name='L179'>    Py_INCREF(item);
<a name='L180'>    PyList_SET_ITEM(heap, 0, item);
<a name='L181'>    <b>if</b> (<a href='../S/2567.html#L49' title='Defined at 49 in Modules/_heapqmodule.c.'>_siftup</a>((<a href='../S/534.html#L40' title='Defined at 40 in Include/listobject.h.'>PyListObject</a> *)heap, 0) == -1) <font color='red'>{</font>
<a name='L182'>        Py_DECREF(returnitem);
<a name='L183'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L184'>    <font color='red'>}</font>
<a name='L185'>    <b>return</b> returnitem;
<a name='L186'><font color='red'>}</font>
<a name='L187'>
<a name='L188'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(heapreplace_doc,
<a name='L189'>"Pop and return the current smallest value, and add the new item.\n\
<a name='L190'>\n\
<a name='L191'>This is more efficient than heappop() followed by heappush(), and can be\n\
<a name='L192'>more appropriate when using a fixed-size heap.  Note that the value\n\
<a name='L193'>returned may be larger than item!  That constrains reasonable uses of\n\
<a name='L194'>this routine unless written as part of a conditional replacement:\n\n\
<a name='L195'>    if item &gt; heap[0]:\n\
<a name='L196'>        item = heapreplace(heap, item)\n");
<a name='L197'>
<a name='L198'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L199'><a href='../S/2567.html#L525' title='Refered from 525 in Modules/_heapqmodule.c.'>heappushpop</a>(PyObject *self, PyObject *args)
<a name='L200'><font color='red'>{</font>
<a name='L201'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *heap, *item, *returnitem;
<a name='L202'>    <b>int</b> <a href='../S/3095.html#L873' title='Defined at 873 in Python/dtoa.c.'>cmp</a>;
<a name='L203'>
<a name='L204'>    <b>if</b> (!<a href='../S/3112.html#L1712' title='Defined at 1712 in Python/getargs.c.'>PyArg_UnpackTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "heappushpop", 2, 2, &amp;heap, &amp;item))
<a name='L205'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L206'>
<a name='L207'>    <b>if</b> (!PyList_Check(heap)) <font color='red'>{</font>
<a name='L208'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_TypeError, "heap argument must be a list");
<a name='L209'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L210'>    <font color='red'>}</font>
<a name='L211'>
<a name='L212'>    <b>if</b> (<a href='../S/534.html#L71' title='Defined at 71 in Include/listobject.h.'>PyList_GET_SIZE</a>(heap) &lt; 1) <font color='red'>{</font>
<a name='L213'>        Py_INCREF(item);
<a name='L214'>        <b>return</b> item;
<a name='L215'>    <font color='red'>}</font>
<a name='L216'>
<a name='L217'>    <a href='../S/3095.html#L873' title='Defined at 873 in Python/dtoa.c.'>cmp</a> = <a href='../S/2803.html#L607' title='Defined at 607 in Objects/object.c.'>PyObject_RichCompareBool</a>(PyList_GET_ITEM(heap, 0), item, <a href='../S/546.html#L151' title='Defined at 151 in Include/opcode.h.'>Py_LT</a>);
<a name='L218'>    <b>if</b> (<a href='../S/3095.html#L873' title='Defined at 873 in Python/dtoa.c.'>cmp</a> == -1)
<a name='L219'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L220'>    <b>if</b> (<a href='../S/3095.html#L873' title='Defined at 873 in Python/dtoa.c.'>cmp</a> == 0) <font color='red'>{</font>
<a name='L221'>        Py_INCREF(item);
<a name='L222'>        <b>return</b> item;
<a name='L223'>    <font color='red'>}</font>
<a name='L224'>
<a name='L225'>    returnitem = PyList_GET_ITEM(heap, 0);
<a name='L226'>    Py_INCREF(item);
<a name='L227'>    PyList_SET_ITEM(heap, 0, item);
<a name='L228'>    <b>if</b> (<a href='../S/2567.html#L49' title='Defined at 49 in Modules/_heapqmodule.c.'>_siftup</a>((<a href='../S/534.html#L40' title='Defined at 40 in Include/listobject.h.'>PyListObject</a> *)heap, 0) == -1) <font color='red'>{</font>
<a name='L229'>        Py_DECREF(returnitem);
<a name='L230'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L231'>    <font color='red'>}</font>
<a name='L232'>    <b>return</b> returnitem;
<a name='L233'><font color='red'>}</font>
<a name='L234'>
<a name='L235'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(heappushpop_doc,
<a name='L236'>"Push item on the heap, then pop and return the smallest item\n\
<a name='L237'>from the heap. The combined action runs more efficiently than\n\
<a name='L238'>heappush() followed by a separate call to heappop().");
<a name='L239'>
<a name='L240'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L241'><a href='../S/2567.html#L531' title='Refered from 531 in Modules/_heapqmodule.c.'>heapify</a>(PyObject *self, PyObject *heap)
<a name='L242'><font color='red'>{</font>
<a name='L243'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> i, n;
<a name='L244'>
<a name='L245'>    <b>if</b> (!PyList_Check(heap)) <font color='red'>{</font>
<a name='L246'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_TypeError, "heap argument must be a list");
<a name='L247'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L248'>    <font color='red'>}</font>
<a name='L249'>
<a name='L250'>    n = <a href='../S/534.html#L71' title='Defined at 71 in Include/listobject.h.'>PyList_GET_SIZE</a>(heap);
<a name='L251'>    <i><font color='green'>/* Transform bottom-up.  The largest index there's any point to</font></i>
<a name='L252'><i><font color='green'>       looking at is the largest with a child index in-range, so must</font></i>
<a name='L253'><i><font color='green'>       have 2*i + 1 &lt; n, or i &lt; (n-1)/2.  If n is even = 2*j, this is</font></i>
<a name='L254'><i><font color='green'>       (2*j-1)/2 = j-1/2 so j-1 is the largest, which is n//2 - 1.  If</font></i>
<a name='L255'><i><font color='green'>       n is odd = 2*j+1, this is (2*j+1-1)/2 = j so j-1 is the largest,</font></i>
<a name='L256'><i><font color='green'>       and that's again n//2-1.</font></i>
<a name='L257'><i><font color='green'>    */</font></i>
<a name='L258'>    <b>for</b> (i=n/2-1 ; i&gt;=0 ; i--)
<a name='L259'>        <b>if</b>(<a href='../S/2567.html#L49' title='Defined at 49 in Modules/_heapqmodule.c.'>_siftup</a>((<a href='../S/534.html#L40' title='Defined at 40 in Include/listobject.h.'>PyListObject</a> *)heap, i) == -1)
<a name='L260'>            <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L261'>    Py_INCREF(Py_None);
<a name='L262'>    <b>return</b> Py_None;
<a name='L263'><font color='red'>}</font>
<a name='L264'>
<a name='L265'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(heapify_doc,
<a name='L266'>"Transform list into a heap, in-place, in O(len(heap)) time.");
<a name='L267'>
<a name='L268'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L269'><a href='../S/2567.html#L533' title='Refered from 533 in Modules/_heapqmodule.c.'>nlargest</a>(PyObject *self, PyObject *args)
<a name='L270'><font color='red'>{</font>
<a name='L271'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *heap=<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, *elem, *iterable, *sol, *it, *oldelem;
<a name='L272'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> i, n;
<a name='L273'>    <b>int</b> <a href='../S/3095.html#L873' title='Defined at 873 in Python/dtoa.c.'>cmp</a>;
<a name='L274'>
<a name='L275'>    <b>if</b> (!<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "nO:nlargest", &amp;n, &amp;iterable))
<a name='L276'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L277'>
<a name='L278'>    it = <a href='../S/2775.html#L2668' title='Defined at 2668 in Objects/abstract.c.'>PyObject_GetIter</a>(iterable);
<a name='L279'>    <b>if</b> (it == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L280'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L281'>
<a name='L282'>    heap = <a href='../S/2796.html#L113' title='Defined at 113 in Objects/listobject.c.'>PyList_New</a>(0);
<a name='L283'>    <b>if</b> (heap == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L284'>        <b>goto</b> fail;
<a name='L285'>
<a name='L286'>    <b>for</b> (i=0 ; i&lt;n ; i++ )<font color='red'>{</font>
<a name='L287'>        elem = <a href='../S/2775.html#L2700' title='Defined at 2700 in Objects/abstract.c.'>PyIter_Next</a>(it);
<a name='L288'>        <b>if</b> (elem == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L289'>            <b>if</b> (<a href='../D/3154.html' title='Multiple defined in 2 places.'>PyErr_Occurred</a>())
<a name='L290'>                <b>goto</b> fail;
<a name='L291'>            <b>else</b>
<a name='L292'>                <b>goto</b> sortit;
<a name='L293'>        <font color='red'>}</font>
<a name='L294'>        <b>if</b> (<a href='../S/2796.html#L286' title='Defined at 286 in Objects/listobject.c.'>PyList_Append</a>(heap, elem) == -1) <font color='red'>{</font>
<a name='L295'>            Py_DECREF(elem);
<a name='L296'>            <b>goto</b> fail;
<a name='L297'>        <font color='red'>}</font>
<a name='L298'>        Py_DECREF(elem);
<a name='L299'>    <font color='red'>}</font>
<a name='L300'>    <b>if</b> (<a href='../S/534.html#L71' title='Defined at 71 in Include/listobject.h.'>PyList_GET_SIZE</a>(heap) == 0)
<a name='L301'>        <b>goto</b> sortit;
<a name='L302'>
<a name='L303'>    <b>for</b> (i=n/2-1 ; i&gt;=0 ; i--)
<a name='L304'>        <b>if</b>(<a href='../S/2567.html#L49' title='Defined at 49 in Modules/_heapqmodule.c.'>_siftup</a>((<a href='../S/534.html#L40' title='Defined at 40 in Include/listobject.h.'>PyListObject</a> *)heap, i) == -1)
<a name='L305'>            <b>goto</b> fail;
<a name='L306'>
<a name='L307'>    sol = PyList_GET_ITEM(heap, 0);
<a name='L308'>    <b>while</b> (1) <font color='red'>{</font>
<a name='L309'>        elem = <a href='../S/2775.html#L2700' title='Defined at 2700 in Objects/abstract.c.'>PyIter_Next</a>(it);
<a name='L310'>        <b>if</b> (elem == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L311'>            <b>if</b> (<a href='../D/3154.html' title='Multiple defined in 2 places.'>PyErr_Occurred</a>())
<a name='L312'>                <b>goto</b> fail;
<a name='L313'>            <b>else</b>
<a name='L314'>                <b>goto</b> sortit;
<a name='L315'>        <font color='red'>}</font>
<a name='L316'>        <a href='../S/3095.html#L873' title='Defined at 873 in Python/dtoa.c.'>cmp</a> = <a href='../S/2803.html#L607' title='Defined at 607 in Objects/object.c.'>PyObject_RichCompareBool</a>(sol, elem, <a href='../S/546.html#L151' title='Defined at 151 in Include/opcode.h.'>Py_LT</a>);
<a name='L317'>        <b>if</b> (<a href='../S/3095.html#L873' title='Defined at 873 in Python/dtoa.c.'>cmp</a> == -1) <font color='red'>{</font>
<a name='L318'>            Py_DECREF(elem);
<a name='L319'>            <b>goto</b> fail;
<a name='L320'>        <font color='red'>}</font>
<a name='L321'>        <b>if</b> (<a href='../S/3095.html#L873' title='Defined at 873 in Python/dtoa.c.'>cmp</a> == 0) <font color='red'>{</font>
<a name='L322'>            Py_DECREF(elem);
<a name='L323'>            <b>continue</b>;
<a name='L324'>        <font color='red'>}</font>
<a name='L325'>        oldelem = PyList_GET_ITEM(heap, 0);
<a name='L326'>        PyList_SET_ITEM(heap, 0, elem);
<a name='L327'>        Py_DECREF(oldelem);
<a name='L328'>        <b>if</b> (<a href='../S/2567.html#L49' title='Defined at 49 in Modules/_heapqmodule.c.'>_siftup</a>((<a href='../S/534.html#L40' title='Defined at 40 in Include/listobject.h.'>PyListObject</a> *)heap, 0) == -1)
<a name='L329'>            <b>goto</b> fail;
<a name='L330'>        sol = PyList_GET_ITEM(heap, 0);
<a name='L331'>    <font color='red'>}</font>
<a name='L332'>sortit:
<a name='L333'>    <b>if</b> (<a href='../S/2796.html#L2056' title='Defined at 2056 in Objects/listobject.c.'>PyList_Sort</a>(heap) == -1)
<a name='L334'>        <b>goto</b> fail;
<a name='L335'>    <b>if</b> (<a href='../S/2796.html#L2078' title='Defined at 2078 in Objects/listobject.c.'>PyList_Reverse</a>(heap) == -1)
<a name='L336'>        <b>goto</b> fail;
<a name='L337'>    Py_DECREF(it);
<a name='L338'>    <b>return</b> heap;
<a name='L339'>
<a name='L340'>fail:
<a name='L341'>    Py_DECREF(it);
<a name='L342'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(heap);
<a name='L343'>    <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L344'><font color='red'>}</font>
<a name='L345'>
<a name='L346'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(nlargest_doc,
<a name='L347'>"Find the n largest elements in a dataset.\n\
<a name='L348'>\n\
<a name='L349'>Equivalent to:  sorted(iterable, reverse=True)[:n]\n");
<a name='L350'>
<a name='L351'><b>static</b> <b>int</b>
<a name='L352'><a href='../S/2567.html#L435' title='Refered from 435 in Modules/_heapqmodule.c.'>_siftdownmax</a>(PyListObject *heap, <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> startpos, <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> pos)
<a name='L353'><font color='red'>{</font>
<a name='L354'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *newitem, *parent;
<a name='L355'>    <b>int</b> <a href='../S/3095.html#L873' title='Defined at 873 in Python/dtoa.c.'>cmp</a>;
<a name='L356'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> parentpos;
<a name='L357'>
<a name='L358'>    <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(PyList_Check(heap));
<a name='L359'>    <b>if</b> (pos &gt;= <a href='../S/534.html#L71' title='Defined at 71 in Include/listobject.h.'>PyList_GET_SIZE</a>(heap)) <font color='red'>{</font>
<a name='L360'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_IndexError, "index out of range");
<a name='L361'>        <b>return</b> -1;
<a name='L362'>    <font color='red'>}</font>
<a name='L363'>
<a name='L364'>    newitem = PyList_GET_ITEM(heap, pos);
<a name='L365'>    Py_INCREF(newitem);
<a name='L366'>    <i><font color='green'>/* Follow the path to the root, moving parents down until finding</font></i>
<a name='L367'><i><font color='green'>       a place newitem fits. */</font></i>
<a name='L368'>    <b>while</b> (pos &gt; startpos)<font color='red'>{</font>
<a name='L369'>        parentpos = (pos - 1) &gt;&gt; 1;
<a name='L370'>        parent = PyList_GET_ITEM(heap, parentpos);
<a name='L371'>        <a href='../S/3095.html#L873' title='Defined at 873 in Python/dtoa.c.'>cmp</a> = <a href='../S/2803.html#L607' title='Defined at 607 in Objects/object.c.'>PyObject_RichCompareBool</a>(parent, newitem, <a href='../S/546.html#L151' title='Defined at 151 in Include/opcode.h.'>Py_LT</a>);
<a name='L372'>        <b>if</b> (<a href='../S/3095.html#L873' title='Defined at 873 in Python/dtoa.c.'>cmp</a> == -1) <font color='red'>{</font>
<a name='L373'>            Py_DECREF(newitem);
<a name='L374'>            <b>return</b> -1;
<a name='L375'>        <font color='red'>}</font>
<a name='L376'>        <b>if</b> (<a href='../S/3095.html#L873' title='Defined at 873 in Python/dtoa.c.'>cmp</a> == 0)
<a name='L377'>            <b>break</b>;
<a name='L378'>        Py_INCREF(parent);
<a name='L379'>        Py_DECREF(PyList_GET_ITEM(heap, pos));
<a name='L380'>        PyList_SET_ITEM(heap, pos, parent);
<a name='L381'>        pos = parentpos;
<a name='L382'>    <font color='red'>}</font>
<a name='L383'>    Py_DECREF(PyList_GET_ITEM(heap, pos));
<a name='L384'>    PyList_SET_ITEM(heap, pos, newitem);
<a name='L385'>    <b>return</b> 0;
<a name='L386'><font color='red'>}</font>
<a name='L387'>
<a name='L388'><b>static</b> <b>int</b>
<a name='L389'><a href='../R/5846.html' title='Multiple refered from 2 places.'>_siftupmax</a>(PyListObject *heap, <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> pos)
<a name='L390'><font color='red'>{</font>
<a name='L391'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> startpos, endpos, childpos, rightpos;
<a name='L392'>    <b>int</b> <a href='../S/3095.html#L873' title='Defined at 873 in Python/dtoa.c.'>cmp</a>;
<a name='L393'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *newitem, *tmp;
<a name='L394'>
<a name='L395'>    <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(PyList_Check(heap));
<a name='L396'>    endpos = <a href='../S/534.html#L71' title='Defined at 71 in Include/listobject.h.'>PyList_GET_SIZE</a>(heap);
<a name='L397'>    startpos = pos;
<a name='L398'>    <b>if</b> (pos &gt;= endpos) <font color='red'>{</font>
<a name='L399'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_IndexError, "index out of range");
<a name='L400'>        <b>return</b> -1;
<a name='L401'>    <font color='red'>}</font>
<a name='L402'>    newitem = PyList_GET_ITEM(heap, pos);
<a name='L403'>    Py_INCREF(newitem);
<a name='L404'>
<a name='L405'>    <i><font color='green'>/* Bubble up the smaller child until hitting a leaf. */</font></i>
<a name='L406'>    childpos = 2*pos + 1;    <i><font color='green'>/* leftmost child position  */</font></i>
<a name='L407'>    <b>while</b> (childpos &lt; endpos) <font color='red'>{</font>
<a name='L408'>        <i><font color='green'>/* Set childpos to index of smaller child.   */</font></i>
<a name='L409'>        rightpos = childpos + 1;
<a name='L410'>        <b>if</b> (rightpos &lt; endpos) <font color='red'>{</font>
<a name='L411'>            <a href='../S/3095.html#L873' title='Defined at 873 in Python/dtoa.c.'>cmp</a> = <a href='../S/2803.html#L607' title='Defined at 607 in Objects/object.c.'>PyObject_RichCompareBool</a>(
<a name='L412'>                PyList_GET_ITEM(heap, rightpos),
<a name='L413'>                PyList_GET_ITEM(heap, childpos),
<a name='L414'>                <a href='../S/546.html#L151' title='Defined at 151 in Include/opcode.h.'>Py_LT</a>);
<a name='L415'>            <b>if</b> (<a href='../S/3095.html#L873' title='Defined at 873 in Python/dtoa.c.'>cmp</a> == -1) <font color='red'>{</font>
<a name='L416'>                Py_DECREF(newitem);
<a name='L417'>                <b>return</b> -1;
<a name='L418'>            <font color='red'>}</font>
<a name='L419'>            <b>if</b> (<a href='../S/3095.html#L873' title='Defined at 873 in Python/dtoa.c.'>cmp</a> == 0)
<a name='L420'>                childpos = rightpos;
<a name='L421'>        <font color='red'>}</font>
<a name='L422'>        <i><font color='green'>/* Move the smaller child up. */</font></i>
<a name='L423'>        tmp = PyList_GET_ITEM(heap, childpos);
<a name='L424'>        Py_INCREF(tmp);
<a name='L425'>        Py_DECREF(PyList_GET_ITEM(heap, pos));
<a name='L426'>        PyList_SET_ITEM(heap, pos, tmp);
<a name='L427'>        pos = childpos;
<a name='L428'>        childpos = 2*pos + 1;
<a name='L429'>    <font color='red'>}</font>
<a name='L430'>
<a name='L431'>    <i><font color='green'>/* The leaf at pos is empty now.  Put newitem there, and and bubble</font></i>
<a name='L432'><i><font color='green'>       it up to its final resting place (by sifting its parents down). */</font></i>
<a name='L433'>    Py_DECREF(PyList_GET_ITEM(heap, pos));
<a name='L434'>    PyList_SET_ITEM(heap, pos, newitem);
<a name='L435'>    <b>return</b> <a href='../S/2567.html#L352' title='Defined at 352 in Modules/_heapqmodule.c.'>_siftdownmax</a>(heap, startpos, pos);
<a name='L436'><font color='red'>}</font>
<a name='L437'>
<a name='L438'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L439'><a href='../S/2567.html#L535' title='Refered from 535 in Modules/_heapqmodule.c.'>nsmallest</a>(PyObject *self, PyObject *args)
<a name='L440'><font color='red'>{</font>
<a name='L441'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *heap=<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, *elem, *iterable, *los, *it, *oldelem;
<a name='L442'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> i, n;
<a name='L443'>    <b>int</b> <a href='../S/3095.html#L873' title='Defined at 873 in Python/dtoa.c.'>cmp</a>;
<a name='L444'>
<a name='L445'>    <b>if</b> (!<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "nO:nsmallest", &amp;n, &amp;iterable))
<a name='L446'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L447'>
<a name='L448'>    it = <a href='../S/2775.html#L2668' title='Defined at 2668 in Objects/abstract.c.'>PyObject_GetIter</a>(iterable);
<a name='L449'>    <b>if</b> (it == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L450'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L451'>
<a name='L452'>    heap = <a href='../S/2796.html#L113' title='Defined at 113 in Objects/listobject.c.'>PyList_New</a>(0);
<a name='L453'>    <b>if</b> (heap == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L454'>        <b>goto</b> fail;
<a name='L455'>
<a name='L456'>    <b>for</b> (i=0 ; i&lt;n ; i++ )<font color='red'>{</font>
<a name='L457'>        elem = <a href='../S/2775.html#L2700' title='Defined at 2700 in Objects/abstract.c.'>PyIter_Next</a>(it);
<a name='L458'>        <b>if</b> (elem == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L459'>            <b>if</b> (<a href='../D/3154.html' title='Multiple defined in 2 places.'>PyErr_Occurred</a>())
<a name='L460'>                <b>goto</b> fail;
<a name='L461'>            <b>else</b>
<a name='L462'>                <b>goto</b> sortit;
<a name='L463'>        <font color='red'>}</font>
<a name='L464'>        <b>if</b> (<a href='../S/2796.html#L286' title='Defined at 286 in Objects/listobject.c.'>PyList_Append</a>(heap, elem) == -1) <font color='red'>{</font>
<a name='L465'>            Py_DECREF(elem);
<a name='L466'>            <b>goto</b> fail;
<a name='L467'>        <font color='red'>}</font>
<a name='L468'>        Py_DECREF(elem);
<a name='L469'>    <font color='red'>}</font>
<a name='L470'>    n = <a href='../S/534.html#L71' title='Defined at 71 in Include/listobject.h.'>PyList_GET_SIZE</a>(heap);
<a name='L471'>    <b>if</b> (n == 0)
<a name='L472'>        <b>goto</b> sortit;
<a name='L473'>
<a name='L474'>    <b>for</b> (i=n/2-1 ; i&gt;=0 ; i--)
<a name='L475'>        <b>if</b>(<a href='../S/2567.html#L389' title='Defined at 389 in Modules/_heapqmodule.c.'>_siftupmax</a>((<a href='../S/534.html#L40' title='Defined at 40 in Include/listobject.h.'>PyListObject</a> *)heap, i) == -1)
<a name='L476'>            <b>goto</b> fail;
<a name='L477'>
<a name='L478'>    los = PyList_GET_ITEM(heap, 0);
<a name='L479'>    <b>while</b> (1) <font color='red'>{</font>
<a name='L480'>        elem = <a href='../S/2775.html#L2700' title='Defined at 2700 in Objects/abstract.c.'>PyIter_Next</a>(it);
<a name='L481'>        <b>if</b> (elem == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L482'>            <b>if</b> (<a href='../D/3154.html' title='Multiple defined in 2 places.'>PyErr_Occurred</a>())
<a name='L483'>                <b>goto</b> fail;
<a name='L484'>            <b>else</b>
<a name='L485'>                <b>goto</b> sortit;
<a name='L486'>        <font color='red'>}</font>
<a name='L487'>        <a href='../S/3095.html#L873' title='Defined at 873 in Python/dtoa.c.'>cmp</a> = <a href='../S/2803.html#L607' title='Defined at 607 in Objects/object.c.'>PyObject_RichCompareBool</a>(elem, los, <a href='../S/546.html#L151' title='Defined at 151 in Include/opcode.h.'>Py_LT</a>);
<a name='L488'>        <b>if</b> (<a href='../S/3095.html#L873' title='Defined at 873 in Python/dtoa.c.'>cmp</a> == -1) <font color='red'>{</font>
<a name='L489'>            Py_DECREF(elem);
<a name='L490'>            <b>goto</b> fail;
<a name='L491'>        <font color='red'>}</font>
<a name='L492'>        <b>if</b> (<a href='../S/3095.html#L873' title='Defined at 873 in Python/dtoa.c.'>cmp</a> == 0) <font color='red'>{</font>
<a name='L493'>            Py_DECREF(elem);
<a name='L494'>            <b>continue</b>;
<a name='L495'>        <font color='red'>}</font>
<a name='L496'>
<a name='L497'>        oldelem = PyList_GET_ITEM(heap, 0);
<a name='L498'>        PyList_SET_ITEM(heap, 0, elem);
<a name='L499'>        Py_DECREF(oldelem);
<a name='L500'>        <b>if</b> (<a href='../S/2567.html#L389' title='Defined at 389 in Modules/_heapqmodule.c.'>_siftupmax</a>((<a href='../S/534.html#L40' title='Defined at 40 in Include/listobject.h.'>PyListObject</a> *)heap, 0) == -1)
<a name='L501'>            <b>goto</b> fail;
<a name='L502'>        los = PyList_GET_ITEM(heap, 0);
<a name='L503'>    <font color='red'>}</font>
<a name='L504'>
<a name='L505'>sortit:
<a name='L506'>    <b>if</b> (<a href='../S/2796.html#L2056' title='Defined at 2056 in Objects/listobject.c.'>PyList_Sort</a>(heap) == -1)
<a name='L507'>        <b>goto</b> fail;
<a name='L508'>    Py_DECREF(it);
<a name='L509'>    <b>return</b> heap;
<a name='L510'>
<a name='L511'>fail:
<a name='L512'>    Py_DECREF(it);
<a name='L513'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(heap);
<a name='L514'>    <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L515'><font color='red'>}</font>
<a name='L516'>
<a name='L517'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(nsmallest_doc,
<a name='L518'>"Find the n smallest elements in a dataset.\n\
<a name='L519'>\n\
<a name='L520'>Equivalent to:  sorted(iterable)[:n]\n");
<a name='L521'>
<a name='L522'><b>static</b> <a href='../D/3525.html' title='Multiple defined in 3 places.'>PyMethodDef</a> heapq_methods[] = <font color='red'>{</font>
<a name='L523'>    <font color='red'>{</font>"heappush",        (PyCFunction)<a href='../S/2567.html#L99' title='Defined at 99 in Modules/_heapqmodule.c.'>heappush</a>,
<a name='L524'>        <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a>,           heappush_doc<font color='red'>}</font>,
<a name='L525'>    <font color='red'>{</font>"heappushpop",     (PyCFunction)<a href='../S/2567.html#L199' title='Defined at 199 in Modules/_heapqmodule.c.'>heappushpop</a>,
<a name='L526'>        <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a>,           heappushpop_doc<font color='red'>}</font>,
<a name='L527'>    <font color='red'>{</font>"heappop",         (PyCFunction)<a href='../S/2567.html#L124' title='Defined at 124 in Modules/_heapqmodule.c.'>heappop</a>,
<a name='L528'>        METH_O,                 heappop_doc<font color='red'>}</font>,
<a name='L529'>    <font color='red'>{</font>"heapreplace",     (PyCFunction)<a href='../S/2567.html#L161' title='Defined at 161 in Modules/_heapqmodule.c.'>heapreplace</a>,
<a name='L530'>        <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a>,           heapreplace_doc<font color='red'>}</font>,
<a name='L531'>    <font color='red'>{</font>"heapify",         (PyCFunction)<a href='../S/2567.html#L241' title='Defined at 241 in Modules/_heapqmodule.c.'>heapify</a>,
<a name='L532'>        METH_O,                 heapify_doc<font color='red'>}</font>,
<a name='L533'>    <font color='red'>{</font>"nlargest",        (PyCFunction)<a href='../S/2567.html#L269' title='Defined at 269 in Modules/_heapqmodule.c.'>nlargest</a>,
<a name='L534'>        <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a>,           nlargest_doc<font color='red'>}</font>,
<a name='L535'>    <font color='red'>{</font>"nsmallest",       (PyCFunction)<a href='../S/2567.html#L439' title='Defined at 439 in Modules/_heapqmodule.c.'>nsmallest</a>,
<a name='L536'>        <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a>,           nsmallest_doc<font color='red'>}</font>,
<a name='L537'>    <font color='red'>{</font><a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,              <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>           <i><font color='green'>/* sentinel */</font></i>
<a name='L538'><font color='red'>}</font>;
<a name='L539'>
<a name='L540'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(module_doc,
<a name='L541'>"Heap queue algorithm (a.k.a. priority queue).\n\
<a name='L542'>\n\
<a name='L543'>Heaps are arrays for which a[k] &lt;= a[2*k+1] and a[k] &lt;= a[2*k+2] for\n\
<a name='L544'>all k, counting elements from 0.  For the sake of comparison,\n\
<a name='L545'>non-existing elements are considered to be infinite.  The interesting\n\
<a name='L546'>property of a heap is that a[0] is always its smallest element.\n\
<a name='L547'>\n\
<a name='L548'>Usage:\n\
<a name='L549'>\n\
<a name='L550'>heap = []            # creates an empty heap\n\
<a name='L551'>heappush(heap, item) # pushes a new item on the heap\n\
<a name='L552'>item = heappop(heap) # pops the smallest item from the heap\n\
<a name='L553'>item = heap[0]       # smallest item on the heap without popping it\n\
<a name='L554'>heapify(x)           # transforms list into a heap, in-place, in linear time\n\
<a name='L555'>item = heapreplace(heap, item) # pops and returns smallest item, and adds\n\
<a name='L556'>                               # new item; the heap size is unchanged\n\
<a name='L557'>\n\
<a name='L558'>Our API differs from textbook heap algorithms as follows:\n\
<a name='L559'>\n\
<a name='L560'>- We use 0-based indexing.  This makes the relationship between the\n\
<a name='L561'>  index for a node and the indexes for its children slightly less\n\
<a name='L562'>  obvious, but is more suitable since Python uses 0-based indexing.\n\
<a name='L563'>\n\
<a name='L564'>- Our heappop() method returns the smallest item, not the largest.\n\
<a name='L565'>\n\
<a name='L566'>These two make it possible to view the heap as a regular Python list\n\
<a name='L567'>without surprises: heap[0] is the smallest item, and heap.sort()\n\
<a name='L568'>maintains the heap invariant!\n");
<a name='L569'>
<a name='L570'>
<a name='L571'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(__about__,
<a name='L572'>"Heap queues\n\
<a name='L573'>\n\
<a name='L574'>[explanation by Fran\xc3\xa7ois Pinard]\n\
<a name='L575'>\n\
<a name='L576'>Heaps are arrays for which a[k] &lt;= a[2*k+1] and a[k] &lt;= a[2*k+2] for\n\
<a name='L577'>all k, counting elements from 0.  For the sake of comparison,\n\
<a name='L578'>non-existing elements are considered to be infinite.  The interesting\n\
<a name='L579'>property of a heap is that a[0] is always its smallest element.\n"
<a name='L580'>"\n\
<a name='L581'>The strange invariant above is meant to be an efficient memory\n\
<a name='L582'>representation for a tournament.  The numbers below are `k', not a[k]:\n\
<a name='L583'>\n\
<a name='L584'>                                   0\n\
<a name='L585'>\n\
<a name='L586'>                  1                                 2\n\
<a name='L587'>\n\
<a name='L588'>          3               4                5               6\n\
<a name='L589'>\n\
<a name='L590'>      7       8       9       10      11      12      13      14\n\
<a name='L591'>\n\
<a name='L592'>    15 16   17 18   19 20   21 22   23 24   25 26   27 28   29 30\n\
<a name='L593'>\n\
<a name='L594'>\n\
<a name='L595'>In the tree above, each cell `k' is topping `2*k+1' and `2*k+2'.  In\n\
<a name='L596'>an usual binary tournament we see in sports, each cell is the winner\n\
<a name='L597'>over the two cells it tops, and we can trace the winner down the tree\n\
<a name='L598'>to see all opponents s/he had.  However, in many computer applications\n\
<a name='L599'>of such tournaments, we do not need to trace the history of a winner.\n\
<a name='L600'>To be more memory efficient, when a winner is promoted, we try to\n\
<a name='L601'>replace it by something else at a lower level, and the rule becomes\n\
<a name='L602'>that a cell and the two cells it tops contain three different items,\n\
<a name='L603'>but the top cell \"wins\" over the two topped cells.\n"
<a name='L604'>"\n\
<a name='L605'>If this heap invariant is protected at all time, index 0 is clearly\n\
<a name='L606'>the overall winner.  The simplest algorithmic way to remove it and\n\
<a name='L607'>find the \"next\" winner is to move some loser (let's say cell 30 in the\n\
<a name='L608'>diagram above) into the 0 position, and then percolate this new 0 down\n\
<a name='L609'>the tree, exchanging values, until the invariant is re-established.\n\
<a name='L610'>This is clearly logarithmic on the total number of items in the tree.\n\
<a name='L611'>By iterating over all items, you get an O(n ln n) sort.\n"
<a name='L612'>"\n\
<a name='L613'>A nice feature of this sort is that you can efficiently insert new\n\
<a name='L614'>items while the sort is going on, provided that the inserted items are\n\
<a name='L615'>not \"better\" than the last 0'th element you extracted.  This is\n\
<a name='L616'>especially useful in simulation contexts, where the tree holds all\n\
<a name='L617'>incoming events, and the \"win\" condition means the smallest scheduled\n\
<a name='L618'>time.  When an event schedule other events for execution, they are\n\
<a name='L619'>scheduled into the future, so they can easily go into the heap.  So, a\n\
<a name='L620'>heap is a good structure for implementing schedulers (this is what I\n\
<a name='L621'>used for my MIDI sequencer :-).\n"
<a name='L622'>"\n\
<a name='L623'>Various structures for implementing schedulers have been extensively\n\
<a name='L624'>studied, and heaps are good for this, as they are reasonably speedy,\n\
<a name='L625'>the speed is almost constant, and the worst case is not much different\n\
<a name='L626'>than the average case.  However, there are other representations which\n\
<a name='L627'>are more efficient overall, yet the worst cases might be terrible.\n"
<a name='L628'>"\n\
<a name='L629'>Heaps are also very useful in big disk sorts.  You most probably all\n\
<a name='L630'>know that a big sort implies producing \"runs\" (which are pre-sorted\n\
<a name='L631'>sequences, which size is usually related to the amount of CPU memory),\n\
<a name='L632'>followed by a merging passes for these runs, which merging is often\n\
<a name='L633'>very cleverly organised[1].  It is very important that the initial\n\
<a name='L634'>sort produces the longest runs possible.  Tournaments are a good way\n\
<a name='L635'>to that.  If, using all the memory available to hold a tournament, you\n\
<a name='L636'>replace and percolate items that happen to fit the current run, you'll\n\
<a name='L637'>produce runs which are twice the size of the memory for random input,\n\
<a name='L638'>and much better for input fuzzily ordered.\n"
<a name='L639'>"\n\
<a name='L640'>Moreover, if you output the 0'th item on disk and get an input which\n\
<a name='L641'>may not fit in the current tournament (because the value \"wins\" over\n\
<a name='L642'>the last output value), it cannot fit in the heap, so the size of the\n\
<a name='L643'>heap decreases.  The freed memory could be cleverly reused immediately\n\
<a name='L644'>for progressively building a second heap, which grows at exactly the\n\
<a name='L645'>same rate the first heap is melting.  When the first heap completely\n\
<a name='L646'>vanishes, you switch heaps and start a new run.  Clever and quite\n\
<a name='L647'>effective!\n\
<a name='L648'>\n\
<a name='L649'>In a word, heaps are useful memory structures to know.  I use them in\n\
<a name='L650'>a few applications, and I think it is good to keep a `heap' module\n\
<a name='L651'>around. :-)\n"
<a name='L652'>"\n\
<a name='L653'>--------------------\n\
<a name='L654'>[1] The disk balancing algorithms which are current, nowadays, are\n\
<a name='L655'>more annoying than clever, and this is a consequence of the seeking\n\
<a name='L656'>capabilities of the disks.  On devices which cannot seek, like big\n\
<a name='L657'>tape drives, the story was quite different, and one had to be very\n\
<a name='L658'>clever to ensure (far in advance) that each tape movement will be the\n\
<a name='L659'>most effective possible (that is, will best participate at\n\
<a name='L660'>\"progressing\" the merge).  Some tapes were even able to read\n\
<a name='L661'>backwards, and this was also used to avoid the rewinding time.\n\
<a name='L662'>Believe me, real good tape sorts were quite spectacular to watch!\n\
<a name='L663'>From all times, sorting has always been a Great Art! :-)\n");
<a name='L664'>
<a name='L665'>
<a name='L666'><b>static</b> <b>struct</b> <a href='../D/3534.html' title='Multiple defined in 2 places.'>PyModuleDef</a> _heapqmodule = <font color='red'>{</font>
<a name='L667'>    <a href='../S/542.html#L33' title='Defined at 33 in Include/moduleobject.h.'>PyModuleDef_HEAD_INIT</a>,
<a name='L668'>    "_heapq",
<a name='L669'>    module_doc,
<a name='L670'>    -1,
<a name='L671'>    heapq_methods,
<a name='L672'>    <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L673'>    <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L674'>    <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L675'>    <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>
<a name='L676'><font color='red'>}</font>;
<a name='L677'>
<a name='L678'><a href='../D/3482.html' title='Multiple defined in 10 places.'>PyMODINIT_FUNC</a>
<a name='L679'><a href='../R/3026.html' title='Multiple refered from 2 places.'>PyInit__heapq</a>(<b>void</b>)
<a name='L680'><font color='red'>{</font>
<a name='L681'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *m, *about;
<a name='L682'>
<a name='L683'>    m = PyModule_Create(&amp;_heapqmodule);
<a name='L684'>    <b>if</b> (m == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L685'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L686'>    about = <a href='../D/3987.html' title='Multiple defined in 3 places.'>PyUnicode_DecodeUTF8</a>(__about__, strlen(__about__), <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L687'>    <a href='../S/3125.html#L525' title='Defined at 525 in Python/modsupport.c.'>PyModule_AddObject</a>(m, "__about__", about);
<a name='L688'>    <b>return</b> m;
<a name='L689'><font color='red'>}</font>
<a name='L690'>
</pre>
<hr>
<a name='BOTTOM'>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L12'>[^]</a><a href='#L679'>[v]</a><a href='#TOP'>[top]</a>[bottom]<a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
</body>
</html>
