<html>
<head>
<title>Modules/_ctypes/libffi_osx/x86/x86-ffi64.c</title>
<meta name='robots' content='noindex,nofollow'>
<meta name='generator' content='GLOBAL-5.8.1'>
</head>
<body text='#191970' bgcolor='#f5f5dc' vlink='gray'>
<a name='TOP'><h2><a href='../mains.html'>root</a>/<a href='../files/3353.html'>Modules</a>/<a href='../files/3354.html'>_ctypes</a>/<a href='../files/3381.html'>libffi_osx</a>/<a href='../files/3384.html'>x86</a>/x86-ffi64.c</h2>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L87'>[^]</a><a href='#L509'>[v]</a>[top]<a href='#BOTTOM'>[bottom]</a><a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
<hr>
<h2>DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href='#L87' title='Defined at 87.'>merge_classes</a>
<li><a href='#L139' title='Defined at 139.'>classify_argument</a>
<li><a href='#L250' title='Defined at 250.'>examine_argument</a>
<li><a href='#L302' title='Defined at 302.'>ffi_prep_cif_machdep</a>
<li><a href='#L377' title='Defined at 377.'>ffi_call</a>
<li><a href='#L479' title='Defined at 479.'>ffi_prep_closure</a>
<li><a href='#L509' title='Defined at 509.'>ffi_closure_unix64_inner</a>
</ol>
<hr>
<pre>
<a name='L1'><font color='darkred'>#ifdef</font> __x86_64__
<a name='L2'>
<a name='L3'><i><font color='green'>/* -----------------------------------------------------------------------</font></i>
<a name='L4'><i><font color='green'>   x86-ffi64.c - Copyright (c) 2002  Bo Thorsen &lt;bo@suse.de&gt;</font></i>
<a name='L5'><i><font color='green'>   </font></i>
<a name='L6'><i><font color='green'>   x86-64 Foreign Function Interface </font></i>
<a name='L7'><i><font color='green'></font></i>
<a name='L8'><i><font color='green'>   Permission is hereby granted, free of charge, to any person obtaining</font></i>
<a name='L9'><i><font color='green'>   a copy of this software and associated documentation files (the</font></i>
<a name='L10'><i><font color='green'>   ``Software''), to deal in the Software without restriction, including</font></i>
<a name='L11'><i><font color='green'>   without limitation the rights to use, copy, modify, merge, publish,</font></i>
<a name='L12'><i><font color='green'>   distribute, sublicense, and/or sell copies of the Software, and to</font></i>
<a name='L13'><i><font color='green'>   permit persons to whom the Software is furnished to do so, subject to</font></i>
<a name='L14'><i><font color='green'>   the following conditions:</font></i>
<a name='L15'><i><font color='green'></font></i>
<a name='L16'><i><font color='green'>   The above copyright notice and this permission notice shall be included</font></i>
<a name='L17'><i><font color='green'>   in all copies or substantial portions of the Software.</font></i>
<a name='L18'><i><font color='green'></font></i>
<a name='L19'><i><font color='green'>   THE SOFTWARE IS PROVIDED ``AS IS'', WITHOUT WARRANTY OF ANY KIND, EXPRESS</font></i>
<a name='L20'><i><font color='green'>   OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF</font></i>
<a name='L21'><i><font color='green'>   MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.</font></i>
<a name='L22'><i><font color='green'>   IN NO EVENT SHALL CYGNUS SOLUTIONS BE LIABLE FOR ANY CLAIM, DAMAGES OR</font></i>
<a name='L23'><i><font color='green'>   OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,</font></i>
<a name='L24'><i><font color='green'>   ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR</font></i>
<a name='L25'><i><font color='green'>   OTHER DEALINGS IN THE SOFTWARE.</font></i>
<a name='L26'><i><font color='green'>   ----------------------------------------------------------------------- */</font></i>
<a name='L27'>
<a name='L28'><font color='darkred'>#include</font> &lt;<a href='../I/325.html'>ffi.h</a>&gt;
<a name='L29'><font color='darkred'>#include</font> &lt;<a href='../I/119.html'>ffi_common.h</a>&gt;
<a name='L30'>
<a name='L31'><font color='darkred'>#include</font> &lt;stdlib.h&gt;
<a name='L32'><font color='darkred'>#include</font> &lt;stdarg.h&gt;
<a name='L33'>
<a name='L34'><font color='darkred'>#define</font> <a href='../R/1863.html' title='Multiple refered from 8 places.'>MAX_GPR_REGS</a> 6
<a name='L35'><font color='darkred'>#define</font> <a href='../R/1884.html' title='Multiple refered from 8 places.'>MAX_SSE_REGS</a> 8
<a name='L36'>
<a name='L37'><b>typedef</b> <b>struct</b> <a href='../R/4006.html' title='Multiple refered from 5 places.'>RegisterArgs</a> <font color='red'>{</font>
<a name='L38'>        <i><font color='green'>/* Registers for argument passing.  */</font></i>
<a name='L39'>        <a href='../D/5331.html' title='Multiple defined in 7 places.'>UINT64</a>          gpr[<a href='../D/2062.html' title='Multiple defined in 2 places.'>MAX_GPR_REGS</a>];
<a name='L40'>        __int128_t      sse[<a href='../D/2083.html' title='Multiple defined in 2 places.'>MAX_SSE_REGS</a>];
<a name='L41'><font color='red'>}</font> <a href='../R/4006.html' title='Multiple refered from 5 places.'>RegisterArgs</a>;
<a name='L42'>
<a name='L43'><b>extern</b> <b>void</b>
<a name='L44'>ffi_call_unix64(
<a name='L45'>        <b>void</b>*                   args,
<a name='L46'>        <b>unsigned</b> <b>long</b>   bytes,
<a name='L47'>        <b>unsigned</b>                flags,
<a name='L48'>        <b>void</b>*                   raddr,
<a name='L49'>        <b>void</b>                    (*fnaddr)(),
<a name='L50'>        <b>unsigned</b>                ssecount);
<a name='L51'>
<a name='L52'><i><font color='green'>/*      All reference to register classes here is identical to the code in</font></i>
<a name='L53'><i><font color='green'>        gcc/config/i386/i386.c. Do *not* change one without the other.  */</font></i>
<a name='L54'>
<a name='L55'><i><font color='green'>/*      Register class used for passing given 64bit part of the argument.</font></i>
<a name='L56'><i><font color='green'>        These represent classes as documented by the PS ABI, with the exception</font></i>
<a name='L57'><i><font color='green'>        of SSESF, SSEDF classes, that are basically SSE class, just gcc will</font></i>
<a name='L58'><i><font color='green'>        use SF or DFmode move instead of DImode to avoid reformating penalties.</font></i>
<a name='L59'><i><font color='green'></font></i>
<a name='L60'><i><font color='green'>        Similary we play games with INTEGERSI_CLASS to use cheaper SImode moves</font></i>
<a name='L61'><i><font color='green'>        whenever possible (upper half does contain padding).  */</font></i>
<a name='L62'><b>enum</b> <a href='../R/11483.html' title='Multiple refered from 12 places.'>x86_64_reg_class</a>
<a name='L63'><font color='red'>{</font>
<a name='L64'>        X86_64_NO_CLASS,
<a name='L65'>        X86_64_INTEGER_CLASS,
<a name='L66'>        X86_64_INTEGERSI_CLASS,
<a name='L67'>        X86_64_SSE_CLASS,
<a name='L68'>        X86_64_SSESF_CLASS,
<a name='L69'>        X86_64_SSEDF_CLASS,
<a name='L70'>        X86_64_SSEUP_CLASS,
<a name='L71'>        X86_64_X87_CLASS,
<a name='L72'>        X86_64_X87UP_CLASS,
<a name='L73'>        X86_64_COMPLEX_X87_CLASS,
<a name='L74'>        X86_64_MEMORY_CLASS
<a name='L75'><font color='red'>}</font>;
<a name='L76'>
<a name='L77'><font color='darkred'>#define</font> <a href='../R/1855.html' title='Multiple refered from 12 places.'>MAX_CLASSES</a> 4
<a name='L78'><font color='darkred'>#define</font> <a href='../R/4323.html' title='Multiple refered from 15 places.'>SSE_CLASS_P</a>(X)  ((X) &gt;= X86_64_SSE_CLASS &amp;&amp; X &lt;= X86_64_SSEUP_CLASS)
<a name='L79'>
<a name='L80'><i><font color='green'>/*      x86-64 register passing implementation.  See x86-64 ABI for details.  Goal</font></i>
<a name='L81'><i><font color='green'>        of this code is to classify each 8bytes of incoming argument by the register</font></i>
<a name='L82'><i><font color='green'>        class and assign registers accordingly.  */</font></i>
<a name='L83'>
<a name='L84'><i><font color='green'>/*      Return the union class of CLASS1 and CLASS2.</font></i>
<a name='L85'><i><font color='green'>        See the x86-64 PS ABI for details.  */</font></i>
<a name='L86'><b>static</b> <b>enum</b> <a href='../D/12393.html' title='Multiple defined in 2 places.'>x86_64_reg_class</a>
<a name='L87'><a href='../R/9003.html' title='Multiple refered from 2 places.'>merge_classes</a>(
<a name='L88'>        <b>enum</b> x86_64_reg_class   class1,
<a name='L89'>        <b>enum</b> x86_64_reg_class   class2)
<a name='L90'><font color='red'>{</font>
<a name='L91'>        <i><font color='green'>/*      Rule #1: If both classes are equal, this is the resulting class.  */</font></i>
<a name='L92'>        <b>if</b> (class1 == class2)
<a name='L93'>                <b>return</b> class1;
<a name='L94'>
<a name='L95'>        <i><font color='green'>/*      Rule #2: If one of the classes is NO_CLASS, the resulting class is</font></i>
<a name='L96'><i><font color='green'>                the other class.  */</font></i>
<a name='L97'>        <b>if</b> (class1 == X86_64_NO_CLASS)
<a name='L98'>                <b>return</b> class2;
<a name='L99'>
<a name='L100'>        <b>if</b> (class2 == X86_64_NO_CLASS)
<a name='L101'>                <b>return</b> class1;
<a name='L102'>
<a name='L103'>        <i><font color='green'>/*      Rule #3: If one of the classes is MEMORY, the result is MEMORY.  */</font></i>
<a name='L104'>        <b>if</b> (class1 == X86_64_MEMORY_CLASS || class2 == X86_64_MEMORY_CLASS)
<a name='L105'>                <b>return</b> X86_64_MEMORY_CLASS;
<a name='L106'>
<a name='L107'>        <i><font color='green'>/*      Rule #4: If one of the classes is INTEGER, the result is INTEGER.  */</font></i>
<a name='L108'>        <b>if</b> ((class1 == X86_64_INTEGERSI_CLASS &amp;&amp; class2 == X86_64_SSESF_CLASS)
<a name='L109'>                || (class2 == X86_64_INTEGERSI_CLASS &amp;&amp; class1 == X86_64_SSESF_CLASS))
<a name='L110'>                <b>return</b> X86_64_INTEGERSI_CLASS;
<a name='L111'>
<a name='L112'>        <b>if</b> (class1 == X86_64_INTEGER_CLASS || class1 == X86_64_INTEGERSI_CLASS
<a name='L113'>                || class2 == X86_64_INTEGER_CLASS || class2 == X86_64_INTEGERSI_CLASS)
<a name='L114'>                <b>return</b> X86_64_INTEGER_CLASS;
<a name='L115'>
<a name='L116'>        <i><font color='green'>/*      Rule #5: If one of the classes is X87, X87UP, or COMPLEX_X87 class,</font></i>
<a name='L117'><i><font color='green'>                MEMORY is used.  */</font></i>
<a name='L118'>        <b>if</b> (class1 == X86_64_X87_CLASS
<a name='L119'>                || class1 == X86_64_X87UP_CLASS
<a name='L120'>                || class1 == X86_64_COMPLEX_X87_CLASS
<a name='L121'>                || class2 == X86_64_X87_CLASS
<a name='L122'>                || class2 == X86_64_X87UP_CLASS
<a name='L123'>                || class2 == X86_64_COMPLEX_X87_CLASS)
<a name='L124'>                <b>return</b> X86_64_MEMORY_CLASS;
<a name='L125'>
<a name='L126'>        <i><font color='green'>/*      Rule #6: Otherwise class SSE is used.  */</font></i>
<a name='L127'>        <b>return</b> X86_64_SSE_CLASS;
<a name='L128'><font color='red'>}</font>
<a name='L129'>
<a name='L130'><i><font color='green'>/*      Classify the argument of type TYPE and mode MODE.</font></i>
<a name='L131'><i><font color='green'>        CLASSES will be filled by the register class used to pass each word</font></i>
<a name='L132'><i><font color='green'>        of the operand.  The number of words is returned.  In case the parameter</font></i>
<a name='L133'><i><font color='green'>        should be passed in memory, 0 is returned. As a special case for zero</font></i>
<a name='L134'><i><font color='green'>        sized containers, classes[0] will be NO_CLASS and 1 is returned.</font></i>
<a name='L135'><i><font color='green'></font></i>
<a name='L136'><i><font color='green'>        See the x86-64 PS ABI for details.      */</font></i>
<a name='L137'>
<a name='L138'><b>static</b> <b>int</b>
<a name='L139'><a href='../R/6659.html' title='Multiple refered from 4 places.'>classify_argument</a>(
<a name='L140'>        ffi_type*                               type,
<a name='L141'>        <b>enum</b> x86_64_reg_class   classes[],
<a name='L142'>        <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>                                  byte_offset)
<a name='L143'><font color='red'>{</font>
<a name='L144'>        <b>switch</b> (type-&gt;type)
<a name='L145'>        <font color='red'>{</font>
<a name='L146'>                <b>case</b> <a href='../D/1222.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT8</a>:
<a name='L147'>                <b>case</b> <a href='../D/1189.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT8</a>:
<a name='L148'>                <b>case</b> <a href='../D/1219.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT16</a>:
<a name='L149'>                <b>case</b> <a href='../D/1186.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT16</a>:
<a name='L150'>                <b>case</b> <a href='../D/1220.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT32</a>:
<a name='L151'>                <b>case</b> <a href='../D/1187.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT32</a>:
<a name='L152'>                <b>case</b> <a href='../D/1221.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT64</a>:
<a name='L153'>                <b>case</b> <a href='../D/1188.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT64</a>:
<a name='L154'>                <b>case</b> <a href='../D/1185.html' title='Multiple defined in 3 places.'>FFI_TYPE_POINTER</a>:
<a name='L155'>                        <b>if</b> (byte_offset + type-&gt;size &lt;= 4)
<a name='L156'>                                classes[0] = X86_64_INTEGERSI_CLASS;
<a name='L157'>                        <b>else</b>
<a name='L158'>                                classes[0] = X86_64_INTEGER_CLASS;
<a name='L159'>
<a name='L160'>                        <b>return</b> 1;
<a name='L161'>
<a name='L162'>                <b>case</b> <a href='../D/1181.html' title='Multiple defined in 3 places.'>FFI_TYPE_FLOAT</a>:
<a name='L163'>                        <b>if</b> (byte_offset == 0)
<a name='L164'>                                classes[0] = X86_64_SSESF_CLASS;
<a name='L165'>                        <b>else</b>
<a name='L166'>                                classes[0] = X86_64_SSE_CLASS;
<a name='L167'>
<a name='L168'>                        <b>return</b> 1;
<a name='L169'>
<a name='L170'>                <b>case</b> <a href='../D/1180.html' title='Multiple defined in 3 places.'>FFI_TYPE_DOUBLE</a>:
<a name='L171'>                        classes[0] = X86_64_SSEDF_CLASS;
<a name='L172'>                        <b>return</b> 1;
<a name='L173'>
<a name='L174'>                <b>case</b> <a href='../D/1184.html' title='Multiple defined in 8 places.'>FFI_TYPE_LONGDOUBLE</a>:
<a name='L175'>                        classes[0] = X86_64_X87_CLASS;
<a name='L176'>                        classes[1] = X86_64_X87UP_CLASS;
<a name='L177'>                        <b>return</b> 2;
<a name='L178'>
<a name='L179'>                <b>case</b> <a href='../D/1202.html' title='Multiple defined in 3 places.'>FFI_TYPE_STRUCT</a>:
<a name='L180'>                <font color='red'>{</font>
<a name='L181'>                        <a href='../D/8534.html' title='Multiple defined in 3 places.'>ffi_type</a>**                              ptr; 
<a name='L182'>                        <b>int</b>                                             i;
<a name='L183'>                        <b>enum</b> <a href='../D/12393.html' title='Multiple defined in 2 places.'>x86_64_reg_class</a>   subclasses[<a href='../D/2054.html' title='Multiple defined in 2 places.'>MAX_CLASSES</a>];
<a name='L184'>                        <b>const</b> <b>int</b>                               UNITS_PER_WORD = 8;
<a name='L185'>                        <b>int</b>                                             words =
<a name='L186'>                                (type-&gt;size + UNITS_PER_WORD - 1) / UNITS_PER_WORD;
<a name='L187'>
<a name='L188'>                        <i><font color='green'>/* If the struct is larger than 16 bytes, pass it on the stack.  */</font></i>
<a name='L189'>                        <b>if</b> (type-&gt;size &gt; 16)
<a name='L190'>                                <b>return</b> 0;
<a name='L191'>
<a name='L192'>                        <b>for</b> (i = 0; i &lt; words; i++)
<a name='L193'>                                classes[i] = X86_64_NO_CLASS;
<a name='L194'>
<a name='L195'>                        <i><font color='green'>/* Merge the fields of structure.  */</font></i>
<a name='L196'>                        <b>for</b> (ptr = type-&gt;elements; *ptr != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>; ptr++)
<a name='L197'>                        <font color='red'>{</font>
<a name='L198'>                                byte_offset = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(byte_offset, (*ptr)-&gt;alignment);
<a name='L199'>
<a name='L200'>                                <b>int</b>     num = <a href='../D/7431.html' title='Multiple defined in 2 places.'>classify_argument</a>(*ptr, subclasses, byte_offset % 8);
<a name='L201'>
<a name='L202'>                                <b>if</b> (num == 0)
<a name='L203'>                                        <b>return</b> 0;
<a name='L204'>
<a name='L205'>                                <b>int</b> pos = byte_offset / 8;
<a name='L206'>
<a name='L207'>                                <b>for</b> (i = 0; i &lt; num; i++)
<a name='L208'>                                <font color='red'>{</font>
<a name='L209'>                                        classes[i + pos] =
<a name='L210'>                                                <a href='../D/9832.html' title='Multiple defined in 2 places.'>merge_classes</a>(subclasses[i], classes[i + pos]);
<a name='L211'>                                <font color='red'>}</font>
<a name='L212'>
<a name='L213'>                                byte_offset += (*ptr)-&gt;size;
<a name='L214'>                        <font color='red'>}</font>
<a name='L215'>
<a name='L216'>                        <i><font color='green'>/* Final merger cleanup.  */</font></i>
<a name='L217'>                        <b>for</b> (i = 0; i &lt; words; i++)
<a name='L218'>                        <font color='red'>{</font>
<a name='L219'>                                <i><font color='green'>/*      If one class is MEMORY, everything should be passed in</font></i>
<a name='L220'><i><font color='green'>                                        memory.  */</font></i>
<a name='L221'>                                <b>if</b> (classes[i] == X86_64_MEMORY_CLASS)
<a name='L222'>                                        <b>return</b> 0;
<a name='L223'>
<a name='L224'>                                <i><font color='green'>/*      The X86_64_SSEUP_CLASS should be always preceded by</font></i>
<a name='L225'><i><font color='green'>                                        X86_64_SSE_CLASS.  */</font></i>
<a name='L226'>                                <b>if</b> (classes[i] == X86_64_SSEUP_CLASS
<a name='L227'>                                        &amp;&amp; (i == 0 || classes[i - 1] != X86_64_SSE_CLASS))
<a name='L228'>                                        classes[i] = X86_64_SSE_CLASS;
<a name='L229'>
<a name='L230'>                                <i><font color='green'>/*  X86_64_X87UP_CLASS should be preceded by X86_64_X87_CLASS.  */</font></i>
<a name='L231'>                                <b>if</b> (classes[i] == X86_64_X87UP_CLASS
<a name='L232'>                                        &amp;&amp; (i == 0 || classes[i - 1] != X86_64_X87_CLASS))
<a name='L233'>                                        classes[i] = X86_64_SSE_CLASS;
<a name='L234'>                        <font color='red'>}</font>
<a name='L235'>
<a name='L236'>                        <b>return</b> words;
<a name='L237'>                <font color='red'>}</font>
<a name='L238'>
<a name='L239'>                <b>default</b>:
<a name='L240'>                        <a href='../D/1120.html' title='Multiple defined in 8 places.'>FFI_ASSERT</a>(0);
<a name='L241'>        <font color='red'>}</font>
<a name='L242'>
<a name='L243'>        <b>return</b> 0; <i><font color='green'>/* Never reached.  */</font></i>
<a name='L244'><font color='red'>}</font>
<a name='L245'>
<a name='L246'><i><font color='green'>/*      Examine the argument and return set number of register required in each</font></i>
<a name='L247'><i><font color='green'>        class.  Return zero if parameter should be passed in memory, otherwise</font></i>
<a name='L248'><i><font color='green'>        the number of registers.  */</font></i>
<a name='L249'><b>static</b> <b>int</b>
<a name='L250'><a href='../R/7613.html' title='Multiple refered from 10 places.'>examine_argument</a>(
<a name='L251'>        ffi_type*                               type,
<a name='L252'>        <b>enum</b> x86_64_reg_class   classes[<a href='../D/2054.html' title='Multiple defined in 2 places.'>MAX_CLASSES</a>],
<a name='L253'>        <b>_Bool</b>                                   in_return,
<a name='L254'>        <b>int</b>*                                    pngpr,
<a name='L255'>        <b>int</b>*                                    pnsse)
<a name='L256'><font color='red'>{</font>
<a name='L257'>        <b>int</b>     n = <a href='../D/7431.html' title='Multiple defined in 2 places.'>classify_argument</a>(type, classes, 0);
<a name='L258'>        <b>int</b> ngpr = 0;
<a name='L259'>        <b>int</b>     nsse = 0;
<a name='L260'>        <b>int</b>     i;
<a name='L261'>
<a name='L262'>        <b>if</b> (n == 0)
<a name='L263'>                <b>return</b> 0;
<a name='L264'>
<a name='L265'>        <b>for</b> (i = 0; i &lt; n; ++i)
<a name='L266'>        <font color='red'>{</font>
<a name='L267'>                <b>switch</b> (classes[i])
<a name='L268'>                <font color='red'>{</font>
<a name='L269'>                        <b>case</b> X86_64_INTEGER_CLASS:
<a name='L270'>                        <b>case</b> X86_64_INTEGERSI_CLASS:
<a name='L271'>                                ngpr++;
<a name='L272'>                                <b>break</b>;
<a name='L273'>
<a name='L274'>                        <b>case</b> X86_64_SSE_CLASS:
<a name='L275'>                        <b>case</b> X86_64_SSESF_CLASS:
<a name='L276'>                        <b>case</b> X86_64_SSEDF_CLASS:
<a name='L277'>                                nsse++;
<a name='L278'>                                <b>break</b>;
<a name='L279'>
<a name='L280'>                        <b>case</b> X86_64_NO_CLASS:
<a name='L281'>                        <b>case</b> X86_64_SSEUP_CLASS:
<a name='L282'>                                <b>break</b>;
<a name='L283'>
<a name='L284'>                        <b>case</b> X86_64_X87_CLASS:
<a name='L285'>                        <b>case</b> X86_64_X87UP_CLASS:
<a name='L286'>                        <b>case</b> X86_64_COMPLEX_X87_CLASS:
<a name='L287'>                                <b>return</b> in_return != 0;
<a name='L288'>
<a name='L289'>                        <b>default</b>:
<a name='L290'>                                <a href='../S/2520.html#L152' title='Defined at 152 in Modules/_ctypes/libffi_arm_wince/fficonfig.h.'>abort</a>();
<a name='L291'>                <font color='red'>}</font>
<a name='L292'>        <font color='red'>}</font>
<a name='L293'>
<a name='L294'>        *pngpr = ngpr;
<a name='L295'>        *pnsse = nsse;
<a name='L296'>
<a name='L297'>        <b>return</b> n;
<a name='L298'><font color='red'>}</font>
<a name='L299'>
<a name='L300'><i><font color='green'>/* Perform machine dependent cif processing.  */</font></i>
<a name='L301'><a href='../D/8530.html' title='Multiple defined in 4 places.'>ffi_status</a>
<a name='L302'><a href='../R/7714.html' title='Multiple refered from 9 places.'>ffi_prep_cif_machdep</a>(
<a name='L303'>        ffi_cif*        cif)
<a name='L304'><font color='red'>{</font>
<a name='L305'>        <b>int</b>                                             gprcount = 0;
<a name='L306'>        <b>int</b>                                             ssecount = 0;
<a name='L307'>        <b>int</b>                                             <a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> = cif-&gt;rtype-&gt;type;
<a name='L308'>        <b>int</b>                                             i, avn, n, ngpr, nsse;
<a name='L309'>        <b>enum</b> <a href='../D/12393.html' title='Multiple defined in 2 places.'>x86_64_reg_class</a>   classes[<a href='../D/2054.html' title='Multiple defined in 2 places.'>MAX_CLASSES</a>];
<a name='L310'>        <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>                                  <a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>;
<a name='L311'>
<a name='L312'>        <b>if</b> (<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> != <a href='../D/1223.html' title='Multiple defined in 3 places.'>FFI_TYPE_VOID</a>)
<a name='L313'>        <font color='red'>{</font>
<a name='L314'>                n = <a href='../D/8401.html' title='Multiple defined in 2 places.'>examine_argument</a> (cif-&gt;rtype, classes, 1, &amp;ngpr, &amp;nsse);
<a name='L315'>
<a name='L316'>                <b>if</b> (n == 0)
<a name='L317'>                <font color='red'>{</font>
<a name='L318'>                        <i><font color='green'>/*      The return value is passed in memory.  A pointer to that</font></i>
<a name='L319'><i><font color='green'>                                memory is the first argument.  Allocate a register for it.  */</font></i>
<a name='L320'>                        gprcount++;
<a name='L321'>
<a name='L322'>                        <i><font color='green'>/* We don't have to do anything in asm for the return.  */</font></i>
<a name='L323'>                        <a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> = <a href='../D/1223.html' title='Multiple defined in 3 places.'>FFI_TYPE_VOID</a>;
<a name='L324'>                <font color='red'>}</font>
<a name='L325'>                <b>else</b> <b>if</b> (<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> == <a href='../D/1202.html' title='Multiple defined in 3 places.'>FFI_TYPE_STRUCT</a>)
<a name='L326'>                <font color='red'>{</font>
<a name='L327'>                        <i><font color='green'>/* Mark which registers the result appears in.  */</font></i>
<a name='L328'>                        <b>_Bool</b> sse0 = <a href='../D/4906.html' title='Multiple defined in 2 places.'>SSE_CLASS_P</a>(classes[0]);
<a name='L329'>                        <b>_Bool</b> sse1 = n == 2 &amp;&amp; <a href='../D/4906.html' title='Multiple defined in 2 places.'>SSE_CLASS_P</a>(classes[1]);
<a name='L330'>
<a name='L331'>                        <b>if</b> (sse0 &amp;&amp; !sse1)
<a name='L332'>                                <a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> |= 1 &lt;&lt; 8;
<a name='L333'>                        <b>else</b> <b>if</b> (!sse0 &amp;&amp; sse1)
<a name='L334'>                                <a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> |= 1 &lt;&lt; 9;
<a name='L335'>                        <b>else</b> <b>if</b> (sse0 &amp;&amp; sse1)
<a name='L336'>                                <a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> |= 1 &lt;&lt; 10;
<a name='L337'>
<a name='L338'>                        <i><font color='green'>/* Mark the true size of the structure.  */</font></i>
<a name='L339'>                        <a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> |= cif-&gt;rtype-&gt;size &lt;&lt; 12;
<a name='L340'>                <font color='red'>}</font>
<a name='L341'>        <font color='red'>}</font>
<a name='L342'>
<a name='L343'>        <i><font color='green'>/*      Go over all arguments and determine the way they should be passed.</font></i>
<a name='L344'><i><font color='green'>                If it's in a register and there is space for it, let that be so. If</font></i>
<a name='L345'><i><font color='green'>                not, add it's size to the stack byte count.  */</font></i>
<a name='L346'>        <b>for</b> (<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> = 0, i = 0, avn = cif-&gt;nargs; i &lt; avn; i++)
<a name='L347'>        <font color='red'>{</font>
<a name='L348'>                <b>if</b> (<a href='../D/8401.html' title='Multiple defined in 2 places.'>examine_argument</a>(cif-&gt;arg_types[i], classes, 0, &amp;ngpr, &amp;nsse) == 0
<a name='L349'>                        || gprcount + ngpr &gt; <a href='../D/2062.html' title='Multiple defined in 2 places.'>MAX_GPR_REGS</a>
<a name='L350'>                        || ssecount + nsse &gt; <a href='../D/2083.html' title='Multiple defined in 2 places.'>MAX_SSE_REGS</a>)
<a name='L351'>                <font color='red'>{</font>
<a name='L352'>                        <b>long</b> <a href='../S/2613.html#L1149' title='Defined at 1149 in Modules/_struct.c.'>align</a> = cif-&gt;arg_types[i]-&gt;alignment;
<a name='L353'>
<a name='L354'>                        <b>if</b> (<a href='../S/2613.html#L1149' title='Defined at 1149 in Modules/_struct.c.'>align</a> &lt; 8)
<a name='L355'>                                <a href='../S/2613.html#L1149' title='Defined at 1149 in Modules/_struct.c.'>align</a> = 8;
<a name='L356'>
<a name='L357'>                        <a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>, <a href='../S/2613.html#L1149' title='Defined at 1149 in Modules/_struct.c.'>align</a>);
<a name='L358'>                        <a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> += cif-&gt;arg_types[i]-&gt;size;
<a name='L359'>                <font color='red'>}</font>
<a name='L360'>                <b>else</b>
<a name='L361'>                <font color='red'>{</font>
<a name='L362'>                        gprcount += ngpr;
<a name='L363'>                        ssecount += nsse;
<a name='L364'>                <font color='red'>}</font>
<a name='L365'>        <font color='red'>}</font>
<a name='L366'>
<a name='L367'>        <b>if</b> (ssecount)
<a name='L368'>                <a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> |= 1 &lt;&lt; 11;
<a name='L369'>
<a name='L370'>        cif-&gt;<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> = <a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a>;
<a name='L371'>        cif-&gt;<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> = <a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>;
<a name='L372'>
<a name='L373'>        <b>return</b> <a href='../D/1165.html' title='Multiple defined in 3 places.'>FFI_OK</a>;
<a name='L374'><font color='red'>}</font>
<a name='L375'>
<a name='L376'><b>void</b>
<a name='L377'><a href='../R/7684.html' title='Multiple refered from 112 places.'>ffi_call</a>(
<a name='L378'>        ffi_cif*        cif,
<a name='L379'>        <b>void</b>            (*fn)(),
<a name='L380'>        <b>void</b>*           rvalue,
<a name='L381'>        <b>void</b>**          avalue)
<a name='L382'><font color='red'>{</font>
<a name='L383'>        <b>enum</b> <a href='../D/12393.html' title='Multiple defined in 2 places.'>x86_64_reg_class</a>   classes[<a href='../D/2054.html' title='Multiple defined in 2 places.'>MAX_CLASSES</a>];
<a name='L384'>        <b>char</b>*                                   <a href='../S/2844.html#L22' title='Defined at 22 in Parser/parser.h.'>stack</a>;
<a name='L385'>        <b>char</b>*                                   argp;
<a name='L386'>        <a href='../D/8534.html' title='Multiple defined in 3 places.'>ffi_type</a>**                              arg_types;
<a name='L387'>        <b>int</b>                                             gprcount, ssecount, ngpr, nsse, i, avn;
<a name='L388'>        <b>_Bool</b>                                   ret_in_memory;
<a name='L389'>        <a href='../D/4545.html' title='Multiple defined in 2 places.'>RegisterArgs</a>*                   reg_args;
<a name='L390'>
<a name='L391'>        <i><font color='green'>/* Can't call 32-bit mode from 64-bit mode.  */</font></i>
<a name='L392'>        <a href='../D/1120.html' title='Multiple defined in 8 places.'>FFI_ASSERT</a>(cif-&gt;abi == <a href='../D/1225.html' title='Multiple defined in 4 places.'>FFI_UNIX64</a>);
<a name='L393'>
<a name='L394'>        <i><font color='green'>/*      If the return value is a struct and we don't have a return value</font></i>
<a name='L395'><i><font color='green'>                address then we need to make one.  Note the setting of flags to</font></i>
<a name='L396'><i><font color='green'>                VOID above in ffi_prep_cif_machdep.  */</font></i>
<a name='L397'>        ret_in_memory = (cif-&gt;rtype-&gt;type == <a href='../D/1202.html' title='Multiple defined in 3 places.'>FFI_TYPE_STRUCT</a>
<a name='L398'>                &amp;&amp; (cif-&gt;<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> &amp; 0xff) == <a href='../D/1223.html' title='Multiple defined in 3 places.'>FFI_TYPE_VOID</a>);
<a name='L399'>
<a name='L400'>        <b>if</b> (rvalue == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; ret_in_memory)
<a name='L401'>                rvalue = <a href='../D/6714.html' title='Multiple defined in 6 places.'>alloca</a> (cif-&gt;rtype-&gt;size);
<a name='L402'>
<a name='L403'>        <i><font color='green'>/* Allocate the space for the arguments, plus 4 words of temp space.  */</font></i>
<a name='L404'>        <a href='../S/2844.html#L22' title='Defined at 22 in Parser/parser.h.'>stack</a> = <a href='../D/6714.html' title='Multiple defined in 6 places.'>alloca</a>(<b>sizeof</b>(<a href='../D/4545.html' title='Multiple defined in 2 places.'>RegisterArgs</a>) + cif-&gt;<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> + 4 * 8);
<a name='L405'>        reg_args = (<a href='../D/4545.html' title='Multiple defined in 2 places.'>RegisterArgs</a>*)<a href='../S/2844.html#L22' title='Defined at 22 in Parser/parser.h.'>stack</a>;
<a name='L406'>        argp = <a href='../S/2844.html#L22' title='Defined at 22 in Parser/parser.h.'>stack</a> + <b>sizeof</b>(<a href='../D/4545.html' title='Multiple defined in 2 places.'>RegisterArgs</a>);
<a name='L407'>
<a name='L408'>        gprcount = ssecount = 0;
<a name='L409'>
<a name='L410'>        <i><font color='green'>/*      If the return value is passed in memory, add the pointer as the</font></i>
<a name='L411'><i><font color='green'>                first integer argument.  */</font></i>
<a name='L412'>        <b>if</b> (ret_in_memory)
<a name='L413'>                reg_args-&gt;gpr[gprcount++] = (<b>long</b>) rvalue;
<a name='L414'>
<a name='L415'>        avn = cif-&gt;nargs;
<a name='L416'>        arg_types = cif-&gt;arg_types;
<a name='L417'>
<a name='L418'>        <b>for</b> (i = 0; i &lt; avn; ++i)
<a name='L419'>        <font color='red'>{</font>
<a name='L420'>                <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> size = arg_types[i]-&gt;size;
<a name='L421'>                <b>int</b> n;
<a name='L422'>
<a name='L423'>                n = <a href='../D/8401.html' title='Multiple defined in 2 places.'>examine_argument</a> (arg_types[i], classes, 0, &amp;ngpr, &amp;nsse);
<a name='L424'>
<a name='L425'>                <b>if</b> (n == 0
<a name='L426'>                        || gprcount + ngpr &gt; <a href='../D/2062.html' title='Multiple defined in 2 places.'>MAX_GPR_REGS</a>
<a name='L427'>                        || ssecount + nsse &gt; <a href='../D/2083.html' title='Multiple defined in 2 places.'>MAX_SSE_REGS</a>)
<a name='L428'>                <font color='red'>{</font>
<a name='L429'>                        <b>long</b> <a href='../S/2613.html#L1149' title='Defined at 1149 in Modules/_struct.c.'>align</a> = arg_types[i]-&gt;alignment;
<a name='L430'>
<a name='L431'>                        <i><font color='green'>/* Stack arguments are *always* at least 8 byte aligned.  */</font></i>
<a name='L432'>                        <b>if</b> (<a href='../S/2613.html#L1149' title='Defined at 1149 in Modules/_struct.c.'>align</a> &lt; 8)
<a name='L433'>                                <a href='../S/2613.html#L1149' title='Defined at 1149 in Modules/_struct.c.'>align</a> = 8;
<a name='L434'>
<a name='L435'>                        <i><font color='green'>/* Pass this argument in memory.  */</font></i>
<a name='L436'>                        argp = (<b>void</b> *) <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a> (argp, <a href='../S/2613.html#L1149' title='Defined at 1149 in Modules/_struct.c.'>align</a>);
<a name='L437'>                        <a href='../D/9803.html' title='Multiple defined in 4 places.'>memcpy</a> (argp, avalue[i], size);
<a name='L438'>                        argp += size;
<a name='L439'>                <font color='red'>}</font>
<a name='L440'>                <b>else</b>
<a name='L441'>                <font color='red'>{</font>       <i><font color='green'>/* The argument is passed entirely in registers.  */</font></i>
<a name='L442'>                        <b>char</b> *a = (<b>char</b> *) avalue[i];
<a name='L443'>                        <b>int</b> j;
<a name='L444'>
<a name='L445'>                        <b>for</b> (j = 0; j &lt; n; j++, a += 8, size -= 8)
<a name='L446'>                        <font color='red'>{</font>
<a name='L447'>                                <b>switch</b> (classes[j])
<a name='L448'>                                <font color='red'>{</font>
<a name='L449'>                                        <b>case</b> X86_64_INTEGER_CLASS:
<a name='L450'>                                        <b>case</b> X86_64_INTEGERSI_CLASS:
<a name='L451'>                                                reg_args-&gt;gpr[gprcount] = 0;
<a name='L452'>                                                <a href='../D/9803.html' title='Multiple defined in 4 places.'>memcpy</a> (&amp;reg_args-&gt;gpr[gprcount], a, size &lt; 8 ? size : 8);
<a name='L453'>                                                gprcount++;
<a name='L454'>                                                <b>break</b>;
<a name='L455'>
<a name='L456'>                                        <b>case</b> X86_64_SSE_CLASS:
<a name='L457'>                                        <b>case</b> X86_64_SSEDF_CLASS:
<a name='L458'>                                                reg_args-&gt;sse[ssecount++] = *(<a href='../D/5331.html' title='Multiple defined in 7 places.'>UINT64</a> *) a;
<a name='L459'>                                                <b>break</b>;
<a name='L460'>
<a name='L461'>                                        <b>case</b> X86_64_SSESF_CLASS:
<a name='L462'>                                                reg_args-&gt;sse[ssecount++] = *(<a href='../D/5330.html' title='Multiple defined in 7 places.'>UINT32</a> *) a;
<a name='L463'>                                                <b>break</b>;
<a name='L464'>
<a name='L465'>                                        <b>default</b>:
<a name='L466'>                                                <a href='../S/2520.html#L152' title='Defined at 152 in Modules/_ctypes/libffi_arm_wince/fficonfig.h.'>abort</a>();
<a name='L467'>                                <font color='red'>}</font>
<a name='L468'>                        <font color='red'>}</font>
<a name='L469'>                <font color='red'>}</font>
<a name='L470'>        <font color='red'>}</font>
<a name='L471'>
<a name='L472'>        ffi_call_unix64 (<a href='../S/2844.html#L22' title='Defined at 22 in Parser/parser.h.'>stack</a>, cif-&gt;<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> + <b>sizeof</b>(<a href='../D/4545.html' title='Multiple defined in 2 places.'>RegisterArgs</a>),
<a name='L473'>                cif-&gt;<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a>, rvalue, <a href='../S/2334.html#L39' title='Defined at 39 in Modules/_ctypes/libffi/src/mips/n32.S.'>fn</a>, ssecount);
<a name='L474'><font color='red'>}</font>
<a name='L475'>
<a name='L476'><b>extern</b> <b>void</b> ffi_closure_unix64(<b>void</b>);
<a name='L477'>
<a name='L478'><a href='../D/8530.html' title='Multiple defined in 4 places.'>ffi_status</a>
<a name='L479'><a href='../R/7715.html' title='Multiple refered from 3 places.'>ffi_prep_closure</a>(
<a name='L480'>        ffi_closure*    closure,
<a name='L481'>        ffi_cif*                cif,
<a name='L482'>        <b>void</b>                    (*fun)(ffi_cif*, <b>void</b>*, <b>void</b>**, <b>void</b>*),
<a name='L483'>        <b>void</b>*                   user_data)
<a name='L484'><font color='red'>{</font>
<a name='L485'>        <b>if</b> (cif-&gt;abi != <a href='../D/1225.html' title='Multiple defined in 4 places.'>FFI_UNIX64</a>)
<a name='L486'>                <b>return</b> <a href='../D/1123.html' title='Multiple defined in 3 places.'>FFI_BAD_ABI</a>;
<a name='L487'>
<a name='L488'>        <b>volatile</b> <b>unsigned</b> <b>short</b>*        tramp =
<a name='L489'>                (<b>volatile</b> <b>unsigned</b> <b>short</b>*)&amp;closure-&gt;tramp[0];
<a name='L490'>
<a name='L491'>        tramp[0] = 0xbb49;              <i><font color='green'>/* mov &lt;code&gt;, %r11     */</font></i>
<a name='L492'>        *(<b>void</b>* <b>volatile</b>*)&amp;tramp[1] = ffi_closure_unix64;
<a name='L493'>        tramp[5] = 0xba49;              <i><font color='green'>/* mov &lt;data&gt;, %r10     */</font></i>
<a name='L494'>        *(<b>void</b>* <b>volatile</b>*)&amp;tramp[6] = closure;
<a name='L495'>
<a name='L496'>        <i><font color='green'>/*      Set the carry bit if the function uses any sse registers.</font></i>
<a name='L497'><i><font color='green'>                This is clc or stc, together with the first byte of the jmp.  */</font></i>
<a name='L498'>        tramp[10] = cif-&gt;<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> &amp; (1 &lt;&lt; 11) ? 0x49f9 : 0x49f8;
<a name='L499'>        tramp[11] = 0xe3ff;                     <i><font color='green'>/* jmp *%r11    */</font></i>
<a name='L500'>
<a name='L501'>        closure-&gt;cif = cif;
<a name='L502'>        closure-&gt;fun = fun;
<a name='L503'>        closure-&gt;user_data = user_data;
<a name='L504'>
<a name='L505'>        <b>return</b> <a href='../D/1165.html' title='Multiple defined in 3 places.'>FFI_OK</a>;
<a name='L506'><font color='red'>}</font>
<a name='L507'>
<a name='L508'><b>int</b>
<a name='L509'><a href='../R/7698.html' title='Multiple refered from 2 places.'>ffi_closure_unix64_inner</a>(
<a name='L510'>        ffi_closure*    closure,
<a name='L511'>        <b>void</b>*                   rvalue,
<a name='L512'>        RegisterArgs*   reg_args,
<a name='L513'>        <b>char</b>*                   argp)
<a name='L514'><font color='red'>{</font>
<a name='L515'>        <a href='../D/8477.html' title='Multiple defined in 4 places.'>ffi_cif</a>*        cif = closure-&gt;cif;
<a name='L516'>        <b>void</b>**          avalue = <a href='../D/6714.html' title='Multiple defined in 6 places.'>alloca</a>(cif-&gt;nargs * <b>sizeof</b>(<b>void</b> *));
<a name='L517'>        <a href='../D/8534.html' title='Multiple defined in 3 places.'>ffi_type</a>**      arg_types;
<a name='L518'>        <b>long</b>            i, avn;
<a name='L519'>        <b>int</b>                     gprcount = 0;
<a name='L520'>        <b>int</b>                     ssecount = 0;
<a name='L521'>        <b>int</b>                     ngpr, nsse;
<a name='L522'>        <b>int</b>                     ret;
<a name='L523'>
<a name='L524'>        ret = cif-&gt;rtype-&gt;type;
<a name='L525'>
<a name='L526'>        <b>if</b> (ret != <a href='../D/1223.html' title='Multiple defined in 3 places.'>FFI_TYPE_VOID</a>)
<a name='L527'>    <font color='red'>{</font>
<a name='L528'>                <b>enum</b> <a href='../D/12393.html' title='Multiple defined in 2 places.'>x86_64_reg_class</a> classes[<a href='../D/2054.html' title='Multiple defined in 2 places.'>MAX_CLASSES</a>];
<a name='L529'>                <b>int</b> n = <a href='../D/8401.html' title='Multiple defined in 2 places.'>examine_argument</a> (cif-&gt;rtype, classes, 1, &amp;ngpr, &amp;nsse);
<a name='L530'>
<a name='L531'>                <b>if</b> (n == 0)
<a name='L532'>                <font color='red'>{</font>
<a name='L533'>                        <i><font color='green'>/* The return value goes in memory.  Arrange for the closure</font></i>
<a name='L534'><i><font color='green'>                        return value to go directly back to the original caller.  */</font></i>
<a name='L535'>                        rvalue = (<b>void</b> *) reg_args-&gt;gpr[gprcount++];
<a name='L536'>
<a name='L537'>                        <i><font color='green'>/* We don't have to do anything in asm for the return.  */</font></i>
<a name='L538'>                        ret = <a href='../D/1223.html' title='Multiple defined in 3 places.'>FFI_TYPE_VOID</a>;
<a name='L539'>                <font color='red'>}</font>
<a name='L540'>                <b>else</b> <b>if</b> (ret == <a href='../D/1202.html' title='Multiple defined in 3 places.'>FFI_TYPE_STRUCT</a> &amp;&amp; n == 2)
<a name='L541'>                <font color='red'>{</font>
<a name='L542'>                        <i><font color='green'>/* Mark which register the second word of the structure goes in.  */</font></i>
<a name='L543'>                        <b>_Bool</b> sse0 = <a href='../D/4906.html' title='Multiple defined in 2 places.'>SSE_CLASS_P</a> (classes[0]);
<a name='L544'>                        <b>_Bool</b> sse1 = <a href='../D/4906.html' title='Multiple defined in 2 places.'>SSE_CLASS_P</a> (classes[1]);
<a name='L545'>
<a name='L546'>                        <b>if</b> (!sse0 &amp;&amp; sse1)
<a name='L547'>                                ret |= 1 &lt;&lt; 8;
<a name='L548'>                        <b>else</b> <b>if</b> (sse0 &amp;&amp; !sse1)
<a name='L549'>                                ret |= 1 &lt;&lt; 9;
<a name='L550'>                <font color='red'>}</font>
<a name='L551'>        <font color='red'>}</font>
<a name='L552'>
<a name='L553'>        avn = cif-&gt;nargs;
<a name='L554'>        arg_types = cif-&gt;arg_types;
<a name='L555'>
<a name='L556'>        <b>for</b> (i = 0; i &lt; avn; ++i)
<a name='L557'>        <font color='red'>{</font>
<a name='L558'>                <b>enum</b> <a href='../D/12393.html' title='Multiple defined in 2 places.'>x86_64_reg_class</a> classes[<a href='../D/2054.html' title='Multiple defined in 2 places.'>MAX_CLASSES</a>];
<a name='L559'>                <b>int</b> n;
<a name='L560'>
<a name='L561'>                n = <a href='../D/8401.html' title='Multiple defined in 2 places.'>examine_argument</a> (arg_types[i], classes, 0, &amp;ngpr, &amp;nsse);
<a name='L562'>
<a name='L563'>                <b>if</b> (n == 0
<a name='L564'>                        || gprcount + ngpr &gt; <a href='../D/2062.html' title='Multiple defined in 2 places.'>MAX_GPR_REGS</a>
<a name='L565'>                        || ssecount + nsse &gt; <a href='../D/2083.html' title='Multiple defined in 2 places.'>MAX_SSE_REGS</a>)
<a name='L566'>                <font color='red'>{</font>
<a name='L567'>                        <b>long</b> <a href='../S/2613.html#L1149' title='Defined at 1149 in Modules/_struct.c.'>align</a> = arg_types[i]-&gt;alignment;
<a name='L568'>
<a name='L569'>                        <i><font color='green'>/* Stack arguments are *always* at least 8 byte aligned.  */</font></i>
<a name='L570'>                        <b>if</b> (<a href='../S/2613.html#L1149' title='Defined at 1149 in Modules/_struct.c.'>align</a> &lt; 8)
<a name='L571'>                                <a href='../S/2613.html#L1149' title='Defined at 1149 in Modules/_struct.c.'>align</a> = 8;
<a name='L572'>
<a name='L573'>                        <i><font color='green'>/* Pass this argument in memory.  */</font></i>
<a name='L574'>                        argp = (<b>void</b> *) <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a> (argp, <a href='../S/2613.html#L1149' title='Defined at 1149 in Modules/_struct.c.'>align</a>);
<a name='L575'>                        avalue[i] = argp;
<a name='L576'>                        argp += arg_types[i]-&gt;size;
<a name='L577'>                <font color='red'>}</font>
<a name='L578'>
<a name='L579'><font color='darkred'>#if</font> !<b>defined</b>(<a href='../S/2537.html#L61' title='Defined at 61 in Modules/_ctypes/libffi_osx/include/ffi.h.'>X86_DARWIN</a>)
<a name='L580'>                <i><font color='green'>/*      If the argument is in a single register, or two consecutive</font></i>
<a name='L581'><i><font color='green'>                        registers, then we can use that address directly.  */</font></i>
<a name='L582'>                <b>else</b> <b>if</b> (n == 1 || (n == 2 &amp;&amp;
<a name='L583'>                   <a href='../D/4906.html' title='Multiple defined in 2 places.'>SSE_CLASS_P</a> (classes[0]) == <a href='../D/4906.html' title='Multiple defined in 2 places.'>SSE_CLASS_P</a> (classes[1])))
<a name='L584'>                <font color='red'>{</font>
<a name='L585'>                        <i><font color='green'>// The argument is in a single register.</font></i>
<a name='L586'>                        <b>if</b> (<a href='../D/4906.html' title='Multiple defined in 2 places.'>SSE_CLASS_P</a> (classes[0]))
<a name='L587'>                        <font color='red'>{</font>
<a name='L588'>                                avalue[i] = &amp;reg_args-&gt;sse[ssecount];
<a name='L589'>                                ssecount += n;
<a name='L590'>                        <font color='red'>}</font>
<a name='L591'>                        <b>else</b>
<a name='L592'>                        <font color='red'>{</font>
<a name='L593'>                                avalue[i] = &amp;reg_args-&gt;gpr[gprcount];
<a name='L594'>                                gprcount += n;
<a name='L595'>                        <font color='red'>}</font>
<a name='L596'>                <font color='red'>}</font>
<a name='L597'><font color='darkred'>#endif</font>
<a name='L598'>
<a name='L599'>                <i><font color='green'>/* Otherwise, allocate space to make them consecutive.  */</font></i>
<a name='L600'>                <b>else</b>
<a name='L601'>                <font color='red'>{</font>
<a name='L602'>                        <b>char</b> *a = <a href='../D/6714.html' title='Multiple defined in 6 places.'>alloca</a> (16);
<a name='L603'>                        <b>int</b> j;
<a name='L604'>
<a name='L605'>                        avalue[i] = a;
<a name='L606'>
<a name='L607'>                        <b>for</b> (j = 0; j &lt; n; j++, a += 8)
<a name='L608'>                        <font color='red'>{</font>
<a name='L609'>                                <b>if</b> (<a href='../D/4906.html' title='Multiple defined in 2 places.'>SSE_CLASS_P</a> (classes[j]))
<a name='L610'>                                        <a href='../D/9803.html' title='Multiple defined in 4 places.'>memcpy</a> (a, &amp;reg_args-&gt;sse[ssecount++], 8);
<a name='L611'>                                <b>else</b>
<a name='L612'>                                        <a href='../D/9803.html' title='Multiple defined in 4 places.'>memcpy</a> (a, &amp;reg_args-&gt;gpr[gprcount++], 8);
<a name='L613'>                        <font color='red'>}</font>
<a name='L614'>                <font color='red'>}</font>
<a name='L615'>        <font color='red'>}</font>
<a name='L616'>
<a name='L617'>        <i><font color='green'>/* Invoke the closure.  */</font></i>
<a name='L618'>        closure-&gt;fun (cif, rvalue, avalue, closure-&gt;user_data);
<a name='L619'>
<a name='L620'>        <i><font color='green'>/* Tell assembly how to perform return type promotions.  */</font></i>
<a name='L621'>        <b>return</b> ret;
<a name='L622'><font color='red'>}</font>
<a name='L623'>
</pre>
<hr>
<a name='BOTTOM'>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L87'>[^]</a><a href='#L509'>[v]</a><a href='#TOP'>[top]</a>[bottom]<a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
</body>
</html>
