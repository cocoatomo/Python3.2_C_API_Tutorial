<html>
<head>
<title>Modules/_ctypes/libffi/src/sparc/ffi.c</title>
<meta name='robots' content='noindex,nofollow'>
<meta name='generator' content='GLOBAL-5.8.1'>
</head>
<body text='#191970' bgcolor='#f5f5dc' vlink='gray'>
<a name='TOP'><h2><a href='../mains.html'>root</a>/<a href='../files/3353.html'>Modules</a>/<a href='../files/3354.html'>_ctypes</a>/<a href='../files/3356.html'>libffi</a>/<a href='../files/3358.html'>src</a>/<a href='../files/3374.html'>sparc</a>/ffi.c</h2>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L36'>[^]</a><a href='#L549'>[v]</a>[top]<a href='#BOTTOM'>[bottom]</a><a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
<hr>
<h2>DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href='#L36' title='Defined at 36.'>ffi_prep_args_v8</a>
<li><a href='#L122' title='Defined at 122.'>ffi_prep_args_v9</a>
<li><a href='#L251' title='Defined at 251.'>ffi_prep_cif_machdep</a>
<li><a href='#L336' title='Defined at 336.'>ffi_v9_layout_struct</a>
<li><a href='#L378' title='Defined at 378.'>ffi_call</a>
<li><a href='#L439' title='Defined at 439.'>ffi_prep_closure_loc</a>
<li><a href='#L484' title='Defined at 484.'>ffi_closure_sparc_inner_v8</a>
<li><a href='#L549' title='Defined at 549.'>ffi_closure_sparc_inner_v9</a>
</ol>
<hr>
<pre>
<a name='L1'><i><font color='green'>/* -----------------------------------------------------------------------</font></i>
<a name='L2'><i><font color='green'>   ffi.c - Copyright (c) 1996, 2003, 2004, 2007, 2008 Red Hat, Inc.</font></i>
<a name='L3'><i><font color='green'>   </font></i>
<a name='L4'><i><font color='green'>   SPARC Foreign Function Interface </font></i>
<a name='L5'><i><font color='green'></font></i>
<a name='L6'><i><font color='green'>   Permission is hereby granted, free of charge, to any person obtaining</font></i>
<a name='L7'><i><font color='green'>   a copy of this software and associated documentation files (the</font></i>
<a name='L8'><i><font color='green'>   ``Software''), to deal in the Software without restriction, including</font></i>
<a name='L9'><i><font color='green'>   without limitation the rights to use, copy, modify, merge, publish,</font></i>
<a name='L10'><i><font color='green'>   distribute, sublicense, and/or sell copies of the Software, and to</font></i>
<a name='L11'><i><font color='green'>   permit persons to whom the Software is furnished to do so, subject to</font></i>
<a name='L12'><i><font color='green'>   the following conditions:</font></i>
<a name='L13'><i><font color='green'></font></i>
<a name='L14'><i><font color='green'>   The above copyright notice and this permission notice shall be included</font></i>
<a name='L15'><i><font color='green'>   in all copies or substantial portions of the Software.</font></i>
<a name='L16'><i><font color='green'></font></i>
<a name='L17'><i><font color='green'>   THE SOFTWARE IS PROVIDED ``AS IS'', WITHOUT WARRANTY OF ANY KIND,</font></i>
<a name='L18'><i><font color='green'>   EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF</font></i>
<a name='L19'><i><font color='green'>   MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND</font></i>
<a name='L20'><i><font color='green'>   NONINFRINGEMENT.  IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT</font></i>
<a name='L21'><i><font color='green'>   HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,</font></i>
<a name='L22'><i><font color='green'>   WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</font></i>
<a name='L23'><i><font color='green'>   OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER</font></i>
<a name='L24'><i><font color='green'>   DEALINGS IN THE SOFTWARE.</font></i>
<a name='L25'><i><font color='green'>   ----------------------------------------------------------------------- */</font></i>
<a name='L26'>
<a name='L27'><font color='darkred'>#include</font> &lt;<a href='../I/325.html'>ffi.h</a>&gt;
<a name='L28'><font color='darkred'>#include</font> &lt;<a href='../I/119.html'>ffi_common.h</a>&gt;
<a name='L29'>
<a name='L30'><font color='darkred'>#include</font> &lt;stdlib.h&gt;
<a name='L31'>
<a name='L32'>
<a name='L33'><i><font color='green'>/* ffi_prep_args is called by the assembly routine once stack space</font></i>
<a name='L34'><i><font color='green'>   has been allocated for the function's arguments */</font></i>
<a name='L35'>
<a name='L36'><b>void</b> <a href='../S/2366.html#L409' title='Refered from 409 in Modules/_ctypes/libffi/src/sparc/ffi.c.'>ffi_prep_args_v8</a>(<b>char</b> *stack, extended_cif *ecif)
<a name='L37'><font color='red'>{</font>
<a name='L38'>  <b>int</b> i;
<a name='L39'>  <b>void</b> **p_argv;
<a name='L40'>  <b>char</b> *argp;
<a name='L41'>  <a href='../D/8534.html' title='Multiple defined in 3 places.'>ffi_type</a> **p_arg;
<a name='L42'>
<a name='L43'>  <i><font color='green'>/* Skip 16 words for the window save area */</font></i>
<a name='L44'>  argp = <a href='../S/2844.html#L22' title='Defined at 22 in Parser/parser.h.'>stack</a> + 16*<b>sizeof</b>(<b>int</b>);
<a name='L45'>
<a name='L46'>  <i><font color='green'>/* This should only really be done when we are returning a structure,</font></i>
<a name='L47'><i><font color='green'>     however, it's faster just to do it all the time...</font></i>
<a name='L48'><i><font color='green'></font></i>
<a name='L49'><i><font color='green'>  if ( ecif-&gt;cif-&gt;rtype-&gt;type == FFI_TYPE_STRUCT ) */</font></i>
<a name='L50'>  *(<b>int</b> *) argp = (<b>long</b>)ecif-&gt;rvalue;
<a name='L51'>
<a name='L52'>  <i><font color='green'>/* And 1 word for the  structure return value. */</font></i>
<a name='L53'>  argp += <b>sizeof</b>(<b>int</b>);
<a name='L54'>
<a name='L55'><font color='darkred'>#ifdef</font> USING_PURIFY
<a name='L56'>  <i><font color='green'>/* Purify will probably complain in our assembly routine, unless we</font></i>
<a name='L57'><i><font color='green'>     zero out this memory. */</font></i>
<a name='L58'>
<a name='L59'>  ((<b>int</b>*)argp)[0] = 0;
<a name='L60'>  ((<b>int</b>*)argp)[1] = 0;
<a name='L61'>  ((<b>int</b>*)argp)[2] = 0;
<a name='L62'>  ((<b>int</b>*)argp)[3] = 0;
<a name='L63'>  ((<b>int</b>*)argp)[4] = 0;
<a name='L64'>  ((<b>int</b>*)argp)[5] = 0;
<a name='L65'><font color='darkred'>#endif</font>
<a name='L66'>
<a name='L67'>  p_argv = ecif-&gt;avalue;
<a name='L68'>
<a name='L69'>  <b>for</b> (i = ecif-&gt;cif-&gt;nargs, p_arg = ecif-&gt;cif-&gt;arg_types; i; i--, p_arg++)
<a name='L70'>    <font color='red'>{</font>
<a name='L71'>      <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> z;
<a name='L72'>
<a name='L73'>          <b>if</b> ((*p_arg)-&gt;type == <a href='../D/1202.html' title='Multiple defined in 3 places.'>FFI_TYPE_STRUCT</a>
<a name='L74'><font color='darkred'>#if</font> <a href='../D/1184.html' title='Multiple defined in 8 places.'>FFI_TYPE_LONGDOUBLE</a> != <a href='../D/1180.html' title='Multiple defined in 3 places.'>FFI_TYPE_DOUBLE</a>
<a name='L75'>              || (*p_arg)-&gt;type == <a href='../D/1184.html' title='Multiple defined in 8 places.'>FFI_TYPE_LONGDOUBLE</a>
<a name='L76'><font color='darkred'>#endif</font>
<a name='L77'>              )
<a name='L78'>            <font color='red'>{</font>
<a name='L79'>              *(<b>unsigned</b> <b>int</b> *) argp = (<b>unsigned</b> <b>long</b>)(* p_argv);
<a name='L80'>              z = <b>sizeof</b>(<b>int</b>);
<a name='L81'>            <font color='red'>}</font>
<a name='L82'>          <b>else</b>
<a name='L83'>            <font color='red'>{</font>
<a name='L84'>              z = (*p_arg)-&gt;size;
<a name='L85'>              <b>if</b> (z &lt; <b>sizeof</b>(<b>int</b>))
<a name='L86'>                <font color='red'>{</font>
<a name='L87'>                  z = <b>sizeof</b>(<b>int</b>);
<a name='L88'>                  <b>switch</b> ((*p_arg)-&gt;type)
<a name='L89'>                    <font color='red'>{</font>
<a name='L90'>                    <b>case</b> <a href='../D/1189.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT8</a>:
<a name='L91'>                      *(<b>signed</b> <b>int</b> *) argp = *(<a href='../D/4724.html' title='Multiple defined in 6 places.'>SINT8</a> *)(* p_argv);
<a name='L92'>                      <b>break</b>;
<a name='L93'>                      
<a name='L94'>                    <b>case</b> <a href='../D/1222.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT8</a>:
<a name='L95'>                      *(<b>unsigned</b> <b>int</b> *) argp = *(<a href='../D/5332.html' title='Multiple defined in 6 places.'>UINT8</a> *)(* p_argv);
<a name='L96'>                      <b>break</b>;
<a name='L97'>                      
<a name='L98'>                    <b>case</b> <a href='../D/1186.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT16</a>:
<a name='L99'>                      *(<b>signed</b> <b>int</b> *) argp = *(<a href='../D/4721.html' title='Multiple defined in 6 places.'>SINT16</a> *)(* p_argv);
<a name='L100'>                      <b>break</b>;
<a name='L101'>                      
<a name='L102'>                    <b>case</b> <a href='../D/1219.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT16</a>:
<a name='L103'>                      *(<b>unsigned</b> <b>int</b> *) argp = *(<a href='../D/5329.html' title='Multiple defined in 6 places.'>UINT16</a> *)(* p_argv);
<a name='L104'>                      <b>break</b>;
<a name='L105'>
<a name='L106'>                    <b>default</b>:
<a name='L107'>                      <a href='../D/1120.html' title='Multiple defined in 8 places.'>FFI_ASSERT</a>(0);
<a name='L108'>                    <font color='red'>}</font>
<a name='L109'>                <font color='red'>}</font>
<a name='L110'>              <b>else</b>
<a name='L111'>                <font color='red'>{</font>
<a name='L112'>                  <a href='../D/9803.html' title='Multiple defined in 4 places.'>memcpy</a>(argp, *p_argv, z);
<a name='L113'>                <font color='red'>}</font>
<a name='L114'>            <font color='red'>}</font>
<a name='L115'>          p_argv++;
<a name='L116'>          argp += z;
<a name='L117'>    <font color='red'>}</font>
<a name='L118'>  
<a name='L119'>  <b>return</b>;
<a name='L120'><font color='red'>}</font>
<a name='L121'>
<a name='L122'><b>int</b> <a href='../S/2366.html#L415' title='Refered from 415 in Modules/_ctypes/libffi/src/sparc/ffi.c.'>ffi_prep_args_v9</a>(<b>char</b> *stack, extended_cif *ecif)
<a name='L123'><font color='red'>{</font>
<a name='L124'>  <b>int</b> i, ret = 0;
<a name='L125'>  <b>int</b> tmp;
<a name='L126'>  <b>void</b> **p_argv;
<a name='L127'>  <b>char</b> *argp;
<a name='L128'>  <a href='../D/8534.html' title='Multiple defined in 3 places.'>ffi_type</a> **p_arg;
<a name='L129'>
<a name='L130'>  tmp = 0;
<a name='L131'>
<a name='L132'>  <i><font color='green'>/* Skip 16 words for the window save area */</font></i>
<a name='L133'>  argp = <a href='../S/2844.html#L22' title='Defined at 22 in Parser/parser.h.'>stack</a> + 16*<b>sizeof</b>(<b>long</b> <b>long</b>);
<a name='L134'>
<a name='L135'><font color='darkred'>#ifdef</font> USING_PURIFY
<a name='L136'>  <i><font color='green'>/* Purify will probably complain in our assembly routine, unless we</font></i>
<a name='L137'><i><font color='green'>     zero out this memory. */</font></i>
<a name='L138'>
<a name='L139'>  ((<b>long</b> <b>long</b>*)argp)[0] = 0;
<a name='L140'>  ((<b>long</b> <b>long</b>*)argp)[1] = 0;
<a name='L141'>  ((<b>long</b> <b>long</b>*)argp)[2] = 0;
<a name='L142'>  ((<b>long</b> <b>long</b>*)argp)[3] = 0;
<a name='L143'>  ((<b>long</b> <b>long</b>*)argp)[4] = 0;
<a name='L144'>  ((<b>long</b> <b>long</b>*)argp)[5] = 0;
<a name='L145'><font color='darkred'>#endif</font>
<a name='L146'>
<a name='L147'>  p_argv = ecif-&gt;avalue;
<a name='L148'>
<a name='L149'>  <b>if</b> (ecif-&gt;cif-&gt;rtype-&gt;type == <a href='../D/1202.html' title='Multiple defined in 3 places.'>FFI_TYPE_STRUCT</a> &amp;&amp;
<a name='L150'>      ecif-&gt;cif-&gt;rtype-&gt;size &gt; 32)
<a name='L151'>    <font color='red'>{</font>
<a name='L152'>      *(<b>unsigned</b> <b>long</b> <b>long</b> *) argp = (<b>unsigned</b> <b>long</b>)ecif-&gt;rvalue;
<a name='L153'>      argp += <b>sizeof</b>(<b>long</b> <b>long</b>);
<a name='L154'>      tmp = 1;
<a name='L155'>    <font color='red'>}</font>
<a name='L156'>
<a name='L157'>  <b>for</b> (i = 0, p_arg = ecif-&gt;cif-&gt;arg_types; i &lt; ecif-&gt;cif-&gt;nargs;
<a name='L158'>       i++, p_arg++)
<a name='L159'>    <font color='red'>{</font>
<a name='L160'>      <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> z;
<a name='L161'>
<a name='L162'>      z = (*p_arg)-&gt;size;
<a name='L163'>      <b>switch</b> ((*p_arg)-&gt;type)
<a name='L164'>        <font color='red'>{</font>
<a name='L165'>        <b>case</b> <a href='../D/1202.html' title='Multiple defined in 3 places.'>FFI_TYPE_STRUCT</a>:
<a name='L166'>          <b>if</b> (z &gt; 16)
<a name='L167'>            <font color='red'>{</font>
<a name='L168'>              <i><font color='green'>/* For structures larger than 16 bytes we pass reference.  */</font></i>
<a name='L169'>              *(<b>unsigned</b> <b>long</b> <b>long</b> *) argp = (<b>unsigned</b> <b>long</b>)* p_argv;
<a name='L170'>              argp += <b>sizeof</b>(<b>long</b> <b>long</b>);
<a name='L171'>              tmp++;
<a name='L172'>              p_argv++;
<a name='L173'>              <b>continue</b>;
<a name='L174'>            <font color='red'>}</font>
<a name='L175'>          <i><font color='green'>/* FALLTHROUGH */</font></i>
<a name='L176'>        <b>case</b> <a href='../D/1181.html' title='Multiple defined in 3 places.'>FFI_TYPE_FLOAT</a>:
<a name='L177'>        <b>case</b> <a href='../D/1180.html' title='Multiple defined in 3 places.'>FFI_TYPE_DOUBLE</a>:
<a name='L178'><font color='darkred'>#if</font> <a href='../D/1184.html' title='Multiple defined in 8 places.'>FFI_TYPE_LONGDOUBLE</a> != <a href='../D/1180.html' title='Multiple defined in 3 places.'>FFI_TYPE_DOUBLE</a>
<a name='L179'>        <b>case</b> <a href='../D/1184.html' title='Multiple defined in 8 places.'>FFI_TYPE_LONGDOUBLE</a>:
<a name='L180'><font color='darkred'>#endif</font>
<a name='L181'>          ret = 1; <i><font color='green'>/* We should promote into FP regs as well as integer.  */</font></i>
<a name='L182'>          <b>break</b>;
<a name='L183'>        <font color='red'>}</font>
<a name='L184'>      <b>if</b> (z &lt; <b>sizeof</b>(<b>long</b> <b>long</b>))
<a name='L185'>        <font color='red'>{</font>
<a name='L186'>          <b>switch</b> ((*p_arg)-&gt;type)
<a name='L187'>            <font color='red'>{</font>
<a name='L188'>            <b>case</b> <a href='../D/1189.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT8</a>:
<a name='L189'>              *(<b>signed</b> <b>long</b> <b>long</b> *) argp = *(<a href='../D/4724.html' title='Multiple defined in 6 places.'>SINT8</a> *)(* p_argv);
<a name='L190'>              <b>break</b>;
<a name='L191'>
<a name='L192'>            <b>case</b> <a href='../D/1222.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT8</a>:
<a name='L193'>              *(<b>unsigned</b> <b>long</b> <b>long</b> *) argp = *(<a href='../D/5332.html' title='Multiple defined in 6 places.'>UINT8</a> *)(* p_argv);
<a name='L194'>              <b>break</b>;
<a name='L195'>
<a name='L196'>            <b>case</b> <a href='../D/1186.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT16</a>:
<a name='L197'>              *(<b>signed</b> <b>long</b> <b>long</b> *) argp = *(<a href='../D/4721.html' title='Multiple defined in 6 places.'>SINT16</a> *)(* p_argv);
<a name='L198'>              <b>break</b>;
<a name='L199'>
<a name='L200'>            <b>case</b> <a href='../D/1219.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT16</a>:
<a name='L201'>              *(<b>unsigned</b> <b>long</b> <b>long</b> *) argp = *(<a href='../D/5329.html' title='Multiple defined in 6 places.'>UINT16</a> *)(* p_argv);
<a name='L202'>              <b>break</b>;
<a name='L203'>
<a name='L204'>            <b>case</b> <a href='../D/1187.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT32</a>:
<a name='L205'>              *(<b>signed</b> <b>long</b> <b>long</b> *) argp = *(<a href='../D/4722.html' title='Multiple defined in 6 places.'>SINT32</a> *)(* p_argv);
<a name='L206'>              <b>break</b>;
<a name='L207'>
<a name='L208'>            <b>case</b> <a href='../D/1220.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT32</a>:
<a name='L209'>              *(<b>unsigned</b> <b>long</b> <b>long</b> *) argp = *(<a href='../D/5330.html' title='Multiple defined in 7 places.'>UINT32</a> *)(* p_argv);
<a name='L210'>              <b>break</b>;
<a name='L211'>
<a name='L212'>            <b>case</b> <a href='../D/1181.html' title='Multiple defined in 3 places.'>FFI_TYPE_FLOAT</a>:
<a name='L213'>              *(<b>float</b> *) (argp + 4) = *(<a href='../D/1264.html' title='Multiple defined in 4 places.'>FLOAT32</a> *)(* p_argv); <i><font color='green'>/* Right justify */</font></i>
<a name='L214'>              <b>break</b>;
<a name='L215'>
<a name='L216'>            <b>case</b> <a href='../D/1202.html' title='Multiple defined in 3 places.'>FFI_TYPE_STRUCT</a>:
<a name='L217'>              <a href='../D/9803.html' title='Multiple defined in 4 places.'>memcpy</a>(argp, *p_argv, z);
<a name='L218'>              <b>break</b>;
<a name='L219'>
<a name='L220'>            <b>default</b>:
<a name='L221'>              <a href='../D/1120.html' title='Multiple defined in 8 places.'>FFI_ASSERT</a>(0);
<a name='L222'>            <font color='red'>}</font>
<a name='L223'>          z = <b>sizeof</b>(<b>long</b> <b>long</b>);
<a name='L224'>          tmp++;
<a name='L225'>        <font color='red'>}</font>
<a name='L226'>      <b>else</b> <b>if</b> (z == <b>sizeof</b>(<b>long</b> <b>long</b>))
<a name='L227'>        <font color='red'>{</font>
<a name='L228'>          <a href='../D/9803.html' title='Multiple defined in 4 places.'>memcpy</a>(argp, *p_argv, z);
<a name='L229'>          z = <b>sizeof</b>(<b>long</b> <b>long</b>);
<a name='L230'>          tmp++;
<a name='L231'>        <font color='red'>}</font>
<a name='L232'>      <b>else</b>
<a name='L233'>        <font color='red'>{</font>
<a name='L234'>          <b>if</b> ((tmp &amp; 1) &amp;&amp; (*p_arg)-&gt;alignment &gt; 8)
<a name='L235'>            <font color='red'>{</font>
<a name='L236'>              tmp++;
<a name='L237'>              argp += <b>sizeof</b>(<b>long</b> <b>long</b>);
<a name='L238'>            <font color='red'>}</font>
<a name='L239'>          <a href='../D/9803.html' title='Multiple defined in 4 places.'>memcpy</a>(argp, *p_argv, z);
<a name='L240'>          z = 2 * <b>sizeof</b>(<b>long</b> <b>long</b>);
<a name='L241'>          tmp += 2;
<a name='L242'>        <font color='red'>}</font>
<a name='L243'>      p_argv++;
<a name='L244'>      argp += z;
<a name='L245'>    <font color='red'>}</font>
<a name='L246'>
<a name='L247'>  <b>return</b> ret;
<a name='L248'><font color='red'>}</font>
<a name='L249'>
<a name='L250'><i><font color='green'>/* Perform machine dependent cif processing */</font></i>
<a name='L251'><a href='../D/8530.html' title='Multiple defined in 4 places.'>ffi_status</a> <a href='../R/7714.html' title='Multiple refered from 9 places.'>ffi_prep_cif_machdep</a>(ffi_cif *cif)
<a name='L252'><font color='red'>{</font>
<a name='L253'>  <b>int</b> wordsize;
<a name='L254'>
<a name='L255'>  <b>if</b> (cif-&gt;abi != <a href='../D/1228.html' title='Multiple defined in 2 places.'>FFI_V9</a>)
<a name='L256'>    <font color='red'>{</font>
<a name='L257'>      wordsize = 4;
<a name='L258'>
<a name='L259'>      <i><font color='green'>/* If we are returning a struct, this will already have been added.</font></i>
<a name='L260'><i><font color='green'>         Otherwise we need to add it because it's always got to be there! */</font></i>
<a name='L261'>
<a name='L262'>      <b>if</b> (cif-&gt;rtype-&gt;type != <a href='../D/1202.html' title='Multiple defined in 3 places.'>FFI_TYPE_STRUCT</a>)
<a name='L263'>        cif-&gt;<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> += wordsize;
<a name='L264'>
<a name='L265'>      <i><font color='green'>/* sparc call frames require that space is allocated for 6 args,</font></i>
<a name='L266'><i><font color='green'>         even if they aren't used. Make that space if necessary. */</font></i>
<a name='L267'>  
<a name='L268'>      <b>if</b> (cif-&gt;<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> &lt; 4*6+4)
<a name='L269'>        cif-&gt;<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> = 4*6+4;
<a name='L270'>    <font color='red'>}</font>
<a name='L271'>  <b>else</b>
<a name='L272'>    <font color='red'>{</font>
<a name='L273'>      wordsize = 8;
<a name='L274'>
<a name='L275'>      <i><font color='green'>/* sparc call frames require that space is allocated for 6 args,</font></i>
<a name='L276'><i><font color='green'>         even if they aren't used. Make that space if necessary. */</font></i>
<a name='L277'>  
<a name='L278'>      <b>if</b> (cif-&gt;<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> &lt; 8*6)
<a name='L279'>        cif-&gt;<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> = 8*6;
<a name='L280'>    <font color='red'>}</font>
<a name='L281'>
<a name='L282'>  <i><font color='green'>/* Adjust cif-&gt;bytes. to include 16 words for the window save area,</font></i>
<a name='L283'><i><font color='green'>     and maybe the struct/union return pointer area, */</font></i>
<a name='L284'>
<a name='L285'>  cif-&gt;<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> += 16 * wordsize;
<a name='L286'>
<a name='L287'>  <i><font color='green'>/* The stack must be 2 word aligned, so round bytes up</font></i>
<a name='L288'><i><font color='green'>     appropriately. */</font></i>
<a name='L289'>
<a name='L290'>  cif-&gt;<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(cif-&gt;<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>, 2 * wordsize);
<a name='L291'>
<a name='L292'>  <i><font color='green'>/* Set the return type flag */</font></i>
<a name='L293'>  <b>switch</b> (cif-&gt;rtype-&gt;type)
<a name='L294'>    <font color='red'>{</font>
<a name='L295'>    <b>case</b> <a href='../D/1223.html' title='Multiple defined in 3 places.'>FFI_TYPE_VOID</a>:
<a name='L296'>    <b>case</b> <a href='../D/1181.html' title='Multiple defined in 3 places.'>FFI_TYPE_FLOAT</a>:
<a name='L297'>    <b>case</b> <a href='../D/1180.html' title='Multiple defined in 3 places.'>FFI_TYPE_DOUBLE</a>:
<a name='L298'><font color='darkred'>#if</font> <a href='../D/1184.html' title='Multiple defined in 8 places.'>FFI_TYPE_LONGDOUBLE</a> != <a href='../D/1180.html' title='Multiple defined in 3 places.'>FFI_TYPE_DOUBLE</a>
<a name='L299'>    <b>case</b> <a href='../D/1184.html' title='Multiple defined in 8 places.'>FFI_TYPE_LONGDOUBLE</a>:
<a name='L300'><font color='darkred'>#endif</font>
<a name='L301'>      cif-&gt;<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> = cif-&gt;rtype-&gt;type;
<a name='L302'>      <b>break</b>;
<a name='L303'>
<a name='L304'>    <b>case</b> <a href='../D/1202.html' title='Multiple defined in 3 places.'>FFI_TYPE_STRUCT</a>:
<a name='L305'>      <b>if</b> (cif-&gt;abi == <a href='../D/1228.html' title='Multiple defined in 2 places.'>FFI_V9</a> &amp;&amp; cif-&gt;rtype-&gt;size &gt; 32)
<a name='L306'>        cif-&gt;<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> = <a href='../D/1223.html' title='Multiple defined in 3 places.'>FFI_TYPE_VOID</a>;
<a name='L307'>      <b>else</b>
<a name='L308'>        cif-&gt;<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> = <a href='../D/1202.html' title='Multiple defined in 3 places.'>FFI_TYPE_STRUCT</a>;
<a name='L309'>      <b>break</b>;
<a name='L310'>
<a name='L311'>    <b>case</b> <a href='../D/1189.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT8</a>:
<a name='L312'>    <b>case</b> <a href='../D/1222.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT8</a>:
<a name='L313'>    <b>case</b> <a href='../D/1186.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT16</a>:
<a name='L314'>    <b>case</b> <a href='../D/1219.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT16</a>:
<a name='L315'>      <b>if</b> (cif-&gt;abi == <a href='../D/1228.html' title='Multiple defined in 2 places.'>FFI_V9</a>)
<a name='L316'>        cif-&gt;<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> = <a href='../D/1182.html' title='Multiple defined in 3 places.'>FFI_TYPE_INT</a>;
<a name='L317'>      <b>else</b>
<a name='L318'>        cif-&gt;<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> = cif-&gt;rtype-&gt;type;
<a name='L319'>      <b>break</b>;
<a name='L320'>
<a name='L321'>    <b>case</b> <a href='../D/1188.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT64</a>:
<a name='L322'>    <b>case</b> <a href='../D/1221.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT64</a>:
<a name='L323'>      <b>if</b> (cif-&gt;abi == <a href='../D/1228.html' title='Multiple defined in 2 places.'>FFI_V9</a>)
<a name='L324'>        cif-&gt;<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> = <a href='../D/1182.html' title='Multiple defined in 3 places.'>FFI_TYPE_INT</a>;
<a name='L325'>      <b>else</b>
<a name='L326'>        cif-&gt;<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> = <a href='../D/1188.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT64</a>;
<a name='L327'>      <b>break</b>;
<a name='L328'>
<a name='L329'>    <b>default</b>:
<a name='L330'>      cif-&gt;<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> = <a href='../D/1182.html' title='Multiple defined in 3 places.'>FFI_TYPE_INT</a>;
<a name='L331'>      <b>break</b>;
<a name='L332'>    <font color='red'>}</font>
<a name='L333'>  <b>return</b> <a href='../D/1165.html' title='Multiple defined in 3 places.'>FFI_OK</a>;
<a name='L334'><font color='red'>}</font>
<a name='L335'>
<a name='L336'><b>int</b> <a href='../R/7746.html' title='Multiple refered from 3 places.'>ffi_v9_layout_struct</a>(ffi_type *arg, <b>int</b> off, <b>char</b> *ret, <b>char</b> *intg, <b>char</b> *flt)
<a name='L337'><font color='red'>{</font>
<a name='L338'>  <a href='../D/8534.html' title='Multiple defined in 3 places.'>ffi_type</a> **ptr = &amp;<a href='../D/6730.html' title='Multiple defined in 2 places.'>arg</a>-&gt;elements[0];
<a name='L339'>
<a name='L340'>  <b>while</b> (*ptr != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L341'>    <font color='red'>{</font>
<a name='L342'>      <b>if</b> (off &amp; ((*ptr)-&gt;alignment - 1))
<a name='L343'>        off = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(off, (*ptr)-&gt;alignment);
<a name='L344'>
<a name='L345'>      <b>switch</b> ((*ptr)-&gt;type)
<a name='L346'>        <font color='red'>{</font>
<a name='L347'>        <b>case</b> <a href='../D/1202.html' title='Multiple defined in 3 places.'>FFI_TYPE_STRUCT</a>:
<a name='L348'>          off = <a href='../S/2366.html#L336' title='Defined at 336 in Modules/_ctypes/libffi/src/sparc/ffi.c.'>ffi_v9_layout_struct</a>(*ptr, off, ret, intg, flt);
<a name='L349'>          off = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(off, <a href='../D/1169.html' title='Multiple defined in 9 places.'>FFI_SIZEOF_ARG</a>);
<a name='L350'>          <b>break</b>;
<a name='L351'>        <b>case</b> <a href='../D/1181.html' title='Multiple defined in 3 places.'>FFI_TYPE_FLOAT</a>:
<a name='L352'>        <b>case</b> <a href='../D/1180.html' title='Multiple defined in 3 places.'>FFI_TYPE_DOUBLE</a>:
<a name='L353'><font color='darkred'>#if</font> <a href='../D/1184.html' title='Multiple defined in 8 places.'>FFI_TYPE_LONGDOUBLE</a> != <a href='../D/1180.html' title='Multiple defined in 3 places.'>FFI_TYPE_DOUBLE</a>
<a name='L354'>        <b>case</b> <a href='../D/1184.html' title='Multiple defined in 8 places.'>FFI_TYPE_LONGDOUBLE</a>:
<a name='L355'><font color='darkred'>#endif</font>
<a name='L356'>          <a href='../S/2664.html#L75' title='Defined at 75 in Modules/expat/xmlparse.c.'>memmove</a>(ret + off, flt + off, (*ptr)-&gt;size);
<a name='L357'>          off += (*ptr)-&gt;size;
<a name='L358'>          <b>break</b>;
<a name='L359'>        <b>default</b>:
<a name='L360'>          <a href='../S/2664.html#L75' title='Defined at 75 in Modules/expat/xmlparse.c.'>memmove</a>(ret + off, intg + off, (*ptr)-&gt;size);
<a name='L361'>          off += (*ptr)-&gt;size;
<a name='L362'>          <b>break</b>;
<a name='L363'>        <font color='red'>}</font>
<a name='L364'>      ptr++;
<a name='L365'>    <font color='red'>}</font>
<a name='L366'>  <b>return</b> off;
<a name='L367'><font color='red'>}</font>
<a name='L368'>
<a name='L369'>
<a name='L370'><font color='darkred'>#ifdef</font> <a href='../S/2367.html#L33' title='Defined at 33 in Modules/_ctypes/libffi/src/sparc/ffitarget.h.'>SPARC64</a>
<a name='L371'><b>extern</b> <b>int</b> ffi_call_v9(<b>void</b> *, extended_cif *, <b>unsigned</b>, 
<a name='L372'>                       <b>unsigned</b>, <b>unsigned</b> *, <b>void</b> (*fn)(<b>void</b>));
<a name='L373'><font color='darkred'>#else</font>
<a name='L374'><b>extern</b> <b>int</b> ffi_call_v8(<b>void</b> *, extended_cif *, <b>unsigned</b>, 
<a name='L375'>                       <b>unsigned</b>, <b>unsigned</b> *, <b>void</b> (*fn)(<b>void</b>));
<a name='L376'><font color='darkred'>#endif</font>
<a name='L377'>
<a name='L378'><b>void</b> <a href='../R/7684.html' title='Multiple refered from 112 places.'>ffi_call</a>(ffi_cif *cif, <b>void</b> (*fn)(<b>void</b>), <b>void</b> *rvalue, <b>void</b> **avalue)
<a name='L379'><font color='red'>{</font>
<a name='L380'>  <a href='../D/8426.html' title='Multiple defined in 5 places.'>extended_cif</a> ecif;
<a name='L381'>  <b>void</b> *rval = rvalue;
<a name='L382'>
<a name='L383'>  ecif.cif = cif;
<a name='L384'>  ecif.avalue = avalue;
<a name='L385'>
<a name='L386'>  <i><font color='green'>/* If the return value is a struct and we don't have a return */</font></i>
<a name='L387'>  <i><font color='green'>/* value address then we need to make one                     */</font></i>
<a name='L388'>
<a name='L389'>  ecif.rvalue = rvalue;
<a name='L390'>  <b>if</b> (cif-&gt;rtype-&gt;type == <a href='../D/1202.html' title='Multiple defined in 3 places.'>FFI_TYPE_STRUCT</a>)
<a name='L391'>    <font color='red'>{</font>
<a name='L392'>      <b>if</b> (cif-&gt;rtype-&gt;size &lt;= 32)
<a name='L393'>        rval = <a href='../D/6714.html' title='Multiple defined in 6 places.'>alloca</a>(64);
<a name='L394'>      <b>else</b>
<a name='L395'>        <font color='red'>{</font>
<a name='L396'>          rval = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L397'>          <b>if</b> (rvalue == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L398'>            ecif.rvalue = <a href='../D/6714.html' title='Multiple defined in 6 places.'>alloca</a>(cif-&gt;rtype-&gt;size);
<a name='L399'>        <font color='red'>}</font>
<a name='L400'>    <font color='red'>}</font>
<a name='L401'>
<a name='L402'>  <b>switch</b> (cif-&gt;abi) 
<a name='L403'>    <font color='red'>{</font>
<a name='L404'>    <b>case</b> <a href='../D/1226.html' title='Multiple defined in 2 places.'>FFI_V8</a>:
<a name='L405'><font color='darkred'>#ifdef</font> <a href='../S/2367.html#L33' title='Defined at 33 in Modules/_ctypes/libffi/src/sparc/ffitarget.h.'>SPARC64</a>
<a name='L406'>      <i><font color='green'>/* We don't yet support calling 32bit code from 64bit */</font></i>
<a name='L407'>      <a href='../D/1120.html' title='Multiple defined in 8 places.'>FFI_ASSERT</a>(0);
<a name='L408'><font color='darkred'>#else</font>
<a name='L409'>      ffi_call_v8(<a href='../S/2366.html#L36' title='Defined at 36 in Modules/_ctypes/libffi/src/sparc/ffi.c.'>ffi_prep_args_v8</a>, &amp;ecif, cif-&gt;<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>, 
<a name='L410'>                  cif-&gt;<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a>, rvalue, <a href='../S/2334.html#L39' title='Defined at 39 in Modules/_ctypes/libffi/src/mips/n32.S.'>fn</a>);
<a name='L411'><font color='darkred'>#endif</font>
<a name='L412'>      <b>break</b>;
<a name='L413'>    <b>case</b> <a href='../D/1228.html' title='Multiple defined in 2 places.'>FFI_V9</a>:
<a name='L414'><font color='darkred'>#ifdef</font> <a href='../S/2367.html#L33' title='Defined at 33 in Modules/_ctypes/libffi/src/sparc/ffitarget.h.'>SPARC64</a>
<a name='L415'>      ffi_call_v9(<a href='../S/2366.html#L122' title='Defined at 122 in Modules/_ctypes/libffi/src/sparc/ffi.c.'>ffi_prep_args_v9</a>, &amp;ecif, cif-&gt;<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>,
<a name='L416'>                  cif-&gt;<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a>, rval, <a href='../S/2334.html#L39' title='Defined at 39 in Modules/_ctypes/libffi/src/mips/n32.S.'>fn</a>);
<a name='L417'>      <b>if</b> (rvalue &amp;&amp; rval &amp;&amp; cif-&gt;rtype-&gt;type == <a href='../D/1202.html' title='Multiple defined in 3 places.'>FFI_TYPE_STRUCT</a>)
<a name='L418'>        <a href='../S/2366.html#L336' title='Defined at 336 in Modules/_ctypes/libffi/src/sparc/ffi.c.'>ffi_v9_layout_struct</a>(cif-&gt;rtype, 0, (<b>char</b> *)rvalue, (<b>char</b> *)rval, ((<b>char</b> *)rval)+32);
<a name='L419'><font color='darkred'>#else</font>
<a name='L420'>      <i><font color='green'>/* And vice versa */</font></i>
<a name='L421'>      <a href='../D/1120.html' title='Multiple defined in 8 places.'>FFI_ASSERT</a>(0);
<a name='L422'><font color='darkred'>#endif</font>
<a name='L423'>      <b>break</b>;
<a name='L424'>    <b>default</b>:
<a name='L425'>      <a href='../D/1120.html' title='Multiple defined in 8 places.'>FFI_ASSERT</a>(0);
<a name='L426'>      <b>break</b>;
<a name='L427'>    <font color='red'>}</font>
<a name='L428'>
<a name='L429'><font color='red'>}</font>
<a name='L430'>
<a name='L431'>
<a name='L432'><font color='darkred'>#ifdef</font> <a href='../S/2367.html#L33' title='Defined at 33 in Modules/_ctypes/libffi/src/sparc/ffitarget.h.'>SPARC64</a>
<a name='L433'><b>extern</b> <b>void</b> ffi_closure_v9(<b>void</b>);
<a name='L434'><font color='darkred'>#else</font>
<a name='L435'><b>extern</b> <b>void</b> ffi_closure_v8(<b>void</b>);
<a name='L436'><font color='darkred'>#endif</font>
<a name='L437'>
<a name='L438'><a href='../D/8530.html' title='Multiple defined in 4 places.'>ffi_status</a>
<a name='L439'><a href='../R/7717.html' title='Multiple refered from 92 places.'>ffi_prep_closure_loc</a> (ffi_closure* closure,
<a name='L440'>                      ffi_cif* cif,
<a name='L441'>                      <b>void</b> (*fun)(ffi_cif*, <b>void</b>*, <b>void</b>**, <b>void</b>*),
<a name='L442'>                      <b>void</b> *user_data,
<a name='L443'>                      <b>void</b> *codeloc)
<a name='L444'><font color='red'>{</font>
<a name='L445'>  <b>unsigned</b> <b>int</b> *tramp = (<b>unsigned</b> <b>int</b> *) &amp;closure-&gt;tramp[0];
<a name='L446'>  <b>unsigned</b> <b>long</b> <a href='../S/2334.html#L39' title='Defined at 39 in Modules/_ctypes/libffi/src/mips/n32.S.'>fn</a>;
<a name='L447'><font color='darkred'>#ifdef</font> <a href='../S/2367.html#L33' title='Defined at 33 in Modules/_ctypes/libffi/src/sparc/ffitarget.h.'>SPARC64</a>
<a name='L448'>  <i><font color='green'>/* Trampoline address is equal to the closure address.  We take advantage</font></i>
<a name='L449'><i><font color='green'>     of that to reduce the trampoline size by 8 bytes. */</font></i>
<a name='L450'>  <a href='../D/1120.html' title='Multiple defined in 8 places.'>FFI_ASSERT</a> (cif-&gt;abi == <a href='../D/1228.html' title='Multiple defined in 2 places.'>FFI_V9</a>);
<a name='L451'>  <a href='../S/2334.html#L39' title='Defined at 39 in Modules/_ctypes/libffi/src/mips/n32.S.'>fn</a> = (<b>unsigned</b> <b>long</b>) ffi_closure_v9;
<a name='L452'>  tramp[0] = 0x83414000;        <i><font color='green'>/* rd   %pc, %g1        */</font></i>
<a name='L453'>  tramp[1] = 0xca586010;        <i><font color='green'>/* ldx  [%g1+16], %g5   */</font></i>
<a name='L454'>  tramp[2] = 0x81c14000;        <i><font color='green'>/* jmp  %g5             */</font></i>
<a name='L455'>  tramp[3] = 0x01000000;        <i><font color='green'>/* nop                  */</font></i>
<a name='L456'>  *((<b>unsigned</b> <b>long</b> *) &amp;tramp[4]) = <a href='../S/2334.html#L39' title='Defined at 39 in Modules/_ctypes/libffi/src/mips/n32.S.'>fn</a>;
<a name='L457'><font color='darkred'>#else</font>
<a name='L458'>  <b>unsigned</b> <b>long</b> ctx = (<b>unsigned</b> <b>long</b>) codeloc;
<a name='L459'>  <a href='../D/1120.html' title='Multiple defined in 8 places.'>FFI_ASSERT</a> (cif-&gt;abi == <a href='../D/1226.html' title='Multiple defined in 2 places.'>FFI_V8</a>);
<a name='L460'>  <a href='../S/2334.html#L39' title='Defined at 39 in Modules/_ctypes/libffi/src/mips/n32.S.'>fn</a> = (<b>unsigned</b> <b>long</b>) ffi_closure_v8;
<a name='L461'>  tramp[0] = 0x03000000 | <a href='../S/2334.html#L39' title='Defined at 39 in Modules/_ctypes/libffi/src/mips/n32.S.'>fn</a> &gt;&gt; 10;     <i><font color='green'>/* sethi %hi(fn), %g1   */</font></i>
<a name='L462'>  tramp[1] = 0x05000000 | ctx &gt;&gt; 10;    <i><font color='green'>/* sethi %hi(ctx), %g2  */</font></i>
<a name='L463'>  tramp[2] = 0x81c06000 | (<a href='../S/2334.html#L39' title='Defined at 39 in Modules/_ctypes/libffi/src/mips/n32.S.'>fn</a> &amp; 0x3ff); <i><font color='green'>/* jmp   %g1+%lo(fn)    */</font></i>
<a name='L464'>  tramp[3] = 0x8410a000 | (ctx &amp; 0x3ff);<i><font color='green'>/* or    %g2, %lo(ctx)  */</font></i>
<a name='L465'><font color='darkred'>#endif</font>
<a name='L466'>
<a name='L467'>  closure-&gt;cif = cif;
<a name='L468'>  closure-&gt;fun = fun;
<a name='L469'>  closure-&gt;user_data = user_data;
<a name='L470'>
<a name='L471'>  <i><font color='green'>/* Flush the Icache.  FIXME: alignment isn't certain, assume 8 bytes */</font></i>
<a name='L472'><font color='darkred'>#ifdef</font> <a href='../S/2367.html#L33' title='Defined at 33 in Modules/_ctypes/libffi/src/sparc/ffitarget.h.'>SPARC64</a>
<a name='L473'>  <b>asm</b> <b>volatile</b> ("flush  %0" : : "r" (closure) : "memory");
<a name='L474'>  <b>asm</b> <b>volatile</b> ("flush  %0" : : "r" (((<b>char</b> *) closure) + 8) : "memory");
<a name='L475'><font color='darkred'>#else</font>
<a name='L476'>  <b>asm</b> <b>volatile</b> ("iflush %0" : : "r" (closure) : "memory");
<a name='L477'>  <b>asm</b> <b>volatile</b> ("iflush %0" : : "r" (((<b>char</b> *) closure) + 8) : "memory");
<a name='L478'><font color='darkred'>#endif</font>
<a name='L479'>
<a name='L480'>  <b>return</b> <a href='../D/1165.html' title='Multiple defined in 3 places.'>FFI_OK</a>;
<a name='L481'><font color='red'>}</font>
<a name='L482'>
<a name='L483'><b>int</b>
<a name='L484'>ffi_closure_sparc_inner_v8(ffi_closure *closure,
<a name='L485'>  <b>void</b> *rvalue, <b>unsigned</b> <b>long</b> *gpr, <b>unsigned</b> <b>long</b> *scratch)
<a name='L486'><font color='red'>{</font>
<a name='L487'>  <a href='../D/8477.html' title='Multiple defined in 4 places.'>ffi_cif</a> *cif;
<a name='L488'>  <a href='../D/8534.html' title='Multiple defined in 3 places.'>ffi_type</a> **arg_types;
<a name='L489'>  <b>void</b> **avalue;
<a name='L490'>  <b>int</b> i, argn;
<a name='L491'>
<a name='L492'>  cif = closure-&gt;cif;
<a name='L493'>  arg_types = cif-&gt;arg_types;
<a name='L494'>  avalue = <a href='../D/6714.html' title='Multiple defined in 6 places.'>alloca</a>(cif-&gt;nargs * <b>sizeof</b>(<b>void</b> *));
<a name='L495'>
<a name='L496'>  <i><font color='green'>/* Copy the caller's structure return address so that the closure</font></i>
<a name='L497'><i><font color='green'>     returns the data directly to the caller.  */</font></i>
<a name='L498'>  <b>if</b> (cif-&gt;<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> == <a href='../D/1202.html' title='Multiple defined in 3 places.'>FFI_TYPE_STRUCT</a>
<a name='L499'><font color='darkred'>#if</font> <a href='../D/1184.html' title='Multiple defined in 8 places.'>FFI_TYPE_LONGDOUBLE</a> != <a href='../D/1180.html' title='Multiple defined in 3 places.'>FFI_TYPE_DOUBLE</a>  
<a name='L500'>      || cif-&gt;<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> == <a href='../D/1184.html' title='Multiple defined in 8 places.'>FFI_TYPE_LONGDOUBLE</a>
<a name='L501'><font color='darkred'>#endif</font>
<a name='L502'>     )
<a name='L503'>    rvalue = (<b>void</b> *) gpr[0];
<a name='L504'>
<a name='L505'>  <i><font color='green'>/* Always skip the structure return address.  */</font></i>
<a name='L506'>  argn = 1;
<a name='L507'>
<a name='L508'>  <i><font color='green'>/* Grab the addresses of the arguments from the stack frame.  */</font></i>
<a name='L509'>  <b>for</b> (i = 0; i &lt; cif-&gt;nargs; i++)
<a name='L510'>    <font color='red'>{</font>
<a name='L511'>      <b>if</b> (arg_types[i]-&gt;type == <a href='../D/1202.html' title='Multiple defined in 3 places.'>FFI_TYPE_STRUCT</a>
<a name='L512'><font color='darkred'>#if</font> <a href='../D/1184.html' title='Multiple defined in 8 places.'>FFI_TYPE_LONGDOUBLE</a> != <a href='../D/1180.html' title='Multiple defined in 3 places.'>FFI_TYPE_DOUBLE</a>
<a name='L513'>          || arg_types[i]-&gt;type == <a href='../D/1184.html' title='Multiple defined in 8 places.'>FFI_TYPE_LONGDOUBLE</a>
<a name='L514'><font color='darkred'>#endif</font>
<a name='L515'>         )
<a name='L516'>        <font color='red'>{</font>
<a name='L517'>          <i><font color='green'>/* Straight copy of invisible reference.  */</font></i>
<a name='L518'>          avalue[i] = (<b>void</b> *)gpr[argn++];
<a name='L519'>        <font color='red'>}</font>
<a name='L520'>      <b>else</b> <b>if</b> ((arg_types[i]-&gt;type == <a href='../D/1180.html' title='Multiple defined in 3 places.'>FFI_TYPE_DOUBLE</a>
<a name='L521'>               || arg_types[i]-&gt;type == <a href='../D/1188.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT64</a>
<a name='L522'>               || arg_types[i]-&gt;type == <a href='../D/1221.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT64</a>)
<a name='L523'>               <i><font color='green'>/* gpr is 8-byte aligned.  */</font></i>
<a name='L524'>               &amp;&amp; (argn % 2) != 0)
<a name='L525'>        <font color='red'>{</font>
<a name='L526'>          <i><font color='green'>/* Align on a 8-byte boundary.  */</font></i>
<a name='L527'>          scratch[0] = gpr[argn];
<a name='L528'>          scratch[1] = gpr[argn+1];
<a name='L529'>          avalue[i] = scratch;
<a name='L530'>          scratch -= 2;
<a name='L531'>          argn += 2;
<a name='L532'>        <font color='red'>}</font>
<a name='L533'>      <b>else</b>
<a name='L534'>        <font color='red'>{</font>
<a name='L535'>          <i><font color='green'>/* Always right-justify.  */</font></i>
<a name='L536'>          argn += <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(arg_types[i]-&gt;size, <a href='../D/1169.html' title='Multiple defined in 9 places.'>FFI_SIZEOF_ARG</a>) / <a href='../D/1169.html' title='Multiple defined in 9 places.'>FFI_SIZEOF_ARG</a>;
<a name='L537'>          avalue[i] = ((<b>char</b> *) &amp;gpr[argn]) - arg_types[i]-&gt;size;
<a name='L538'>        <font color='red'>}</font>
<a name='L539'>    <font color='red'>}</font>
<a name='L540'>
<a name='L541'>  <i><font color='green'>/* Invoke the closure.  */</font></i>
<a name='L542'>  (closure-&gt;fun) (cif, rvalue, avalue, closure-&gt;user_data);
<a name='L543'>
<a name='L544'>  <i><font color='green'>/* Tell ffi_closure_sparc how to perform return type promotions.  */</font></i>
<a name='L545'>  <b>return</b> cif-&gt;rtype-&gt;type;
<a name='L546'><font color='red'>}</font>
<a name='L547'>
<a name='L548'><b>int</b>
<a name='L549'>ffi_closure_sparc_inner_v9(ffi_closure *closure,
<a name='L550'>  <b>void</b> *rvalue, <b>unsigned</b> <b>long</b> *gpr, <b>double</b> *fpr)
<a name='L551'><font color='red'>{</font>
<a name='L552'>  <a href='../D/8477.html' title='Multiple defined in 4 places.'>ffi_cif</a> *cif;
<a name='L553'>  <a href='../D/8534.html' title='Multiple defined in 3 places.'>ffi_type</a> **arg_types;
<a name='L554'>  <b>void</b> **avalue;
<a name='L555'>  <b>int</b> i, argn, fp_slot_max;
<a name='L556'>
<a name='L557'>  cif = closure-&gt;cif;
<a name='L558'>  arg_types = cif-&gt;arg_types;
<a name='L559'>  avalue = <a href='../D/6714.html' title='Multiple defined in 6 places.'>alloca</a>(cif-&gt;nargs * <b>sizeof</b>(<b>void</b> *));
<a name='L560'>
<a name='L561'>  <i><font color='green'>/* Copy the caller's structure return address so that the closure</font></i>
<a name='L562'><i><font color='green'>     returns the data directly to the caller.  */</font></i>
<a name='L563'>  <b>if</b> (cif-&gt;<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> == <a href='../D/1223.html' title='Multiple defined in 3 places.'>FFI_TYPE_VOID</a>
<a name='L564'>      &amp;&amp; cif-&gt;rtype-&gt;type == <a href='../D/1202.html' title='Multiple defined in 3 places.'>FFI_TYPE_STRUCT</a>)
<a name='L565'>    <font color='red'>{</font>
<a name='L566'>      rvalue = (<b>void</b> *) gpr[0];
<a name='L567'>      <i><font color='green'>/* Skip the structure return address.  */</font></i>
<a name='L568'>      argn = 1;
<a name='L569'>    <font color='red'>}</font>
<a name='L570'>  <b>else</b>
<a name='L571'>    argn = 0;
<a name='L572'>
<a name='L573'>  fp_slot_max = 16 - argn;
<a name='L574'>
<a name='L575'>  <i><font color='green'>/* Grab the addresses of the arguments from the stack frame.  */</font></i>
<a name='L576'>  <b>for</b> (i = 0; i &lt; cif-&gt;nargs; i++)
<a name='L577'>    <font color='red'>{</font>
<a name='L578'>      <b>if</b> (arg_types[i]-&gt;type == <a href='../D/1202.html' title='Multiple defined in 3 places.'>FFI_TYPE_STRUCT</a>)
<a name='L579'>        <font color='red'>{</font>
<a name='L580'>          <b>if</b> (arg_types[i]-&gt;size &gt; 16)
<a name='L581'>            <font color='red'>{</font>
<a name='L582'>              <i><font color='green'>/* Straight copy of invisible reference.  */</font></i>
<a name='L583'>              avalue[i] = (<b>void</b> *)gpr[argn++];
<a name='L584'>            <font color='red'>}</font>
<a name='L585'>          <b>else</b>
<a name='L586'>            <font color='red'>{</font>
<a name='L587'>              <i><font color='green'>/* Left-justify.  */</font></i>
<a name='L588'>              <a href='../S/2366.html#L336' title='Defined at 336 in Modules/_ctypes/libffi/src/sparc/ffi.c.'>ffi_v9_layout_struct</a>(arg_types[i],
<a name='L589'>                                   0,
<a name='L590'>                                   (<b>char</b> *) &amp;gpr[argn],
<a name='L591'>                                   (<b>char</b> *) &amp;gpr[argn],
<a name='L592'>                                   (<b>char</b> *) &amp;fpr[argn]);
<a name='L593'>              avalue[i] = &amp;gpr[argn];
<a name='L594'>              argn += <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(arg_types[i]-&gt;size, <a href='../D/1169.html' title='Multiple defined in 9 places.'>FFI_SIZEOF_ARG</a>) / <a href='../D/1169.html' title='Multiple defined in 9 places.'>FFI_SIZEOF_ARG</a>;
<a name='L595'>            <font color='red'>}</font>
<a name='L596'>        <font color='red'>}</font>
<a name='L597'>      <b>else</b>
<a name='L598'>        <font color='red'>{</font>
<a name='L599'>          <i><font color='green'>/* Right-justify.  */</font></i>
<a name='L600'>          argn += <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(arg_types[i]-&gt;size, <a href='../D/1169.html' title='Multiple defined in 9 places.'>FFI_SIZEOF_ARG</a>) / <a href='../D/1169.html' title='Multiple defined in 9 places.'>FFI_SIZEOF_ARG</a>;
<a name='L601'>
<a name='L602'>          <i><font color='green'>/* Align on a 16-byte boundary.  */</font></i>
<a name='L603'><font color='darkred'>#if</font> <a href='../D/1184.html' title='Multiple defined in 8 places.'>FFI_TYPE_LONGDOUBLE</a> != <a href='../D/1180.html' title='Multiple defined in 3 places.'>FFI_TYPE_DOUBLE</a>
<a name='L604'>          <b>if</b> (arg_types[i]-&gt;type == <a href='../D/1184.html' title='Multiple defined in 8 places.'>FFI_TYPE_LONGDOUBLE</a> &amp;&amp; (argn % 2) != 0)
<a name='L605'>            argn++;
<a name='L606'><font color='darkred'>#endif</font>
<a name='L607'>          <b>if</b> (i &lt; fp_slot_max
<a name='L608'>              &amp;&amp; (arg_types[i]-&gt;type == <a href='../D/1181.html' title='Multiple defined in 3 places.'>FFI_TYPE_FLOAT</a>
<a name='L609'>                  || arg_types[i]-&gt;type == <a href='../D/1180.html' title='Multiple defined in 3 places.'>FFI_TYPE_DOUBLE</a>
<a name='L610'><font color='darkred'>#if</font> <a href='../D/1184.html' title='Multiple defined in 8 places.'>FFI_TYPE_LONGDOUBLE</a> != <a href='../D/1180.html' title='Multiple defined in 3 places.'>FFI_TYPE_DOUBLE</a>
<a name='L611'>                  || arg_types[i]-&gt;type == <a href='../D/1184.html' title='Multiple defined in 8 places.'>FFI_TYPE_LONGDOUBLE</a>
<a name='L612'><font color='darkred'>#endif</font>
<a name='L613'>                  ))
<a name='L614'>            avalue[i] = ((<b>char</b> *) &amp;fpr[argn]) - arg_types[i]-&gt;size;
<a name='L615'>          <b>else</b>
<a name='L616'>            avalue[i] = ((<b>char</b> *) &amp;gpr[argn]) - arg_types[i]-&gt;size;
<a name='L617'>        <font color='red'>}</font>
<a name='L618'>    <font color='red'>}</font>
<a name='L619'>
<a name='L620'>  <i><font color='green'>/* Invoke the closure.  */</font></i>
<a name='L621'>  (closure-&gt;fun) (cif, rvalue, avalue, closure-&gt;user_data);
<a name='L622'>
<a name='L623'>  <i><font color='green'>/* Tell ffi_closure_sparc how to perform return type promotions.  */</font></i>
<a name='L624'>  <b>return</b> cif-&gt;rtype-&gt;type;
<a name='L625'><font color='red'>}</font>
</pre>
<hr>
<a name='BOTTOM'>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L36'>[^]</a><a href='#L549'>[v]</a><a href='#TOP'>[top]</a>[bottom]<a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
</body>
</html>
