<html>
<head>
<title>Modules/timemodule.c</title>
<meta name='robots' content='noindex,nofollow'>
<meta name='generator' content='GLOBAL-5.8.1'>
</head>
<body text='#191970' bgcolor='#f5f5dc' vlink='gray'>
<a name='TOP'><h2><a href='../mains.html'>root</a>/<a href='../files/3353.html'>Modules</a>/timemodule.c</h2>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L28'>[^]</a><a href='#L978'>[v]</a>[top]<a href='#BOTTOM'>[bottom]</a><a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
<hr>
<h2>DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href='#L28' title='Defined at 28.'>PyCtrlHandler</a>
<li><a href='#L73' title='Defined at 73.'>time_time</a>
<li><a href='#L101' title='Defined at 101.'>time_clock</a>
<li><a href='#L110' title='Defined at 110.'>time_clock</a>
<li><a href='#L146' title='Defined at 146.'>time_sleep</a>
<li><a href='#L193' title='Defined at 193.'>tmtotuple</a>
<li><a href='#L220' title='Defined at 220.'>time_convert</a>
<li><a href='#L244' title='Defined at 244.'>parse_time_double_args</a>
<li><a href='#L262' title='Defined at 262.'>time_gmtime</a>
<li><a href='#L278' title='Defined at 278.'>time_localtime</a>
<li><a href='#L297' title='Defined at 297.'>gettmarg</a>
<li><a href='#L369' title='Defined at 369.'>checktm</a>
<li><a href='#L446' title='Defined at 446.'>time_strftime</a>
<li><a href='#L580' title='Defined at 580.'>time_strptime</a>
<li><a href='#L601' title='Defined at 601.'>_asctime</a>
<li><a href='#L633' title='Defined at 633.'>time_asctime</a>
<li><a href='#L656' title='Defined at 656.'>time_ctime</a>
<li><a href='#L691' title='Defined at 691.'>time_mktime</a>
<li><a href='#L719' title='Defined at 719.'>time_tzset</a>
<li><a href='#L753' title='Defined at 753.'>PyInit_timezone</a>
<li><a href='#L927' title='Defined at 927.'>PyInit_time</a>
<li><a href='#L965' title='Defined at 965.'>floattime</a>
<li><a href='#L978' title='Defined at 978.'>floatsleep</a>
</ol>
<hr>
<pre>
<a name='L1'><i><font color='green'>/* Time module */</font></i>
<a name='L2'>
<a name='L3'><font color='darkred'>#include</font> "<a href='570.html'>Python.h</a>"
<a name='L4'><font color='darkred'>#include</font> "<a href='2617.html'>_time.h</a>"
<a name='L5'>
<a name='L6'><font color='darkred'>#define</font> <a href='../R/4607.html' title='Multiple refered from 4 places.'>TZNAME_ENCODING</a> "utf-8"
<a name='L7'>
<a name='L8'><font color='darkred'>#include</font> &lt;<a href='2809.html'>ctype.h</a>&gt;
<a name='L9'>
<a name='L10'><font color='darkred'>#ifdef</font> <a href='../D/1582.html' title='Multiple defined in 4 places.'>HAVE_SYS_TYPES_H</a>
<a name='L11'><font color='darkred'>#include</font> &lt;sys/types.h&gt;
<a name='L12'><font color='darkred'>#endif</font> <i><font color='green'>/* HAVE_SYS_TYPES_H */</font></i>
<a name='L13'>
<a name='L14'><font color='darkred'>#ifdef</font> QUICKWIN
<a name='L15'><font color='darkred'>#include</font> &lt;io.h&gt;
<a name='L16'><font color='darkred'>#endif</font>
<a name='L17'>
<a name='L18'><font color='darkred'>#if</font> <b>defined</b>(__WATCOMC__) &amp;&amp; !<b>defined</b>(__QNX__)
<a name='L19'><font color='darkred'>#include</font> &lt;i86.h&gt;
<a name='L20'><font color='darkred'>#else</font>
<a name='L21'><font color='darkred'>#ifdef</font> <a href='../S/2906.html#L81' title='Defined at 81 in PC/pyconfig.h.'>MS_WINDOWS</a>
<a name='L22'><font color='darkred'>#define</font> WIN32_LEAN_AND_MEAN
<a name='L23'><font color='darkred'>#include</font> &lt;windows.h&gt;
<a name='L24'><font color='darkred'>#include</font> "<a href='572.html'>pythread.h</a>"
<a name='L25'>
<a name='L26'><i><font color='green'>/* helper to allow us to interrupt sleep() on Windows*/</font></i>
<a name='L27'><b>static</b> <a href='../S/2583.html#L40' title='Defined at 40 in Modules/_multiprocessing/multiprocessing.h.'>HANDLE</a> hInterruptEvent = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L28'><b>static</b> <a href='../S/2583.html#L42' title='Defined at 42 in Modules/_multiprocessing/multiprocessing.h.'>BOOL</a> WINAPI <a href='../S/2720.html#L952' title='Refered from 952 in Modules/timemodule.c.'>PyCtrlHandler</a>(DWORD dwCtrlType)
<a name='L29'><font color='red'>{</font>
<a name='L30'>    SetEvent(hInterruptEvent);
<a name='L31'>    <i><font color='green'>/* allow other default handlers to be called.</font></i>
<a name='L32'><i><font color='green'>       Default Python handler will setup the</font></i>
<a name='L33'><i><font color='green'>       KeyboardInterrupt exception.</font></i>
<a name='L34'><i><font color='green'>    */</font></i>
<a name='L35'>    <b>return</b> <a href='../D/1087.html' title='Multiple defined in 3 places.'>FALSE</a>;
<a name='L36'><font color='red'>}</font>
<a name='L37'><b>static</b> <b>long</b> main_thread;
<a name='L38'>
<a name='L39'><font color='darkred'>#if</font> <b>defined</b>(__BORLANDC__)
<a name='L40'><i><font color='green'>/* These overrides not needed for Win32 */</font></i>
<a name='L41'><font color='darkred'>#define</font> <a href='../R/10913.html' title='Multiple refered from 6 places.'>timezone</a> _timezone
<a name='L42'><font color='darkred'>#define</font> <a href='../R/11034.html' title='Multiple refered from 2 places.'>tzname</a> _tzname
<a name='L43'><font color='darkred'>#define</font> <a href='../S/2720.html#L787' title='Refered from 787 in Modules/timemodule.c.'>daylight</a> _daylight
<a name='L44'><font color='darkred'>#endif</font> <i><font color='green'>/* __BORLANDC__ */</font></i>
<a name='L45'><font color='darkred'>#endif</font> <i><font color='green'>/* MS_WINDOWS */</font></i>
<a name='L46'><font color='darkred'>#endif</font> <i><font color='green'>/* !__WATCOMC__ || __QNX__ */</font></i>
<a name='L47'>
<a name='L48'><font color='darkred'>#if</font> <b>defined</b>(<a href='../S/2906.html#L81' title='Defined at 81 in PC/pyconfig.h.'>MS_WINDOWS</a>) &amp;&amp; !<b>defined</b>(__BORLANDC__)
<a name='L49'><i><font color='green'>/* Win32 has better clock replacement; we have our own version below. */</font></i>
<a name='L50'><font color='darkred'>#undef</font> <a href='../R/1321.html' title='Multiple refered from 3 places.'>HAVE_CLOCK</a>
<a name='L51'><font color='darkred'>#undef</font> <a href='../R/4607.html' title='Multiple refered from 4 places.'>TZNAME_ENCODING</a>
<a name='L52'><font color='darkred'>#define</font> <a href='../R/4607.html' title='Multiple refered from 4 places.'>TZNAME_ENCODING</a> "mbcs"
<a name='L53'><font color='darkred'>#endif</font> <i><font color='green'>/* MS_WINDOWS &amp;&amp; !defined(__BORLANDC__) */</font></i>
<a name='L54'>
<a name='L55'><font color='darkred'>#if</font> <b>defined</b>(<a href='../D/2567.html' title='Multiple defined in 2 places.'>PYOS_OS2</a>)
<a name='L56'><font color='darkred'>#define</font> INCL_DOS
<a name='L57'><font color='darkred'>#define</font> INCL_ERRORS
<a name='L58'><font color='darkred'>#include</font> &lt;os2.h&gt;
<a name='L59'><font color='darkred'>#endif</font>
<a name='L60'>
<a name='L61'><font color='darkred'>#if</font> <b>defined</b>(<a href='../S/2903.html#L66' title='Defined at 66 in PC/os2vacpp/pyconfig.h.'>PYCC_VACPP</a>)
<a name='L62'><font color='darkred'>#include</font> &lt;sys/time.h&gt;
<a name='L63'><font color='darkred'>#endif</font>
<a name='L64'>
<a name='L65'><i><font color='green'>/* Forward declarations */</font></i>
<a name='L66'><b>static</b> <b>int</b> <a href='../S/2720.html#L978' title='Defined at 978 in Modules/timemodule.c.'>floatsleep</a>(<b>double</b>);
<a name='L67'><b>static</b> <b>double</b> <a href='../S/2720.html#L965' title='Defined at 965 in Modules/timemodule.c.'>floattime</a>(<b>void</b>);
<a name='L68'>
<a name='L69'><i><font color='green'>/* For Y2K check */</font></i>
<a name='L70'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *moddict;
<a name='L71'>
<a name='L72'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L73'><a href='../R/10906.html' title='Multiple refered from 3 places.'>time_time</a>(PyObject *self, PyObject *unused)
<a name='L74'><font color='red'>{</font>
<a name='L75'>    <b>double</b> secs;
<a name='L76'>    secs = <a href='../S/2720.html#L965' title='Defined at 965 in Modules/timemodule.c.'>floattime</a>();
<a name='L77'>    <b>if</b> (secs == 0.0) <font color='red'>{</font>
<a name='L78'>        <a href='../S/3106.html#L452' title='Defined at 452 in Python/errors.c.'>PyErr_SetFromErrno</a>(PyExc_IOError);
<a name='L79'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L80'>    <font color='red'>}</font>
<a name='L81'>    <b>return</b> <a href='../S/2791.html#L157' title='Defined at 157 in Objects/floatobject.c.'>PyFloat_FromDouble</a>(secs);
<a name='L82'><font color='red'>}</font>
<a name='L83'>
<a name='L84'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(time_doc,
<a name='L85'>"time() -&gt; floating point number\n\
<a name='L86'>\n\
<a name='L87'>Return the current time in seconds since the Epoch.\n\
<a name='L88'>Fractions of a second may be present if the system clock provides them.");
<a name='L89'>
<a name='L90'><font color='darkred'>#ifdef</font> <a href='../D/1467.html' title='Multiple defined in 5 places.'>HAVE_CLOCK</a>
<a name='L91'>
<a name='L92'><font color='darkred'>#ifndef</font> <a href='../D/564.html' title='Multiple defined in 2 places.'>CLOCKS_PER_SEC</a>
<a name='L93'><font color='darkred'>#ifdef</font> CLK_TCK
<a name='L94'><font color='darkred'>#define</font> <a href='../R/527.html' title='Multiple refered from 4 places.'>CLOCKS_PER_SEC</a> CLK_TCK
<a name='L95'><font color='darkred'>#else</font>
<a name='L96'><font color='darkred'>#define</font> <a href='../R/527.html' title='Multiple refered from 4 places.'>CLOCKS_PER_SEC</a> 1000000
<a name='L97'><font color='darkred'>#endif</font>
<a name='L98'><font color='darkred'>#endif</font>
<a name='L99'>
<a name='L100'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L101'><a href='../S/2720.html#L846' title='Refered from 846 in Modules/timemodule.c.'>time_clock</a>(PyObject *self, PyObject *unused)
<a name='L102'><font color='red'>{</font>
<a name='L103'>    <b>return</b> <a href='../S/2791.html#L157' title='Defined at 157 in Objects/floatobject.c.'>PyFloat_FromDouble</a>(((<b>double</b>)clock()) / <a href='../D/564.html' title='Multiple defined in 2 places.'>CLOCKS_PER_SEC</a>);
<a name='L104'><font color='red'>}</font>
<a name='L105'><font color='darkred'>#endif</font> <i><font color='green'>/* HAVE_CLOCK */</font></i>
<a name='L106'>
<a name='L107'><font color='darkred'>#if</font> <b>defined</b>(<a href='../S/2906.html#L81' title='Defined at 81 in PC/pyconfig.h.'>MS_WINDOWS</a>) &amp;&amp; !<b>defined</b>(__BORLANDC__)
<a name='L108'><i><font color='green'>/* Due to Mark Hammond and Tim Peters */</font></i>
<a name='L109'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L110'><a href='../S/2720.html#L846' title='Refered from 846 in Modules/timemodule.c.'>time_clock</a>(PyObject *self, PyObject *unused)
<a name='L111'><font color='red'>{</font>
<a name='L112'>    <b>static</b> LARGE_INTEGER ctrStart;
<a name='L113'>    <b>static</b> <b>double</b> divisor = 0.0;
<a name='L114'>    LARGE_INTEGER now;
<a name='L115'>    <b>double</b> <a href='../S/3095.html#L906' title='Defined at 906 in Python/dtoa.c.'>diff</a>;
<a name='L116'>
<a name='L117'>    <b>if</b> (divisor == 0.0) <font color='red'>{</font>
<a name='L118'>        LARGE_INTEGER freq;
<a name='L119'>        QueryPerformanceCounter(&amp;ctrStart);
<a name='L120'>        <b>if</b> (!QueryPerformanceFrequency(&amp;freq) || freq.QuadPart == 0) <font color='red'>{</font>
<a name='L121'>            <i><font color='green'>/* Unlikely to happen - this works on all intel</font></i>
<a name='L122'><i><font color='green'>               machines at least!  Revert to clock() */</font></i>
<a name='L123'>            <b>return</b> <a href='../S/2791.html#L157' title='Defined at 157 in Objects/floatobject.c.'>PyFloat_FromDouble</a>(((<b>double</b>)clock()) /
<a name='L124'>                                      <a href='../D/564.html' title='Multiple defined in 2 places.'>CLOCKS_PER_SEC</a>);
<a name='L125'>        <font color='red'>}</font>
<a name='L126'>        divisor = (<b>double</b>)freq.QuadPart;
<a name='L127'>    <font color='red'>}</font>
<a name='L128'>    QueryPerformanceCounter(&amp;now);
<a name='L129'>    <a href='../S/3095.html#L906' title='Defined at 906 in Python/dtoa.c.'>diff</a> = (<b>double</b>)(now.QuadPart - ctrStart.QuadPart);
<a name='L130'>    <b>return</b> <a href='../S/2791.html#L157' title='Defined at 157 in Objects/floatobject.c.'>PyFloat_FromDouble</a>(<a href='../S/3095.html#L906' title='Defined at 906 in Python/dtoa.c.'>diff</a> / divisor);
<a name='L131'><font color='red'>}</font>
<a name='L132'>
<a name='L133'><font color='darkred'>#define</font> <a href='../R/1321.html' title='Multiple refered from 3 places.'>HAVE_CLOCK</a> <i><font color='green'>/* So it gets included in the methods */</font></i>
<a name='L134'><font color='darkred'>#endif</font> <i><font color='green'>/* MS_WINDOWS &amp;&amp; !defined(__BORLANDC__) */</font></i>
<a name='L135'>
<a name='L136'><font color='darkred'>#ifdef</font> <a href='../D/1467.html' title='Multiple defined in 5 places.'>HAVE_CLOCK</a>
<a name='L137'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(clock_doc,
<a name='L138'>"clock() -&gt; floating point number\n\
<a name='L139'>\n\
<a name='L140'>Return the CPU time or real time since the start of the process or since\n\
<a name='L141'>the first call to clock().  This has as much precision as the system\n\
<a name='L142'>records.");
<a name='L143'><font color='darkred'>#endif</font>
<a name='L144'>
<a name='L145'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L146'><a href='../R/10900.html' title='Multiple refered from 2 places.'>time_sleep</a>(PyObject *self, PyObject *args)
<a name='L147'><font color='red'>{</font>
<a name='L148'>    <b>double</b> secs;
<a name='L149'>    <b>if</b> (!<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "d:sleep", &amp;secs))
<a name='L150'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L151'>    <b>if</b> (<a href='../S/2720.html#L978' title='Defined at 978 in Modules/timemodule.c.'>floatsleep</a>(secs) != 0)
<a name='L152'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L153'>    Py_INCREF(Py_None);
<a name='L154'>    <b>return</b> Py_None;
<a name='L155'><font color='red'>}</font>
<a name='L156'>
<a name='L157'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(sleep_doc,
<a name='L158'>"sleep(seconds)\n\
<a name='L159'>\n\
<a name='L160'>Delay execution for a given number of seconds.  The argument may be\n\
<a name='L161'>a floating point number for subsecond precision.");
<a name='L162'>
<a name='L163'><b>static</b> <a href='../D/3794.html' title='Multiple defined in 2 places.'>PyStructSequence_Field</a> struct_time_type_fields[] = <font color='red'>{</font>
<a name='L164'>    <font color='red'>{</font>"tm_year", "year, for example, 1993"<font color='red'>}</font>,
<a name='L165'>    <font color='red'>{</font>"tm_mon", "month of year, range [1, 12]"<font color='red'>}</font>,
<a name='L166'>    <font color='red'>{</font>"tm_mday", "day of month, range [1, 31]"<font color='red'>}</font>,
<a name='L167'>    <font color='red'>{</font>"tm_hour", "hours, range [0, 23]"<font color='red'>}</font>,
<a name='L168'>    <font color='red'>{</font>"tm_min", "minutes, range [0, 59]"<font color='red'>}</font>,
<a name='L169'>    <font color='red'>{</font>"tm_sec", "seconds, range [0, 61])"<font color='red'>}</font>,
<a name='L170'>    <font color='red'>{</font>"tm_wday", "day of week, range [0, 6], Monday is 0"<font color='red'>}</font>,
<a name='L171'>    <font color='red'>{</font>"tm_yday", "day of year, range [1, 366]"<font color='red'>}</font>,
<a name='L172'>    <font color='red'>{</font>"tm_isdst", "1 if summer time is in effect, 0 if not, and -1 if unknown"<font color='red'>}</font>,
<a name='L173'>    <font color='red'>{</font>0<font color='red'>}</font>
<a name='L174'><font color='red'>}</font>;
<a name='L175'>
<a name='L176'><b>static</b> <a href='../D/3793.html' title='Multiple defined in 2 places.'>PyStructSequence_Desc</a> struct_time_type_desc = <font color='red'>{</font>
<a name='L177'>    "time.struct_time",
<a name='L178'>    "The time value as returned by gmtime(), localtime(), and strptime(), and\n"
<a name='L179'>    " accepted by asctime(), mktime() and strftime().  May be considered as a\n"
<a name='L180'>    " sequence of 9 integers.\n\n"
<a name='L181'>    " Note that several fields' values are not the same as those defined by\n"
<a name='L182'>    " the C language standard for struct tm.  For example, the value of the\n"
<a name='L183'>    " field tm_year is the actual year, not year - 1900.  See individual\n"
<a name='L184'>    " fields' descriptions for details.",
<a name='L185'>    struct_time_type_fields,
<a name='L186'>    9,
<a name='L187'><font color='red'>}</font>;
<a name='L188'>
<a name='L189'><b>static</b> <b>int</b> initialized;
<a name='L190'><b>static</b> <a href='../D/3899.html' title='Multiple defined in 3 places.'>PyTypeObject</a> StructTimeType;
<a name='L191'>
<a name='L192'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L193'><a href='../S/2720.html#L236' title='Refered from 236 in Modules/timemodule.c.'>tmtotuple</a>(<b>struct</b> tm *p)
<a name='L194'><font color='red'>{</font>
<a name='L195'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *v = <a href='../S/2822.html#L29' title='Defined at 29 in Objects/structseq.c.'>PyStructSequence_New</a>(&amp;StructTimeType);
<a name='L196'>    <b>if</b> (v == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L197'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L198'>
<a name='L199'><font color='darkred'>#define</font> <a href='../R/4056.html' title='Multiple refered from 33 places.'>SET</a>(i,val) PyStructSequence_SET_ITEM(v, i, <a href='../S/2799.html#L176' title='Defined at 176 in Objects/longobject.c.'>PyLong_FromLong</a>((<b>long</b>) val))
<a name='L200'>
<a name='L201'>    <a href='../D/4598.html' title='Multiple defined in 5 places.'>SET</a>(0, p-&gt;tm_year + 1900);
<a name='L202'>    <a href='../D/4598.html' title='Multiple defined in 5 places.'>SET</a>(1, p-&gt;tm_mon + 1);         <i><font color='green'>/* Want January == 1 */</font></i>
<a name='L203'>    <a href='../D/4598.html' title='Multiple defined in 5 places.'>SET</a>(2, p-&gt;tm_mday);
<a name='L204'>    <a href='../D/4598.html' title='Multiple defined in 5 places.'>SET</a>(3, p-&gt;tm_hour);
<a name='L205'>    <a href='../D/4598.html' title='Multiple defined in 5 places.'>SET</a>(4, p-&gt;tm_min);
<a name='L206'>    <a href='../D/4598.html' title='Multiple defined in 5 places.'>SET</a>(5, p-&gt;tm_sec);
<a name='L207'>    <a href='../D/4598.html' title='Multiple defined in 5 places.'>SET</a>(6, (p-&gt;tm_wday + 6) % 7); <i><font color='green'>/* Want Monday == 0 */</font></i>
<a name='L208'>    <a href='../D/4598.html' title='Multiple defined in 5 places.'>SET</a>(7, p-&gt;tm_yday + 1);        <i><font color='green'>/* Want January, 1 == 1 */</font></i>
<a name='L209'>    <a href='../D/4598.html' title='Multiple defined in 5 places.'>SET</a>(8, p-&gt;tm_isdst);
<a name='L210'><font color='darkred'>#undef</font> <a href='../R/4056.html' title='Multiple refered from 33 places.'>SET</a>
<a name='L211'>    <b>if</b> (<a href='../D/3154.html' title='Multiple defined in 2 places.'>PyErr_Occurred</a>()) <font color='red'>{</font>
<a name='L212'>        <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(v);
<a name='L213'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L214'>    <font color='red'>}</font>
<a name='L215'>
<a name='L216'>    <b>return</b> v;
<a name='L217'><font color='red'>}</font>
<a name='L218'>
<a name='L219'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L220'><a href='../R/10882.html' title='Multiple refered from 2 places.'>time_convert</a>(<b>double</b> when, <b>struct</b> tm * (*function)(<b>const</b> time_t *))
<a name='L221'><font color='red'>{</font>
<a name='L222'>    <b>struct</b> tm *p;
<a name='L223'>    time_t whent = <a href='../S/2616.html#L6' title='Defined at 6 in Modules/_time.c.'>_PyTime_DoubleToTimet</a>(when);
<a name='L224'>
<a name='L225'>    <b>if</b> (whent == (time_t)-1 &amp;&amp; <a href='../D/3154.html' title='Multiple defined in 2 places.'>PyErr_Occurred</a>())
<a name='L226'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L227'>    errno = 0;
<a name='L228'>    p = function(&amp;whent);
<a name='L229'>    <b>if</b> (p == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L230'><font color='darkred'>#ifdef</font> EINVAL
<a name='L231'>        <b>if</b> (errno == 0)
<a name='L232'>            errno = EINVAL;
<a name='L233'><font color='darkred'>#endif</font>
<a name='L234'>        <b>return</b> <a href='../S/3106.html#L452' title='Defined at 452 in Python/errors.c.'>PyErr_SetFromErrno</a>(PyExc_ValueError);
<a name='L235'>    <font color='red'>}</font>
<a name='L236'>    <b>return</b> <a href='../S/2720.html#L193' title='Defined at 193 in Modules/timemodule.c.'>tmtotuple</a>(p);
<a name='L237'><font color='red'>}</font>
<a name='L238'>
<a name='L239'><i><font color='green'>/* Parse arg tuple that can contain an optional float-or-None value;</font></i>
<a name='L240'><i><font color='green'>   format needs to be "|O:name".</font></i>
<a name='L241'><i><font color='green'>   Returns non-zero on success (parallels PyArg_ParseTuple).</font></i>
<a name='L242'><i><font color='green'>*/</font></i>
<a name='L243'><b>static</b> <b>int</b>
<a name='L244'><a href='../R/9465.html' title='Multiple refered from 2 places.'>parse_time_double_args</a>(PyObject *args, <b>char</b> *format, <b>double</b> *pwhen)
<a name='L245'><font color='red'>{</font>
<a name='L246'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *ot = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L247'>
<a name='L248'>    <b>if</b> (!<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, format, &amp;ot))
<a name='L249'>        <b>return</b> 0;
<a name='L250'>    <b>if</b> (ot == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> || ot == Py_None)
<a name='L251'>        *pwhen = <a href='../S/2720.html#L965' title='Defined at 965 in Modules/timemodule.c.'>floattime</a>();
<a name='L252'>    <b>else</b> <font color='red'>{</font>
<a name='L253'>        <b>double</b> when = <a href='../S/2791.html#L244' title='Defined at 244 in Objects/floatobject.c.'>PyFloat_AsDouble</a>(ot);
<a name='L254'>        <b>if</b> (<a href='../D/3154.html' title='Multiple defined in 2 places.'>PyErr_Occurred</a>())
<a name='L255'>            <b>return</b> 0;
<a name='L256'>        *pwhen = when;
<a name='L257'>    <font color='red'>}</font>
<a name='L258'>    <b>return</b> 1;
<a name='L259'><font color='red'>}</font>
<a name='L260'>
<a name='L261'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L262'><a href='../S/2720.html#L849' title='Refered from 849 in Modules/timemodule.c.'>time_gmtime</a>(PyObject *self, PyObject *args)
<a name='L263'><font color='red'>{</font>
<a name='L264'>    <b>double</b> when;
<a name='L265'>    <b>if</b> (!<a href='../S/2720.html#L244' title='Defined at 244 in Modules/timemodule.c.'>parse_time_double_args</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "|O:gmtime", &amp;when))
<a name='L266'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L267'>    <b>return</b> <a href='../S/2720.html#L220' title='Defined at 220 in Modules/timemodule.c.'>time_convert</a>(when, gmtime);
<a name='L268'><font color='red'>}</font>
<a name='L269'>
<a name='L270'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(gmtime_doc,
<a name='L271'>"gmtime([seconds]) -&gt; (tm_year, tm_mon, tm_mday, tm_hour, tm_min,\n\
<a name='L272'>                       tm_sec, tm_wday, tm_yday, tm_isdst)\n\
<a name='L273'>\n\
<a name='L274'>Convert seconds since the Epoch to a time tuple expressing UTC (a.k.a.\n\
<a name='L275'>GMT).  When 'seconds' is not passed in, convert the current time instead.");
<a name='L276'>
<a name='L277'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L278'><a href='../S/2720.html#L850' title='Refered from 850 in Modules/timemodule.c.'>time_localtime</a>(PyObject *self, PyObject *args)
<a name='L279'><font color='red'>{</font>
<a name='L280'>    <b>double</b> when;
<a name='L281'>    <b>if</b> (!<a href='../S/2720.html#L244' title='Defined at 244 in Modules/timemodule.c.'>parse_time_double_args</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "|O:localtime", &amp;when))
<a name='L282'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L283'>    <b>return</b> <a href='../S/2720.html#L220' title='Defined at 220 in Modules/timemodule.c.'>time_convert</a>(when, localtime);
<a name='L284'><font color='red'>}</font>
<a name='L285'>
<a name='L286'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(localtime_doc,
<a name='L287'>"localtime([seconds]) -&gt; (tm_year,tm_mon,tm_mday,tm_hour,tm_min,\n\
<a name='L288'>                          tm_sec,tm_wday,tm_yday,tm_isdst)\n\
<a name='L289'>\n\
<a name='L290'>Convert seconds since the Epoch to a time tuple expressing local time.\n\
<a name='L291'>When 'seconds' is not passed in, convert the current time instead.");
<a name='L292'>
<a name='L293'><i><font color='green'>/* Convert 9-item tuple to tm structure.  Return 1 on success, set</font></i>
<a name='L294'><i><font color='green'> * an exception and return 0 on error.</font></i>
<a name='L295'><i><font color='green'> */</font></i>
<a name='L296'><b>static</b> <b>int</b>
<a name='L297'><a href='../R/8167.html' title='Multiple refered from 3 places.'>gettmarg</a>(PyObject *args, <b>struct</b> tm *p)
<a name='L298'><font color='red'>{</font>
<a name='L299'>    <b>int</b> y;
<a name='L300'>
<a name='L301'>    memset((<b>void</b> *) p, '\0', <b>sizeof</b>(<b>struct</b> tm));
<a name='L302'>
<a name='L303'>    <b>if</b> (!PyTuple_Check(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>)) <font color='red'>{</font>
<a name='L304'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_TypeError,
<a name='L305'>                        "Tuple or struct_time argument required");
<a name='L306'>        <b>return</b> 0;
<a name='L307'>    <font color='red'>}</font>
<a name='L308'>
<a name='L309'>    <b>if</b> (!<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "iiiiiiiii",
<a name='L310'>                          &amp;y, &amp;p-&gt;tm_mon, &amp;p-&gt;tm_mday,
<a name='L311'>                          &amp;p-&gt;tm_hour, &amp;p-&gt;tm_min, &amp;p-&gt;tm_sec,
<a name='L312'>                          &amp;p-&gt;tm_wday, &amp;p-&gt;tm_yday, &amp;p-&gt;tm_isdst))
<a name='L313'>        <b>return</b> 0;
<a name='L314'>
<a name='L315'>    <i><font color='green'>/* If year is specified with less than 4 digits, its interpretation</font></i>
<a name='L316'><i><font color='green'>     * depends on the accept2dyear value.</font></i>
<a name='L317'><i><font color='green'>     *</font></i>
<a name='L318'><i><font color='green'>     * If accept2dyear is true (default), a backward compatibility behavior is</font></i>
<a name='L319'><i><font color='green'>     * invoked as follows:</font></i>
<a name='L320'><i><font color='green'>     *</font></i>
<a name='L321'><i><font color='green'>     *   - for 2-digit year, century is guessed according to POSIX rules for</font></i>
<a name='L322'><i><font color='green'>     *      %y strptime format: 21st century for y &lt; 69, 20th century</font></i>
<a name='L323'><i><font color='green'>     *      otherwise.  A deprecation warning is issued when century</font></i>
<a name='L324'><i><font color='green'>     *      information is guessed in this way.</font></i>
<a name='L325'><i><font color='green'>     *</font></i>
<a name='L326'><i><font color='green'>     *   - for 3-digit or negative year, a ValueError exception is raised.</font></i>
<a name='L327'><i><font color='green'>     *</font></i>
<a name='L328'><i><font color='green'>     * If accept2dyear is false (set by the program or as a result of a</font></i>
<a name='L329'><i><font color='green'>     * non-empty value assigned to PYTHONY2K environment variable) all year</font></i>
<a name='L330'><i><font color='green'>     * values are interpreted as given.</font></i>
<a name='L331'><i><font color='green'>     */</font></i>
<a name='L332'>    <b>if</b> (y &lt; 1000) <font color='red'>{</font>
<a name='L333'>        <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *accept = <a href='../S/2787.html#L2168' title='Defined at 2168 in Objects/dictobject.c.'>PyDict_GetItemString</a>(moddict,
<a name='L334'>                                                "accept2dyear");
<a name='L335'>        <b>if</b> (accept != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L336'>            <b>int</b> acceptval =  <a href='../S/2803.html#L1140' title='Defined at 1140 in Objects/object.c.'>PyObject_IsTrue</a>(accept);
<a name='L337'>            <b>if</b> (acceptval == -1)
<a name='L338'>                <b>return</b> 0;
<a name='L339'>            <b>if</b> (acceptval) <font color='red'>{</font>
<a name='L340'>                <b>if</b> (0 &lt;= y &amp;&amp; y &lt; 69)
<a name='L341'>                    y += 2000;
<a name='L342'>                <b>else</b> <b>if</b> (69 &lt;= y &amp;&amp; y &lt; 100)
<a name='L343'>                    y += 1900;
<a name='L344'>                <b>else</b> <font color='red'>{</font>
<a name='L345'>                    <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError,
<a name='L346'>                                    "year out of range");
<a name='L347'>                    <b>return</b> 0;
<a name='L348'>                <font color='red'>}</font>
<a name='L349'>                <b>if</b> (<a href='../S/3087.html#L756' title='Defined at 756 in Python/_warnings.c.'>PyErr_WarnEx</a>(PyExc_DeprecationWarning,
<a name='L350'>                           "Century info guessed for a 2-digit year.", 1) != 0)
<a name='L351'>                    <b>return</b> 0;
<a name='L352'>            <font color='red'>}</font>
<a name='L353'>        <font color='red'>}</font>
<a name='L354'>        <b>else</b>
<a name='L355'>            <b>return</b> 0;
<a name='L356'>    <font color='red'>}</font>
<a name='L357'>    p-&gt;tm_year = y - 1900;
<a name='L358'>    p-&gt;tm_mon--;
<a name='L359'>    p-&gt;tm_wday = (p-&gt;tm_wday + 1) % 7;
<a name='L360'>    p-&gt;tm_yday--;
<a name='L361'>    <b>return</b> 1;
<a name='L362'><font color='red'>}</font>
<a name='L363'>
<a name='L364'><i><font color='green'>/* Check values of the struct tm fields before it is passed to strftime() and</font></i>
<a name='L365'><i><font color='green'> * asctime().  Return 1 if all values are valid, otherwise set an exception</font></i>
<a name='L366'><i><font color='green'> * and returns 0.</font></i>
<a name='L367'><i><font color='green'> */</font></i>
<a name='L368'><b>static</b> <b>int</b>
<a name='L369'><a href='../R/6649.html' title='Multiple refered from 2 places.'>checktm</a>(<b>struct</b> tm* buf)
<a name='L370'><font color='red'>{</font>
<a name='L371'>    <i><font color='green'>/* Checks added to make sure strftime() and asctime() does not crash Python by</font></i>
<a name='L372'><i><font color='green'>       indexing blindly into some array for a textual representation</font></i>
<a name='L373'><i><font color='green'>       by some bad index (fixes bug #897625 and #6608).</font></i>
<a name='L374'><i><font color='green'></font></i>
<a name='L375'><i><font color='green'>       Also support values of zero from Python code for arguments in which</font></i>
<a name='L376'><i><font color='green'>       that is out of range by forcing that value to the lowest value that</font></i>
<a name='L377'><i><font color='green'>       is valid (fixed bug #1520914).</font></i>
<a name='L378'><i><font color='green'></font></i>
<a name='L379'><i><font color='green'>       Valid ranges based on what is allowed in struct tm:</font></i>
<a name='L380'><i><font color='green'></font></i>
<a name='L381'><i><font color='green'>       - tm_year: [0, max(int)] (1)</font></i>
<a name='L382'><i><font color='green'>       - tm_mon: [0, 11] (2)</font></i>
<a name='L383'><i><font color='green'>       - tm_mday: [1, 31]</font></i>
<a name='L384'><i><font color='green'>       - tm_hour: [0, 23]</font></i>
<a name='L385'><i><font color='green'>       - tm_min: [0, 59]</font></i>
<a name='L386'><i><font color='green'>       - tm_sec: [0, 60]</font></i>
<a name='L387'><i><font color='green'>       - tm_wday: [0, 6] (1)</font></i>
<a name='L388'><i><font color='green'>       - tm_yday: [0, 365] (2)</font></i>
<a name='L389'><i><font color='green'>       - tm_isdst: [-max(int), max(int)]</font></i>
<a name='L390'><i><font color='green'></font></i>
<a name='L391'><i><font color='green'>       (1) gettmarg() handles bounds-checking.</font></i>
<a name='L392'><i><font color='green'>       (2) Python's acceptable range is one greater than the range in C,</font></i>
<a name='L393'><i><font color='green'>       thus need to check against automatic decrement by gettmarg().</font></i>
<a name='L394'><i><font color='green'>    */</font></i>
<a name='L395'>    <b>if</b> (buf-&gt;tm_mon == -1)
<a name='L396'>        buf-&gt;tm_mon = 0;
<a name='L397'>    <b>else</b> <b>if</b> (buf-&gt;tm_mon &lt; 0 || buf-&gt;tm_mon &gt; 11) <font color='red'>{</font>
<a name='L398'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError, "month out of range");
<a name='L399'>        <b>return</b> 0;
<a name='L400'>    <font color='red'>}</font>
<a name='L401'>    <b>if</b> (buf-&gt;tm_mday == 0)
<a name='L402'>        buf-&gt;tm_mday = 1;
<a name='L403'>    <b>else</b> <b>if</b> (buf-&gt;tm_mday &lt; 0 || buf-&gt;tm_mday &gt; 31) <font color='red'>{</font>
<a name='L404'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError, "day of month out of range");
<a name='L405'>        <b>return</b> 0;
<a name='L406'>    <font color='red'>}</font>
<a name='L407'>    <b>if</b> (buf-&gt;tm_hour &lt; 0 || buf-&gt;tm_hour &gt; 23) <font color='red'>{</font>
<a name='L408'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError, "hour out of range");
<a name='L409'>        <b>return</b> 0;
<a name='L410'>    <font color='red'>}</font>
<a name='L411'>    <b>if</b> (buf-&gt;tm_min &lt; 0 || buf-&gt;tm_min &gt; 59) <font color='red'>{</font>
<a name='L412'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError, "minute out of range");
<a name='L413'>        <b>return</b> 0;
<a name='L414'>    <font color='red'>}</font>
<a name='L415'>    <b>if</b> (buf-&gt;tm_sec &lt; 0 || buf-&gt;tm_sec &gt; 61) <font color='red'>{</font>
<a name='L416'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError, "seconds out of range");
<a name='L417'>        <b>return</b> 0;
<a name='L418'>    <font color='red'>}</font>
<a name='L419'>    <i><font color='green'>/* tm_wday does not need checking of its upper-bound since taking</font></i>
<a name='L420'><i><font color='green'>    ``% 7`` in gettmarg() automatically restricts the range. */</font></i>
<a name='L421'>    <b>if</b> (buf-&gt;tm_wday &lt; 0) <font color='red'>{</font>
<a name='L422'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError, "day of week out of range");
<a name='L423'>        <b>return</b> 0;
<a name='L424'>    <font color='red'>}</font>
<a name='L425'>    <b>if</b> (buf-&gt;tm_yday == -1)
<a name='L426'>        buf-&gt;tm_yday = 0;
<a name='L427'>    <b>else</b> <b>if</b> (buf-&gt;tm_yday &lt; 0 || buf-&gt;tm_yday &gt; 365) <font color='red'>{</font>
<a name='L428'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError, "day of year out of range");
<a name='L429'>        <b>return</b> 0;
<a name='L430'>    <font color='red'>}</font>
<a name='L431'>    <b>return</b> 1;
<a name='L432'><font color='red'>}</font>
<a name='L433'>
<a name='L434'><font color='darkred'>#ifdef</font> <a href='../D/1571.html' title='Multiple defined in 3 places.'>HAVE_STRFTIME</a>
<a name='L435'><font color='darkred'>#ifdef</font> <a href='../S/2906.html#L638' title='Defined at 638 in PC/pyconfig.h.'>HAVE_WCSFTIME</a>
<a name='L436'><font color='darkred'>#define</font> <a href='../R/10880.html' title='Multiple refered from 3 places.'>time_char</a> wchar_t
<a name='L437'><font color='darkred'>#define</font> <a href='../S/2720.html#L535' title='Refered from 535 in Modules/timemodule.c.'>format_time</a> wcsftime
<a name='L438'><font color='darkred'>#define</font> <a href='../S/2720.html#L524' title='Refered from 524 in Modules/timemodule.c.'>time_strlen</a> wcslen
<a name='L439'><font color='darkred'>#else</font>
<a name='L440'><font color='darkred'>#define</font> <a href='../R/10880.html' title='Multiple refered from 3 places.'>time_char</a> <b>char</b>
<a name='L441'><font color='darkred'>#define</font> <a href='../S/2720.html#L535' title='Refered from 535 in Modules/timemodule.c.'>format_time</a> strftime
<a name='L442'><font color='darkred'>#define</font> <a href='../S/2720.html#L524' title='Refered from 524 in Modules/timemodule.c.'>time_strlen</a> strlen
<a name='L443'><font color='darkred'>#endif</font>
<a name='L444'>
<a name='L445'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L446'><a href='../R/10902.html' title='Multiple refered from 2 places.'>time_strftime</a>(PyObject *self, PyObject *args)
<a name='L447'><font color='red'>{</font>
<a name='L448'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *tup = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L449'>    <b>struct</b> tm buf;
<a name='L450'>    <b>const</b> <a href='../D/11760.html' title='Multiple defined in 3 places.'>time_char</a> *fmt;
<a name='L451'><font color='darkred'>#ifdef</font> <a href='../S/2906.html#L638' title='Defined at 638 in PC/pyconfig.h.'>HAVE_WCSFTIME</a>
<a name='L452'>    wchar_t *format;
<a name='L453'><font color='darkred'>#else</font>
<a name='L454'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *format;
<a name='L455'><font color='darkred'>#endif</font>
<a name='L456'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *format_arg;
<a name='L457'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> fmtlen, buflen;
<a name='L458'>    <a href='../D/11760.html' title='Multiple defined in 3 places.'>time_char</a> *outbuf = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L459'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> i;
<a name='L460'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *ret = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L461'>
<a name='L462'>    memset((<b>void</b> *) &amp;buf, '\0', <b>sizeof</b>(buf));
<a name='L463'>
<a name='L464'>    <i><font color='green'>/* Will always expect a unicode string to be passed as format.</font></i>
<a name='L465'><i><font color='green'>       Given that there's no str type anymore in py3k this seems safe.</font></i>
<a name='L466'><i><font color='green'>    */</font></i>
<a name='L467'>    <b>if</b> (!<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "U|O:strftime", &amp;format_arg, &amp;tup))
<a name='L468'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L469'>
<a name='L470'>    <b>if</b> (tup == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L471'>        time_t tt = time(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L472'>        buf = *localtime(&amp;tt);
<a name='L473'>    <font color='red'>}</font>
<a name='L474'>    <b>else</b> <b>if</b> (!<a href='../S/2720.html#L297' title='Defined at 297 in Modules/timemodule.c.'>gettmarg</a>(tup, &amp;buf) || !<a href='../S/2720.html#L369' title='Defined at 369 in Modules/timemodule.c.'>checktm</a>(&amp;buf))
<a name='L475'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L476'>
<a name='L477'><font color='darkred'>#if</font> <b>defined</b>(_MSC_VER) || <b>defined</b>(sun)
<a name='L478'>    <b>if</b> (buf.tm_year + 1900 &lt; 1 || 9999 &lt; buf.tm_year + 1900) <font color='red'>{</font>
<a name='L479'>        <a href='../S/3106.html#L600' title='Defined at 600 in Python/errors.c.'>PyErr_Format</a>(PyExc_ValueError,
<a name='L480'>                     "strftime() requires year in [1; 9999]",
<a name='L481'>                     buf.tm_year + 1900);
<a name='L482'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L483'>    <font color='red'>}</font>
<a name='L484'><font color='darkred'>#endif</font>
<a name='L485'>
<a name='L486'>    <i><font color='green'>/* Normalize tm_isdst just in case someone foolishly implements %Z</font></i>
<a name='L487'><i><font color='green'>       based on the assumption that tm_isdst falls within the range of</font></i>
<a name='L488'><i><font color='green'>       [-1, 1] */</font></i>
<a name='L489'>    <b>if</b> (buf.tm_isdst &lt; -1)
<a name='L490'>        buf.tm_isdst = -1;
<a name='L491'>    <b>else</b> <b>if</b> (buf.tm_isdst &gt; 1)
<a name='L492'>        buf.tm_isdst = 1;
<a name='L493'>
<a name='L494'><font color='darkred'>#ifdef</font> <a href='../S/2906.html#L638' title='Defined at 638 in PC/pyconfig.h.'>HAVE_WCSFTIME</a>
<a name='L495'>    format = <a href='../D/3964.html' title='Multiple defined in 3 places.'>PyUnicode_AsWideCharString</a>(format_arg, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L496'>    <b>if</b> (format == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L497'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L498'>    fmt = format;
<a name='L499'><font color='darkred'>#else</font>
<a name='L500'>    <i><font color='green'>/* Convert the unicode string to an ascii one */</font></i>
<a name='L501'>    format = <a href='../D/3952.html' title='Multiple defined in 3 places.'>PyUnicode_AsEncodedString</a>(format_arg, <a href='../D/5219.html' title='Multiple defined in 3 places.'>TZNAME_ENCODING</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L502'>    <b>if</b> (format == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L503'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L504'>    fmt = PyBytes_AS_STRING(format);
<a name='L505'><font color='darkred'>#endif</font>
<a name='L506'>
<a name='L507'><font color='darkred'>#if</font> <b>defined</b>(<a href='../S/2906.html#L81' title='Defined at 81 in PC/pyconfig.h.'>MS_WINDOWS</a>) &amp;&amp; <b>defined</b>(<a href='../S/2906.html#L638' title='Defined at 638 in PC/pyconfig.h.'>HAVE_WCSFTIME</a>)
<a name='L508'>    <i><font color='green'>/* check that the format string contains only valid directives */</font></i>
<a name='L509'>    <b>for</b>(outbuf = wcschr(fmt, L'%');
<a name='L510'>        outbuf != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L511'>        outbuf = wcschr(outbuf+2, L'%'))
<a name='L512'>    <font color='red'>{</font>
<a name='L513'>        <b>if</b> (outbuf[1]=='#')
<a name='L514'>            ++outbuf; <i><font color='green'>/* not documented by python, */</font></i>
<a name='L515'>        <b>if</b> (outbuf[1]=='\0' ||
<a name='L516'>            !wcschr(L"aAbBcdfHIjmMpSUwWxXyYzZ%", outbuf[1]))
<a name='L517'>        <font color='red'>{</font>
<a name='L518'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError, "Invalid format string");
<a name='L519'>            <b>return</b> 0;
<a name='L520'>        <font color='red'>}</font>
<a name='L521'>    <font color='red'>}</font>
<a name='L522'><font color='darkred'>#endif</font>
<a name='L523'>
<a name='L524'>    fmtlen = <a href='../D/11783.html' title='Multiple defined in 2 places.'>time_strlen</a>(fmt);
<a name='L525'>
<a name='L526'>    <i><font color='green'>/* I hate these functions that presume you know how big the output</font></i>
<a name='L527'><i><font color='green'>     * will be ahead of time...</font></i>
<a name='L528'><i><font color='green'>     */</font></i>
<a name='L529'>    <b>for</b> (i = 1024; ; i += i) <font color='red'>{</font>
<a name='L530'>        outbuf = (<a href='../D/11760.html' title='Multiple defined in 3 places.'>time_char</a> *)<a href='../S/2803.html#L1769' title='Defined at 1769 in Objects/object.c.'>PyMem_Malloc</a>(i*<b>sizeof</b>(<a href='../D/11760.html' title='Multiple defined in 3 places.'>time_char</a>));
<a name='L531'>        <b>if</b> (outbuf == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L532'>            <a href='../S/3106.html#L334' title='Defined at 334 in Python/errors.c.'>PyErr_NoMemory</a>();
<a name='L533'>            <b>break</b>;
<a name='L534'>        <font color='red'>}</font>
<a name='L535'>        buflen = <a href='../D/8693.html' title='Multiple defined in 3 places.'>format_time</a>(outbuf, i, fmt, &amp;buf);
<a name='L536'>        <b>if</b> (buflen &gt; 0 || i &gt;= 256 * fmtlen) <font color='red'>{</font>
<a name='L537'>            <i><font color='green'>/* If the buffer is 256 times as long as the format,</font></i>
<a name='L538'><i><font color='green'>               it's probably not failing for lack of room!</font></i>
<a name='L539'><i><font color='green'>               More likely, the format yields an empty result,</font></i>
<a name='L540'><i><font color='green'>               e.g. an empty format, or %Z when the timezone</font></i>
<a name='L541'><i><font color='green'>               is unknown. */</font></i>
<a name='L542'><font color='darkred'>#ifdef</font> <a href='../S/2906.html#L638' title='Defined at 638 in PC/pyconfig.h.'>HAVE_WCSFTIME</a>
<a name='L543'>            ret = <a href='../D/4015.html' title='Multiple defined in 4 places.'>PyUnicode_FromWideChar</a>(outbuf, buflen);
<a name='L544'><font color='darkred'>#else</font>
<a name='L545'>            ret = <a href='../D/3972.html' title='Multiple defined in 3 places.'>PyUnicode_Decode</a>(outbuf, buflen,
<a name='L546'>                                   <a href='../D/5219.html' title='Multiple defined in 3 places.'>TZNAME_ENCODING</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L547'><font color='darkred'>#endif</font>
<a name='L548'>            <a href='../S/2803.html#L1781' title='Defined at 1781 in Objects/object.c.'>PyMem_Free</a>(outbuf);
<a name='L549'>            <b>break</b>;
<a name='L550'>        <font color='red'>}</font>
<a name='L551'>        <a href='../S/2803.html#L1781' title='Defined at 1781 in Objects/object.c.'>PyMem_Free</a>(outbuf);
<a name='L552'><font color='darkred'>#if</font> <b>defined</b> _MSC_VER &amp;&amp; _MSC_VER &gt;= 1400 &amp;&amp; <b>defined</b>(__STDC_SECURE_LIB__)
<a name='L553'>        <i><font color='green'>/* VisualStudio .NET 2005 does this properly */</font></i>
<a name='L554'>        <b>if</b> (buflen == 0 &amp;&amp; errno == EINVAL) <font color='red'>{</font>
<a name='L555'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError, "Invalid format string");
<a name='L556'>            <b>break</b>;
<a name='L557'>        <font color='red'>}</font>
<a name='L558'><font color='darkred'>#endif</font>
<a name='L559'>    <font color='red'>}</font>
<a name='L560'><font color='darkred'>#ifdef</font> <a href='../S/2906.html#L638' title='Defined at 638 in PC/pyconfig.h.'>HAVE_WCSFTIME</a>
<a name='L561'>    <a href='../S/2803.html#L1781' title='Defined at 1781 in Objects/object.c.'>PyMem_Free</a>(format);
<a name='L562'><font color='darkred'>#else</font>
<a name='L563'>    Py_DECREF(format);
<a name='L564'><font color='darkred'>#endif</font>
<a name='L565'>    <b>return</b> ret;
<a name='L566'><font color='red'>}</font>
<a name='L567'>
<a name='L568'><font color='darkred'>#undef</font> <a href='../R/10880.html' title='Multiple refered from 3 places.'>time_char</a>
<a name='L569'><font color='darkred'>#undef</font> <a href='../S/2720.html#L535' title='Refered from 535 in Modules/timemodule.c.'>format_time</a>
<a name='L570'>
<a name='L571'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(strftime_doc,
<a name='L572'>"strftime(format[, tuple]) -&gt; string\n\
<a name='L573'>\n\
<a name='L574'>Convert a time tuple to a string according to a format specification.\n\
<a name='L575'>See the library reference manual for formatting codes. When the time tuple\n\
<a name='L576'>is not present, current time as returned by localtime() is used.");
<a name='L577'><font color='darkred'>#endif</font> <i><font color='green'>/* HAVE_STRFTIME */</font></i>
<a name='L578'>
<a name='L579'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L580'><a href='../S/2720.html#L859' title='Refered from 859 in Modules/timemodule.c.'>time_strptime</a>(PyObject *self, PyObject *args)
<a name='L581'><font color='red'>{</font>
<a name='L582'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *strptime_module = <a href='../S/3120.html#L2348' title='Defined at 2348 in Python/import.c.'>PyImport_ImportModuleNoBlock</a>("_strptime");
<a name='L583'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *strptime_result;
<a name='L584'>
<a name='L585'>    <b>if</b> (!strptime_module)
<a name='L586'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L587'>    strptime_result = <a href='../D/3603.html' title='Multiple defined in 2 places.'>PyObject_CallMethod</a>(strptime_module,
<a name='L588'>                                            "_strptime_time", "O", <a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>);
<a name='L589'>    Py_DECREF(strptime_module);
<a name='L590'>    <b>return</b> strptime_result;
<a name='L591'><font color='red'>}</font>
<a name='L592'>
<a name='L593'>
<a name='L594'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(strptime_doc,
<a name='L595'>"strptime(string, format) -&gt; struct_time\n\
<a name='L596'>\n\
<a name='L597'>Parse a string to a time tuple according to a format specification.\n\
<a name='L598'>See the library reference manual for formatting codes (same as strftime()).");
<a name='L599'>
<a name='L600'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L601'><a href='../R/5691.html' title='Multiple refered from 2 places.'>_asctime</a>(<b>struct</b> tm *timeptr)
<a name='L602'><font color='red'>{</font>
<a name='L603'>    <i><font color='green'>/* Inspired by Open Group reference implementation available at</font></i>
<a name='L604'><i><font color='green'>     * http://pubs.opengroup.org/onlinepubs/009695399/functions/asctime.html */</font></i>
<a name='L605'>    <b>static</b> <b>char</b> wday_name[7][3] = <font color='red'>{</font>
<a name='L606'>        "Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"
<a name='L607'>    <font color='red'>}</font>;
<a name='L608'>    <b>static</b> <b>char</b> mon_name[12][3] = <font color='red'>{</font>
<a name='L609'>        "Jan", "Feb", "Mar", "Apr", "May", "Jun",
<a name='L610'>        "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
<a name='L611'>    <font color='red'>}</font>;
<a name='L612'>    <b>char</b> buf[20]; <i><font color='green'>/* 'Sun Sep 16 01:03:52\0' */</font></i>
<a name='L613'>    <b>int</b> n;
<a name='L614'>
<a name='L615'>    n = <a href='../S/3126.html#L41' title='Defined at 41 in Python/mysnprintf.c.'>PyOS_snprintf</a>(buf, <b>sizeof</b>(buf), "%.3s %.3s%3d %.2d:%.2d:%.2d",
<a name='L616'>                      wday_name[timeptr-&gt;tm_wday],
<a name='L617'>                      mon_name[timeptr-&gt;tm_mon],
<a name='L618'>                      timeptr-&gt;tm_mday, timeptr-&gt;tm_hour,
<a name='L619'>                      timeptr-&gt;tm_min, timeptr-&gt;tm_sec);
<a name='L620'>    <i><font color='green'>/* XXX: since the fields used by snprintf above are validated in checktm,</font></i>
<a name='L621'><i><font color='green'>     * the following condition should never trigger. We keep the check because</font></i>
<a name='L622'><i><font color='green'>     * historically fixed size buffer used in asctime was the source of</font></i>
<a name='L623'><i><font color='green'>     * crashes. */</font></i>
<a name='L624'>    <b>if</b> (n + 1 != <b>sizeof</b>(buf)) <font color='red'>{</font>
<a name='L625'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError, "unconvertible time");
<a name='L626'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L627'>    <font color='red'>}</font>
<a name='L628'>
<a name='L629'>    <b>return</b> <a href='../D/4008.html' title='Multiple defined in 3 places.'>PyUnicode_FromFormat</a>("%s %d", buf, 1900 + timeptr-&gt;tm_year);
<a name='L630'><font color='red'>}</font>
<a name='L631'>
<a name='L632'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L633'><a href='../S/2720.html#L851' title='Refered from 851 in Modules/timemodule.c.'>time_asctime</a>(PyObject *self, PyObject *args)
<a name='L634'><font color='red'>{</font>
<a name='L635'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *tup = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L636'>    <b>struct</b> tm buf;
<a name='L637'>
<a name='L638'>    <b>if</b> (!<a href='../S/3112.html#L1712' title='Defined at 1712 in Python/getargs.c.'>PyArg_UnpackTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "asctime", 0, 1, &amp;tup))
<a name='L639'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L640'>    <b>if</b> (tup == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L641'>        time_t tt = time(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L642'>        buf = *localtime(&amp;tt);
<a name='L643'>    <font color='red'>}</font> <b>else</b> <b>if</b> (!<a href='../S/2720.html#L297' title='Defined at 297 in Modules/timemodule.c.'>gettmarg</a>(tup, &amp;buf) || !<a href='../S/2720.html#L369' title='Defined at 369 in Modules/timemodule.c.'>checktm</a>(&amp;buf))
<a name='L644'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L645'>    <b>return</b> <a href='../S/2720.html#L601' title='Defined at 601 in Modules/timemodule.c.'>_asctime</a>(&amp;buf);
<a name='L646'><font color='red'>}</font>
<a name='L647'>
<a name='L648'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(asctime_doc,
<a name='L649'>"asctime([tuple]) -&gt; string\n\
<a name='L650'>\n\
<a name='L651'>Convert a time tuple to a string, e.g. 'Sat Jun 06 16:26:11 1998'.\n\
<a name='L652'>When the time tuple is not present, current time as returned by localtime()\n\
<a name='L653'>is used.");
<a name='L654'>
<a name='L655'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L656'><a href='../S/2720.html#L852' title='Refered from 852 in Modules/timemodule.c.'>time_ctime</a>(PyObject *self, PyObject *args)
<a name='L657'><font color='red'>{</font>
<a name='L658'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *ot = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L659'>    time_t tt;
<a name='L660'>    <b>struct</b> tm *timeptr;
<a name='L661'>
<a name='L662'>    <b>if</b> (!<a href='../S/3112.html#L1712' title='Defined at 1712 in Python/getargs.c.'>PyArg_UnpackTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "ctime", 0, 1, &amp;ot))
<a name='L663'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L664'>    <b>if</b> (ot == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> || ot == Py_None)
<a name='L665'>        tt = time(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L666'>    <b>else</b> <font color='red'>{</font>
<a name='L667'>        <b>double</b> dt = <a href='../S/2791.html#L244' title='Defined at 244 in Objects/floatobject.c.'>PyFloat_AsDouble</a>(ot);
<a name='L668'>        <b>if</b> (<a href='../D/3154.html' title='Multiple defined in 2 places.'>PyErr_Occurred</a>())
<a name='L669'>            <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L670'>        tt = <a href='../S/2616.html#L6' title='Defined at 6 in Modules/_time.c.'>_PyTime_DoubleToTimet</a>(dt);
<a name='L671'>        <b>if</b> (tt == (time_t)-1 &amp;&amp; <a href='../D/3154.html' title='Multiple defined in 2 places.'>PyErr_Occurred</a>())
<a name='L672'>            <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L673'>    <font color='red'>}</font>
<a name='L674'>    timeptr = localtime(&amp;tt);
<a name='L675'>    <b>if</b> (timeptr == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L676'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError, "unconvertible time");
<a name='L677'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L678'>    <font color='red'>}</font>
<a name='L679'>    <b>return</b> <a href='../S/2720.html#L601' title='Defined at 601 in Modules/timemodule.c.'>_asctime</a>(timeptr);
<a name='L680'><font color='red'>}</font>
<a name='L681'>
<a name='L682'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(ctime_doc,
<a name='L683'>"ctime(seconds) -&gt; string\n\
<a name='L684'>\n\
<a name='L685'>Convert a time in seconds since the Epoch to a string in local time.\n\
<a name='L686'>This is equivalent to asctime(localtime(seconds)). When the time tuple is\n\
<a name='L687'>not present, current time as returned by localtime() is used.");
<a name='L688'>
<a name='L689'><font color='darkred'>#ifdef</font> <a href='../D/1531.html' title='Multiple defined in 3 places.'>HAVE_MKTIME</a>
<a name='L690'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L691'><a href='../S/2720.html#L854' title='Refered from 854 in Modules/timemodule.c.'>time_mktime</a>(PyObject *self, PyObject *tup)
<a name='L692'><font color='red'>{</font>
<a name='L693'>    <b>struct</b> tm buf;
<a name='L694'>    time_t tt;
<a name='L695'>    <b>if</b> (!<a href='../S/2720.html#L297' title='Defined at 297 in Modules/timemodule.c.'>gettmarg</a>(tup, &amp;buf))
<a name='L696'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L697'>    buf.tm_wday = -1;  <i><font color='green'>/* sentinel; original value ignored */</font></i>
<a name='L698'>    tt = mktime(&amp;buf);
<a name='L699'>    <i><font color='green'>/* Return value of -1 does not necessarily mean an error, but tm_wday</font></i>
<a name='L700'><i><font color='green'>     * cannot remain set to -1 if mktime succedded. */</font></i>
<a name='L701'>    <b>if</b> (tt == (time_t)(-1) &amp;&amp; buf.tm_wday == -1) <font color='red'>{</font>
<a name='L702'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_OverflowError,
<a name='L703'>                        "mktime argument out of range");
<a name='L704'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L705'>    <font color='red'>}</font>
<a name='L706'>    <b>return</b> <a href='../S/2791.html#L157' title='Defined at 157 in Objects/floatobject.c.'>PyFloat_FromDouble</a>((<b>double</b>)tt);
<a name='L707'><font color='red'>}</font>
<a name='L708'>
<a name='L709'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(mktime_doc,
<a name='L710'>"mktime(tuple) -&gt; floating point number\n\
<a name='L711'>\n\
<a name='L712'>Convert a time tuple in local time to seconds since the Epoch.");
<a name='L713'><font color='darkred'>#endif</font> <i><font color='green'>/* HAVE_MKTIME */</font></i>
<a name='L714'>
<a name='L715'><font color='darkred'>#ifdef</font> HAVE_WORKING_TZSET
<a name='L716'><b>static</b> <b>void</b> <a href='../S/2720.html#L753' title='Defined at 753 in Modules/timemodule.c.'>PyInit_timezone</a>(PyObject *module);
<a name='L717'>
<a name='L718'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L719'><a href='../S/2720.html#L861' title='Refered from 861 in Modules/timemodule.c.'>time_tzset</a>(PyObject *self, PyObject *unused)
<a name='L720'><font color='red'>{</font>
<a name='L721'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a>* m;
<a name='L722'>
<a name='L723'>    m = <a href='../S/3120.html#L2348' title='Defined at 2348 in Python/import.c.'>PyImport_ImportModuleNoBlock</a>("time");
<a name='L724'>    <b>if</b> (m == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L725'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L726'>    <font color='red'>}</font>
<a name='L727'>
<a name='L728'>    tzset();
<a name='L729'>
<a name='L730'>    <i><font color='green'>/* Reset timezone, altzone, daylight and tzname */</font></i>
<a name='L731'>    <a href='../S/2720.html#L753' title='Defined at 753 in Modules/timemodule.c.'>PyInit_timezone</a>(m);
<a name='L732'>    Py_DECREF(m);
<a name='L733'>
<a name='L734'>    Py_INCREF(Py_None);
<a name='L735'>    <b>return</b> Py_None;
<a name='L736'><font color='red'>}</font>
<a name='L737'>
<a name='L738'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(tzset_doc,
<a name='L739'>"tzset()\n\
<a name='L740'>\n\
<a name='L741'>Initialize, or reinitialize, the local timezone to the value stored in\n\
<a name='L742'>os.environ['TZ']. The TZ environment variable should be specified in\n\
<a name='L743'>standard Unix timezone format as documented in the tzset man page\n\
<a name='L744'>(eg. 'US/Eastern', 'Europe/Amsterdam'). Unknown timezones will silently\n\
<a name='L745'>fall back to UTC. If the TZ environment variable is not set, the local\n\
<a name='L746'>timezone is set to the systems best guess of wallclock time.\n\
<a name='L747'>Changing the TZ environment variable without calling tzset *may* change\n\
<a name='L748'>the local timezone used by methods such as localtime, but this behaviour\n\
<a name='L749'>should not be relied on.");
<a name='L750'><font color='darkred'>#endif</font> <i><font color='green'>/* HAVE_WORKING_TZSET */</font></i>
<a name='L751'>
<a name='L752'><b>static</b> <b>void</b>
<a name='L753'><a href='../R/3063.html' title='Multiple refered from 3 places.'>PyInit_timezone</a>(PyObject *m) <font color='red'>{</font>
<a name='L754'>    <i><font color='green'>/* This code moved from PyInit_time wholesale to allow calling it from</font></i>
<a name='L755'><i><font color='green'>    time_tzset. In the future, some parts of it can be moved back</font></i>
<a name='L756'><i><font color='green'>    (for platforms that don't HAVE_WORKING_TZSET, when we know what they</font></i>
<a name='L757'><i><font color='green'>    are), and the extraneous calls to tzset(3) should be removed.</font></i>
<a name='L758'><i><font color='green'>    I haven't done this yet, as I don't want to change this code as</font></i>
<a name='L759'><i><font color='green'>    little as possible when introducing the time.tzset and time.tzsetwall</font></i>
<a name='L760'><i><font color='green'>    methods. This should simply be a method of doing the following once,</font></i>
<a name='L761'><i><font color='green'>    at the top of this function and removing the call to tzset() from</font></i>
<a name='L762'><i><font color='green'>    time_tzset():</font></i>
<a name='L763'><i><font color='green'></font></i>
<a name='L764'><i><font color='green'>        #ifdef HAVE_TZSET</font></i>
<a name='L765'><i><font color='green'>        tzset()</font></i>
<a name='L766'><i><font color='green'>        #endif</font></i>
<a name='L767'><i><font color='green'></font></i>
<a name='L768'><i><font color='green'>    And I'm lazy and hate C so nyer.</font></i>
<a name='L769'><i><font color='green'>     */</font></i>
<a name='L770'><font color='darkred'>#if</font> <b>defined</b>(<a href='../D/1595.html' title='Multiple defined in 3 places.'>HAVE_TZNAME</a>) &amp;&amp; !<b>defined</b>(__GLIBC__) &amp;&amp; !<b>defined</b>(__CYGWIN__)
<a name='L771'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *otz0, *otz1;
<a name='L772'>    tzset();
<a name='L773'><font color='darkred'>#ifdef</font> <a href='../D/2567.html' title='Multiple defined in 2 places.'>PYOS_OS2</a>
<a name='L774'>    <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "timezone", _timezone);
<a name='L775'><font color='darkred'>#else</font> <i><font color='green'>/* !PYOS_OS2 */</font></i>
<a name='L776'>    <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "timezone", <a href='../S/2720.html#L41' title='Defined at 41 in Modules/timemodule.c.'>timezone</a>);
<a name='L777'><font color='darkred'>#endif</font> <i><font color='green'>/* PYOS_OS2 */</font></i>
<a name='L778'><font color='darkred'>#ifdef</font> HAVE_ALTZONE
<a name='L779'>    <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "altzone", altzone);
<a name='L780'><font color='darkred'>#else</font>
<a name='L781'><font color='darkred'>#ifdef</font> <a href='../D/2567.html' title='Multiple defined in 2 places.'>PYOS_OS2</a>
<a name='L782'>    <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "altzone", _timezone-3600);
<a name='L783'><font color='darkred'>#else</font> <i><font color='green'>/* !PYOS_OS2 */</font></i>
<a name='L784'>    <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "altzone", <a href='../S/2720.html#L41' title='Defined at 41 in Modules/timemodule.c.'>timezone</a>-3600);
<a name='L785'><font color='darkred'>#endif</font> <i><font color='green'>/* PYOS_OS2 */</font></i>
<a name='L786'><font color='darkred'>#endif</font>
<a name='L787'>    <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "daylight", <a href='../S/2720.html#L43' title='Defined at 43 in Modules/timemodule.c.'>daylight</a>);
<a name='L788'>    otz0 = <a href='../D/3972.html' title='Multiple defined in 3 places.'>PyUnicode_Decode</a>(<a href='../S/2720.html#L42' title='Defined at 42 in Modules/timemodule.c.'>tzname</a>[0], strlen(<a href='../S/2720.html#L42' title='Defined at 42 in Modules/timemodule.c.'>tzname</a>[0]), <a href='../D/5219.html' title='Multiple defined in 3 places.'>TZNAME_ENCODING</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L789'>    otz1 = <a href='../D/3972.html' title='Multiple defined in 3 places.'>PyUnicode_Decode</a>(<a href='../S/2720.html#L42' title='Defined at 42 in Modules/timemodule.c.'>tzname</a>[1], strlen(<a href='../S/2720.html#L42' title='Defined at 42 in Modules/timemodule.c.'>tzname</a>[1]), <a href='../D/5219.html' title='Multiple defined in 3 places.'>TZNAME_ENCODING</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L790'>    <a href='../S/3125.html#L525' title='Defined at 525 in Python/modsupport.c.'>PyModule_AddObject</a>(m, "tzname", <a href='../D/4089.html' title='Multiple defined in 2 places.'>Py_BuildValue</a>("(NN)", otz0, otz1));
<a name='L791'><font color='darkred'>#else</font> <i><font color='green'>/* !HAVE_TZNAME || __GLIBC__ || __CYGWIN__*/</font></i>
<a name='L792'><font color='darkred'>#ifdef</font> HAVE_STRUCT_TM_TM_ZONE
<a name='L793'>    <font color='red'>{</font>
<a name='L794'><font color='darkred'>#define</font> <a href='../R/5248.html' title='Multiple refered from 2 places.'>YEAR</a> ((time_t)((365 * 24 + 6) * 3600))
<a name='L795'>        time_t t;
<a name='L796'>        <b>struct</b> tm *p;
<a name='L797'>        <b>long</b> janzone, julyzone;
<a name='L798'>        <b>char</b> janname[10], julyname[10];
<a name='L799'>        t = (time((time_t *)0) / <a href='../S/2720.html#L794' title='Defined at 794 in Modules/timemodule.c.'>YEAR</a>) * <a href='../S/2720.html#L794' title='Defined at 794 in Modules/timemodule.c.'>YEAR</a>;
<a name='L800'>        p = localtime(&amp;t);
<a name='L801'>        janzone = -p-&gt;tm_gmtoff;
<a name='L802'>        strncpy(janname, p-&gt;tm_zone ? p-&gt;tm_zone : "   ", 9);
<a name='L803'>        janname[9] = '\0';
<a name='L804'>        t += <a href='../S/2720.html#L794' title='Defined at 794 in Modules/timemodule.c.'>YEAR</a>/2;
<a name='L805'>        p = localtime(&amp;t);
<a name='L806'>        julyzone = -p-&gt;tm_gmtoff;
<a name='L807'>        strncpy(julyname, p-&gt;tm_zone ? p-&gt;tm_zone : "   ", 9);
<a name='L808'>        julyname[9] = '\0';
<a name='L809'>
<a name='L810'>        <b>if</b>( janzone &lt; julyzone ) <font color='red'>{</font>
<a name='L811'>            <i><font color='green'>/* DST is reversed in the southern hemisphere */</font></i>
<a name='L812'>            <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "timezone", julyzone);
<a name='L813'>            <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "altzone", janzone);
<a name='L814'>            <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "daylight",
<a name='L815'>                                    janzone != julyzone);
<a name='L816'>            <a href='../S/3125.html#L525' title='Defined at 525 in Python/modsupport.c.'>PyModule_AddObject</a>(m, "tzname",
<a name='L817'>                               <a href='../D/4089.html' title='Multiple defined in 2 places.'>Py_BuildValue</a>("(zz)",
<a name='L818'>                                             julyname, janname));
<a name='L819'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L820'>            <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "timezone", janzone);
<a name='L821'>            <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "altzone", julyzone);
<a name='L822'>            <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "daylight",
<a name='L823'>                                    janzone != julyzone);
<a name='L824'>            <a href='../S/3125.html#L525' title='Defined at 525 in Python/modsupport.c.'>PyModule_AddObject</a>(m, "tzname",
<a name='L825'>                               <a href='../D/4089.html' title='Multiple defined in 2 places.'>Py_BuildValue</a>("(zz)",
<a name='L826'>                                             janname, julyname));
<a name='L827'>        <font color='red'>}</font>
<a name='L828'>    <font color='red'>}</font>
<a name='L829'><font color='darkred'>#else</font>
<a name='L830'><font color='darkred'>#endif</font> <i><font color='green'>/* HAVE_STRUCT_TM_TM_ZONE */</font></i>
<a name='L831'><font color='darkred'>#ifdef</font> __CYGWIN__
<a name='L832'>    tzset();
<a name='L833'>    <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "timezone", _timezone);
<a name='L834'>    <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "altzone", _timezone-3600);
<a name='L835'>    <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "daylight", _daylight);
<a name='L836'>    <a href='../S/3125.html#L525' title='Defined at 525 in Python/modsupport.c.'>PyModule_AddObject</a>(m, "tzname",
<a name='L837'>                       <a href='../D/4089.html' title='Multiple defined in 2 places.'>Py_BuildValue</a>("(zz)", _tzname[0], _tzname[1]));
<a name='L838'><font color='darkred'>#endif</font> <i><font color='green'>/* __CYGWIN__ */</font></i>
<a name='L839'><font color='darkred'>#endif</font> <i><font color='green'>/* !HAVE_TZNAME || __GLIBC__ || __CYGWIN__*/</font></i>
<a name='L840'><font color='red'>}</font>
<a name='L841'>
<a name='L842'>
<a name='L843'><b>static</b> <a href='../D/3525.html' title='Multiple defined in 3 places.'>PyMethodDef</a> time_methods[] = <font color='red'>{</font>
<a name='L844'>    <font color='red'>{</font>"time",            <a href='../D/11786.html' title='Multiple defined in 2 places.'>time_time</a>, <a href='../S/2858.html#L634' title='Defined at 634 in PC/bdist_wininst/install.c.'>METH_NOARGS</a>, time_doc<font color='red'>}</font>,
<a name='L845'><font color='darkred'>#ifdef</font> <a href='../D/1467.html' title='Multiple defined in 5 places.'>HAVE_CLOCK</a>
<a name='L846'>    <font color='red'>{</font>"clock",           <a href='../D/11761.html' title='Multiple defined in 2 places.'>time_clock</a>, <a href='../S/2858.html#L634' title='Defined at 634 in PC/bdist_wininst/install.c.'>METH_NOARGS</a>, clock_doc<font color='red'>}</font>,
<a name='L847'><font color='darkred'>#endif</font>
<a name='L848'>    <font color='red'>{</font>"sleep",           <a href='../S/2720.html#L146' title='Defined at 146 in Modules/timemodule.c.'>time_sleep</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a>, sleep_doc<font color='red'>}</font>,
<a name='L849'>    <font color='red'>{</font>"gmtime",          <a href='../S/2720.html#L262' title='Defined at 262 in Modules/timemodule.c.'>time_gmtime</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a>, gmtime_doc<font color='red'>}</font>,
<a name='L850'>    <font color='red'>{</font>"localtime",       <a href='../S/2720.html#L278' title='Defined at 278 in Modules/timemodule.c.'>time_localtime</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a>, localtime_doc<font color='red'>}</font>,
<a name='L851'>    <font color='red'>{</font>"asctime",         <a href='../S/2720.html#L633' title='Defined at 633 in Modules/timemodule.c.'>time_asctime</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a>, asctime_doc<font color='red'>}</font>,
<a name='L852'>    <font color='red'>{</font>"ctime",           <a href='../S/2720.html#L656' title='Defined at 656 in Modules/timemodule.c.'>time_ctime</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a>, ctime_doc<font color='red'>}</font>,
<a name='L853'><font color='darkred'>#ifdef</font> <a href='../D/1531.html' title='Multiple defined in 3 places.'>HAVE_MKTIME</a>
<a name='L854'>    <font color='red'>{</font>"mktime",          <a href='../S/2720.html#L691' title='Defined at 691 in Modules/timemodule.c.'>time_mktime</a>, METH_O, mktime_doc<font color='red'>}</font>,
<a name='L855'><font color='darkred'>#endif</font>
<a name='L856'><font color='darkred'>#ifdef</font> <a href='../D/1571.html' title='Multiple defined in 3 places.'>HAVE_STRFTIME</a>
<a name='L857'>    <font color='red'>{</font>"strftime",        <a href='../D/11782.html' title='Multiple defined in 2 places.'>time_strftime</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a>, strftime_doc<font color='red'>}</font>,
<a name='L858'><font color='darkred'>#endif</font>
<a name='L859'>    <font color='red'>{</font>"strptime",        <a href='../S/2720.html#L580' title='Defined at 580 in Modules/timemodule.c.'>time_strptime</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a>, strptime_doc<font color='red'>}</font>,
<a name='L860'><font color='darkred'>#ifdef</font> HAVE_WORKING_TZSET
<a name='L861'>    <font color='red'>{</font>"tzset",           <a href='../S/2720.html#L719' title='Defined at 719 in Modules/timemodule.c.'>time_tzset</a>, <a href='../S/2858.html#L634' title='Defined at 634 in PC/bdist_wininst/install.c.'>METH_NOARGS</a>, tzset_doc<font color='red'>}</font>,
<a name='L862'><font color='darkred'>#endif</font>
<a name='L863'>    <font color='red'>{</font><a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,              <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>           <i><font color='green'>/* sentinel */</font></i>
<a name='L864'><font color='red'>}</font>;
<a name='L865'>
<a name='L866'>
<a name='L867'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(module_doc,
<a name='L868'>"This module provides various functions to manipulate time values.\n\
<a name='L869'>\n\
<a name='L870'>There are two standard representations of time.  One is the number\n\
<a name='L871'>of seconds since the Epoch, in UTC (a.k.a. GMT).  It may be an integer\n\
<a name='L872'>or a floating point number (to represent fractions of seconds).\n\
<a name='L873'>The Epoch is system-defined; on Unix, it is generally January 1st, 1970.\n\
<a name='L874'>The actual value can be retrieved by calling gmtime(0).\n\
<a name='L875'>\n\
<a name='L876'>The other representation is a tuple of 9 integers giving local time.\n\
<a name='L877'>The tuple items are:\n\
<a name='L878'>  year (four digits, e.g. 1998)\n\
<a name='L879'>  month (1-12)\n\
<a name='L880'>  day (1-31)\n\
<a name='L881'>  hours (0-23)\n\
<a name='L882'>  minutes (0-59)\n\
<a name='L883'>  seconds (0-59)\n\
<a name='L884'>  weekday (0-6, Monday is 0)\n\
<a name='L885'>  Julian day (day in the year, 1-366)\n\
<a name='L886'>  DST (Daylight Savings Time) flag (-1, 0 or 1)\n\
<a name='L887'>If the DST flag is 0, the time is given in the regular time zone;\n\
<a name='L888'>if it is 1, the time is given in the DST time zone;\n\
<a name='L889'>if it is -1, mktime() should guess based on the date and time.\n\
<a name='L890'>\n\
<a name='L891'>Variables:\n\
<a name='L892'>\n\
<a name='L893'>timezone -- difference in seconds between UTC and local standard time\n\
<a name='L894'>altzone -- difference in  seconds between UTC and local DST time\n\
<a name='L895'>daylight -- whether local time should reflect DST\n\
<a name='L896'>tzname -- tuple of (standard time zone name, DST time zone name)\n\
<a name='L897'>\n\
<a name='L898'>Functions:\n\
<a name='L899'>\n\
<a name='L900'>time() -- return current time in seconds since the Epoch as a float\n\
<a name='L901'>clock() -- return CPU time since process start as a float\n\
<a name='L902'>sleep() -- delay for a number of seconds given as a float\n\
<a name='L903'>gmtime() -- convert seconds since Epoch to UTC tuple\n\
<a name='L904'>localtime() -- convert seconds since Epoch to local time tuple\n\
<a name='L905'>asctime() -- convert time tuple to string\n\
<a name='L906'>ctime() -- convert time in seconds to string\n\
<a name='L907'>mktime() -- convert local time tuple to seconds since Epoch\n\
<a name='L908'>strftime() -- convert time tuple to string according to format specification\n\
<a name='L909'>strptime() -- parse string to time tuple according to format specification\n\
<a name='L910'>tzset() -- change the local timezone");
<a name='L911'>
<a name='L912'>
<a name='L913'>
<a name='L914'><b>static</b> <b>struct</b> <a href='../D/3534.html' title='Multiple defined in 2 places.'>PyModuleDef</a> timemodule = <font color='red'>{</font>
<a name='L915'>    <a href='../S/542.html#L33' title='Defined at 33 in Include/moduleobject.h.'>PyModuleDef_HEAD_INIT</a>,
<a name='L916'>    "time",
<a name='L917'>    module_doc,
<a name='L918'>    -1,
<a name='L919'>    time_methods,
<a name='L920'>    <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L921'>    <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L922'>    <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L923'>    <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>
<a name='L924'><font color='red'>}</font>;
<a name='L925'>
<a name='L926'><a href='../D/3482.html' title='Multiple defined in 10 places.'>PyMODINIT_FUNC</a>
<a name='L927'><a href='../R/3062.html' title='Multiple refered from 2 places.'>PyInit_time</a>(<b>void</b>)
<a name='L928'><font color='red'>{</font>
<a name='L929'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *m;
<a name='L930'>    <b>char</b> *p;
<a name='L931'>    m = PyModule_Create(&amp;timemodule);
<a name='L932'>    <b>if</b> (m == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L933'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L934'>
<a name='L935'>    <i><font color='green'>/* Accept 2-digit dates unless PYTHONY2K is set and non-empty */</font></i>
<a name='L936'>    p = Py_GETENV("PYTHONY2K");
<a name='L937'>    <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "accept2dyear", (<b>long</b>) (!p || !*p));
<a name='L938'>    <i><font color='green'>/* Squirrel away the module's dictionary for the y2k check */</font></i>
<a name='L939'>    moddict = <a href='../S/2802.html#L159' title='Defined at 159 in Objects/moduleobject.c.'>PyModule_GetDict</a>(m);
<a name='L940'>    Py_INCREF(moddict);
<a name='L941'>
<a name='L942'>    <i><font color='green'>/* Set, or reset, module variables like time.timezone */</font></i>
<a name='L943'>    <a href='../S/2720.html#L753' title='Defined at 753 in Modules/timemodule.c.'>PyInit_timezone</a>(m);
<a name='L944'>
<a name='L945'><font color='darkred'>#ifdef</font> <a href='../S/2906.html#L81' title='Defined at 81 in PC/pyconfig.h.'>MS_WINDOWS</a>
<a name='L946'>    <i><font color='green'>/* Helper to allow interrupts for Windows.</font></i>
<a name='L947'><i><font color='green'>       If Ctrl+C event delivered while not sleeping</font></i>
<a name='L948'><i><font color='green'>       it will be ignored.</font></i>
<a name='L949'><i><font color='green'>    */</font></i>
<a name='L950'>    main_thread = <a href='../D/3856.html' title='Multiple defined in 10 places.'>PyThread_get_thread_ident</a>();
<a name='L951'>    hInterruptEvent = CreateEvent(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, <a href='../D/5177.html' title='Multiple defined in 3 places.'>TRUE</a>, <a href='../D/1087.html' title='Multiple defined in 3 places.'>FALSE</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L952'>    SetConsoleCtrlHandler( <a href='../S/2720.html#L28' title='Defined at 28 in Modules/timemodule.c.'>PyCtrlHandler</a>, <a href='../D/5177.html' title='Multiple defined in 3 places.'>TRUE</a>);
<a name='L953'><font color='darkred'>#endif</font> <i><font color='green'>/* MS_WINDOWS */</font></i>
<a name='L954'>    <b>if</b> (!initialized) <font color='red'>{</font>
<a name='L955'>        <a href='../S/2822.html#L318' title='Defined at 318 in Objects/structseq.c.'>PyStructSequence_InitType</a>(&amp;StructTimeType,
<a name='L956'>                                  &amp;struct_time_type_desc);
<a name='L957'>    <font color='red'>}</font>
<a name='L958'>    Py_INCREF(&amp;StructTimeType);
<a name='L959'>    <a href='../S/3125.html#L525' title='Defined at 525 in Python/modsupport.c.'>PyModule_AddObject</a>(m, "struct_time", (<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a>*) &amp;StructTimeType);
<a name='L960'>    initialized = 1;
<a name='L961'>    <b>return</b> m;
<a name='L962'><font color='red'>}</font>
<a name='L963'>
<a name='L964'><b>static</b> <b>double</b>
<a name='L965'><a href='../R/7869.html' title='Multiple refered from 3 places.'>floattime</a>(<b>void</b>)
<a name='L966'><font color='red'>{</font>
<a name='L967'>    <a href='../D/6194.html' title='Multiple defined in 2 places.'>_PyTime_timeval</a> t;
<a name='L968'>    <a href='../S/3139.html#L23' title='Defined at 23 in Python/pytime.c.'>_PyTime_gettimeofday</a>(&amp;t);
<a name='L969'>    <b>return</b> (<b>double</b>)t.tv_sec + t.tv_usec*0.000001;
<a name='L970'><font color='red'>}</font>
<a name='L971'>
<a name='L972'>
<a name='L973'><i><font color='green'>/* Implement floatsleep() for various platforms.</font></i>
<a name='L974'><i><font color='green'>   When interrupted (or when another error occurs), return -1 and</font></i>
<a name='L975'><i><font color='green'>   set an exception; else return 0. */</font></i>
<a name='L976'>
<a name='L977'><b>static</b> <b>int</b>
<a name='L978'><a href='../R/7868.html' title='Multiple refered from 2 places.'>floatsleep</a>(<b>double</b> secs)
<a name='L979'><font color='red'>{</font>
<a name='L980'><i><font color='green'>/* XXX Should test for MS_WINDOWS first! */</font></i>
<a name='L981'><font color='darkred'>#if</font> <b>defined</b>(<a href='../D/1550.html' title='Multiple defined in 2 places.'>HAVE_SELECT</a>) &amp;&amp; !<b>defined</b>(__EMX__)
<a name='L982'>    <b>struct</b> timeval t;
<a name='L983'>    <b>double</b> frac;
<a name='L984'>    frac = fmod(secs, 1.0);
<a name='L985'>    secs = floor(secs);
<a name='L986'>    t.tv_sec = (<b>long</b>)secs;
<a name='L987'>    t.tv_usec = (<b>long</b>)(frac*1000000.0);
<a name='L988'>    <a href='../D/4080.html' title='Multiple defined in 2 places.'>Py_BEGIN_ALLOW_THREADS</a>
<a name='L989'>    <b>if</b> (select(0, (fd_set *)0, (fd_set *)0, (fd_set *)0, &amp;t) != 0) <font color='red'>{</font>
<a name='L990'><font color='darkred'>#ifdef</font> EINTR
<a name='L991'>        <b>if</b> (errno != EINTR) <font color='red'>{</font>
<a name='L992'><font color='darkred'>#else</font>
<a name='L993'>        <b>if</b> (1) <font color='red'>{</font>
<a name='L994'><font color='darkred'>#endif</font>
<a name='L995'>            <a href='../D/4082.html' title='Multiple defined in 2 places.'>Py_BLOCK_THREADS</a>
<a name='L996'>            <a href='../S/3106.html#L452' title='Defined at 452 in Python/errors.c.'>PyErr_SetFromErrno</a>(PyExc_IOError);
<a name='L997'>            <b>return</b> -1;
<a name='L998'>        <font color='red'>}</font>
<a name='L999'>    <font color='red'>}</font>
<a name='L1000'>    <a href='../D/4114.html' title='Multiple defined in 2 places.'>Py_END_ALLOW_THREADS</a>
<a name='L1001'><font color='darkred'>#elif</font> <b>defined</b>(__WATCOMC__) &amp;&amp; !<b>defined</b>(__QNX__)
<a name='L1002'>    <i><font color='green'>/* XXX Can't interrupt this sleep */</font></i>
<a name='L1003'>    <a href='../D/4080.html' title='Multiple defined in 2 places.'>Py_BEGIN_ALLOW_THREADS</a>
<a name='L1004'>    delay((<b>int</b>)(secs * 1000 + 0.5));  <i><font color='green'>/* delay() uses milliseconds */</font></i>
<a name='L1005'>    <a href='../D/4114.html' title='Multiple defined in 2 places.'>Py_END_ALLOW_THREADS</a>
<a name='L1006'><font color='darkred'>#elif</font> <b>defined</b>(<a href='../S/2906.html#L81' title='Defined at 81 in PC/pyconfig.h.'>MS_WINDOWS</a>)
<a name='L1007'>    <font color='red'>{</font>
<a name='L1008'>        <b>double</b> millisecs = secs * 1000.0;
<a name='L1009'>        <b>unsigned</b> <b>long</b> ul_millis;
<a name='L1010'>
<a name='L1011'>        <b>if</b> (millisecs &gt; (<b>double</b>)ULONG_MAX) <font color='red'>{</font>
<a name='L1012'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_OverflowError,
<a name='L1013'>                            "sleep length is too large");
<a name='L1014'>            <b>return</b> -1;
<a name='L1015'>        <font color='red'>}</font>
<a name='L1016'>        <a href='../D/4080.html' title='Multiple defined in 2 places.'>Py_BEGIN_ALLOW_THREADS</a>
<a name='L1017'>        <i><font color='green'>/* Allow sleep(0) to maintain win32 semantics, and as decreed</font></i>
<a name='L1018'><i><font color='green'>         * by Guido, only the main thread can be interrupted.</font></i>
<a name='L1019'><i><font color='green'>         */</font></i>
<a name='L1020'>        ul_millis = (<b>unsigned</b> <b>long</b>)millisecs;
<a name='L1021'>        <b>if</b> (ul_millis == 0 ||
<a name='L1022'>            main_thread != <a href='../D/3856.html' title='Multiple defined in 10 places.'>PyThread_get_thread_ident</a>())
<a name='L1023'>            <a href='../S/2618.html#L307' title='Defined at 307 in Modules/_tkinter.c.'>Sleep</a>(ul_millis);
<a name='L1024'>        <b>else</b> <font color='red'>{</font>
<a name='L1025'>            DWORD rc;
<a name='L1026'>            ResetEvent(hInterruptEvent);
<a name='L1027'>            rc = WaitForSingleObject(hInterruptEvent, ul_millis);
<a name='L1028'>            <b>if</b> (rc == WAIT_OBJECT_0) <font color='red'>{</font>
<a name='L1029'>                <i><font color='green'>/* Yield to make sure real Python signal</font></i>
<a name='L1030'><i><font color='green'>                 * handler called.</font></i>
<a name='L1031'><i><font color='green'>                 */</font></i>
<a name='L1032'>                <a href='../S/2618.html#L307' title='Defined at 307 in Modules/_tkinter.c.'>Sleep</a>(1);
<a name='L1033'>                <a href='../D/4082.html' title='Multiple defined in 2 places.'>Py_BLOCK_THREADS</a>
<a name='L1034'>                errno = EINTR;
<a name='L1035'>                <a href='../S/3106.html#L452' title='Defined at 452 in Python/errors.c.'>PyErr_SetFromErrno</a>(PyExc_IOError);
<a name='L1036'>                <b>return</b> -1;
<a name='L1037'>            <font color='red'>}</font>
<a name='L1038'>        <font color='red'>}</font>
<a name='L1039'>        <a href='../D/4114.html' title='Multiple defined in 2 places.'>Py_END_ALLOW_THREADS</a>
<a name='L1040'>    <font color='red'>}</font>
<a name='L1041'><font color='darkred'>#elif</font> <b>defined</b>(<a href='../D/2567.html' title='Multiple defined in 2 places.'>PYOS_OS2</a>)
<a name='L1042'>    <i><font color='green'>/* This Sleep *IS* Interruptable by Exceptions */</font></i>
<a name='L1043'>    <a href='../D/4080.html' title='Multiple defined in 2 places.'>Py_BEGIN_ALLOW_THREADS</a>
<a name='L1044'>    <b>if</b> (DosSleep(secs * 1000) != NO_ERROR) <font color='red'>{</font>
<a name='L1045'>        <a href='../D/4082.html' title='Multiple defined in 2 places.'>Py_BLOCK_THREADS</a>
<a name='L1046'>        <a href='../S/3106.html#L452' title='Defined at 452 in Python/errors.c.'>PyErr_SetFromErrno</a>(PyExc_IOError);
<a name='L1047'>        <b>return</b> -1;
<a name='L1048'>    <font color='red'>}</font>
<a name='L1049'>    <a href='../D/4114.html' title='Multiple defined in 2 places.'>Py_END_ALLOW_THREADS</a>
<a name='L1050'><font color='darkred'>#else</font>
<a name='L1051'>    <i><font color='green'>/* XXX Can't interrupt this sleep */</font></i>
<a name='L1052'>    <a href='../D/4080.html' title='Multiple defined in 2 places.'>Py_BEGIN_ALLOW_THREADS</a>
<a name='L1053'>    sleep((<b>int</b>)secs);
<a name='L1054'>    <a href='../D/4114.html' title='Multiple defined in 2 places.'>Py_END_ALLOW_THREADS</a>
<a name='L1055'><font color='darkred'>#endif</font>
<a name='L1056'>
<a name='L1057'>    <b>return</b> 0;
<a name='L1058'><font color='red'>}</font>
</pre>
<hr>
<a name='BOTTOM'>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L28'>[^]</a><a href='#L978'>[v]</a><a href='#TOP'>[top]</a>[bottom]<a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
</body>
</html>
