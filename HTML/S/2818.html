<html>
<head>
<title>Objects/stringlib/string_format.h</title>
<meta name='robots' content='noindex,nofollow'>
<meta name='generator' content='GLOBAL-5.8.1'>
</head>
<body text='#191970' bgcolor='#f5f5dc' vlink='gray'>
<a name='TOP'><h2><a href='../mains.html'>root</a>/<a href='../files/3391.html'>Objects</a>/<a href='../files/3392.html'>stringlib</a>/string_format.h</h2>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L59'>[^]</a><a href='#L1331'>[v]</a>[top]<a href='#BOTTOM'>[bottom]</a><a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
<hr>
<h2><a href='2828.html#L9054' title='Included from 9054 in Objects/unicodeobject.c.'>INCLUDED FROM</a></h2>
<hr>
<h2>DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href='#L59' title='Defined at 59.'>AutoNumber_Init</a>
<li><a href='#L66' title='Defined at 66.'>Py_LOCAL_INLINE</a>
<li><a href='#L77' title='Defined at 77.'>Py_LOCAL_INLINE</a>
<li><a href='#L88' title='Defined at 88.'>Py_LOCAL_INLINE</a>
<li><a href='#L101' title='Defined at 101.'>autonumber_state_error</a>
<li><a href='#L136' title='Defined at 136.'>output_initialize</a>
<li><a href='#L156' title='Defined at 156.'>output_extend</a>
<li><a href='#L182' title='Defined at 182.'>output_data</a>
<li><a href='#L196' title='Defined at 196.'>get_integer</a>
<li><a href='#L235' title='Defined at 235.'>getattr</a>
<li><a href='#L248' title='Defined at 248.'>getitem_sequence</a>
<li><a href='#L255' title='Defined at 255.'>getitem_idx</a>
<li><a href='#L268' title='Defined at 268.'>getitem_str</a>
<li><a href='#L291' title='Defined at 291.'>FieldNameIterator_init</a>
<li><a href='#L300' title='Defined at 300.'>_FieldNameIterator_attr</a>
<li><a href='#L325' title='Defined at 325.'>_FieldNameIterator_item</a>
<li><a href='#L357' title='Defined at 357.'>FieldNameIterator_next</a>
<li><a href='#L403' title='Defined at 403.'>field_name_split</a>
<li><a href='#L481' title='Defined at 481.'>get_field_object</a>
<li><a href='#L566' title='Defined at 566.'>render_field</a>
<li><a href='#L632' title='Defined at 632.'>parse_field</a>
<li><a href='#L711' title='Defined at 711.'>MarkupIterator_init</a>
<li><a href='#L720' title='Defined at 720.'>MarkupIterator_next</a>
<li><a href='#L840' title='Defined at 840.'>do_conversion</a>
<li><a href='#L883' title='Defined at 883.'>output_markup</a>
<li><a href='#L946' title='Defined at 946.'>do_markup</a>
<li><a href='#L980' title='Defined at 980.'>build_string</a>
<li><a href='#L1028' title='Defined at 1028.'>do_string_format</a>
<li><a href='#L1046' title='Defined at 1046.'>do_string_format_map</a>
<li><a href='#L1070' title='Defined at 1070.'>formatteriter_dealloc</a>
<li><a href='#L1085' title='Defined at 1085.'>formatteriter_next</a>
<li><a href='#L1191' title='Defined at 1191.'>formatter_parser</a>
<li><a href='#L1235' title='Defined at 1235.'>fieldnameiter_dealloc</a>
<li><a href='#L1248' title='Defined at 1248.'>fieldnameiter_next</a>
<li><a href='#L1331' title='Defined at 1331.'>formatter_field_name_split</a>
</ol>
<hr>
<pre>
<a name='L1'><i><font color='green'>/*</font></i>
<a name='L2'><i><font color='green'>    string_format.h -- implementation of string.format().</font></i>
<a name='L3'><i><font color='green'></font></i>
<a name='L4'><i><font color='green'>    It uses the Objects/stringlib conventions, so that it can be</font></i>
<a name='L5'><i><font color='green'>    compiled for both unicode and string objects.</font></i>
<a name='L6'><i><font color='green'>*/</font></i>
<a name='L7'>
<a name='L8'>
<a name='L9'><i><font color='green'>/* Defines for Python 2.6 compatability */</font></i>
<a name='L10'><font color='darkred'>#if</font> <a href='../S/549.html#L34' title='Defined at 34 in Include/patchlevel.h.'>PY_VERSION_HEX</a> &lt; 0x03000000
<a name='L11'><font color='darkred'>#define</font> <a href='../R/3130.html' title='Multiple refered from 131 places.'>PyLong_FromSsize_t</a> _PyLong_FromSsize_t
<a name='L12'><font color='darkred'>#endif</font>
<a name='L13'>
<a name='L14'><i><font color='green'>/* Defines for more efficiently reallocating the string buffer */</font></i>
<a name='L15'><font color='darkred'>#define</font> <a href='../R/1517.html' title='Multiple refered from 2 places.'>INITIAL_SIZE_INCREMENT</a> 100
<a name='L16'><font color='darkred'>#define</font> <a href='../S/2818.html#L168' title='Refered from 168 in Objects/stringlib/string_format.h.'>SIZE_MULTIPLIER</a> 2
<a name='L17'><font color='darkred'>#define</font> <a href='../S/2818.html#L167' title='Refered from 167 in Objects/stringlib/string_format.h.'>MAX_SIZE_INCREMENT</a>  3200
<a name='L18'>
<a name='L19'>
<a name='L20'><i><font color='green'>/************************************************************************/</font></i>
<a name='L21'><i><font color='green'>/***********   Global data structures and forward declarations  *********/</font></i>
<a name='L22'><i><font color='green'>/************************************************************************/</font></i>
<a name='L23'>
<a name='L24'><i><font color='green'>/*</font></i>
<a name='L25'><i><font color='green'>   A SubString consists of the characters between two string or</font></i>
<a name='L26'><i><font color='green'>   unicode pointers.</font></i>
<a name='L27'><i><font color='green'>*/</font></i>
<a name='L28'><b>typedef</b> <b>struct</b> <font color='red'>{</font>
<a name='L29'>    <a href='../D/4980.html' title='Multiple defined in 3 places.'>STRINGLIB_CHAR</a> *ptr;
<a name='L30'>    <a href='../D/4980.html' title='Multiple defined in 3 places.'>STRINGLIB_CHAR</a> *end;
<a name='L31'><font color='red'>}</font> <a href='../R/4510.html' title='Multiple refered from 16 places.'>SubString</a>;
<a name='L32'>
<a name='L33'>
<a name='L34'><b>typedef</b> <b>enum</b> <font color='red'>{</font>
<a name='L35'>    <a href='../R/59.html' title='Multiple refered from 2 places.'>ANS_INIT</a>,
<a name='L36'>    <a href='../S/2818.html#L456' title='Refered from 456 in Objects/stringlib/string_format.h.'>ANS_AUTO</a>,
<a name='L37'>    <a href='../R/60.html' title='Multiple refered from 2 places.'>ANS_MANUAL</a>
<a name='L38'><font color='red'>}</font> <a href='../S/2818.html#L42' title='Refered from 42 in Objects/stringlib/string_format.h.'>AutoNumberState</a>;   <i><font color='green'>/* Keep track if we're auto-numbering fields */</font></i>
<a name='L39'>
<a name='L40'><i><font color='green'>/* Keeps track of our auto-numbering state, and which number field we're on */</font></i>
<a name='L41'><b>typedef</b> <b>struct</b> <font color='red'>{</font>
<a name='L42'>    <a href='../S/2818.html#L38' title='Defined at 38 in Objects/stringlib/string_format.h.'>AutoNumberState</a> an_state;
<a name='L43'>    <b>int</b> an_field_number;
<a name='L44'><font color='red'>}</font> <a href='../S/2818.html#L1038' title='Refered from 1038 in Objects/stringlib/string_format.h.'>AutoNumber</a>;
<a name='L45'>
<a name='L46'>
<a name='L47'><i><font color='green'>/* forward declaration for recursion */</font></i>
<a name='L48'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L49'><a href='../S/2818.html#L980' title='Defined at 980 in Objects/stringlib/string_format.h.'>build_string</a>(SubString *input, PyObject *args, PyObject *kwargs,
<a name='L50'>             <b>int</b> recursion_depth, AutoNumber *auto_number);
<a name='L51'>
<a name='L52'>
<a name='L53'>
<a name='L54'><i><font color='green'>/************************************************************************/</font></i>
<a name='L55'><i><font color='green'>/**************************  Utility  functions  ************************/</font></i>
<a name='L56'><i><font color='green'>/************************************************************************/</font></i>
<a name='L57'>
<a name='L58'><b>static</b> <b>void</b>
<a name='L59'><a href='../S/2818.html#L1040' title='Refered from 1040 in Objects/stringlib/string_format.h.'>AutoNumber_Init</a>(AutoNumber *auto_number)
<a name='L60'><font color='red'>{</font>
<a name='L61'>    auto_number-&gt;an_state = <a href='../S/2818.html#L35' title='Defined at 35 in Objects/stringlib/string_format.h.'>ANS_INIT</a>;
<a name='L62'>    auto_number-&gt;an_field_number = 0;
<a name='L63'><font color='red'>}</font>
<a name='L64'>
<a name='L65'><i><font color='green'>/* fill in a SubString from a pointer and length */</font></i>
<a name='L66'>Py_LOCAL_INLINE(<b>void</b>)
<a name='L67'>SubString_init(SubString *str, <a href='../D/4980.html' title='Multiple defined in 3 places.'>STRINGLIB_CHAR</a> *p, <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> len)
<a name='L68'><font color='red'>{</font>
<a name='L69'>    str-&gt;ptr = p;
<a name='L70'>    <b>if</b> (p == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L71'>        str-&gt;end = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L72'>    <b>else</b>
<a name='L73'>        str-&gt;end = str-&gt;ptr + len;
<a name='L74'><font color='red'>}</font>
<a name='L75'>
<a name='L76'><i><font color='green'>/* return a new string.  if str-&gt;ptr is NULL, return None */</font></i>
<a name='L77'>Py_LOCAL_INLINE(PyObject *)
<a name='L78'>SubString_new_object(SubString *str)
<a name='L79'><font color='red'>{</font>
<a name='L80'>    <b>if</b> (str-&gt;ptr == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L81'>        Py_INCREF(Py_None);
<a name='L82'>        <b>return</b> Py_None;
<a name='L83'>    <font color='red'>}</font>
<a name='L84'>    <b>return</b> <a href='../D/4997.html' title='Multiple defined in 3 places.'>STRINGLIB_NEW</a>(str-&gt;ptr, str-&gt;end - str-&gt;ptr);
<a name='L85'><font color='red'>}</font>
<a name='L86'>
<a name='L87'><i><font color='green'>/* return a new string.  if str-&gt;ptr is NULL, return None */</font></i>
<a name='L88'>Py_LOCAL_INLINE(PyObject *)
<a name='L89'>SubString_new_object_or_empty(SubString *str)
<a name='L90'><font color='red'>{</font>
<a name='L91'>    <b>if</b> (str-&gt;ptr == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L92'>        <b>return</b> <a href='../D/4997.html' title='Multiple defined in 3 places.'>STRINGLIB_NEW</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, 0);
<a name='L93'>    <font color='red'>}</font>
<a name='L94'>    <b>return</b> <a href='../D/4997.html' title='Multiple defined in 3 places.'>STRINGLIB_NEW</a>(str-&gt;ptr, str-&gt;end - str-&gt;ptr);
<a name='L95'><font color='red'>}</font>
<a name='L96'>
<a name='L97'><i><font color='green'>/* Return 1 if an error has been detected switching between automatic</font></i>
<a name='L98'><i><font color='green'>   field numbering and manual field specification, else return 0. Set</font></i>
<a name='L99'><i><font color='green'>   ValueError on error. */</font></i>
<a name='L100'><b>static</b> <b>int</b>
<a name='L101'><a href='../S/2818.html#L462' title='Refered from 462 in Objects/stringlib/string_format.h.'>autonumber_state_error</a>(AutoNumberState state, <b>int</b> field_name_is_empty)
<a name='L102'><font color='red'>{</font>
<a name='L103'>    <b>if</b> (<a href='../S/530.html#L46' title='Defined at 46 in Include/grammar.h.'>state</a> == <a href='../S/2818.html#L37' title='Defined at 37 in Objects/stringlib/string_format.h.'>ANS_MANUAL</a>) <font color='red'>{</font>
<a name='L104'>        <b>if</b> (field_name_is_empty) <font color='red'>{</font>
<a name='L105'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError, "cannot switch from "
<a name='L106'>                            "manual field specification to "
<a name='L107'>                            "automatic field numbering");
<a name='L108'>            <b>return</b> 1;
<a name='L109'>        <font color='red'>}</font>
<a name='L110'>    <font color='red'>}</font>
<a name='L111'>    <b>else</b> <font color='red'>{</font>
<a name='L112'>        <b>if</b> (!field_name_is_empty) <font color='red'>{</font>
<a name='L113'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError, "cannot switch from "
<a name='L114'>                            "automatic field numbering to "
<a name='L115'>                            "manual field specification");
<a name='L116'>            <b>return</b> 1;
<a name='L117'>        <font color='red'>}</font>
<a name='L118'>    <font color='red'>}</font>
<a name='L119'>    <b>return</b> 0;
<a name='L120'><font color='red'>}</font>
<a name='L121'>
<a name='L122'>
<a name='L123'><i><font color='green'>/************************************************************************/</font></i>
<a name='L124'><i><font color='green'>/***********    Output string management functions       ****************/</font></i>
<a name='L125'><i><font color='green'>/************************************************************************/</font></i>
<a name='L126'>
<a name='L127'><b>typedef</b> <b>struct</b> <font color='red'>{</font>
<a name='L128'>    <a href='../D/4980.html' title='Multiple defined in 3 places.'>STRINGLIB_CHAR</a> *ptr;
<a name='L129'>    <a href='../D/4980.html' title='Multiple defined in 3 places.'>STRINGLIB_CHAR</a> *end;
<a name='L130'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *obj;
<a name='L131'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> size_increment;
<a name='L132'><font color='red'>}</font> <a href='../S/2818.html#L983' title='Refered from 983 in Objects/stringlib/string_format.h.'>OutputString</a>;
<a name='L133'>
<a name='L134'><i><font color='green'>/* initialize an OutputString object, reserving size characters */</font></i>
<a name='L135'><b>static</b> <b>int</b>
<a name='L136'><a href='../S/2818.html#L998' title='Refered from 998 in Objects/stringlib/string_format.h.'>output_initialize</a>(OutputString *output, <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> size)
<a name='L137'><font color='red'>{</font>
<a name='L138'>    output-&gt;obj = <a href='../D/4997.html' title='Multiple defined in 3 places.'>STRINGLIB_NEW</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, size);
<a name='L139'>    <b>if</b> (output-&gt;obj == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L140'>        <b>return</b> 0;
<a name='L141'>
<a name='L142'>    output-&gt;ptr = <a href='../D/5003.html' title='Multiple defined in 3 places.'>STRINGLIB_STR</a>(output-&gt;obj);
<a name='L143'>    output-&gt;end = <a href='../D/4994.html' title='Multiple defined in 3 places.'>STRINGLIB_LEN</a>(output-&gt;obj) + output-&gt;ptr;
<a name='L144'>    output-&gt;size_increment = <a href='../S/2818.html#L15' title='Defined at 15 in Objects/stringlib/string_format.h.'>INITIAL_SIZE_INCREMENT</a>;
<a name='L145'>
<a name='L146'>    <b>return</b> 1;
<a name='L147'><font color='red'>}</font>
<a name='L148'>
<a name='L149'><i><font color='green'>/*</font></i>
<a name='L150'><i><font color='green'>    output_extend reallocates the output string buffer.</font></i>
<a name='L151'><i><font color='green'>    It returns a status:  0 for a failed reallocation,</font></i>
<a name='L152'><i><font color='green'>    1 for success.</font></i>
<a name='L153'><i><font color='green'>*/</font></i>
<a name='L154'>
<a name='L155'><b>static</b> <b>int</b>
<a name='L156'><a href='../S/2818.html#L184' title='Refered from 184 in Objects/stringlib/string_format.h.'>output_extend</a>(OutputString *output, <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> count)
<a name='L157'><font color='red'>{</font>
<a name='L158'>    <a href='../D/4980.html' title='Multiple defined in 3 places.'>STRINGLIB_CHAR</a> *startptr = <a href='../D/5003.html' title='Multiple defined in 3 places.'>STRINGLIB_STR</a>(output-&gt;obj);
<a name='L159'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> curlen = output-&gt;ptr - startptr;
<a name='L160'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> maxlen = curlen + count + output-&gt;size_increment;
<a name='L161'>
<a name='L162'>    <b>if</b> (<a href='../D/5001.html' title='Multiple defined in 2 places.'>STRINGLIB_RESIZE</a>(&amp;output-&gt;obj, maxlen) &lt; 0)
<a name='L163'>        <b>return</b> 0;
<a name='L164'>    startptr = <a href='../D/5003.html' title='Multiple defined in 3 places.'>STRINGLIB_STR</a>(output-&gt;obj);
<a name='L165'>    output-&gt;ptr = startptr + curlen;
<a name='L166'>    output-&gt;end = startptr + maxlen;
<a name='L167'>    <b>if</b> (output-&gt;size_increment &lt; <a href='../S/2818.html#L17' title='Defined at 17 in Objects/stringlib/string_format.h.'>MAX_SIZE_INCREMENT</a>)
<a name='L168'>        output-&gt;size_increment *= <a href='../S/2818.html#L16' title='Defined at 16 in Objects/stringlib/string_format.h.'>SIZE_MULTIPLIER</a>;
<a name='L169'>    <b>return</b> 1;
<a name='L170'><font color='red'>}</font>
<a name='L171'>
<a name='L172'><i><font color='green'>/*</font></i>
<a name='L173'><i><font color='green'>    output_data dumps characters into our output string</font></i>
<a name='L174'><i><font color='green'>    buffer.</font></i>
<a name='L175'><i><font color='green'></font></i>
<a name='L176'><i><font color='green'>    In some cases, it has to reallocate the string.</font></i>
<a name='L177'><i><font color='green'></font></i>
<a name='L178'><i><font color='green'>    It returns a status:  0 for a failed reallocation,</font></i>
<a name='L179'><i><font color='green'>    1 for success.</font></i>
<a name='L180'><i><font color='green'>*/</font></i>
<a name='L181'><b>static</b> <b>int</b>
<a name='L182'><a href='../R/9431.html' title='Multiple refered from 2 places.'>output_data</a>(OutputString *output, <b>const</b> <a href='../D/4980.html' title='Multiple defined in 3 places.'>STRINGLIB_CHAR</a> *s, <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> count)
<a name='L183'><font color='red'>{</font>
<a name='L184'>    <b>if</b> ((count &gt; output-&gt;end - output-&gt;ptr) &amp;&amp; !<a href='../S/2818.html#L156' title='Defined at 156 in Objects/stringlib/string_format.h.'>output_extend</a>(output, count))
<a name='L185'>        <b>return</b> 0;
<a name='L186'>    <a href='../D/9803.html' title='Multiple defined in 4 places.'>memcpy</a>(output-&gt;ptr, s, count * <b>sizeof</b>(<a href='../D/4980.html' title='Multiple defined in 3 places.'>STRINGLIB_CHAR</a>));
<a name='L187'>    output-&gt;ptr += count;
<a name='L188'>    <b>return</b> 1;
<a name='L189'><font color='red'>}</font>
<a name='L190'>
<a name='L191'><i><font color='green'>/************************************************************************/</font></i>
<a name='L192'><i><font color='green'>/***********  Format string parsing -- integers and identifiers *********/</font></i>
<a name='L193'><i><font color='green'>/************************************************************************/</font></i>
<a name='L194'>
<a name='L195'><b>static</b> <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a>
<a name='L196'><a href='../R/8063.html' title='Multiple refered from 4 places.'>get_integer</a>(<b>const</b> SubString *str)
<a name='L197'><font color='red'>{</font>
<a name='L198'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> accumulator = 0;
<a name='L199'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> digitval;
<a name='L200'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> oldaccumulator;
<a name='L201'>    <a href='../D/4980.html' title='Multiple defined in 3 places.'>STRINGLIB_CHAR</a> *p;
<a name='L202'>
<a name='L203'>    <i><font color='green'>/* empty string is an error */</font></i>
<a name='L204'>    <b>if</b> (str-&gt;ptr &gt;= str-&gt;end)
<a name='L205'>        <b>return</b> -1;
<a name='L206'>
<a name='L207'>    <b>for</b> (p = str-&gt;ptr; p &lt; str-&gt;end; p++) <font color='red'>{</font>
<a name='L208'>        digitval = <a href='../D/5006.html' title='Multiple defined in 2 places.'>STRINGLIB_TODECIMAL</a>(*p);
<a name='L209'>        <b>if</b> (digitval &lt; 0)
<a name='L210'>            <b>return</b> -1;
<a name='L211'>        <i><font color='green'>/*</font></i>
<a name='L212'><i><font color='green'>           This trick was copied from old Unicode format code.  It's cute,</font></i>
<a name='L213'><i><font color='green'>           but would really suck on an old machine with a slow divide</font></i>
<a name='L214'><i><font color='green'>           implementation.  Fortunately, in the normal case we do not</font></i>
<a name='L215'><i><font color='green'>           expect too many digits.</font></i>
<a name='L216'><i><font color='green'>        */</font></i>
<a name='L217'>        oldaccumulator = accumulator;
<a name='L218'>        accumulator *= 10;
<a name='L219'>        <b>if</b> ((accumulator+10)/10 != oldaccumulator+1) <font color='red'>{</font>
<a name='L220'>            <a href='../S/3106.html#L600' title='Defined at 600 in Python/errors.c.'>PyErr_Format</a>(PyExc_ValueError,
<a name='L221'>                         "Too many decimal digits in format string");
<a name='L222'>            <b>return</b> -1;
<a name='L223'>        <font color='red'>}</font>
<a name='L224'>        accumulator += digitval;
<a name='L225'>    <font color='red'>}</font>
<a name='L226'>    <b>return</b> accumulator;
<a name='L227'><font color='red'>}</font>
<a name='L228'>
<a name='L229'><i><font color='green'>/************************************************************************/</font></i>
<a name='L230'><i><font color='green'>/******** Functions to get field objects and specification strings ******/</font></i>
<a name='L231'><i><font color='green'>/************************************************************************/</font></i>
<a name='L232'>
<a name='L233'><i><font color='green'>/* do the equivalent of obj.name */</font></i>
<a name='L234'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L235'><a href='../R/8139.html' title='Multiple refered from 7 places.'>getattr</a>(PyObject *obj, SubString *name)
<a name='L236'><font color='red'>{</font>
<a name='L237'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *newobj;
<a name='L238'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *str = SubString_new_object(name);
<a name='L239'>    <b>if</b> (str == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L240'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L241'>    newobj = <a href='../S/2803.html#L822' title='Defined at 822 in Objects/object.c.'>PyObject_GetAttr</a>(obj, str);
<a name='L242'>    Py_DECREF(str);
<a name='L243'>    <b>return</b> newobj;
<a name='L244'><font color='red'>}</font>
<a name='L245'>
<a name='L246'><i><font color='green'>/* do the equivalent of obj[idx], where obj is a sequence */</font></i>
<a name='L247'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L248'><a href='../S/2818.html#L534' title='Refered from 534 in Objects/stringlib/string_format.h.'>getitem_sequence</a>(PyObject *obj, <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> idx)
<a name='L249'><font color='red'>{</font>
<a name='L250'>    <b>return</b> <a href='../S/2775.html#L1584' title='Defined at 1584 in Objects/abstract.c.'>PySequence_GetItem</a>(obj, idx);
<a name='L251'><font color='red'>}</font>
<a name='L252'>
<a name='L253'><i><font color='green'>/* do the equivalent of obj[idx], where obj is not a sequence */</font></i>
<a name='L254'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L255'><a href='../S/2818.html#L537' title='Refered from 537 in Objects/stringlib/string_format.h.'>getitem_idx</a>(PyObject *obj, <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> idx)
<a name='L256'><font color='red'>{</font>
<a name='L257'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *newobj;
<a name='L258'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *idx_obj = <a href='../D/3469.html' title='Multiple defined in 2 places.'>PyLong_FromSsize_t</a>(idx);
<a name='L259'>    <b>if</b> (idx_obj == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L260'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L261'>    newobj = <a href='../S/2775.html#L113' title='Defined at 113 in Objects/abstract.c.'>PyObject_GetItem</a>(obj, idx_obj);
<a name='L262'>    Py_DECREF(idx_obj);
<a name='L263'>    <b>return</b> newobj;
<a name='L264'><font color='red'>}</font>
<a name='L265'>
<a name='L266'><i><font color='green'>/* do the equivalent of obj[name] */</font></i>
<a name='L267'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L268'><a href='../R/8155.html' title='Multiple refered from 9 places.'>getitem_str</a>(PyObject *obj, SubString *name)
<a name='L269'><font color='red'>{</font>
<a name='L270'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *newobj;
<a name='L271'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *str = SubString_new_object(name);
<a name='L272'>    <b>if</b> (str == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L273'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L274'>    newobj = <a href='../S/2775.html#L113' title='Defined at 113 in Objects/abstract.c.'>PyObject_GetItem</a>(obj, str);
<a name='L275'>    Py_DECREF(str);
<a name='L276'>    <b>return</b> newobj;
<a name='L277'><font color='red'>}</font>
<a name='L278'>
<a name='L279'><b>typedef</b> <b>struct</b> <font color='red'>{</font>
<a name='L280'>    <i><font color='green'>/* the entire string we're parsing.  we assume that someone else</font></i>
<a name='L281'><i><font color='green'>       is managing its lifetime, and that it will exist for the</font></i>
<a name='L282'><i><font color='green'>       lifetime of the iterator.  can be empty */</font></i>
<a name='L283'>    <a href='../S/2818.html#L31' title='Defined at 31 in Objects/stringlib/string_format.h.'>SubString</a> str;
<a name='L284'>
<a name='L285'>    <i><font color='green'>/* pointer to where we are inside field_name */</font></i>
<a name='L286'>    <a href='../D/4980.html' title='Multiple defined in 3 places.'>STRINGLIB_CHAR</a> *ptr;
<a name='L287'><font color='red'>}</font> <a href='../R/1200.html' title='Multiple refered from 2 places.'>FieldNameIterator</a>;
<a name='L288'>
<a name='L289'>
<a name='L290'><b>static</b> <b>int</b>
<a name='L291'><a href='../S/2818.html#L430' title='Refered from 430 in Objects/stringlib/string_format.h.'>FieldNameIterator_init</a>(FieldNameIterator *self, <a href='../D/4980.html' title='Multiple defined in 3 places.'>STRINGLIB_CHAR</a> *ptr,
<a name='L292'>                       <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> len)
<a name='L293'><font color='red'>{</font>
<a name='L294'>    SubString_init(&amp;self-&gt;str, ptr, len);
<a name='L295'>    self-&gt;ptr = self-&gt;str.ptr;
<a name='L296'>    <b>return</b> 1;
<a name='L297'><font color='red'>}</font>
<a name='L298'>
<a name='L299'><b>static</b> <b>int</b>
<a name='L300'><a href='../S/2818.html#L367' title='Refered from 367 in Objects/stringlib/string_format.h.'>_FieldNameIterator_attr</a>(FieldNameIterator *self, SubString *name)
<a name='L301'><font color='red'>{</font>
<a name='L302'>    <a href='../D/4980.html' title='Multiple defined in 3 places.'>STRINGLIB_CHAR</a> c;
<a name='L303'>
<a name='L304'>    name-&gt;ptr = self-&gt;ptr;
<a name='L305'>
<a name='L306'>    <i><font color='green'>/* return everything until '.' or '[' */</font></i>
<a name='L307'>    <b>while</b> (self-&gt;ptr &lt; self-&gt;str.end) <font color='red'>{</font>
<a name='L308'>        <b>switch</b> (c = *self-&gt;ptr++) <font color='red'>{</font>
<a name='L309'>        <b>case</b> '[':
<a name='L310'>        <b>case</b> '.':
<a name='L311'>            <i><font color='green'>/* backup so that we this character will be seen next time */</font></i>
<a name='L312'>            self-&gt;ptr--;
<a name='L313'>            <b>break</b>;
<a name='L314'>        <b>default</b>:
<a name='L315'>            <b>continue</b>;
<a name='L316'>        <font color='red'>}</font>
<a name='L317'>        <b>break</b>;
<a name='L318'>    <font color='red'>}</font>
<a name='L319'>    <i><font color='green'>/* end of string is okay */</font></i>
<a name='L320'>    name-&gt;end = self-&gt;ptr;
<a name='L321'>    <b>return</b> 1;
<a name='L322'><font color='red'>}</font>
<a name='L323'>
<a name='L324'><b>static</b> <b>int</b>
<a name='L325'><a href='../S/2818.html#L373' title='Refered from 373 in Objects/stringlib/string_format.h.'>_FieldNameIterator_item</a>(FieldNameIterator *self, SubString *name)
<a name='L326'><font color='red'>{</font>
<a name='L327'>    <b>int</b> bracket_seen = 0;
<a name='L328'>    <a href='../D/4980.html' title='Multiple defined in 3 places.'>STRINGLIB_CHAR</a> c;
<a name='L329'>
<a name='L330'>    name-&gt;ptr = self-&gt;ptr;
<a name='L331'>
<a name='L332'>    <i><font color='green'>/* return everything until ']' */</font></i>
<a name='L333'>    <b>while</b> (self-&gt;ptr &lt; self-&gt;str.end) <font color='red'>{</font>
<a name='L334'>        <b>switch</b> (c = *self-&gt;ptr++) <font color='red'>{</font>
<a name='L335'>        <b>case</b> ']':
<a name='L336'>            bracket_seen = 1;
<a name='L337'>            <b>break</b>;
<a name='L338'>        <b>default</b>:
<a name='L339'>            <b>continue</b>;
<a name='L340'>        <font color='red'>}</font>
<a name='L341'>        <b>break</b>;
<a name='L342'>    <font color='red'>}</font>
<a name='L343'>    <i><font color='green'>/* make sure we ended with a ']' */</font></i>
<a name='L344'>    <b>if</b> (!bracket_seen) <font color='red'>{</font>
<a name='L345'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError, "Missing ']' in format string");
<a name='L346'>        <b>return</b> 0;
<a name='L347'>    <font color='red'>}</font>
<a name='L348'>
<a name='L349'>    <i><font color='green'>/* end of string is okay */</font></i>
<a name='L350'>    <i><font color='green'>/* don't include the ']' */</font></i>
<a name='L351'>    name-&gt;end = self-&gt;ptr-1;
<a name='L352'>    <b>return</b> 1;
<a name='L353'><font color='red'>}</font>
<a name='L354'>
<a name='L355'><i><font color='green'>/* returns 0 on error, 1 on non-error termination, and 2 if it returns a value */</font></i>
<a name='L356'><b>static</b> <b>int</b>
<a name='L357'><a href='../R/1202.html' title='Multiple refered from 2 places.'>FieldNameIterator_next</a>(FieldNameIterator *self, <b>int</b> *is_attribute,
<a name='L358'>                       <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> *name_idx, SubString *name)
<a name='L359'><font color='red'>{</font>
<a name='L360'>    <i><font color='green'>/* check at end of input */</font></i>
<a name='L361'>    <b>if</b> (self-&gt;ptr &gt;= self-&gt;str.end)
<a name='L362'>        <b>return</b> 1;
<a name='L363'>
<a name='L364'>    <b>switch</b> (*self-&gt;ptr++) <font color='red'>{</font>
<a name='L365'>    <b>case</b> '.':
<a name='L366'>        *is_attribute = 1;
<a name='L367'>        <b>if</b> (<a href='../S/2818.html#L300' title='Defined at 300 in Objects/stringlib/string_format.h.'>_FieldNameIterator_attr</a>(self, name) == 0)
<a name='L368'>            <b>return</b> 0;
<a name='L369'>        *name_idx = -1;
<a name='L370'>        <b>break</b>;
<a name='L371'>    <b>case</b> '[':
<a name='L372'>        *is_attribute = 0;
<a name='L373'>        <b>if</b> (<a href='../S/2818.html#L325' title='Defined at 325 in Objects/stringlib/string_format.h.'>_FieldNameIterator_item</a>(self, name) == 0)
<a name='L374'>            <b>return</b> 0;
<a name='L375'>        *name_idx = <a href='../D/8865.html' title='Multiple defined in 2 places.'>get_integer</a>(name);
<a name='L376'>        <b>if</b> (*name_idx == -1 &amp;&amp; <a href='../D/3154.html' title='Multiple defined in 2 places.'>PyErr_Occurred</a>())
<a name='L377'>            <b>return</b> 0;
<a name='L378'>        <b>break</b>;
<a name='L379'>    <b>default</b>:
<a name='L380'>        <i><font color='green'>/* Invalid character follows ']' */</font></i>
<a name='L381'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError, "Only '.' or '[' may "
<a name='L382'>                        "follow ']' in format field specifier");
<a name='L383'>        <b>return</b> 0;
<a name='L384'>    <font color='red'>}</font>
<a name='L385'>
<a name='L386'>    <i><font color='green'>/* empty string is an error */</font></i>
<a name='L387'>    <b>if</b> (name-&gt;ptr == name-&gt;end) <font color='red'>{</font>
<a name='L388'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError, "Empty attribute in format string");
<a name='L389'>        <b>return</b> 0;
<a name='L390'>    <font color='red'>}</font>
<a name='L391'>
<a name='L392'>    <b>return</b> 2;
<a name='L393'><font color='red'>}</font>
<a name='L394'>
<a name='L395'>
<a name='L396'><i><font color='green'>/* input: field_name</font></i>
<a name='L397'><i><font color='green'>   output: 'first' points to the part before the first '[' or '.'</font></i>
<a name='L398'><i><font color='green'>           'first_idx' is -1 if 'first' is not an integer, otherwise</font></i>
<a name='L399'><i><font color='green'>                       it's the value of first converted to an integer</font></i>
<a name='L400'><i><font color='green'>           'rest' is an iterator to return the rest</font></i>
<a name='L401'><i><font color='green'>*/</font></i>
<a name='L402'><b>static</b> <b>int</b>
<a name='L403'><a href='../R/7748.html' title='Multiple refered from 2 places.'>field_name_split</a>(<a href='../D/4980.html' title='Multiple defined in 3 places.'>STRINGLIB_CHAR</a> *ptr, <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> len, SubString *first,
<a name='L404'>                 <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> *first_idx, FieldNameIterator *rest,
<a name='L405'>                 AutoNumber *auto_number)
<a name='L406'><font color='red'>{</font>
<a name='L407'>    <a href='../D/4980.html' title='Multiple defined in 3 places.'>STRINGLIB_CHAR</a> c;
<a name='L408'>    <a href='../D/4980.html' title='Multiple defined in 3 places.'>STRINGLIB_CHAR</a> *p = ptr;
<a name='L409'>    <a href='../D/4980.html' title='Multiple defined in 3 places.'>STRINGLIB_CHAR</a> *end = ptr + len;
<a name='L410'>    <b>int</b> field_name_is_empty;
<a name='L411'>    <b>int</b> using_numeric_index;
<a name='L412'>
<a name='L413'>    <i><font color='green'>/* find the part up until the first '.' or '[' */</font></i>
<a name='L414'>    <b>while</b> (p &lt; end) <font color='red'>{</font>
<a name='L415'>        <b>switch</b> (c = *p++) <font color='red'>{</font>
<a name='L416'>        <b>case</b> '[':
<a name='L417'>        <b>case</b> '.':
<a name='L418'>            <i><font color='green'>/* backup so that we this character is available to the</font></i>
<a name='L419'><i><font color='green'>               "rest" iterator */</font></i>
<a name='L420'>            p--;
<a name='L421'>            <b>break</b>;
<a name='L422'>        <b>default</b>:
<a name='L423'>            <b>continue</b>;
<a name='L424'>        <font color='red'>}</font>
<a name='L425'>        <b>break</b>;
<a name='L426'>    <font color='red'>}</font>
<a name='L427'>
<a name='L428'>    <i><font color='green'>/* set up the return values */</font></i>
<a name='L429'>    SubString_init(first, ptr, p - ptr);
<a name='L430'>    <a href='../S/2818.html#L291' title='Defined at 291 in Objects/stringlib/string_format.h.'>FieldNameIterator_init</a>(rest, p, end - p);
<a name='L431'>
<a name='L432'>    <i><font color='green'>/* see if "first" is an integer, in which case it's used as an index */</font></i>
<a name='L433'>    *first_idx = <a href='../D/8865.html' title='Multiple defined in 2 places.'>get_integer</a>(first);
<a name='L434'>    <b>if</b> (*first_idx == -1 &amp;&amp; <a href='../D/3154.html' title='Multiple defined in 2 places.'>PyErr_Occurred</a>())
<a name='L435'>        <b>return</b> 0;
<a name='L436'>
<a name='L437'>    field_name_is_empty = first-&gt;ptr &gt;= first-&gt;end;
<a name='L438'>
<a name='L439'>    <i><font color='green'>/* If the field name is omitted or if we have a numeric index</font></i>
<a name='L440'><i><font color='green'>       specified, then we're doing numeric indexing into args. */</font></i>
<a name='L441'>    using_numeric_index = field_name_is_empty || *first_idx != -1;
<a name='L442'>
<a name='L443'>    <i><font color='green'>/* We always get here exactly one time for each field we're</font></i>
<a name='L444'><i><font color='green'>       processing. And we get here in field order (counting by left</font></i>
<a name='L445'><i><font color='green'>       braces). So this is the perfect place to handle automatic field</font></i>
<a name='L446'><i><font color='green'>       numbering if the field name is omitted. */</font></i>
<a name='L447'>
<a name='L448'>    <i><font color='green'>/* Check if we need to do the auto-numbering. It's not needed if</font></i>
<a name='L449'><i><font color='green'>       we're called from string.Format routines, because it's handled</font></i>
<a name='L450'><i><font color='green'>       in that class by itself. */</font></i>
<a name='L451'>    <b>if</b> (auto_number) <font color='red'>{</font>
<a name='L452'>        <i><font color='green'>/* Initialize our auto numbering state if this is the first</font></i>
<a name='L453'><i><font color='green'>           time we're either auto-numbering or manually numbering. */</font></i>
<a name='L454'>        <b>if</b> (auto_number-&gt;an_state == <a href='../S/2818.html#L35' title='Defined at 35 in Objects/stringlib/string_format.h.'>ANS_INIT</a> &amp;&amp; using_numeric_index)
<a name='L455'>            auto_number-&gt;an_state = field_name_is_empty ?
<a name='L456'>                <a href='../S/2818.html#L36' title='Defined at 36 in Objects/stringlib/string_format.h.'>ANS_AUTO</a> : <a href='../S/2818.html#L37' title='Defined at 37 in Objects/stringlib/string_format.h.'>ANS_MANUAL</a>;
<a name='L457'>
<a name='L458'>        <i><font color='green'>/* Make sure our state is consistent with what we're doing</font></i>
<a name='L459'><i><font color='green'>           this time through. Only check if we're using a numeric</font></i>
<a name='L460'><i><font color='green'>           index. */</font></i>
<a name='L461'>        <b>if</b> (using_numeric_index)
<a name='L462'>            <b>if</b> (<a href='../S/2818.html#L101' title='Defined at 101 in Objects/stringlib/string_format.h.'>autonumber_state_error</a>(auto_number-&gt;an_state,
<a name='L463'>                                       field_name_is_empty))
<a name='L464'>                <b>return</b> 0;
<a name='L465'>        <i><font color='green'>/* Zero length field means we want to do auto-numbering of the</font></i>
<a name='L466'><i><font color='green'>           fields. */</font></i>
<a name='L467'>        <b>if</b> (field_name_is_empty)
<a name='L468'>            *first_idx = (auto_number-&gt;an_field_number)++;
<a name='L469'>    <font color='red'>}</font>
<a name='L470'>
<a name='L471'>    <b>return</b> 1;
<a name='L472'><font color='red'>}</font>
<a name='L473'>
<a name='L474'>
<a name='L475'><i><font color='green'>/*</font></i>
<a name='L476'><i><font color='green'>    get_field_object returns the object inside {}, before the</font></i>
<a name='L477'><i><font color='green'>    format_spec.  It handles getindex and getattr lookups and consumes</font></i>
<a name='L478'><i><font color='green'>    the entire input string.</font></i>
<a name='L479'><i><font color='green'>*/</font></i>
<a name='L480'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L481'><a href='../S/2818.html#L895' title='Refered from 895 in Objects/stringlib/string_format.h.'>get_field_object</a>(SubString *input, PyObject *args, PyObject *kwargs,
<a name='L482'>                 AutoNumber *auto_number)
<a name='L483'><font color='red'>{</font>
<a name='L484'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *obj = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L485'>    <b>int</b> ok;
<a name='L486'>    <b>int</b> is_attribute;
<a name='L487'>    <a href='../S/2818.html#L31' title='Defined at 31 in Objects/stringlib/string_format.h.'>SubString</a> name;
<a name='L488'>    <a href='../S/2818.html#L31' title='Defined at 31 in Objects/stringlib/string_format.h.'>SubString</a> first;
<a name='L489'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> index;
<a name='L490'>    <a href='../S/2818.html#L287' title='Defined at 287 in Objects/stringlib/string_format.h.'>FieldNameIterator</a> rest;
<a name='L491'>
<a name='L492'>    <b>if</b> (!<a href='../S/2818.html#L403' title='Defined at 403 in Objects/stringlib/string_format.h.'>field_name_split</a>(input-&gt;ptr, input-&gt;end - input-&gt;ptr, &amp;first,
<a name='L493'>                          &amp;index, &amp;rest, auto_number)) <font color='red'>{</font>
<a name='L494'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L495'>    <font color='red'>}</font>
<a name='L496'>
<a name='L497'>    <b>if</b> (index == -1) <font color='red'>{</font>
<a name='L498'>        <i><font color='green'>/* look up in kwargs */</font></i>
<a name='L499'>        <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *<a href='../S/3145.html#L213' title='Defined at 213 in Python/thread.c.'>key</a> = SubString_new_object(&amp;first);
<a name='L500'>        <b>if</b> (<a href='../S/3145.html#L213' title='Defined at 213 in Python/thread.c.'>key</a> == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L501'>            <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L502'>
<a name='L503'>        <i><font color='green'>/* Use PyObject_GetItem instead of PyDict_GetItem because this</font></i>
<a name='L504'><i><font color='green'>           code is no longer just used with kwargs. It might be passed</font></i>
<a name='L505'><i><font color='green'>           a non-dict when called through format_map. */</font></i>
<a name='L506'>        <b>if</b> ((kwargs == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) || (obj = <a href='../S/2775.html#L113' title='Defined at 113 in Objects/abstract.c.'>PyObject_GetItem</a>(kwargs, <a href='../S/3145.html#L213' title='Defined at 213 in Python/thread.c.'>key</a>)) == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L507'>            <a href='../S/3106.html#L53' title='Defined at 53 in Python/errors.c.'>PyErr_SetObject</a>(PyExc_KeyError, <a href='../S/3145.html#L213' title='Defined at 213 in Python/thread.c.'>key</a>);
<a name='L508'>            Py_DECREF(<a href='../S/3145.html#L213' title='Defined at 213 in Python/thread.c.'>key</a>);
<a name='L509'>            <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L510'>        <font color='red'>}</font>
<a name='L511'>        Py_DECREF(<a href='../S/3145.html#L213' title='Defined at 213 in Python/thread.c.'>key</a>);
<a name='L512'>    <font color='red'>}</font>
<a name='L513'>    <b>else</b> <font color='red'>{</font>
<a name='L514'>        <i><font color='green'>/* look up in args */</font></i>
<a name='L515'>        obj = <a href='../S/2775.html#L1584' title='Defined at 1584 in Objects/abstract.c.'>PySequence_GetItem</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, index);
<a name='L516'>        <b>if</b> (obj == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L517'>            <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L518'>    <font color='red'>}</font>
<a name='L519'>
<a name='L520'>    <i><font color='green'>/* iterate over the rest of the field_name */</font></i>
<a name='L521'>    <b>while</b> ((ok = <a href='../S/2818.html#L357' title='Defined at 357 in Objects/stringlib/string_format.h.'>FieldNameIterator_next</a>(&amp;rest, &amp;is_attribute, &amp;index,
<a name='L522'>                                        &amp;name)) == 2) <font color='red'>{</font>
<a name='L523'>        <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *tmp;
<a name='L524'>
<a name='L525'>        <b>if</b> (is_attribute)
<a name='L526'>            <i><font color='green'>/* getattr lookup "." */</font></i>
<a name='L527'>            tmp = <a href='../S/2818.html#L235' title='Defined at 235 in Objects/stringlib/string_format.h.'>getattr</a>(obj, &amp;name);
<a name='L528'>        <b>else</b>
<a name='L529'>            <i><font color='green'>/* getitem lookup "[]" */</font></i>
<a name='L530'>            <b>if</b> (index == -1)
<a name='L531'>                tmp = <a href='../S/2818.html#L268' title='Defined at 268 in Objects/stringlib/string_format.h.'>getitem_str</a>(obj, &amp;name);
<a name='L532'>            <b>else</b>
<a name='L533'>                <b>if</b> (<a href='../S/2775.html#L1443' title='Defined at 1443 in Objects/abstract.c.'>PySequence_Check</a>(obj))
<a name='L534'>                    tmp = <a href='../S/2818.html#L248' title='Defined at 248 in Objects/stringlib/string_format.h.'>getitem_sequence</a>(obj, index);
<a name='L535'>                <b>else</b>
<a name='L536'>                    <i><font color='green'>/* not a sequence */</font></i>
<a name='L537'>                    tmp = <a href='../S/2818.html#L255' title='Defined at 255 in Objects/stringlib/string_format.h.'>getitem_idx</a>(obj, index);
<a name='L538'>        <b>if</b> (tmp == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L539'>            <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L540'>
<a name='L541'>        <i><font color='green'>/* assign to obj */</font></i>
<a name='L542'>        Py_DECREF(obj);
<a name='L543'>        obj = tmp;
<a name='L544'>    <font color='red'>}</font>
<a name='L545'>    <i><font color='green'>/* end of iterator, this is the non-error case */</font></i>
<a name='L546'>    <b>if</b> (ok == 1)
<a name='L547'>        <b>return</b> obj;
<a name='L548'><a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>:
<a name='L549'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(obj);
<a name='L550'>    <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L551'><font color='red'>}</font>
<a name='L552'>
<a name='L553'><i><font color='green'>/************************************************************************/</font></i>
<a name='L554'><i><font color='green'>/*****************  Field rendering functions  **************************/</font></i>
<a name='L555'><i><font color='green'>/************************************************************************/</font></i>
<a name='L556'>
<a name='L557'><i><font color='green'>/*</font></i>
<a name='L558'><i><font color='green'>    render_field() is the main function in this section.  It takes the</font></i>
<a name='L559'><i><font color='green'>    field object and field specification string generated by</font></i>
<a name='L560'><i><font color='green'>    get_field_and_spec, and renders the field into the output string.</font></i>
<a name='L561'><i><font color='green'></font></i>
<a name='L562'><i><font color='green'>    render_field calls fieldobj.__format__(format_spec) method, and</font></i>
<a name='L563'><i><font color='green'>    appends to the output.</font></i>
<a name='L564'><i><font color='green'>*/</font></i>
<a name='L565'><b>static</b> <b>int</b>
<a name='L566'><a href='../S/2818.html#L927' title='Refered from 927 in Objects/stringlib/string_format.h.'>render_field</a>(PyObject *fieldobj, SubString *format_spec, OutputString *output)
<a name='L567'><font color='red'>{</font>
<a name='L568'>    <b>int</b> ok = 0;
<a name='L569'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L570'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *format_spec_object = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L571'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *(*formatter)(<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *, <a href='../D/4980.html' title='Multiple defined in 3 places.'>STRINGLIB_CHAR</a> *, <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a>) = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L572'>    <a href='../D/4980.html' title='Multiple defined in 3 places.'>STRINGLIB_CHAR</a>* format_spec_start = format_spec-&gt;ptr ?
<a name='L573'>            format_spec-&gt;ptr : <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L574'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> format_spec_len = format_spec-&gt;ptr ?
<a name='L575'>            format_spec-&gt;end - format_spec-&gt;ptr : 0;
<a name='L576'>
<a name='L577'>    <i><font color='green'>/* If we know the type exactly, skip the lookup of __format__ and just</font></i>
<a name='L578'><i><font color='green'>       call the formatter directly. */</font></i>
<a name='L579'>    <b>if</b> (PyUnicode_CheckExact(fieldobj))
<a name='L580'>        formatter = _PyUnicode_FormatAdvanced;
<a name='L581'>    <b>else</b> <b>if</b> (PyLong_CheckExact(fieldobj))
<a name='L582'>        formatter =_PyLong_FormatAdvanced;
<a name='L583'>    <b>else</b> <b>if</b> (PyFloat_CheckExact(fieldobj))
<a name='L584'>        formatter = _PyFloat_FormatAdvanced;
<a name='L585'>
<a name='L586'>    <i><font color='green'>/* XXX: for 2.6, convert format_spec to the appropriate type</font></i>
<a name='L587'><i><font color='green'>       (unicode, str) */</font></i>
<a name='L588'>
<a name='L589'>    <b>if</b> (formatter) <font color='red'>{</font>
<a name='L590'>        <i><font color='green'>/* we know exactly which formatter will be called when __format__ is</font></i>
<a name='L591'><i><font color='green'>           looked up, so call it directly, instead. */</font></i>
<a name='L592'>        <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = formatter(fieldobj, format_spec_start, format_spec_len);
<a name='L593'>    <font color='red'>}</font>
<a name='L594'>    <b>else</b> <font color='red'>{</font>
<a name='L595'>        <i><font color='green'>/* We need to create an object out of the pointers we have, because</font></i>
<a name='L596'><i><font color='green'>           __format__ takes a string/unicode object for format_spec. */</font></i>
<a name='L597'>        format_spec_object = <a href='../D/4997.html' title='Multiple defined in 3 places.'>STRINGLIB_NEW</a>(format_spec_start,
<a name='L598'>                                           format_spec_len);
<a name='L599'>        <b>if</b> (format_spec_object == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L600'>            <b>goto</b> done;
<a name='L601'>
<a name='L602'>        <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = <a href='../S/2775.html#L694' title='Defined at 694 in Objects/abstract.c.'>PyObject_Format</a>(fieldobj, format_spec_object);
<a name='L603'>    <font color='red'>}</font>
<a name='L604'>    <b>if</b> (<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L605'>        <b>goto</b> done;
<a name='L606'>
<a name='L607'><font color='darkred'>#if</font> <a href='../S/549.html#L34' title='Defined at 34 in Include/patchlevel.h.'>PY_VERSION_HEX</a> &gt;= 0x03000000
<a name='L608'>    <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(PyUnicode_Check(<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>));
<a name='L609'><font color='darkred'>#else</font>
<a name='L610'>    <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(PyBytes_Check(<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>) || PyUnicode_Check(<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>));
<a name='L611'>
<a name='L612'>    <i><font color='green'>/* Convert result to our type.  We could be str, and result could</font></i>
<a name='L613'><i><font color='green'>       be unicode */</font></i>
<a name='L614'>    <font color='red'>{</font>
<a name='L615'>        <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *tmp = <a href='../D/5008.html' title='Multiple defined in 3 places.'>STRINGLIB_TOSTR</a>(<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>);
<a name='L616'>        <b>if</b> (tmp == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L617'>            <b>goto</b> done;
<a name='L618'>        Py_DECREF(<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>);
<a name='L619'>        <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = tmp;
<a name='L620'>    <font color='red'>}</font>
<a name='L621'><font color='darkred'>#endif</font>
<a name='L622'>
<a name='L623'>    ok = <a href='../S/2818.html#L182' title='Defined at 182 in Objects/stringlib/string_format.h.'>output_data</a>(output,
<a name='L624'>                     <a href='../D/5003.html' title='Multiple defined in 3 places.'>STRINGLIB_STR</a>(<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>), <a href='../D/4994.html' title='Multiple defined in 3 places.'>STRINGLIB_LEN</a>(<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>));
<a name='L625'>done:
<a name='L626'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(format_spec_object);
<a name='L627'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>);
<a name='L628'>    <b>return</b> ok;
<a name='L629'><font color='red'>}</font>
<a name='L630'>
<a name='L631'><b>static</b> <b>int</b>
<a name='L632'><a href='../S/2818.html#L822' title='Refered from 822 in Objects/stringlib/string_format.h.'>parse_field</a>(SubString *str, SubString *field_name, SubString *format_spec,
<a name='L633'>            <a href='../D/4980.html' title='Multiple defined in 3 places.'>STRINGLIB_CHAR</a> *conversion)
<a name='L634'><font color='red'>{</font>
<a name='L635'>    <i><font color='green'>/* Note this function works if the field name is zero length,</font></i>
<a name='L636'><i><font color='green'>       which is good.  Zero length field names are handled later, in</font></i>
<a name='L637'><i><font color='green'>       field_name_split. */</font></i>
<a name='L638'>
<a name='L639'>    <a href='../D/4980.html' title='Multiple defined in 3 places.'>STRINGLIB_CHAR</a> c = 0;
<a name='L640'>
<a name='L641'>    <i><font color='green'>/* initialize these, as they may be empty */</font></i>
<a name='L642'>    *conversion = '\0';
<a name='L643'>    SubString_init(format_spec, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, 0);
<a name='L644'>
<a name='L645'>    <i><font color='green'>/* Search for the field name.  it's terminated by the end of</font></i>
<a name='L646'><i><font color='green'>       the string, or a ':' or '!' */</font></i>
<a name='L647'>    field_name-&gt;ptr = str-&gt;ptr;
<a name='L648'>    <b>while</b> (str-&gt;ptr &lt; str-&gt;end) <font color='red'>{</font>
<a name='L649'>        <b>switch</b> (c = *(str-&gt;ptr++)) <font color='red'>{</font>
<a name='L650'>        <b>case</b> ':':
<a name='L651'>        <b>case</b> '!':
<a name='L652'>            <b>break</b>;
<a name='L653'>        <b>default</b>:
<a name='L654'>            <b>continue</b>;
<a name='L655'>        <font color='red'>}</font>
<a name='L656'>        <b>break</b>;
<a name='L657'>    <font color='red'>}</font>
<a name='L658'>
<a name='L659'>    <b>if</b> (c == '!' || c == ':') <font color='red'>{</font>
<a name='L660'>        <i><font color='green'>/* we have a format specifier and/or a conversion */</font></i>
<a name='L661'>        <i><font color='green'>/* don't include the last character */</font></i>
<a name='L662'>        field_name-&gt;end = str-&gt;ptr-1;
<a name='L663'>
<a name='L664'>        <i><font color='green'>/* the format specifier is the rest of the string */</font></i>
<a name='L665'>        format_spec-&gt;ptr = str-&gt;ptr;
<a name='L666'>        format_spec-&gt;end = str-&gt;end;
<a name='L667'>
<a name='L668'>        <i><font color='green'>/* see if there's a conversion specifier */</font></i>
<a name='L669'>        <b>if</b> (c == '!') <font color='red'>{</font>
<a name='L670'>            <i><font color='green'>/* there must be another character present */</font></i>
<a name='L671'>            <b>if</b> (format_spec-&gt;ptr &gt;= format_spec-&gt;end) <font color='red'>{</font>
<a name='L672'>                <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError,
<a name='L673'>                                "end of format while looking for conversion "
<a name='L674'>                                "specifier");
<a name='L675'>                <b>return</b> 0;
<a name='L676'>            <font color='red'>}</font>
<a name='L677'>            *conversion = *(format_spec-&gt;ptr++);
<a name='L678'>
<a name='L679'>            <i><font color='green'>/* if there is another character, it must be a colon */</font></i>
<a name='L680'>            <b>if</b> (format_spec-&gt;ptr &lt; format_spec-&gt;end) <font color='red'>{</font>
<a name='L681'>                c = *(format_spec-&gt;ptr++);
<a name='L682'>                <b>if</b> (c != ':') <font color='red'>{</font>
<a name='L683'>                    <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError,
<a name='L684'>                                    "expected ':' after format specifier");
<a name='L685'>                    <b>return</b> 0;
<a name='L686'>                <font color='red'>}</font>
<a name='L687'>            <font color='red'>}</font>
<a name='L688'>        <font color='red'>}</font>
<a name='L689'>    <font color='red'>}</font>
<a name='L690'>    <b>else</b>
<a name='L691'>        <i><font color='green'>/* end of string, there's no format_spec or conversion */</font></i>
<a name='L692'>        field_name-&gt;end = str-&gt;ptr;
<a name='L693'>
<a name='L694'>    <b>return</b> 1;
<a name='L695'><font color='red'>}</font>
<a name='L696'>
<a name='L697'><i><font color='green'>/************************************************************************/</font></i>
<a name='L698'><i><font color='green'>/******* Output string allocation and escape-to-markup processing  ******/</font></i>
<a name='L699'><i><font color='green'>/************************************************************************/</font></i>
<a name='L700'>
<a name='L701'><i><font color='green'>/* MarkupIterator breaks the string into pieces of either literal</font></i>
<a name='L702'><i><font color='green'>   text, or things inside {} that need to be marked up.  it is</font></i>
<a name='L703'><i><font color='green'>   designed to make it easy to wrap a Python iterator around it, for</font></i>
<a name='L704'><i><font color='green'>   use with the Formatter class */</font></i>
<a name='L705'>
<a name='L706'><b>typedef</b> <b>struct</b> <font color='red'>{</font>
<a name='L707'>    <a href='../S/2818.html#L31' title='Defined at 31 in Objects/stringlib/string_format.h.'>SubString</a> str;
<a name='L708'><font color='red'>}</font> <a href='../R/2009.html' title='Multiple refered from 2 places.'>MarkupIterator</a>;
<a name='L709'>
<a name='L710'><b>static</b> <b>int</b>
<a name='L711'><a href='../R/2010.html' title='Multiple refered from 2 places.'>MarkupIterator_init</a>(MarkupIterator *self, <a href='../D/4980.html' title='Multiple defined in 3 places.'>STRINGLIB_CHAR</a> *ptr, <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> len)
<a name='L712'><font color='red'>{</font>
<a name='L713'>    SubString_init(&amp;self-&gt;str, ptr, len);
<a name='L714'>    <b>return</b> 1;
<a name='L715'><font color='red'>}</font>
<a name='L716'>
<a name='L717'><i><font color='green'>/* returns 0 on error, 1 on non-error termination, and 2 if it got a</font></i>
<a name='L718'><i><font color='green'>   string (or something to be expanded) */</font></i>
<a name='L719'><b>static</b> <b>int</b>
<a name='L720'><a href='../R/2011.html' title='Multiple refered from 2 places.'>MarkupIterator_next</a>(MarkupIterator *self, SubString *literal,
<a name='L721'>                    <b>int</b> *field_present, SubString *field_name,
<a name='L722'>                    SubString *format_spec, <a href='../D/4980.html' title='Multiple defined in 3 places.'>STRINGLIB_CHAR</a> *conversion,
<a name='L723'>                    <b>int</b> *format_spec_needs_expanding)
<a name='L724'><font color='red'>{</font>
<a name='L725'>    <b>int</b> at_end;
<a name='L726'>    <a href='../D/4980.html' title='Multiple defined in 3 places.'>STRINGLIB_CHAR</a> c = 0;
<a name='L727'>    <a href='../D/4980.html' title='Multiple defined in 3 places.'>STRINGLIB_CHAR</a> *start;
<a name='L728'>    <b>int</b> count;
<a name='L729'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> len;
<a name='L730'>    <b>int</b> markup_follows = 0;
<a name='L731'>
<a name='L732'>    <i><font color='green'>/* initialize all of the output variables */</font></i>
<a name='L733'>    SubString_init(literal, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, 0);
<a name='L734'>    SubString_init(field_name, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, 0);
<a name='L735'>    SubString_init(format_spec, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, 0);
<a name='L736'>    *conversion = '\0';
<a name='L737'>    *format_spec_needs_expanding = 0;
<a name='L738'>    *field_present = 0;
<a name='L739'>
<a name='L740'>    <i><font color='green'>/* No more input, end of iterator.  This is the normal exit</font></i>
<a name='L741'><i><font color='green'>       path. */</font></i>
<a name='L742'>    <b>if</b> (self-&gt;str.ptr &gt;= self-&gt;str.end)
<a name='L743'>        <b>return</b> 1;
<a name='L744'>
<a name='L745'>    start = self-&gt;str.ptr;
<a name='L746'>
<a name='L747'>    <i><font color='green'>/* First read any literal text. Read until the end of string, an</font></i>
<a name='L748'><i><font color='green'>       escaped '{' or '}', or an unescaped '{'.  In order to never</font></i>
<a name='L749'><i><font color='green'>       allocate memory and so I can just pass pointers around, if</font></i>
<a name='L750'><i><font color='green'>       there's an escaped '{' or '}' then we'll return the literal</font></i>
<a name='L751'><i><font color='green'>       including the brace, but no format object.  The next time</font></i>
<a name='L752'><i><font color='green'>       through, we'll return the rest of the literal, skipping past</font></i>
<a name='L753'><i><font color='green'>       the second consecutive brace. */</font></i>
<a name='L754'>    <b>while</b> (self-&gt;str.ptr &lt; self-&gt;str.end) <font color='red'>{</font>
<a name='L755'>        <b>switch</b> (c = *(self-&gt;str.ptr++)) <font color='red'>{</font>
<a name='L756'>        <b>case</b> '{':
<a name='L757'>        <b>case</b> '}':
<a name='L758'>            markup_follows = 1;
<a name='L759'>            <b>break</b>;
<a name='L760'>        <b>default</b>:
<a name='L761'>            <b>continue</b>;
<a name='L762'>        <font color='red'>}</font>
<a name='L763'>        <b>break</b>;
<a name='L764'>    <font color='red'>}</font>
<a name='L765'>
<a name='L766'>    at_end = self-&gt;str.ptr &gt;= self-&gt;str.end;
<a name='L767'>    len = self-&gt;str.ptr - start;
<a name='L768'>
<a name='L769'>    <b>if</b> ((c == '}') &amp;&amp; (at_end || (c != *self-&gt;str.ptr))) <font color='red'>{</font>
<a name='L770'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError, "Single '}' encountered "
<a name='L771'>                        "in format string");
<a name='L772'>        <b>return</b> 0;
<a name='L773'>    <font color='red'>}</font>
<a name='L774'>    <b>if</b> (at_end &amp;&amp; c == '{') <font color='red'>{</font>
<a name='L775'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError, "Single '{' encountered "
<a name='L776'>                        "in format string");
<a name='L777'>        <b>return</b> 0;
<a name='L778'>    <font color='red'>}</font>
<a name='L779'>    <b>if</b> (!at_end) <font color='red'>{</font>
<a name='L780'>        <b>if</b> (c == *self-&gt;str.ptr) <font color='red'>{</font>
<a name='L781'>            <i><font color='green'>/* escaped } or {, skip it in the input.  there is no</font></i>
<a name='L782'><i><font color='green'>               markup object following us, just this literal text */</font></i>
<a name='L783'>            self-&gt;str.ptr++;
<a name='L784'>            markup_follows = 0;
<a name='L785'>        <font color='red'>}</font>
<a name='L786'>        <b>else</b>
<a name='L787'>            len--;
<a name='L788'>    <font color='red'>}</font>
<a name='L789'>
<a name='L790'>    <i><font color='green'>/* record the literal text */</font></i>
<a name='L791'>    literal-&gt;ptr = start;
<a name='L792'>    literal-&gt;end = start + len;
<a name='L793'>
<a name='L794'>    <b>if</b> (!markup_follows)
<a name='L795'>        <b>return</b> 2;
<a name='L796'>
<a name='L797'>    <i><font color='green'>/* this is markup, find the end of the string by counting nested</font></i>
<a name='L798'><i><font color='green'>       braces.  note that this prohibits escaped braces, so that</font></i>
<a name='L799'><i><font color='green'>       format_specs cannot have braces in them. */</font></i>
<a name='L800'>    *field_present = 1;
<a name='L801'>    count = 1;
<a name='L802'>
<a name='L803'>    start = self-&gt;str.ptr;
<a name='L804'>
<a name='L805'>    <i><font color='green'>/* we know we can't have a zero length string, so don't worry</font></i>
<a name='L806'><i><font color='green'>       about that case */</font></i>
<a name='L807'>    <b>while</b> (self-&gt;str.ptr &lt; self-&gt;str.end) <font color='red'>{</font>
<a name='L808'>        <b>switch</b> (c = *(self-&gt;str.ptr++)) <font color='red'>{</font>
<a name='L809'>        <b>case</b> '{':
<a name='L810'>            <i><font color='green'>/* the format spec needs to be recursively expanded.</font></i>
<a name='L811'><i><font color='green'>               this is an optimization, and not strictly needed */</font></i>
<a name='L812'>            *format_spec_needs_expanding = 1;
<a name='L813'>            count++;
<a name='L814'>            <b>break</b>;
<a name='L815'>        <b>case</b> '}':
<a name='L816'>            count--;
<a name='L817'>            <b>if</b> (count &lt;= 0) <font color='red'>{</font>
<a name='L818'>                <i><font color='green'>/* we're done.  parse and get out */</font></i>
<a name='L819'>                <a href='../S/2818.html#L31' title='Defined at 31 in Objects/stringlib/string_format.h.'>SubString</a> s;
<a name='L820'>
<a name='L821'>                SubString_init(&amp;s, start, self-&gt;str.ptr - 1 - start);
<a name='L822'>                <b>if</b> (<a href='../S/2818.html#L632' title='Defined at 632 in Objects/stringlib/string_format.h.'>parse_field</a>(&amp;s, field_name, format_spec, conversion) == 0)
<a name='L823'>                    <b>return</b> 0;
<a name='L824'>
<a name='L825'>                <i><font color='green'>/* success */</font></i>
<a name='L826'>                <b>return</b> 2;
<a name='L827'>            <font color='red'>}</font>
<a name='L828'>            <b>break</b>;
<a name='L829'>        <font color='red'>}</font>
<a name='L830'>    <font color='red'>}</font>
<a name='L831'>
<a name='L832'>    <i><font color='green'>/* end of string while searching for matching '}' */</font></i>
<a name='L833'>    <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError, "unmatched '{' in format");
<a name='L834'>    <b>return</b> 0;
<a name='L835'><font color='red'>}</font>
<a name='L836'>
<a name='L837'>
<a name='L838'><i><font color='green'>/* do the !r or !s conversion on obj */</font></i>
<a name='L839'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L840'><a href='../S/2818.html#L900' title='Refered from 900 in Objects/stringlib/string_format.h.'>do_conversion</a>(PyObject *obj, <a href='../D/4980.html' title='Multiple defined in 3 places.'>STRINGLIB_CHAR</a> conversion)
<a name='L841'><font color='red'>{</font>
<a name='L842'>    <i><font color='green'>/* XXX in pre-3.0, do we need to convert this to unicode, since it</font></i>
<a name='L843'><i><font color='green'>       might have returned a string? */</font></i>
<a name='L844'>    <b>switch</b> (conversion) <font color='red'>{</font>
<a name='L845'>    <b>case</b> 'r':
<a name='L846'>        <b>return</b> <a href='../S/2803.html#L368' title='Defined at 368 in Objects/object.c.'>PyObject_Repr</a>(obj);
<a name='L847'>    <b>case</b> 's':
<a name='L848'>        <b>return</b> <a href='../D/5008.html' title='Multiple defined in 3 places.'>STRINGLIB_TOSTR</a>(obj);
<a name='L849'><font color='darkred'>#if</font> <a href='../S/549.html#L34' title='Defined at 34 in Include/patchlevel.h.'>PY_VERSION_HEX</a> &gt;= 0x03000000
<a name='L850'>    <b>case</b> 'a':
<a name='L851'>        <b>return</b> <a href='../D/5005.html' title='Multiple defined in 3 places.'>STRINGLIB_TOASCII</a>(obj);
<a name='L852'><font color='darkred'>#endif</font>
<a name='L853'>    <b>default</b>:
<a name='L854'>        <b>if</b> (conversion &gt; 32 &amp;&amp; conversion &lt; 127) <font color='red'>{</font>
<a name='L855'>                <i><font color='green'>/* It's the ASCII subrange; casting to char is safe</font></i>
<a name='L856'><i><font color='green'>                   (assuming the execution character set is an ASCII</font></i>
<a name='L857'><i><font color='green'>                   superset). */</font></i>
<a name='L858'>                <a href='../S/3106.html#L600' title='Defined at 600 in Python/errors.c.'>PyErr_Format</a>(PyExc_ValueError,
<a name='L859'>                     "Unknown conversion specifier %c",
<a name='L860'>                     (<b>char</b>)conversion);
<a name='L861'>        <font color='red'>}</font> <b>else</b>
<a name='L862'>                <a href='../S/3106.html#L600' title='Defined at 600 in Python/errors.c.'>PyErr_Format</a>(PyExc_ValueError,
<a name='L863'>                     "Unknown conversion specifier \\x%x",
<a name='L864'>                     (<b>unsigned</b> <b>int</b>)conversion);
<a name='L865'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L866'>    <font color='red'>}</font>
<a name='L867'><font color='red'>}</font>
<a name='L868'>
<a name='L869'><i><font color='green'>/* given:</font></i>
<a name='L870'><i><font color='green'></font></i>
<a name='L871'><i><font color='green'>   {field_name!conversion:format_spec}</font></i>
<a name='L872'><i><font color='green'></font></i>
<a name='L873'><i><font color='green'>   compute the result and write it to output.</font></i>
<a name='L874'><i><font color='green'>   format_spec_needs_expanding is an optimization.  if it's false,</font></i>
<a name='L875'><i><font color='green'>   just output the string directly, otherwise recursively expand the</font></i>
<a name='L876'><i><font color='green'>   format_spec string.</font></i>
<a name='L877'><i><font color='green'></font></i>
<a name='L878'><i><font color='green'>   field_name is allowed to be zero length, in which case we</font></i>
<a name='L879'><i><font color='green'>   are doing auto field numbering.</font></i>
<a name='L880'><i><font color='green'>*/</font></i>
<a name='L881'>
<a name='L882'><b>static</b> <b>int</b>
<a name='L883'><a href='../S/2818.html#L966' title='Refered from 966 in Objects/stringlib/string_format.h.'>output_markup</a>(SubString *field_name, SubString *format_spec,
<a name='L884'>              <b>int</b> format_spec_needs_expanding, <a href='../D/4980.html' title='Multiple defined in 3 places.'>STRINGLIB_CHAR</a> conversion,
<a name='L885'>              OutputString *output, PyObject *args, PyObject *kwargs,
<a name='L886'>              <b>int</b> recursion_depth, AutoNumber *auto_number)
<a name='L887'><font color='red'>{</font>
<a name='L888'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *tmp = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L889'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *fieldobj = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L890'>    <a href='../S/2818.html#L31' title='Defined at 31 in Objects/stringlib/string_format.h.'>SubString</a> expanded_format_spec;
<a name='L891'>    <a href='../S/2818.html#L31' title='Defined at 31 in Objects/stringlib/string_format.h.'>SubString</a> *actual_format_spec;
<a name='L892'>    <b>int</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = 0;
<a name='L893'>
<a name='L894'>    <i><font color='green'>/* convert field_name to an object */</font></i>
<a name='L895'>    fieldobj = <a href='../S/2818.html#L481' title='Defined at 481 in Objects/stringlib/string_format.h.'>get_field_object</a>(field_name, <a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, kwargs, auto_number);
<a name='L896'>    <b>if</b> (fieldobj == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L897'>        <b>goto</b> done;
<a name='L898'>
<a name='L899'>    <b>if</b> (conversion != '\0') <font color='red'>{</font>
<a name='L900'>        tmp = <a href='../S/2818.html#L840' title='Defined at 840 in Objects/stringlib/string_format.h.'>do_conversion</a>(fieldobj, conversion);
<a name='L901'>        <b>if</b> (tmp == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L902'>            <b>goto</b> done;
<a name='L903'>
<a name='L904'>        <i><font color='green'>/* do the assignment, transferring ownership: fieldobj = tmp */</font></i>
<a name='L905'>        Py_DECREF(fieldobj);
<a name='L906'>        fieldobj = tmp;
<a name='L907'>        tmp = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L908'>    <font color='red'>}</font>
<a name='L909'>
<a name='L910'>    <i><font color='green'>/* if needed, recurively compute the format_spec */</font></i>
<a name='L911'>    <b>if</b> (format_spec_needs_expanding) <font color='red'>{</font>
<a name='L912'>        tmp = <a href='../S/2818.html#L980' title='Defined at 980 in Objects/stringlib/string_format.h.'>build_string</a>(format_spec, <a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, kwargs, recursion_depth-1,
<a name='L913'>                           auto_number);
<a name='L914'>        <b>if</b> (tmp == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L915'>            <b>goto</b> done;
<a name='L916'>
<a name='L917'>        <i><font color='green'>/* note that in the case we're expanding the format string,</font></i>
<a name='L918'><i><font color='green'>           tmp must be kept around until after the call to</font></i>
<a name='L919'><i><font color='green'>           render_field. */</font></i>
<a name='L920'>        SubString_init(&amp;expanded_format_spec,
<a name='L921'>                       <a href='../D/5003.html' title='Multiple defined in 3 places.'>STRINGLIB_STR</a>(tmp), <a href='../D/4994.html' title='Multiple defined in 3 places.'>STRINGLIB_LEN</a>(tmp));
<a name='L922'>        actual_format_spec = &amp;expanded_format_spec;
<a name='L923'>    <font color='red'>}</font>
<a name='L924'>    <b>else</b>
<a name='L925'>        actual_format_spec = format_spec;
<a name='L926'>
<a name='L927'>    <b>if</b> (<a href='../S/2818.html#L566' title='Defined at 566 in Objects/stringlib/string_format.h.'>render_field</a>(fieldobj, actual_format_spec, output) == 0)
<a name='L928'>        <b>goto</b> done;
<a name='L929'>
<a name='L930'>    <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = 1;
<a name='L931'>
<a name='L932'>done:
<a name='L933'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(fieldobj);
<a name='L934'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(tmp);
<a name='L935'>
<a name='L936'>    <b>return</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L937'><font color='red'>}</font>
<a name='L938'>
<a name='L939'><i><font color='green'>/*</font></i>
<a name='L940'><i><font color='green'>    do_markup is the top-level loop for the format() method.  It</font></i>
<a name='L941'><i><font color='green'>    searches through the format string for escapes to markup codes, and</font></i>
<a name='L942'><i><font color='green'>    calls other functions to move non-markup text to the output,</font></i>
<a name='L943'><i><font color='green'>    and to perform the markup to the output.</font></i>
<a name='L944'><i><font color='green'>*/</font></i>
<a name='L945'><b>static</b> <b>int</b>
<a name='L946'><a href='../S/2818.html#L1003' title='Refered from 1003 in Objects/stringlib/string_format.h.'>do_markup</a>(SubString *input, PyObject *args, PyObject *kwargs,
<a name='L947'>          OutputString *output, <b>int</b> recursion_depth, AutoNumber *auto_number)
<a name='L948'><font color='red'>{</font>
<a name='L949'>    <a href='../S/2818.html#L708' title='Defined at 708 in Objects/stringlib/string_format.h.'>MarkupIterator</a> iter;
<a name='L950'>    <b>int</b> format_spec_needs_expanding;
<a name='L951'>    <b>int</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L952'>    <b>int</b> field_present;
<a name='L953'>    <a href='../S/2818.html#L31' title='Defined at 31 in Objects/stringlib/string_format.h.'>SubString</a> literal;
<a name='L954'>    <a href='../S/2818.html#L31' title='Defined at 31 in Objects/stringlib/string_format.h.'>SubString</a> field_name;
<a name='L955'>    <a href='../S/2818.html#L31' title='Defined at 31 in Objects/stringlib/string_format.h.'>SubString</a> format_spec;
<a name='L956'>    <a href='../D/4980.html' title='Multiple defined in 3 places.'>STRINGLIB_CHAR</a> conversion;
<a name='L957'>
<a name='L958'>    <a href='../S/2818.html#L711' title='Defined at 711 in Objects/stringlib/string_format.h.'>MarkupIterator_init</a>(&amp;iter, input-&gt;ptr, input-&gt;end - input-&gt;ptr);
<a name='L959'>    <b>while</b> ((<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = <a href='../S/2818.html#L720' title='Defined at 720 in Objects/stringlib/string_format.h.'>MarkupIterator_next</a>(&amp;iter, &amp;literal, &amp;field_present,
<a name='L960'>                                         &amp;field_name, &amp;format_spec,
<a name='L961'>                                         &amp;conversion,
<a name='L962'>                                         &amp;format_spec_needs_expanding)) == 2) <font color='red'>{</font>
<a name='L963'>        <b>if</b> (!<a href='../S/2818.html#L182' title='Defined at 182 in Objects/stringlib/string_format.h.'>output_data</a>(output, literal.ptr, literal.end - literal.ptr))
<a name='L964'>            <b>return</b> 0;
<a name='L965'>        <b>if</b> (field_present)
<a name='L966'>            <b>if</b> (!<a href='../S/2818.html#L883' title='Defined at 883 in Objects/stringlib/string_format.h.'>output_markup</a>(&amp;field_name, &amp;format_spec,
<a name='L967'>                               format_spec_needs_expanding, conversion, output,
<a name='L968'>                               <a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, kwargs, recursion_depth, auto_number))
<a name='L969'>                <b>return</b> 0;
<a name='L970'>    <font color='red'>}</font>
<a name='L971'>    <b>return</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L972'><font color='red'>}</font>
<a name='L973'>
<a name='L974'>
<a name='L975'><i><font color='green'>/*</font></i>
<a name='L976'><i><font color='green'>    build_string allocates the output string and then</font></i>
<a name='L977'><i><font color='green'>    calls do_markup to do the heavy lifting.</font></i>
<a name='L978'><i><font color='green'>*/</font></i>
<a name='L979'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L980'><a href='../R/6347.html' title='Multiple refered from 3 places.'>build_string</a>(SubString *input, PyObject *args, PyObject *kwargs,
<a name='L981'>             <b>int</b> recursion_depth, AutoNumber *auto_number)
<a name='L982'><font color='red'>{</font>
<a name='L983'>    <a href='../S/2818.html#L132' title='Defined at 132 in Objects/stringlib/string_format.h.'>OutputString</a> output;
<a name='L984'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L985'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> count;
<a name='L986'>
<a name='L987'>    output.obj = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>; <i><font color='green'>/* needed so cleanup code always works */</font></i>
<a name='L988'>
<a name='L989'>    <i><font color='green'>/* check the recursion level */</font></i>
<a name='L990'>    <b>if</b> (recursion_depth &lt;= 0) <font color='red'>{</font>
<a name='L991'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError,
<a name='L992'>                        "Max string recursion exceeded");
<a name='L993'>        <b>goto</b> done;
<a name='L994'>    <font color='red'>}</font>
<a name='L995'>
<a name='L996'>    <i><font color='green'>/* initial size is the length of the format string, plus the size</font></i>
<a name='L997'><i><font color='green'>       increment.  seems like a reasonable default */</font></i>
<a name='L998'>    <b>if</b> (!<a href='../S/2818.html#L136' title='Defined at 136 in Objects/stringlib/string_format.h.'>output_initialize</a>(&amp;output,
<a name='L999'>                           input-&gt;end - input-&gt;ptr +
<a name='L1000'>                           <a href='../S/2818.html#L15' title='Defined at 15 in Objects/stringlib/string_format.h.'>INITIAL_SIZE_INCREMENT</a>))
<a name='L1001'>        <b>goto</b> done;
<a name='L1002'>
<a name='L1003'>    <b>if</b> (!<a href='../S/2818.html#L946' title='Defined at 946 in Objects/stringlib/string_format.h.'>do_markup</a>(input, <a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, kwargs, &amp;output, recursion_depth,
<a name='L1004'>                   auto_number)) <font color='red'>{</font>
<a name='L1005'>        <b>goto</b> done;
<a name='L1006'>    <font color='red'>}</font>
<a name='L1007'>
<a name='L1008'>    count = output.ptr - <a href='../D/5003.html' title='Multiple defined in 3 places.'>STRINGLIB_STR</a>(output.obj);
<a name='L1009'>    <b>if</b> (<a href='../D/5001.html' title='Multiple defined in 2 places.'>STRINGLIB_RESIZE</a>(&amp;output.obj, count) &lt; 0) <font color='red'>{</font>
<a name='L1010'>        <b>goto</b> done;
<a name='L1011'>    <font color='red'>}</font>
<a name='L1012'>
<a name='L1013'>    <i><font color='green'>/* transfer ownership to result */</font></i>
<a name='L1014'>    <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = output.obj;
<a name='L1015'>    output.obj = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1016'>
<a name='L1017'>done:
<a name='L1018'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(output.obj);
<a name='L1019'>    <b>return</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L1020'><font color='red'>}</font>
<a name='L1021'>
<a name='L1022'><i><font color='green'>/************************************************************************/</font></i>
<a name='L1023'><i><font color='green'>/*********** main routine ***********************************************/</font></i>
<a name='L1024'><i><font color='green'>/************************************************************************/</font></i>
<a name='L1025'>
<a name='L1026'><i><font color='green'>/* this is the main entry point */</font></i>
<a name='L1027'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1028'><a href='../R/7450.html' title='Multiple refered from 2 places.'>do_string_format</a>(PyObject *self, PyObject *args, PyObject *kwargs)
<a name='L1029'><font color='red'>{</font>
<a name='L1030'>    <a href='../S/2818.html#L31' title='Defined at 31 in Objects/stringlib/string_format.h.'>SubString</a> input;
<a name='L1031'>
<a name='L1032'>    <i><font color='green'>/* PEP 3101 says only 2 levels, so that</font></i>
<a name='L1033'><i><font color='green'>       "{0:{1}}".format('abc', 's')            # works</font></i>
<a name='L1034'><i><font color='green'>       "{0:{1:{2}}}".format('abc', 's', '')    # fails</font></i>
<a name='L1035'><i><font color='green'>    */</font></i>
<a name='L1036'>    <b>int</b> recursion_depth = 2;
<a name='L1037'>
<a name='L1038'>    <a href='../S/2818.html#L44' title='Defined at 44 in Objects/stringlib/string_format.h.'>AutoNumber</a> auto_number;
<a name='L1039'>
<a name='L1040'>    <a href='../S/2818.html#L59' title='Defined at 59 in Objects/stringlib/string_format.h.'>AutoNumber_Init</a>(&amp;auto_number);
<a name='L1041'>    SubString_init(&amp;input, <a href='../D/5003.html' title='Multiple defined in 3 places.'>STRINGLIB_STR</a>(self), <a href='../D/4994.html' title='Multiple defined in 3 places.'>STRINGLIB_LEN</a>(self));
<a name='L1042'>    <b>return</b> <a href='../S/2818.html#L980' title='Defined at 980 in Objects/stringlib/string_format.h.'>build_string</a>(&amp;input, <a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, kwargs, recursion_depth, &amp;auto_number);
<a name='L1043'><font color='red'>}</font>
<a name='L1044'>
<a name='L1045'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1046'><a href='../S/2828.html#L9148' title='Refered from 9148 in Objects/unicodeobject.c.'>do_string_format_map</a>(PyObject *self, PyObject *obj)
<a name='L1047'><font color='red'>{</font>
<a name='L1048'>    <b>return</b> <a href='../S/2818.html#L1028' title='Defined at 1028 in Objects/stringlib/string_format.h.'>do_string_format</a>(self, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, obj);
<a name='L1049'><font color='red'>}</font>
<a name='L1050'>
<a name='L1051'>
<a name='L1052'><i><font color='green'>/************************************************************************/</font></i>
<a name='L1053'><i><font color='green'>/*********** formatteriterator ******************************************/</font></i>
<a name='L1054'><i><font color='green'>/************************************************************************/</font></i>
<a name='L1055'>
<a name='L1056'><i><font color='green'>/* This is used to implement string.Formatter.vparse().  It exists so</font></i>
<a name='L1057'><i><font color='green'>   Formatter can share code with the built in unicode.format() method.</font></i>
<a name='L1058'><i><font color='green'>   It's really just a wrapper around MarkupIterator that is callable</font></i>
<a name='L1059'><i><font color='green'>   from Python. */</font></i>
<a name='L1060'>
<a name='L1061'><b>typedef</b> <b>struct</b> <font color='red'>{</font>
<a name='L1062'>    <a href='../S/544.html#L82' title='Defined at 82 in Include/object.h.'>PyObject_HEAD</a>
<a name='L1063'>
<a name='L1064'>    <a href='../D/4998.html' title='Multiple defined in 2 places.'>STRINGLIB_OBJECT</a> *str;
<a name='L1065'>
<a name='L1066'>    <a href='../S/2818.html#L708' title='Defined at 708 in Objects/stringlib/string_format.h.'>MarkupIterator</a> it_markup;
<a name='L1067'><font color='red'>}</font> <a href='../R/7905.html' title='Multiple refered from 3 places.'>formatteriterobject</a>;
<a name='L1068'>
<a name='L1069'><b>static</b> <b>void</b>
<a name='L1070'><a href='../S/2818.html#L1159' title='Refered from 1159 in Objects/stringlib/string_format.h.'>formatteriter_dealloc</a>(formatteriterobject *it)
<a name='L1071'><font color='red'>{</font>
<a name='L1072'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(it-&gt;str);
<a name='L1073'>    PyObject_FREE(it);
<a name='L1074'><font color='red'>}</font>
<a name='L1075'>
<a name='L1076'><i><font color='green'>/* returns a tuple:</font></i>
<a name='L1077'><i><font color='green'>   (literal, field_name, format_spec, conversion)</font></i>
<a name='L1078'><i><font color='green'></font></i>
<a name='L1079'><i><font color='green'>   literal is any literal text to output.  might be zero length</font></i>
<a name='L1080'><i><font color='green'>   field_name is the string before the ':'.  might be None</font></i>
<a name='L1081'><i><font color='green'>   format_spec is the string after the ':'.  mibht be None</font></i>
<a name='L1082'><i><font color='green'>   conversion is either None, or the string after the '!'</font></i>
<a name='L1083'><i><font color='green'>*/</font></i>
<a name='L1084'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1085'><a href='../S/2818.html#L1181' title='Refered from 1181 in Objects/stringlib/string_format.h.'>formatteriter_next</a>(formatteriterobject *it)
<a name='L1086'><font color='red'>{</font>
<a name='L1087'>    <a href='../S/2818.html#L31' title='Defined at 31 in Objects/stringlib/string_format.h.'>SubString</a> literal;
<a name='L1088'>    <a href='../S/2818.html#L31' title='Defined at 31 in Objects/stringlib/string_format.h.'>SubString</a> field_name;
<a name='L1089'>    <a href='../S/2818.html#L31' title='Defined at 31 in Objects/stringlib/string_format.h.'>SubString</a> format_spec;
<a name='L1090'>    <a href='../D/4980.html' title='Multiple defined in 3 places.'>STRINGLIB_CHAR</a> conversion;
<a name='L1091'>    <b>int</b> format_spec_needs_expanding;
<a name='L1092'>    <b>int</b> field_present;
<a name='L1093'>    <b>int</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = <a href='../S/2818.html#L720' title='Defined at 720 in Objects/stringlib/string_format.h.'>MarkupIterator_next</a>(&amp;it-&gt;it_markup, &amp;literal, &amp;field_present,
<a name='L1094'>                                     &amp;field_name, &amp;format_spec, &amp;conversion,
<a name='L1095'>                                     &amp;format_spec_needs_expanding);
<a name='L1096'>
<a name='L1097'>    <i><font color='green'>/* all of the SubString objects point into it-&gt;str, so no</font></i>
<a name='L1098'><i><font color='green'>       memory management needs to be done on them */</font></i>
<a name='L1099'>    <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(0 &lt;= <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> &amp;&amp; <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> &lt;= 2);
<a name='L1100'>    <b>if</b> (<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> == 0 || <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> == 1)
<a name='L1101'>        <i><font color='green'>/* if 0, error has already been set, if 1, iterator is empty */</font></i>
<a name='L1102'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1103'>    <b>else</b> <font color='red'>{</font>
<a name='L1104'>        <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *literal_str = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1105'>        <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *field_name_str = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1106'>        <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *format_spec_str = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1107'>        <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *conversion_str = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1108'>        <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *tuple = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1109'>
<a name='L1110'>        literal_str = SubString_new_object(&amp;literal);
<a name='L1111'>        <b>if</b> (literal_str == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1112'>            <b>goto</b> done;
<a name='L1113'>
<a name='L1114'>        field_name_str = SubString_new_object(&amp;field_name);
<a name='L1115'>        <b>if</b> (field_name_str == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1116'>            <b>goto</b> done;
<a name='L1117'>
<a name='L1118'>        <i><font color='green'>/* if field_name is non-zero length, return a string for</font></i>
<a name='L1119'><i><font color='green'>           format_spec (even if zero length), else return None */</font></i>
<a name='L1120'>        format_spec_str = (field_present ?
<a name='L1121'>                           SubString_new_object_or_empty :
<a name='L1122'>                           SubString_new_object)(&amp;format_spec);
<a name='L1123'>        <b>if</b> (format_spec_str == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1124'>            <b>goto</b> done;
<a name='L1125'>
<a name='L1126'>        <i><font color='green'>/* if the conversion is not specified, return a None,</font></i>
<a name='L1127'><i><font color='green'>           otherwise create a one length string with the conversion</font></i>
<a name='L1128'><i><font color='green'>           character */</font></i>
<a name='L1129'>        <b>if</b> (conversion == '\0') <font color='red'>{</font>
<a name='L1130'>            conversion_str = Py_None;
<a name='L1131'>            Py_INCREF(conversion_str);
<a name='L1132'>        <font color='red'>}</font>
<a name='L1133'>        <b>else</b>
<a name='L1134'>            conversion_str = <a href='../D/4997.html' title='Multiple defined in 3 places.'>STRINGLIB_NEW</a>(&amp;conversion, 1);
<a name='L1135'>        <b>if</b> (conversion_str == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1136'>            <b>goto</b> done;
<a name='L1137'>
<a name='L1138'>        tuple = <a href='../S/2823.html#L186' title='Defined at 186 in Objects/tupleobject.c.'>PyTuple_Pack</a>(4, literal_str, field_name_str, format_spec_str,
<a name='L1139'>                             conversion_str);
<a name='L1140'>    done:
<a name='L1141'>        <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(literal_str);
<a name='L1142'>        <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(field_name_str);
<a name='L1143'>        <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(format_spec_str);
<a name='L1144'>        <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(conversion_str);
<a name='L1145'>        <b>return</b> tuple;
<a name='L1146'>    <font color='red'>}</font>
<a name='L1147'><font color='red'>}</font>
<a name='L1148'>
<a name='L1149'><b>static</b> <a href='../D/3525.html' title='Multiple defined in 3 places.'>PyMethodDef</a> formatteriter_methods[] = <font color='red'>{</font>
<a name='L1150'>    <font color='red'>{</font><a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,              <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>           <i><font color='green'>/* sentinel */</font></i>
<a name='L1151'><font color='red'>}</font>;
<a name='L1152'>
<a name='L1153'><b>static</b> <a href='../D/3899.html' title='Multiple defined in 3 places.'>PyTypeObject</a> PyFormatterIter_Type = <font color='red'>{</font>
<a name='L1154'>    <a href='../D/4042.html' title='Multiple defined in 3 places.'>PyVarObject_HEAD_INIT</a>(&amp;PyType_Type, 0)
<a name='L1155'>    "formatteriterator",                <i><font color='green'>/* tp_name */</font></i>
<a name='L1156'>    <b>sizeof</b>(<a href='../S/2818.html#L1067' title='Defined at 1067 in Objects/stringlib/string_format.h.'>formatteriterobject</a>),        <i><font color='green'>/* tp_basicsize */</font></i>
<a name='L1157'>    0,                                  <i><font color='green'>/* tp_itemsize */</font></i>
<a name='L1158'>    <i><font color='green'>/* methods */</font></i>
<a name='L1159'>    (<a href='../D/8095.html' title='Multiple defined in 2 places.'>destructor</a>)<a href='../S/2818.html#L1070' title='Defined at 1070 in Objects/stringlib/string_format.h.'>formatteriter_dealloc</a>,  <i><font color='green'>/* tp_dealloc */</font></i>
<a name='L1160'>    0,                                  <i><font color='green'>/* tp_print */</font></i>
<a name='L1161'>    0,                                  <i><font color='green'>/* tp_getattr */</font></i>
<a name='L1162'>    0,                                  <i><font color='green'>/* tp_setattr */</font></i>
<a name='L1163'>    0,                                  <i><font color='green'>/* tp_reserved */</font></i>
<a name='L1164'>    0,                                  <i><font color='green'>/* tp_repr */</font></i>
<a name='L1165'>    0,                                  <i><font color='green'>/* tp_as_number */</font></i>
<a name='L1166'>    0,                                  <i><font color='green'>/* tp_as_sequence */</font></i>
<a name='L1167'>    0,                                  <i><font color='green'>/* tp_as_mapping */</font></i>
<a name='L1168'>    0,                                  <i><font color='green'>/* tp_hash */</font></i>
<a name='L1169'>    0,                                  <i><font color='green'>/* tp_call */</font></i>
<a name='L1170'>    0,                                  <i><font color='green'>/* tp_str */</font></i>
<a name='L1171'>    <a href='../S/2803.html#L1046' title='Defined at 1046 in Objects/object.c.'>PyObject_GenericGetAttr</a>,            <i><font color='green'>/* tp_getattro */</font></i>
<a name='L1172'>    0,                                  <i><font color='green'>/* tp_setattro */</font></i>
<a name='L1173'>    0,                                  <i><font color='green'>/* tp_as_buffer */</font></i>
<a name='L1174'>    Py_TPFLAGS_DEFAULT,                 <i><font color='green'>/* tp_flags */</font></i>
<a name='L1175'>    0,                                  <i><font color='green'>/* tp_doc */</font></i>
<a name='L1176'>    0,                                  <i><font color='green'>/* tp_traverse */</font></i>
<a name='L1177'>    0,                                  <i><font color='green'>/* tp_clear */</font></i>
<a name='L1178'>    0,                                  <i><font color='green'>/* tp_richcompare */</font></i>
<a name='L1179'>    0,                                  <i><font color='green'>/* tp_weaklistoffset */</font></i>
<a name='L1180'>    <a href='../S/2803.html#L933' title='Defined at 933 in Objects/object.c.'>PyObject_SelfIter</a>,                  <i><font color='green'>/* tp_iter */</font></i>
<a name='L1181'>    (iternextfunc)<a href='../S/2818.html#L1085' title='Defined at 1085 in Objects/stringlib/string_format.h.'>formatteriter_next</a>,   <i><font color='green'>/* tp_iternext */</font></i>
<a name='L1182'>    formatteriter_methods,              <i><font color='green'>/* tp_methods */</font></i>
<a name='L1183'>    0,
<a name='L1184'><font color='red'>}</font>;
<a name='L1185'>
<a name='L1186'><i><font color='green'>/* unicode_formatter_parser is used to implement</font></i>
<a name='L1187'><i><font color='green'>   string.Formatter.vformat.  it parses a string and returns tuples</font></i>
<a name='L1188'><i><font color='green'>   describing the parsed elements.  It's a wrapper around</font></i>
<a name='L1189'><i><font color='green'>   stringlib/string_format.h's MarkupIterator */</font></i>
<a name='L1190'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1191'><a href='../S/2828.html#L10357' title='Refered from 10357 in Objects/unicodeobject.c.'>formatter_parser</a>(PyObject *ignored, <a href='../D/4998.html' title='Multiple defined in 2 places.'>STRINGLIB_OBJECT</a> *self)
<a name='L1192'><font color='red'>{</font>
<a name='L1193'>    <a href='../S/2818.html#L1067' title='Defined at 1067 in Objects/stringlib/string_format.h.'>formatteriterobject</a> *it;
<a name='L1194'>
<a name='L1195'>    <b>if</b> (!PyUnicode_Check(self)) <font color='red'>{</font>
<a name='L1196'>        <a href='../S/3106.html#L600' title='Defined at 600 in Python/errors.c.'>PyErr_Format</a>(PyExc_TypeError, "expected str, got %s", <a href='../D/4259.html' title='Multiple defined in 5 places.'>Py_TYPE</a>(self)-&gt;tp_name);
<a name='L1197'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1198'>    <font color='red'>}</font>
<a name='L1199'>
<a name='L1200'>    it = PyObject_New(<a href='../S/2818.html#L1067' title='Defined at 1067 in Objects/stringlib/string_format.h.'>formatteriterobject</a>, &amp;PyFormatterIter_Type);
<a name='L1201'>    <b>if</b> (it == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1202'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1203'>
<a name='L1204'>    <i><font color='green'>/* take ownership, give the object to the iterator */</font></i>
<a name='L1205'>    Py_INCREF(self);
<a name='L1206'>    it-&gt;str = self;
<a name='L1207'>
<a name='L1208'>    <i><font color='green'>/* initialize the contained MarkupIterator */</font></i>
<a name='L1209'>    <a href='../S/2818.html#L711' title='Defined at 711 in Objects/stringlib/string_format.h.'>MarkupIterator_init</a>(&amp;it-&gt;it_markup,
<a name='L1210'>                        <a href='../D/5003.html' title='Multiple defined in 3 places.'>STRINGLIB_STR</a>(self),
<a name='L1211'>                        <a href='../D/4994.html' title='Multiple defined in 3 places.'>STRINGLIB_LEN</a>(self));
<a name='L1212'>
<a name='L1213'>    <b>return</b> (<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *)it;
<a name='L1214'><font color='red'>}</font>
<a name='L1215'>
<a name='L1216'>
<a name='L1217'><i><font color='green'>/************************************************************************/</font></i>
<a name='L1218'><i><font color='green'>/*********** fieldnameiterator ******************************************/</font></i>
<a name='L1219'><i><font color='green'>/************************************************************************/</font></i>
<a name='L1220'>
<a name='L1221'>
<a name='L1222'><i><font color='green'>/* This is used to implement string.Formatter.vparse().  It parses the</font></i>
<a name='L1223'><i><font color='green'>   field name into attribute and item values.  It's a Python-callable</font></i>
<a name='L1224'><i><font color='green'>   wrapper around FieldNameIterator */</font></i>
<a name='L1225'>
<a name='L1226'><b>typedef</b> <b>struct</b> <font color='red'>{</font>
<a name='L1227'>    <a href='../S/544.html#L82' title='Defined at 82 in Include/object.h.'>PyObject_HEAD</a>
<a name='L1228'>
<a name='L1229'>    <a href='../D/4998.html' title='Multiple defined in 2 places.'>STRINGLIB_OBJECT</a> *str;
<a name='L1230'>
<a name='L1231'>    <a href='../S/2818.html#L287' title='Defined at 287 in Objects/stringlib/string_format.h.'>FieldNameIterator</a> it_field;
<a name='L1232'><font color='red'>}</font> <a href='../R/7752.html' title='Multiple refered from 3 places.'>fieldnameiterobject</a>;
<a name='L1233'>
<a name='L1234'><b>static</b> <b>void</b>
<a name='L1235'><a href='../S/2818.html#L1297' title='Refered from 1297 in Objects/stringlib/string_format.h.'>fieldnameiter_dealloc</a>(fieldnameiterobject *it)
<a name='L1236'><font color='red'>{</font>
<a name='L1237'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(it-&gt;str);
<a name='L1238'>    PyObject_FREE(it);
<a name='L1239'><font color='red'>}</font>
<a name='L1240'>
<a name='L1241'><i><font color='green'>/* returns a tuple:</font></i>
<a name='L1242'><i><font color='green'>   (is_attr, value)</font></i>
<a name='L1243'><i><font color='green'>   is_attr is true if we used attribute syntax (e.g., '.foo')</font></i>
<a name='L1244'><i><font color='green'>              false if we used index syntax (e.g., '[foo]')</font></i>
<a name='L1245'><i><font color='green'>   value is an integer or string</font></i>
<a name='L1246'><i><font color='green'>*/</font></i>
<a name='L1247'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1248'><a href='../S/2818.html#L1319' title='Refered from 1319 in Objects/stringlib/string_format.h.'>fieldnameiter_next</a>(fieldnameiterobject *it)
<a name='L1249'><font color='red'>{</font>
<a name='L1250'>    <b>int</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L1251'>    <b>int</b> is_attr;
<a name='L1252'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> idx;
<a name='L1253'>    <a href='../S/2818.html#L31' title='Defined at 31 in Objects/stringlib/string_format.h.'>SubString</a> name;
<a name='L1254'>
<a name='L1255'>    <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = <a href='../S/2818.html#L357' title='Defined at 357 in Objects/stringlib/string_format.h.'>FieldNameIterator_next</a>(&amp;it-&gt;it_field, &amp;is_attr,
<a name='L1256'>                                    &amp;idx, &amp;name);
<a name='L1257'>    <b>if</b> (<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> == 0 || <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> == 1)
<a name='L1258'>        <i><font color='green'>/* if 0, error has already been set, if 1, iterator is empty */</font></i>
<a name='L1259'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1260'>    <b>else</b> <font color='red'>{</font>
<a name='L1261'>        <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a>* <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1262'>        <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a>* is_attr_obj = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1263'>        <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a>* obj = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1264'>
<a name='L1265'>        is_attr_obj = <a href='../D/2761.html' title='Multiple defined in 2 places.'>PyBool_FromLong</a>(is_attr);
<a name='L1266'>        <b>if</b> (is_attr_obj == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1267'>            <b>goto</b> done;
<a name='L1268'>
<a name='L1269'>        <i><font color='green'>/* either an integer or a string */</font></i>
<a name='L1270'>        <b>if</b> (idx != -1)
<a name='L1271'>            obj = <a href='../D/3469.html' title='Multiple defined in 2 places.'>PyLong_FromSsize_t</a>(idx);
<a name='L1272'>        <b>else</b>
<a name='L1273'>            obj = SubString_new_object(&amp;name);
<a name='L1274'>        <b>if</b> (obj == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1275'>            <b>goto</b> done;
<a name='L1276'>
<a name='L1277'>        <i><font color='green'>/* return a tuple of values */</font></i>
<a name='L1278'>        <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = <a href='../S/2823.html#L186' title='Defined at 186 in Objects/tupleobject.c.'>PyTuple_Pack</a>(2, is_attr_obj, obj);
<a name='L1279'>
<a name='L1280'>    done:
<a name='L1281'>        <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(is_attr_obj);
<a name='L1282'>        <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(obj);
<a name='L1283'>        <b>return</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L1284'>    <font color='red'>}</font>
<a name='L1285'><font color='red'>}</font>
<a name='L1286'>
<a name='L1287'><b>static</b> <a href='../D/3525.html' title='Multiple defined in 3 places.'>PyMethodDef</a> fieldnameiter_methods[] = <font color='red'>{</font>
<a name='L1288'>    <font color='red'>{</font><a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,              <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>           <i><font color='green'>/* sentinel */</font></i>
<a name='L1289'><font color='red'>}</font>;
<a name='L1290'>
<a name='L1291'><b>static</b> <a href='../D/3899.html' title='Multiple defined in 3 places.'>PyTypeObject</a> PyFieldNameIter_Type = <font color='red'>{</font>
<a name='L1292'>    <a href='../D/4042.html' title='Multiple defined in 3 places.'>PyVarObject_HEAD_INIT</a>(&amp;PyType_Type, 0)
<a name='L1293'>    "fieldnameiterator",                <i><font color='green'>/* tp_name */</font></i>
<a name='L1294'>    <b>sizeof</b>(<a href='../S/2818.html#L1232' title='Defined at 1232 in Objects/stringlib/string_format.h.'>fieldnameiterobject</a>),        <i><font color='green'>/* tp_basicsize */</font></i>
<a name='L1295'>    0,                                  <i><font color='green'>/* tp_itemsize */</font></i>
<a name='L1296'>    <i><font color='green'>/* methods */</font></i>
<a name='L1297'>    (<a href='../D/8095.html' title='Multiple defined in 2 places.'>destructor</a>)<a href='../S/2818.html#L1235' title='Defined at 1235 in Objects/stringlib/string_format.h.'>fieldnameiter_dealloc</a>,  <i><font color='green'>/* tp_dealloc */</font></i>
<a name='L1298'>    0,                                  <i><font color='green'>/* tp_print */</font></i>
<a name='L1299'>    0,                                  <i><font color='green'>/* tp_getattr */</font></i>
<a name='L1300'>    0,                                  <i><font color='green'>/* tp_setattr */</font></i>
<a name='L1301'>    0,                                  <i><font color='green'>/* tp_reserved */</font></i>
<a name='L1302'>    0,                                  <i><font color='green'>/* tp_repr */</font></i>
<a name='L1303'>    0,                                  <i><font color='green'>/* tp_as_number */</font></i>
<a name='L1304'>    0,                                  <i><font color='green'>/* tp_as_sequence */</font></i>
<a name='L1305'>    0,                                  <i><font color='green'>/* tp_as_mapping */</font></i>
<a name='L1306'>    0,                                  <i><font color='green'>/* tp_hash */</font></i>
<a name='L1307'>    0,                                  <i><font color='green'>/* tp_call */</font></i>
<a name='L1308'>    0,                                  <i><font color='green'>/* tp_str */</font></i>
<a name='L1309'>    <a href='../S/2803.html#L1046' title='Defined at 1046 in Objects/object.c.'>PyObject_GenericGetAttr</a>,            <i><font color='green'>/* tp_getattro */</font></i>
<a name='L1310'>    0,                                  <i><font color='green'>/* tp_setattro */</font></i>
<a name='L1311'>    0,                                  <i><font color='green'>/* tp_as_buffer */</font></i>
<a name='L1312'>    Py_TPFLAGS_DEFAULT,                 <i><font color='green'>/* tp_flags */</font></i>
<a name='L1313'>    0,                                  <i><font color='green'>/* tp_doc */</font></i>
<a name='L1314'>    0,                                  <i><font color='green'>/* tp_traverse */</font></i>
<a name='L1315'>    0,                                  <i><font color='green'>/* tp_clear */</font></i>
<a name='L1316'>    0,                                  <i><font color='green'>/* tp_richcompare */</font></i>
<a name='L1317'>    0,                                  <i><font color='green'>/* tp_weaklistoffset */</font></i>
<a name='L1318'>    <a href='../S/2803.html#L933' title='Defined at 933 in Objects/object.c.'>PyObject_SelfIter</a>,                  <i><font color='green'>/* tp_iter */</font></i>
<a name='L1319'>    (iternextfunc)<a href='../S/2818.html#L1248' title='Defined at 1248 in Objects/stringlib/string_format.h.'>fieldnameiter_next</a>,   <i><font color='green'>/* tp_iternext */</font></i>
<a name='L1320'>    fieldnameiter_methods,              <i><font color='green'>/* tp_methods */</font></i>
<a name='L1321'>    0<font color='red'>}</font>;
<a name='L1322'>
<a name='L1323'><i><font color='green'>/* unicode_formatter_field_name_split is used to implement</font></i>
<a name='L1324'><i><font color='green'>   string.Formatter.vformat.  it takes an PEP 3101 "field name", and</font></i>
<a name='L1325'><i><font color='green'>   returns a tuple of (first, rest): "first", the part before the</font></i>
<a name='L1326'><i><font color='green'>   first '.' or '['; and "rest", an iterator for the rest of the field</font></i>
<a name='L1327'><i><font color='green'>   name.  it's a wrapper around stringlib/string_format.h's</font></i>
<a name='L1328'><i><font color='green'>   field_name_split.  The iterator it returns is a</font></i>
<a name='L1329'><i><font color='green'>   FieldNameIterator */</font></i>
<a name='L1330'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1331'><a href='../S/2828.html#L10355' title='Refered from 10355 in Objects/unicodeobject.c.'>formatter_field_name_split</a>(PyObject *ignored, <a href='../D/4998.html' title='Multiple defined in 2 places.'>STRINGLIB_OBJECT</a> *self)
<a name='L1332'><font color='red'>{</font>
<a name='L1333'>    <a href='../S/2818.html#L31' title='Defined at 31 in Objects/stringlib/string_format.h.'>SubString</a> first;
<a name='L1334'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> first_idx;
<a name='L1335'>    <a href='../S/2818.html#L1232' title='Defined at 1232 in Objects/stringlib/string_format.h.'>fieldnameiterobject</a> *it;
<a name='L1336'>
<a name='L1337'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *first_obj = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1338'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1339'>
<a name='L1340'>    <b>if</b> (!PyUnicode_Check(self)) <font color='red'>{</font>
<a name='L1341'>        <a href='../S/3106.html#L600' title='Defined at 600 in Python/errors.c.'>PyErr_Format</a>(PyExc_TypeError, "expected str, got %s", <a href='../D/4259.html' title='Multiple defined in 5 places.'>Py_TYPE</a>(self)-&gt;tp_name);
<a name='L1342'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1343'>    <font color='red'>}</font>
<a name='L1344'>
<a name='L1345'>    it = PyObject_New(<a href='../S/2818.html#L1232' title='Defined at 1232 in Objects/stringlib/string_format.h.'>fieldnameiterobject</a>, &amp;PyFieldNameIter_Type);
<a name='L1346'>    <b>if</b> (it == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1347'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1348'>
<a name='L1349'>    <i><font color='green'>/* take ownership, give the object to the iterator.  this is</font></i>
<a name='L1350'><i><font color='green'>       just to keep the field_name alive */</font></i>
<a name='L1351'>    Py_INCREF(self);
<a name='L1352'>    it-&gt;str = self;
<a name='L1353'>
<a name='L1354'>    <i><font color='green'>/* Pass in auto_number = NULL. We'll return an empty string for</font></i>
<a name='L1355'><i><font color='green'>       first_obj in that case. */</font></i>
<a name='L1356'>    <b>if</b> (!<a href='../S/2818.html#L403' title='Defined at 403 in Objects/stringlib/string_format.h.'>field_name_split</a>(<a href='../D/5003.html' title='Multiple defined in 3 places.'>STRINGLIB_STR</a>(self),
<a name='L1357'>                          <a href='../D/4994.html' title='Multiple defined in 3 places.'>STRINGLIB_LEN</a>(self),
<a name='L1358'>                          &amp;first, &amp;first_idx, &amp;it-&gt;it_field, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>))
<a name='L1359'>        <b>goto</b> done;
<a name='L1360'>
<a name='L1361'>    <i><font color='green'>/* first becomes an integer, if possible; else a string */</font></i>
<a name='L1362'>    <b>if</b> (first_idx != -1)
<a name='L1363'>        first_obj = <a href='../D/3469.html' title='Multiple defined in 2 places.'>PyLong_FromSsize_t</a>(first_idx);
<a name='L1364'>    <b>else</b>
<a name='L1365'>        <i><font color='green'>/* convert "first" into a string object */</font></i>
<a name='L1366'>        first_obj = SubString_new_object(&amp;first);
<a name='L1367'>    <b>if</b> (first_obj == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1368'>        <b>goto</b> done;
<a name='L1369'>
<a name='L1370'>    <i><font color='green'>/* return a tuple of values */</font></i>
<a name='L1371'>    <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = <a href='../S/2823.html#L186' title='Defined at 186 in Objects/tupleobject.c.'>PyTuple_Pack</a>(2, first_obj, it);
<a name='L1372'>
<a name='L1373'>done:
<a name='L1374'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(it);
<a name='L1375'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(first_obj);
<a name='L1376'>    <b>return</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L1377'><font color='red'>}</font>
</pre>
<hr>
<a name='BOTTOM'>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L59'>[^]</a><a href='#L1331'>[v]</a><a href='#TOP'>[top]</a>[bottom]<a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
</body>
</html>
