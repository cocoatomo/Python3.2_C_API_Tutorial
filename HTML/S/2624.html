<html>
<head>
<title>Modules/audioop.c</title>
<meta name='robots' content='noindex,nofollow'>
<meta name='generator' content='GLOBAL-5.8.1'>
</head>
<body text='#191970' bgcolor='#f5f5dc' vlink='gray'>
<a name='TOP'><h2><a href='../mains.html'>root</a>/<a href='../files/3353.html'>Modules</a>/audioop.c</h2>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L56'>[^]</a><a href='#L1653'>[v]</a>[top]<a href='#BOTTOM'>[bottom]</a><a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
<hr>
<h2>DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href='#L56' title='Defined at 56.'>search</a>
<li><a href='#L142' title='Defined at 142.'>st_14linear2ulaw</a>
<li><a href='#L239' title='Defined at 239.'>st_linear2alaw</a>
<li><a href='#L301' title='Defined at 301.'>audioop_check_size</a>
<li><a href='#L312' title='Defined at 312.'>audioop_check_parameters</a>
<li><a href='#L324' title='Defined at 324.'>audioop_getsample</a>
<li><a href='#L345' title='Defined at 345.'>audioop_max</a>
<li><a href='#L367' title='Defined at 367.'>audioop_minmax</a>
<li><a href='#L389' title='Defined at 389.'>audioop_avg</a>
<li><a href='#L414' title='Defined at 414.'>audioop_rms</a>
<li><a href='#L438' title='Defined at 438.'>_sum2</a>
<li><a href='#L482' title='Defined at 482.'>audioop_findfit</a>
<li><a href='#L545' title='Defined at 545.'>audioop_findfactor</a>
<li><a href='#L576' title='Defined at 576.'>audioop_findmax</a>
<li><a href='#L621' title='Defined at 621.'>audioop_avgpp</a>
<li><a href='#L676' title='Defined at 676.'>audioop_maxpp</a>
<li><a href='#L727' title='Defined at 727.'>audioop_cross</a>
<li><a href='#L753' title='Defined at 753.'>audioop_mul</a>
<li><a href='#L796' title='Defined at 796.'>audioop_tomono</a>
<li><a href='#L857' title='Defined at 857.'>audioop_tostereo</a>
<li><a href='#L918' title='Defined at 918.'>audioop_add</a>
<li><a href='#L972' title='Defined at 972.'>audioop_bias</a>
<li><a href='#L1006' title='Defined at 1006.'>audioop_reverse</a>
<li><a href='#L1041' title='Defined at 1041.'>audioop_lin2lin</a>
<li><a href='#L1081' title='Defined at 1081.'>gcd</a>
<li><a href='#L1092' title='Defined at 1092.'>audioop_ratecv</a>
<li><a href='#L1272' title='Defined at 1272.'>audioop_lin2ulaw</a>
<li><a href='#L1303' title='Defined at 1303.'>audioop_ulaw2lin</a>
<li><a href='#L1341' title='Defined at 1341.'>audioop_lin2alaw</a>
<li><a href='#L1372' title='Defined at 1372.'>audioop_alaw2lin</a>
<li><a href='#L1410' title='Defined at 1410.'>audioop_lin2adpcm</a>
<li><a href='#L1517' title='Defined at 1517.'>audioop_adpcm2lin</a>
<li><a href='#L1653' title='Defined at 1653.'>PyInit_audioop</a>
</ol>
<hr>
<pre>
<a name='L1'>
<a name='L2'><i><font color='green'>/* audioopmodule - Module to detect peak values in arrays */</font></i>
<a name='L3'>
<a name='L4'><font color='darkred'>#define</font> <a href='../R/2388.html' title='Multiple refered from 2 places.'>PY_SSIZE_T_CLEAN</a>
<a name='L5'>
<a name='L6'><font color='darkred'>#include</font> "<a href='570.html'>Python.h</a>"
<a name='L7'>
<a name='L8'><font color='darkred'>#if</font> <a href='../D/4733.html' title='Multiple defined in 3 places.'>SIZEOF_INT</a> == 4
<a name='L9'><b>typedef</b> <b>int</b> <a href='../R/3732.html' title='Multiple refered from 13 places.'>Py_Int32</a>;
<a name='L10'><b>typedef</b> <b>unsigned</b> <b>int</b> Py_UInt32;
<a name='L11'><font color='darkred'>#else</font>
<a name='L12'><font color='darkred'>#if</font> <a href='../D/4734.html' title='Multiple defined in 7 places.'>SIZEOF_LONG</a> == 4
<a name='L13'><b>typedef</b> <b>long</b> <a href='../R/3732.html' title='Multiple refered from 13 places.'>Py_Int32</a>;
<a name='L14'><b>typedef</b> <b>unsigned</b> <b>long</b> Py_UInt32;
<a name='L15'><font color='darkred'>#else</font>
<a name='L16'><font color='darkred'>#error</font> "No 4-byte integral type"
<a name='L17'><font color='darkred'>#endif</font>
<a name='L18'><font color='darkred'>#endif</font>
<a name='L19'>
<a name='L20'><b>typedef</b> <b>short</b> <a href='../R/3070.html' title='Multiple refered from 8 places.'>PyInt16</a>;
<a name='L21'>
<a name='L22'><font color='darkred'>#if</font> <b>defined</b>(__CHAR_UNSIGNED__)
<a name='L23'><font color='darkred'>#if</font> <b>defined</b>(<b>signed</b>)
<a name='L24'><i><font color='green'>/* This module currently does not work on systems where only unsigned</font></i>
<a name='L25'><i><font color='green'>   characters are available.  Take it out of Setup.  Sorry. */</font></i>
<a name='L26'><font color='darkred'>#endif</font>
<a name='L27'><font color='darkred'>#endif</font>
<a name='L28'>
<a name='L29'><i><font color='green'>/* Code shamelessly stolen from sox, 12.17.7, g711.c</font></i>
<a name='L30'><i><font color='green'>** (c) Craig Reese, Joe Campbell and Jeff Poskanzer 1989 */</font></i>
<a name='L31'>
<a name='L32'><i><font color='green'>/* From g711.c:</font></i>
<a name='L33'><i><font color='green'> *</font></i>
<a name='L34'><i><font color='green'> * December 30, 1994:</font></i>
<a name='L35'><i><font color='green'> * Functions linear2alaw, linear2ulaw have been updated to correctly</font></i>
<a name='L36'><i><font color='green'> * convert unquantized 16 bit values.</font></i>
<a name='L37'><i><font color='green'> * Tables for direct u- to A-law and A- to u-law conversions have been</font></i>
<a name='L38'><i><font color='green'> * corrected.</font></i>
<a name='L39'><i><font color='green'> * Borge Lindberg, Center for PersonKommunikation, Aalborg University.</font></i>
<a name='L40'><i><font color='green'> * bli@cpk.auc.dk</font></i>
<a name='L41'><i><font color='green'> *</font></i>
<a name='L42'><i><font color='green'> */</font></i>
<a name='L43'><font color='darkred'>#define</font> <a href='../S/2624.html#L160' title='Refered from 160 in Modules/audioop.c.'>BIAS</a> 0x84   <i><font color='green'>/* define the add-in bias for 16 bit samples */</font></i>
<a name='L44'><font color='darkred'>#define</font> <a href='../S/2624.html#L159' title='Refered from 159 in Modules/audioop.c.'>CLIP</a> 32635
<a name='L45'><font color='darkred'>#define</font> SIGN_BIT        (0x80)          <i><font color='green'>/* Sign bit for a A-law byte. */</font></i>
<a name='L46'><font color='darkred'>#define</font> <a href='../R/3880.html' title='Multiple refered from 2 places.'>QUANT_MASK</a>      (0xf)           <i><font color='green'>/* Quantization field mask. */</font></i>
<a name='L47'><font color='darkred'>#define</font> <a href='../S/2624.html#L264' title='Refered from 264 in Modules/audioop.c.'>SEG_SHIFT</a>       (4)             <i><font color='green'>/* Left shift for segment number. */</font></i>
<a name='L48'><font color='darkred'>#define</font> SEG_MASK        (0x70)          <i><font color='green'>/* Segment field mask. */</font></i>
<a name='L49'>
<a name='L50'><b>static</b> <a href='../S/2624.html#L20' title='Defined at 20 in Modules/audioop.c.'>PyInt16</a> seg_aend[8] = <font color='red'>{</font>0x1F, 0x3F, 0x7F, 0xFF,
<a name='L51'>                              0x1FF, 0x3FF, 0x7FF, 0xFFF<font color='red'>}</font>;
<a name='L52'><b>static</b> <a href='../S/2624.html#L20' title='Defined at 20 in Modules/audioop.c.'>PyInt16</a> seg_uend[8] = <font color='red'>{</font>0x3F, 0x7F, 0xFF, 0x1FF,
<a name='L53'>                              0x3FF, 0x7FF, 0xFFF, 0x1FFF<font color='red'>}</font>;
<a name='L54'>
<a name='L55'><b>static</b> <a href='../S/2624.html#L20' title='Defined at 20 in Modules/audioop.c.'>PyInt16</a>
<a name='L56'><a href='../R/10132.html' title='Multiple refered from 9 places.'>search</a>(PyInt16 val, PyInt16 *table, <b>int</b> size)
<a name='L57'><font color='red'>{</font>
<a name='L58'>    <b>int</b> i;
<a name='L59'>
<a name='L60'>    <b>for</b> (i = 0; i &lt; size; i++) <font color='red'>{</font>
<a name='L61'>        <b>if</b> (val &lt;= *table++)
<a name='L62'>            <b>return</b> (i);
<a name='L63'>    <font color='red'>}</font>
<a name='L64'>    <b>return</b> (size);
<a name='L65'><font color='red'>}</font>
<a name='L66'><font color='darkred'>#define</font> <a href='../S/2624.html#L1331' title='Refered from 1331 in Modules/audioop.c.'>st_ulaw2linear16</a>(uc) (_st_ulaw2linear16[uc])
<a name='L67'><font color='darkred'>#define</font> <a href='../S/2624.html#L1400' title='Refered from 1400 in Modules/audioop.c.'>st_alaw2linear16</a>(uc) (_st_alaw2linear16[uc])
<a name='L68'>
<a name='L69'><b>static</b> <a href='../S/2624.html#L20' title='Defined at 20 in Modules/audioop.c.'>PyInt16</a> _st_ulaw2linear16[256] = <font color='red'>{</font>
<a name='L70'>    -32124,  -31100,  -30076,  -29052,  -28028,  -27004,  -25980,
<a name='L71'>    -24956,  -23932,  -22908,  -21884,  -20860,  -19836,  -18812,
<a name='L72'>    -17788,  -16764,  -15996,  -15484,  -14972,  -14460,  -13948,
<a name='L73'>    -13436,  -12924,  -12412,  -11900,  -11388,  -10876,  -10364,
<a name='L74'>     -9852,   -9340,   -8828,   -8316,   -7932,   -7676,   -7420,
<a name='L75'>     -7164,   -6908,   -6652,   -6396,   -6140,   -5884,   -5628,
<a name='L76'>     -5372,   -5116,   -4860,   -4604,   -4348,   -4092,   -3900,
<a name='L77'>     -3772,   -3644,   -3516,   -3388,   -3260,   -3132,   -3004,
<a name='L78'>     -2876,   -2748,   -2620,   -2492,   -2364,   -2236,   -2108,
<a name='L79'>     -1980,   -1884,   -1820,   -1756,   -1692,   -1628,   -1564,
<a name='L80'>     -1500,   -1436,   -1372,   -1308,   -1244,   -1180,   -1116,
<a name='L81'>     -1052,    -988,    -924,    -876,    -844,    -812,    -780,
<a name='L82'>      -748,    -716,    -684,    -652,    -620,    -588,    -556,
<a name='L83'>      -524,    -492,    -460,    -428,    -396,    -372,    -356,
<a name='L84'>      -340,    -324,    -308,    -292,    -276,    -260,    -244,
<a name='L85'>      -228,    -212,    -196,    -180,    -164,    -148,    -132,
<a name='L86'>      -120,    -112,    -104,     -96,     -88,     -80,     -72,
<a name='L87'>       -64,     -56,     -48,     -40,     -32,     -24,     -16,
<a name='L88'>    -8,       0,   32124,   31100,   30076,   29052,   28028,
<a name='L89'>     27004,   25980,   24956,   23932,   22908,   21884,   20860,
<a name='L90'>     19836,   18812,   17788,   16764,   15996,   15484,   14972,
<a name='L91'>     14460,   13948,   13436,   12924,   12412,   11900,   11388,
<a name='L92'>     10876,   10364,    9852,    9340,    8828,    8316,    7932,
<a name='L93'>      7676,    7420,    7164,    6908,    6652,    6396,    6140,
<a name='L94'>      5884,    5628,    5372,    5116,    4860,    4604,    4348,
<a name='L95'>      4092,    3900,    3772,    3644,    3516,    3388,    3260,
<a name='L96'>      3132,    3004,    2876,    2748,    2620,    2492,    2364,
<a name='L97'>      2236,    2108,    1980,    1884,    1820,    1756,    1692,
<a name='L98'>      1628,    1564,    1500,    1436,    1372,    1308,    1244,
<a name='L99'>      1180,    1116,    1052,     988,     924,     876,     844,
<a name='L100'>       812,     780,     748,     716,     684,     652,     620,
<a name='L101'>       588,     556,     524,     492,     460,     428,     396,
<a name='L102'>       372,     356,     340,     324,     308,     292,     276,
<a name='L103'>       260,     244,     228,     212,     196,     180,     164,
<a name='L104'>       148,     132,     120,     112,     104,      96,      88,
<a name='L105'>    80,      72,      64,      56,      48,      40,      32,
<a name='L106'>    24,      16,       8,       0
<a name='L107'><font color='red'>}</font>;
<a name='L108'>
<a name='L109'><i><font color='green'>/*</font></i>
<a name='L110'><i><font color='green'> * linear2ulaw() accepts a 14-bit signed integer and encodes it as u-law data</font></i>
<a name='L111'><i><font color='green'> * stored in a unsigned char.  This function should only be called with</font></i>
<a name='L112'><i><font color='green'> * the data shifted such that it only contains information in the lower</font></i>
<a name='L113'><i><font color='green'> * 14-bits.</font></i>
<a name='L114'><i><font color='green'> *</font></i>
<a name='L115'><i><font color='green'> * In order to simplify the encoding process, the original linear magnitude</font></i>
<a name='L116'><i><font color='green'> * is biased by adding 33 which shifts the encoding range from (0 - 8158) to</font></i>
<a name='L117'><i><font color='green'> * (33 - 8191). The result can be seen in the following encoding table:</font></i>
<a name='L118'><i><font color='green'> *</font></i>
<a name='L119'><i><font color='green'> *      Biased Linear Input Code        Compressed Code</font></i>
<a name='L120'><i><font color='green'> *      ------------------------        ---------------</font></i>
<a name='L121'><i><font color='green'> *      00000001wxyza                   000wxyz</font></i>
<a name='L122'><i><font color='green'> *      0000001wxyzab                   001wxyz</font></i>
<a name='L123'><i><font color='green'> *      000001wxyzabc                   010wxyz</font></i>
<a name='L124'><i><font color='green'> *      00001wxyzabcd                   011wxyz</font></i>
<a name='L125'><i><font color='green'> *      0001wxyzabcde                   100wxyz</font></i>
<a name='L126'><i><font color='green'> *      001wxyzabcdef                   101wxyz</font></i>
<a name='L127'><i><font color='green'> *      01wxyzabcdefg                   110wxyz</font></i>
<a name='L128'><i><font color='green'> *      1wxyzabcdefgh                   111wxyz</font></i>
<a name='L129'><i><font color='green'> *</font></i>
<a name='L130'><i><font color='green'> * Each biased linear code has a leading 1 which identifies the segment</font></i>
<a name='L131'><i><font color='green'> * number. The value of the segment number is equal to 7 minus the number</font></i>
<a name='L132'><i><font color='green'> * of leading 0's. The quantization interval is directly available as the</font></i>
<a name='L133'><i><font color='green'> * four bits wxyz.  * The trailing bits (a - h) are ignored.</font></i>
<a name='L134'><i><font color='green'> *</font></i>
<a name='L135'><i><font color='green'> * Ordinarily the complement of the resulting code word is used for</font></i>
<a name='L136'><i><font color='green'> * transmission, and so the code word is complemented before it is returned.</font></i>
<a name='L137'><i><font color='green'> *</font></i>
<a name='L138'><i><font color='green'> * For further information see John C. Bellamy's Digital Telephony, 1982,</font></i>
<a name='L139'><i><font color='green'> * John Wiley &amp; Sons, pps 98-111 and 472-476.</font></i>
<a name='L140'><i><font color='green'> */</font></i>
<a name='L141'><b>static</b> <b>unsigned</b> <b>char</b>
<a name='L142'><a href='../S/2624.html#L1297' title='Refered from 1297 in Modules/audioop.c.'>st_14linear2ulaw</a>(PyInt16 pcm_val)       <i><font color='green'>/* 2's complement (14-bit range) */</font></i>
<a name='L143'><font color='red'>{</font>
<a name='L144'>    <a href='../S/2624.html#L20' title='Defined at 20 in Modules/audioop.c.'>PyInt16</a>         mask;
<a name='L145'>    <a href='../S/2624.html#L20' title='Defined at 20 in Modules/audioop.c.'>PyInt16</a>         seg;
<a name='L146'>    <b>unsigned</b> <b>char</b>   uval;
<a name='L147'>
<a name='L148'>    <i><font color='green'>/* The original sox code does this in the calling function, not here */</font></i>
<a name='L149'>    pcm_val = pcm_val &gt;&gt; 2;
<a name='L150'>
<a name='L151'>    <i><font color='green'>/* u-law inverts all bits */</font></i>
<a name='L152'>    <i><font color='green'>/* Get the sign and the magnitude of the value. */</font></i>
<a name='L153'>    <b>if</b> (pcm_val &lt; 0) <font color='red'>{</font>
<a name='L154'>        pcm_val = -pcm_val;
<a name='L155'>        mask = 0x7F;
<a name='L156'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L157'>        mask = 0xFF;
<a name='L158'>    <font color='red'>}</font>
<a name='L159'>    <b>if</b> ( pcm_val &gt; <a href='../S/2624.html#L44' title='Defined at 44 in Modules/audioop.c.'>CLIP</a> ) pcm_val = <a href='../S/2624.html#L44' title='Defined at 44 in Modules/audioop.c.'>CLIP</a>;           <i><font color='green'>/* clip the magnitude */</font></i>
<a name='L160'>    pcm_val += (<a href='../S/2624.html#L43' title='Defined at 43 in Modules/audioop.c.'>BIAS</a> &gt;&gt; 2);
<a name='L161'>
<a name='L162'>    <i><font color='green'>/* Convert the scaled magnitude to segment number. */</font></i>
<a name='L163'>    seg = <a href='../S/2624.html#L56' title='Defined at 56 in Modules/audioop.c.'>search</a>(pcm_val, seg_uend, 8);
<a name='L164'>
<a name='L165'>    <i><font color='green'>/*</font></i>
<a name='L166'><i><font color='green'>     * Combine the sign, segment, quantization bits;</font></i>
<a name='L167'><i><font color='green'>     * and complement the code word.</font></i>
<a name='L168'><i><font color='green'>     */</font></i>
<a name='L169'>    <b>if</b> (seg &gt;= 8)           <i><font color='green'>/* out of range, return maximum value. */</font></i>
<a name='L170'>        <b>return</b> (<b>unsigned</b> <b>char</b>) (0x7F ^ mask);
<a name='L171'>    <b>else</b> <font color='red'>{</font>
<a name='L172'>        uval = (<b>unsigned</b> <b>char</b>) (seg &lt;&lt; 4) | ((pcm_val &gt;&gt; (seg + 1)) &amp; 0xF);
<a name='L173'>        <b>return</b> (uval ^ mask);
<a name='L174'>    <font color='red'>}</font>
<a name='L175'>
<a name='L176'><font color='red'>}</font>
<a name='L177'>
<a name='L178'><b>static</b> <a href='../S/2624.html#L20' title='Defined at 20 in Modules/audioop.c.'>PyInt16</a> _st_alaw2linear16[256] = <font color='red'>{</font>
<a name='L179'>     -5504,   -5248,   -6016,   -5760,   -4480,   -4224,   -4992,
<a name='L180'>     -4736,   -7552,   -7296,   -8064,   -7808,   -6528,   -6272,
<a name='L181'>     -7040,   -6784,   -2752,   -2624,   -3008,   -2880,   -2240,
<a name='L182'>     -2112,   -2496,   -2368,   -3776,   -3648,   -4032,   -3904,
<a name='L183'>     -3264,   -3136,   -3520,   -3392,  -22016,  -20992,  -24064,
<a name='L184'>    -23040,  -17920,  -16896,  -19968,  -18944,  -30208,  -29184,
<a name='L185'>    -32256,  -31232,  -26112,  -25088,  -28160,  -27136,  -11008,
<a name='L186'>    -10496,  -12032,  -11520,   -8960,   -8448,   -9984,   -9472,
<a name='L187'>    -15104,  -14592,  -16128,  -15616,  -13056,  -12544,  -14080,
<a name='L188'>    -13568,    -344,    -328,    -376,    -360,    -280,    -264,
<a name='L189'>      -312,    -296,    -472,    -456,    -504,    -488,    -408,
<a name='L190'>      -392,    -440,    -424,     -88,     -72,    -120,    -104,
<a name='L191'>       -24,      -8,     -56,     -40,    -216,    -200,    -248,
<a name='L192'>      -232,    -152,    -136,    -184,    -168,   -1376,   -1312,
<a name='L193'>     -1504,   -1440,   -1120,   -1056,   -1248,   -1184,   -1888,
<a name='L194'>     -1824,   -2016,   -1952,   -1632,   -1568,   -1760,   -1696,
<a name='L195'>      -688,    -656,    -752,    -720,    -560,    -528,    -624,
<a name='L196'>      -592,    -944,    -912,   -1008,    -976,    -816,    -784,
<a name='L197'>      -880,    -848,    5504,    5248,    6016,    5760,    4480,
<a name='L198'>      4224,    4992,    4736,    7552,    7296,    8064,    7808,
<a name='L199'>      6528,    6272,    7040,    6784,    2752,    2624,    3008,
<a name='L200'>      2880,    2240,    2112,    2496,    2368,    3776,    3648,
<a name='L201'>      4032,    3904,    3264,    3136,    3520,    3392,   22016,
<a name='L202'>     20992,   24064,   23040,   17920,   16896,   19968,   18944,
<a name='L203'>     30208,   29184,   32256,   31232,   26112,   25088,   28160,
<a name='L204'>     27136,   11008,   10496,   12032,   11520,    8960,    8448,
<a name='L205'>      9984,    9472,   15104,   14592,   16128,   15616,   13056,
<a name='L206'>     12544,   14080,   13568,     344,     328,     376,     360,
<a name='L207'>       280,     264,     312,     296,     472,     456,     504,
<a name='L208'>       488,     408,     392,     440,     424,      88,      72,
<a name='L209'>       120,     104,      24,       8,      56,      40,     216,
<a name='L210'>       200,     248,     232,     152,     136,     184,     168,
<a name='L211'>      1376,    1312,    1504,    1440,    1120,    1056,    1248,
<a name='L212'>      1184,    1888,    1824,    2016,    1952,    1632,    1568,
<a name='L213'>      1760,    1696,     688,     656,     752,     720,     560,
<a name='L214'>       528,     624,     592,     944,     912,    1008,     976,
<a name='L215'>       816,     784,     880,     848
<a name='L216'><font color='red'>}</font>;
<a name='L217'>
<a name='L218'><i><font color='green'>/*</font></i>
<a name='L219'><i><font color='green'> * linear2alaw() accepts an 13-bit signed integer and encodes it as A-law data</font></i>
<a name='L220'><i><font color='green'> * stored in a unsigned char.  This function should only be called with</font></i>
<a name='L221'><i><font color='green'> * the data shifted such that it only contains information in the lower</font></i>
<a name='L222'><i><font color='green'> * 13-bits.</font></i>
<a name='L223'><i><font color='green'> *</font></i>
<a name='L224'><i><font color='green'> *              Linear Input Code       Compressed Code</font></i>
<a name='L225'><i><font color='green'> *      ------------------------        ---------------</font></i>
<a name='L226'><i><font color='green'> *      0000000wxyza                    000wxyz</font></i>
<a name='L227'><i><font color='green'> *      0000001wxyza                    001wxyz</font></i>
<a name='L228'><i><font color='green'> *      000001wxyzab                    010wxyz</font></i>
<a name='L229'><i><font color='green'> *      00001wxyzabc                    011wxyz</font></i>
<a name='L230'><i><font color='green'> *      0001wxyzabcd                    100wxyz</font></i>
<a name='L231'><i><font color='green'> *      001wxyzabcde                    101wxyz</font></i>
<a name='L232'><i><font color='green'> *      01wxyzabcdef                    110wxyz</font></i>
<a name='L233'><i><font color='green'> *      1wxyzabcdefg                    111wxyz</font></i>
<a name='L234'><i><font color='green'> *</font></i>
<a name='L235'><i><font color='green'> * For further information see John C. Bellamy's Digital Telephony, 1982,</font></i>
<a name='L236'><i><font color='green'> * John Wiley &amp; Sons, pps 98-111 and 472-476.</font></i>
<a name='L237'><i><font color='green'> */</font></i>
<a name='L238'><b>static</b> <b>unsigned</b> <b>char</b>
<a name='L239'><a href='../S/2624.html#L1366' title='Refered from 1366 in Modules/audioop.c.'>st_linear2alaw</a>(PyInt16 pcm_val) <i><font color='green'>/* 2's complement (13-bit range) */</font></i>
<a name='L240'><font color='red'>{</font>
<a name='L241'>    <a href='../S/2624.html#L20' title='Defined at 20 in Modules/audioop.c.'>PyInt16</a>         mask;
<a name='L242'>    <b>short</b>           seg;
<a name='L243'>    <b>unsigned</b> <b>char</b>   aval;
<a name='L244'>
<a name='L245'>    <i><font color='green'>/* The original sox code does this in the calling function, not here */</font></i>
<a name='L246'>    pcm_val = pcm_val &gt;&gt; 3;
<a name='L247'>
<a name='L248'>    <i><font color='green'>/* A-law using even bit inversion */</font></i>
<a name='L249'>    <b>if</b> (pcm_val &gt;= 0) <font color='red'>{</font>
<a name='L250'>        mask = 0xD5;            <i><font color='green'>/* sign (7th) bit = 1 */</font></i>
<a name='L251'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L252'>        mask = 0x55;            <i><font color='green'>/* sign bit = 0 */</font></i>
<a name='L253'>        pcm_val = -pcm_val - 1;
<a name='L254'>    <font color='red'>}</font>
<a name='L255'>
<a name='L256'>    <i><font color='green'>/* Convert the scaled magnitude to segment number. */</font></i>
<a name='L257'>    seg = <a href='../S/2624.html#L56' title='Defined at 56 in Modules/audioop.c.'>search</a>(pcm_val, seg_aend, 8);
<a name='L258'>
<a name='L259'>    <i><font color='green'>/* Combine the sign, segment, and quantization bits. */</font></i>
<a name='L260'>
<a name='L261'>    <b>if</b> (seg &gt;= 8)           <i><font color='green'>/* out of range, return maximum value. */</font></i>
<a name='L262'>        <b>return</b> (<b>unsigned</b> <b>char</b>) (0x7F ^ mask);
<a name='L263'>    <b>else</b> <font color='red'>{</font>
<a name='L264'>        aval = (<b>unsigned</b> <b>char</b>) seg &lt;&lt; <a href='../S/2624.html#L47' title='Defined at 47 in Modules/audioop.c.'>SEG_SHIFT</a>;
<a name='L265'>        <b>if</b> (seg &lt; 2)
<a name='L266'>            aval |= (pcm_val &gt;&gt; 1) &amp; <a href='../S/2624.html#L46' title='Defined at 46 in Modules/audioop.c.'>QUANT_MASK</a>;
<a name='L267'>        <b>else</b>
<a name='L268'>            aval |= (pcm_val &gt;&gt; seg) &amp; <a href='../S/2624.html#L46' title='Defined at 46 in Modules/audioop.c.'>QUANT_MASK</a>;
<a name='L269'>        <b>return</b> (aval ^ mask);
<a name='L270'>    <font color='red'>}</font>
<a name='L271'><font color='red'>}</font>
<a name='L272'><i><font color='green'>/* End of code taken from sox */</font></i>
<a name='L273'>
<a name='L274'><i><font color='green'>/* Intel ADPCM step variation table */</font></i>
<a name='L275'><b>static</b> <b>int</b> indexTable[16] = <font color='red'>{</font>
<a name='L276'>    -1, -1, -1, -1, 2, 4, 6, 8,
<a name='L277'>    -1, -1, -1, -1, 2, 4, 6, 8,
<a name='L278'><font color='red'>}</font>;
<a name='L279'>
<a name='L280'><b>static</b> <b>int</b> stepsizeTable[89] = <font color='red'>{</font>
<a name='L281'>    7, 8, 9, 10, 11, 12, 13, 14, 16, 17,
<a name='L282'>    19, 21, 23, 25, 28, 31, 34, 37, 41, 45,
<a name='L283'>    50, 55, 60, 66, 73, 80, 88, 97, 107, 118,
<a name='L284'>    130, 143, 157, 173, 190, 209, 230, 253, 279, 307,
<a name='L285'>    337, 371, 408, 449, 494, 544, 598, 658, 724, 796,
<a name='L286'>    876, 963, 1060, 1166, 1282, 1411, 1552, 1707, 1878, 2066,
<a name='L287'>    2272, 2499, 2749, 3024, 3327, 3660, 4026, 4428, 4871, 5358,
<a name='L288'>    5894, 6484, 7132, 7845, 8630, 9493, 10442, 11487, 12635, 13899,
<a name='L289'>    15289, 16818, 18500, 20350, 22385, 24623, 27086, 29794, 32767
<a name='L290'><font color='red'>}</font>;
<a name='L291'>
<a name='L292'><font color='darkred'>#define</font> <a href='../R/464.html' title='Multiple refered from 37 places.'>CHARP</a>(cp, i) ((<b>signed</b> <b>char</b> *)(cp+i))
<a name='L293'><font color='darkred'>#define</font> <a href='../R/4131.html' title='Multiple refered from 37 places.'>SHORTP</a>(cp, i) ((<b>short</b> *)(cp+i))
<a name='L294'><font color='darkred'>#define</font> <a href='../R/1762.html' title='Multiple refered from 37 places.'>LONGP</a>(cp, i) ((<a href='../D/4171.html' title='Multiple defined in 2 places.'>Py_Int32</a> *)(cp+i))
<a name='L295'>
<a name='L296'>
<a name='L297'>
<a name='L298'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *AudioopError;
<a name='L299'>
<a name='L300'><b>static</b> <b>int</b>
<a name='L301'><a href='../R/6173.html' title='Multiple refered from 3 places.'>audioop_check_size</a>(<b>int</b> size)
<a name='L302'><font color='red'>{</font>
<a name='L303'>    <b>if</b> (size != 1 &amp;&amp; size != 2 &amp;&amp; size != 4) <font color='red'>{</font>
<a name='L304'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(AudioopError, "Size should be 1, 2 or 4");
<a name='L305'>        <b>return</b> 0;
<a name='L306'>    <font color='red'>}</font>
<a name='L307'>    <b>else</b>
<a name='L308'>        <b>return</b> 1;
<a name='L309'><font color='red'>}</font>
<a name='L310'>
<a name='L311'><b>static</b> <b>int</b>
<a name='L312'><a href='../R/6172.html' title='Multiple refered from 21 places.'>audioop_check_parameters</a>(<a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> len, <b>int</b> size)
<a name='L313'><font color='red'>{</font>
<a name='L314'>    <b>if</b> (!<a href='../S/2624.html#L301' title='Defined at 301 in Modules/audioop.c.'>audioop_check_size</a>(size))
<a name='L315'>        <b>return</b> 0;
<a name='L316'>    <b>if</b> (len % size != 0) <font color='red'>{</font>
<a name='L317'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(AudioopError, "not a whole number of frames");
<a name='L318'>        <b>return</b> 0;
<a name='L319'>    <font color='red'>}</font>
<a name='L320'>    <b>return</b> 1;
<a name='L321'><font color='red'>}</font>
<a name='L322'>
<a name='L323'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L324'><a href='../S/2624.html#L1633' title='Refered from 1633 in Modules/audioop.c.'>audioop_getsample</a>(PyObject *self, PyObject *args)
<a name='L325'><font color='red'>{</font>
<a name='L326'>    <b>signed</b> <b>char</b> *cp;
<a name='L327'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> len, i;
<a name='L328'>    <b>int</b> size, val = 0;
<a name='L329'>
<a name='L330'>    <b>if</b> ( !<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "s#in:getsample", &amp;cp, &amp;len, &amp;size, &amp;i) )
<a name='L331'>        <b>return</b> 0;
<a name='L332'>    <b>if</b> (!<a href='../S/2624.html#L312' title='Defined at 312 in Modules/audioop.c.'>audioop_check_parameters</a>(len, size))
<a name='L333'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L334'>    <b>if</b> ( i &lt; 0 || i &gt;= len/size ) <font color='red'>{</font>
<a name='L335'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(AudioopError, "Index out of range");
<a name='L336'>        <b>return</b> 0;
<a name='L337'>    <font color='red'>}</font>
<a name='L338'>    <b>if</b> ( size == 1 )      val = (<b>int</b>)*<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(cp, i);
<a name='L339'>    <b>else</b> <b>if</b> ( size == 2 ) val = (<b>int</b>)*<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(cp, i*2);
<a name='L340'>    <b>else</b> <b>if</b> ( size == 4 ) val = (<b>int</b>)*<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(cp, i*4);
<a name='L341'>    <b>return</b> <a href='../S/2799.html#L176' title='Defined at 176 in Objects/longobject.c.'>PyLong_FromLong</a>(val);
<a name='L342'><font color='red'>}</font>
<a name='L343'>
<a name='L344'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L345'><a href='../S/2624.html#L1611' title='Refered from 1611 in Modules/audioop.c.'>audioop_max</a>(PyObject *self, PyObject *args)
<a name='L346'><font color='red'>{</font>
<a name='L347'>    <b>signed</b> <b>char</b> *cp;
<a name='L348'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> len, i;
<a name='L349'>    <b>int</b> size, val = 0;
<a name='L350'>    <b>int</b> <a href='../S/2252.html#L6' title='Defined at 6 in Modules/_ctypes/ctypes.h.'>max</a> = 0;
<a name='L351'>
<a name='L352'>    <b>if</b> ( !<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "s#i:max", &amp;cp, &amp;len, &amp;size) )
<a name='L353'>        <b>return</b> 0;
<a name='L354'>    <b>if</b> (!<a href='../S/2624.html#L312' title='Defined at 312 in Modules/audioop.c.'>audioop_check_parameters</a>(len, size))
<a name='L355'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L356'>    <b>for</b> ( i=0; i&lt;len; i+= size) <font color='red'>{</font>
<a name='L357'>        <b>if</b> ( size == 1 )      val = (<b>int</b>)*<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(cp, i);
<a name='L358'>        <b>else</b> <b>if</b> ( size == 2 ) val = (<b>int</b>)*<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(cp, i);
<a name='L359'>        <b>else</b> <b>if</b> ( size == 4 ) val = (<b>int</b>)*<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(cp, i);
<a name='L360'>        <b>if</b> ( val &lt; 0 ) val = (-val);
<a name='L361'>        <b>if</b> ( val &gt; <a href='../S/2252.html#L6' title='Defined at 6 in Modules/_ctypes/ctypes.h.'>max</a> ) <a href='../S/2252.html#L6' title='Defined at 6 in Modules/_ctypes/ctypes.h.'>max</a> = val;
<a name='L362'>    <font color='red'>}</font>
<a name='L363'>    <b>return</b> <a href='../S/2799.html#L176' title='Defined at 176 in Objects/longobject.c.'>PyLong_FromLong</a>(<a href='../S/2252.html#L6' title='Defined at 6 in Modules/_ctypes/ctypes.h.'>max</a>);
<a name='L364'><font color='red'>}</font>
<a name='L365'>
<a name='L366'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L367'><a href='../S/2624.html#L1612' title='Refered from 1612 in Modules/audioop.c.'>audioop_minmax</a>(PyObject *self, PyObject *args)
<a name='L368'><font color='red'>{</font>
<a name='L369'>    <b>signed</b> <b>char</b> *cp;
<a name='L370'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> len, i;
<a name='L371'>    <b>int</b> size, val = 0;
<a name='L372'>    <b>int</b> <a href='../S/2252.html#L7' title='Defined at 7 in Modules/_ctypes/ctypes.h.'>min</a> = 0x7fffffff, <a href='../S/2252.html#L6' title='Defined at 6 in Modules/_ctypes/ctypes.h.'>max</a> = -0x7fffffff;
<a name='L373'>
<a name='L374'>    <b>if</b> (!<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "s#i:minmax", &amp;cp, &amp;len, &amp;size))
<a name='L375'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L376'>    <b>if</b> (!<a href='../S/2624.html#L312' title='Defined at 312 in Modules/audioop.c.'>audioop_check_parameters</a>(len, size))
<a name='L377'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L378'>    <b>for</b> (i = 0; i &lt; len; i += size) <font color='red'>{</font>
<a name='L379'>        <b>if</b> (size == 1) val = (<b>int</b>) *<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(cp, i);
<a name='L380'>        <b>else</b> <b>if</b> (size == 2) val = (<b>int</b>) *<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(cp, i);
<a name='L381'>        <b>else</b> <b>if</b> (size == 4) val = (<b>int</b>) *<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(cp, i);
<a name='L382'>        <b>if</b> (val &gt; <a href='../S/2252.html#L6' title='Defined at 6 in Modules/_ctypes/ctypes.h.'>max</a>) <a href='../S/2252.html#L6' title='Defined at 6 in Modules/_ctypes/ctypes.h.'>max</a> = val;
<a name='L383'>        <b>if</b> (val &lt; <a href='../S/2252.html#L7' title='Defined at 7 in Modules/_ctypes/ctypes.h.'>min</a>) <a href='../S/2252.html#L7' title='Defined at 7 in Modules/_ctypes/ctypes.h.'>min</a> = val;
<a name='L384'>    <font color='red'>}</font>
<a name='L385'>    <b>return</b> <a href='../D/4089.html' title='Multiple defined in 2 places.'>Py_BuildValue</a>("(ii)", <a href='../S/2252.html#L7' title='Defined at 7 in Modules/_ctypes/ctypes.h.'>min</a>, <a href='../S/2252.html#L6' title='Defined at 6 in Modules/_ctypes/ctypes.h.'>max</a>);
<a name='L386'><font color='red'>}</font>
<a name='L387'>
<a name='L388'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L389'><a href='../S/2624.html#L1613' title='Refered from 1613 in Modules/audioop.c.'>audioop_avg</a>(PyObject *self, PyObject *args)
<a name='L390'><font color='red'>{</font>
<a name='L391'>    <b>signed</b> <b>char</b> *cp;
<a name='L392'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> len, i;
<a name='L393'>    <b>int</b> size, val = 0;
<a name='L394'>    <b>double</b> avg = 0.0;
<a name='L395'>
<a name='L396'>    <b>if</b> ( !<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "s#i:avg", &amp;cp, &amp;len, &amp;size) )
<a name='L397'>        <b>return</b> 0;
<a name='L398'>    <b>if</b> (!<a href='../S/2624.html#L312' title='Defined at 312 in Modules/audioop.c.'>audioop_check_parameters</a>(len, size))
<a name='L399'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L400'>    <b>for</b> ( i=0; i&lt;len; i+= size) <font color='red'>{</font>
<a name='L401'>        <b>if</b> ( size == 1 )      val = (<b>int</b>)*<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(cp, i);
<a name='L402'>        <b>else</b> <b>if</b> ( size == 2 ) val = (<b>int</b>)*<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(cp, i);
<a name='L403'>        <b>else</b> <b>if</b> ( size == 4 ) val = (<b>int</b>)*<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(cp, i);
<a name='L404'>        avg += val;
<a name='L405'>    <font color='red'>}</font>
<a name='L406'>    <b>if</b> ( len == 0 )
<a name='L407'>        val = 0;
<a name='L408'>    <b>else</b>
<a name='L409'>        val = (<b>int</b>)(avg / (<b>double</b>)(len/size));
<a name='L410'>    <b>return</b> <a href='../S/2799.html#L176' title='Defined at 176 in Objects/longobject.c.'>PyLong_FromLong</a>(val);
<a name='L411'><font color='red'>}</font>
<a name='L412'>
<a name='L413'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L414'><a href='../S/2624.html#L1616' title='Refered from 1616 in Modules/audioop.c.'>audioop_rms</a>(PyObject *self, PyObject *args)
<a name='L415'><font color='red'>{</font>
<a name='L416'>    <b>signed</b> <b>char</b> *cp;
<a name='L417'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> len, i;
<a name='L418'>    <b>int</b> size, val = 0;
<a name='L419'>    <b>double</b> sum_squares = 0.0;
<a name='L420'>
<a name='L421'>    <b>if</b> ( !<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "s#i:rms", &amp;cp, &amp;len, &amp;size) )
<a name='L422'>        <b>return</b> 0;
<a name='L423'>    <b>if</b> (!<a href='../S/2624.html#L312' title='Defined at 312 in Modules/audioop.c.'>audioop_check_parameters</a>(len, size))
<a name='L424'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L425'>    <b>for</b> ( i=0; i&lt;len; i+= size) <font color='red'>{</font>
<a name='L426'>        <b>if</b> ( size == 1 )      val = (<b>int</b>)*<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(cp, i);
<a name='L427'>        <b>else</b> <b>if</b> ( size == 2 ) val = (<b>int</b>)*<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(cp, i);
<a name='L428'>        <b>else</b> <b>if</b> ( size == 4 ) val = (<b>int</b>)*<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(cp, i);
<a name='L429'>        sum_squares += (<b>double</b>)val*(<b>double</b>)val;
<a name='L430'>    <font color='red'>}</font>
<a name='L431'>    <b>if</b> ( len == 0 )
<a name='L432'>        val = 0;
<a name='L433'>    <b>else</b>
<a name='L434'>        val = (<b>int</b>)sqrt(sum_squares / (<b>double</b>)(len/size));
<a name='L435'>    <b>return</b> <a href='../S/2799.html#L176' title='Defined at 176 in Objects/longobject.c.'>PyLong_FromLong</a>(val);
<a name='L436'><font color='red'>}</font>
<a name='L437'>
<a name='L438'><b>static</b> <b>double</b> <a href='../R/5861.html' title='Multiple refered from 8 places.'>_sum2</a>(<b>short</b> *a, <b>short</b> *b, <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> len)
<a name='L439'><font color='red'>{</font>
<a name='L440'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> i;
<a name='L441'>    <b>double</b> sum = 0.0;
<a name='L442'>
<a name='L443'>    <b>for</b>( i=0; i&lt;len; i++) <font color='red'>{</font>
<a name='L444'>        sum = sum + (<b>double</b>)a[i]*(<b>double</b>)<a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a>[i];
<a name='L445'>    <font color='red'>}</font>
<a name='L446'>    <b>return</b> sum;
<a name='L447'><font color='red'>}</font>
<a name='L448'>
<a name='L449'><i><font color='green'>/*</font></i>
<a name='L450'><i><font color='green'>** Findfit tries to locate a sample within another sample. Its main use</font></i>
<a name='L451'><i><font color='green'>** is in echo-cancellation (to find the feedback of the output signal in</font></i>
<a name='L452'><i><font color='green'>** the input signal).</font></i>
<a name='L453'><i><font color='green'>** The method used is as follows:</font></i>
<a name='L454'><i><font color='green'>**</font></i>
<a name='L455'><i><font color='green'>** let R be the reference signal (length n) and A the input signal (length N)</font></i>
<a name='L456'><i><font color='green'>** with N &gt; n, and let all sums be over i from 0 to n-1.</font></i>
<a name='L457'><i><font color='green'>**</font></i>
<a name='L458'><i><font color='green'>** Now, for each j in {0..N-n} we compute a factor fj so that -fj*R matches A</font></i>
<a name='L459'><i><font color='green'>** as good as possible, i.e. sum( (A[j+i]+fj*R[i])^2 ) is minimal. This</font></i>
<a name='L460'><i><font color='green'>** equation gives fj = sum( A[j+i]R[i] ) / sum(R[i]^2).</font></i>
<a name='L461'><i><font color='green'>**</font></i>
<a name='L462'><i><font color='green'>** Next, we compute the relative distance between the original signal and</font></i>
<a name='L463'><i><font color='green'>** the modified signal and minimize that over j:</font></i>
<a name='L464'><i><font color='green'>** vj = sum( (A[j+i]-fj*R[i])^2 ) / sum( A[j+i]^2 )  =&gt;</font></i>
<a name='L465'><i><font color='green'>** vj = ( sum(A[j+i]^2)*sum(R[i]^2) - sum(A[j+i]R[i])^2 ) / sum( A[j+i]^2 )</font></i>
<a name='L466'><i><font color='green'>**</font></i>
<a name='L467'><i><font color='green'>** In the code variables correspond as follows:</font></i>
<a name='L468'><i><font color='green'>** cp1          A</font></i>
<a name='L469'><i><font color='green'>** cp2          R</font></i>
<a name='L470'><i><font color='green'>** len1         N</font></i>
<a name='L471'><i><font color='green'>** len2         n</font></i>
<a name='L472'><i><font color='green'>** aj_m1        A[j-1]</font></i>
<a name='L473'><i><font color='green'>** aj_lm1       A[j+n-1]</font></i>
<a name='L474'><i><font color='green'>** sum_ri_2     sum(R[i]^2)</font></i>
<a name='L475'><i><font color='green'>** sum_aij_2    sum(A[i+j]^2)</font></i>
<a name='L476'><i><font color='green'>** sum_aij_ri   sum(A[i+j]R[i])</font></i>
<a name='L477'><i><font color='green'>**</font></i>
<a name='L478'><i><font color='green'>** sum_ri is calculated once, sum_aij_2 is updated each step and sum_aij_ri</font></i>
<a name='L479'><i><font color='green'>** is completely recalculated each step.</font></i>
<a name='L480'><i><font color='green'>*/</font></i>
<a name='L481'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L482'><a href='../S/2624.html#L1617' title='Refered from 1617 in Modules/audioop.c.'>audioop_findfit</a>(PyObject *self, PyObject *args)
<a name='L483'><font color='red'>{</font>
<a name='L484'>    <b>short</b> *cp1, *cp2;
<a name='L485'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> len1, len2;
<a name='L486'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> j, best_j;
<a name='L487'>    <b>double</b> aj_m1, aj_lm1;
<a name='L488'>    <b>double</b> sum_ri_2, sum_aij_2, sum_aij_ri, <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>, best_result, <a href='../S/529.html#L65' title='Defined at 65 in Include/graminit.h.'>factor</a>;
<a name='L489'>
<a name='L490'>    <i><font color='green'>/* Passing a short** for an 's' argument is correct only</font></i>
<a name='L491'><i><font color='green'>       if the string contents is aligned for interpretation</font></i>
<a name='L492'><i><font color='green'>       as short[]. Due to the definition of PyBytesObject,</font></i>
<a name='L493'><i><font color='green'>       this is currently (Python 2.6) the case. */</font></i>
<a name='L494'>    <b>if</b> ( !<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "s#s#:findfit",
<a name='L495'>                           (<b>char</b>**)&amp;cp1, &amp;len1, (<b>char</b>**)&amp;cp2, &amp;len2) )
<a name='L496'>        <b>return</b> 0;
<a name='L497'>    <b>if</b> ( len1 &amp; 1 || len2 &amp; 1 ) <font color='red'>{</font>
<a name='L498'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(AudioopError, "Strings should be even-sized");
<a name='L499'>        <b>return</b> 0;
<a name='L500'>    <font color='red'>}</font>
<a name='L501'>    len1 &gt;&gt;= 1;
<a name='L502'>    len2 &gt;&gt;= 1;
<a name='L503'>
<a name='L504'>    <b>if</b> ( len1 &lt; len2 ) <font color='red'>{</font>
<a name='L505'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(AudioopError, "First sample should be longer");
<a name='L506'>        <b>return</b> 0;
<a name='L507'>    <font color='red'>}</font>
<a name='L508'>    sum_ri_2 = <a href='../S/2624.html#L438' title='Defined at 438 in Modules/audioop.c.'>_sum2</a>(cp2, cp2, len2);
<a name='L509'>    sum_aij_2 = <a href='../S/2624.html#L438' title='Defined at 438 in Modules/audioop.c.'>_sum2</a>(cp1, cp1, len2);
<a name='L510'>    sum_aij_ri = <a href='../S/2624.html#L438' title='Defined at 438 in Modules/audioop.c.'>_sum2</a>(cp1, cp2, len2);
<a name='L511'>
<a name='L512'>    <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = (sum_ri_2*sum_aij_2 - sum_aij_ri*sum_aij_ri) / sum_aij_2;
<a name='L513'>
<a name='L514'>    best_result = <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L515'>    best_j = 0;
<a name='L516'>    j = 0;
<a name='L517'>
<a name='L518'>    <b>for</b> ( j=1; j&lt;=len1-len2; j++) <font color='red'>{</font>
<a name='L519'>        aj_m1 = (<b>double</b>)cp1[j-1];
<a name='L520'>        aj_lm1 = (<b>double</b>)cp1[j+len2-1];
<a name='L521'>
<a name='L522'>        sum_aij_2 = sum_aij_2 + aj_lm1*aj_lm1 - aj_m1*aj_m1;
<a name='L523'>        sum_aij_ri = <a href='../S/2624.html#L438' title='Defined at 438 in Modules/audioop.c.'>_sum2</a>(cp1+j, cp2, len2);
<a name='L524'>
<a name='L525'>        <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = (sum_ri_2*sum_aij_2 - sum_aij_ri*sum_aij_ri)
<a name='L526'>            / sum_aij_2;
<a name='L527'>
<a name='L528'>        <b>if</b> ( <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> &lt; best_result ) <font color='red'>{</font>
<a name='L529'>            best_result = <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L530'>            best_j = j;
<a name='L531'>        <font color='red'>}</font>
<a name='L532'>
<a name='L533'>    <font color='red'>}</font>
<a name='L534'>
<a name='L535'>    <a href='../S/529.html#L65' title='Defined at 65 in Include/graminit.h.'>factor</a> = <a href='../S/2624.html#L438' title='Defined at 438 in Modules/audioop.c.'>_sum2</a>(cp1+best_j, cp2, len2) / sum_ri_2;
<a name='L536'>
<a name='L537'>    <b>return</b> <a href='../D/4089.html' title='Multiple defined in 2 places.'>Py_BuildValue</a>("(nf)", best_j, <a href='../S/529.html#L65' title='Defined at 65 in Include/graminit.h.'>factor</a>);
<a name='L538'><font color='red'>}</font>
<a name='L539'>
<a name='L540'><i><font color='green'>/*</font></i>
<a name='L541'><i><font color='green'>** findfactor finds a factor f so that the energy in A-fB is minimal.</font></i>
<a name='L542'><i><font color='green'>** See the comment for findfit for details.</font></i>
<a name='L543'><i><font color='green'>*/</font></i>
<a name='L544'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L545'><a href='../S/2624.html#L1619' title='Refered from 1619 in Modules/audioop.c.'>audioop_findfactor</a>(PyObject *self, PyObject *args)
<a name='L546'><font color='red'>{</font>
<a name='L547'>    <b>short</b> *cp1, *cp2;
<a name='L548'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> len1, len2;
<a name='L549'>    <b>double</b> sum_ri_2, sum_aij_ri, <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L550'>
<a name='L551'>    <b>if</b> ( !<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "s#s#:findfactor",
<a name='L552'>                           (<b>char</b>**)&amp;cp1, &amp;len1, (<b>char</b>**)&amp;cp2, &amp;len2) )
<a name='L553'>        <b>return</b> 0;
<a name='L554'>    <b>if</b> ( len1 &amp; 1 || len2 &amp; 1 ) <font color='red'>{</font>
<a name='L555'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(AudioopError, "Strings should be even-sized");
<a name='L556'>        <b>return</b> 0;
<a name='L557'>    <font color='red'>}</font>
<a name='L558'>    <b>if</b> ( len1 != len2 ) <font color='red'>{</font>
<a name='L559'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(AudioopError, "Samples should be same size");
<a name='L560'>        <b>return</b> 0;
<a name='L561'>    <font color='red'>}</font>
<a name='L562'>    len2 &gt;&gt;= 1;
<a name='L563'>    sum_ri_2 = <a href='../S/2624.html#L438' title='Defined at 438 in Modules/audioop.c.'>_sum2</a>(cp2, cp2, len2);
<a name='L564'>    sum_aij_ri = <a href='../S/2624.html#L438' title='Defined at 438 in Modules/audioop.c.'>_sum2</a>(cp1, cp2, len2);
<a name='L565'>
<a name='L566'>    <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = sum_aij_ri / sum_ri_2;
<a name='L567'>
<a name='L568'>    <b>return</b> <a href='../S/2791.html#L157' title='Defined at 157 in Objects/floatobject.c.'>PyFloat_FromDouble</a>(<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>);
<a name='L569'><font color='red'>}</font>
<a name='L570'>
<a name='L571'><i><font color='green'>/*</font></i>
<a name='L572'><i><font color='green'>** findmax returns the index of the n-sized segment of the input sample</font></i>
<a name='L573'><i><font color='green'>** that contains the most energy.</font></i>
<a name='L574'><i><font color='green'>*/</font></i>
<a name='L575'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L576'><a href='../S/2624.html#L1618' title='Refered from 1618 in Modules/audioop.c.'>audioop_findmax</a>(PyObject *self, PyObject *args)
<a name='L577'><font color='red'>{</font>
<a name='L578'>    <b>short</b> *cp1;
<a name='L579'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> len1, len2;
<a name='L580'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> j, best_j;
<a name='L581'>    <b>double</b> aj_m1, aj_lm1;
<a name='L582'>    <b>double</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>, best_result;
<a name='L583'>
<a name='L584'>    <b>if</b> ( !<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "s#n:findmax",
<a name='L585'>                           (<b>char</b>**)&amp;cp1, &amp;len1, &amp;len2) )
<a name='L586'>        <b>return</b> 0;
<a name='L587'>    <b>if</b> ( len1 &amp; 1 ) <font color='red'>{</font>
<a name='L588'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(AudioopError, "Strings should be even-sized");
<a name='L589'>        <b>return</b> 0;
<a name='L590'>    <font color='red'>}</font>
<a name='L591'>    len1 &gt;&gt;= 1;
<a name='L592'>
<a name='L593'>    <b>if</b> ( len2 &lt; 0 || len1 &lt; len2 ) <font color='red'>{</font>
<a name='L594'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(AudioopError, "Input sample should be longer");
<a name='L595'>        <b>return</b> 0;
<a name='L596'>    <font color='red'>}</font>
<a name='L597'>
<a name='L598'>    <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = <a href='../S/2624.html#L438' title='Defined at 438 in Modules/audioop.c.'>_sum2</a>(cp1, cp1, len2);
<a name='L599'>
<a name='L600'>    best_result = <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L601'>    best_j = 0;
<a name='L602'>    j = 0;
<a name='L603'>
<a name='L604'>    <b>for</b> ( j=1; j&lt;=len1-len2; j++) <font color='red'>{</font>
<a name='L605'>        aj_m1 = (<b>double</b>)cp1[j-1];
<a name='L606'>        aj_lm1 = (<b>double</b>)cp1[j+len2-1];
<a name='L607'>
<a name='L608'>        <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> + aj_lm1*aj_lm1 - aj_m1*aj_m1;
<a name='L609'>
<a name='L610'>        <b>if</b> ( <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> &gt; best_result ) <font color='red'>{</font>
<a name='L611'>            best_result = <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L612'>            best_j = j;
<a name='L613'>        <font color='red'>}</font>
<a name='L614'>
<a name='L615'>    <font color='red'>}</font>
<a name='L616'>
<a name='L617'>    <b>return</b> <a href='../D/3469.html' title='Multiple defined in 2 places.'>PyLong_FromSsize_t</a>(best_j);
<a name='L618'><font color='red'>}</font>
<a name='L619'>
<a name='L620'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L621'><a href='../S/2624.html#L1615' title='Refered from 1615 in Modules/audioop.c.'>audioop_avgpp</a>(PyObject *self, PyObject *args)
<a name='L622'><font color='red'>{</font>
<a name='L623'>    <b>signed</b> <b>char</b> *cp;
<a name='L624'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> len, i;
<a name='L625'>    <b>int</b> size, val = 0, prevval = 0, prevextremevalid = 0,
<a name='L626'>        prevextreme = 0;
<a name='L627'>    <b>double</b> avg = 0.0;
<a name='L628'>    <b>int</b> <a href='../S/3095.html#L906' title='Defined at 906 in Python/dtoa.c.'>diff</a>, prevdiff, extremediff, nextreme = 0;
<a name='L629'>
<a name='L630'>    <b>if</b> ( !<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "s#i:avgpp", &amp;cp, &amp;len, &amp;size) )
<a name='L631'>        <b>return</b> 0;
<a name='L632'>    <b>if</b> (!<a href='../S/2624.html#L312' title='Defined at 312 in Modules/audioop.c.'>audioop_check_parameters</a>(len, size))
<a name='L633'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L634'>    <i><font color='green'>/* Compute first delta value ahead. Also automatically makes us</font></i>
<a name='L635'><i><font color='green'>    ** skip the first extreme value</font></i>
<a name='L636'><i><font color='green'>    */</font></i>
<a name='L637'>    <b>if</b> ( size == 1 )      prevval = (<b>int</b>)*<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(cp, 0);
<a name='L638'>    <b>else</b> <b>if</b> ( size == 2 ) prevval = (<b>int</b>)*<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(cp, 0);
<a name='L639'>    <b>else</b> <b>if</b> ( size == 4 ) prevval = (<b>int</b>)*<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(cp, 0);
<a name='L640'>    <b>if</b> ( size == 1 )      val = (<b>int</b>)*<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(cp, size);
<a name='L641'>    <b>else</b> <b>if</b> ( size == 2 ) val = (<b>int</b>)*<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(cp, size);
<a name='L642'>    <b>else</b> <b>if</b> ( size == 4 ) val = (<b>int</b>)*<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(cp, size);
<a name='L643'>    prevdiff = val - prevval;
<a name='L644'>
<a name='L645'>    <b>for</b> ( i=size; i&lt;len; i+= size) <font color='red'>{</font>
<a name='L646'>        <b>if</b> ( size == 1 )      val = (<b>int</b>)*<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(cp, i);
<a name='L647'>        <b>else</b> <b>if</b> ( size == 2 ) val = (<b>int</b>)*<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(cp, i);
<a name='L648'>        <b>else</b> <b>if</b> ( size == 4 ) val = (<b>int</b>)*<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(cp, i);
<a name='L649'>        <a href='../S/3095.html#L906' title='Defined at 906 in Python/dtoa.c.'>diff</a> = val - prevval;
<a name='L650'>        <b>if</b> ( <a href='../S/3095.html#L906' title='Defined at 906 in Python/dtoa.c.'>diff</a>*prevdiff &lt; 0 ) <font color='red'>{</font>
<a name='L651'>            <i><font color='green'>/* Derivative changed sign. Compute difference to last</font></i>
<a name='L652'><i><font color='green'>            ** extreme value and remember.</font></i>
<a name='L653'><i><font color='green'>            */</font></i>
<a name='L654'>            <b>if</b> ( prevextremevalid ) <font color='red'>{</font>
<a name='L655'>                extremediff = prevval - prevextreme;
<a name='L656'>                <b>if</b> ( extremediff &lt; 0 )
<a name='L657'>                    extremediff = -extremediff;
<a name='L658'>                avg += extremediff;
<a name='L659'>                nextreme++;
<a name='L660'>            <font color='red'>}</font>
<a name='L661'>            prevextremevalid = 1;
<a name='L662'>            prevextreme = prevval;
<a name='L663'>        <font color='red'>}</font>
<a name='L664'>        prevval = val;
<a name='L665'>        <b>if</b> ( <a href='../S/3095.html#L906' title='Defined at 906 in Python/dtoa.c.'>diff</a> != 0 )
<a name='L666'>            prevdiff = <a href='../S/3095.html#L906' title='Defined at 906 in Python/dtoa.c.'>diff</a>;
<a name='L667'>    <font color='red'>}</font>
<a name='L668'>    <b>if</b> ( nextreme == 0 )
<a name='L669'>        val = 0;
<a name='L670'>    <b>else</b>
<a name='L671'>        val = (<b>int</b>)(avg / (<b>double</b>)nextreme);
<a name='L672'>    <b>return</b> <a href='../S/2799.html#L176' title='Defined at 176 in Objects/longobject.c.'>PyLong_FromLong</a>(val);
<a name='L673'><font color='red'>}</font>
<a name='L674'>
<a name='L675'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L676'><a href='../S/2624.html#L1614' title='Refered from 1614 in Modules/audioop.c.'>audioop_maxpp</a>(PyObject *self, PyObject *args)
<a name='L677'><font color='red'>{</font>
<a name='L678'>    <b>signed</b> <b>char</b> *cp;
<a name='L679'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> len, i;
<a name='L680'>    <b>int</b> size, val = 0, prevval = 0, prevextremevalid = 0,
<a name='L681'>        prevextreme = 0;
<a name='L682'>    <b>int</b> <a href='../S/2252.html#L6' title='Defined at 6 in Modules/_ctypes/ctypes.h.'>max</a> = 0;
<a name='L683'>    <b>int</b> <a href='../S/3095.html#L906' title='Defined at 906 in Python/dtoa.c.'>diff</a>, prevdiff, extremediff;
<a name='L684'>
<a name='L685'>    <b>if</b> ( !<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "s#i:maxpp", &amp;cp, &amp;len, &amp;size) )
<a name='L686'>        <b>return</b> 0;
<a name='L687'>    <b>if</b> (!<a href='../S/2624.html#L312' title='Defined at 312 in Modules/audioop.c.'>audioop_check_parameters</a>(len, size))
<a name='L688'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L689'>    <i><font color='green'>/* Compute first delta value ahead. Also automatically makes us</font></i>
<a name='L690'><i><font color='green'>    ** skip the first extreme value</font></i>
<a name='L691'><i><font color='green'>    */</font></i>
<a name='L692'>    <b>if</b> ( size == 1 )      prevval = (<b>int</b>)*<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(cp, 0);
<a name='L693'>    <b>else</b> <b>if</b> ( size == 2 ) prevval = (<b>int</b>)*<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(cp, 0);
<a name='L694'>    <b>else</b> <b>if</b> ( size == 4 ) prevval = (<b>int</b>)*<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(cp, 0);
<a name='L695'>    <b>if</b> ( size == 1 )      val = (<b>int</b>)*<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(cp, size);
<a name='L696'>    <b>else</b> <b>if</b> ( size == 2 ) val = (<b>int</b>)*<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(cp, size);
<a name='L697'>    <b>else</b> <b>if</b> ( size == 4 ) val = (<b>int</b>)*<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(cp, size);
<a name='L698'>    prevdiff = val - prevval;
<a name='L699'>
<a name='L700'>    <b>for</b> ( i=size; i&lt;len; i+= size) <font color='red'>{</font>
<a name='L701'>        <b>if</b> ( size == 1 )      val = (<b>int</b>)*<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(cp, i);
<a name='L702'>        <b>else</b> <b>if</b> ( size == 2 ) val = (<b>int</b>)*<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(cp, i);
<a name='L703'>        <b>else</b> <b>if</b> ( size == 4 ) val = (<b>int</b>)*<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(cp, i);
<a name='L704'>        <a href='../S/3095.html#L906' title='Defined at 906 in Python/dtoa.c.'>diff</a> = val - prevval;
<a name='L705'>        <b>if</b> ( <a href='../S/3095.html#L906' title='Defined at 906 in Python/dtoa.c.'>diff</a>*prevdiff &lt; 0 ) <font color='red'>{</font>
<a name='L706'>            <i><font color='green'>/* Derivative changed sign. Compute difference to</font></i>
<a name='L707'><i><font color='green'>            ** last extreme value and remember.</font></i>
<a name='L708'><i><font color='green'>            */</font></i>
<a name='L709'>            <b>if</b> ( prevextremevalid ) <font color='red'>{</font>
<a name='L710'>                extremediff = prevval - prevextreme;
<a name='L711'>                <b>if</b> ( extremediff &lt; 0 )
<a name='L712'>                    extremediff = -extremediff;
<a name='L713'>                <b>if</b> ( extremediff &gt; <a href='../S/2252.html#L6' title='Defined at 6 in Modules/_ctypes/ctypes.h.'>max</a> )
<a name='L714'>                    <a href='../S/2252.html#L6' title='Defined at 6 in Modules/_ctypes/ctypes.h.'>max</a> = extremediff;
<a name='L715'>            <font color='red'>}</font>
<a name='L716'>            prevextremevalid = 1;
<a name='L717'>            prevextreme = prevval;
<a name='L718'>        <font color='red'>}</font>
<a name='L719'>        prevval = val;
<a name='L720'>        <b>if</b> ( <a href='../S/3095.html#L906' title='Defined at 906 in Python/dtoa.c.'>diff</a> != 0 )
<a name='L721'>            prevdiff = <a href='../S/3095.html#L906' title='Defined at 906 in Python/dtoa.c.'>diff</a>;
<a name='L722'>    <font color='red'>}</font>
<a name='L723'>    <b>return</b> <a href='../S/2799.html#L176' title='Defined at 176 in Objects/longobject.c.'>PyLong_FromLong</a>(<a href='../S/2252.html#L6' title='Defined at 6 in Modules/_ctypes/ctypes.h.'>max</a>);
<a name='L724'><font color='red'>}</font>
<a name='L725'>
<a name='L726'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L727'><a href='../S/2624.html#L1620' title='Refered from 1620 in Modules/audioop.c.'>audioop_cross</a>(PyObject *self, PyObject *args)
<a name='L728'><font color='red'>{</font>
<a name='L729'>    <b>signed</b> <b>char</b> *cp;
<a name='L730'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> len, i;
<a name='L731'>    <b>int</b> size, val = 0;
<a name='L732'>    <b>int</b> prevval;
<a name='L733'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> ncross;
<a name='L734'>
<a name='L735'>    <b>if</b> ( !<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "s#i:cross", &amp;cp, &amp;len, &amp;size) )
<a name='L736'>        <b>return</b> 0;
<a name='L737'>    <b>if</b> (!<a href='../S/2624.html#L312' title='Defined at 312 in Modules/audioop.c.'>audioop_check_parameters</a>(len, size))
<a name='L738'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L739'>    ncross = -1;
<a name='L740'>    prevval = 17; <i><font color='green'>/* Anything &lt;&gt; 0,1 */</font></i>
<a name='L741'>    <b>for</b> ( i=0; i&lt;len; i+= size) <font color='red'>{</font>
<a name='L742'>        <b>if</b> ( size == 1 )      val = ((<b>int</b>)*<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(cp, i)) &gt;&gt; 7;
<a name='L743'>        <b>else</b> <b>if</b> ( size == 2 ) val = ((<b>int</b>)*<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(cp, i)) &gt;&gt; 15;
<a name='L744'>        <b>else</b> <b>if</b> ( size == 4 ) val = ((<b>int</b>)*<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(cp, i)) &gt;&gt; 31;
<a name='L745'>        val = val &amp; 1;
<a name='L746'>        <b>if</b> ( val != prevval ) ncross++;
<a name='L747'>        prevval = val;
<a name='L748'>    <font color='red'>}</font>
<a name='L749'>    <b>return</b> <a href='../D/3469.html' title='Multiple defined in 2 places.'>PyLong_FromSsize_t</a>(ncross);
<a name='L750'><font color='red'>}</font>
<a name='L751'>
<a name='L752'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L753'><a href='../S/2624.html#L1621' title='Refered from 1621 in Modules/audioop.c.'>audioop_mul</a>(PyObject *self, PyObject *args)
<a name='L754'><font color='red'>{</font>
<a name='L755'>    <b>signed</b> <b>char</b> *cp, *ncp;
<a name='L756'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> len, i;
<a name='L757'>    <b>int</b> size, val = 0;
<a name='L758'>    <b>double</b> <a href='../S/529.html#L65' title='Defined at 65 in Include/graminit.h.'>factor</a>, fval, maxval;
<a name='L759'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *rv;
<a name='L760'>
<a name='L761'>    <b>if</b> ( !<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "s#id:mul", &amp;cp, &amp;len, &amp;size, &amp;<a href='../S/529.html#L65' title='Defined at 65 in Include/graminit.h.'>factor</a> ) )
<a name='L762'>        <b>return</b> 0;
<a name='L763'>    <b>if</b> (!<a href='../S/2624.html#L312' title='Defined at 312 in Modules/audioop.c.'>audioop_check_parameters</a>(len, size))
<a name='L764'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L765'>
<a name='L766'>    <b>if</b> ( size == 1 ) maxval = (<b>double</b>) 0x7f;
<a name='L767'>    <b>else</b> <b>if</b> ( size == 2 ) maxval = (<b>double</b>) 0x7fff;
<a name='L768'>    <b>else</b> <b>if</b> ( size == 4 ) maxval = (<b>double</b>) 0x7fffffff;
<a name='L769'>    <b>else</b> <font color='red'>{</font>
<a name='L770'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(AudioopError, "Size should be 1, 2 or 4");
<a name='L771'>        <b>return</b> 0;
<a name='L772'>    <font color='red'>}</font>
<a name='L773'>
<a name='L774'>    rv = <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, len);
<a name='L775'>    <b>if</b> ( rv == 0 )
<a name='L776'>        <b>return</b> 0;
<a name='L777'>    ncp = (<b>signed</b> <b>char</b> *)<a href='../S/2779.html#L517' title='Defined at 517 in Objects/bytesobject.c.'>PyBytes_AsString</a>(rv);
<a name='L778'>
<a name='L779'>
<a name='L780'>    <b>for</b> ( i=0; i &lt; len; i += size ) <font color='red'>{</font>
<a name='L781'>        <b>if</b> ( size == 1 )      val = (<b>int</b>)*<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(cp, i);
<a name='L782'>        <b>else</b> <b>if</b> ( size == 2 ) val = (<b>int</b>)*<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(cp, i);
<a name='L783'>        <b>else</b> <b>if</b> ( size == 4 ) val = (<b>int</b>)*<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(cp, i);
<a name='L784'>        fval = (<b>double</b>)val*<a href='../S/529.html#L65' title='Defined at 65 in Include/graminit.h.'>factor</a>;
<a name='L785'>        <b>if</b> ( fval &gt; maxval ) fval = maxval;
<a name='L786'>        <b>else</b> <b>if</b> ( fval &lt; -maxval ) fval = -maxval;
<a name='L787'>        val = (<b>int</b>)fval;
<a name='L788'>        <b>if</b> ( size == 1 )      *<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(ncp, i) = (<b>signed</b> <b>char</b>)val;
<a name='L789'>        <b>else</b> <b>if</b> ( size == 2 ) *<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(ncp, i) = (<b>short</b>)val;
<a name='L790'>        <b>else</b> <b>if</b> ( size == 4 ) *<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(ncp, i) = (<a href='../D/4171.html' title='Multiple defined in 2 places.'>Py_Int32</a>)val;
<a name='L791'>    <font color='red'>}</font>
<a name='L792'>    <b>return</b> rv;
<a name='L793'><font color='red'>}</font>
<a name='L794'>
<a name='L795'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L796'><a href='../S/2624.html#L1631' title='Refered from 1631 in Modules/audioop.c.'>audioop_tomono</a>(PyObject *self, PyObject *args)
<a name='L797'><font color='red'>{</font>
<a name='L798'>    <a href='../S/544.html#L163' title='Defined at 163 in Include/object.h.'>Py_buffer</a> pcp;
<a name='L799'>    <b>signed</b> <b>char</b> *cp, *ncp;
<a name='L800'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> len, i;
<a name='L801'>    <b>int</b> size, val1 = 0, val2 = 0;
<a name='L802'>    <b>double</b> fac1, fac2, fval, maxval;
<a name='L803'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *rv;
<a name='L804'>
<a name='L805'>    <b>if</b> ( !<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "s*idd:tomono",
<a name='L806'>                           &amp;pcp, &amp;size, &amp;fac1, &amp;fac2 ) )
<a name='L807'>        <b>return</b> 0;
<a name='L808'>    cp = pcp.buf;
<a name='L809'>    len = pcp.len;
<a name='L810'>    <b>if</b> (!<a href='../S/2624.html#L312' title='Defined at 312 in Modules/audioop.c.'>audioop_check_parameters</a>(len, size)) <font color='red'>{</font>
<a name='L811'>        <a href='../S/2775.html#L684' title='Defined at 684 in Objects/abstract.c.'>PyBuffer_Release</a>(&amp;pcp);
<a name='L812'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L813'>    <font color='red'>}</font>
<a name='L814'>    <b>if</b> (((len / size) &amp; 1) != 0) <font color='red'>{</font>
<a name='L815'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(AudioopError, "not a whole number of frames");
<a name='L816'>        <a href='../S/2775.html#L684' title='Defined at 684 in Objects/abstract.c.'>PyBuffer_Release</a>(&amp;pcp);
<a name='L817'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L818'>    <font color='red'>}</font>
<a name='L819'>
<a name='L820'>    <b>if</b> ( size == 1 ) maxval = (<b>double</b>) 0x7f;
<a name='L821'>    <b>else</b> <b>if</b> ( size == 2 ) maxval = (<b>double</b>) 0x7fff;
<a name='L822'>    <b>else</b> <b>if</b> ( size == 4 ) maxval = (<b>double</b>) 0x7fffffff;
<a name='L823'>    <b>else</b> <font color='red'>{</font>
<a name='L824'>        <a href='../S/2775.html#L684' title='Defined at 684 in Objects/abstract.c.'>PyBuffer_Release</a>(&amp;pcp);
<a name='L825'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(AudioopError, "Size should be 1, 2 or 4");
<a name='L826'>        <b>return</b> 0;
<a name='L827'>    <font color='red'>}</font>
<a name='L828'>
<a name='L829'>    rv = <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, len/2);
<a name='L830'>    <b>if</b> ( rv == 0 ) <font color='red'>{</font>
<a name='L831'>        <a href='../S/2775.html#L684' title='Defined at 684 in Objects/abstract.c.'>PyBuffer_Release</a>(&amp;pcp);
<a name='L832'>        <b>return</b> 0;
<a name='L833'>    <font color='red'>}</font>
<a name='L834'>    ncp = (<b>signed</b> <b>char</b> *)<a href='../S/2779.html#L517' title='Defined at 517 in Objects/bytesobject.c.'>PyBytes_AsString</a>(rv);
<a name='L835'>
<a name='L836'>
<a name='L837'>    <b>for</b> ( i=0; i &lt; len; i += size*2 ) <font color='red'>{</font>
<a name='L838'>        <b>if</b> ( size == 1 )      val1 = (<b>int</b>)*<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(cp, i);
<a name='L839'>        <b>else</b> <b>if</b> ( size == 2 ) val1 = (<b>int</b>)*<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(cp, i);
<a name='L840'>        <b>else</b> <b>if</b> ( size == 4 ) val1 = (<b>int</b>)*<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(cp, i);
<a name='L841'>        <b>if</b> ( size == 1 )      val2 = (<b>int</b>)*<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(cp, i+1);
<a name='L842'>        <b>else</b> <b>if</b> ( size == 2 ) val2 = (<b>int</b>)*<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(cp, i+2);
<a name='L843'>        <b>else</b> <b>if</b> ( size == 4 ) val2 = (<b>int</b>)*<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(cp, i+4);
<a name='L844'>        fval = (<b>double</b>)val1*fac1 + (<b>double</b>)val2*fac2;
<a name='L845'>        <b>if</b> ( fval &gt; maxval ) fval = maxval;
<a name='L846'>        <b>else</b> <b>if</b> ( fval &lt; -maxval ) fval = -maxval;
<a name='L847'>        val1 = (<b>int</b>)fval;
<a name='L848'>        <b>if</b> ( size == 1 )      *<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(ncp, i/2) = (<b>signed</b> <b>char</b>)val1;
<a name='L849'>        <b>else</b> <b>if</b> ( size == 2 ) *<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(ncp, i/2) = (<b>short</b>)val1;
<a name='L850'>        <b>else</b> <b>if</b> ( size == 4 ) *<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(ncp, i/2)= (<a href='../D/4171.html' title='Multiple defined in 2 places.'>Py_Int32</a>)val1;
<a name='L851'>    <font color='red'>}</font>
<a name='L852'>    <a href='../S/2775.html#L684' title='Defined at 684 in Objects/abstract.c.'>PyBuffer_Release</a>(&amp;pcp);
<a name='L853'>    <b>return</b> rv;
<a name='L854'><font color='red'>}</font>
<a name='L855'>
<a name='L856'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L857'><a href='../S/2624.html#L1632' title='Refered from 1632 in Modules/audioop.c.'>audioop_tostereo</a>(PyObject *self, PyObject *args)
<a name='L858'><font color='red'>{</font>
<a name='L859'>    <b>signed</b> <b>char</b> *cp, *ncp;
<a name='L860'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> len, i;
<a name='L861'>    <b>int</b> size, val1, val2, val = 0;
<a name='L862'>    <b>double</b> fac1, fac2, fval, maxval;
<a name='L863'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *rv;
<a name='L864'>
<a name='L865'>    <b>if</b> ( !<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "s#idd:tostereo",
<a name='L866'>                           &amp;cp, &amp;len, &amp;size, &amp;fac1, &amp;fac2 ) )
<a name='L867'>        <b>return</b> 0;
<a name='L868'>    <b>if</b> (!<a href='../S/2624.html#L312' title='Defined at 312 in Modules/audioop.c.'>audioop_check_parameters</a>(len, size))
<a name='L869'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L870'>
<a name='L871'>    <b>if</b> ( size == 1 ) maxval = (<b>double</b>) 0x7f;
<a name='L872'>    <b>else</b> <b>if</b> ( size == 2 ) maxval = (<b>double</b>) 0x7fff;
<a name='L873'>    <b>else</b> <b>if</b> ( size == 4 ) maxval = (<b>double</b>) 0x7fffffff;
<a name='L874'>    <b>else</b> <font color='red'>{</font>
<a name='L875'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(AudioopError, "Size should be 1, 2 or 4");
<a name='L876'>        <b>return</b> 0;
<a name='L877'>    <font color='red'>}</font>
<a name='L878'>
<a name='L879'>    <b>if</b> (len &gt; <a href='../D/2625.html' title='Multiple defined in 3 places.'>PY_SSIZE_T_MAX</a>/2) <font color='red'>{</font>
<a name='L880'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_MemoryError,
<a name='L881'>                        "not enough memory for output buffer");
<a name='L882'>        <b>return</b> 0;
<a name='L883'>    <font color='red'>}</font>
<a name='L884'>
<a name='L885'>    rv = <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, len*2);
<a name='L886'>    <b>if</b> ( rv == 0 )
<a name='L887'>        <b>return</b> 0;
<a name='L888'>    ncp = (<b>signed</b> <b>char</b> *)<a href='../S/2779.html#L517' title='Defined at 517 in Objects/bytesobject.c.'>PyBytes_AsString</a>(rv);
<a name='L889'>
<a name='L890'>
<a name='L891'>    <b>for</b> ( i=0; i &lt; len; i += size ) <font color='red'>{</font>
<a name='L892'>        <b>if</b> ( size == 1 )      val = (<b>int</b>)*<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(cp, i);
<a name='L893'>        <b>else</b> <b>if</b> ( size == 2 ) val = (<b>int</b>)*<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(cp, i);
<a name='L894'>        <b>else</b> <b>if</b> ( size == 4 ) val = (<b>int</b>)*<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(cp, i);
<a name='L895'>
<a name='L896'>        fval = (<b>double</b>)val*fac1;
<a name='L897'>        <b>if</b> ( fval &gt; maxval ) fval = maxval;
<a name='L898'>        <b>else</b> <b>if</b> ( fval &lt; -maxval ) fval = -maxval;
<a name='L899'>        val1 = (<b>int</b>)fval;
<a name='L900'>
<a name='L901'>        fval = (<b>double</b>)val*fac2;
<a name='L902'>        <b>if</b> ( fval &gt; maxval ) fval = maxval;
<a name='L903'>        <b>else</b> <b>if</b> ( fval &lt; -maxval ) fval = -maxval;
<a name='L904'>        val2 = (<b>int</b>)fval;
<a name='L905'>
<a name='L906'>        <b>if</b> ( size == 1 )      *<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(ncp, i*2) = (<b>signed</b> <b>char</b>)val1;
<a name='L907'>        <b>else</b> <b>if</b> ( size == 2 ) *<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(ncp, i*2) = (<b>short</b>)val1;
<a name='L908'>        <b>else</b> <b>if</b> ( size == 4 ) *<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(ncp, i*2) = (<a href='../D/4171.html' title='Multiple defined in 2 places.'>Py_Int32</a>)val1;
<a name='L909'>
<a name='L910'>        <b>if</b> ( size == 1 )      *<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(ncp, i*2+1) = (<b>signed</b> <b>char</b>)val2;
<a name='L911'>        <b>else</b> <b>if</b> ( size == 2 ) *<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(ncp, i*2+2) = (<b>short</b>)val2;
<a name='L912'>        <b>else</b> <b>if</b> ( size == 4 ) *<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(ncp, i*2+4) = (<a href='../D/4171.html' title='Multiple defined in 2 places.'>Py_Int32</a>)val2;
<a name='L913'>    <font color='red'>}</font>
<a name='L914'>    <b>return</b> rv;
<a name='L915'><font color='red'>}</font>
<a name='L916'>
<a name='L917'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L918'><a href='../S/2624.html#L1622' title='Refered from 1622 in Modules/audioop.c.'>audioop_add</a>(PyObject *self, PyObject *args)
<a name='L919'><font color='red'>{</font>
<a name='L920'>    <b>signed</b> <b>char</b> *cp1, *cp2, *ncp;
<a name='L921'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> len1, len2, i;
<a name='L922'>    <b>int</b> size, val1 = 0, val2 = 0, maxval, newval;
<a name='L923'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *rv;
<a name='L924'>
<a name='L925'>    <b>if</b> ( !<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "s#s#i:add",
<a name='L926'>                      &amp;cp1, &amp;len1, &amp;cp2, &amp;len2, &amp;size ) )
<a name='L927'>        <b>return</b> 0;
<a name='L928'>    <b>if</b> (!<a href='../S/2624.html#L312' title='Defined at 312 in Modules/audioop.c.'>audioop_check_parameters</a>(len1, size))
<a name='L929'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L930'>    <b>if</b> ( len1 != len2 ) <font color='red'>{</font>
<a name='L931'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(AudioopError, "Lengths should be the same");
<a name='L932'>        <b>return</b> 0;
<a name='L933'>    <font color='red'>}</font>
<a name='L934'>
<a name='L935'>    <b>if</b> ( size == 1 ) maxval = 0x7f;
<a name='L936'>    <b>else</b> <b>if</b> ( size == 2 ) maxval = 0x7fff;
<a name='L937'>    <b>else</b> <b>if</b> ( size == 4 ) maxval = 0x7fffffff;
<a name='L938'>    <b>else</b> <font color='red'>{</font>
<a name='L939'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(AudioopError, "Size should be 1, 2 or 4");
<a name='L940'>        <b>return</b> 0;
<a name='L941'>    <font color='red'>}</font>
<a name='L942'>
<a name='L943'>    rv = <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, len1);
<a name='L944'>    <b>if</b> ( rv == 0 )
<a name='L945'>        <b>return</b> 0;
<a name='L946'>    ncp = (<b>signed</b> <b>char</b> *)<a href='../S/2779.html#L517' title='Defined at 517 in Objects/bytesobject.c.'>PyBytes_AsString</a>(rv);
<a name='L947'>
<a name='L948'>    <b>for</b> ( i=0; i &lt; len1; i += size ) <font color='red'>{</font>
<a name='L949'>        <b>if</b> ( size == 1 )      val1 = (<b>int</b>)*<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(cp1, i);
<a name='L950'>        <b>else</b> <b>if</b> ( size == 2 ) val1 = (<b>int</b>)*<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(cp1, i);
<a name='L951'>        <b>else</b> <b>if</b> ( size == 4 ) val1 = (<b>int</b>)*<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(cp1, i);
<a name='L952'>
<a name='L953'>        <b>if</b> ( size == 1 )      val2 = (<b>int</b>)*<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(cp2, i);
<a name='L954'>        <b>else</b> <b>if</b> ( size == 2 ) val2 = (<b>int</b>)*<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(cp2, i);
<a name='L955'>        <b>else</b> <b>if</b> ( size == 4 ) val2 = (<b>int</b>)*<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(cp2, i);
<a name='L956'>
<a name='L957'>        newval = val1 + val2;
<a name='L958'>        <i><font color='green'>/* truncate in case of overflow */</font></i>
<a name='L959'>        <b>if</b> (newval &gt; maxval) newval = maxval;
<a name='L960'>        <b>else</b> <b>if</b> (newval &lt; -maxval) newval = -maxval;
<a name='L961'>        <b>else</b> <b>if</b> (size == 4 &amp;&amp; (newval^val1) &lt; 0 &amp;&amp; (newval^val2) &lt; 0)
<a name='L962'>            newval = val1 &gt; 0 ? maxval : - maxval;
<a name='L963'>
<a name='L964'>        <b>if</b> ( size == 1 )      *<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(ncp, i) = (<b>signed</b> <b>char</b>)newval;
<a name='L965'>        <b>else</b> <b>if</b> ( size == 2 ) *<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(ncp, i) = (<b>short</b>)newval;
<a name='L966'>        <b>else</b> <b>if</b> ( size == 4 ) *<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(ncp, i) = (<a href='../D/4171.html' title='Multiple defined in 2 places.'>Py_Int32</a>)newval;
<a name='L967'>    <font color='red'>}</font>
<a name='L968'>    <b>return</b> rv;
<a name='L969'><font color='red'>}</font>
<a name='L970'>
<a name='L971'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L972'><a href='../S/2624.html#L1623' title='Refered from 1623 in Modules/audioop.c.'>audioop_bias</a>(PyObject *self, PyObject *args)
<a name='L973'><font color='red'>{</font>
<a name='L974'>    <b>signed</b> <b>char</b> *cp, *ncp;
<a name='L975'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> len, i;
<a name='L976'>    <b>int</b> size, val = 0;
<a name='L977'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *rv;
<a name='L978'>    <b>int</b> bias;
<a name='L979'>
<a name='L980'>    <b>if</b> ( !<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "s#ii:bias",
<a name='L981'>                      &amp;cp, &amp;len, &amp;size , &amp;bias) )
<a name='L982'>        <b>return</b> 0;
<a name='L983'>
<a name='L984'>    <b>if</b> (!<a href='../S/2624.html#L312' title='Defined at 312 in Modules/audioop.c.'>audioop_check_parameters</a>(len, size))
<a name='L985'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L986'>
<a name='L987'>    rv = <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, len);
<a name='L988'>    <b>if</b> ( rv == 0 )
<a name='L989'>        <b>return</b> 0;
<a name='L990'>    ncp = (<b>signed</b> <b>char</b> *)<a href='../S/2779.html#L517' title='Defined at 517 in Objects/bytesobject.c.'>PyBytes_AsString</a>(rv);
<a name='L991'>
<a name='L992'>
<a name='L993'>    <b>for</b> ( i=0; i &lt; len; i += size ) <font color='red'>{</font>
<a name='L994'>        <b>if</b> ( size == 1 )      val = (<b>int</b>)*<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(cp, i);
<a name='L995'>        <b>else</b> <b>if</b> ( size == 2 ) val = (<b>int</b>)*<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(cp, i);
<a name='L996'>        <b>else</b> <b>if</b> ( size == 4 ) val = (<b>int</b>)*<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(cp, i);
<a name='L997'>
<a name='L998'>        <b>if</b> ( size == 1 )      *<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(ncp, i) = (<b>signed</b> <b>char</b>)(val+bias);
<a name='L999'>        <b>else</b> <b>if</b> ( size == 2 ) *<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(ncp, i) = (<b>short</b>)(val+bias);
<a name='L1000'>        <b>else</b> <b>if</b> ( size == 4 ) *<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(ncp, i) = (<a href='../D/4171.html' title='Multiple defined in 2 places.'>Py_Int32</a>)(val+bias);
<a name='L1001'>    <font color='red'>}</font>
<a name='L1002'>    <b>return</b> rv;
<a name='L1003'><font color='red'>}</font>
<a name='L1004'>
<a name='L1005'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1006'><a href='../S/2624.html#L1634' title='Refered from 1634 in Modules/audioop.c.'>audioop_reverse</a>(PyObject *self, PyObject *args)
<a name='L1007'><font color='red'>{</font>
<a name='L1008'>    <b>signed</b> <b>char</b> *cp;
<a name='L1009'>    <b>unsigned</b> <b>char</b> *ncp;
<a name='L1010'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> len, i, j;
<a name='L1011'>    <b>int</b> size, val = 0;
<a name='L1012'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *rv;
<a name='L1013'>
<a name='L1014'>    <b>if</b> ( !<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "s#i:reverse",
<a name='L1015'>                      &amp;cp, &amp;len, &amp;size) )
<a name='L1016'>        <b>return</b> 0;
<a name='L1017'>
<a name='L1018'>    <b>if</b> (!<a href='../S/2624.html#L312' title='Defined at 312 in Modules/audioop.c.'>audioop_check_parameters</a>(len, size))
<a name='L1019'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1020'>
<a name='L1021'>    rv = <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, len);
<a name='L1022'>    <b>if</b> ( rv == 0 )
<a name='L1023'>        <b>return</b> 0;
<a name='L1024'>    ncp = (<b>unsigned</b> <b>char</b> *)<a href='../S/2779.html#L517' title='Defined at 517 in Objects/bytesobject.c.'>PyBytes_AsString</a>(rv);
<a name='L1025'>
<a name='L1026'>    <b>for</b> ( i=0; i &lt; len; i += size ) <font color='red'>{</font>
<a name='L1027'>        <b>if</b> ( size == 1 )      val = ((<b>int</b>)*<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(cp, i)) &lt;&lt; 8;
<a name='L1028'>        <b>else</b> <b>if</b> ( size == 2 ) val = (<b>int</b>)*<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(cp, i);
<a name='L1029'>        <b>else</b> <b>if</b> ( size == 4 ) val = ((<b>int</b>)*<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(cp, i)) &gt;&gt; 16;
<a name='L1030'>
<a name='L1031'>        j = len - i - size;
<a name='L1032'>
<a name='L1033'>        <b>if</b> ( size == 1 )      *<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(ncp, j) = (<b>signed</b> <b>char</b>)(val &gt;&gt; 8);
<a name='L1034'>        <b>else</b> <b>if</b> ( size == 2 ) *<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(ncp, j) = (<b>short</b>)(val);
<a name='L1035'>        <b>else</b> <b>if</b> ( size == 4 ) *<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(ncp, j) = (<a href='../D/4171.html' title='Multiple defined in 2 places.'>Py_Int32</a>)(val&lt;&lt;16);
<a name='L1036'>    <font color='red'>}</font>
<a name='L1037'>    <b>return</b> rv;
<a name='L1038'><font color='red'>}</font>
<a name='L1039'>
<a name='L1040'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1041'><a href='../S/2624.html#L1628' title='Refered from 1628 in Modules/audioop.c.'>audioop_lin2lin</a>(PyObject *self, PyObject *args)
<a name='L1042'><font color='red'>{</font>
<a name='L1043'>    <b>signed</b> <b>char</b> *cp;
<a name='L1044'>    <b>unsigned</b> <b>char</b> *ncp;
<a name='L1045'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> len, i, j;
<a name='L1046'>    <b>int</b> size, size2, val = 0;
<a name='L1047'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *rv;
<a name='L1048'>
<a name='L1049'>    <b>if</b> ( !<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "s#ii:lin2lin",
<a name='L1050'>                      &amp;cp, &amp;len, &amp;size, &amp;size2) )
<a name='L1051'>        <b>return</b> 0;
<a name='L1052'>
<a name='L1053'>    <b>if</b> (!<a href='../S/2624.html#L312' title='Defined at 312 in Modules/audioop.c.'>audioop_check_parameters</a>(len, size))
<a name='L1054'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1055'>    <b>if</b> (!<a href='../S/2624.html#L301' title='Defined at 301 in Modules/audioop.c.'>audioop_check_size</a>(size2))
<a name='L1056'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1057'>
<a name='L1058'>    <b>if</b> (len/size &gt; <a href='../D/2625.html' title='Multiple defined in 3 places.'>PY_SSIZE_T_MAX</a>/size2) <font color='red'>{</font>
<a name='L1059'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_MemoryError,
<a name='L1060'>                        "not enough memory for output buffer");
<a name='L1061'>        <b>return</b> 0;
<a name='L1062'>    <font color='red'>}</font>
<a name='L1063'>    rv = <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, (len/size)*size2);
<a name='L1064'>    <b>if</b> ( rv == 0 )
<a name='L1065'>        <b>return</b> 0;
<a name='L1066'>    ncp = (<b>unsigned</b> <b>char</b> *)<a href='../S/2779.html#L517' title='Defined at 517 in Objects/bytesobject.c.'>PyBytes_AsString</a>(rv);
<a name='L1067'>
<a name='L1068'>    <b>for</b> ( i=0, j=0; i &lt; len; i += size, j += size2 ) <font color='red'>{</font>
<a name='L1069'>        <b>if</b> ( size == 1 )      val = ((<b>int</b>)*<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(cp, i)) &lt;&lt; 8;
<a name='L1070'>        <b>else</b> <b>if</b> ( size == 2 ) val = (<b>int</b>)*<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(cp, i);
<a name='L1071'>        <b>else</b> <b>if</b> ( size == 4 ) val = ((<b>int</b>)*<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(cp, i)) &gt;&gt; 16;
<a name='L1072'>
<a name='L1073'>        <b>if</b> ( size2 == 1 )  *<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(ncp, j) = (<b>signed</b> <b>char</b>)(val &gt;&gt; 8);
<a name='L1074'>        <b>else</b> <b>if</b> ( size2 == 2 ) *<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(ncp, j) = (<b>short</b>)(val);
<a name='L1075'>        <b>else</b> <b>if</b> ( size2 == 4 ) *<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(ncp, j) = (<a href='../D/4171.html' title='Multiple defined in 2 places.'>Py_Int32</a>)(val&lt;&lt;16);
<a name='L1076'>    <font color='red'>}</font>
<a name='L1077'>    <b>return</b> rv;
<a name='L1078'><font color='red'>}</font>
<a name='L1079'>
<a name='L1080'><b>static</b> <b>int</b>
<a name='L1081'><a href='../S/2624.html#L1136' title='Refered from 1136 in Modules/audioop.c.'>gcd</a>(<b>int</b> a, <b>int</b> b)
<a name='L1082'><font color='red'>{</font>
<a name='L1083'>    <b>while</b> (<a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a> &gt; 0) <font color='red'>{</font>
<a name='L1084'>        <b>int</b> tmp = a % <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a>;
<a name='L1085'>        a = <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a>;
<a name='L1086'>        <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a> = tmp;
<a name='L1087'>    <font color='red'>}</font>
<a name='L1088'>    <b>return</b> a;
<a name='L1089'><font color='red'>}</font>
<a name='L1090'>
<a name='L1091'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1092'><a href='../S/2624.html#L1635' title='Refered from 1635 in Modules/audioop.c.'>audioop_ratecv</a>(PyObject *self, PyObject *args)
<a name='L1093'><font color='red'>{</font>
<a name='L1094'>    <b>char</b> *cp, *ncp;
<a name='L1095'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> len;
<a name='L1096'>    <b>int</b> size, nchannels, inrate, outrate, weightA, weightB;
<a name='L1097'>    <b>int</b> chan, d, *prev_i, *cur_i, cur_o;
<a name='L1098'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *<a href='../S/530.html#L46' title='Defined at 46 in Include/grammar.h.'>state</a>, *samps, *str, *rv = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1099'>    <b>int</b> bytes_per_frame;
<a name='L1100'>
<a name='L1101'>    weightA = 1;
<a name='L1102'>    weightB = 0;
<a name='L1103'>    <b>if</b> (!<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "s#iiiiO|ii:ratecv", &amp;cp, &amp;len, &amp;size,
<a name='L1104'>                          &amp;nchannels, &amp;inrate, &amp;outrate, &amp;<a href='../S/530.html#L46' title='Defined at 46 in Include/grammar.h.'>state</a>,
<a name='L1105'>                          &amp;weightA, &amp;weightB))
<a name='L1106'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1107'>    <b>if</b> (!<a href='../S/2624.html#L301' title='Defined at 301 in Modules/audioop.c.'>audioop_check_size</a>(size))
<a name='L1108'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1109'>    <b>if</b> (nchannels &lt; 1) <font color='red'>{</font>
<a name='L1110'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(AudioopError, "# of channels should be &gt;= 1");
<a name='L1111'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1112'>    <font color='red'>}</font>
<a name='L1113'>    bytes_per_frame = size * nchannels;
<a name='L1114'>    <b>if</b> (bytes_per_frame / nchannels != size) <font color='red'>{</font>
<a name='L1115'>        <i><font color='green'>/* This overflow test is rigorously correct because</font></i>
<a name='L1116'><i><font color='green'>           both multiplicands are &gt;= 1.  Use the argument names</font></i>
<a name='L1117'><i><font color='green'>           from the docs for the error msg. */</font></i>
<a name='L1118'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_OverflowError,
<a name='L1119'>                        "width * nchannels too big for a C int");
<a name='L1120'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1121'>    <font color='red'>}</font>
<a name='L1122'>    <b>if</b> (weightA &lt; 1 || weightB &lt; 0) <font color='red'>{</font>
<a name='L1123'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(AudioopError,
<a name='L1124'>            "weightA should be &gt;= 1, weightB should be &gt;= 0");
<a name='L1125'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1126'>    <font color='red'>}</font>
<a name='L1127'>    <b>if</b> (len % bytes_per_frame != 0) <font color='red'>{</font>
<a name='L1128'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(AudioopError, "not a whole number of frames");
<a name='L1129'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1130'>    <font color='red'>}</font>
<a name='L1131'>    <b>if</b> (inrate &lt;= 0 || outrate &lt;= 0) <font color='red'>{</font>
<a name='L1132'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(AudioopError, "sampling rate not &gt; 0");
<a name='L1133'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1134'>    <font color='red'>}</font>
<a name='L1135'>    <i><font color='green'>/* divide inrate and outrate by their greatest common divisor */</font></i>
<a name='L1136'>    d = <a href='../S/2624.html#L1081' title='Defined at 1081 in Modules/audioop.c.'>gcd</a>(inrate, outrate);
<a name='L1137'>    inrate /= d;
<a name='L1138'>    outrate /= d;
<a name='L1139'>
<a name='L1140'>    <b>if</b> ((<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)nchannels &gt; <a href='../D/2622.html' title='Multiple defined in 2 places.'>PY_SIZE_MAX</a>/<b>sizeof</b>(<b>int</b>)) <font color='red'>{</font>
<a name='L1141'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_MemoryError,
<a name='L1142'>                        "not enough memory for output buffer");
<a name='L1143'>        <b>return</b> 0;
<a name='L1144'>    <font color='red'>}</font>
<a name='L1145'>    prev_i = (<b>int</b> *) malloc(nchannels * <b>sizeof</b>(<b>int</b>));
<a name='L1146'>    cur_i = (<b>int</b> *) malloc(nchannels * <b>sizeof</b>(<b>int</b>));
<a name='L1147'>    <b>if</b> (prev_i == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> || cur_i == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L1148'>        (<b>void</b>) <a href='../S/3106.html#L334' title='Defined at 334 in Python/errors.c.'>PyErr_NoMemory</a>();
<a name='L1149'>        <b>goto</b> exit;
<a name='L1150'>    <font color='red'>}</font>
<a name='L1151'>
<a name='L1152'>    len /= bytes_per_frame; <i><font color='green'>/* # of frames */</font></i>
<a name='L1153'>
<a name='L1154'>    <b>if</b> (<a href='../S/530.html#L46' title='Defined at 46 in Include/grammar.h.'>state</a> == Py_None) <font color='red'>{</font>
<a name='L1155'>        d = -outrate;
<a name='L1156'>        <b>for</b> (chan = 0; chan &lt; nchannels; chan++)
<a name='L1157'>            prev_i[chan] = cur_i[chan] = 0;
<a name='L1158'>    <font color='red'>}</font>
<a name='L1159'>    <b>else</b> <font color='red'>{</font>
<a name='L1160'>        <b>if</b> (!<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/530.html#L46' title='Defined at 46 in Include/grammar.h.'>state</a>,
<a name='L1161'>                        "iO!;audioop.ratecv: illegal state argument",
<a name='L1162'>                        &amp;d, &amp;PyTuple_Type, &amp;samps))
<a name='L1163'>            <b>goto</b> exit;
<a name='L1164'>        <b>if</b> (<a href='../S/2823.html#L112' title='Defined at 112 in Objects/tupleobject.c.'>PyTuple_Size</a>(samps) != nchannels) <font color='red'>{</font>
<a name='L1165'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(AudioopError,
<a name='L1166'>                            "illegal state argument");
<a name='L1167'>            <b>goto</b> exit;
<a name='L1168'>        <font color='red'>}</font>
<a name='L1169'>        <b>for</b> (chan = 0; chan &lt; nchannels; chan++) <font color='red'>{</font>
<a name='L1170'>            <b>if</b> (!<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2823.html#L123' title='Defined at 123 in Objects/tupleobject.c.'>PyTuple_GetItem</a>(samps, chan),
<a name='L1171'>                                  "ii:ratecv", &amp;prev_i[chan],
<a name='L1172'>                                               &amp;cur_i[chan]))
<a name='L1173'>                <b>goto</b> exit;
<a name='L1174'>        <font color='red'>}</font>
<a name='L1175'>    <font color='red'>}</font>
<a name='L1176'>
<a name='L1177'>    <i><font color='green'>/* str &lt;- Space for the output buffer. */</font></i>
<a name='L1178'>    <font color='red'>{</font>
<a name='L1179'>        <i><font color='green'>/* There are len input frames, so we need (mathematically)</font></i>
<a name='L1180'><i><font color='green'>           ceiling(len*outrate/inrate) output frames, and each frame</font></i>
<a name='L1181'><i><font color='green'>           requires bytes_per_frame bytes.  Computing this</font></i>
<a name='L1182'><i><font color='green'>           without spurious overflow is the challenge; we can</font></i>
<a name='L1183'><i><font color='green'>           settle for a reasonable upper bound, though, in this</font></i>
<a name='L1184'><i><font color='green'>           case ceiling(len/inrate) * outrate. */</font></i>
<a name='L1185'>
<a name='L1186'>        <i><font color='green'>/* compute ceiling(len/inrate) without overflow */</font></i>
<a name='L1187'>        <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> q = len &gt; 0 ? 1 + (len - 1) / inrate : 0;
<a name='L1188'>        <b>if</b> (outrate &gt; <a href='../D/2625.html' title='Multiple defined in 3 places.'>PY_SSIZE_T_MAX</a> / q / bytes_per_frame)
<a name='L1189'>            str = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1190'>        <b>else</b>
<a name='L1191'>            str = <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L1192'>                                            q * outrate * bytes_per_frame);
<a name='L1193'>
<a name='L1194'>        <b>if</b> (str == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L1195'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_MemoryError,
<a name='L1196'>                "not enough memory for output buffer");
<a name='L1197'>            <b>goto</b> exit;
<a name='L1198'>        <font color='red'>}</font>
<a name='L1199'>    <font color='red'>}</font>
<a name='L1200'>    ncp = <a href='../S/2779.html#L517' title='Defined at 517 in Objects/bytesobject.c.'>PyBytes_AsString</a>(str);
<a name='L1201'>
<a name='L1202'>    <b>for</b> (;;) <font color='red'>{</font>
<a name='L1203'>        <b>while</b> (d &lt; 0) <font color='red'>{</font>
<a name='L1204'>            <b>if</b> (len == 0) <font color='red'>{</font>
<a name='L1205'>                samps = <a href='../S/2823.html#L49' title='Defined at 49 in Objects/tupleobject.c.'>PyTuple_New</a>(nchannels);
<a name='L1206'>                <b>if</b> (samps == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1207'>                    <b>goto</b> exit;
<a name='L1208'>                <b>for</b> (chan = 0; chan &lt; nchannels; chan++)
<a name='L1209'>                    <a href='../S/2823.html#L137' title='Defined at 137 in Objects/tupleobject.c.'>PyTuple_SetItem</a>(samps, chan,
<a name='L1210'>                        <a href='../D/4089.html' title='Multiple defined in 2 places.'>Py_BuildValue</a>("(ii)",
<a name='L1211'>                                      prev_i[chan],
<a name='L1212'>                                      cur_i[chan]));
<a name='L1213'>                <b>if</b> (<a href='../D/3154.html' title='Multiple defined in 2 places.'>PyErr_Occurred</a>())
<a name='L1214'>                    <b>goto</b> exit;
<a name='L1215'>                <i><font color='green'>/* We have checked before that the length</font></i>
<a name='L1216'><i><font color='green'>                 * of the string fits into int. */</font></i>
<a name='L1217'>                len = (<a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a>)(ncp - <a href='../S/2779.html#L517' title='Defined at 517 in Objects/bytesobject.c.'>PyBytes_AsString</a>(str));
<a name='L1218'>                rv = <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>
<a name='L1219'>                    (<a href='../S/2779.html#L517' title='Defined at 517 in Objects/bytesobject.c.'>PyBytes_AsString</a>(str), len);
<a name='L1220'>                Py_DECREF(str);
<a name='L1221'>                str = rv;
<a name='L1222'>                <b>if</b> (str == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1223'>                    <b>goto</b> exit;
<a name='L1224'>                rv = <a href='../D/4089.html' title='Multiple defined in 2 places.'>Py_BuildValue</a>("(O(iO))", str, d, samps);
<a name='L1225'>                Py_DECREF(samps);
<a name='L1226'>                Py_DECREF(str);
<a name='L1227'>                <b>goto</b> exit; <i><font color='green'>/* return rv */</font></i>
<a name='L1228'>            <font color='red'>}</font>
<a name='L1229'>            <b>for</b> (chan = 0; chan &lt; nchannels; chan++) <font color='red'>{</font>
<a name='L1230'>                prev_i[chan] = cur_i[chan];
<a name='L1231'>                <b>if</b> (size == 1)
<a name='L1232'>                    cur_i[chan] = ((<b>int</b>)*<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(cp, 0)) &lt;&lt; 8;
<a name='L1233'>                <b>else</b> <b>if</b> (size == 2)
<a name='L1234'>                    cur_i[chan] = (<b>int</b>)*<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(cp, 0);
<a name='L1235'>                <b>else</b> <b>if</b> (size == 4)
<a name='L1236'>                    cur_i[chan] = ((<b>int</b>)*<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(cp, 0)) &gt;&gt; 16;
<a name='L1237'>                cp += size;
<a name='L1238'>                <i><font color='green'>/* implements a simple digital filter */</font></i>
<a name='L1239'>                cur_i[chan] =
<a name='L1240'>                    (weightA * cur_i[chan] +
<a name='L1241'>                     weightB * prev_i[chan]) /
<a name='L1242'>                    (weightA + weightB);
<a name='L1243'>            <font color='red'>}</font>
<a name='L1244'>            len--;
<a name='L1245'>            d += outrate;
<a name='L1246'>        <font color='red'>}</font>
<a name='L1247'>        <b>while</b> (d &gt;= 0) <font color='red'>{</font>
<a name='L1248'>            <b>for</b> (chan = 0; chan &lt; nchannels; chan++) <font color='red'>{</font>
<a name='L1249'>                cur_o = (prev_i[chan] * d +
<a name='L1250'>                         cur_i[chan] * (outrate - d)) /
<a name='L1251'>                    outrate;
<a name='L1252'>                <b>if</b> (size == 1)
<a name='L1253'>                    *<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(ncp, 0) = (<b>signed</b> <b>char</b>)(cur_o &gt;&gt; 8);
<a name='L1254'>                <b>else</b> <b>if</b> (size == 2)
<a name='L1255'>                    *<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(ncp, 0) = (<b>short</b>)(cur_o);
<a name='L1256'>                <b>else</b> <b>if</b> (size == 4)
<a name='L1257'>                    *<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(ncp, 0) = (<a href='../D/4171.html' title='Multiple defined in 2 places.'>Py_Int32</a>)(cur_o&lt;&lt;16);
<a name='L1258'>                ncp += size;
<a name='L1259'>            <font color='red'>}</font>
<a name='L1260'>            d -= inrate;
<a name='L1261'>        <font color='red'>}</font>
<a name='L1262'>    <font color='red'>}</font>
<a name='L1263'>  exit:
<a name='L1264'>    <b>if</b> (prev_i != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1265'>        free(prev_i);
<a name='L1266'>    <b>if</b> (cur_i != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1267'>        free(cur_i);
<a name='L1268'>    <b>return</b> rv;
<a name='L1269'><font color='red'>}</font>
<a name='L1270'>
<a name='L1271'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1272'><a href='../S/2624.html#L1625' title='Refered from 1625 in Modules/audioop.c.'>audioop_lin2ulaw</a>(PyObject *self, PyObject *args)
<a name='L1273'><font color='red'>{</font>
<a name='L1274'>    <b>signed</b> <b>char</b> *cp;
<a name='L1275'>    <b>unsigned</b> <b>char</b> *ncp;
<a name='L1276'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> len, i;
<a name='L1277'>    <b>int</b> size, val = 0;
<a name='L1278'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *rv;
<a name='L1279'>
<a name='L1280'>    <b>if</b> ( !<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "s#i:lin2ulaw",
<a name='L1281'>                           &amp;cp, &amp;len, &amp;size) )
<a name='L1282'>        <b>return</b> 0 ;
<a name='L1283'>
<a name='L1284'>    <b>if</b> (!<a href='../S/2624.html#L312' title='Defined at 312 in Modules/audioop.c.'>audioop_check_parameters</a>(len, size))
<a name='L1285'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1286'>
<a name='L1287'>    rv = <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, len/size);
<a name='L1288'>    <b>if</b> ( rv == 0 )
<a name='L1289'>        <b>return</b> 0;
<a name='L1290'>    ncp = (<b>unsigned</b> <b>char</b> *)<a href='../S/2779.html#L517' title='Defined at 517 in Objects/bytesobject.c.'>PyBytes_AsString</a>(rv);
<a name='L1291'>
<a name='L1292'>    <b>for</b> ( i=0; i &lt; len; i += size ) <font color='red'>{</font>
<a name='L1293'>        <b>if</b> ( size == 1 )      val = ((<b>int</b>)*<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(cp, i)) &lt;&lt; 8;
<a name='L1294'>        <b>else</b> <b>if</b> ( size == 2 ) val = (<b>int</b>)*<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(cp, i);
<a name='L1295'>        <b>else</b> <b>if</b> ( size == 4 ) val = ((<b>int</b>)*<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(cp, i)) &gt;&gt; 16;
<a name='L1296'>
<a name='L1297'>        *ncp++ = <a href='../S/2624.html#L142' title='Defined at 142 in Modules/audioop.c.'>st_14linear2ulaw</a>(val);
<a name='L1298'>    <font color='red'>}</font>
<a name='L1299'>    <b>return</b> rv;
<a name='L1300'><font color='red'>}</font>
<a name='L1301'>
<a name='L1302'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1303'><a href='../S/2624.html#L1624' title='Refered from 1624 in Modules/audioop.c.'>audioop_ulaw2lin</a>(PyObject *self, PyObject *args)
<a name='L1304'><font color='red'>{</font>
<a name='L1305'>    <b>unsigned</b> <b>char</b> *cp;
<a name='L1306'>    <b>unsigned</b> <b>char</b> cval;
<a name='L1307'>    <b>signed</b> <b>char</b> *ncp;
<a name='L1308'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> len, i;
<a name='L1309'>    <b>int</b> size, val;
<a name='L1310'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *rv;
<a name='L1311'>
<a name='L1312'>    <b>if</b> ( !<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "s#i:ulaw2lin",
<a name='L1313'>                           &amp;cp, &amp;len, &amp;size) )
<a name='L1314'>        <b>return</b> 0;
<a name='L1315'>
<a name='L1316'>    <b>if</b> (!<a href='../S/2624.html#L312' title='Defined at 312 in Modules/audioop.c.'>audioop_check_parameters</a>(len, size))
<a name='L1317'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1318'>
<a name='L1319'>    <b>if</b> (len &gt; <a href='../D/2625.html' title='Multiple defined in 3 places.'>PY_SSIZE_T_MAX</a>/size) <font color='red'>{</font>
<a name='L1320'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_MemoryError,
<a name='L1321'>                        "not enough memory for output buffer");
<a name='L1322'>        <b>return</b> 0;
<a name='L1323'>    <font color='red'>}</font>
<a name='L1324'>    rv = <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, len*size);
<a name='L1325'>    <b>if</b> ( rv == 0 )
<a name='L1326'>        <b>return</b> 0;
<a name='L1327'>    ncp = (<b>signed</b> <b>char</b> *)<a href='../S/2779.html#L517' title='Defined at 517 in Objects/bytesobject.c.'>PyBytes_AsString</a>(rv);
<a name='L1328'>
<a name='L1329'>    <b>for</b> ( i=0; i &lt; len*size; i += size ) <font color='red'>{</font>
<a name='L1330'>        cval = *cp++;
<a name='L1331'>        val = <a href='../S/2624.html#L66' title='Defined at 66 in Modules/audioop.c.'>st_ulaw2linear16</a>(cval);
<a name='L1332'>
<a name='L1333'>        <b>if</b> ( size == 1 )      *<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(ncp, i) = (<b>signed</b> <b>char</b>)(val &gt;&gt; 8);
<a name='L1334'>        <b>else</b> <b>if</b> ( size == 2 ) *<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(ncp, i) = (<b>short</b>)(val);
<a name='L1335'>        <b>else</b> <b>if</b> ( size == 4 ) *<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(ncp, i) = (<a href='../D/4171.html' title='Multiple defined in 2 places.'>Py_Int32</a>)(val&lt;&lt;16);
<a name='L1336'>    <font color='red'>}</font>
<a name='L1337'>    <b>return</b> rv;
<a name='L1338'><font color='red'>}</font>
<a name='L1339'>
<a name='L1340'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1341'><a href='../S/2624.html#L1627' title='Refered from 1627 in Modules/audioop.c.'>audioop_lin2alaw</a>(PyObject *self, PyObject *args)
<a name='L1342'><font color='red'>{</font>
<a name='L1343'>    <b>signed</b> <b>char</b> *cp;
<a name='L1344'>    <b>unsigned</b> <b>char</b> *ncp;
<a name='L1345'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> len, i;
<a name='L1346'>    <b>int</b> size, val = 0;
<a name='L1347'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *rv;
<a name='L1348'>
<a name='L1349'>    <b>if</b> ( !<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "s#i:lin2alaw",
<a name='L1350'>                           &amp;cp, &amp;len, &amp;size) )
<a name='L1351'>        <b>return</b> 0;
<a name='L1352'>
<a name='L1353'>    <b>if</b> (!<a href='../S/2624.html#L312' title='Defined at 312 in Modules/audioop.c.'>audioop_check_parameters</a>(len, size))
<a name='L1354'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1355'>
<a name='L1356'>    rv = <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, len/size);
<a name='L1357'>    <b>if</b> ( rv == 0 )
<a name='L1358'>        <b>return</b> 0;
<a name='L1359'>    ncp = (<b>unsigned</b> <b>char</b> *)<a href='../S/2779.html#L517' title='Defined at 517 in Objects/bytesobject.c.'>PyBytes_AsString</a>(rv);
<a name='L1360'>
<a name='L1361'>    <b>for</b> ( i=0; i &lt; len; i += size ) <font color='red'>{</font>
<a name='L1362'>        <b>if</b> ( size == 1 )      val = ((<b>int</b>)*<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(cp, i)) &lt;&lt; 8;
<a name='L1363'>        <b>else</b> <b>if</b> ( size == 2 ) val = (<b>int</b>)*<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(cp, i);
<a name='L1364'>        <b>else</b> <b>if</b> ( size == 4 ) val = ((<b>int</b>)*<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(cp, i)) &gt;&gt; 16;
<a name='L1365'>
<a name='L1366'>        *ncp++ = <a href='../S/2624.html#L239' title='Defined at 239 in Modules/audioop.c.'>st_linear2alaw</a>(val);
<a name='L1367'>    <font color='red'>}</font>
<a name='L1368'>    <b>return</b> rv;
<a name='L1369'><font color='red'>}</font>
<a name='L1370'>
<a name='L1371'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1372'><a href='../S/2624.html#L1626' title='Refered from 1626 in Modules/audioop.c.'>audioop_alaw2lin</a>(PyObject *self, PyObject *args)
<a name='L1373'><font color='red'>{</font>
<a name='L1374'>    <b>unsigned</b> <b>char</b> *cp;
<a name='L1375'>    <b>unsigned</b> <b>char</b> cval;
<a name='L1376'>    <b>signed</b> <b>char</b> *ncp;
<a name='L1377'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> len, i;
<a name='L1378'>    <b>int</b> size, val;
<a name='L1379'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *rv;
<a name='L1380'>
<a name='L1381'>    <b>if</b> ( !<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "s#i:alaw2lin",
<a name='L1382'>                           &amp;cp, &amp;len, &amp;size) )
<a name='L1383'>        <b>return</b> 0;
<a name='L1384'>
<a name='L1385'>    <b>if</b> (!<a href='../S/2624.html#L312' title='Defined at 312 in Modules/audioop.c.'>audioop_check_parameters</a>(len, size))
<a name='L1386'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1387'>
<a name='L1388'>    <b>if</b> (len &gt; <a href='../D/2625.html' title='Multiple defined in 3 places.'>PY_SSIZE_T_MAX</a>/size) <font color='red'>{</font>
<a name='L1389'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_MemoryError,
<a name='L1390'>                        "not enough memory for output buffer");
<a name='L1391'>        <b>return</b> 0;
<a name='L1392'>    <font color='red'>}</font>
<a name='L1393'>    rv = <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, len*size);
<a name='L1394'>    <b>if</b> ( rv == 0 )
<a name='L1395'>        <b>return</b> 0;
<a name='L1396'>    ncp = (<b>signed</b> <b>char</b> *)<a href='../S/2779.html#L517' title='Defined at 517 in Objects/bytesobject.c.'>PyBytes_AsString</a>(rv);
<a name='L1397'>
<a name='L1398'>    <b>for</b> ( i=0; i &lt; len*size; i += size ) <font color='red'>{</font>
<a name='L1399'>        cval = *cp++;
<a name='L1400'>        val = <a href='../S/2624.html#L67' title='Defined at 67 in Modules/audioop.c.'>st_alaw2linear16</a>(cval);
<a name='L1401'>
<a name='L1402'>        <b>if</b> ( size == 1 )      *<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(ncp, i) = (<b>signed</b> <b>char</b>)(val &gt;&gt; 8);
<a name='L1403'>        <b>else</b> <b>if</b> ( size == 2 ) *<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(ncp, i) = (<b>short</b>)(val);
<a name='L1404'>        <b>else</b> <b>if</b> ( size == 4 ) *<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(ncp, i) = (<a href='../D/4171.html' title='Multiple defined in 2 places.'>Py_Int32</a>)(val&lt;&lt;16);
<a name='L1405'>    <font color='red'>}</font>
<a name='L1406'>    <b>return</b> rv;
<a name='L1407'><font color='red'>}</font>
<a name='L1408'>
<a name='L1409'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1410'><a href='../S/2624.html#L1630' title='Refered from 1630 in Modules/audioop.c.'>audioop_lin2adpcm</a>(PyObject *self, PyObject *args)
<a name='L1411'><font color='red'>{</font>
<a name='L1412'>    <b>signed</b> <b>char</b> *cp;
<a name='L1413'>    <b>signed</b> <b>char</b> *ncp;
<a name='L1414'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> len, i;
<a name='L1415'>    <b>int</b> size, val = 0, step, valpred, delta,
<a name='L1416'>        index, sign, vpdiff, <a href='../S/3095.html#L906' title='Defined at 906 in Python/dtoa.c.'>diff</a>;
<a name='L1417'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *rv, *<a href='../S/530.html#L46' title='Defined at 46 in Include/grammar.h.'>state</a>, *str;
<a name='L1418'>    <b>int</b> outputbuffer = 0, bufferstep;
<a name='L1419'>
<a name='L1420'>    <b>if</b> ( !<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "s#iO:lin2adpcm",
<a name='L1421'>                           &amp;cp, &amp;len, &amp;size, &amp;<a href='../S/530.html#L46' title='Defined at 46 in Include/grammar.h.'>state</a>) )
<a name='L1422'>        <b>return</b> 0;
<a name='L1423'>
<a name='L1424'>    <b>if</b> (!<a href='../S/2624.html#L312' title='Defined at 312 in Modules/audioop.c.'>audioop_check_parameters</a>(len, size))
<a name='L1425'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1426'>
<a name='L1427'>    str = <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, len/(size*2));
<a name='L1428'>    <b>if</b> ( str == 0 )
<a name='L1429'>        <b>return</b> 0;
<a name='L1430'>    ncp = (<b>signed</b> <b>char</b> *)<a href='../S/2779.html#L517' title='Defined at 517 in Objects/bytesobject.c.'>PyBytes_AsString</a>(str);
<a name='L1431'>
<a name='L1432'>    <i><font color='green'>/* Decode state, should have (value, step) */</font></i>
<a name='L1433'>    <b>if</b> ( <a href='../S/530.html#L46' title='Defined at 46 in Include/grammar.h.'>state</a> == Py_None ) <font color='red'>{</font>
<a name='L1434'>        <i><font color='green'>/* First time, it seems. Set defaults */</font></i>
<a name='L1435'>        valpred = 0;
<a name='L1436'>        step = 7;
<a name='L1437'>        index = 0;
<a name='L1438'>    <font color='red'>}</font> <b>else</b> <b>if</b> ( !<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/530.html#L46' title='Defined at 46 in Include/grammar.h.'>state</a>, "ii", &amp;valpred, &amp;index) )
<a name='L1439'>        <b>return</b> 0;
<a name='L1440'>
<a name='L1441'>    step = stepsizeTable[index];
<a name='L1442'>    bufferstep = 1;
<a name='L1443'>
<a name='L1444'>    <b>for</b> ( i=0; i &lt; len; i += size ) <font color='red'>{</font>
<a name='L1445'>        <b>if</b> ( size == 1 )      val = ((<b>int</b>)*<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(cp, i)) &lt;&lt; 8;
<a name='L1446'>        <b>else</b> <b>if</b> ( size == 2 ) val = (<b>int</b>)*<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(cp, i);
<a name='L1447'>        <b>else</b> <b>if</b> ( size == 4 ) val = ((<b>int</b>)*<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(cp, i)) &gt;&gt; 16;
<a name='L1448'>
<a name='L1449'>        <i><font color='green'>/* Step 1 - compute difference with previous value */</font></i>
<a name='L1450'>        <a href='../S/3095.html#L906' title='Defined at 906 in Python/dtoa.c.'>diff</a> = val - valpred;
<a name='L1451'>        sign = (<a href='../S/3095.html#L906' title='Defined at 906 in Python/dtoa.c.'>diff</a> &lt; 0) ? 8 : 0;
<a name='L1452'>        <b>if</b> ( sign ) <a href='../S/3095.html#L906' title='Defined at 906 in Python/dtoa.c.'>diff</a> = (-<a href='../S/3095.html#L906' title='Defined at 906 in Python/dtoa.c.'>diff</a>);
<a name='L1453'>
<a name='L1454'>        <i><font color='green'>/* Step 2 - Divide and clamp */</font></i>
<a name='L1455'>        <i><font color='green'>/* Note:</font></i>
<a name='L1456'><i><font color='green'>        ** This code *approximately* computes:</font></i>
<a name='L1457'><i><font color='green'>        **    delta = diff*4/step;</font></i>
<a name='L1458'><i><font color='green'>        **    vpdiff = (delta+0.5)*step/4;</font></i>
<a name='L1459'><i><font color='green'>        ** but in shift step bits are dropped. The net result of this</font></i>
<a name='L1460'><i><font color='green'>        ** is that even if you have fast mul/div hardware you cannot</font></i>
<a name='L1461'><i><font color='green'>        ** put it to good use since the fixup would be too expensive.</font></i>
<a name='L1462'><i><font color='green'>        */</font></i>
<a name='L1463'>        delta = 0;
<a name='L1464'>        vpdiff = (step &gt;&gt; 3);
<a name='L1465'>
<a name='L1466'>        <b>if</b> ( <a href='../S/3095.html#L906' title='Defined at 906 in Python/dtoa.c.'>diff</a> &gt;= step ) <font color='red'>{</font>
<a name='L1467'>            delta = 4;
<a name='L1468'>            <a href='../S/3095.html#L906' title='Defined at 906 in Python/dtoa.c.'>diff</a> -= step;
<a name='L1469'>            vpdiff += step;
<a name='L1470'>        <font color='red'>}</font>
<a name='L1471'>        step &gt;&gt;= 1;
<a name='L1472'>        <b>if</b> ( <a href='../S/3095.html#L906' title='Defined at 906 in Python/dtoa.c.'>diff</a> &gt;= step  ) <font color='red'>{</font>
<a name='L1473'>            delta |= 2;
<a name='L1474'>            <a href='../S/3095.html#L906' title='Defined at 906 in Python/dtoa.c.'>diff</a> -= step;
<a name='L1475'>            vpdiff += step;
<a name='L1476'>        <font color='red'>}</font>
<a name='L1477'>        step &gt;&gt;= 1;
<a name='L1478'>        <b>if</b> ( <a href='../S/3095.html#L906' title='Defined at 906 in Python/dtoa.c.'>diff</a> &gt;= step ) <font color='red'>{</font>
<a name='L1479'>            delta |= 1;
<a name='L1480'>            vpdiff += step;
<a name='L1481'>        <font color='red'>}</font>
<a name='L1482'>
<a name='L1483'>        <i><font color='green'>/* Step 3 - Update previous value */</font></i>
<a name='L1484'>        <b>if</b> ( sign )
<a name='L1485'>            valpred -= vpdiff;
<a name='L1486'>        <b>else</b>
<a name='L1487'>            valpred += vpdiff;
<a name='L1488'>
<a name='L1489'>        <i><font color='green'>/* Step 4 - Clamp previous value to 16 bits */</font></i>
<a name='L1490'>        <b>if</b> ( valpred &gt; 32767 )
<a name='L1491'>            valpred = 32767;
<a name='L1492'>        <b>else</b> <b>if</b> ( valpred &lt; -32768 )
<a name='L1493'>            valpred = -32768;
<a name='L1494'>
<a name='L1495'>        <i><font color='green'>/* Step 5 - Assemble value, update index and step values */</font></i>
<a name='L1496'>        delta |= sign;
<a name='L1497'>
<a name='L1498'>        index += indexTable[delta];
<a name='L1499'>        <b>if</b> ( index &lt; 0 ) index = 0;
<a name='L1500'>        <b>if</b> ( index &gt; 88 ) index = 88;
<a name='L1501'>        step = stepsizeTable[index];
<a name='L1502'>
<a name='L1503'>        <i><font color='green'>/* Step 6 - Output value */</font></i>
<a name='L1504'>        <b>if</b> ( bufferstep ) <font color='red'>{</font>
<a name='L1505'>            outputbuffer = (delta &lt;&lt; 4) &amp; 0xf0;
<a name='L1506'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1507'>            *ncp++ = (delta &amp; 0x0f) | outputbuffer;
<a name='L1508'>        <font color='red'>}</font>
<a name='L1509'>        bufferstep = !bufferstep;
<a name='L1510'>    <font color='red'>}</font>
<a name='L1511'>    rv = <a href='../D/4089.html' title='Multiple defined in 2 places.'>Py_BuildValue</a>("(O(ii))", str, valpred, index);
<a name='L1512'>    Py_DECREF(str);
<a name='L1513'>    <b>return</b> rv;
<a name='L1514'><font color='red'>}</font>
<a name='L1515'>
<a name='L1516'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1517'><a href='../S/2624.html#L1629' title='Refered from 1629 in Modules/audioop.c.'>audioop_adpcm2lin</a>(PyObject *self, PyObject *args)
<a name='L1518'><font color='red'>{</font>
<a name='L1519'>    <b>signed</b> <b>char</b> *cp;
<a name='L1520'>    <b>signed</b> <b>char</b> *ncp;
<a name='L1521'>    <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> len, i;
<a name='L1522'>    <b>int</b> size, valpred, step, delta, index, sign, vpdiff;
<a name='L1523'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *rv, *str, *<a href='../S/530.html#L46' title='Defined at 46 in Include/grammar.h.'>state</a>;
<a name='L1524'>    <b>int</b> inputbuffer = 0, bufferstep;
<a name='L1525'>
<a name='L1526'>    <b>if</b> ( !<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "s#iO:adpcm2lin",
<a name='L1527'>                           &amp;cp, &amp;len, &amp;size, &amp;<a href='../S/530.html#L46' title='Defined at 46 in Include/grammar.h.'>state</a>) )
<a name='L1528'>        <b>return</b> 0;
<a name='L1529'>
<a name='L1530'>    <b>if</b> (!<a href='../S/2624.html#L312' title='Defined at 312 in Modules/audioop.c.'>audioop_check_parameters</a>(len, size))
<a name='L1531'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1532'>
<a name='L1533'>    <i><font color='green'>/* Decode state, should have (value, step) */</font></i>
<a name='L1534'>    <b>if</b> ( <a href='../S/530.html#L46' title='Defined at 46 in Include/grammar.h.'>state</a> == Py_None ) <font color='red'>{</font>
<a name='L1535'>        <i><font color='green'>/* First time, it seems. Set defaults */</font></i>
<a name='L1536'>        valpred = 0;
<a name='L1537'>        step = 7;
<a name='L1538'>        index = 0;
<a name='L1539'>    <font color='red'>}</font> <b>else</b> <b>if</b> ( !<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/530.html#L46' title='Defined at 46 in Include/grammar.h.'>state</a>, "ii", &amp;valpred, &amp;index) )
<a name='L1540'>        <b>return</b> 0;
<a name='L1541'>
<a name='L1542'>    <b>if</b> (len &gt; (<a href='../D/2625.html' title='Multiple defined in 3 places.'>PY_SSIZE_T_MAX</a>/2)/size) <font color='red'>{</font>
<a name='L1543'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_MemoryError,
<a name='L1544'>                        "not enough memory for output buffer");
<a name='L1545'>        <b>return</b> 0;
<a name='L1546'>    <font color='red'>}</font>
<a name='L1547'>    str = <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, len*size*2);
<a name='L1548'>    <b>if</b> ( str == 0 )
<a name='L1549'>        <b>return</b> 0;
<a name='L1550'>    ncp = (<b>signed</b> <b>char</b> *)<a href='../S/2779.html#L517' title='Defined at 517 in Objects/bytesobject.c.'>PyBytes_AsString</a>(str);
<a name='L1551'>
<a name='L1552'>    step = stepsizeTable[index];
<a name='L1553'>    bufferstep = 0;
<a name='L1554'>
<a name='L1555'>    <b>for</b> ( i=0; i &lt; len*size*2; i += size ) <font color='red'>{</font>
<a name='L1556'>        <i><font color='green'>/* Step 1 - get the delta value and compute next index */</font></i>
<a name='L1557'>        <b>if</b> ( bufferstep ) <font color='red'>{</font>
<a name='L1558'>            delta = inputbuffer &amp; 0xf;
<a name='L1559'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1560'>            inputbuffer = *cp++;
<a name='L1561'>            delta = (inputbuffer &gt;&gt; 4) &amp; 0xf;
<a name='L1562'>        <font color='red'>}</font>
<a name='L1563'>
<a name='L1564'>        bufferstep = !bufferstep;
<a name='L1565'>
<a name='L1566'>        <i><font color='green'>/* Step 2 - Find new index value (for later) */</font></i>
<a name='L1567'>        index += indexTable[delta];
<a name='L1568'>        <b>if</b> ( index &lt; 0 ) index = 0;
<a name='L1569'>        <b>if</b> ( index &gt; 88 ) index = 88;
<a name='L1570'>
<a name='L1571'>        <i><font color='green'>/* Step 3 - Separate sign and magnitude */</font></i>
<a name='L1572'>        sign = delta &amp; 8;
<a name='L1573'>        delta = delta &amp; 7;
<a name='L1574'>
<a name='L1575'>        <i><font color='green'>/* Step 4 - Compute difference and new predicted value */</font></i>
<a name='L1576'>        <i><font color='green'>/*</font></i>
<a name='L1577'><i><font color='green'>        ** Computes 'vpdiff = (delta+0.5)*step/4', but see comment</font></i>
<a name='L1578'><i><font color='green'>        ** in adpcm_coder.</font></i>
<a name='L1579'><i><font color='green'>        */</font></i>
<a name='L1580'>        vpdiff = step &gt;&gt; 3;
<a name='L1581'>        <b>if</b> ( delta &amp; 4 ) vpdiff += step;
<a name='L1582'>        <b>if</b> ( delta &amp; 2 ) vpdiff += step&gt;&gt;1;
<a name='L1583'>        <b>if</b> ( delta &amp; 1 ) vpdiff += step&gt;&gt;2;
<a name='L1584'>
<a name='L1585'>        <b>if</b> ( sign )
<a name='L1586'>            valpred -= vpdiff;
<a name='L1587'>        <b>else</b>
<a name='L1588'>            valpred += vpdiff;
<a name='L1589'>
<a name='L1590'>        <i><font color='green'>/* Step 5 - clamp output value */</font></i>
<a name='L1591'>        <b>if</b> ( valpred &gt; 32767 )
<a name='L1592'>            valpred = 32767;
<a name='L1593'>        <b>else</b> <b>if</b> ( valpred &lt; -32768 )
<a name='L1594'>            valpred = -32768;
<a name='L1595'>
<a name='L1596'>        <i><font color='green'>/* Step 6 - Update step value */</font></i>
<a name='L1597'>        step = stepsizeTable[index];
<a name='L1598'>
<a name='L1599'>        <i><font color='green'>/* Step 6 - Output value */</font></i>
<a name='L1600'>        <b>if</b> ( size == 1 ) *<a href='../S/2624.html#L292' title='Defined at 292 in Modules/audioop.c.'>CHARP</a>(ncp, i) = (<b>signed</b> <b>char</b>)(valpred &gt;&gt; 8);
<a name='L1601'>        <b>else</b> <b>if</b> ( size == 2 ) *<a href='../S/2624.html#L293' title='Defined at 293 in Modules/audioop.c.'>SHORTP</a>(ncp, i) = (<b>short</b>)(valpred);
<a name='L1602'>        <b>else</b> <b>if</b> ( size == 4 ) *<a href='../S/2624.html#L294' title='Defined at 294 in Modules/audioop.c.'>LONGP</a>(ncp, i) = (<a href='../D/4171.html' title='Multiple defined in 2 places.'>Py_Int32</a>)(valpred&lt;&lt;16);
<a name='L1603'>    <font color='red'>}</font>
<a name='L1604'>
<a name='L1605'>    rv = <a href='../D/4089.html' title='Multiple defined in 2 places.'>Py_BuildValue</a>("(O(ii))", str, valpred, index);
<a name='L1606'>    Py_DECREF(str);
<a name='L1607'>    <b>return</b> rv;
<a name='L1608'><font color='red'>}</font>
<a name='L1609'>
<a name='L1610'><b>static</b> <a href='../D/3525.html' title='Multiple defined in 3 places.'>PyMethodDef</a> audioop_methods[] = <font color='red'>{</font>
<a name='L1611'>    <font color='red'>{</font> "max", <a href='../S/2624.html#L345' title='Defined at 345 in Modules/audioop.c.'>audioop_max</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a> <font color='red'>}</font>,
<a name='L1612'>    <font color='red'>{</font> "minmax", <a href='../S/2624.html#L367' title='Defined at 367 in Modules/audioop.c.'>audioop_minmax</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a> <font color='red'>}</font>,
<a name='L1613'>    <font color='red'>{</font> "avg", <a href='../S/2624.html#L389' title='Defined at 389 in Modules/audioop.c.'>audioop_avg</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a> <font color='red'>}</font>,
<a name='L1614'>    <font color='red'>{</font> "maxpp", <a href='../S/2624.html#L676' title='Defined at 676 in Modules/audioop.c.'>audioop_maxpp</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a> <font color='red'>}</font>,
<a name='L1615'>    <font color='red'>{</font> "avgpp", <a href='../S/2624.html#L621' title='Defined at 621 in Modules/audioop.c.'>audioop_avgpp</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a> <font color='red'>}</font>,
<a name='L1616'>    <font color='red'>{</font> "rms", <a href='../S/2624.html#L414' title='Defined at 414 in Modules/audioop.c.'>audioop_rms</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a> <font color='red'>}</font>,
<a name='L1617'>    <font color='red'>{</font> "findfit", <a href='../S/2624.html#L482' title='Defined at 482 in Modules/audioop.c.'>audioop_findfit</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a> <font color='red'>}</font>,
<a name='L1618'>    <font color='red'>{</font> "findmax", <a href='../S/2624.html#L576' title='Defined at 576 in Modules/audioop.c.'>audioop_findmax</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a> <font color='red'>}</font>,
<a name='L1619'>    <font color='red'>{</font> "findfactor", <a href='../S/2624.html#L545' title='Defined at 545 in Modules/audioop.c.'>audioop_findfactor</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a> <font color='red'>}</font>,
<a name='L1620'>    <font color='red'>{</font> "cross", <a href='../S/2624.html#L727' title='Defined at 727 in Modules/audioop.c.'>audioop_cross</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a> <font color='red'>}</font>,
<a name='L1621'>    <font color='red'>{</font> "mul", <a href='../S/2624.html#L753' title='Defined at 753 in Modules/audioop.c.'>audioop_mul</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a> <font color='red'>}</font>,
<a name='L1622'>    <font color='red'>{</font> "add", <a href='../S/2624.html#L918' title='Defined at 918 in Modules/audioop.c.'>audioop_add</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a> <font color='red'>}</font>,
<a name='L1623'>    <font color='red'>{</font> "bias", <a href='../S/2624.html#L972' title='Defined at 972 in Modules/audioop.c.'>audioop_bias</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a> <font color='red'>}</font>,
<a name='L1624'>    <font color='red'>{</font> "ulaw2lin", <a href='../S/2624.html#L1303' title='Defined at 1303 in Modules/audioop.c.'>audioop_ulaw2lin</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a> <font color='red'>}</font>,
<a name='L1625'>    <font color='red'>{</font> "lin2ulaw", <a href='../S/2624.html#L1272' title='Defined at 1272 in Modules/audioop.c.'>audioop_lin2ulaw</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a> <font color='red'>}</font>,
<a name='L1626'>    <font color='red'>{</font> "alaw2lin", <a href='../S/2624.html#L1372' title='Defined at 1372 in Modules/audioop.c.'>audioop_alaw2lin</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a> <font color='red'>}</font>,
<a name='L1627'>    <font color='red'>{</font> "lin2alaw", <a href='../S/2624.html#L1341' title='Defined at 1341 in Modules/audioop.c.'>audioop_lin2alaw</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a> <font color='red'>}</font>,
<a name='L1628'>    <font color='red'>{</font> "lin2lin", <a href='../S/2624.html#L1041' title='Defined at 1041 in Modules/audioop.c.'>audioop_lin2lin</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a> <font color='red'>}</font>,
<a name='L1629'>    <font color='red'>{</font> "adpcm2lin", <a href='../S/2624.html#L1517' title='Defined at 1517 in Modules/audioop.c.'>audioop_adpcm2lin</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a> <font color='red'>}</font>,
<a name='L1630'>    <font color='red'>{</font> "lin2adpcm", <a href='../S/2624.html#L1410' title='Defined at 1410 in Modules/audioop.c.'>audioop_lin2adpcm</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a> <font color='red'>}</font>,
<a name='L1631'>    <font color='red'>{</font> "tomono", <a href='../S/2624.html#L796' title='Defined at 796 in Modules/audioop.c.'>audioop_tomono</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a> <font color='red'>}</font>,
<a name='L1632'>    <font color='red'>{</font> "tostereo", <a href='../S/2624.html#L857' title='Defined at 857 in Modules/audioop.c.'>audioop_tostereo</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a> <font color='red'>}</font>,
<a name='L1633'>    <font color='red'>{</font> "getsample", <a href='../S/2624.html#L324' title='Defined at 324 in Modules/audioop.c.'>audioop_getsample</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a> <font color='red'>}</font>,
<a name='L1634'>    <font color='red'>{</font> "reverse", <a href='../S/2624.html#L1006' title='Defined at 1006 in Modules/audioop.c.'>audioop_reverse</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a> <font color='red'>}</font>,
<a name='L1635'>    <font color='red'>{</font> "ratecv", <a href='../S/2624.html#L1092' title='Defined at 1092 in Modules/audioop.c.'>audioop_ratecv</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a> <font color='red'>}</font>,
<a name='L1636'>    <font color='red'>{</font> 0,          0 <font color='red'>}</font>
<a name='L1637'><font color='red'>}</font>;
<a name='L1638'>
<a name='L1639'>
<a name='L1640'><b>static</b> <b>struct</b> <a href='../D/3534.html' title='Multiple defined in 2 places.'>PyModuleDef</a> audioopmodule = <font color='red'>{</font>
<a name='L1641'>    <a href='../S/542.html#L33' title='Defined at 33 in Include/moduleobject.h.'>PyModuleDef_HEAD_INIT</a>,
<a name='L1642'>    "audioop",
<a name='L1643'>    <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L1644'>    -1,
<a name='L1645'>    audioop_methods,
<a name='L1646'>    <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L1647'>    <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L1648'>    <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L1649'>    <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>
<a name='L1650'><font color='red'>}</font>;
<a name='L1651'>
<a name='L1652'><a href='../D/3482.html' title='Multiple defined in 10 places.'>PyMODINIT_FUNC</a>
<a name='L1653'><a href='../R/3047.html' title='Multiple refered from 2 places.'>PyInit_audioop</a>(<b>void</b>)
<a name='L1654'><font color='red'>{</font>
<a name='L1655'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *m, *d;
<a name='L1656'>    m = PyModule_Create(&amp;audioopmodule);
<a name='L1657'>    <b>if</b> (m == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1658'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1659'>    d = <a href='../S/2802.html#L159' title='Defined at 159 in Objects/moduleobject.c.'>PyModule_GetDict</a>(m);
<a name='L1660'>    <b>if</b> (d == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1661'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1662'>    AudioopError = <a href='../S/3106.html#L621' title='Defined at 621 in Python/errors.c.'>PyErr_NewException</a>("audioop.error", <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L1663'>    <b>if</b> (AudioopError != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1664'>         <a href='../S/2787.html#L2180' title='Defined at 2180 in Objects/dictobject.c.'>PyDict_SetItemString</a>(d,"error",AudioopError);
<a name='L1665'>    <b>return</b> m;
<a name='L1666'><font color='red'>}</font>
</pre>
<hr>
<a name='BOTTOM'>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L56'>[^]</a><a href='#L1653'>[v]</a><a href='#TOP'>[top]</a>[bottom]<a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
</body>
</html>
