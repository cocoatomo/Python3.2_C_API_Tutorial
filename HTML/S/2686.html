<html>
<head>
<title>Modules/main.c</title>
<meta name='robots' content='noindex,nofollow'>
<meta name='generator' content='GLOBAL-5.8.1'>
</head>
<body text='#191970' bgcolor='#f5f5dc' vlink='gray'>
<a name='TOP'><h2><a href='../mains.html'>root</a>/<a href='../files/3353.html'>Modules</a>/main.c</h2>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L106'>[^]</a><a href='#L737'>[v]</a>[top]<a href='#BOTTOM'>[bottom]</a><a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
<hr>
<h2>DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href='#L106' title='Defined at 106.'>usage</a>
<li><a href='#L135' title='Defined at 135.'>RunStartupFile</a>
<li><a href='#L159' title='Defined at 159.'>RunModule</a>
<li><a href='#L205' title='Defined at 205.'>RunMainFromImporter</a>
<li><a href='#L246' title='Defined at 246.'>run_command</a>
<li><a href='#L269' title='Defined at 269.'>run_file</a>
<li><a href='#L306' title='Defined at 306.'>Py_Main</a>
<li><a href='#L737' title='Defined at 737.'>Py_GetArgcArgv</a>
</ol>
<hr>
<pre>
<a name='L1'><i><font color='green'>/* Python interpreter main program */</font></i>
<a name='L2'>
<a name='L3'><font color='darkred'>#include</font> "<a href='570.html'>Python.h</a>"
<a name='L4'><font color='darkred'>#include</font> "<a href='547.html'>osdefs.h</a>"
<a name='L5'>
<a name='L6'><font color='darkred'>#include</font> &lt;locale.h&gt;
<a name='L7'>
<a name='L8'><font color='darkred'>#ifdef</font> __VMS
<a name='L9'><font color='darkred'>#include</font> &lt;unixlib.h&gt;
<a name='L10'><font color='darkred'>#endif</font>
<a name='L11'>
<a name='L12'><font color='darkred'>#if</font> <b>defined</b>(<a href='../S/2906.html#L81' title='Defined at 81 in PC/pyconfig.h.'>MS_WINDOWS</a>) || <b>defined</b>(__CYGWIN__)
<a name='L13'><font color='darkred'>#include</font> &lt;windows.h&gt;
<a name='L14'><font color='darkred'>#ifdef</font> <a href='../D/1484.html' title='Multiple defined in 4 places.'>HAVE_FCNTL_H</a>
<a name='L15'><font color='darkred'>#include</font> &lt;fcntl.h&gt;
<a name='L16'><font color='darkred'>#define</font> <a href='../R/2227.html' title='Multiple refered from 16 places.'>PATH_MAX</a> <a href='../D/2043.html' title='Multiple defined in 8 places.'>MAXPATHLEN</a>
<a name='L17'><font color='darkred'>#endif</font>
<a name='L18'><font color='darkred'>#endif</font>
<a name='L19'>
<a name='L20'><font color='darkred'>#ifdef</font> _MSC_VER
<a name='L21'><font color='darkred'>#include</font> &lt;crtdbg.h&gt;
<a name='L22'><font color='darkred'>#endif</font>
<a name='L23'>
<a name='L24'><font color='darkred'>#if</font> (<b>defined</b>(<a href='../D/2567.html' title='Multiple defined in 2 places.'>PYOS_OS2</a>) &amp;&amp; !<b>defined</b>(<a href='../S/2894.html#L13' title='Defined at 13 in PC/os2emx/pyconfig.h.'>PYCC_GCC</a>)) || <b>defined</b>(<a href='../S/2906.html#L81' title='Defined at 81 in PC/pyconfig.h.'>MS_WINDOWS</a>)
<a name='L25'><font color='darkred'>#define</font> <a href='../S/2686.html#L118' title='Refered from 118 in Modules/main.c.'>PYTHONHOMEHELP</a> "&lt;prefix&gt;\\lib"
<a name='L26'><font color='darkred'>#else</font>
<a name='L27'><font color='darkred'>#if</font> <b>defined</b>(<a href='../D/2567.html' title='Multiple defined in 2 places.'>PYOS_OS2</a>) &amp;&amp; <b>defined</b>(<a href='../S/2894.html#L13' title='Defined at 13 in PC/os2emx/pyconfig.h.'>PYCC_GCC</a>)
<a name='L28'><font color='darkred'>#define</font> <a href='../S/2686.html#L118' title='Refered from 118 in Modules/main.c.'>PYTHONHOMEHELP</a> "&lt;prefix&gt;/Lib"
<a name='L29'><font color='darkred'>#else</font>
<a name='L30'><font color='darkred'>#define</font> <a href='../S/2686.html#L118' title='Refered from 118 in Modules/main.c.'>PYTHONHOMEHELP</a> "&lt;prefix&gt;/pythonX.X"
<a name='L31'><font color='darkred'>#endif</font>
<a name='L32'><font color='darkred'>#endif</font>
<a name='L33'>
<a name='L34'><font color='darkred'>#include</font> "<a href='561.html'>pygetopt.h</a>"
<a name='L35'>
<a name='L36'><font color='darkred'>#define</font> <a href='../S/2686.html#L605' title='Refered from 605 in Modules/main.c.'>COPYRIGHT</a> \
<a name='L37'>    "Type \"help\", \"copyright\", \"credits\" or \"license\" " \
<a name='L38'>    "for more information."
<a name='L39'>
<a name='L40'><font color='darkred'>#ifdef</font> __cplusplus
<a name='L41'><b>extern</b> "C" <font color='red'>{</font>
<a name='L42'><font color='darkred'>#endif</font>
<a name='L43'>
<a name='L44'><i><font color='green'>/* For Py_GetArgcArgv(); set by main() */</font></i>
<a name='L45'><b>static</b> wchar_t **orig_argv;
<a name='L46'><b>static</b> <b>int</b>  orig_argc;
<a name='L47'>
<a name='L48'><i><font color='green'>/* command line options */</font></i>
<a name='L49'><font color='darkred'>#define</font> <a href='../S/2686.html#L51' title='Refered from 51 in Modules/main.c.'>BASE_OPTS</a> L"bBc:dEhiJm:OqsStuvVW:xX:?"
<a name='L50'>
<a name='L51'><font color='darkred'>#define</font> <a href='../S/2686.html#L332' title='Refered from 332 in Modules/main.c.'>PROGRAM_OPTS</a> <a href='../S/2686.html#L49' title='Defined at 49 in Modules/main.c.'>BASE_OPTS</a>
<a name='L52'>
<a name='L53'><i><font color='green'>/* Short usage message (with %s for argv0) */</font></i>
<a name='L54'><b>static</b> <b>char</b> *usage_line =
<a name='L55'>"usage: %ls [option] ... [-c cmd | -m mod | file | -] [arg] ...\n";
<a name='L56'>
<a name='L57'><i><font color='green'>/* Long usage message, split into parts &lt; 512 bytes */</font></i>
<a name='L58'><b>static</b> <b>char</b> *usage_1 = "\
<a name='L59'>Options and arguments (and corresponding environment variables):\n\
<a name='L60'>-b     : issue warnings about str(bytes_instance), str(bytearray_instance)\n\
<a name='L61'>         and comparing bytes/bytearray with str. (-bb: issue errors)\n\
<a name='L62'>-B     : don't write .py[co] files on import; also PYTHONDONTWRITEBYTECODE=x\n\
<a name='L63'>-c cmd : program passed in as string (terminates option list)\n\
<a name='L64'>-d     : debug output from parser; also PYTHONDEBUG=x\n\
<a name='L65'>-E     : ignore PYTHON* environment variables (such as PYTHONPATH)\n\
<a name='L66'>-h     : print this help message and exit (also --help)\n\
<a name='L67'>";
<a name='L68'><b>static</b> <b>char</b> *usage_2 = "\
<a name='L69'>-i     : inspect interactively after running script; forces a prompt even\n\
<a name='L70'>         if stdin does not appear to be a terminal; also PYTHONINSPECT=x\n\
<a name='L71'>-m mod : run library module as a script (terminates option list)\n\
<a name='L72'>-O     : optimize generated bytecode slightly; also PYTHONOPTIMIZE=x\n\
<a name='L73'>-OO    : remove doc-strings in addition to the -O optimizations\n\
<a name='L74'>-q     : don't print version and copyright messages on interactive startup\n\
<a name='L75'>-s     : don't add user site directory to sys.path; also PYTHONNOUSERSITE\n\
<a name='L76'>-S     : don't imply 'import site' on initialization\n\
<a name='L77'>";
<a name='L78'><b>static</b> <b>char</b> *usage_3 = "\
<a name='L79'>-u     : unbuffered binary stdout and stderr; also PYTHONUNBUFFERED=x\n\
<a name='L80'>         see man page for details on internal buffering relating to '-u'\n\
<a name='L81'>-v     : verbose (trace import statements); also PYTHONVERBOSE=x\n\
<a name='L82'>         can be supplied multiple times to increase verbosity\n\
<a name='L83'>-V     : print the Python version number and exit (also --version)\n\
<a name='L84'>-W arg : warning control; arg is action:message:category:module:lineno\n\
<a name='L85'>         also PYTHONWARNINGS=arg\n\
<a name='L86'>-x     : skip first line of source, allowing use of non-Unix forms of #!cmd\n\
<a name='L87'>-X opt : set implementation-specific option\n\
<a name='L88'>";
<a name='L89'><b>static</b> <b>char</b> *usage_4 = "\
<a name='L90'>file   : program read from script file\n\
<a name='L91'>-      : program read from stdin (default; interactive mode if a tty)\n\
<a name='L92'>arg ...: arguments passed to program in sys.argv[1:]\n\n\
<a name='L93'>Other environment variables:\n\
<a name='L94'>PYTHONSTARTUP: file executed on interactive startup (no default)\n\
<a name='L95'>PYTHONPATH   : '%c'-separated list of directories prefixed to the\n\
<a name='L96'>               default module search path.  The result is sys.path.\n\
<a name='L97'>";
<a name='L98'><b>static</b> <b>char</b> *usage_5 =
<a name='L99'>"PYTHONHOME   : alternate &lt;prefix&gt; directory (or &lt;prefix&gt;%c&lt;exec_prefix&gt;).\n"
<a name='L100'>"               The default module search path uses %s.\n"
<a name='L101'>"PYTHONCASEOK : ignore case in 'import' statements (Windows).\n"
<a name='L102'>"PYTHONIOENCODING: Encoding[:errors] used for stdin/stdout/stderr.\n"
<a name='L103'>;
<a name='L104'>
<a name='L105'><b>static</b> <b>int</b>
<a name='L106'><a href='../R/11196.html' title='Multiple refered from 5 places.'>usage</a>(<b>int</b> exitcode, wchar_t* program)
<a name='L107'><font color='red'>{</font>
<a name='L108'>    FILE *f = exitcode ? stderr : stdout;
<a name='L109'>
<a name='L110'>    fprintf(f, usage_line, program);
<a name='L111'>    <b>if</b> (exitcode)
<a name='L112'>        fprintf(f, "Try `python -h' for more information.\n");
<a name='L113'>    <b>else</b> <font color='red'>{</font>
<a name='L114'>        fputs(usage_1, f);
<a name='L115'>        fputs(usage_2, f);
<a name='L116'>        fputs(usage_3, f);
<a name='L117'>        fprintf(f, usage_4, <a href='../D/776.html' title='Multiple defined in 2 places.'>DELIM</a>);
<a name='L118'>        fprintf(f, usage_5, <a href='../D/776.html' title='Multiple defined in 2 places.'>DELIM</a>, <a href='../D/2580.html' title='Multiple defined in 3 places.'>PYTHONHOMEHELP</a>);
<a name='L119'>    <font color='red'>}</font>
<a name='L120'><font color='darkred'>#if</font> <b>defined</b>(__VMS)
<a name='L121'>    <b>if</b> (exitcode == 0) <font color='red'>{</font>
<a name='L122'>        <i><font color='green'>/* suppress 'error' message */</font></i>
<a name='L123'>        <b>return</b> 1;
<a name='L124'>    <font color='red'>}</font>
<a name='L125'>    <b>else</b> <font color='red'>{</font>
<a name='L126'>        <i><font color='green'>/* STS$M_INHIB_MSG + SS$_ABORT */</font></i>
<a name='L127'>        <b>return</b> 0x1000002c;
<a name='L128'>    <font color='red'>}</font>
<a name='L129'><font color='darkred'>#else</font>
<a name='L130'>    <b>return</b> exitcode;
<a name='L131'><font color='darkred'>#endif</font>
<a name='L132'>    <i><font color='green'>/*NOTREACHED*/</font></i>
<a name='L133'><font color='red'>}</font>
<a name='L134'>
<a name='L135'><b>static</b> <b>void</b> <a href='../S/2686.html#L642' title='Refered from 642 in Modules/main.c.'>RunStartupFile</a>(PyCompilerFlags *cf)
<a name='L136'><font color='red'>{</font>
<a name='L137'>    <b>char</b> *startup = Py_GETENV("PYTHONSTARTUP");
<a name='L138'>    <b>if</b> (startup != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; startup[0] != '\0') <font color='red'>{</font>
<a name='L139'>        FILE *fp = fopen(startup, "r");
<a name='L140'>        <b>if</b> (fp != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L141'>            (<b>void</b>) <a href='../S/3138.html#L1200' title='Defined at 1200 in Python/pythonrun.c.'>PyRun_SimpleFileExFlags</a>(fp, startup, 0, cf);
<a name='L142'>            <a href='../S/3106.html#L318' title='Defined at 318 in Python/errors.c.'>PyErr_Clear</a>();
<a name='L143'>            fclose(fp);
<a name='L144'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L145'>            <b>int</b> save_errno;
<a name='L146'>
<a name='L147'>            save_errno = errno;
<a name='L148'>            <a href='../D/3819.html' title='Multiple defined in 2 places.'>PySys_WriteStderr</a>("Could not open PYTHONSTARTUP\n");
<a name='L149'>            errno = save_errno;
<a name='L150'>            <a href='../S/3106.html#L430' title='Defined at 430 in Python/errors.c.'>PyErr_SetFromErrnoWithFilename</a>(PyExc_IOError,
<a name='L151'>                            startup);
<a name='L152'>            <a href='../S/3138.html#L1342' title='Defined at 1342 in Python/pythonrun.c.'>PyErr_Print</a>();
<a name='L153'>            <a href='../S/3106.html#L318' title='Defined at 318 in Python/errors.c.'>PyErr_Clear</a>();
<a name='L154'>        <font color='red'>}</font>
<a name='L155'>    <font color='red'>}</font>
<a name='L156'><font color='red'>}</font>
<a name='L157'>
<a name='L158'>
<a name='L159'><b>static</b> <b>int</b> <a href='../R/4013.html' title='Multiple refered from 2 places.'>RunModule</a>(wchar_t *modname, <b>int</b> set_argv0)
<a name='L160'><font color='red'>{</font>
<a name='L161'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *module, *runpy, *runmodule, *runargs, *<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L162'>    runpy = <a href='../S/3120.html#L2325' title='Defined at 2325 in Python/import.c.'>PyImport_ImportModule</a>("runpy");
<a name='L163'>    <b>if</b> (runpy == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L164'>        fprintf(stderr, "Could not import runpy module\n");
<a name='L165'>        <b>return</b> -1;
<a name='L166'>    <font color='red'>}</font>
<a name='L167'>    runmodule = <a href='../S/2803.html#L779' title='Defined at 779 in Objects/object.c.'>PyObject_GetAttrString</a>(runpy, "_run_module_as_main");
<a name='L168'>    <b>if</b> (runmodule == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L169'>        fprintf(stderr, "Could not access runpy._run_module_as_main\n");
<a name='L170'>        Py_DECREF(runpy);
<a name='L171'>        <b>return</b> -1;
<a name='L172'>    <font color='red'>}</font>
<a name='L173'>    module = <a href='../D/4015.html' title='Multiple defined in 4 places.'>PyUnicode_FromWideChar</a>(modname, wcslen(modname));
<a name='L174'>    <b>if</b> (module == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L175'>        fprintf(stderr, "Could not convert module name to unicode\n");
<a name='L176'>        Py_DECREF(runpy);
<a name='L177'>        Py_DECREF(runmodule);
<a name='L178'>        <b>return</b> -1;
<a name='L179'>    <font color='red'>}</font>
<a name='L180'>    runargs = <a href='../D/4089.html' title='Multiple defined in 2 places.'>Py_BuildValue</a>("(Oi)", module, set_argv0);
<a name='L181'>    <b>if</b> (runargs == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L182'>        fprintf(stderr,
<a name='L183'>            "Could not create arguments for runpy._run_module_as_main\n");
<a name='L184'>        Py_DECREF(runpy);
<a name='L185'>        Py_DECREF(runmodule);
<a name='L186'>        Py_DECREF(module);
<a name='L187'>        <b>return</b> -1;
<a name='L188'>    <font color='red'>}</font>
<a name='L189'>    <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = <a href='../S/2775.html#L2141' title='Defined at 2141 in Objects/abstract.c.'>PyObject_Call</a>(runmodule, runargs, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L190'>    <b>if</b> (<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L191'>        <a href='../S/3138.html#L1342' title='Defined at 1342 in Python/pythonrun.c.'>PyErr_Print</a>();
<a name='L192'>    <font color='red'>}</font>
<a name='L193'>    Py_DECREF(runpy);
<a name='L194'>    Py_DECREF(runmodule);
<a name='L195'>    Py_DECREF(module);
<a name='L196'>    Py_DECREF(runargs);
<a name='L197'>    <b>if</b> (<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L198'>        <b>return</b> -1;
<a name='L199'>    <font color='red'>}</font>
<a name='L200'>    Py_DECREF(<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>);
<a name='L201'>    <b>return</b> 0;
<a name='L202'><font color='red'>}</font>
<a name='L203'>
<a name='L204'><b>static</b> <b>int</b>
<a name='L205'><a href='../S/2686.html#L649' title='Refered from 649 in Modules/main.c.'>RunMainFromImporter</a>(wchar_t *filename)
<a name='L206'><font color='red'>{</font>
<a name='L207'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *argv0 = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, *importer, *sys_path;
<a name='L208'>    <b>int</b> sts;
<a name='L209'>
<a name='L210'>    argv0 = <a href='../D/4015.html' title='Multiple defined in 4 places.'>PyUnicode_FromWideChar</a>(filename, wcslen(filename));
<a name='L211'>    <b>if</b> (argv0 == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L212'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L213'>
<a name='L214'>    importer = PyImport_GetImporter(argv0);
<a name='L215'>    <b>if</b> (importer == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L216'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L217'>
<a name='L218'>    <b>if</b> (importer-&gt;ob_type == &amp;PyNullImporter_Type) <font color='red'>{</font>
<a name='L219'>        Py_DECREF(argv0);
<a name='L220'>        Py_DECREF(importer);
<a name='L221'>        <b>return</b> -1;
<a name='L222'>    <font color='red'>}</font>
<a name='L223'>    Py_DECREF(importer);
<a name='L224'>
<a name='L225'>    <i><font color='green'>/* argv0 is usable as an import source, so put it in sys.path[0]</font></i>
<a name='L226'><i><font color='green'>       and import __main__ */</font></i>
<a name='L227'>    sys_path = <a href='../S/3144.html#L44' title='Defined at 44 in Python/sysmodule.c.'>PySys_GetObject</a>("path");
<a name='L228'>    <b>if</b> (sys_path == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L229'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L230'>    <b>if</b> (<a href='../S/2796.html#L199' title='Defined at 199 in Objects/listobject.c.'>PyList_SetItem</a>(sys_path, 0, argv0)) <font color='red'>{</font>
<a name='L231'>        argv0 = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L232'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L233'>    <font color='red'>}</font>
<a name='L234'>    Py_INCREF(argv0);
<a name='L235'>
<a name='L236'>    sts = <a href='../S/2686.html#L159' title='Defined at 159 in Modules/main.c.'>RunModule</a>(L"__main__", 0);
<a name='L237'>    <b>return</b> sts != 0;
<a name='L238'>
<a name='L239'><a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>:
<a name='L240'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(argv0);
<a name='L241'>    <a href='../S/3138.html#L1342' title='Defined at 1342 in Python/pythonrun.c.'>PyErr_Print</a>();
<a name='L242'>    <b>return</b> 1;
<a name='L243'><font color='red'>}</font>
<a name='L244'>
<a name='L245'><b>static</b> <b>int</b>
<a name='L246'><a href='../S/2686.html#L633' title='Refered from 633 in Modules/main.c.'>run_command</a>(wchar_t *command, PyCompilerFlags *cf)
<a name='L247'><font color='red'>{</font>
<a name='L248'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *unicode, *<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>;
<a name='L249'>    <b>int</b> ret;
<a name='L250'>
<a name='L251'>    unicode = <a href='../D/4015.html' title='Multiple defined in 4 places.'>PyUnicode_FromWideChar</a>(command, -1);
<a name='L252'>    <b>if</b> (unicode == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L253'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L254'>    <a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> = <a href='../D/3959.html' title='Multiple defined in 3 places.'>PyUnicode_AsUTF8String</a>(unicode);
<a name='L255'>    Py_DECREF(unicode);
<a name='L256'>    <b>if</b> (<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L257'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L258'>    ret = <a href='../S/3138.html#L1260' title='Defined at 1260 in Python/pythonrun.c.'>PyRun_SimpleStringFlags</a>(<a href='../S/2779.html#L517' title='Defined at 517 in Objects/bytesobject.c.'>PyBytes_AsString</a>(<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>), cf);
<a name='L259'>    Py_DECREF(<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>);
<a name='L260'>    <b>return</b> ret != 0;
<a name='L261'>
<a name='L262'><a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>:
<a name='L263'>    <a href='../D/3819.html' title='Multiple defined in 2 places.'>PySys_WriteStderr</a>("Unable to decode the command from the command line:\n");
<a name='L264'>    <a href='../S/3138.html#L1342' title='Defined at 1342 in Python/pythonrun.c.'>PyErr_Print</a>();
<a name='L265'>    <b>return</b> 1;
<a name='L266'><font color='red'>}</font>
<a name='L267'>
<a name='L268'><b>static</b> <b>int</b>
<a name='L269'><a href='../S/2686.html#L692' title='Refered from 692 in Modules/main.c.'>run_file</a>(FILE *fp, <b>const</b> wchar_t *filename, PyCompilerFlags *p_cf)
<a name='L270'><font color='red'>{</font>
<a name='L271'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *unicode, *<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L272'>    <b>char</b> *filename_str;
<a name='L273'>    <b>int</b> run;
<a name='L274'>
<a name='L275'>    <i><font color='green'>/* call pending calls like signal handlers (SIGINT) */</font></i>
<a name='L276'>    <b>if</b> (<a href='../D/4194.html' title='Multiple defined in 2 places.'>Py_MakePendingCalls</a>() == -1) <font color='red'>{</font>
<a name='L277'>        <a href='../S/3138.html#L1342' title='Defined at 1342 in Python/pythonrun.c.'>PyErr_Print</a>();
<a name='L278'>        <b>return</b> 1;
<a name='L279'>    <font color='red'>}</font>
<a name='L280'>
<a name='L281'>    <b>if</b> (filename) <font color='red'>{</font>
<a name='L282'>        unicode = <a href='../D/4015.html' title='Multiple defined in 4 places.'>PyUnicode_FromWideChar</a>(filename, wcslen(filename));
<a name='L283'>        <b>if</b> (unicode != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L284'>            <a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> = <a href='../S/2828.html#L1585' title='Defined at 1585 in Objects/unicodeobject.c.'>PyUnicode_EncodeFSDefault</a>(unicode);
<a name='L285'>            Py_DECREF(unicode);
<a name='L286'>        <font color='red'>}</font>
<a name='L287'>        <b>if</b> (<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L288'>            filename_str = <a href='../S/2779.html#L517' title='Defined at 517 in Objects/bytesobject.c.'>PyBytes_AsString</a>(<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>);
<a name='L289'>        <b>else</b> <font color='red'>{</font>
<a name='L290'>            <a href='../S/3106.html#L318' title='Defined at 318 in Python/errors.c.'>PyErr_Clear</a>();
<a name='L291'>            filename_str = "&lt;encoding error&gt;";
<a name='L292'>        <font color='red'>}</font>
<a name='L293'>    <font color='red'>}</font>
<a name='L294'>    <b>else</b>
<a name='L295'>        filename_str = "&lt;stdin&gt;";
<a name='L296'>
<a name='L297'>    run = <a href='../S/3138.html#L1001' title='Defined at 1001 in Python/pythonrun.c.'>PyRun_AnyFileExFlags</a>(fp, filename_str, filename != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, p_cf);
<a name='L298'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>);
<a name='L299'>    <b>return</b> run != 0;
<a name='L300'><font color='red'>}</font>
<a name='L301'>
<a name='L302'>
<a name='L303'><i><font color='green'>/* Main program */</font></i>
<a name='L304'>
<a name='L305'><b>int</b>
<a name='L306'><a href='../R/3752.html' title='Multiple refered from 4 places.'>Py_Main</a>(<b>int</b> argc, wchar_t **argv)
<a name='L307'><font color='red'>{</font>
<a name='L308'>    <b>int</b> c;
<a name='L309'>    <b>int</b> sts;
<a name='L310'>    wchar_t *command = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L311'>    wchar_t *filename = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L312'>    wchar_t *module = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L313'>    FILE *fp = stdin;
<a name='L314'>    <b>char</b> *p;
<a name='L315'><font color='darkred'>#ifdef</font> <a href='../S/2906.html#L81' title='Defined at 81 in PC/pyconfig.h.'>MS_WINDOWS</a>
<a name='L316'>    wchar_t *wp;
<a name='L317'><font color='darkred'>#endif</font>
<a name='L318'>    <b>int</b> skipfirstline = 0;
<a name='L319'>    <b>int</b> stdin_is_interactive = 0;
<a name='L320'>    <b>int</b> help = 0;
<a name='L321'>    <b>int</b> version = 0;
<a name='L322'>    <b>int</b> saw_unbuffered_flag = 0;
<a name='L323'>    <a href='../S/571.html#L22' title='Defined at 22 in Include/pythonrun.h.'>PyCompilerFlags</a> cf;
<a name='L324'>
<a name='L325'>    cf.cf_flags = 0;
<a name='L326'>
<a name='L327'>    orig_argc = argc;           <i><font color='green'>/* For Py_GetArgcArgv() */</font></i>
<a name='L328'>    orig_argv = argv;
<a name='L329'>
<a name='L330'>    <a href='../S/3144.html#L1125' title='Defined at 1125 in Python/sysmodule.c.'>PySys_ResetWarnOptions</a>();
<a name='L331'>
<a name='L332'>    <b>while</b> ((c = <a href='../S/3116.html#L44' title='Defined at 44 in Python/getopt.c.'>_PyOS_GetOpt</a>(argc, argv, <a href='../S/2686.html#L51' title='Defined at 51 in Modules/main.c.'>PROGRAM_OPTS</a>)) != EOF) <font color='red'>{</font>
<a name='L333'>        <b>if</b> (c == 'c') <font color='red'>{</font>
<a name='L334'>            <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> len;
<a name='L335'>            <i><font color='green'>/* -c is the last option; following arguments</font></i>
<a name='L336'><i><font color='green'>               that look like options are left for the</font></i>
<a name='L337'><i><font color='green'>               command to interpret. */</font></i>
<a name='L338'>
<a name='L339'>            len = wcslen(_PyOS_optarg) + 1 + 1;
<a name='L340'>            command = (wchar_t *)malloc(<b>sizeof</b>(wchar_t) * len);
<a name='L341'>            <b>if</b> (command == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L342'>                <a href='../D/4129.html' title='Multiple defined in 2 places.'>Py_FatalError</a>(
<a name='L343'>                   "not enough memory to copy -c argument");
<a name='L344'>            wcscpy(command, _PyOS_optarg);
<a name='L345'>            command[len - 2] = '\n';
<a name='L346'>            command[len - 1] = 0;
<a name='L347'>            <b>break</b>;
<a name='L348'>        <font color='red'>}</font>
<a name='L349'>
<a name='L350'>        <b>if</b> (c == 'm') <font color='red'>{</font>
<a name='L351'>            <i><font color='green'>/* -m is the last option; following arguments</font></i>
<a name='L352'><i><font color='green'>               that look like options are left for the</font></i>
<a name='L353'><i><font color='green'>               module to interpret. */</font></i>
<a name='L354'>            module = _PyOS_optarg;
<a name='L355'>            <b>break</b>;
<a name='L356'>        <font color='red'>}</font>
<a name='L357'>
<a name='L358'>        <b>switch</b> (c) <font color='red'>{</font>
<a name='L359'>        <b>case</b> 'b':
<a name='L360'>            Py_BytesWarningFlag++;
<a name='L361'>            <b>break</b>;
<a name='L362'>
<a name='L363'>        <b>case</b> 'd':
<a name='L364'>            Py_DebugFlag++;
<a name='L365'>            <b>break</b>;
<a name='L366'>
<a name='L367'>        <b>case</b> 'i':
<a name='L368'>            Py_InspectFlag++;
<a name='L369'>            Py_InteractiveFlag++;
<a name='L370'>            <b>break</b>;
<a name='L371'>
<a name='L372'>        <i><font color='green'>/* case 'J': reserved for Jython */</font></i>
<a name='L373'>
<a name='L374'>        <b>case</b> 'O':
<a name='L375'>            Py_OptimizeFlag++;
<a name='L376'>            <b>break</b>;
<a name='L377'>
<a name='L378'>        <b>case</b> 'B':
<a name='L379'>            Py_DontWriteBytecodeFlag++;
<a name='L380'>            <b>break</b>;
<a name='L381'>
<a name='L382'>        <b>case</b> 's':
<a name='L383'>            Py_NoUserSiteDirectory++;
<a name='L384'>            <b>break</b>;
<a name='L385'>
<a name='L386'>        <b>case</b> 'S':
<a name='L387'>            Py_NoSiteFlag++;
<a name='L388'>            <b>break</b>;
<a name='L389'>
<a name='L390'>        <b>case</b> 'E':
<a name='L391'>            Py_IgnoreEnvironmentFlag++;
<a name='L392'>            <b>break</b>;
<a name='L393'>
<a name='L394'>        <b>case</b> 't':
<a name='L395'>            <i><font color='green'>/* ignored for backwards compatibility */</font></i>
<a name='L396'>            <b>break</b>;
<a name='L397'>
<a name='L398'>        <b>case</b> 'u':
<a name='L399'>            Py_UnbufferedStdioFlag = 1;
<a name='L400'>            saw_unbuffered_flag = 1;
<a name='L401'>            <b>break</b>;
<a name='L402'>
<a name='L403'>        <b>case</b> 'v':
<a name='L404'>            Py_VerboseFlag++;
<a name='L405'>            <b>break</b>;
<a name='L406'>
<a name='L407'>        <b>case</b> 'x':
<a name='L408'>            skipfirstline = 1;
<a name='L409'>            <b>break</b>;
<a name='L410'>
<a name='L411'>        <b>case</b> 'h':
<a name='L412'>        <b>case</b> '?':
<a name='L413'>            help++;
<a name='L414'>            <b>break</b>;
<a name='L415'>
<a name='L416'>        <b>case</b> 'V':
<a name='L417'>            version++;
<a name='L418'>            <b>break</b>;
<a name='L419'>
<a name='L420'>        <b>case</b> 'W':
<a name='L421'>            <a href='../S/3144.html#L1145' title='Defined at 1145 in Python/sysmodule.c.'>PySys_AddWarnOption</a>(_PyOS_optarg);
<a name='L422'>            <b>break</b>;
<a name='L423'>
<a name='L424'>        <b>case</b> 'X':
<a name='L425'>            <a href='../S/3144.html#L1174' title='Defined at 1174 in Python/sysmodule.c.'>PySys_AddXOption</a>(_PyOS_optarg);
<a name='L426'>            <b>break</b>;
<a name='L427'>
<a name='L428'>        <b>case</b> 'q':
<a name='L429'>            Py_QuietFlag++;
<a name='L430'>            <b>break</b>;
<a name='L431'>
<a name='L432'>        <i><font color='green'>/* This space reserved for other options */</font></i>
<a name='L433'>
<a name='L434'>        <b>default</b>:
<a name='L435'>            <b>return</b> <a href='../S/2686.html#L106' title='Defined at 106 in Modules/main.c.'>usage</a>(2, argv[0]);
<a name='L436'>            <i><font color='green'>/*NOTREACHED*/</font></i>
<a name='L437'>
<a name='L438'>        <font color='red'>}</font>
<a name='L439'>    <font color='red'>}</font>
<a name='L440'>
<a name='L441'>    <b>if</b> (help)
<a name='L442'>        <b>return</b> <a href='../S/2686.html#L106' title='Defined at 106 in Modules/main.c.'>usage</a>(0, argv[0]);
<a name='L443'>
<a name='L444'>    <b>if</b> (version) <font color='red'>{</font>
<a name='L445'>        fprintf(stderr, "Python %s\n", <a href='../S/549.html#L26' title='Defined at 26 in Include/patchlevel.h.'>PY_VERSION</a>);
<a name='L446'>        <b>return</b> 0;
<a name='L447'>    <font color='red'>}</font>
<a name='L448'>
<a name='L449'>    <b>if</b> (!Py_InspectFlag &amp;&amp;
<a name='L450'>        (p = Py_GETENV("PYTHONINSPECT")) &amp;&amp; *p != '\0')
<a name='L451'>        Py_InspectFlag = 1;
<a name='L452'>    <b>if</b> (!saw_unbuffered_flag &amp;&amp;
<a name='L453'>        (p = Py_GETENV("PYTHONUNBUFFERED")) &amp;&amp; *p != '\0')
<a name='L454'>        Py_UnbufferedStdioFlag = 1;
<a name='L455'>
<a name='L456'>    <b>if</b> (!Py_NoUserSiteDirectory &amp;&amp;
<a name='L457'>        (p = Py_GETENV("PYTHONNOUSERSITE")) &amp;&amp; *p != '\0')
<a name='L458'>        Py_NoUserSiteDirectory = 1;
<a name='L459'>
<a name='L460'><font color='darkred'>#ifdef</font> <a href='../S/2906.html#L81' title='Defined at 81 in PC/pyconfig.h.'>MS_WINDOWS</a>
<a name='L461'>    <b>if</b> (!Py_IgnoreEnvironmentFlag &amp;&amp; (wp = _wgetenv(L"PYTHONWARNINGS")) &amp;&amp;
<a name='L462'>        *wp != L'\0') <font color='red'>{</font>
<a name='L463'>        wchar_t *buf, *warning;
<a name='L464'>
<a name='L465'>        buf = (wchar_t *)malloc((wcslen(wp) + 1) * <b>sizeof</b>(wchar_t));
<a name='L466'>        <b>if</b> (buf == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L467'>            <a href='../D/4129.html' title='Multiple defined in 2 places.'>Py_FatalError</a>(
<a name='L468'>               "not enough memory to copy PYTHONWARNINGS");
<a name='L469'>        wcscpy(buf, wp);
<a name='L470'>        <b>for</b> (warning = wcstok(buf, L",");
<a name='L471'>             warning != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L472'>             warning = wcstok(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, L",")) <font color='red'>{</font>
<a name='L473'>            <a href='../S/3144.html#L1145' title='Defined at 1145 in Python/sysmodule.c.'>PySys_AddWarnOption</a>(warning);
<a name='L474'>        <font color='red'>}</font>
<a name='L475'>        free(buf);
<a name='L476'>    <font color='red'>}</font>
<a name='L477'><font color='darkred'>#else</font>
<a name='L478'>    <b>if</b> ((p = Py_GETENV("PYTHONWARNINGS")) &amp;&amp; *p != '\0') <font color='red'>{</font>
<a name='L479'>        <b>char</b> *buf, *oldloc;
<a name='L480'>        <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *unicode;
<a name='L481'>
<a name='L482'>        <i><font color='green'>/* settle for strtok here as there's no one standard</font></i>
<a name='L483'><i><font color='green'>           C89 wcstok */</font></i>
<a name='L484'>        buf = (<b>char</b> *)malloc(strlen(p) + 1);
<a name='L485'>        <b>if</b> (buf == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L486'>            <a href='../D/4129.html' title='Multiple defined in 2 places.'>Py_FatalError</a>(
<a name='L487'>               "not enough memory to copy PYTHONWARNINGS");
<a name='L488'>        strcpy(buf, p);
<a name='L489'>        oldloc = <a href='../D/11408.html' title='Multiple defined in 2 places.'>strdup</a>(setlocale(LC_ALL, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>));
<a name='L490'>        setlocale(LC_ALL, "");
<a name='L491'>        <b>for</b> (p = strtok(buf, ","); p != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>; p = strtok(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, ",")) <font color='red'>{</font>
<a name='L492'><font color='darkred'>#ifdef</font> __APPLE__
<a name='L493'>            <i><font color='green'>/* Use utf-8 on Mac OS X */</font></i>
<a name='L494'>            unicode = <a href='../D/4012.html' title='Multiple defined in 3 places.'>PyUnicode_FromString</a>(p);
<a name='L495'><font color='darkred'>#else</font>
<a name='L496'>            wchar_t *wchar;
<a name='L497'>            <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> len;
<a name='L498'>            wchar = <a href='../S/3107.html#L24' title='Defined at 24 in Python/fileutils.c.'>_Py_char2wchar</a>(p, &amp;len);
<a name='L499'>            <b>if</b> (wchar == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L500'>                <b>continue</b>;
<a name='L501'>            unicode = <a href='../D/4015.html' title='Multiple defined in 4 places.'>PyUnicode_FromWideChar</a>(wchar, len);
<a name='L502'>            <a href='../S/2803.html#L1781' title='Defined at 1781 in Objects/object.c.'>PyMem_Free</a>(wchar);
<a name='L503'><font color='darkred'>#endif</font>
<a name='L504'>            <b>if</b> (unicode == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L505'>                <b>continue</b>;
<a name='L506'>            <a href='../S/3144.html#L1133' title='Defined at 1133 in Python/sysmodule.c.'>PySys_AddWarnOptionUnicode</a>(unicode);
<a name='L507'>            Py_DECREF(unicode);
<a name='L508'>        <font color='red'>}</font>
<a name='L509'>        setlocale(LC_ALL, oldloc);
<a name='L510'>        free(oldloc);
<a name='L511'>        free(buf);
<a name='L512'>    <font color='red'>}</font>
<a name='L513'><font color='darkred'>#endif</font>
<a name='L514'>
<a name='L515'>    <b>if</b> (command == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; module == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; _PyOS_optind &lt; argc &amp;&amp;
<a name='L516'>        wcscmp(argv[_PyOS_optind], L"-") != 0)
<a name='L517'>    <font color='red'>{</font>
<a name='L518'><font color='darkred'>#ifdef</font> __VMS
<a name='L519'>        filename = decc$translate_vms(argv[_PyOS_optind]);
<a name='L520'>        <b>if</b> (filename == (<b>char</b> *)0 || filename == (<b>char</b> *)-1)
<a name='L521'>            filename = argv[_PyOS_optind];
<a name='L522'>
<a name='L523'><font color='darkred'>#else</font>
<a name='L524'>        filename = argv[_PyOS_optind];
<a name='L525'><font color='darkred'>#endif</font>
<a name='L526'>    <font color='red'>}</font>
<a name='L527'>
<a name='L528'>    stdin_is_interactive = <a href='../S/3138.html#L2247' title='Defined at 2247 in Python/pythonrun.c.'>Py_FdIsInteractive</a>(stdin, (<b>char</b> *)0);
<a name='L529'>
<a name='L530'><font color='darkred'>#if</font> <b>defined</b>(<a href='../S/2906.html#L81' title='Defined at 81 in PC/pyconfig.h.'>MS_WINDOWS</a>) || <b>defined</b>(__CYGWIN__)
<a name='L531'>    <i><font color='green'>/* don't translate newlines (\r\n &lt;=&gt; \n) */</font></i>
<a name='L532'>    <a href='../S/2906.html#L247' title='Defined at 247 in PC/pyconfig.h.'>_setmode</a>(<a href='../S/2759.html#L50' title='Defined at 50 in Modules/zlib/minigzip.c.'>fileno</a>(stdin), O_BINARY);
<a name='L533'>    <a href='../S/2906.html#L247' title='Defined at 247 in PC/pyconfig.h.'>_setmode</a>(<a href='../S/2759.html#L50' title='Defined at 50 in Modules/zlib/minigzip.c.'>fileno</a>(stdout), O_BINARY);
<a name='L534'>    <a href='../S/2906.html#L247' title='Defined at 247 in PC/pyconfig.h.'>_setmode</a>(<a href='../S/2759.html#L50' title='Defined at 50 in Modules/zlib/minigzip.c.'>fileno</a>(stderr), O_BINARY);
<a name='L535'><font color='darkred'>#endif</font>
<a name='L536'>
<a name='L537'>    <b>if</b> (Py_UnbufferedStdioFlag) <font color='red'>{</font>
<a name='L538'><font color='darkred'>#ifdef</font> <a href='../D/1555.html' title='Multiple defined in 3 places.'>HAVE_SETVBUF</a>
<a name='L539'>        setvbuf(stdin,  (<b>char</b> *)<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, _IONBF, BUFSIZ);
<a name='L540'>        setvbuf(stdout, (<b>char</b> *)<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, _IONBF, BUFSIZ);
<a name='L541'>        setvbuf(stderr, (<b>char</b> *)<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, _IONBF, BUFSIZ);
<a name='L542'><font color='darkred'>#else</font> <i><font color='green'>/* !HAVE_SETVBUF */</font></i>
<a name='L543'>        setbuf(stdin,  (<b>char</b> *)<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L544'>        setbuf(stdout, (<b>char</b> *)<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L545'>        setbuf(stderr, (<b>char</b> *)<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L546'><font color='darkred'>#endif</font> <i><font color='green'>/* !HAVE_SETVBUF */</font></i>
<a name='L547'>    <font color='red'>}</font>
<a name='L548'>    <b>else</b> <b>if</b> (Py_InteractiveFlag) <font color='red'>{</font>
<a name='L549'><font color='darkred'>#ifdef</font> <a href='../S/2906.html#L81' title='Defined at 81 in PC/pyconfig.h.'>MS_WINDOWS</a>
<a name='L550'>        <i><font color='green'>/* Doesn't have to have line-buffered -- use unbuffered */</font></i>
<a name='L551'>        <i><font color='green'>/* Any set[v]buf(stdin, ...) screws up Tkinter :-( */</font></i>
<a name='L552'>        setvbuf(stdout, (<b>char</b> *)<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, _IONBF, BUFSIZ);
<a name='L553'><font color='darkred'>#else</font> <i><font color='green'>/* !MS_WINDOWS */</font></i>
<a name='L554'><font color='darkred'>#ifdef</font> <a href='../D/1555.html' title='Multiple defined in 3 places.'>HAVE_SETVBUF</a>
<a name='L555'>        setvbuf(stdin,  (<b>char</b> *)<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, _IOLBF, BUFSIZ);
<a name='L556'>        setvbuf(stdout, (<b>char</b> *)<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, _IOLBF, BUFSIZ);
<a name='L557'><font color='darkred'>#endif</font> <i><font color='green'>/* HAVE_SETVBUF */</font></i>
<a name='L558'><font color='darkred'>#endif</font> <i><font color='green'>/* !MS_WINDOWS */</font></i>
<a name='L559'>        <i><font color='green'>/* Leave stderr alone - it should be unbuffered anyway. */</font></i>
<a name='L560'>    <font color='red'>}</font>
<a name='L561'><font color='darkred'>#ifdef</font> __VMS
<a name='L562'>    <b>else</b> <font color='red'>{</font>
<a name='L563'>        setvbuf (stdout, (<b>char</b> *)<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, _IOLBF, BUFSIZ);
<a name='L564'>    <font color='red'>}</font>
<a name='L565'><font color='darkred'>#endif</font> <i><font color='green'>/* __VMS */</font></i>
<a name='L566'>
<a name='L567'><font color='darkred'>#ifdef</font> __APPLE__
<a name='L568'>    <i><font color='green'>/* On MacOS X, when the Python interpreter is embedded in an</font></i>
<a name='L569'><i><font color='green'>       application bundle, it gets executed by a bootstrapping script</font></i>
<a name='L570'><i><font color='green'>       that does os.execve() with an argv[0] that's different from the</font></i>
<a name='L571'><i><font color='green'>       actual Python executable. This is needed to keep the Finder happy,</font></i>
<a name='L572'><i><font color='green'>       or rather, to work around Apple's overly strict requirements of</font></i>
<a name='L573'><i><font color='green'>       the process name. However, we still need a usable sys.executable,</font></i>
<a name='L574'><i><font color='green'>       so the actual executable path is passed in an environment variable.</font></i>
<a name='L575'><i><font color='green'>       See Lib/plat-mac/bundlebuiler.py for details about the bootstrap</font></i>
<a name='L576'><i><font color='green'>       script. */</font></i>
<a name='L577'>    <b>if</b> ((p = Py_GETENV("PYTHONEXECUTABLE")) &amp;&amp; *p != '\0') <font color='red'>{</font>
<a name='L578'>        wchar_t* <a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>;
<a name='L579'>        <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> len = strlen(p);
<a name='L580'>        <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> r;
<a name='L581'>
<a name='L582'>        <a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a> = malloc(len * <b>sizeof</b>(wchar_t));
<a name='L583'>        <b>if</b> (<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a> == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L584'>            <a href='../D/4129.html' title='Multiple defined in 2 places.'>Py_FatalError</a>(
<a name='L585'>               "not enough memory to copy PYTHONEXECUTABLE");
<a name='L586'>        <font color='red'>}</font>
<a name='L587'>
<a name='L588'>        r = mbstowcs(<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>, p, len);
<a name='L589'>        <a href='../S/3138.html#L667' title='Defined at 667 in Python/pythonrun.c.'>Py_SetProgramName</a>(<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>);
<a name='L590'>        <i><font color='green'>/* buffer is now handed off - do not free */</font></i>
<a name='L591'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L592'>        <a href='../S/3138.html#L667' title='Defined at 667 in Python/pythonrun.c.'>Py_SetProgramName</a>(argv[0]);
<a name='L593'>    <font color='red'>}</font>
<a name='L594'><font color='darkred'>#else</font>
<a name='L595'>    <a href='../S/3138.html#L667' title='Defined at 667 in Python/pythonrun.c.'>Py_SetProgramName</a>(argv[0]);
<a name='L596'><font color='darkred'>#endif</font>
<a name='L597'>    <a href='../S/3138.html#L319' title='Defined at 319 in Python/pythonrun.c.'>Py_Initialize</a>();
<a name='L598'>
<a name='L599'>    <b>if</b> (!Py_QuietFlag &amp;&amp; (Py_VerboseFlag ||
<a name='L600'>                        (command == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; filename == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp;
<a name='L601'>                         module == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; stdin_is_interactive))) <font color='red'>{</font>
<a name='L602'>        fprintf(stderr, "Python %s on %s\n",
<a name='L603'>            <a href='../S/3118.html#L9' title='Defined at 9 in Python/getversion.c.'>Py_GetVersion</a>(), <a href='../S/3117.html#L9' title='Defined at 9 in Python/getplatform.c.'>Py_GetPlatform</a>());
<a name='L604'>        <b>if</b> (!Py_NoSiteFlag)
<a name='L605'>            fprintf(stderr, "%s\n", <a href='../S/2686.html#L36' title='Defined at 36 in Modules/main.c.'>COPYRIGHT</a>);
<a name='L606'>    <font color='red'>}</font>
<a name='L607'>
<a name='L608'>    <b>if</b> (command != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L609'>        <i><font color='green'>/* Backup _PyOS_optind and force sys.argv[0] = '-c' */</font></i>
<a name='L610'>        _PyOS_optind--;
<a name='L611'>        argv[_PyOS_optind] = L"-c";
<a name='L612'>    <font color='red'>}</font>
<a name='L613'>
<a name='L614'>    <b>if</b> (module != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L615'>        <i><font color='green'>/* Backup _PyOS_optind and force sys.argv[0] = '-m'*/</font></i>
<a name='L616'>        _PyOS_optind--;
<a name='L617'>        argv[_PyOS_optind] = L"-m";
<a name='L618'>    <font color='red'>}</font>
<a name='L619'>
<a name='L620'>    <a href='../S/3144.html#L1917' title='Defined at 1917 in Python/sysmodule.c.'>PySys_SetArgv</a>(argc-_PyOS_optind, argv+_PyOS_optind);
<a name='L621'>
<a name='L622'>    <b>if</b> ((Py_InspectFlag || (command == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; filename == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; module == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)) &amp;&amp;
<a name='L623'>        isatty(<a href='../S/2759.html#L50' title='Defined at 50 in Modules/zlib/minigzip.c.'>fileno</a>(stdin))) <font color='red'>{</font>
<a name='L624'>        <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *v;
<a name='L625'>        v = <a href='../S/3120.html#L2325' title='Defined at 2325 in Python/import.c.'>PyImport_ImportModule</a>("readline");
<a name='L626'>        <b>if</b> (v == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L627'>            <a href='../S/3106.html#L318' title='Defined at 318 in Python/errors.c.'>PyErr_Clear</a>();
<a name='L628'>        <b>else</b>
<a name='L629'>            Py_DECREF(v);
<a name='L630'>    <font color='red'>}</font>
<a name='L631'>
<a name='L632'>    <b>if</b> (command) <font color='red'>{</font>
<a name='L633'>        sts = <a href='../S/2686.html#L246' title='Defined at 246 in Modules/main.c.'>run_command</a>(command, &amp;cf);
<a name='L634'>        free(command);
<a name='L635'>    <font color='red'>}</font> <b>else</b> <b>if</b> (module) <font color='red'>{</font>
<a name='L636'>        sts = <a href='../S/2686.html#L159' title='Defined at 159 in Modules/main.c.'>RunModule</a>(module, 1);
<a name='L637'>    <font color='red'>}</font>
<a name='L638'>    <b>else</b> <font color='red'>{</font>
<a name='L639'>
<a name='L640'>        <b>if</b> (filename == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; stdin_is_interactive) <font color='red'>{</font>
<a name='L641'>            Py_InspectFlag = 0; <i><font color='green'>/* do exit on SystemExit */</font></i>
<a name='L642'>            <a href='../S/2686.html#L135' title='Defined at 135 in Modules/main.c.'>RunStartupFile</a>(&amp;cf);
<a name='L643'>        <font color='red'>}</font>
<a name='L644'>        <i><font color='green'>/* XXX */</font></i>
<a name='L645'>
<a name='L646'>        sts = -1;               <i><font color='green'>/* keep track of whether we've already run __main__ */</font></i>
<a name='L647'>
<a name='L648'>        <b>if</b> (filename != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L649'>            sts = <a href='../S/2686.html#L205' title='Defined at 205 in Modules/main.c.'>RunMainFromImporter</a>(filename);
<a name='L650'>        <font color='red'>}</font>
<a name='L651'>
<a name='L652'>        <b>if</b> (sts==-1 &amp;&amp; filename!=<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L653'>            fp = <a href='../S/3107.html#L267' title='Defined at 267 in Python/fileutils.c.'>_Py_wfopen</a>(filename, L"r");
<a name='L654'>            <b>if</b> (fp == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L655'>                <b>char</b> *cfilename_buffer;
<a name='L656'>                <b>const</b> <b>char</b> *cfilename;
<a name='L657'>                cfilename_buffer = <a href='../S/3107.html#L145' title='Defined at 145 in Python/fileutils.c.'>_Py_wchar2char</a>(filename, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L658'>                <b>if</b> (cfilename_buffer != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L659'>                    cfilename = cfilename_buffer;
<a name='L660'>                <b>else</b>
<a name='L661'>                    cfilename = "&lt;unprintable file name&gt;";
<a name='L662'>                fprintf(stderr, "%ls: can't open file '%s': [Errno %d] %s\n",
<a name='L663'>                    argv[0], cfilename, errno, strerror(errno));
<a name='L664'>                <b>if</b> (cfilename_buffer)
<a name='L665'>                    <a href='../S/2803.html#L1781' title='Defined at 1781 in Objects/object.c.'>PyMem_Free</a>(cfilename_buffer);
<a name='L666'>                <b>return</b> 2;
<a name='L667'>            <font color='red'>}</font>
<a name='L668'>            <b>else</b> <b>if</b> (skipfirstline) <font color='red'>{</font>
<a name='L669'>                <b>int</b> ch;
<a name='L670'>                <i><font color='green'>/* Push back first newline so line numbers</font></i>
<a name='L671'><i><font color='green'>                   remain the same */</font></i>
<a name='L672'>                <b>while</b> ((ch = getc(fp)) != EOF) <font color='red'>{</font>
<a name='L673'>                    <b>if</b> (ch == '\n') <font color='red'>{</font>
<a name='L674'>                        (<b>void</b>)ungetc(ch, fp);
<a name='L675'>                        <b>break</b>;
<a name='L676'>                    <font color='red'>}</font>
<a name='L677'>                <font color='red'>}</font>
<a name='L678'>            <font color='red'>}</font>
<a name='L679'>            <font color='red'>{</font>
<a name='L680'>                <i><font color='green'>/* XXX: does this work on Win/Win64? (see posix_fstat) */</font></i>
<a name='L681'>                <b>struct</b> stat sb;
<a name='L682'>                <b>if</b> (fstat(<a href='../S/2759.html#L50' title='Defined at 50 in Modules/zlib/minigzip.c.'>fileno</a>(fp), &amp;sb) == 0 &amp;&amp;
<a name='L683'>                    <a href='../S/565.html#L397' title='Defined at 397 in Include/pyport.h.'>S_ISDIR</a>(sb.st_mode)) <font color='red'>{</font>
<a name='L684'>                    fprintf(stderr, "%ls: '%ls' is a directory, cannot continue\n", argv[0], filename);
<a name='L685'>                    fclose(fp);
<a name='L686'>                    <b>return</b> 1;
<a name='L687'>                <font color='red'>}</font>
<a name='L688'>            <font color='red'>}</font>
<a name='L689'>        <font color='red'>}</font>
<a name='L690'>
<a name='L691'>        <b>if</b> (sts == -1)
<a name='L692'>            sts = <a href='../S/2686.html#L269' title='Defined at 269 in Modules/main.c.'>run_file</a>(fp, filename, &amp;cf);
<a name='L693'>    <font color='red'>}</font>
<a name='L694'>
<a name='L695'>    <i><font color='green'>/* Check this environment variable at the end, to give programs the</font></i>
<a name='L696'><i><font color='green'>     * opportunity to set it from Python.</font></i>
<a name='L697'><i><font color='green'>     */</font></i>
<a name='L698'>    <b>if</b> (!Py_InspectFlag &amp;&amp;
<a name='L699'>        (p = Py_GETENV("PYTHONINSPECT")) &amp;&amp; *p != '\0')
<a name='L700'>    <font color='red'>{</font>
<a name='L701'>        Py_InspectFlag = 1;
<a name='L702'>    <font color='red'>}</font>
<a name='L703'>
<a name='L704'>    <b>if</b> (Py_InspectFlag &amp;&amp; stdin_is_interactive &amp;&amp;
<a name='L705'>        (filename != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> || command != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> || module != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)) <font color='red'>{</font>
<a name='L706'>        Py_InspectFlag = 0;
<a name='L707'>        <i><font color='green'>/* XXX */</font></i>
<a name='L708'>        sts = <a href='../S/3138.html#L2393' title='Defined at 2393 in Python/pythonrun.c.'>PyRun_AnyFileFlags</a>(stdin, "&lt;stdin&gt;", &amp;cf) != 0;
<a name='L709'>    <font color='red'>}</font>
<a name='L710'>
<a name='L711'>    <a href='../S/3138.html#L370' title='Defined at 370 in Python/pythonrun.c.'>Py_Finalize</a>();
<a name='L712'>
<a name='L713'><font color='darkred'>#ifdef</font> __INSURE__
<a name='L714'>    <i><font color='green'>/* Insure++ is a memory analysis tool that aids in discovering</font></i>
<a name='L715'><i><font color='green'>     * memory leaks and other memory problems.  On Python exit, the</font></i>
<a name='L716'><i><font color='green'>     * interned string dictionaries are flagged as being in use at exit</font></i>
<a name='L717'><i><font color='green'>     * (which it is).  Under normal circumstances, this is fine because</font></i>
<a name='L718'><i><font color='green'>     * the memory will be automatically reclaimed by the system.  Under</font></i>
<a name='L719'><i><font color='green'>     * memory debugging, it's a huge source of useless noise, so we</font></i>
<a name='L720'><i><font color='green'>     * trade off slower shutdown for less distraction in the memory</font></i>
<a name='L721'><i><font color='green'>     * reports.  -baw</font></i>
<a name='L722'><i><font color='green'>     */</font></i>
<a name='L723'>    <a href='../S/2828.html#L10069' title='Defined at 10069 in Objects/unicodeobject.c.'>_Py_ReleaseInternedUnicodeStrings</a>();
<a name='L724'><font color='darkred'>#endif</font> <i><font color='green'>/* __INSURE__ */</font></i>
<a name='L725'>
<a name='L726'>    <b>return</b> sts;
<a name='L727'><font color='red'>}</font>
<a name='L728'>
<a name='L729'><i><font color='green'>/* this is gonna seem *real weird*, but if you put some other code between</font></i>
<a name='L730'><i><font color='green'>   Py_Main() and Py_GetArgcArgv() you will need to adjust the test in the</font></i>
<a name='L731'><i><font color='green'>   while statement in Misc/gdbinit:ppystack */</font></i>
<a name='L732'>
<a name='L733'><i><font color='green'>/* Make the *original* argc/argv available to other modules.</font></i>
<a name='L734'><i><font color='green'>   This is rare, but it is needed by the secureware extension. */</font></i>
<a name='L735'>
<a name='L736'><b>void</b>
<a name='L737'>Py_GetArgcArgv(<b>int</b> *argc, wchar_t ***argv)
<a name='L738'><font color='red'>{</font>
<a name='L739'>    *argc = orig_argc;
<a name='L740'>    *argv = orig_argv;
<a name='L741'><font color='red'>}</font>
<a name='L742'>
<a name='L743'><font color='darkred'>#ifdef</font> __cplusplus
<a name='L744'><font color='red'>}</font>
<a name='L745'><font color='darkred'>#endif</font>
</pre>
<hr>
<a name='BOTTOM'>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L106'>[^]</a><a href='#L737'>[v]</a><a href='#TOP'>[top]</a>[bottom]<a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
</body>
</html>
