<html>
<head>
<title>Modules/getaddrinfo.c</title>
<meta name='robots' content='noindex,nofollow'>
<meta name='generator' content='GLOBAL-5.8.1'>
</head>
<body text='#191970' bgcolor='#f5f5dc' vlink='gray'>
<a name='TOP'><h2><a href='../mains.html'>root</a>/<a href='../files/3353.html'>Modules</a>/getaddrinfo.c</h2>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L202'>[^]</a><a href='#L530'>[v]</a>[top]<a href='#BOTTOM'>[bottom]</a><a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
<hr>
<h2>DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href='#L202' title='Defined at 202.'>gai_strerror</a>
<li><a href='#L210' title='Defined at 210.'>freeaddrinfo</a>
<li><a href='#L224' title='Defined at 224.'>str_isnumber</a>
<li><a href='#L236' title='Defined at 236.'>getaddrinfo</a>
<li><a href='#L484' title='Defined at 484.'>get_name</a>
<li><a href='#L530' title='Defined at 530.'>get_addr</a>
</ol>
<hr>
<pre>
<a name='L1'><i><font color='green'>/*</font></i>
<a name='L2'><i><font color='green'> * Copyright (C) 1995, 1996, 1997, and 1998 WIDE Project.</font></i>
<a name='L3'><i><font color='green'> * All rights reserved.</font></i>
<a name='L4'><i><font color='green'> *</font></i>
<a name='L5'><i><font color='green'> * Redistribution and use in source and binary forms, with or without</font></i>
<a name='L6'><i><font color='green'> * modification, are permitted provided that the following conditions</font></i>
<a name='L7'><i><font color='green'> * are met:</font></i>
<a name='L8'><i><font color='green'> * 1. Redistributions of source code must retain the above copyright</font></i>
<a name='L9'><i><font color='green'> *    notice, this list of conditions and the following disclaimer.</font></i>
<a name='L10'><i><font color='green'> * 2. Redistributions in binary form must reproduce the above copyright</font></i>
<a name='L11'><i><font color='green'> *    notice, this list of conditions and the following disclaimer in the</font></i>
<a name='L12'><i><font color='green'> *    documentation and/or other materials provided with the distribution.</font></i>
<a name='L13'><i><font color='green'> * 3. Neither the name of the project nor the names of its contributors</font></i>
<a name='L14'><i><font color='green'> *    may be used to endorse or promote products derived from this software</font></i>
<a name='L15'><i><font color='green'> *    without specific prior written permission.</font></i>
<a name='L16'><i><font color='green'> *</font></i>
<a name='L17'><i><font color='green'> * THIS SOFTWARE IS PROVIDED BY THE PROJECT AND CONTRIBUTORS ``AS IS'' AND</font></i>
<a name='L18'><i><font color='green'> * GAI_ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</font></i>
<a name='L19'><i><font color='green'> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</font></i>
<a name='L20'><i><font color='green'> * ARE DISCLAIMED.  IN NO EVENT SHALL THE PROJECT OR CONTRIBUTORS BE LIABLE</font></i>
<a name='L21'><i><font color='green'> * FOR GAI_ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</font></i>
<a name='L22'><i><font color='green'> * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS</font></i>
<a name='L23'><i><font color='green'> * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)</font></i>
<a name='L24'><i><font color='green'> * HOWEVER CAUSED AND ON GAI_ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</font></i>
<a name='L25'><i><font color='green'> * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN GAI_ANY WAY</font></i>
<a name='L26'><i><font color='green'> * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</font></i>
<a name='L27'><i><font color='green'> * SUCH DAMAGE.</font></i>
<a name='L28'><i><font color='green'> */</font></i>
<a name='L29'>
<a name='L30'><i><font color='green'>/*</font></i>
<a name='L31'><i><font color='green'> * "#ifdef FAITH" part is local hack for supporting IPv4-v6 translator.</font></i>
<a name='L32'><i><font color='green'> *</font></i>
<a name='L33'><i><font color='green'> * Issues to be discussed:</font></i>
<a name='L34'><i><font color='green'> * - Thread safe-ness must be checked.</font></i>
<a name='L35'><i><font color='green'> * - Return values.  There are nonstandard return values defined and used</font></i>
<a name='L36'><i><font color='green'> *   in the source code.  This is because RFC2133 is silent about which error</font></i>
<a name='L37'><i><font color='green'> *   code must be returned for which situation.</font></i>
<a name='L38'><i><font color='green'> * - PF_UNSPEC case would be handled in getipnodebyname() with the AI_ALL flag.</font></i>
<a name='L39'><i><font color='green'> */</font></i>
<a name='L40'>
<a name='L41'><font color='darkred'>#if</font> 0
<a name='L42'><font color='darkred'>#include</font> &lt;sys/types.h&gt;
<a name='L43'><font color='darkred'>#include</font> &lt;sys/param.h&gt;
<a name='L44'><font color='darkred'>#include</font> &lt;sys/sysctl.h&gt;
<a name='L45'><font color='darkred'>#include</font> &lt;sys/socket.h&gt;
<a name='L46'><font color='darkred'>#include</font> &lt;netinet/in.h&gt;
<a name='L47'><font color='darkred'>#include</font> &lt;arpa/inet.h&gt;
<a name='L48'><font color='darkred'>#include</font> &lt;arpa/nameser.h&gt;
<a name='L49'><font color='darkred'>#include</font> &lt;netdb.h&gt;
<a name='L50'><font color='darkred'>#include</font> &lt;resolv.h&gt;
<a name='L51'><font color='darkred'>#include</font> &lt;string.h&gt;
<a name='L52'><font color='darkred'>#include</font> &lt;stdlib.h&gt;
<a name='L53'><font color='darkred'>#include</font> &lt;stddef.h&gt;
<a name='L54'><font color='darkred'>#include</font> &lt;<a href='2809.html'>ctype.h</a>&gt;
<a name='L55'><font color='darkred'>#include</font> &lt;unistd.h&gt;
<a name='L56'>
<a name='L57'><font color='darkred'>#include</font> "<a href='2620.html'>addrinfo.h</a>"
<a name='L58'><font color='darkred'>#endif</font>
<a name='L59'>
<a name='L60'><font color='darkred'>#if</font> <b>defined</b>(__KAME__) &amp;&amp; <b>defined</b>(<a href='../S/2712.html#L29' title='Defined at 29 in Modules/socketmodule.h.'>ENABLE_IPV6</a>)
<a name='L61'><font color='darkred'># define</font> <a href='../R/992.html' title='Multiple refered from 3 places.'>FAITH</a>
<a name='L62'><font color='darkred'>#endif</font>
<a name='L63'>
<a name='L64'><font color='darkred'>#define</font> <a href='../R/4437.html' title='Multiple refered from 4 places.'>SUCCESS</a> 0
<a name='L65'><font color='darkred'>#define</font> <a href='../R/1223.html' title='Multiple refered from 10 places.'>GAI_ANY</a> 0
<a name='L66'><font color='darkred'>#define</font> <a href='../R/5249.html' title='Multiple refered from 2 places.'>YES</a> 1
<a name='L67'><font color='darkred'>#define</font> <a href='../R/2097.html' title='Multiple refered from 2 places.'>NO</a>  0
<a name='L68'>
<a name='L69'><font color='darkred'>#ifdef</font> <a href='../S/2677.html#L61' title='Defined at 61 in Modules/getaddrinfo.c.'>FAITH</a>
<a name='L70'><b>static</b> <b>int</b> translate = <a href='../D/2315.html' title='Multiple defined in 2 places.'>NO</a>;
<a name='L71'><b>static</b> <b>struct</b> in6_addr faith_prefix = IN6ADDR_GAI_ANY_INIT;
<a name='L72'><font color='darkred'>#endif</font>
<a name='L73'>
<a name='L74'><b>static</b> <b>const</b> <b>char</b> in_addrany[] = <font color='red'>{</font> 0, 0, 0, 0 <font color='red'>}</font>;
<a name='L75'><b>static</b> <b>const</b> <b>char</b> in6_addrany[] = <font color='red'>{</font>
<a name='L76'>    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
<a name='L77'><font color='red'>}</font>;
<a name='L78'><b>static</b> <b>const</b> <b>char</b> in_loopback[] = <font color='red'>{</font> 127, 0, 0, 1 <font color='red'>}</font>;
<a name='L79'><b>static</b> <b>const</b> <b>char</b> in6_loopback[] = <font color='red'>{</font>
<a name='L80'>    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1
<a name='L81'><font color='red'>}</font>;
<a name='L82'>
<a name='L83'><b>struct</b> <a href='../R/10428.html' title='Multiple refered from 2 places.'>sockinet</a> <font color='red'>{</font>
<a name='L84'>    u_char      si_len;
<a name='L85'>    u_char      si_family;
<a name='L86'>    u_short     si_port;
<a name='L87'><font color='red'>}</font>;
<a name='L88'>
<a name='L89'><b>static</b> <b>struct</b> <a href='../R/7970.html' title='Multiple refered from 26 places.'>gai_afd</a> <font color='red'>{</font>
<a name='L90'>    <b>int</b> a_af;
<a name='L91'>    <b>int</b> a_addrlen;
<a name='L92'>    <b>int</b> a_socklen;
<a name='L93'>    <b>int</b> a_off;
<a name='L94'>    <b>const</b> <b>char</b> *a_addrany;
<a name='L95'>    <b>const</b> <b>char</b> *a_loopback;
<a name='L96'><font color='red'>}</font> gai_afdl [] = <font color='red'>{</font>
<a name='L97'><font color='darkred'>#ifdef</font> <a href='../S/2712.html#L29' title='Defined at 29 in Modules/socketmodule.h.'>ENABLE_IPV6</a>
<a name='L98'><font color='darkred'>#define</font> <a href='../R/2144.html' title='Multiple refered from 3 places.'>N_INET6</a> 0
<a name='L99'>    <font color='red'>{</font>PF_INET6, <b>sizeof</b>(<b>struct</b> in6_addr),
<a name='L100'>     <b>sizeof</b>(<b>struct</b> sockaddr_in6),
<a name='L101'>     <a href='../D/10194.html' title='Multiple defined in 2 places.'>offsetof</a>(<b>struct</b> sockaddr_in6, sin6_addr),
<a name='L102'>     in6_addrany, in6_loopback<font color='red'>}</font>,
<a name='L103'><font color='darkred'>#define</font> <a href='../R/2143.html' title='Multiple refered from 2 places.'>N_INET</a>  1
<a name='L104'><font color='darkred'>#else</font>
<a name='L105'><font color='darkred'>#define</font> <a href='../R/2143.html' title='Multiple refered from 2 places.'>N_INET</a>  0
<a name='L106'><font color='darkred'>#endif</font>
<a name='L107'>    <font color='red'>{</font>PF_INET, <b>sizeof</b>(<b>struct</b> in_addr),
<a name='L108'>     <b>sizeof</b>(<b>struct</b> sockaddr_in),
<a name='L109'>     <a href='../D/10194.html' title='Multiple defined in 2 places.'>offsetof</a>(<b>struct</b> sockaddr_in, sin_addr),
<a name='L110'>     in_addrany, in_loopback<font color='red'>}</font>,
<a name='L111'>    <font color='red'>{</font>0, 0, 0, 0, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>,
<a name='L112'><font color='red'>}</font>;
<a name='L113'>
<a name='L114'><font color='darkred'>#ifdef</font> <a href='../S/2712.html#L29' title='Defined at 29 in Modules/socketmodule.h.'>ENABLE_IPV6</a>
<a name='L115'><font color='darkred'>#define</font> <a href='../S/2677.html#L243' title='Refered from 243 in Modules/getaddrinfo.c.'>PTON_MAX</a>        16
<a name='L116'><font color='darkred'>#else</font>
<a name='L117'><font color='darkred'>#define</font> <a href='../S/2677.html#L243' title='Refered from 243 in Modules/getaddrinfo.c.'>PTON_MAX</a>        4
<a name='L118'><font color='darkred'>#endif</font>
<a name='L119'>
<a name='L120'><font color='darkred'>#ifndef</font> <a href='../S/2677.html#L121' title='Defined at 121 in Modules/getaddrinfo.c.'>IN_MULTICAST</a>
<a name='L121'><font color='darkred'>#define</font> <a href='../R/1570.html' title='Multiple refered from 3 places.'>IN_MULTICAST</a>(i)     (((i) &amp; 0xf0000000U) == 0xe0000000U)
<a name='L122'><font color='darkred'>#endif</font>
<a name='L123'>
<a name='L124'><font color='darkred'>#ifndef</font> <a href='../S/2677.html#L125' title='Defined at 125 in Modules/getaddrinfo.c.'>IN_EXPERIMENTAL</a>
<a name='L125'><font color='darkred'>#define</font> <a href='../R/1566.html' title='Multiple refered from 3 places.'>IN_EXPERIMENTAL</a>(i)  (((i) &amp; 0xe0000000U) == 0xe0000000U)
<a name='L126'><font color='darkred'>#endif</font>
<a name='L127'>
<a name='L128'><font color='darkred'>#ifndef</font> <a href='../S/2677.html#L129' title='Defined at 129 in Modules/getaddrinfo.c.'>IN_LOOPBACKNET</a>
<a name='L129'><font color='darkred'>#define</font> <a href='../R/1569.html' title='Multiple refered from 3 places.'>IN_LOOPBACKNET</a>      127
<a name='L130'><font color='darkred'>#endif</font>
<a name='L131'>
<a name='L132'><b>static</b> <b>int</b> <a href='../S/2677.html#L484' title='Defined at 484 in Modules/getaddrinfo.c.'>get_name</a>(<b>const</b> <b>char</b> *, <b>struct</b> gai_afd *,
<a name='L133'>                          <b>struct</b> addrinfo **, <b>char</b> *, <b>struct</b> addrinfo *,
<a name='L134'>                          <b>int</b>);
<a name='L135'><b>static</b> <b>int</b> <a href='../S/2677.html#L530' title='Defined at 530 in Modules/getaddrinfo.c.'>get_addr</a>(<b>const</b> <b>char</b> *, <b>int</b>, <b>struct</b> addrinfo **,
<a name='L136'>                        <b>struct</b> addrinfo *, <b>int</b>);
<a name='L137'><b>static</b> <b>int</b> <a href='../S/2677.html#L224' title='Defined at 224 in Modules/getaddrinfo.c.'>str_isnumber</a>(<b>const</b> <b>char</b> *);
<a name='L138'>
<a name='L139'><b>static</b> <b>char</b> *ai_errlist[] = <font color='red'>{</font>
<a name='L140'>    "success.",
<a name='L141'>    "address family for hostname not supported.",       <i><font color='green'>/* EAI_ADDRFAMILY */</font></i>
<a name='L142'>    "temporary failure in name resolution.",            <i><font color='green'>/* EAI_AGAIN      */</font></i>
<a name='L143'>    "invalid value for ai_flags.",                      <i><font color='green'>/* EAI_BADFLAGS   */</font></i>
<a name='L144'>    "non-recoverable failure in name resolution.",      <i><font color='green'>/* EAI_FAIL       */</font></i>
<a name='L145'>    "ai_family not supported.",                         <i><font color='green'>/* EAI_FAMILY     */</font></i>
<a name='L146'>    "memory allocation failure.",                       <i><font color='green'>/* EAI_MEMORY     */</font></i>
<a name='L147'>    "no address associated with hostname.",             <i><font color='green'>/* EAI_NODATA     */</font></i>
<a name='L148'>    "hostname nor servname provided, or not known.",<i><font color='green'>/* EAI_NONAME     */</font></i>
<a name='L149'>    "servname not supported for ai_socktype.",          <i><font color='green'>/* EAI_SERVICE    */</font></i>
<a name='L150'>    "ai_socktype not supported.",                       <i><font color='green'>/* EAI_SOCKTYPE   */</font></i>
<a name='L151'>    "system error returned in errno.",                  <i><font color='green'>/* EAI_SYSTEM     */</font></i>
<a name='L152'>    "invalid value for hints.",                         <i><font color='green'>/* EAI_BADHINTS   */</font></i>
<a name='L153'>    "resolved protocol is unknown.",                    <i><font color='green'>/* EAI_PROTOCOL   */</font></i>
<a name='L154'>    "unknown error.",                                   <i><font color='green'>/* EAI_MAX        */</font></i>
<a name='L155'><font color='red'>}</font>;
<a name='L156'>
<a name='L157'><font color='darkred'>#define</font> <a href='../R/1246.html' title='Multiple refered from 2 places.'>GET_CANONNAME</a>(ai, str) \
<a name='L158'><b>if</b> (pai-&gt;ai_flags &amp; <a href='../D/48.html' title='Multiple defined in 2 places.'>AI_CANONNAME</a>) <font color='red'>{</font>\
<a name='L159'>    <b>if</b> (((ai)-&gt;ai_canonname = (<b>char</b> *)malloc(strlen(str) + 1)) != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>\
<a name='L160'>        strcpy((ai)-&gt;ai_canonname, (str));\
<a name='L161'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>\
<a name='L162'>        <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a> = <a href='../D/882.html' title='Multiple defined in 2 places.'>EAI_MEMORY</a>;\
<a name='L163'>        <b>goto</b> free;\
<a name='L164'>    <font color='red'>}</font>\
<a name='L165'><font color='red'>}</font>
<a name='L166'>
<a name='L167'><font color='darkred'>#ifdef</font> HAVE_SOCKADDR_SA_LEN
<a name='L168'><font color='darkred'>#define</font> <a href='../R/1241.html' title='Multiple refered from 7 places.'>GET_AI</a>(ai, gai_afd, addr, port) <font color='red'>{</font>\
<a name='L169'>    <b>char</b> *p;\
<a name='L170'>    <b>if</b> (((ai) = (<b>struct</b> <a href='../S/2620.html#L127' title='Defined at 127 in Modules/addrinfo.h.'>addrinfo</a> *)malloc(<b>sizeof</b>(<b>struct</b> <a href='../S/2620.html#L127' title='Defined at 127 in Modules/addrinfo.h.'>addrinfo</a>) +\
<a name='L171'>                                          ((<a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a>)-&gt;a_socklen)))\
<a name='L172'>        == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <b>goto</b> free;\
<a name='L173'>    <a href='../D/9803.html' title='Multiple defined in 4 places.'>memcpy</a>(ai, pai, <b>sizeof</b>(<b>struct</b> <a href='../S/2620.html#L127' title='Defined at 127 in Modules/addrinfo.h.'>addrinfo</a>));\
<a name='L174'>    (ai)-&gt;ai_addr = (<b>struct</b> sockaddr *)((ai) + 1);\
<a name='L175'>    memset((ai)-&gt;ai_addr, 0, (<a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a>)-&gt;a_socklen);\
<a name='L176'>    (ai)-&gt;ai_addr-&gt;sa_len = (ai)-&gt;ai_addrlen = (<a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a>)-&gt;a_socklen;\
<a name='L177'>    (ai)-&gt;ai_addr-&gt;sa_family = (ai)-&gt;ai_family = (<a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a>)-&gt;a_af;\
<a name='L178'>    ((<b>struct</b> <a href='../S/2677.html#L83' title='Defined at 83 in Modules/getaddrinfo.c.'>sockinet</a> *)(ai)-&gt;ai_addr)-&gt;si_port = port;\
<a name='L179'>    p = (<b>char</b> *)((ai)-&gt;ai_addr);\
<a name='L180'>    <a href='../D/9803.html' title='Multiple defined in 4 places.'>memcpy</a>(p + (<a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a>)-&gt;a_off, (addr), (<a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a>)-&gt;a_addrlen);\
<a name='L181'><font color='red'>}</font>
<a name='L182'><font color='darkred'>#else</font>
<a name='L183'><font color='darkred'>#define</font> <a href='../R/1241.html' title='Multiple refered from 7 places.'>GET_AI</a>(ai, gai_afd, addr, port) <font color='red'>{</font>\
<a name='L184'>    <b>char</b> *p;\
<a name='L185'>    <b>if</b> (((ai) = (<b>struct</b> <a href='../S/2620.html#L127' title='Defined at 127 in Modules/addrinfo.h.'>addrinfo</a> *)malloc(<b>sizeof</b>(<b>struct</b> <a href='../S/2620.html#L127' title='Defined at 127 in Modules/addrinfo.h.'>addrinfo</a>) +\
<a name='L186'>                                          ((<a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a>)-&gt;a_socklen)))\
<a name='L187'>        == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <b>goto</b> free;\
<a name='L188'>    <a href='../D/9803.html' title='Multiple defined in 4 places.'>memcpy</a>(ai, pai, <b>sizeof</b>(<b>struct</b> <a href='../S/2620.html#L127' title='Defined at 127 in Modules/addrinfo.h.'>addrinfo</a>));\
<a name='L189'>    (ai)-&gt;ai_addr = (<b>struct</b> sockaddr *)((ai) + 1);\
<a name='L190'>    memset((ai)-&gt;ai_addr, 0, (<a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a>)-&gt;a_socklen);\
<a name='L191'>    (ai)-&gt;ai_addrlen = (<a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a>)-&gt;a_socklen;\
<a name='L192'>    (ai)-&gt;ai_addr-&gt;sa_family = (ai)-&gt;ai_family = (<a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a>)-&gt;a_af;\
<a name='L193'>    ((<b>struct</b> <a href='../S/2677.html#L83' title='Defined at 83 in Modules/getaddrinfo.c.'>sockinet</a> *)(ai)-&gt;ai_addr)-&gt;si_port = port;\
<a name='L194'>    p = (<b>char</b> *)((ai)-&gt;ai_addr);\
<a name='L195'>    <a href='../D/9803.html' title='Multiple defined in 4 places.'>memcpy</a>(p + (<a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a>)-&gt;a_off, (addr), (<a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a>)-&gt;a_addrlen);\
<a name='L196'><font color='red'>}</font>
<a name='L197'><font color='darkred'>#endif</font>
<a name='L198'>
<a name='L199'><font color='darkred'>#define</font> <a href='../R/882.html' title='Multiple refered from 30 places.'>ERR</a>(err) <font color='red'>{</font> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a> = (err); <b>goto</b> bad; <font color='red'>}</font>
<a name='L200'>
<a name='L201'><b>char</b> *
<a name='L202'><a href='../S/2711.html#L576' title='Refered from 576 in Modules/socketmodule.c.'>gai_strerror</a>(<b>int</b> ecode)
<a name='L203'><font color='red'>{</font>
<a name='L204'>    <b>if</b> (ecode &lt; 0 || ecode &gt; <a href='../D/881.html' title='Multiple defined in 2 places.'>EAI_MAX</a>)
<a name='L205'>        ecode = <a href='../D/881.html' title='Multiple defined in 2 places.'>EAI_MAX</a>;
<a name='L206'>    <b>return</b> ai_errlist[ecode];
<a name='L207'><font color='red'>}</font>
<a name='L208'>
<a name='L209'><b>void</b>
<a name='L210'><a href='../R/7930.html' title='Multiple refered from 10 places.'>freeaddrinfo</a>(<b>struct</b> addrinfo *ai)
<a name='L211'><font color='red'>{</font>
<a name='L212'>    <b>struct</b> <a href='../S/2620.html#L127' title='Defined at 127 in Modules/addrinfo.h.'>addrinfo</a> *next;
<a name='L213'>
<a name='L214'>    <b>do</b> <font color='red'>{</font>
<a name='L215'>        next = ai-&gt;ai_next;
<a name='L216'>        <b>if</b> (ai-&gt;ai_canonname)
<a name='L217'>            free(ai-&gt;ai_canonname);
<a name='L218'>        <i><font color='green'>/* no need to free(ai-&gt;ai_addr) */</font></i>
<a name='L219'>        free(ai);
<a name='L220'>    <font color='red'>}</font> <b>while</b> ((ai = next) != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L221'><font color='red'>}</font>
<a name='L222'>
<a name='L223'><b>static</b> <b>int</b>
<a name='L224'><a href='../R/10535.html' title='Multiple refered from 2 places.'>str_isnumber</a>(<b>const</b> <b>char</b> *p)
<a name='L225'><font color='red'>{</font>
<a name='L226'>    <b>unsigned</b> <b>char</b> *q = (<b>unsigned</b> <b>char</b> *)p;
<a name='L227'>    <b>while</b> (*q) <font color='red'>{</font>
<a name='L228'>        <b>if</b> (! isdigit(*q))
<a name='L229'>            <b>return</b> <a href='../D/2315.html' title='Multiple defined in 2 places.'>NO</a>;
<a name='L230'>        q++;
<a name='L231'>    <font color='red'>}</font>
<a name='L232'>    <b>return</b> <a href='../D/5913.html' title='Multiple defined in 2 places.'>YES</a>;
<a name='L233'><font color='red'>}</font>
<a name='L234'>
<a name='L235'><b>int</b>
<a name='L236'><a href='../R/8109.html' title='Multiple refered from 5 places.'>getaddrinfo</a>(<b>const</b> <b>char</b>*hostname, <b>const</b> <b>char</b>*servname,
<a name='L237'>            <b>const</b> <b>struct</b> addrinfo *hints, <b>struct</b> addrinfo **res)
<a name='L238'><font color='red'>{</font>
<a name='L239'>    <b>struct</b> <a href='../S/2620.html#L127' title='Defined at 127 in Modules/addrinfo.h.'>addrinfo</a> sentinel;
<a name='L240'>    <b>struct</b> <a href='../S/2620.html#L127' title='Defined at 127 in Modules/addrinfo.h.'>addrinfo</a> *top = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L241'>    <b>struct</b> <a href='../S/2620.html#L127' title='Defined at 127 in Modules/addrinfo.h.'>addrinfo</a> *cur;
<a name='L242'>    <b>int</b> i, <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a> = 0;
<a name='L243'>    <b>char</b> pton[<a href='../D/2549.html' title='Multiple defined in 2 places.'>PTON_MAX</a>];
<a name='L244'>    <b>struct</b> <a href='../S/2620.html#L127' title='Defined at 127 in Modules/addrinfo.h.'>addrinfo</a> ai;
<a name='L245'>    <b>struct</b> <a href='../S/2620.html#L127' title='Defined at 127 in Modules/addrinfo.h.'>addrinfo</a> *pai;
<a name='L246'>    u_short port;
<a name='L247'>
<a name='L248'><font color='darkred'>#ifdef</font> <a href='../S/2677.html#L61' title='Defined at 61 in Modules/getaddrinfo.c.'>FAITH</a>
<a name='L249'>    <b>static</b> <b>int</b> firsttime = 1;
<a name='L250'>
<a name='L251'>    <b>if</b> (firsttime) <font color='red'>{</font>
<a name='L252'>        <i><font color='green'>/* translator hack */</font></i>
<a name='L253'>        <font color='red'>{</font>
<a name='L254'>            <b>char</b> *q = <a href='../S/2906.html#L99' title='Defined at 99 in PC/pyconfig.h.'>getenv</a>("GAI");
<a name='L255'>            <b>if</b> (q &amp;&amp; <a href='../S/2711.html#L5346' title='Defined at 5346 in Modules/socketmodule.c.'>inet_pton</a>(AF_INET6, q, &amp;faith_prefix) == 1)
<a name='L256'>                translate = <a href='../D/5913.html' title='Multiple defined in 2 places.'>YES</a>;
<a name='L257'>        <font color='red'>}</font>
<a name='L258'>        firsttime = 0;
<a name='L259'>    <font color='red'>}</font>
<a name='L260'><font color='darkred'>#endif</font>
<a name='L261'>
<a name='L262'>    <i><font color='green'>/* initialize file static vars */</font></i>
<a name='L263'>    sentinel.ai_next = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L264'>    cur = &amp;sentinel;
<a name='L265'>    pai = &amp;ai;
<a name='L266'>    pai-&gt;ai_flags = 0;
<a name='L267'>    pai-&gt;ai_family = PF_UNSPEC;
<a name='L268'>    pai-&gt;ai_socktype = <a href='../S/2677.html#L65' title='Defined at 65 in Modules/getaddrinfo.c.'>GAI_ANY</a>;
<a name='L269'>    pai-&gt;ai_protocol = <a href='../S/2677.html#L65' title='Defined at 65 in Modules/getaddrinfo.c.'>GAI_ANY</a>;
<a name='L270'>    pai-&gt;ai_addrlen = 0;
<a name='L271'>    pai-&gt;ai_canonname = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L272'>    pai-&gt;ai_addr = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L273'>    pai-&gt;ai_next = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L274'>    port = <a href='../S/2677.html#L65' title='Defined at 65 in Modules/getaddrinfo.c.'>GAI_ANY</a>;
<a name='L275'>
<a name='L276'>    <b>if</b> (hostname == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; servname == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L277'>        <b>return</b> <a href='../D/884.html' title='Multiple defined in 2 places.'>EAI_NONAME</a>;
<a name='L278'>    <b>if</b> (hints) <font color='red'>{</font>
<a name='L279'>        <i><font color='green'>/* error check for hints */</font></i>
<a name='L280'>        <b>if</b> (hints-&gt;ai_addrlen || hints-&gt;ai_canonname ||
<a name='L281'>            hints-&gt;ai_addr || hints-&gt;ai_next)
<a name='L282'>            <a href='../S/2677.html#L199' title='Defined at 199 in Modules/getaddrinfo.c.'>ERR</a>(<a href='../D/878.html' title='Multiple defined in 2 places.'>EAI_BADHINTS</a>); <i><font color='green'>/* xxx */</font></i>
<a name='L283'>        <b>if</b> (hints-&gt;ai_flags &amp; ~<a href='../D/50.html' title='Multiple defined in 2 places.'>AI_MASK</a>)
<a name='L284'>            <a href='../S/2677.html#L199' title='Defined at 199 in Modules/getaddrinfo.c.'>ERR</a>(<a href='../D/877.html' title='Multiple defined in 2 places.'>EAI_BADFLAGS</a>);
<a name='L285'>        <b>switch</b> (hints-&gt;ai_family) <font color='red'>{</font>
<a name='L286'>        <b>case</b> PF_UNSPEC:
<a name='L287'>        <b>case</b> PF_INET:
<a name='L288'><font color='darkred'>#ifdef</font> <a href='../S/2712.html#L29' title='Defined at 29 in Modules/socketmodule.h.'>ENABLE_IPV6</a>
<a name='L289'>        <b>case</b> PF_INET6:
<a name='L290'><font color='darkred'>#endif</font>
<a name='L291'>            <b>break</b>;
<a name='L292'>        <b>default</b>:
<a name='L293'>            <a href='../S/2677.html#L199' title='Defined at 199 in Modules/getaddrinfo.c.'>ERR</a>(<a href='../D/880.html' title='Multiple defined in 2 places.'>EAI_FAMILY</a>);
<a name='L294'>        <font color='red'>}</font>
<a name='L295'>        <a href='../D/9803.html' title='Multiple defined in 4 places.'>memcpy</a>(pai, hints, <b>sizeof</b>(*pai));
<a name='L296'>        <b>switch</b> (pai-&gt;ai_socktype) <font color='red'>{</font>
<a name='L297'>        <b>case</b> <a href='../S/2677.html#L65' title='Defined at 65 in Modules/getaddrinfo.c.'>GAI_ANY</a>:
<a name='L298'>            <b>switch</b> (pai-&gt;ai_protocol) <font color='red'>{</font>
<a name='L299'>            <b>case</b> <a href='../S/2677.html#L65' title='Defined at 65 in Modules/getaddrinfo.c.'>GAI_ANY</a>:
<a name='L300'>                <b>break</b>;
<a name='L301'>            <b>case</b> IPPROTO_UDP:
<a name='L302'>                pai-&gt;ai_socktype = SOCK_DGRAM;
<a name='L303'>                <b>break</b>;
<a name='L304'>            <b>case</b> IPPROTO_TCP:
<a name='L305'>                pai-&gt;ai_socktype = SOCK_STREAM;
<a name='L306'>                <b>break</b>;
<a name='L307'>            <b>default</b>:
<a name='L308'>                pai-&gt;ai_socktype = SOCK_RAW;
<a name='L309'>                <b>break</b>;
<a name='L310'>            <font color='red'>}</font>
<a name='L311'>            <b>break</b>;
<a name='L312'>        <b>case</b> SOCK_RAW:
<a name='L313'>            <b>break</b>;
<a name='L314'>        <b>case</b> SOCK_DGRAM:
<a name='L315'>            <b>if</b> (pai-&gt;ai_protocol != IPPROTO_UDP &amp;&amp;
<a name='L316'>                pai-&gt;ai_protocol != <a href='../S/2677.html#L65' title='Defined at 65 in Modules/getaddrinfo.c.'>GAI_ANY</a>)
<a name='L317'>                <a href='../S/2677.html#L199' title='Defined at 199 in Modules/getaddrinfo.c.'>ERR</a>(<a href='../D/878.html' title='Multiple defined in 2 places.'>EAI_BADHINTS</a>);                      <i><font color='green'>/*xxx*/</font></i>
<a name='L318'>            pai-&gt;ai_protocol = IPPROTO_UDP;
<a name='L319'>            <b>break</b>;
<a name='L320'>        <b>case</b> SOCK_STREAM:
<a name='L321'>            <b>if</b> (pai-&gt;ai_protocol != IPPROTO_TCP &amp;&amp;
<a name='L322'>                pai-&gt;ai_protocol != <a href='../S/2677.html#L65' title='Defined at 65 in Modules/getaddrinfo.c.'>GAI_ANY</a>)
<a name='L323'>                <a href='../S/2677.html#L199' title='Defined at 199 in Modules/getaddrinfo.c.'>ERR</a>(<a href='../D/878.html' title='Multiple defined in 2 places.'>EAI_BADHINTS</a>);                      <i><font color='green'>/*xxx*/</font></i>
<a name='L324'>            pai-&gt;ai_protocol = IPPROTO_TCP;
<a name='L325'>            <b>break</b>;
<a name='L326'>        <b>default</b>:
<a name='L327'>            <a href='../S/2677.html#L199' title='Defined at 199 in Modules/getaddrinfo.c.'>ERR</a>(<a href='../D/887.html' title='Multiple defined in 2 places.'>EAI_SOCKTYPE</a>);
<a name='L328'>            <i><font color='green'>/* unreachable */</font></i>
<a name='L329'>        <font color='red'>}</font>
<a name='L330'>    <font color='red'>}</font>
<a name='L331'>
<a name='L332'>    <i><font color='green'>/*</font></i>
<a name='L333'><i><font color='green'>     * service port</font></i>
<a name='L334'><i><font color='green'>     */</font></i>
<a name='L335'>    <b>if</b> (servname) <font color='red'>{</font>
<a name='L336'>        <b>if</b> (<a href='../S/2677.html#L224' title='Defined at 224 in Modules/getaddrinfo.c.'>str_isnumber</a>(servname)) <font color='red'>{</font>
<a name='L337'>            <b>if</b> (pai-&gt;ai_socktype == <a href='../S/2677.html#L65' title='Defined at 65 in Modules/getaddrinfo.c.'>GAI_ANY</a>) <font color='red'>{</font>
<a name='L338'>                <i><font color='green'>/* caller accept *GAI_ANY* socktype */</font></i>
<a name='L339'>                pai-&gt;ai_socktype = SOCK_DGRAM;
<a name='L340'>                pai-&gt;ai_protocol = IPPROTO_UDP;
<a name='L341'>            <font color='red'>}</font>
<a name='L342'>            port = htons((u_short)atoi(servname));
<a name='L343'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L344'>            <b>struct</b> servent *sp;
<a name='L345'>            <b>char</b> *proto;
<a name='L346'>
<a name='L347'>            proto = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L348'>            <b>switch</b> (pai-&gt;ai_socktype) <font color='red'>{</font>
<a name='L349'>            <b>case</b> <a href='../S/2677.html#L65' title='Defined at 65 in Modules/getaddrinfo.c.'>GAI_ANY</a>:
<a name='L350'>                proto = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L351'>                <b>break</b>;
<a name='L352'>            <b>case</b> SOCK_DGRAM:
<a name='L353'>                proto = "udp";
<a name='L354'>                <b>break</b>;
<a name='L355'>            <b>case</b> SOCK_STREAM:
<a name='L356'>                proto = "tcp";
<a name='L357'>                <b>break</b>;
<a name='L358'>            <b>default</b>:
<a name='L359'>                fprintf(stderr, "panic!\n");
<a name='L360'>                <b>break</b>;
<a name='L361'>            <font color='red'>}</font>
<a name='L362'>            <b>if</b> ((sp = getservbyname(servname, proto)) == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L363'>                <a href='../S/2677.html#L199' title='Defined at 199 in Modules/getaddrinfo.c.'>ERR</a>(<a href='../D/886.html' title='Multiple defined in 2 places.'>EAI_SERVICE</a>);
<a name='L364'>            port = sp-&gt;s_port;
<a name='L365'>            <b>if</b> (pai-&gt;ai_socktype == <a href='../S/2677.html#L65' title='Defined at 65 in Modules/getaddrinfo.c.'>GAI_ANY</a>) <font color='red'>{</font>
<a name='L366'>                <b>if</b> (strcmp(sp-&gt;s_proto, "udp") == 0) <font color='red'>{</font>
<a name='L367'>                    pai-&gt;ai_socktype = SOCK_DGRAM;
<a name='L368'>                    pai-&gt;ai_protocol = IPPROTO_UDP;
<a name='L369'>                <font color='red'>}</font> <b>else</b> <b>if</b> (strcmp(sp-&gt;s_proto, "tcp") == 0) <font color='red'>{</font>
<a name='L370'>                    pai-&gt;ai_socktype = SOCK_STREAM;
<a name='L371'>                    pai-&gt;ai_protocol = IPPROTO_TCP;
<a name='L372'>                <font color='red'>}</font> <b>else</b>
<a name='L373'>                    <a href='../S/2677.html#L199' title='Defined at 199 in Modules/getaddrinfo.c.'>ERR</a>(<a href='../D/885.html' title='Multiple defined in 2 places.'>EAI_PROTOCOL</a>);                          <i><font color='green'>/*xxx*/</font></i>
<a name='L374'>            <font color='red'>}</font>
<a name='L375'>        <font color='red'>}</font>
<a name='L376'>    <font color='red'>}</font>
<a name='L377'>
<a name='L378'>    <i><font color='green'>/*</font></i>
<a name='L379'><i><font color='green'>     * hostname == NULL.</font></i>
<a name='L380'><i><font color='green'>     * passive socket -&gt; anyaddr (0.0.0.0 or ::)</font></i>
<a name='L381'><i><font color='green'>     * non-passive socket -&gt; localhost (127.0.0.1 or ::1)</font></i>
<a name='L382'><i><font color='green'>     */</font></i>
<a name='L383'>    <b>if</b> (hostname == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L384'>        <b>struct</b> <a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a> *<a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a>;
<a name='L385'>
<a name='L386'>        <b>for</b> (<a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a> = &amp;gai_afdl[0]; <a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a>-&gt;a_af; <a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a>++) <font color='red'>{</font>
<a name='L387'>            <b>if</b> (!(pai-&gt;ai_family == PF_UNSPEC
<a name='L388'>               || pai-&gt;ai_family == <a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a>-&gt;a_af)) <font color='red'>{</font>
<a name='L389'>                <b>continue</b>;
<a name='L390'>            <font color='red'>}</font>
<a name='L391'>
<a name='L392'>            <b>if</b> (pai-&gt;ai_flags &amp; <a href='../D/52.html' title='Multiple defined in 2 places.'>AI_PASSIVE</a>) <font color='red'>{</font>
<a name='L393'>                <a href='../D/1383.html' title='Multiple defined in 2 places.'>GET_AI</a>(cur-&gt;ai_next, <a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a>, <a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a>-&gt;a_addrany, port);
<a name='L394'>                <i><font color='green'>/* xxx meaningless?</font></i>
<a name='L395'><i><font color='green'>                 * GET_CANONNAME(cur-&gt;ai_next, "anyaddr");</font></i>
<a name='L396'><i><font color='green'>                 */</font></i>
<a name='L397'>            <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L398'>                <a href='../D/1383.html' title='Multiple defined in 2 places.'>GET_AI</a>(cur-&gt;ai_next, <a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a>, <a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a>-&gt;a_loopback,
<a name='L399'>                    port);
<a name='L400'>                <i><font color='green'>/* xxx meaningless?</font></i>
<a name='L401'><i><font color='green'>                 * GET_CANONNAME(cur-&gt;ai_next, "localhost");</font></i>
<a name='L402'><i><font color='green'>                 */</font></i>
<a name='L403'>            <font color='red'>}</font>
<a name='L404'>            cur = cur-&gt;ai_next;
<a name='L405'>        <font color='red'>}</font>
<a name='L406'>        top = sentinel.ai_next;
<a name='L407'>        <b>if</b> (top)
<a name='L408'>            <b>goto</b> good;
<a name='L409'>        <b>else</b>
<a name='L410'>            <a href='../S/2677.html#L199' title='Defined at 199 in Modules/getaddrinfo.c.'>ERR</a>(<a href='../D/880.html' title='Multiple defined in 2 places.'>EAI_FAMILY</a>);
<a name='L411'>    <font color='red'>}</font>
<a name='L412'>
<a name='L413'>    <i><font color='green'>/* hostname as numeric name */</font></i>
<a name='L414'>    <b>for</b> (i = 0; gai_afdl[i].a_af; i++) <font color='red'>{</font>
<a name='L415'>        <b>if</b> (<a href='../S/2711.html#L5346' title='Defined at 5346 in Modules/socketmodule.c.'>inet_pton</a>(gai_afdl[i].a_af, hostname, pton)) <font color='red'>{</font>
<a name='L416'>            u_long v4a;
<a name='L417'><font color='darkred'>#ifdef</font> <a href='../S/2712.html#L29' title='Defined at 29 in Modules/socketmodule.h.'>ENABLE_IPV6</a>
<a name='L418'>            u_char pfx;
<a name='L419'><font color='darkred'>#endif</font>
<a name='L420'>
<a name='L421'>            <b>switch</b> (gai_afdl[i].a_af) <font color='red'>{</font>
<a name='L422'>            <b>case</b> AF_INET:
<a name='L423'>                v4a = ((<b>struct</b> in_addr *)pton)-&gt;s_addr;
<a name='L424'>                v4a = ntohl(v4a);
<a name='L425'>                <b>if</b> (<a href='../S/2677.html#L121' title='Defined at 121 in Modules/getaddrinfo.c.'>IN_MULTICAST</a>(v4a) || <a href='../S/2677.html#L125' title='Defined at 125 in Modules/getaddrinfo.c.'>IN_EXPERIMENTAL</a>(v4a))
<a name='L426'>                    pai-&gt;ai_flags &amp;= ~<a href='../D/48.html' title='Multiple defined in 2 places.'>AI_CANONNAME</a>;
<a name='L427'>                v4a &gt;&gt;= IN_CLASSA_NSHIFT;
<a name='L428'>                <b>if</b> (v4a == 0 || v4a == <a href='../S/2677.html#L129' title='Defined at 129 in Modules/getaddrinfo.c.'>IN_LOOPBACKNET</a>)
<a name='L429'>                    pai-&gt;ai_flags &amp;= ~<a href='../D/48.html' title='Multiple defined in 2 places.'>AI_CANONNAME</a>;
<a name='L430'>                <b>break</b>;
<a name='L431'><font color='darkred'>#ifdef</font> <a href='../S/2712.html#L29' title='Defined at 29 in Modules/socketmodule.h.'>ENABLE_IPV6</a>
<a name='L432'>            <b>case</b> AF_INET6:
<a name='L433'>                pfx = ((<b>struct</b> in6_addr *)pton)-&gt;s6_addr8[0];
<a name='L434'>                <b>if</b> (pfx == 0 || pfx == 0xfe || pfx == 0xff)
<a name='L435'>                    pai-&gt;ai_flags &amp;= ~<a href='../D/48.html' title='Multiple defined in 2 places.'>AI_CANONNAME</a>;
<a name='L436'>                <b>break</b>;
<a name='L437'><font color='darkred'>#endif</font>
<a name='L438'>            <font color='red'>}</font>
<a name='L439'>
<a name='L440'>            <b>if</b> (pai-&gt;ai_family == gai_afdl[i].a_af ||
<a name='L441'>                pai-&gt;ai_family == PF_UNSPEC) <font color='red'>{</font>
<a name='L442'>                <b>if</b> (! (pai-&gt;ai_flags &amp; <a href='../D/48.html' title='Multiple defined in 2 places.'>AI_CANONNAME</a>)) <font color='red'>{</font>
<a name='L443'>                    <a href='../D/1383.html' title='Multiple defined in 2 places.'>GET_AI</a>(top, &amp;gai_afdl[i], pton, port);
<a name='L444'>                    <b>goto</b> good;
<a name='L445'>                <font color='red'>}</font>
<a name='L446'>                <i><font color='green'>/*</font></i>
<a name='L447'><i><font color='green'>                 * if AI_CANONNAME and if reverse lookup</font></i>
<a name='L448'><i><font color='green'>                 * fail, return ai anyway to pacify</font></i>
<a name='L449'><i><font color='green'>                 * calling application.</font></i>
<a name='L450'><i><font color='green'>                 *</font></i>
<a name='L451'><i><font color='green'>                 * XXX getaddrinfo() is a name-&gt;address</font></i>
<a name='L452'><i><font color='green'>                 * translation function, and it looks strange</font></i>
<a name='L453'><i><font color='green'>                 * that we do addr-&gt;name translation here.</font></i>
<a name='L454'><i><font color='green'>                 */</font></i>
<a name='L455'>                <a href='../S/2677.html#L484' title='Defined at 484 in Modules/getaddrinfo.c.'>get_name</a>(pton, &amp;gai_afdl[i], &amp;top, pton, pai, port);
<a name='L456'>                <b>goto</b> good;
<a name='L457'>            <font color='red'>}</font> <b>else</b>
<a name='L458'>                <a href='../S/2677.html#L199' title='Defined at 199 in Modules/getaddrinfo.c.'>ERR</a>(<a href='../D/880.html' title='Multiple defined in 2 places.'>EAI_FAMILY</a>);                        <i><font color='green'>/*xxx*/</font></i>
<a name='L459'>        <font color='red'>}</font>
<a name='L460'>    <font color='red'>}</font>
<a name='L461'>
<a name='L462'>    <b>if</b> (pai-&gt;ai_flags &amp; <a href='../D/51.html' title='Multiple defined in 2 places.'>AI_NUMERICHOST</a>)
<a name='L463'>        <a href='../S/2677.html#L199' title='Defined at 199 in Modules/getaddrinfo.c.'>ERR</a>(<a href='../D/884.html' title='Multiple defined in 2 places.'>EAI_NONAME</a>);
<a name='L464'>
<a name='L465'>    <i><font color='green'>/* hostname as alphabetical name */</font></i>
<a name='L466'>    <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a> = <a href='../S/2677.html#L530' title='Defined at 530 in Modules/getaddrinfo.c.'>get_addr</a>(hostname, pai-&gt;ai_family, &amp;top, pai, port);
<a name='L467'>    <b>if</b> (<a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a> == 0) <font color='red'>{</font>
<a name='L468'>        <b>if</b> (top) <font color='red'>{</font>
<a name='L469'> good:
<a name='L470'>            *res = top;
<a name='L471'>            <b>return</b> <a href='../D/5032.html' title='Multiple defined in 2 places.'>SUCCESS</a>;
<a name='L472'>        <font color='red'>}</font> <b>else</b>
<a name='L473'>            <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a> = <a href='../D/879.html' title='Multiple defined in 2 places.'>EAI_FAIL</a>;
<a name='L474'>    <font color='red'>}</font>
<a name='L475'> free:
<a name='L476'>    <b>if</b> (top)
<a name='L477'>        <a href='../D/8729.html' title='Multiple defined in 2 places.'>freeaddrinfo</a>(top);
<a name='L478'> bad:
<a name='L479'>    *res = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L480'>    <b>return</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L481'><font color='red'>}</font>
<a name='L482'>
<a name='L483'><b>static</b> <b>int</b>
<a name='L484'><a href='../R/8076.html' title='Multiple refered from 2 places.'>get_name</a>(addr, gai_afd, res, numaddr, pai, port0)
<a name='L485'>    <b>const</b> <b>char</b> *addr;
<a name='L486'>    <b>struct</b> gai_afd *gai_afd;
<a name='L487'>    <b>struct</b> addrinfo **res;
<a name='L488'>    <b>char</b> *numaddr;
<a name='L489'>    <b>struct</b> addrinfo *pai;
<a name='L490'>    <b>int</b> port0;
<a name='L491'><font color='red'>{</font>
<a name='L492'>    u_short port = port0 &amp; 0xffff;
<a name='L493'>    <b>struct</b> hostent *hp;
<a name='L494'>    <b>struct</b> <a href='../S/2620.html#L127' title='Defined at 127 in Modules/addrinfo.h.'>addrinfo</a> *cur;
<a name='L495'>    <b>int</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a> = 0;
<a name='L496'><font color='darkred'>#ifdef</font> <a href='../S/2712.html#L29' title='Defined at 29 in Modules/socketmodule.h.'>ENABLE_IPV6</a>
<a name='L497'>    <b>int</b> h_error;
<a name='L498'><font color='darkred'>#endif</font>
<a name='L499'>
<a name='L500'><font color='darkred'>#ifdef</font> <a href='../S/2712.html#L29' title='Defined at 29 in Modules/socketmodule.h.'>ENABLE_IPV6</a>
<a name='L501'>    hp = getipnodebyaddr(addr, <a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a>-&gt;a_addrlen, <a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a>-&gt;a_af, &amp;h_error);
<a name='L502'><font color='darkred'>#else</font>
<a name='L503'>    hp = gethostbyaddr(addr, <a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a>-&gt;a_addrlen, AF_INET);
<a name='L504'><font color='darkred'>#endif</font>
<a name='L505'>    <b>if</b> (hp &amp;&amp; hp-&gt;h_name &amp;&amp; hp-&gt;h_name[0] &amp;&amp; hp-&gt;h_addr_list[0]) <font color='red'>{</font>
<a name='L506'>        <a href='../D/1383.html' title='Multiple defined in 2 places.'>GET_AI</a>(cur, <a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a>, hp-&gt;h_addr_list[0], port);
<a name='L507'>        <a href='../S/2677.html#L157' title='Defined at 157 in Modules/getaddrinfo.c.'>GET_CANONNAME</a>(cur, hp-&gt;h_name);
<a name='L508'>    <font color='red'>}</font> <b>else</b>
<a name='L509'>        <a href='../D/1383.html' title='Multiple defined in 2 places.'>GET_AI</a>(cur, <a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a>, numaddr, port);
<a name='L510'>
<a name='L511'><font color='darkred'>#ifdef</font> <a href='../S/2712.html#L29' title='Defined at 29 in Modules/socketmodule.h.'>ENABLE_IPV6</a>
<a name='L512'>    <b>if</b> (hp)
<a name='L513'>        freehostent(hp);
<a name='L514'><font color='darkred'>#endif</font>
<a name='L515'>    *res = cur;
<a name='L516'>    <b>return</b> <a href='../D/5032.html' title='Multiple defined in 2 places.'>SUCCESS</a>;
<a name='L517'> free:
<a name='L518'>    <b>if</b> (cur)
<a name='L519'>        <a href='../D/8729.html' title='Multiple defined in 2 places.'>freeaddrinfo</a>(cur);
<a name='L520'><font color='darkred'>#ifdef</font> <a href='../S/2712.html#L29' title='Defined at 29 in Modules/socketmodule.h.'>ENABLE_IPV6</a>
<a name='L521'>    <b>if</b> (hp)
<a name='L522'>        freehostent(hp);
<a name='L523'><font color='darkred'>#endif</font>
<a name='L524'> <i><font color='green'>/* bad: */</font></i>
<a name='L525'>    *res = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L526'>    <b>return</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L527'><font color='red'>}</font>
<a name='L528'>
<a name='L529'><b>static</b> <b>int</b>
<a name='L530'><a href='../R/8025.html' title='Multiple refered from 2 places.'>get_addr</a>(hostname, af, res, pai, port0)
<a name='L531'>    <b>const</b> <b>char</b> *hostname;
<a name='L532'>    <b>int</b> af;
<a name='L533'>    <b>struct</b> addrinfo **res;
<a name='L534'>    <b>struct</b> addrinfo *pai;
<a name='L535'>    <b>int</b> port0;
<a name='L536'><font color='red'>{</font>
<a name='L537'>    u_short port = port0 &amp; 0xffff;
<a name='L538'>    <b>struct</b> <a href='../S/2620.html#L127' title='Defined at 127 in Modules/addrinfo.h.'>addrinfo</a> sentinel;
<a name='L539'>    <b>struct</b> hostent *hp;
<a name='L540'>    <b>struct</b> <a href='../S/2620.html#L127' title='Defined at 127 in Modules/addrinfo.h.'>addrinfo</a> *top, *cur;
<a name='L541'>    <b>struct</b> <a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a> *<a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a>;
<a name='L542'>    <b>int</b> i, <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a> = 0, h_error;
<a name='L543'>    <b>char</b> *ap;
<a name='L544'>
<a name='L545'>    top = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L546'>    sentinel.ai_next = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L547'>    cur = &amp;sentinel;
<a name='L548'><font color='darkred'>#ifdef</font> <a href='../S/2712.html#L29' title='Defined at 29 in Modules/socketmodule.h.'>ENABLE_IPV6</a>
<a name='L549'>    <b>if</b> (af == AF_UNSPEC) <font color='red'>{</font>
<a name='L550'>        hp = getipnodebyname(hostname, AF_INET6,
<a name='L551'>                        <a href='../D/46.html' title='Multiple defined in 2 places.'>AI_ADDRCONFIG</a>|<a href='../D/47.html' title='Multiple defined in 2 places.'>AI_ALL</a>|<a href='../D/53.html' title='Multiple defined in 2 places.'>AI_V4MAPPED</a>, &amp;h_error);
<a name='L552'>    <font color='red'>}</font> <b>else</b>
<a name='L553'>        hp = getipnodebyname(hostname, af, <a href='../D/46.html' title='Multiple defined in 2 places.'>AI_ADDRCONFIG</a>, &amp;h_error);
<a name='L554'><font color='darkred'>#else</font>
<a name='L555'>    hp = gethostbyname(hostname);
<a name='L556'>    h_error = h_errno;
<a name='L557'><font color='darkred'>#endif</font>
<a name='L558'>    <b>if</b> (hp == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L559'>        <b>switch</b> (h_error) <font color='red'>{</font>
<a name='L560'>        <b>case</b> HOST_NOT_FOUND:
<a name='L561'>        <b>case</b> NO_DATA:
<a name='L562'>            <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a> = <a href='../D/883.html' title='Multiple defined in 2 places.'>EAI_NODATA</a>;
<a name='L563'>            <b>break</b>;
<a name='L564'>        <b>case</b> TRY_AGAIN:
<a name='L565'>            <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a> = <a href='../D/876.html' title='Multiple defined in 2 places.'>EAI_AGAIN</a>;
<a name='L566'>            <b>break</b>;
<a name='L567'>        <b>case</b> NO_RECOVERY:
<a name='L568'>        <b>default</b>:
<a name='L569'>            <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a> = <a href='../D/879.html' title='Multiple defined in 2 places.'>EAI_FAIL</a>;
<a name='L570'>            <b>break</b>;
<a name='L571'>        <font color='red'>}</font>
<a name='L572'>        <b>goto</b> free;
<a name='L573'>    <font color='red'>}</font>
<a name='L574'>
<a name='L575'>    <b>if</b> ((hp-&gt;h_name == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) || (hp-&gt;h_name[0] == 0) ||
<a name='L576'>        (hp-&gt;h_addr_list[0] == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)) <font color='red'>{</font>
<a name='L577'>        <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a> = <a href='../D/879.html' title='Multiple defined in 2 places.'>EAI_FAIL</a>;
<a name='L578'>        <b>goto</b> free;
<a name='L579'>    <font color='red'>}</font>
<a name='L580'>
<a name='L581'>    <b>for</b> (i = 0; (ap = hp-&gt;h_addr_list[i]) != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>; i++) <font color='red'>{</font>
<a name='L582'>        <b>switch</b> (af) <font color='red'>{</font>
<a name='L583'><font color='darkred'>#ifdef</font> <a href='../S/2712.html#L29' title='Defined at 29 in Modules/socketmodule.h.'>ENABLE_IPV6</a>
<a name='L584'>        <b>case</b> AF_INET6:
<a name='L585'>            <a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a> = &amp;gai_afdl[<a href='../S/2677.html#L98' title='Defined at 98 in Modules/getaddrinfo.c.'>N_INET6</a>];
<a name='L586'>            <b>break</b>;
<a name='L587'><font color='darkred'>#endif</font>
<a name='L588'><font color='darkred'>#ifndef</font> <a href='../S/2712.html#L29' title='Defined at 29 in Modules/socketmodule.h.'>ENABLE_IPV6</a>
<a name='L589'>        <b>default</b>:                <i><font color='green'>/* AF_UNSPEC */</font></i>
<a name='L590'><font color='darkred'>#endif</font>
<a name='L591'>        <b>case</b> AF_INET:
<a name='L592'>            <a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a> = &amp;gai_afdl[<a href='../D/2361.html' title='Multiple defined in 2 places.'>N_INET</a>];
<a name='L593'>            <b>break</b>;
<a name='L594'><font color='darkred'>#ifdef</font> <a href='../S/2712.html#L29' title='Defined at 29 in Modules/socketmodule.h.'>ENABLE_IPV6</a>
<a name='L595'>        <b>default</b>:                <i><font color='green'>/* AF_UNSPEC */</font></i>
<a name='L596'>            <b>if</b> (IN6_IS_ADDR_V4MAPPED((<b>struct</b> in6_addr *)ap)) <font color='red'>{</font>
<a name='L597'>                ap += <b>sizeof</b>(<b>struct</b> in6_addr) -
<a name='L598'>                    <b>sizeof</b>(<b>struct</b> in_addr);
<a name='L599'>                <a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a> = &amp;gai_afdl[<a href='../D/2361.html' title='Multiple defined in 2 places.'>N_INET</a>];
<a name='L600'>            <font color='red'>}</font> <b>else</b>
<a name='L601'>                <a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a> = &amp;gai_afdl[<a href='../S/2677.html#L98' title='Defined at 98 in Modules/getaddrinfo.c.'>N_INET6</a>];
<a name='L602'>            <b>break</b>;
<a name='L603'><font color='darkred'>#endif</font>
<a name='L604'>        <font color='red'>}</font>
<a name='L605'><font color='darkred'>#ifdef</font> <a href='../S/2677.html#L61' title='Defined at 61 in Modules/getaddrinfo.c.'>FAITH</a>
<a name='L606'>        <b>if</b> (translate &amp;&amp; <a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a>-&gt;a_af == AF_INET) <font color='red'>{</font>
<a name='L607'>            <b>struct</b> in6_addr *in6;
<a name='L608'>
<a name='L609'>            <a href='../D/1383.html' title='Multiple defined in 2 places.'>GET_AI</a>(cur-&gt;ai_next, &amp;gai_afdl[<a href='../S/2677.html#L98' title='Defined at 98 in Modules/getaddrinfo.c.'>N_INET6</a>], ap, port);
<a name='L610'>            in6 = &amp;((<b>struct</b> sockaddr_in6 *)cur-&gt;ai_next-&gt;ai_addr)-&gt;sin6_addr;
<a name='L611'>            <a href='../D/9803.html' title='Multiple defined in 4 places.'>memcpy</a>(&amp;in6-&gt;s6_addr32[0], &amp;faith_prefix,
<a name='L612'>                <b>sizeof</b>(<b>struct</b> in6_addr) - <b>sizeof</b>(<b>struct</b> in_addr));
<a name='L613'>            <a href='../D/9803.html' title='Multiple defined in 4 places.'>memcpy</a>(&amp;in6-&gt;s6_addr32[3], ap, <b>sizeof</b>(<b>struct</b> in_addr));
<a name='L614'>        <font color='red'>}</font> <b>else</b>
<a name='L615'><font color='darkred'>#endif</font> <i><font color='green'>/* FAITH */</font></i>
<a name='L616'>        <a href='../D/1383.html' title='Multiple defined in 2 places.'>GET_AI</a>(cur-&gt;ai_next, <a href='../S/2677.html#L89' title='Defined at 89 in Modules/getaddrinfo.c.'>gai_afd</a>, ap, port);
<a name='L617'>        <b>if</b> (cur == &amp;sentinel) <font color='red'>{</font>
<a name='L618'>            top = cur-&gt;ai_next;
<a name='L619'>            <a href='../S/2677.html#L157' title='Defined at 157 in Modules/getaddrinfo.c.'>GET_CANONNAME</a>(top, hp-&gt;h_name);
<a name='L620'>        <font color='red'>}</font>
<a name='L621'>        cur = cur-&gt;ai_next;
<a name='L622'>    <font color='red'>}</font>
<a name='L623'><font color='darkred'>#ifdef</font> <a href='../S/2712.html#L29' title='Defined at 29 in Modules/socketmodule.h.'>ENABLE_IPV6</a>
<a name='L624'>    freehostent(hp);
<a name='L625'><font color='darkred'>#endif</font>
<a name='L626'>    *res = top;
<a name='L627'>    <b>return</b> <a href='../D/5032.html' title='Multiple defined in 2 places.'>SUCCESS</a>;
<a name='L628'> free:
<a name='L629'>    <b>if</b> (top)
<a name='L630'>        <a href='../D/8729.html' title='Multiple defined in 2 places.'>freeaddrinfo</a>(top);
<a name='L631'><font color='darkred'>#ifdef</font> <a href='../S/2712.html#L29' title='Defined at 29 in Modules/socketmodule.h.'>ENABLE_IPV6</a>
<a name='L632'>    <b>if</b> (hp)
<a name='L633'>        freehostent(hp);
<a name='L634'><font color='darkred'>#endif</font>
<a name='L635'><i><font color='green'>/* bad: */</font></i>
<a name='L636'>    *res = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L637'>    <b>return</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L638'><font color='red'>}</font>
</pre>
<hr>
<a name='BOTTOM'>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L202'>[^]</a><a href='#L530'>[v]</a><a href='#TOP'>[top]</a>[bottom]<a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
</body>
</html>
