<html>
<head>
<title>Modules/_ctypes/libffi/src/dlmalloc.c</title>
<meta name='robots' content='noindex,nofollow'>
<meta name='generator' content='GLOBAL-5.8.1'>
</head>
<body text='#191970' bgcolor='#f5f5dc' vlink='gray'>
<a name='TOP'><h2><a href='../mains.html'>root</a>/<a href='../files/3353.html'>Modules</a>/<a href='../files/3354.html'>_ctypes</a>/<a href='../files/3356.html'>libffi</a>/<a href='../files/3358.html'>src</a>/dlmalloc.c</h2>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L1317'>[^]</a><a href='#L4822'>[v]</a>[top]<a href='#BOTTOM'>[bottom]</a><a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
<hr>
<h2>DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href='#L1317' title='Defined at 1317.'>win32mmap</a>
<li><a href='#L1323' title='Defined at 1323.'>win32direct_mmap</a>
<li><a href='#L1330' title='Defined at 1330.'>win32munmap</a>
<li><a href='#L1411' title='Defined at 1411.'>win32_acquire_lock</a>
<li><a href='#L1424' title='Defined at 1424.'>win32_release_lock</a>
<li><a href='#L2098' title='Defined at 2098.'>segment_holding</a>
<li><a href='#L2109' title='Defined at 2109.'>has_segment_link</a>
<li><a href='#L2452' title='Defined at 2452.'>init_mparams</a>
<li><a href='#L2528' title='Defined at 2528.'>change_mparam</a>
<li><a href='#L2554' title='Defined at 2554.'>do_check_any_chunk</a>
<li><a href='#L2560' title='Defined at 2560.'>do_check_top_chunk</a>
<li><a href='#L2574' title='Defined at 2574.'>do_check_mmapped_chunk</a>
<li><a href='#L2588' title='Defined at 2588.'>do_check_inuse_chunk</a>
<li><a href='#L2599' title='Defined at 2599.'>do_check_free_chunk</a>
<li><a href='#L2622' title='Defined at 2622.'>do_check_malloced_chunk</a>
<li><a href='#L2636' title='Defined at 2636.'>do_check_tree</a>
<li><a href='#L2687' title='Defined at 2687.'>do_check_treebin</a>
<li><a href='#L2698' title='Defined at 2698.'>do_check_smallbin</a>
<li><a href='#L2722' title='Defined at 2722.'>bin_find</a>
<li><a href='#L2758' title='Defined at 2758.'>traverse_and_check</a>
<li><a href='#L2789' title='Defined at 2789.'>do_check_malloc_state</a>
<li><a href='#L2821' title='Defined at 2821.'>internal_mallinfo</a>
<li><a href='#L2860' title='Defined at 2860.'>internal_malloc_stats</a>
<li><a href='#L3153' title='Defined at 3153.'>mmap_alloc</a>
<li><a href='#L3180' title='Defined at 3180.'>mmap_resize</a>
<li><a href='#L3217' title='Defined at 3217.'>init_top</a>
<li><a href='#L3232' title='Defined at 3232.'>init_bins</a>
<li><a href='#L3244' title='Defined at 3244.'>reset_on_error</a>
<li><a href='#L3261' title='Defined at 3261.'>prepend_alloc</a>
<li><a href='#L3304' title='Defined at 3304.'>add_segment</a>
<li><a href='#L3359' title='Defined at 3359.'>sys_alloc</a>
<li><a href='#L3553' title='Defined at 3553.'>release_unused_segments</a>
<li><a href='#L3593' title='Defined at 3593.'>sys_trim</a>
<li><a href='#L3659' title='Defined at 3659.'>tmalloc_large</a>
<li><a href='#L3732' title='Defined at 3732.'>tmalloc_small</a>
<li><a href='#L3772' title='Defined at 3772.'>internal_realloc</a>
<li><a href='#L3843' title='Defined at 3843.'>internal_memalign</a>
<li><a href='#L3930' title='Defined at 3930.'>ialloc</a>
<li><a href='#L4061' title='Defined at 4061.'>dlmalloc</a>
<li><a href='#L4193' title='Defined at 4193.'>dlfree</a>
<li><a href='#L4293' title='Defined at 4293.'>dlcalloc</a>
<li><a href='#L4308' title='Defined at 4308.'>dlrealloc</a>
<li><a href='#L4331' title='Defined at 4331.'>dlmemalign</a>
<li><a href='#L4335' title='Defined at 4335.'>dlindependent_calloc</a>
<li><a href='#L4341' title='Defined at 4341.'>dlindependent_comalloc</a>
<li><a href='#L4346' title='Defined at 4346.'>dlvalloc</a>
<li><a href='#L4353' title='Defined at 4353.'>dlpvalloc</a>
<li><a href='#L4360' title='Defined at 4360.'>dlmalloc_trim</a>
<li><a href='#L4369' title='Defined at 4369.'>dlmalloc_footprint</a>
<li><a href='#L4373' title='Defined at 4373.'>dlmalloc_max_footprint</a>
<li><a href='#L4378' title='Defined at 4378.'>dlmallinfo</a>
<li><a href='#L4383' title='Defined at 4383.'>dlmalloc_stats</a>
<li><a href='#L4387' title='Defined at 4387.'>dlmalloc_usable_size</a>
<li><a href='#L4396' title='Defined at 4396.'>dlmallopt</a>
<li><a href='#L4406' title='Defined at 4406.'>init_user_mstate</a>
<li><a href='#L4426' title='Defined at 4426.'>create_mspace</a>
<li><a href='#L4445' title='Defined at 4445.'>create_mspace_with_base</a>
<li><a href='#L4459' title='Defined at 4459.'>destroy_mspace</a>
<li><a href='#L4486' title='Defined at 4486.'>mspace_malloc</a>
<li><a href='#L4600' title='Defined at 4600.'>mspace_free</a>
<li><a href='#L4691' title='Defined at 4691.'>mspace_calloc</a>
<li><a href='#L4711' title='Defined at 4711.'>mspace_realloc</a>
<li><a href='#L4735' title='Defined at 4735.'>mspace_memalign</a>
<li><a href='#L4744' title='Defined at 4744.'>mspace_independent_calloc</a>
<li><a href='#L4755' title='Defined at 4755.'>mspace_independent_comalloc</a>
<li><a href='#L4765' title='Defined at 4765.'>mspace_trim</a>
<li><a href='#L4780' title='Defined at 4780.'>mspace_malloc_stats</a>
<li><a href='#L4790' title='Defined at 4790.'>mspace_footprint</a>
<li><a href='#L4801' title='Defined at 4801.'>mspace_max_footprint</a>
<li><a href='#L4813' title='Defined at 4813.'>mspace_mallinfo</a>
<li><a href='#L4822' title='Defined at 4822.'>mspace_mallopt</a>
</ol>
<hr>
<pre>
<a name='L1'><i><font color='green'>/*</font></i>
<a name='L2'><i><font color='green'>  This is a version (aka dlmalloc) of malloc/free/realloc written by</font></i>
<a name='L3'><i><font color='green'>  Doug Lea and released to the public domain, as explained at</font></i>
<a name='L4'><i><font color='green'>  http://creativecommons.org/licenses/publicdomain.  Send questions,</font></i>
<a name='L5'><i><font color='green'>  comments, complaints, performance data, etc to dl@cs.oswego.edu</font></i>
<a name='L6'><i><font color='green'></font></i>
<a name='L7'><i><font color='green'>* Version 2.8.3 Thu Sep 22 11:16:15 2005  Doug Lea  (dl at gee)</font></i>
<a name='L8'><i><font color='green'></font></i>
<a name='L9'><i><font color='green'>   Note: There may be an updated version of this malloc obtainable at</font></i>
<a name='L10'><i><font color='green'>           ftp://gee.cs.oswego.edu/pub/misc/malloc.c</font></i>
<a name='L11'><i><font color='green'>         Check before installing!</font></i>
<a name='L12'><i><font color='green'></font></i>
<a name='L13'><i><font color='green'>* Quickstart</font></i>
<a name='L14'><i><font color='green'></font></i>
<a name='L15'><i><font color='green'>  This library is all in one file to simplify the most common usage:</font></i>
<a name='L16'><i><font color='green'>  ftp it, compile it (-O3), and link it into another program. All of</font></i>
<a name='L17'><i><font color='green'>  the compile-time options default to reasonable values for use on</font></i>
<a name='L18'><i><font color='green'>  most platforms.  You might later want to step through various</font></i>
<a name='L19'><i><font color='green'>  compile-time and dynamic tuning options.</font></i>
<a name='L20'><i><font color='green'></font></i>
<a name='L21'><i><font color='green'>  For convenience, an include file for code using this malloc is at:</font></i>
<a name='L22'><i><font color='green'>     ftp://gee.cs.oswego.edu/pub/misc/malloc-2.8.3.h</font></i>
<a name='L23'><i><font color='green'>  You don't really need this .h file unless you call functions not</font></i>
<a name='L24'><i><font color='green'>  defined in your system include files.  The .h file contains only the</font></i>
<a name='L25'><i><font color='green'>  excerpts from this file needed for using this malloc on ANSI C/C++</font></i>
<a name='L26'><i><font color='green'>  systems, so long as you haven't changed compile-time options about</font></i>
<a name='L27'><i><font color='green'>  naming and tuning parameters.  If you do, then you can create your</font></i>
<a name='L28'><i><font color='green'>  own malloc.h that does include all settings by cutting at the point</font></i>
<a name='L29'><i><font color='green'>  indicated below. Note that you may already by default be using a C</font></i>
<a name='L30'><i><font color='green'>  library containing a malloc that is based on some version of this</font></i>
<a name='L31'><i><font color='green'>  malloc (for example in linux). You might still want to use the one</font></i>
<a name='L32'><i><font color='green'>  in this file to customize settings or to avoid overheads associated</font></i>
<a name='L33'><i><font color='green'>  with library versions.</font></i>
<a name='L34'><i><font color='green'></font></i>
<a name='L35'><i><font color='green'>* Vital statistics:</font></i>
<a name='L36'><i><font color='green'></font></i>
<a name='L37'><i><font color='green'>  Supported pointer/size_t representation:       4 or 8 bytes</font></i>
<a name='L38'><i><font color='green'>       size_t MUST be an unsigned type of the same width as</font></i>
<a name='L39'><i><font color='green'>       pointers. (If you are using an ancient system that declares</font></i>
<a name='L40'><i><font color='green'>       size_t as a signed type, or need it to be a different width</font></i>
<a name='L41'><i><font color='green'>       than pointers, you can use a previous release of this malloc</font></i>
<a name='L42'><i><font color='green'>       (e.g. 2.7.2) supporting these.)</font></i>
<a name='L43'><i><font color='green'></font></i>
<a name='L44'><i><font color='green'>  Alignment:                                     8 bytes (default)</font></i>
<a name='L45'><i><font color='green'>       This suffices for nearly all current machines and C compilers.</font></i>
<a name='L46'><i><font color='green'>       However, you can define MALLOC_ALIGNMENT to be wider than this</font></i>
<a name='L47'><i><font color='green'>       if necessary (up to 128bytes), at the expense of using more space.</font></i>
<a name='L48'><i><font color='green'></font></i>
<a name='L49'><i><font color='green'>  Minimum overhead per allocated chunk:   4 or  8 bytes (if 4byte sizes)</font></i>
<a name='L50'><i><font color='green'>                                          8 or 16 bytes (if 8byte sizes)</font></i>
<a name='L51'><i><font color='green'>       Each malloced chunk has a hidden word of overhead holding size</font></i>
<a name='L52'><i><font color='green'>       and status information, and additional cross-check word</font></i>
<a name='L53'><i><font color='green'>       if FOOTERS is defined.</font></i>
<a name='L54'><i><font color='green'></font></i>
<a name='L55'><i><font color='green'>  Minimum allocated size: 4-byte ptrs:  16 bytes    (including overhead)</font></i>
<a name='L56'><i><font color='green'>                          8-byte ptrs:  32 bytes    (including overhead)</font></i>
<a name='L57'><i><font color='green'></font></i>
<a name='L58'><i><font color='green'>       Even a request for zero bytes (i.e., malloc(0)) returns a</font></i>
<a name='L59'><i><font color='green'>       pointer to something of the minimum allocatable size.</font></i>
<a name='L60'><i><font color='green'>       The maximum overhead wastage (i.e., number of extra bytes</font></i>
<a name='L61'><i><font color='green'>       allocated than were requested in malloc) is less than or equal</font></i>
<a name='L62'><i><font color='green'>       to the minimum size, except for requests &gt;= mmap_threshold that</font></i>
<a name='L63'><i><font color='green'>       are serviced via mmap(), where the worst case wastage is about</font></i>
<a name='L64'><i><font color='green'>       32 bytes plus the remainder from a system page (the minimal</font></i>
<a name='L65'><i><font color='green'>       mmap unit); typically 4096 or 8192 bytes.</font></i>
<a name='L66'><i><font color='green'></font></i>
<a name='L67'><i><font color='green'>  Security: static-safe; optionally more or less</font></i>
<a name='L68'><i><font color='green'>       The "security" of malloc refers to the ability of malicious</font></i>
<a name='L69'><i><font color='green'>       code to accentuate the effects of errors (for example, freeing</font></i>
<a name='L70'><i><font color='green'>       space that is not currently malloc'ed or overwriting past the</font></i>
<a name='L71'><i><font color='green'>       ends of chunks) in code that calls malloc.  This malloc</font></i>
<a name='L72'><i><font color='green'>       guarantees not to modify any memory locations below the base of</font></i>
<a name='L73'><i><font color='green'>       heap, i.e., static variables, even in the presence of usage</font></i>
<a name='L74'><i><font color='green'>       errors.  The routines additionally detect most improper frees</font></i>
<a name='L75'><i><font color='green'>       and reallocs.  All this holds as long as the static bookkeeping</font></i>
<a name='L76'><i><font color='green'>       for malloc itself is not corrupted by some other means.  This</font></i>
<a name='L77'><i><font color='green'>       is only one aspect of security -- these checks do not, and</font></i>
<a name='L78'><i><font color='green'>       cannot, detect all possible programming errors.</font></i>
<a name='L79'><i><font color='green'></font></i>
<a name='L80'><i><font color='green'>       If FOOTERS is defined nonzero, then each allocated chunk</font></i>
<a name='L81'><i><font color='green'>       carries an additional check word to verify that it was malloced</font></i>
<a name='L82'><i><font color='green'>       from its space.  These check words are the same within each</font></i>
<a name='L83'><i><font color='green'>       execution of a program using malloc, but differ across</font></i>
<a name='L84'><i><font color='green'>       executions, so externally crafted fake chunks cannot be</font></i>
<a name='L85'><i><font color='green'>       freed. This improves security by rejecting frees/reallocs that</font></i>
<a name='L86'><i><font color='green'>       could corrupt heap memory, in addition to the checks preventing</font></i>
<a name='L87'><i><font color='green'>       writes to statics that are always on.  This may further improve</font></i>
<a name='L88'><i><font color='green'>       security at the expense of time and space overhead.  (Note that</font></i>
<a name='L89'><i><font color='green'>       FOOTERS may also be worth using with MSPACES.)</font></i>
<a name='L90'><i><font color='green'></font></i>
<a name='L91'><i><font color='green'>       By default detected errors cause the program to abort (calling</font></i>
<a name='L92'><i><font color='green'>       "abort()"). You can override this to instead proceed past</font></i>
<a name='L93'><i><font color='green'>       errors by defining PROCEED_ON_ERROR.  In this case, a bad free</font></i>
<a name='L94'><i><font color='green'>       has no effect, and a malloc that encounters a bad address</font></i>
<a name='L95'><i><font color='green'>       caused by user overwrites will ignore the bad address by</font></i>
<a name='L96'><i><font color='green'>       dropping pointers and indices to all known memory. This may</font></i>
<a name='L97'><i><font color='green'>       be appropriate for programs that should continue if at all</font></i>
<a name='L98'><i><font color='green'>       possible in the face of programming errors, although they may</font></i>
<a name='L99'><i><font color='green'>       run out of memory because dropped memory is never reclaimed.</font></i>
<a name='L100'><i><font color='green'></font></i>
<a name='L101'><i><font color='green'>       If you don't like either of these options, you can define</font></i>
<a name='L102'><i><font color='green'>       CORRUPTION_ERROR_ACTION and USAGE_ERROR_ACTION to do anything</font></i>
<a name='L103'><i><font color='green'>       else. And if if you are sure that your program using malloc has</font></i>
<a name='L104'><i><font color='green'>       no errors or vulnerabilities, you can define INSECURE to 1,</font></i>
<a name='L105'><i><font color='green'>       which might (or might not) provide a small performance improvement.</font></i>
<a name='L106'><i><font color='green'></font></i>
<a name='L107'><i><font color='green'>  Thread-safety: NOT thread-safe unless USE_LOCKS defined</font></i>
<a name='L108'><i><font color='green'>       When USE_LOCKS is defined, each public call to malloc, free,</font></i>
<a name='L109'><i><font color='green'>       etc is surrounded with either a pthread mutex or a win32</font></i>
<a name='L110'><i><font color='green'>       spinlock (depending on WIN32). This is not especially fast, and</font></i>
<a name='L111'><i><font color='green'>       can be a major bottleneck.  It is designed only to provide</font></i>
<a name='L112'><i><font color='green'>       minimal protection in concurrent environments, and to provide a</font></i>
<a name='L113'><i><font color='green'>       basis for extensions.  If you are using malloc in a concurrent</font></i>
<a name='L114'><i><font color='green'>       program, consider instead using ptmalloc, which is derived from</font></i>
<a name='L115'><i><font color='green'>       a version of this malloc. (See http://www.malloc.de).</font></i>
<a name='L116'><i><font color='green'></font></i>
<a name='L117'><i><font color='green'>  System requirements: Any combination of MORECORE and/or MMAP/MUNMAP</font></i>
<a name='L118'><i><font color='green'>       This malloc can use unix sbrk or any emulation (invoked using</font></i>
<a name='L119'><i><font color='green'>       the CALL_MORECORE macro) and/or mmap/munmap or any emulation</font></i>
<a name='L120'><i><font color='green'>       (invoked using CALL_MMAP/CALL_MUNMAP) to get and release system</font></i>
<a name='L121'><i><font color='green'>       memory.  On most unix systems, it tends to work best if both</font></i>
<a name='L122'><i><font color='green'>       MORECORE and MMAP are enabled.  On Win32, it uses emulations</font></i>
<a name='L123'><i><font color='green'>       based on VirtualAlloc. It also uses common C library functions</font></i>
<a name='L124'><i><font color='green'>       like memset.</font></i>
<a name='L125'><i><font color='green'></font></i>
<a name='L126'><i><font color='green'>  Compliance: I believe it is compliant with the Single Unix Specification</font></i>
<a name='L127'><i><font color='green'>       (See http://www.unix.org). Also SVID/XPG, ANSI C, and probably</font></i>
<a name='L128'><i><font color='green'>       others as well.</font></i>
<a name='L129'><i><font color='green'></font></i>
<a name='L130'><i><font color='green'>* Overview of algorithms</font></i>
<a name='L131'><i><font color='green'></font></i>
<a name='L132'><i><font color='green'>  This is not the fastest, most space-conserving, most portable, or</font></i>
<a name='L133'><i><font color='green'>  most tunable malloc ever written. However it is among the fastest</font></i>
<a name='L134'><i><font color='green'>  while also being among the most space-conserving, portable and</font></i>
<a name='L135'><i><font color='green'>  tunable.  Consistent balance across these factors results in a good</font></i>
<a name='L136'><i><font color='green'>  general-purpose allocator for malloc-intensive programs.</font></i>
<a name='L137'><i><font color='green'></font></i>
<a name='L138'><i><font color='green'>  In most ways, this malloc is a best-fit allocator. Generally, it</font></i>
<a name='L139'><i><font color='green'>  chooses the best-fitting existing chunk for a request, with ties</font></i>
<a name='L140'><i><font color='green'>  broken in approximately least-recently-used order. (This strategy</font></i>
<a name='L141'><i><font color='green'>  normally maintains low fragmentation.) However, for requests less</font></i>
<a name='L142'><i><font color='green'>  than 256bytes, it deviates from best-fit when there is not an</font></i>
<a name='L143'><i><font color='green'>  exactly fitting available chunk by preferring to use space adjacent</font></i>
<a name='L144'><i><font color='green'>  to that used for the previous small request, as well as by breaking</font></i>
<a name='L145'><i><font color='green'>  ties in approximately most-recently-used order. (These enhance</font></i>
<a name='L146'><i><font color='green'>  locality of series of small allocations.)  And for very large requests</font></i>
<a name='L147'><i><font color='green'>  (&gt;= 256Kb by default), it relies on system memory mapping</font></i>
<a name='L148'><i><font color='green'>  facilities, if supported.  (This helps avoid carrying around and</font></i>
<a name='L149'><i><font color='green'>  possibly fragmenting memory used only for large chunks.)</font></i>
<a name='L150'><i><font color='green'></font></i>
<a name='L151'><i><font color='green'>  All operations (except malloc_stats and mallinfo) have execution</font></i>
<a name='L152'><i><font color='green'>  times that are bounded by a constant factor of the number of bits in</font></i>
<a name='L153'><i><font color='green'>  a size_t, not counting any clearing in calloc or copying in realloc,</font></i>
<a name='L154'><i><font color='green'>  or actions surrounding MORECORE and MMAP that have times</font></i>
<a name='L155'><i><font color='green'>  proportional to the number of non-contiguous regions returned by</font></i>
<a name='L156'><i><font color='green'>  system allocation routines, which is often just 1.</font></i>
<a name='L157'><i><font color='green'></font></i>
<a name='L158'><i><font color='green'>  The implementation is not very modular and seriously overuses</font></i>
<a name='L159'><i><font color='green'>  macros. Perhaps someday all C compilers will do as good a job</font></i>
<a name='L160'><i><font color='green'>  inlining modular code as can now be done by brute-force expansion,</font></i>
<a name='L161'><i><font color='green'>  but now, enough of them seem not to.</font></i>
<a name='L162'><i><font color='green'></font></i>
<a name='L163'><i><font color='green'>  Some compilers issue a lot of warnings about code that is</font></i>
<a name='L164'><i><font color='green'>  dead/unreachable only on some platforms, and also about intentional</font></i>
<a name='L165'><i><font color='green'>  uses of negation on unsigned types. All known cases of each can be</font></i>
<a name='L166'><i><font color='green'>  ignored.</font></i>
<a name='L167'><i><font color='green'></font></i>
<a name='L168'><i><font color='green'>  For a longer but out of date high-level description, see</font></i>
<a name='L169'><i><font color='green'>     http://gee.cs.oswego.edu/dl/html/malloc.html</font></i>
<a name='L170'><i><font color='green'></font></i>
<a name='L171'><i><font color='green'>* MSPACES</font></i>
<a name='L172'><i><font color='green'>  If MSPACES is defined, then in addition to malloc, free, etc.,</font></i>
<a name='L173'><i><font color='green'>  this file also defines mspace_malloc, mspace_free, etc. These</font></i>
<a name='L174'><i><font color='green'>  are versions of malloc routines that take an "mspace" argument</font></i>
<a name='L175'><i><font color='green'>  obtained using create_mspace, to control all internal bookkeeping.</font></i>
<a name='L176'><i><font color='green'>  If ONLY_MSPACES is defined, only these versions are compiled.</font></i>
<a name='L177'><i><font color='green'>  So if you would like to use this allocator for only some allocations,</font></i>
<a name='L178'><i><font color='green'>  and your system malloc for others, you can compile with</font></i>
<a name='L179'><i><font color='green'>  ONLY_MSPACES and then do something like...</font></i>
<a name='L180'><i><font color='green'>    static mspace mymspace = create_mspace(0,0); // for example</font></i>
<a name='L181'><i><font color='green'>    #define mymalloc(bytes)  mspace_malloc(mymspace, bytes)</font></i>
<a name='L182'><i><font color='green'></font></i>
<a name='L183'><i><font color='green'>  (Note: If you only need one instance of an mspace, you can instead</font></i>
<a name='L184'><i><font color='green'>  use "USE_DL_PREFIX" to relabel the global malloc.)</font></i>
<a name='L185'><i><font color='green'></font></i>
<a name='L186'><i><font color='green'>  You can similarly create thread-local allocators by storing</font></i>
<a name='L187'><i><font color='green'>  mspaces as thread-locals. For example:</font></i>
<a name='L188'><i><font color='green'>    static __thread mspace tlms = 0;</font></i>
<a name='L189'><i><font color='green'>    void*  tlmalloc(size_t bytes) {</font></i>
<a name='L190'><i><font color='green'>      if (tlms == 0) tlms = create_mspace(0, 0);</font></i>
<a name='L191'><i><font color='green'>      return mspace_malloc(tlms, bytes);</font></i>
<a name='L192'><i><font color='green'>    }</font></i>
<a name='L193'><i><font color='green'>    void  tlfree(void* mem) { mspace_free(tlms, mem); }</font></i>
<a name='L194'><i><font color='green'></font></i>
<a name='L195'><i><font color='green'>  Unless FOOTERS is defined, each mspace is completely independent.</font></i>
<a name='L196'><i><font color='green'>  You cannot allocate from one and free to another (although</font></i>
<a name='L197'><i><font color='green'>  conformance is only weakly checked, so usage errors are not always</font></i>
<a name='L198'><i><font color='green'>  caught). If FOOTERS is defined, then each chunk carries around a tag</font></i>
<a name='L199'><i><font color='green'>  indicating its originating mspace, and frees are directed to their</font></i>
<a name='L200'><i><font color='green'>  originating spaces.</font></i>
<a name='L201'><i><font color='green'></font></i>
<a name='L202'><i><font color='green'> -------------------------  Compile-time options ---------------------------</font></i>
<a name='L203'><i><font color='green'></font></i>
<a name='L204'><i><font color='green'>Be careful in setting #define values for numerical constants of type</font></i>
<a name='L205'><i><font color='green'>size_t. On some systems, literal values are not automatically extended</font></i>
<a name='L206'><i><font color='green'>to size_t precision unless they are explicitly casted.</font></i>
<a name='L207'><i><font color='green'></font></i>
<a name='L208'><i><font color='green'>WIN32                    default: defined if _WIN32 defined</font></i>
<a name='L209'><i><font color='green'>  Defining WIN32 sets up defaults for MS environment and compilers.</font></i>
<a name='L210'><i><font color='green'>  Otherwise defaults are for unix.</font></i>
<a name='L211'><i><font color='green'></font></i>
<a name='L212'><i><font color='green'>MALLOC_ALIGNMENT         default: (size_t)8</font></i>
<a name='L213'><i><font color='green'>  Controls the minimum alignment for malloc'ed chunks.  It must be a</font></i>
<a name='L214'><i><font color='green'>  power of two and at least 8, even on machines for which smaller</font></i>
<a name='L215'><i><font color='green'>  alignments would suffice. It may be defined as larger than this</font></i>
<a name='L216'><i><font color='green'>  though. Note however that code and data structures are optimized for</font></i>
<a name='L217'><i><font color='green'>  the case of 8-byte alignment.</font></i>
<a name='L218'><i><font color='green'></font></i>
<a name='L219'><i><font color='green'>MSPACES                  default: 0 (false)</font></i>
<a name='L220'><i><font color='green'>  If true, compile in support for independent allocation spaces.</font></i>
<a name='L221'><i><font color='green'>  This is only supported if HAVE_MMAP is true.</font></i>
<a name='L222'><i><font color='green'></font></i>
<a name='L223'><i><font color='green'>ONLY_MSPACES             default: 0 (false)</font></i>
<a name='L224'><i><font color='green'>  If true, only compile in mspace versions, not regular versions.</font></i>
<a name='L225'><i><font color='green'></font></i>
<a name='L226'><i><font color='green'>USE_LOCKS                default: 0 (false)</font></i>
<a name='L227'><i><font color='green'>  Causes each call to each public routine to be surrounded with</font></i>
<a name='L228'><i><font color='green'>  pthread or WIN32 mutex lock/unlock. (If set true, this can be</font></i>
<a name='L229'><i><font color='green'>  overridden on a per-mspace basis for mspace versions.)</font></i>
<a name='L230'><i><font color='green'></font></i>
<a name='L231'><i><font color='green'>FOOTERS                  default: 0</font></i>
<a name='L232'><i><font color='green'>  If true, provide extra checking and dispatching by placing</font></i>
<a name='L233'><i><font color='green'>  information in the footers of allocated chunks. This adds</font></i>
<a name='L234'><i><font color='green'>  space and time overhead.</font></i>
<a name='L235'><i><font color='green'></font></i>
<a name='L236'><i><font color='green'>INSECURE                 default: 0</font></i>
<a name='L237'><i><font color='green'>  If true, omit checks for usage errors and heap space overwrites.</font></i>
<a name='L238'><i><font color='green'></font></i>
<a name='L239'><i><font color='green'>USE_DL_PREFIX            default: NOT defined</font></i>
<a name='L240'><i><font color='green'>  Causes compiler to prefix all public routines with the string 'dl'.</font></i>
<a name='L241'><i><font color='green'>  This can be useful when you only want to use this malloc in one part</font></i>
<a name='L242'><i><font color='green'>  of a program, using your regular system malloc elsewhere.</font></i>
<a name='L243'><i><font color='green'></font></i>
<a name='L244'><i><font color='green'>ABORT                    default: defined as abort()</font></i>
<a name='L245'><i><font color='green'>  Defines how to abort on failed checks.  On most systems, a failed</font></i>
<a name='L246'><i><font color='green'>  check cannot die with an "assert" or even print an informative</font></i>
<a name='L247'><i><font color='green'>  message, because the underlying print routines in turn call malloc,</font></i>
<a name='L248'><i><font color='green'>  which will fail again.  Generally, the best policy is to simply call</font></i>
<a name='L249'><i><font color='green'>  abort(). It's not very useful to do more than this because many</font></i>
<a name='L250'><i><font color='green'>  errors due to overwriting will show up as address faults (null, odd</font></i>
<a name='L251'><i><font color='green'>  addresses etc) rather than malloc-triggered checks, so will also</font></i>
<a name='L252'><i><font color='green'>  abort.  Also, most compilers know that abort() does not return, so</font></i>
<a name='L253'><i><font color='green'>  can better optimize code conditionally calling it.</font></i>
<a name='L254'><i><font color='green'></font></i>
<a name='L255'><i><font color='green'>PROCEED_ON_ERROR           default: defined as 0 (false)</font></i>
<a name='L256'><i><font color='green'>  Controls whether detected bad addresses cause them to bypassed</font></i>
<a name='L257'><i><font color='green'>  rather than aborting. If set, detected bad arguments to free and</font></i>
<a name='L258'><i><font color='green'>  realloc are ignored. And all bookkeeping information is zeroed out</font></i>
<a name='L259'><i><font color='green'>  upon a detected overwrite of freed heap space, thus losing the</font></i>
<a name='L260'><i><font color='green'>  ability to ever return it from malloc again, but enabling the</font></i>
<a name='L261'><i><font color='green'>  application to proceed. If PROCEED_ON_ERROR is defined, the</font></i>
<a name='L262'><i><font color='green'>  static variable malloc_corruption_error_count is compiled in</font></i>
<a name='L263'><i><font color='green'>  and can be examined to see if errors have occurred. This option</font></i>
<a name='L264'><i><font color='green'>  generates slower code than the default abort policy.</font></i>
<a name='L265'><i><font color='green'></font></i>
<a name='L266'><i><font color='green'>DEBUG                    default: NOT defined</font></i>
<a name='L267'><i><font color='green'>  The DEBUG setting is mainly intended for people trying to modify</font></i>
<a name='L268'><i><font color='green'>  this code or diagnose problems when porting to new platforms.</font></i>
<a name='L269'><i><font color='green'>  However, it may also be able to better isolate user errors than just</font></i>
<a name='L270'><i><font color='green'>  using runtime checks.  The assertions in the check routines spell</font></i>
<a name='L271'><i><font color='green'>  out in more detail the assumptions and invariants underlying the</font></i>
<a name='L272'><i><font color='green'>  algorithms.  The checking is fairly extensive, and will slow down</font></i>
<a name='L273'><i><font color='green'>  execution noticeably. Calling malloc_stats or mallinfo with DEBUG</font></i>
<a name='L274'><i><font color='green'>  set will attempt to check every non-mmapped allocated and free chunk</font></i>
<a name='L275'><i><font color='green'>  in the course of computing the summaries.</font></i>
<a name='L276'><i><font color='green'></font></i>
<a name='L277'><i><font color='green'>ABORT_ON_ASSERT_FAILURE   default: defined as 1 (true)</font></i>
<a name='L278'><i><font color='green'>  Debugging assertion failures can be nearly impossible if your</font></i>
<a name='L279'><i><font color='green'>  version of the assert macro causes malloc to be called, which will</font></i>
<a name='L280'><i><font color='green'>  lead to a cascade of further failures, blowing the runtime stack.</font></i>
<a name='L281'><i><font color='green'>  ABORT_ON_ASSERT_FAILURE cause assertions failures to call abort(),</font></i>
<a name='L282'><i><font color='green'>  which will usually make debugging easier.</font></i>
<a name='L283'><i><font color='green'></font></i>
<a name='L284'><i><font color='green'>MALLOC_FAILURE_ACTION     default: sets errno to ENOMEM, or no-op on win32</font></i>
<a name='L285'><i><font color='green'>  The action to take before "return 0" when malloc fails to be able to</font></i>
<a name='L286'><i><font color='green'>  return memory because there is none available.</font></i>
<a name='L287'><i><font color='green'></font></i>
<a name='L288'><i><font color='green'>HAVE_MORECORE             default: 1 (true) unless win32 or ONLY_MSPACES</font></i>
<a name='L289'><i><font color='green'>  True if this system supports sbrk or an emulation of it.</font></i>
<a name='L290'><i><font color='green'></font></i>
<a name='L291'><i><font color='green'>MORECORE                  default: sbrk</font></i>
<a name='L292'><i><font color='green'>  The name of the sbrk-style system routine to call to obtain more</font></i>
<a name='L293'><i><font color='green'>  memory.  See below for guidance on writing custom MORECORE</font></i>
<a name='L294'><i><font color='green'>  functions. The type of the argument to sbrk/MORECORE varies across</font></i>
<a name='L295'><i><font color='green'>  systems.  It cannot be size_t, because it supports negative</font></i>
<a name='L296'><i><font color='green'>  arguments, so it is normally the signed type of the same width as</font></i>
<a name='L297'><i><font color='green'>  size_t (sometimes declared as "intptr_t").  It doesn't much matter</font></i>
<a name='L298'><i><font color='green'>  though. Internally, we only call it with arguments less than half</font></i>
<a name='L299'><i><font color='green'>  the max value of a size_t, which should work across all reasonable</font></i>
<a name='L300'><i><font color='green'>  possibilities, although sometimes generating compiler warnings.  See</font></i>
<a name='L301'><i><font color='green'>  near the end of this file for guidelines for creating a custom</font></i>
<a name='L302'><i><font color='green'>  version of MORECORE.</font></i>
<a name='L303'><i><font color='green'></font></i>
<a name='L304'><i><font color='green'>MORECORE_CONTIGUOUS       default: 1 (true)</font></i>
<a name='L305'><i><font color='green'>  If true, take advantage of fact that consecutive calls to MORECORE</font></i>
<a name='L306'><i><font color='green'>  with positive arguments always return contiguous increasing</font></i>
<a name='L307'><i><font color='green'>  addresses.  This is true of unix sbrk. It does not hurt too much to</font></i>
<a name='L308'><i><font color='green'>  set it true anyway, since malloc copes with non-contiguities.</font></i>
<a name='L309'><i><font color='green'>  Setting it false when definitely non-contiguous saves time</font></i>
<a name='L310'><i><font color='green'>  and possibly wasted space it would take to discover this though.</font></i>
<a name='L311'><i><font color='green'></font></i>
<a name='L312'><i><font color='green'>MORECORE_CANNOT_TRIM      default: NOT defined</font></i>
<a name='L313'><i><font color='green'>  True if MORECORE cannot release space back to the system when given</font></i>
<a name='L314'><i><font color='green'>  negative arguments. This is generally necessary only if you are</font></i>
<a name='L315'><i><font color='green'>  using a hand-crafted MORECORE function that cannot handle negative</font></i>
<a name='L316'><i><font color='green'>  arguments.</font></i>
<a name='L317'><i><font color='green'></font></i>
<a name='L318'><i><font color='green'>HAVE_MMAP                 default: 1 (true)</font></i>
<a name='L319'><i><font color='green'>  True if this system supports mmap or an emulation of it.  If so, and</font></i>
<a name='L320'><i><font color='green'>  HAVE_MORECORE is not true, MMAP is used for all system</font></i>
<a name='L321'><i><font color='green'>  allocation. If set and HAVE_MORECORE is true as well, MMAP is</font></i>
<a name='L322'><i><font color='green'>  primarily used to directly allocate very large blocks. It is also</font></i>
<a name='L323'><i><font color='green'>  used as a backup strategy in cases where MORECORE fails to provide</font></i>
<a name='L324'><i><font color='green'>  space from system. Note: A single call to MUNMAP is assumed to be</font></i>
<a name='L325'><i><font color='green'>  able to unmap memory that may have be allocated using multiple calls</font></i>
<a name='L326'><i><font color='green'>  to MMAP, so long as they are adjacent.</font></i>
<a name='L327'><i><font color='green'></font></i>
<a name='L328'><i><font color='green'>HAVE_MREMAP               default: 1 on linux, else 0</font></i>
<a name='L329'><i><font color='green'>  If true realloc() uses mremap() to re-allocate large blocks and</font></i>
<a name='L330'><i><font color='green'>  extend or shrink allocation spaces.</font></i>
<a name='L331'><i><font color='green'></font></i>
<a name='L332'><i><font color='green'>MMAP_CLEARS               default: 1 on unix</font></i>
<a name='L333'><i><font color='green'>  True if mmap clears memory so calloc doesn't need to. This is true</font></i>
<a name='L334'><i><font color='green'>  for standard unix mmap using /dev/zero.</font></i>
<a name='L335'><i><font color='green'></font></i>
<a name='L336'><i><font color='green'>USE_BUILTIN_FFS            default: 0 (i.e., not used)</font></i>
<a name='L337'><i><font color='green'>  Causes malloc to use the builtin ffs() function to compute indices.</font></i>
<a name='L338'><i><font color='green'>  Some compilers may recognize and intrinsify ffs to be faster than the</font></i>
<a name='L339'><i><font color='green'>  supplied C version. Also, the case of x86 using gcc is special-cased</font></i>
<a name='L340'><i><font color='green'>  to an asm instruction, so is already as fast as it can be, and so</font></i>
<a name='L341'><i><font color='green'>  this setting has no effect. (On most x86s, the asm version is only</font></i>
<a name='L342'><i><font color='green'>  slightly faster than the C version.)</font></i>
<a name='L343'><i><font color='green'></font></i>
<a name='L344'><i><font color='green'>malloc_getpagesize         default: derive from system includes, or 4096.</font></i>
<a name='L345'><i><font color='green'>  The system page size. To the extent possible, this malloc manages</font></i>
<a name='L346'><i><font color='green'>  memory from the system in page-size units.  This may be (and</font></i>
<a name='L347'><i><font color='green'>  usually is) a function rather than a constant. This is ignored</font></i>
<a name='L348'><i><font color='green'>  if WIN32, where page size is determined using getSystemInfo during</font></i>
<a name='L349'><i><font color='green'>  initialization.</font></i>
<a name='L350'><i><font color='green'></font></i>
<a name='L351'><i><font color='green'>USE_DEV_RANDOM             default: 0 (i.e., not used)</font></i>
<a name='L352'><i><font color='green'>  Causes malloc to use /dev/random to initialize secure magic seed for</font></i>
<a name='L353'><i><font color='green'>  stamping footers. Otherwise, the current time is used.</font></i>
<a name='L354'><i><font color='green'></font></i>
<a name='L355'><i><font color='green'>NO_MALLINFO                default: 0</font></i>
<a name='L356'><i><font color='green'>  If defined, don't compile "mallinfo". This can be a simple way</font></i>
<a name='L357'><i><font color='green'>  of dealing with mismatches between system declarations and</font></i>
<a name='L358'><i><font color='green'>  those in this file.</font></i>
<a name='L359'><i><font color='green'></font></i>
<a name='L360'><i><font color='green'>MALLINFO_FIELD_TYPE        default: size_t</font></i>
<a name='L361'><i><font color='green'>  The type of the fields in the mallinfo struct. This was originally</font></i>
<a name='L362'><i><font color='green'>  defined as "int" in SVID etc, but is more usefully defined as</font></i>
<a name='L363'><i><font color='green'>  size_t. The value is used only if  HAVE_USR_INCLUDE_MALLOC_H is not set</font></i>
<a name='L364'><i><font color='green'></font></i>
<a name='L365'><i><font color='green'>REALLOC_ZERO_BYTES_FREES    default: not defined</font></i>
<a name='L366'><i><font color='green'>  This should be set if a call to realloc with zero bytes should </font></i>
<a name='L367'><i><font color='green'>  be the same as a call to free. Some people think it should. Otherwise, </font></i>
<a name='L368'><i><font color='green'>  since this malloc returns a unique pointer for malloc(0), so does </font></i>
<a name='L369'><i><font color='green'>  realloc(p, 0).</font></i>
<a name='L370'><i><font color='green'></font></i>
<a name='L371'><i><font color='green'>LACKS_UNISTD_H, LACKS_FCNTL_H, LACKS_SYS_PARAM_H, LACKS_SYS_MMAN_H</font></i>
<a name='L372'><i><font color='green'>LACKS_STRINGS_H, LACKS_STRING_H, LACKS_SYS_TYPES_H,  LACKS_ERRNO_H</font></i>
<a name='L373'><i><font color='green'>LACKS_STDLIB_H                default: NOT defined unless on WIN32</font></i>
<a name='L374'><i><font color='green'>  Define these if your system does not have these header files.</font></i>
<a name='L375'><i><font color='green'>  You might need to manually insert some of the declarations they provide.</font></i>
<a name='L376'><i><font color='green'></font></i>
<a name='L377'><i><font color='green'>DEFAULT_GRANULARITY        default: page size if MORECORE_CONTIGUOUS,</font></i>
<a name='L378'><i><font color='green'>                                system_info.dwAllocationGranularity in WIN32,</font></i>
<a name='L379'><i><font color='green'>                                otherwise 64K.</font></i>
<a name='L380'><i><font color='green'>      Also settable using mallopt(M_GRANULARITY, x)</font></i>
<a name='L381'><i><font color='green'>  The unit for allocating and deallocating memory from the system.  On</font></i>
<a name='L382'><i><font color='green'>  most systems with contiguous MORECORE, there is no reason to</font></i>
<a name='L383'><i><font color='green'>  make this more than a page. However, systems with MMAP tend to</font></i>
<a name='L384'><i><font color='green'>  either require or encourage larger granularities.  You can increase</font></i>
<a name='L385'><i><font color='green'>  this value to prevent system allocation functions to be called so</font></i>
<a name='L386'><i><font color='green'>  often, especially if they are slow.  The value must be at least one</font></i>
<a name='L387'><i><font color='green'>  page and must be a power of two.  Setting to 0 causes initialization</font></i>
<a name='L388'><i><font color='green'>  to either page size or win32 region size.  (Note: In previous</font></i>
<a name='L389'><i><font color='green'>  versions of malloc, the equivalent of this option was called</font></i>
<a name='L390'><i><font color='green'>  "TOP_PAD")</font></i>
<a name='L391'><i><font color='green'></font></i>
<a name='L392'><i><font color='green'>DEFAULT_TRIM_THRESHOLD    default: 2MB</font></i>
<a name='L393'><i><font color='green'>      Also settable using mallopt(M_TRIM_THRESHOLD, x)</font></i>
<a name='L394'><i><font color='green'>  The maximum amount of unused top-most memory to keep before</font></i>
<a name='L395'><i><font color='green'>  releasing via malloc_trim in free().  Automatic trimming is mainly</font></i>
<a name='L396'><i><font color='green'>  useful in long-lived programs using contiguous MORECORE.  Because</font></i>
<a name='L397'><i><font color='green'>  trimming via sbrk can be slow on some systems, and can sometimes be</font></i>
<a name='L398'><i><font color='green'>  wasteful (in cases where programs immediately afterward allocate</font></i>
<a name='L399'><i><font color='green'>  more large chunks) the value should be high enough so that your</font></i>
<a name='L400'><i><font color='green'>  overall system performance would improve by releasing this much</font></i>
<a name='L401'><i><font color='green'>  memory.  As a rough guide, you might set to a value close to the</font></i>
<a name='L402'><i><font color='green'>  average size of a process (program) running on your system.</font></i>
<a name='L403'><i><font color='green'>  Releasing this much memory would allow such a process to run in</font></i>
<a name='L404'><i><font color='green'>  memory.  Generally, it is worth tuning trim thresholds when a</font></i>
<a name='L405'><i><font color='green'>  program undergoes phases where several large chunks are allocated</font></i>
<a name='L406'><i><font color='green'>  and released in ways that can reuse each other's storage, perhaps</font></i>
<a name='L407'><i><font color='green'>  mixed with phases where there are no such chunks at all. The trim</font></i>
<a name='L408'><i><font color='green'>  value must be greater than page size to have any useful effect.  To</font></i>
<a name='L409'><i><font color='green'>  disable trimming completely, you can set to MAX_SIZE_T. Note that the trick</font></i>
<a name='L410'><i><font color='green'>  some people use of mallocing a huge space and then freeing it at</font></i>
<a name='L411'><i><font color='green'>  program startup, in an attempt to reserve system memory, doesn't</font></i>
<a name='L412'><i><font color='green'>  have the intended effect under automatic trimming, since that memory</font></i>
<a name='L413'><i><font color='green'>  will immediately be returned to the system.</font></i>
<a name='L414'><i><font color='green'></font></i>
<a name='L415'><i><font color='green'>DEFAULT_MMAP_THRESHOLD       default: 256K</font></i>
<a name='L416'><i><font color='green'>      Also settable using mallopt(M_MMAP_THRESHOLD, x)</font></i>
<a name='L417'><i><font color='green'>  The request size threshold for using MMAP to directly service a</font></i>
<a name='L418'><i><font color='green'>  request. Requests of at least this size that cannot be allocated</font></i>
<a name='L419'><i><font color='green'>  using already-existing space will be serviced via mmap.  (If enough</font></i>
<a name='L420'><i><font color='green'>  normal freed space already exists it is used instead.)  Using mmap</font></i>
<a name='L421'><i><font color='green'>  segregates relatively large chunks of memory so that they can be</font></i>
<a name='L422'><i><font color='green'>  individually obtained and released from the host system. A request</font></i>
<a name='L423'><i><font color='green'>  serviced through mmap is never reused by any other request (at least</font></i>
<a name='L424'><i><font color='green'>  not directly; the system may just so happen to remap successive</font></i>
<a name='L425'><i><font color='green'>  requests to the same locations).  Segregating space in this way has</font></i>
<a name='L426'><i><font color='green'>  the benefits that: Mmapped space can always be individually released</font></i>
<a name='L427'><i><font color='green'>  back to the system, which helps keep the system level memory demands</font></i>
<a name='L428'><i><font color='green'>  of a long-lived program low.  Also, mapped memory doesn't become</font></i>
<a name='L429'><i><font color='green'>  `locked' between other chunks, as can happen with normally allocated</font></i>
<a name='L430'><i><font color='green'>  chunks, which means that even trimming via malloc_trim would not</font></i>
<a name='L431'><i><font color='green'>  release them.  However, it has the disadvantage that the space</font></i>
<a name='L432'><i><font color='green'>  cannot be reclaimed, consolidated, and then used to service later</font></i>
<a name='L433'><i><font color='green'>  requests, as happens with normal chunks.  The advantages of mmap</font></i>
<a name='L434'><i><font color='green'>  nearly always outweigh disadvantages for "large" chunks, but the</font></i>
<a name='L435'><i><font color='green'>  value of "large" may vary across systems.  The default is an</font></i>
<a name='L436'><i><font color='green'>  empirically derived value that works well in most systems. You can</font></i>
<a name='L437'><i><font color='green'>  disable mmap by setting to MAX_SIZE_T.</font></i>
<a name='L438'><i><font color='green'></font></i>
<a name='L439'><i><font color='green'>*/</font></i>
<a name='L440'>
<a name='L441'><font color='darkred'>#ifndef</font> <a href='../D/5523.html' title='Multiple defined in 3 places.'>WIN32</a>
<a name='L442'><font color='darkred'>#ifdef</font> _WIN32
<a name='L443'><font color='darkred'>#define</font> <a href='../R/4895.html' title='Multiple refered from 31 places.'>WIN32</a> 1
<a name='L444'><font color='darkred'>#endif</font>  <i><font color='green'>/* _WIN32 */</font></i>
<a name='L445'><font color='darkred'>#endif</font>  <i><font color='green'>/* WIN32 */</font></i>
<a name='L446'><font color='darkred'>#ifdef</font> <a href='../D/5523.html' title='Multiple defined in 3 places.'>WIN32</a>
<a name='L447'><font color='darkred'>#define</font> WIN32_LEAN_AND_MEAN
<a name='L448'><font color='darkred'>#include</font> &lt;windows.h&gt;
<a name='L449'><font color='darkred'>#define</font> <a href='../R/1378.html' title='Multiple refered from 8 places.'>HAVE_MMAP</a> 1
<a name='L450'><font color='darkred'>#define</font> <a href='../R/1382.html' title='Multiple refered from 10 places.'>HAVE_MORECORE</a> 0
<a name='L451'><font color='darkred'>#define</font> <a href='../S/2317.html#L1184' title='Refered from 1184 in Modules/_ctypes/libffi/src/dlmalloc.c.'>LACKS_UNISTD_H</a>
<a name='L452'><font color='darkred'>#define</font> <a href='../S/2317.html#L1210' title='Refered from 1210 in Modules/_ctypes/libffi/src/dlmalloc.c.'>LACKS_SYS_PARAM_H</a>
<a name='L453'><font color='darkred'>#define</font> <a href='../S/2317.html#L1176' title='Refered from 1176 in Modules/_ctypes/libffi/src/dlmalloc.c.'>LACKS_SYS_MMAN_H</a>
<a name='L454'><font color='darkred'>#define</font> <a href='../S/2317.html#L1167' title='Refered from 1167 in Modules/_ctypes/libffi/src/dlmalloc.c.'>LACKS_STRING_H</a>
<a name='L455'><font color='darkred'>#define</font> <a href='../S/2317.html#L1171' title='Refered from 1171 in Modules/_ctypes/libffi/src/dlmalloc.c.'>LACKS_STRINGS_H</a>
<a name='L456'><font color='darkred'>#define</font> <a href='../S/2317.html#L470' title='Refered from 470 in Modules/_ctypes/libffi/src/dlmalloc.c.'>LACKS_SYS_TYPES_H</a>
<a name='L457'><font color='darkred'>#define</font> <a href='../S/2317.html#L1149' title='Refered from 1149 in Modules/_ctypes/libffi/src/dlmalloc.c.'>LACKS_ERRNO_H</a>
<a name='L458'><font color='darkred'>#define</font> <a href='../R/1815.html' title='Multiple refered from 4 places.'>MALLOC_FAILURE_ACTION</a>
<a name='L459'><font color='darkred'>#define</font> <a href='../R/1947.html' title='Multiple refered from 2 places.'>MMAP_CLEARS</a> 0 <i><font color='green'>/* WINCE and some others apparently don't clear */</font></i>
<a name='L460'><font color='darkred'>#endif</font>  <i><font color='green'>/* WIN32 */</font></i>
<a name='L461'>
<a name='L462'><font color='darkred'>#if</font> <b>defined</b>(DARWIN) || <b>defined</b>(_DARWIN)
<a name='L463'><i><font color='green'>/* Mac OSX docs advise not to use sbrk; it seems better to use mmap */</font></i>
<a name='L464'><font color='darkred'>#ifndef</font> <a href='../D/1537.html' title='Multiple defined in 5 places.'>HAVE_MORECORE</a>
<a name='L465'><font color='darkred'>#define</font> <a href='../R/1382.html' title='Multiple refered from 10 places.'>HAVE_MORECORE</a> 0
<a name='L466'><font color='darkred'>#define</font> <a href='../R/1378.html' title='Multiple refered from 8 places.'>HAVE_MMAP</a> 1
<a name='L467'><font color='darkred'>#endif</font>  <i><font color='green'>/* HAVE_MORECORE */</font></i>
<a name='L468'><font color='darkred'>#endif</font>  <i><font color='green'>/* DARWIN */</font></i>
<a name='L469'>
<a name='L470'><font color='darkred'>#ifndef</font> <a href='../S/2317.html#L456' title='Defined at 456 in Modules/_ctypes/libffi/src/dlmalloc.c.'>LACKS_SYS_TYPES_H</a>
<a name='L471'><font color='darkred'>#include</font> &lt;sys/types.h&gt;  <i><font color='green'>/* For size_t */</font></i>
<a name='L472'><font color='darkred'>#endif</font>  <i><font color='green'>/* LACKS_SYS_TYPES_H */</font></i>
<a name='L473'>
<a name='L474'><i><font color='green'>/* The maximum possible size_t value has all bits set */</font></i>
<a name='L475'><font color='darkred'>#define</font> <a href='../R/1881.html' title='Multiple refered from 11 places.'>MAX_SIZE_T</a>           (~(<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)0)
<a name='L476'>
<a name='L477'><font color='darkred'>#ifndef</font> <a href='../S/2317.html#L478' title='Defined at 478 in Modules/_ctypes/libffi/src/dlmalloc.c.'>ONLY_MSPACES</a>
<a name='L478'><font color='darkred'>#define</font> <a href='../R/2188.html' title='Multiple refered from 6 places.'>ONLY_MSPACES</a> 0
<a name='L479'><font color='darkred'>#endif</font>  <i><font color='green'>/* ONLY_MSPACES */</font></i>
<a name='L480'><font color='darkred'>#ifndef</font> <a href='../D/2179.html' title='Multiple defined in 2 places.'>MSPACES</a>
<a name='L481'><font color='darkred'>#if</font> <a href='../S/2317.html#L478' title='Defined at 478 in Modules/_ctypes/libffi/src/dlmalloc.c.'>ONLY_MSPACES</a>
<a name='L482'><font color='darkred'>#define</font> <a href='../R/1976.html' title='Multiple refered from 4 places.'>MSPACES</a> 1
<a name='L483'><font color='darkred'>#else</font>   <i><font color='green'>/* ONLY_MSPACES */</font></i>
<a name='L484'><font color='darkred'>#define</font> <a href='../R/1976.html' title='Multiple refered from 4 places.'>MSPACES</a> 0
<a name='L485'><font color='darkred'>#endif</font>  <i><font color='green'>/* ONLY_MSPACES */</font></i>
<a name='L486'><font color='darkred'>#endif</font>  <i><font color='green'>/* MSPACES */</font></i>
<a name='L487'><font color='darkred'>#ifndef</font> <a href='../S/2317.html#L488' title='Defined at 488 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MALLOC_ALIGNMENT</a>
<a name='L488'><font color='darkred'>#define</font> <a href='../R/1814.html' title='Multiple refered from 7 places.'>MALLOC_ALIGNMENT</a> ((<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)8U)
<a name='L489'><font color='darkred'>#endif</font>  <i><font color='green'>/* MALLOC_ALIGNMENT */</font></i>
<a name='L490'><font color='darkred'>#ifndef</font> <a href='../S/2317.html#L491' title='Defined at 491 in Modules/_ctypes/libffi/src/dlmalloc.c.'>FOOTERS</a>
<a name='L491'><font color='darkred'>#define</font> <a href='../R/1147.html' title='Multiple refered from 11 places.'>FOOTERS</a> 0
<a name='L492'><font color='darkred'>#endif</font>  <i><font color='green'>/* FOOTERS */</font></i>
<a name='L493'><font color='darkred'>#ifndef</font> <a href='../S/2317.html#L494' title='Defined at 494 in Modules/_ctypes/libffi/src/dlmalloc.c.'>ABORT</a>
<a name='L494'><font color='darkred'>#define</font> <a href='../R/2.html' title='Multiple refered from 7 places.'>ABORT</a>  <a href='../S/2520.html#L152' title='Defined at 152 in Modules/_ctypes/libffi_arm_wince/fficonfig.h.'>abort</a>()
<a name='L495'><font color='darkred'>#endif</font>  <i><font color='green'>/* ABORT */</font></i>
<a name='L496'><font color='darkred'>#ifndef</font> <a href='../S/2317.html#L497' title='Defined at 497 in Modules/_ctypes/libffi/src/dlmalloc.c.'>ABORT_ON_ASSERT_FAILURE</a>
<a name='L497'><font color='darkred'>#define</font> <a href='../R/3.html' title='Multiple refered from 2 places.'>ABORT_ON_ASSERT_FAILURE</a> 1
<a name='L498'><font color='darkred'>#endif</font>  <i><font color='green'>/* ABORT_ON_ASSERT_FAILURE */</font></i>
<a name='L499'><font color='darkred'>#ifndef</font> <a href='../S/2317.html#L500' title='Defined at 500 in Modules/_ctypes/libffi/src/dlmalloc.c.'>PROCEED_ON_ERROR</a>
<a name='L500'><font color='darkred'>#define</font> <a href='../R/2305.html' title='Multiple refered from 3 places.'>PROCEED_ON_ERROR</a> 0
<a name='L501'><font color='darkred'>#endif</font>  <i><font color='green'>/* PROCEED_ON_ERROR */</font></i>
<a name='L502'><font color='darkred'>#ifndef</font> <a href='../D/5395.html' title='Multiple defined in 2 places.'>USE_LOCKS</a>
<a name='L503'><font color='darkred'>#define</font> <a href='../R/4773.html' title='Multiple refered from 6 places.'>USE_LOCKS</a> 0
<a name='L504'><font color='darkred'>#endif</font>  <i><font color='green'>/* USE_LOCKS */</font></i>
<a name='L505'><font color='darkred'>#ifndef</font> <a href='../S/2317.html#L506' title='Defined at 506 in Modules/_ctypes/libffi/src/dlmalloc.c.'>INSECURE</a>
<a name='L506'><font color='darkred'>#define</font> <a href='../R/1548.html' title='Multiple refered from 5 places.'>INSECURE</a> 0
<a name='L507'><font color='darkred'>#endif</font>  <i><font color='green'>/* INSECURE */</font></i>
<a name='L508'><font color='darkred'>#ifndef</font> <a href='../D/1532.html' title='Multiple defined in 5 places.'>HAVE_MMAP</a>
<a name='L509'><font color='darkred'>#define</font> <a href='../R/1378.html' title='Multiple refered from 8 places.'>HAVE_MMAP</a> 1
<a name='L510'><font color='darkred'>#endif</font>  <i><font color='green'>/* HAVE_MMAP */</font></i>
<a name='L511'><font color='darkred'>#ifndef</font> <a href='../D/2150.html' title='Multiple defined in 2 places.'>MMAP_CLEARS</a>
<a name='L512'><font color='darkred'>#define</font> <a href='../R/1947.html' title='Multiple refered from 2 places.'>MMAP_CLEARS</a> 1
<a name='L513'><font color='darkred'>#endif</font>  <i><font color='green'>/* MMAP_CLEARS */</font></i>
<a name='L514'><font color='darkred'>#ifndef</font> <a href='../D/1538.html' title='Multiple defined in 3 places.'>HAVE_MREMAP</a>
<a name='L515'><font color='darkred'>#ifdef</font> linux
<a name='L516'><font color='darkred'>#define</font> <a href='../R/1383.html' title='Multiple refered from 3 places.'>HAVE_MREMAP</a> 1
<a name='L517'><font color='darkred'>#else</font>   <i><font color='green'>/* linux */</font></i>
<a name='L518'><font color='darkred'>#define</font> <a href='../R/1383.html' title='Multiple refered from 3 places.'>HAVE_MREMAP</a> 0
<a name='L519'><font color='darkred'>#endif</font>  <i><font color='green'>/* linux */</font></i>
<a name='L520'><font color='darkred'>#endif</font>  <i><font color='green'>/* HAVE_MREMAP */</font></i>
<a name='L521'><font color='darkred'>#ifndef</font> <a href='../D/2013.html' title='Multiple defined in 2 places.'>MALLOC_FAILURE_ACTION</a>
<a name='L522'><font color='darkred'>#define</font> <a href='../R/1815.html' title='Multiple refered from 4 places.'>MALLOC_FAILURE_ACTION</a>  errno = ENOMEM;
<a name='L523'><font color='darkred'>#endif</font>  <i><font color='green'>/* MALLOC_FAILURE_ACTION */</font></i>
<a name='L524'><font color='darkred'>#ifndef</font> <a href='../D/1537.html' title='Multiple defined in 5 places.'>HAVE_MORECORE</a>
<a name='L525'><font color='darkred'>#if</font> <a href='../S/2317.html#L478' title='Defined at 478 in Modules/_ctypes/libffi/src/dlmalloc.c.'>ONLY_MSPACES</a>
<a name='L526'><font color='darkred'>#define</font> <a href='../R/1382.html' title='Multiple refered from 10 places.'>HAVE_MORECORE</a> 0
<a name='L527'><font color='darkred'>#else</font>   <i><font color='green'>/* ONLY_MSPACES */</font></i>
<a name='L528'><font color='darkred'>#define</font> <a href='../R/1382.html' title='Multiple refered from 10 places.'>HAVE_MORECORE</a> 1
<a name='L529'><font color='darkred'>#endif</font>  <i><font color='green'>/* ONLY_MSPACES */</font></i>
<a name='L530'><font color='darkred'>#endif</font>  <i><font color='green'>/* HAVE_MORECORE */</font></i>
<a name='L531'><font color='darkred'>#if</font> !<a href='../D/1537.html' title='Multiple defined in 5 places.'>HAVE_MORECORE</a>
<a name='L532'><font color='darkred'>#define</font> <a href='../R/1964.html' title='Multiple refered from 4 places.'>MORECORE_CONTIGUOUS</a> 0
<a name='L533'><font color='darkred'>#else</font>   <i><font color='green'>/* !HAVE_MORECORE */</font></i>
<a name='L534'><font color='darkred'>#ifndef</font> <a href='../S/2317.html#L535' title='Defined at 535 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MORECORE</a>
<a name='L535'><font color='darkred'>#define</font> <a href='../R/1963.html' title='Multiple refered from 2 places.'>MORECORE</a> sbrk
<a name='L536'><font color='darkred'>#endif</font>  <i><font color='green'>/* MORECORE */</font></i>
<a name='L537'><font color='darkred'>#ifndef</font> <a href='../D/2167.html' title='Multiple defined in 2 places.'>MORECORE_CONTIGUOUS</a>
<a name='L538'><font color='darkred'>#define</font> <a href='../R/1964.html' title='Multiple refered from 4 places.'>MORECORE_CONTIGUOUS</a> 1
<a name='L539'><font color='darkred'>#endif</font>  <i><font color='green'>/* MORECORE_CONTIGUOUS */</font></i>
<a name='L540'><font color='darkred'>#endif</font>  <i><font color='green'>/* HAVE_MORECORE */</font></i>
<a name='L541'><font color='darkred'>#ifndef</font> <a href='../D/755.html' title='Multiple defined in 3 places.'>DEFAULT_GRANULARITY</a>
<a name='L542'><font color='darkred'>#if</font> <a href='../D/2167.html' title='Multiple defined in 2 places.'>MORECORE_CONTIGUOUS</a>
<a name='L543'><font color='darkred'>#define</font> <a href='../R/703.html' title='Multiple refered from 3 places.'>DEFAULT_GRANULARITY</a> (0)  <i><font color='green'>/* 0 means to compute in init_mparams */</font></i>
<a name='L544'><font color='darkred'>#else</font>   <i><font color='green'>/* MORECORE_CONTIGUOUS */</font></i>
<a name='L545'><font color='darkred'>#define</font> <a href='../R/703.html' title='Multiple refered from 3 places.'>DEFAULT_GRANULARITY</a> ((<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)64U * (<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)1024U)
<a name='L546'><font color='darkred'>#endif</font>  <i><font color='green'>/* MORECORE_CONTIGUOUS */</font></i>
<a name='L547'><font color='darkred'>#endif</font>  <i><font color='green'>/* DEFAULT_GRANULARITY */</font></i>
<a name='L548'><font color='darkred'>#ifndef</font> <a href='../D/760.html' title='Multiple defined in 3 places.'>DEFAULT_TRIM_THRESHOLD</a>
<a name='L549'><font color='darkred'>#ifndef</font> MORECORE_CANNOT_TRIM
<a name='L550'><font color='darkred'>#define</font> <a href='../R/708.html' title='Multiple refered from 2 places.'>DEFAULT_TRIM_THRESHOLD</a> ((<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)2U * (<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)1024U * (<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)1024U)
<a name='L551'><font color='darkred'>#else</font>   <i><font color='green'>/* MORECORE_CANNOT_TRIM */</font></i>
<a name='L552'><font color='darkred'>#define</font> <a href='../R/708.html' title='Multiple refered from 2 places.'>DEFAULT_TRIM_THRESHOLD</a> <a href='../S/2317.html#L475' title='Defined at 475 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MAX_SIZE_T</a>
<a name='L553'><font color='darkred'>#endif</font>  <i><font color='green'>/* MORECORE_CANNOT_TRIM */</font></i>
<a name='L554'><font color='darkred'>#endif</font>  <i><font color='green'>/* DEFAULT_TRIM_THRESHOLD */</font></i>
<a name='L555'><font color='darkred'>#ifndef</font> <a href='../D/758.html' title='Multiple defined in 3 places.'>DEFAULT_MMAP_THRESHOLD</a>
<a name='L556'><font color='darkred'>#if</font> <a href='../D/1532.html' title='Multiple defined in 5 places.'>HAVE_MMAP</a>
<a name='L557'><font color='darkred'>#define</font> <a href='../R/706.html' title='Multiple refered from 2 places.'>DEFAULT_MMAP_THRESHOLD</a> ((<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)256U * (<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)1024U)
<a name='L558'><font color='darkred'>#else</font>   <i><font color='green'>/* HAVE_MMAP */</font></i>
<a name='L559'><font color='darkred'>#define</font> <a href='../R/706.html' title='Multiple refered from 2 places.'>DEFAULT_MMAP_THRESHOLD</a> <a href='../S/2317.html#L475' title='Defined at 475 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MAX_SIZE_T</a>
<a name='L560'><font color='darkred'>#endif</font>  <i><font color='green'>/* HAVE_MMAP */</font></i>
<a name='L561'><font color='darkred'>#endif</font>  <i><font color='green'>/* DEFAULT_MMAP_THRESHOLD */</font></i>
<a name='L562'><font color='darkred'>#ifndef</font> <a href='../D/5382.html' title='Multiple defined in 3 places.'>USE_BUILTIN_FFS</a>
<a name='L563'><font color='darkred'>#define</font> <a href='../R/4761.html' title='Multiple refered from 4 places.'>USE_BUILTIN_FFS</a> 0
<a name='L564'><font color='darkred'>#endif</font>  <i><font color='green'>/* USE_BUILTIN_FFS */</font></i>
<a name='L565'><font color='darkred'>#ifndef</font> <a href='../S/2317.html#L566' title='Defined at 566 in Modules/_ctypes/libffi/src/dlmalloc.c.'>USE_DEV_RANDOM</a>
<a name='L566'><font color='darkred'>#define</font> <a href='../R/4764.html' title='Multiple refered from 2 places.'>USE_DEV_RANDOM</a> 0
<a name='L567'><font color='darkred'>#endif</font>  <i><font color='green'>/* USE_DEV_RANDOM */</font></i>
<a name='L568'><font color='darkred'>#ifndef</font> <a href='../D/2331.html' title='Multiple defined in 2 places.'>NO_MALLINFO</a>
<a name='L569'><font color='darkred'>#define</font> <a href='../R/2113.html' title='Multiple refered from 7 places.'>NO_MALLINFO</a> 0
<a name='L570'><font color='darkred'>#endif</font>  <i><font color='green'>/* NO_MALLINFO */</font></i>
<a name='L571'><font color='darkred'>#ifndef</font> <a href='../S/2317.html#L572' title='Defined at 572 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MALLINFO_FIELD_TYPE</a>
<a name='L572'><font color='darkred'>#define</font> <a href='../R/1812.html' title='Multiple refered from 11 places.'>MALLINFO_FIELD_TYPE</a> <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>
<a name='L573'><font color='darkred'>#endif</font>  <i><font color='green'>/* MALLINFO_FIELD_TYPE */</font></i>
<a name='L574'>
<a name='L575'><i><font color='green'>/*</font></i>
<a name='L576'><i><font color='green'>  mallopt tuning options.  SVID/XPG defines four standard parameter</font></i>
<a name='L577'><i><font color='green'>  numbers for mallopt, normally defined in malloc.h.  None of these</font></i>
<a name='L578'><i><font color='green'>  are used in this malloc, so setting them has no effect. But this</font></i>
<a name='L579'><i><font color='green'>  malloc does support the following options.</font></i>
<a name='L580'><i><font color='green'>*/</font></i>
<a name='L581'>
<a name='L582'><font color='darkred'>#define</font> <a href='../S/2317.html#L2532' title='Refered from 2532 in Modules/_ctypes/libffi/src/dlmalloc.c.'>M_TRIM_THRESHOLD</a>     (-1)
<a name='L583'><font color='darkred'>#define</font> <a href='../S/2317.html#L2535' title='Refered from 2535 in Modules/_ctypes/libffi/src/dlmalloc.c.'>M_GRANULARITY</a>        (-2)
<a name='L584'><font color='darkred'>#define</font> <a href='../S/2317.html#L2542' title='Refered from 2542 in Modules/_ctypes/libffi/src/dlmalloc.c.'>M_MMAP_THRESHOLD</a>     (-3)
<a name='L585'>
<a name='L586'><i><font color='green'>/* ------------------------ Mallinfo declarations ------------------------ */</font></i>
<a name='L587'>
<a name='L588'><font color='darkred'>#if</font> !<a href='../D/2331.html' title='Multiple defined in 2 places.'>NO_MALLINFO</a>
<a name='L589'><i><font color='green'>/*</font></i>
<a name='L590'><i><font color='green'>  This version of malloc supports the standard SVID/XPG mallinfo</font></i>
<a name='L591'><i><font color='green'>  routine that returns a struct containing usage properties and</font></i>
<a name='L592'><i><font color='green'>  statistics. It should work on any system that has a</font></i>
<a name='L593'><i><font color='green'>  /usr/include/malloc.h defining struct mallinfo.  The main</font></i>
<a name='L594'><i><font color='green'>  declaration needed is the mallinfo struct that is returned (by-copy)</font></i>
<a name='L595'><i><font color='green'>  by mallinfo().  The malloinfo struct contains a bunch of fields that</font></i>
<a name='L596'><i><font color='green'>  are not even meaningful in this version of malloc.  These fields are</font></i>
<a name='L597'><i><font color='green'>  are instead filled by mallinfo() with other numbers that might be of</font></i>
<a name='L598'><i><font color='green'>  interest.</font></i>
<a name='L599'><i><font color='green'></font></i>
<a name='L600'><i><font color='green'>  HAVE_USR_INCLUDE_MALLOC_H should be set if you have a</font></i>
<a name='L601'><i><font color='green'>  /usr/include/malloc.h file that includes a declaration of struct</font></i>
<a name='L602'><i><font color='green'>  mallinfo.  If so, it is included; else a compliant version is</font></i>
<a name='L603'><i><font color='green'>  declared below.  These must be precisely the same for mallinfo() to</font></i>
<a name='L604'><i><font color='green'>  work.  The original SVID version of this struct, defined on most</font></i>
<a name='L605'><i><font color='green'>  systems with mallinfo, declares all fields as ints. But some others</font></i>
<a name='L606'><i><font color='green'>  define as unsigned long. If your system defines the fields using a</font></i>
<a name='L607'><i><font color='green'>  type of different width than listed here, you MUST #include your</font></i>
<a name='L608'><i><font color='green'>  system version and #define HAVE_USR_INCLUDE_MALLOC_H.</font></i>
<a name='L609'><i><font color='green'>*/</font></i>
<a name='L610'>
<a name='L611'><i><font color='green'>/* #define HAVE_USR_INCLUDE_MALLOC_H */</font></i>
<a name='L612'>
<a name='L613'><font color='darkred'>#ifdef</font> HAVE_USR_INCLUDE_MALLOC_H
<a name='L614'><font color='darkred'>#include</font> "/usr/include/malloc.h"
<a name='L615'><font color='darkred'>#else</font> <i><font color='green'>/* HAVE_USR_INCLUDE_MALLOC_H */</font></i>
<a name='L616'>
<a name='L617'><b>struct</b> <a href='../R/8861.html' title='Multiple refered from 7 places.'>mallinfo</a> <font color='red'>{</font>
<a name='L618'>  <a href='../S/2317.html#L572' title='Defined at 572 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MALLINFO_FIELD_TYPE</a> arena;    <i><font color='green'>/* non-mmapped space allocated from system */</font></i>
<a name='L619'>  <a href='../S/2317.html#L572' title='Defined at 572 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MALLINFO_FIELD_TYPE</a> ordblks;  <i><font color='green'>/* number of free chunks */</font></i>
<a name='L620'>  <a href='../S/2317.html#L572' title='Defined at 572 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MALLINFO_FIELD_TYPE</a> smblks;   <i><font color='green'>/* always 0 */</font></i>
<a name='L621'>  <a href='../S/2317.html#L572' title='Defined at 572 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MALLINFO_FIELD_TYPE</a> hblks;    <i><font color='green'>/* always 0 */</font></i>
<a name='L622'>  <a href='../S/2317.html#L572' title='Defined at 572 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MALLINFO_FIELD_TYPE</a> hblkhd;   <i><font color='green'>/* space in mmapped regions */</font></i>
<a name='L623'>  <a href='../S/2317.html#L572' title='Defined at 572 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MALLINFO_FIELD_TYPE</a> usmblks;  <i><font color='green'>/* maximum total allocated space */</font></i>
<a name='L624'>  <a href='../S/2317.html#L572' title='Defined at 572 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MALLINFO_FIELD_TYPE</a> fsmblks;  <i><font color='green'>/* always 0 */</font></i>
<a name='L625'>  <a href='../S/2317.html#L572' title='Defined at 572 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MALLINFO_FIELD_TYPE</a> uordblks; <i><font color='green'>/* total allocated space */</font></i>
<a name='L626'>  <a href='../S/2317.html#L572' title='Defined at 572 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MALLINFO_FIELD_TYPE</a> fordblks; <i><font color='green'>/* total free space */</font></i>
<a name='L627'>  <a href='../S/2317.html#L572' title='Defined at 572 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MALLINFO_FIELD_TYPE</a> keepcost; <i><font color='green'>/* releasable (via malloc_trim) space */</font></i>
<a name='L628'><font color='red'>}</font>;
<a name='L629'>
<a name='L630'><font color='darkred'>#endif</font> <i><font color='green'>/* HAVE_USR_INCLUDE_MALLOC_H */</font></i>
<a name='L631'><font color='darkred'>#endif</font> <i><font color='green'>/* NO_MALLINFO */</font></i>
<a name='L632'>
<a name='L633'><font color='darkred'>#ifdef</font> __cplusplus
<a name='L634'><b>extern</b> "C" <font color='red'>{</font>
<a name='L635'><font color='darkred'>#endif</font> <i><font color='green'>/* __cplusplus */</font></i>
<a name='L636'>
<a name='L637'><font color='darkred'>#if</font> !<a href='../S/2317.html#L478' title='Defined at 478 in Modules/_ctypes/libffi/src/dlmalloc.c.'>ONLY_MSPACES</a>
<a name='L638'>
<a name='L639'><i><font color='green'>/* ------------------- Declarations of public routines ------------------- */</font></i>
<a name='L640'>
<a name='L641'><font color='darkred'>#ifndef</font> <a href='../S/2312.html#L69' title='Defined at 69 in Modules/_ctypes/libffi/src/closures.c.'>USE_DL_PREFIX</a>
<a name='L642'><font color='darkred'>#define</font> <a href='../R/7396.html' title='Multiple refered from 2 places.'>dlcalloc</a>               calloc
<a name='L643'><font color='darkred'>#define</font> <a href='../R/7399.html' title='Multiple refered from 7 places.'>dlfree</a>                 free
<a name='L644'><font color='darkred'>#define</font> <a href='../R/7403.html' title='Multiple refered from 8 places.'>dlmalloc</a>               malloc
<a name='L645'><font color='darkred'>#define</font> <a href='../R/7410.html' title='Multiple refered from 3 places.'>dlmemalign</a>             memalign
<a name='L646'><font color='darkred'>#define</font> <a href='../S/2317.html#L716' title='Refered from 716 in Modules/_ctypes/libffi/src/dlmalloc.c.'>dlrealloc</a>              realloc
<a name='L647'><font color='darkred'>#define</font> <a href='../S/2317.html#L737' title='Refered from 737 in Modules/_ctypes/libffi/src/dlmalloc.c.'>dlvalloc</a>               valloc
<a name='L648'><font color='darkred'>#define</font> <a href='../S/2317.html#L930' title='Refered from 930 in Modules/_ctypes/libffi/src/dlmalloc.c.'>dlpvalloc</a>              pvalloc
<a name='L649'><font color='darkred'>#define</font> <a href='../S/2317.html#L806' title='Refered from 806 in Modules/_ctypes/libffi/src/dlmalloc.c.'>dlmallinfo</a>             <a href='../S/2317.html#L617' title='Defined at 617 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mallinfo</a>
<a name='L650'><font color='darkred'>#define</font> <a href='../S/2317.html#L757' title='Refered from 757 in Modules/_ctypes/libffi/src/dlmalloc.c.'>dlmallopt</a>              mallopt
<a name='L651'><font color='darkred'>#define</font> <a href='../S/2317.html#L953' title='Refered from 953 in Modules/_ctypes/libffi/src/dlmalloc.c.'>dlmalloc_trim</a>          malloc_trim
<a name='L652'><font color='darkred'>#define</font> <a href='../S/2317.html#L990' title='Refered from 990 in Modules/_ctypes/libffi/src/dlmalloc.c.'>dlmalloc_stats</a>         malloc_stats
<a name='L653'><font color='darkred'>#define</font> <a href='../S/2317.html#L969' title='Refered from 969 in Modules/_ctypes/libffi/src/dlmalloc.c.'>dlmalloc_usable_size</a>   malloc_usable_size
<a name='L654'><font color='darkred'>#define</font> <a href='../S/2317.html#L768' title='Refered from 768 in Modules/_ctypes/libffi/src/dlmalloc.c.'>dlmalloc_footprint</a>     malloc_footprint
<a name='L655'><font color='darkred'>#define</font> <a href='../S/2317.html#L781' title='Refered from 781 in Modules/_ctypes/libffi/src/dlmalloc.c.'>dlmalloc_max_footprint</a> malloc_max_footprint
<a name='L656'><font color='darkred'>#define</font> <a href='../S/2317.html#L861' title='Refered from 861 in Modules/_ctypes/libffi/src/dlmalloc.c.'>dlindependent_calloc</a>   independent_calloc
<a name='L657'><font color='darkred'>#define</font> <a href='../S/2317.html#L922' title='Refered from 922 in Modules/_ctypes/libffi/src/dlmalloc.c.'>dlindependent_comalloc</a> independent_comalloc
<a name='L658'><font color='darkred'>#endif</font> <i><font color='green'>/* USE_DL_PREFIX */</font></i>
<a name='L659'>
<a name='L660'>
<a name='L661'><i><font color='green'>/*</font></i>
<a name='L662'><i><font color='green'>  malloc(size_t n)</font></i>
<a name='L663'><i><font color='green'>  Returns a pointer to a newly allocated chunk of at least n bytes, or</font></i>
<a name='L664'><i><font color='green'>  null if no space is available, in which case errno is set to ENOMEM</font></i>
<a name='L665'><i><font color='green'>  on ANSI C systems.</font></i>
<a name='L666'><i><font color='green'></font></i>
<a name='L667'><i><font color='green'>  If n is zero, malloc returns a minimum-sized chunk. (The minimum</font></i>
<a name='L668'><i><font color='green'>  size is 16 bytes on most 32bit systems, and 32 bytes on 64bit</font></i>
<a name='L669'><i><font color='green'>  systems.)  Note that size_t is an unsigned type, so calls with</font></i>
<a name='L670'><i><font color='green'>  arguments that would be negative if signed are interpreted as</font></i>
<a name='L671'><i><font color='green'>  requests for huge amounts of space, which will often fail. The</font></i>
<a name='L672'><i><font color='green'>  maximum supported value of n differs across systems, but is in all</font></i>
<a name='L673'><i><font color='green'>  cases less than the maximum representable value of a size_t.</font></i>
<a name='L674'><i><font color='green'>*/</font></i>
<a name='L675'><b>void</b>* <a href='../D/8185.html' title='Multiple defined in 2 places.'>dlmalloc</a>(<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>);
<a name='L676'>
<a name='L677'><i><font color='green'>/*</font></i>
<a name='L678'><i><font color='green'>  free(void* p)</font></i>
<a name='L679'><i><font color='green'>  Releases the chunk of memory pointed to by p, that had been previously</font></i>
<a name='L680'><i><font color='green'>  allocated using malloc or a related routine such as realloc.</font></i>
<a name='L681'><i><font color='green'>  It has no effect if p is null. If p was not malloced or already</font></i>
<a name='L682'><i><font color='green'>  freed, free(p) will by default cause the current program to abort.</font></i>
<a name='L683'><i><font color='green'>*/</font></i>
<a name='L684'><b>void</b>  <a href='../D/8181.html' title='Multiple defined in 2 places.'>dlfree</a>(<b>void</b>*);
<a name='L685'>
<a name='L686'><i><font color='green'>/*</font></i>
<a name='L687'><i><font color='green'>  calloc(size_t n_elements, size_t element_size);</font></i>
<a name='L688'><i><font color='green'>  Returns a pointer to n_elements * element_size bytes, with all locations</font></i>
<a name='L689'><i><font color='green'>  set to zero.</font></i>
<a name='L690'><i><font color='green'>*/</font></i>
<a name='L691'><b>void</b>* <a href='../D/8178.html' title='Multiple defined in 2 places.'>dlcalloc</a>(<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>);
<a name='L692'>
<a name='L693'><i><font color='green'>/*</font></i>
<a name='L694'><i><font color='green'>  realloc(void* p, size_t n)</font></i>
<a name='L695'><i><font color='green'>  Returns a pointer to a chunk of size n that contains the same data</font></i>
<a name='L696'><i><font color='green'>  as does chunk p up to the minimum of (n, p's size) bytes, or null</font></i>
<a name='L697'><i><font color='green'>  if no space is available.</font></i>
<a name='L698'><i><font color='green'></font></i>
<a name='L699'><i><font color='green'>  The returned pointer may or may not be the same as p. The algorithm</font></i>
<a name='L700'><i><font color='green'>  prefers extending p in most cases when possible, otherwise it</font></i>
<a name='L701'><i><font color='green'>  employs the equivalent of a malloc-copy-free sequence.</font></i>
<a name='L702'><i><font color='green'></font></i>
<a name='L703'><i><font color='green'>  If p is null, realloc is equivalent to malloc.</font></i>
<a name='L704'><i><font color='green'></font></i>
<a name='L705'><i><font color='green'>  If space is not available, realloc returns null, errno is set (if on</font></i>
<a name='L706'><i><font color='green'>  ANSI) and p is NOT freed.</font></i>
<a name='L707'><i><font color='green'></font></i>
<a name='L708'><i><font color='green'>  if n is for fewer bytes than already held by p, the newly unused</font></i>
<a name='L709'><i><font color='green'>  space is lopped off and freed if possible.  realloc with a size</font></i>
<a name='L710'><i><font color='green'>  argument of zero (re)allocates a minimum-sized chunk.</font></i>
<a name='L711'><i><font color='green'></font></i>
<a name='L712'><i><font color='green'>  The old unix realloc convention of allowing the last-free'd chunk</font></i>
<a name='L713'><i><font color='green'>  to be used as an argument to realloc is not supported.</font></i>
<a name='L714'><i><font color='green'>*/</font></i>
<a name='L715'>
<a name='L716'><b>void</b>* <a href='../D/8198.html' title='Multiple defined in 2 places.'>dlrealloc</a>(<b>void</b>*, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>);
<a name='L717'>
<a name='L718'><i><font color='green'>/*</font></i>
<a name='L719'><i><font color='green'>  memalign(size_t alignment, size_t n);</font></i>
<a name='L720'><i><font color='green'>  Returns a pointer to a newly allocated chunk of n bytes, aligned</font></i>
<a name='L721'><i><font color='green'>  in accord with the alignment argument.</font></i>
<a name='L722'><i><font color='green'></font></i>
<a name='L723'><i><font color='green'>  The alignment argument should be a power of two. If the argument is</font></i>
<a name='L724'><i><font color='green'>  not a power of two, the nearest greater power is used.</font></i>
<a name='L725'><i><font color='green'>  8-byte alignment is guaranteed by normal malloc calls, so don't</font></i>
<a name='L726'><i><font color='green'>  bother calling memalign with an argument of 8 or less.</font></i>
<a name='L727'><i><font color='green'></font></i>
<a name='L728'><i><font color='green'>  Overreliance on memalign is a sure way to fragment space.</font></i>
<a name='L729'><i><font color='green'>*/</font></i>
<a name='L730'><b>void</b>* <a href='../D/8192.html' title='Multiple defined in 2 places.'>dlmemalign</a>(<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>);
<a name='L731'>
<a name='L732'><i><font color='green'>/*</font></i>
<a name='L733'><i><font color='green'>  valloc(size_t n);</font></i>
<a name='L734'><i><font color='green'>  Equivalent to memalign(pagesize, n), where pagesize is the page</font></i>
<a name='L735'><i><font color='green'>  size of the system. If the pagesize is unknown, 4096 is used.</font></i>
<a name='L736'><i><font color='green'>*/</font></i>
<a name='L737'><b>void</b>* <a href='../D/8201.html' title='Multiple defined in 2 places.'>dlvalloc</a>(<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>);
<a name='L738'>
<a name='L739'><i><font color='green'>/*</font></i>
<a name='L740'><i><font color='green'>  mallopt(int parameter_number, int parameter_value)</font></i>
<a name='L741'><i><font color='green'>  Sets tunable parameters The format is to provide a</font></i>
<a name='L742'><i><font color='green'>  (parameter-number, parameter-value) pair.  mallopt then sets the</font></i>
<a name='L743'><i><font color='green'>  corresponding parameter to the argument value if it can (i.e., so</font></i>
<a name='L744'><i><font color='green'>  long as the value is meaningful), and returns 1 if successful else</font></i>
<a name='L745'><i><font color='green'>  0.  SVID/XPG/ANSI defines four standard param numbers for mallopt,</font></i>
<a name='L746'><i><font color='green'>  normally defined in malloc.h.  None of these are use in this malloc,</font></i>
<a name='L747'><i><font color='green'>  so setting them has no effect. But this malloc also supports other</font></i>
<a name='L748'><i><font color='green'>  options in mallopt. See below for details.  Briefly, supported</font></i>
<a name='L749'><i><font color='green'>  parameters are as follows (listed defaults are for "typical"</font></i>
<a name='L750'><i><font color='green'>  configurations).</font></i>
<a name='L751'><i><font color='green'></font></i>
<a name='L752'><i><font color='green'>  Symbol            param #  default    allowed param values</font></i>
<a name='L753'><i><font color='green'>  M_TRIM_THRESHOLD     -1   2*1024*1024   any   (MAX_SIZE_T disables)</font></i>
<a name='L754'><i><font color='green'>  M_GRANULARITY        -2     page size   any power of 2 &gt;= page size</font></i>
<a name='L755'><i><font color='green'>  M_MMAP_THRESHOLD     -3      256*1024   any   (or 0 if no MMAP support)</font></i>
<a name='L756'><i><font color='green'>*/</font></i>
<a name='L757'><b>int</b> <a href='../D/8191.html' title='Multiple defined in 2 places.'>dlmallopt</a>(<b>int</b>, <b>int</b>);
<a name='L758'>
<a name='L759'><i><font color='green'>/*</font></i>
<a name='L760'><i><font color='green'>  malloc_footprint();</font></i>
<a name='L761'><i><font color='green'>  Returns the number of bytes obtained from the system.  The total</font></i>
<a name='L762'><i><font color='green'>  number of bytes allocated by malloc, realloc etc., is less than this</font></i>
<a name='L763'><i><font color='green'>  value. Unlike mallinfo, this function returns only a precomputed</font></i>
<a name='L764'><i><font color='green'>  result, so can be called frequently to monitor memory consumption.</font></i>
<a name='L765'><i><font color='green'>  Even if locks are otherwise defined, this function does not use them,</font></i>
<a name='L766'><i><font color='green'>  so results might not be up to date.</font></i>
<a name='L767'><i><font color='green'>*/</font></i>
<a name='L768'><a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> <a href='../D/8186.html' title='Multiple defined in 2 places.'>dlmalloc_footprint</a>(<b>void</b>);
<a name='L769'>
<a name='L770'><i><font color='green'>/*</font></i>
<a name='L771'><i><font color='green'>  malloc_max_footprint();</font></i>
<a name='L772'><i><font color='green'>  Returns the maximum number of bytes obtained from the system. This</font></i>
<a name='L773'><i><font color='green'>  value will be greater than current footprint if deallocated space</font></i>
<a name='L774'><i><font color='green'>  has been reclaimed by the system. The peak number of bytes allocated</font></i>
<a name='L775'><i><font color='green'>  by malloc, realloc etc., is less than this value. Unlike mallinfo,</font></i>
<a name='L776'><i><font color='green'>  this function returns only a precomputed result, so can be called</font></i>
<a name='L777'><i><font color='green'>  frequently to monitor memory consumption.  Even if locks are</font></i>
<a name='L778'><i><font color='green'>  otherwise defined, this function does not use them, so results might</font></i>
<a name='L779'><i><font color='green'>  not be up to date.</font></i>
<a name='L780'><i><font color='green'>*/</font></i>
<a name='L781'><a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> <a href='../D/8187.html' title='Multiple defined in 2 places.'>dlmalloc_max_footprint</a>(<b>void</b>);
<a name='L782'>
<a name='L783'><font color='darkred'>#if</font> !<a href='../D/2331.html' title='Multiple defined in 2 places.'>NO_MALLINFO</a>
<a name='L784'><i><font color='green'>/*</font></i>
<a name='L785'><i><font color='green'>  mallinfo()</font></i>
<a name='L786'><i><font color='green'>  Returns (by copy) a struct containing various summary statistics:</font></i>
<a name='L787'><i><font color='green'></font></i>
<a name='L788'><i><font color='green'>  arena:     current total non-mmapped bytes allocated from system</font></i>
<a name='L789'><i><font color='green'>  ordblks:   the number of free chunks</font></i>
<a name='L790'><i><font color='green'>  smblks:    always zero.</font></i>
<a name='L791'><i><font color='green'>  hblks:     current number of mmapped regions</font></i>
<a name='L792'><i><font color='green'>  hblkhd:    total bytes held in mmapped regions</font></i>
<a name='L793'><i><font color='green'>  usmblks:   the maximum total allocated space. This will be greater</font></i>
<a name='L794'><i><font color='green'>                than current total if trimming has occurred.</font></i>
<a name='L795'><i><font color='green'>  fsmblks:   always zero</font></i>
<a name='L796'><i><font color='green'>  uordblks:  current total allocated space (normal or mmapped)</font></i>
<a name='L797'><i><font color='green'>  fordblks:  total free space</font></i>
<a name='L798'><i><font color='green'>  keepcost:  the maximum number of bytes that could ideally be released</font></i>
<a name='L799'><i><font color='green'>               back to system via malloc_trim. ("ideally" means that</font></i>
<a name='L800'><i><font color='green'>               it ignores page restrictions etc.)</font></i>
<a name='L801'><i><font color='green'></font></i>
<a name='L802'><i><font color='green'>  Because these fields are ints, but internal bookkeeping may</font></i>
<a name='L803'><i><font color='green'>  be kept as longs, the reported values may wrap around zero and</font></i>
<a name='L804'><i><font color='green'>  thus be inaccurate.</font></i>
<a name='L805'><i><font color='green'>*/</font></i>
<a name='L806'><b>struct</b> <a href='../S/2317.html#L617' title='Defined at 617 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mallinfo</a> <a href='../D/8184.html' title='Multiple defined in 2 places.'>dlmallinfo</a>(<b>void</b>);
<a name='L807'><font color='darkred'>#endif</font> <i><font color='green'>/* NO_MALLINFO */</font></i>
<a name='L808'>
<a name='L809'><i><font color='green'>/*</font></i>
<a name='L810'><i><font color='green'>  independent_calloc(size_t n_elements, size_t element_size, void* chunks[]);</font></i>
<a name='L811'><i><font color='green'></font></i>
<a name='L812'><i><font color='green'>  independent_calloc is similar to calloc, but instead of returning a</font></i>
<a name='L813'><i><font color='green'>  single cleared space, it returns an array of pointers to n_elements</font></i>
<a name='L814'><i><font color='green'>  independent elements that can hold contents of size elem_size, each</font></i>
<a name='L815'><i><font color='green'>  of which starts out cleared, and can be independently freed,</font></i>
<a name='L816'><i><font color='green'>  realloc'ed etc. The elements are guaranteed to be adjacently</font></i>
<a name='L817'><i><font color='green'>  allocated (this is not guaranteed to occur with multiple callocs or</font></i>
<a name='L818'><i><font color='green'>  mallocs), which may also improve cache locality in some</font></i>
<a name='L819'><i><font color='green'>  applications.</font></i>
<a name='L820'><i><font color='green'></font></i>
<a name='L821'><i><font color='green'>  The "chunks" argument is optional (i.e., may be null, which is</font></i>
<a name='L822'><i><font color='green'>  probably the most typical usage). If it is null, the returned array</font></i>
<a name='L823'><i><font color='green'>  is itself dynamically allocated and should also be freed when it is</font></i>
<a name='L824'><i><font color='green'>  no longer needed. Otherwise, the chunks array must be of at least</font></i>
<a name='L825'><i><font color='green'>  n_elements in length. It is filled in with the pointers to the</font></i>
<a name='L826'><i><font color='green'>  chunks.</font></i>
<a name='L827'><i><font color='green'></font></i>
<a name='L828'><i><font color='green'>  In either case, independent_calloc returns this pointer array, or</font></i>
<a name='L829'><i><font color='green'>  null if the allocation failed.  If n_elements is zero and "chunks"</font></i>
<a name='L830'><i><font color='green'>  is null, it returns a chunk representing an array with zero elements</font></i>
<a name='L831'><i><font color='green'>  (which should be freed if not wanted).</font></i>
<a name='L832'><i><font color='green'></font></i>
<a name='L833'><i><font color='green'>  Each element must be individually freed when it is no longer</font></i>
<a name='L834'><i><font color='green'>  needed. If you'd like to instead be able to free all at once, you</font></i>
<a name='L835'><i><font color='green'>  should instead use regular calloc and assign pointers into this</font></i>
<a name='L836'><i><font color='green'>  space to represent elements.  (In this case though, you cannot</font></i>
<a name='L837'><i><font color='green'>  independently free elements.)</font></i>
<a name='L838'><i><font color='green'></font></i>
<a name='L839'><i><font color='green'>  independent_calloc simplifies and speeds up implementations of many</font></i>
<a name='L840'><i><font color='green'>  kinds of pools.  It may also be useful when constructing large data</font></i>
<a name='L841'><i><font color='green'>  structures that initially have a fixed number of fixed-sized nodes,</font></i>
<a name='L842'><i><font color='green'>  but the number is not known at compile time, and some of the nodes</font></i>
<a name='L843'><i><font color='green'>  may later need to be freed. For example:</font></i>
<a name='L844'><i><font color='green'></font></i>
<a name='L845'><i><font color='green'>  struct Node { int item; struct Node* next; };</font></i>
<a name='L846'><i><font color='green'></font></i>
<a name='L847'><i><font color='green'>  struct Node* build_list() {</font></i>
<a name='L848'><i><font color='green'>    struct Node** pool;</font></i>
<a name='L849'><i><font color='green'>    int n = read_number_of_nodes_needed();</font></i>
<a name='L850'><i><font color='green'>    if (n &lt;= 0) return 0;</font></i>
<a name='L851'><i><font color='green'>    pool = (struct Node**)(independent_calloc(n, sizeof(struct Node), 0);</font></i>
<a name='L852'><i><font color='green'>    if (pool == 0) die();</font></i>
<a name='L853'><i><font color='green'>    // organize into a linked list...</font></i>
<a name='L854'><i><font color='green'>    struct Node* first = pool[0];</font></i>
<a name='L855'><i><font color='green'>    for (i = 0; i &lt; n-1; ++i)</font></i>
<a name='L856'><i><font color='green'>      pool[i]-&gt;next = pool[i+1];</font></i>
<a name='L857'><i><font color='green'>    free(pool);     // Can now free the array (or not, if it is needed later)</font></i>
<a name='L858'><i><font color='green'>    return first;</font></i>
<a name='L859'><i><font color='green'>  }</font></i>
<a name='L860'><i><font color='green'>*/</font></i>
<a name='L861'><b>void</b>** <a href='../D/8182.html' title='Multiple defined in 2 places.'>dlindependent_calloc</a>(<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>, <b>void</b>**);
<a name='L862'>
<a name='L863'><i><font color='green'>/*</font></i>
<a name='L864'><i><font color='green'>  independent_comalloc(size_t n_elements, size_t sizes[], void* chunks[]);</font></i>
<a name='L865'><i><font color='green'></font></i>
<a name='L866'><i><font color='green'>  independent_comalloc allocates, all at once, a set of n_elements</font></i>
<a name='L867'><i><font color='green'>  chunks with sizes indicated in the "sizes" array.    It returns</font></i>
<a name='L868'><i><font color='green'>  an array of pointers to these elements, each of which can be</font></i>
<a name='L869'><i><font color='green'>  independently freed, realloc'ed etc. The elements are guaranteed to</font></i>
<a name='L870'><i><font color='green'>  be adjacently allocated (this is not guaranteed to occur with</font></i>
<a name='L871'><i><font color='green'>  multiple callocs or mallocs), which may also improve cache locality</font></i>
<a name='L872'><i><font color='green'>  in some applications.</font></i>
<a name='L873'><i><font color='green'></font></i>
<a name='L874'><i><font color='green'>  The "chunks" argument is optional (i.e., may be null). If it is null</font></i>
<a name='L875'><i><font color='green'>  the returned array is itself dynamically allocated and should also</font></i>
<a name='L876'><i><font color='green'>  be freed when it is no longer needed. Otherwise, the chunks array</font></i>
<a name='L877'><i><font color='green'>  must be of at least n_elements in length. It is filled in with the</font></i>
<a name='L878'><i><font color='green'>  pointers to the chunks.</font></i>
<a name='L879'><i><font color='green'></font></i>
<a name='L880'><i><font color='green'>  In either case, independent_comalloc returns this pointer array, or</font></i>
<a name='L881'><i><font color='green'>  null if the allocation failed.  If n_elements is zero and chunks is</font></i>
<a name='L882'><i><font color='green'>  null, it returns a chunk representing an array with zero elements</font></i>
<a name='L883'><i><font color='green'>  (which should be freed if not wanted).</font></i>
<a name='L884'><i><font color='green'></font></i>
<a name='L885'><i><font color='green'>  Each element must be individually freed when it is no longer</font></i>
<a name='L886'><i><font color='green'>  needed. If you'd like to instead be able to free all at once, you</font></i>
<a name='L887'><i><font color='green'>  should instead use a single regular malloc, and assign pointers at</font></i>
<a name='L888'><i><font color='green'>  particular offsets in the aggregate space. (In this case though, you</font></i>
<a name='L889'><i><font color='green'>  cannot independently free elements.)</font></i>
<a name='L890'><i><font color='green'></font></i>
<a name='L891'><i><font color='green'>  independent_comallac differs from independent_calloc in that each</font></i>
<a name='L892'><i><font color='green'>  element may have a different size, and also that it does not</font></i>
<a name='L893'><i><font color='green'>  automatically clear elements.</font></i>
<a name='L894'><i><font color='green'></font></i>
<a name='L895'><i><font color='green'>  independent_comalloc can be used to speed up allocation in cases</font></i>
<a name='L896'><i><font color='green'>  where several structs or objects must always be allocated at the</font></i>
<a name='L897'><i><font color='green'>  same time.  For example:</font></i>
<a name='L898'><i><font color='green'></font></i>
<a name='L899'><i><font color='green'>  struct Head { ... }</font></i>
<a name='L900'><i><font color='green'>  struct Foot { ... }</font></i>
<a name='L901'><i><font color='green'></font></i>
<a name='L902'><i><font color='green'>  void send_message(char* msg) {</font></i>
<a name='L903'><i><font color='green'>    int msglen = strlen(msg);</font></i>
<a name='L904'><i><font color='green'>    size_t sizes[3] = { sizeof(struct Head), msglen, sizeof(struct Foot) };</font></i>
<a name='L905'><i><font color='green'>    void* chunks[3];</font></i>
<a name='L906'><i><font color='green'>    if (independent_comalloc(3, sizes, chunks) == 0)</font></i>
<a name='L907'><i><font color='green'>      die();</font></i>
<a name='L908'><i><font color='green'>    struct Head* head = (struct Head*)(chunks[0]);</font></i>
<a name='L909'><i><font color='green'>    char*        body = (char*)(chunks[1]);</font></i>
<a name='L910'><i><font color='green'>    struct Foot* foot = (struct Foot*)(chunks[2]);</font></i>
<a name='L911'><i><font color='green'>    // ...</font></i>
<a name='L912'><i><font color='green'>  }</font></i>
<a name='L913'><i><font color='green'></font></i>
<a name='L914'><i><font color='green'>  In general though, independent_comalloc is worth using only for</font></i>
<a name='L915'><i><font color='green'>  larger values of n_elements. For small values, you probably won't</font></i>
<a name='L916'><i><font color='green'>  detect enough difference from series of malloc calls to bother.</font></i>
<a name='L917'><i><font color='green'></font></i>
<a name='L918'><i><font color='green'>  Overuse of independent_comalloc can increase overall memory usage,</font></i>
<a name='L919'><i><font color='green'>  since it cannot reuse existing noncontiguous small chunks that</font></i>
<a name='L920'><i><font color='green'>  might be available for some of the elements.</font></i>
<a name='L921'><i><font color='green'>*/</font></i>
<a name='L922'><b>void</b>** <a href='../D/8183.html' title='Multiple defined in 2 places.'>dlindependent_comalloc</a>(<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>*, <b>void</b>**);
<a name='L923'>
<a name='L924'>
<a name='L925'><i><font color='green'>/*</font></i>
<a name='L926'><i><font color='green'>  pvalloc(size_t n);</font></i>
<a name='L927'><i><font color='green'>  Equivalent to valloc(minimum-page-that-holds(n)), that is,</font></i>
<a name='L928'><i><font color='green'>  round up n to nearest pagesize.</font></i>
<a name='L929'><i><font color='green'> */</font></i>
<a name='L930'><b>void</b>*  <a href='../D/8197.html' title='Multiple defined in 2 places.'>dlpvalloc</a>(<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>);
<a name='L931'>
<a name='L932'><i><font color='green'>/*</font></i>
<a name='L933'><i><font color='green'>  malloc_trim(size_t pad);</font></i>
<a name='L934'><i><font color='green'></font></i>
<a name='L935'><i><font color='green'>  If possible, gives memory back to the system (via negative arguments</font></i>
<a name='L936'><i><font color='green'>  to sbrk) if there is unused memory at the `high' end of the malloc</font></i>
<a name='L937'><i><font color='green'>  pool or in unused MMAP segments. You can call this after freeing</font></i>
<a name='L938'><i><font color='green'>  large blocks of memory to potentially reduce the system-level memory</font></i>
<a name='L939'><i><font color='green'>  requirements of a program. However, it cannot guarantee to reduce</font></i>
<a name='L940'><i><font color='green'>  memory. Under some allocation patterns, some large free blocks of</font></i>
<a name='L941'><i><font color='green'>  memory will be locked between two used chunks, so they cannot be</font></i>
<a name='L942'><i><font color='green'>  given back to the system.</font></i>
<a name='L943'><i><font color='green'></font></i>
<a name='L944'><i><font color='green'>  The `pad' argument to malloc_trim represents the amount of free</font></i>
<a name='L945'><i><font color='green'>  trailing space to leave untrimmed. If this argument is zero, only</font></i>
<a name='L946'><i><font color='green'>  the minimum amount of memory to maintain internal data structures</font></i>
<a name='L947'><i><font color='green'>  will be left. Non-zero arguments can be supplied to maintain enough</font></i>
<a name='L948'><i><font color='green'>  trailing space to service future expected allocations without having</font></i>
<a name='L949'><i><font color='green'>  to re-obtain memory from the system.</font></i>
<a name='L950'><i><font color='green'></font></i>
<a name='L951'><i><font color='green'>  Malloc_trim returns 1 if it actually released any memory, else 0.</font></i>
<a name='L952'><i><font color='green'>*/</font></i>
<a name='L953'><b>int</b>  <a href='../D/8189.html' title='Multiple defined in 2 places.'>dlmalloc_trim</a>(<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>);
<a name='L954'>
<a name='L955'><i><font color='green'>/*</font></i>
<a name='L956'><i><font color='green'>  malloc_usable_size(void* p);</font></i>
<a name='L957'><i><font color='green'></font></i>
<a name='L958'><i><font color='green'>  Returns the number of bytes you can actually use in</font></i>
<a name='L959'><i><font color='green'>  an allocated chunk, which may be more than you requested (although</font></i>
<a name='L960'><i><font color='green'>  often not) due to alignment and minimum size constraints.</font></i>
<a name='L961'><i><font color='green'>  You can use this many bytes without worrying about</font></i>
<a name='L962'><i><font color='green'>  overwriting other allocated objects. This is not a particularly great</font></i>
<a name='L963'><i><font color='green'>  programming practice. malloc_usable_size can be more useful in</font></i>
<a name='L964'><i><font color='green'>  debugging and assertions, for example:</font></i>
<a name='L965'><i><font color='green'></font></i>
<a name='L966'><i><font color='green'>  p = malloc(n);</font></i>
<a name='L967'><i><font color='green'>  assert(malloc_usable_size(p) &gt;= 256);</font></i>
<a name='L968'><i><font color='green'>*/</font></i>
<a name='L969'><a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> <a href='../D/8190.html' title='Multiple defined in 2 places.'>dlmalloc_usable_size</a>(<b>void</b>*);
<a name='L970'>
<a name='L971'><i><font color='green'>/*</font></i>
<a name='L972'><i><font color='green'>  malloc_stats();</font></i>
<a name='L973'><i><font color='green'>  Prints on stderr the amount of space obtained from the system (both</font></i>
<a name='L974'><i><font color='green'>  via sbrk and mmap), the maximum amount (which may be more than</font></i>
<a name='L975'><i><font color='green'>  current if malloc_trim and/or munmap got called), and the current</font></i>
<a name='L976'><i><font color='green'>  number of bytes allocated via malloc (or realloc, etc) but not yet</font></i>
<a name='L977'><i><font color='green'>  freed. Note that this is the number of bytes allocated, not the</font></i>
<a name='L978'><i><font color='green'>  number requested. It will be larger than the number requested</font></i>
<a name='L979'><i><font color='green'>  because of alignment and bookkeeping overhead. Because it includes</font></i>
<a name='L980'><i><font color='green'>  alignment wastage as being in use, this figure may be greater than</font></i>
<a name='L981'><i><font color='green'>  zero even when no user-level chunks are allocated.</font></i>
<a name='L982'><i><font color='green'></font></i>
<a name='L983'><i><font color='green'>  The reported current and maximum system memory can be inaccurate if</font></i>
<a name='L984'><i><font color='green'>  a program makes other calls to system memory allocation functions</font></i>
<a name='L985'><i><font color='green'>  (normally sbrk) outside of malloc.</font></i>
<a name='L986'><i><font color='green'></font></i>
<a name='L987'><i><font color='green'>  malloc_stats prints only the most commonly interesting statistics.</font></i>
<a name='L988'><i><font color='green'>  More information can be obtained by calling mallinfo.</font></i>
<a name='L989'><i><font color='green'>*/</font></i>
<a name='L990'><b>void</b>  <a href='../D/8188.html' title='Multiple defined in 2 places.'>dlmalloc_stats</a>(<b>void</b>);
<a name='L991'>
<a name='L992'><font color='darkred'>#endif</font> <i><font color='green'>/* ONLY_MSPACES */</font></i>
<a name='L993'>
<a name='L994'><font color='darkred'>#if</font> <a href='../D/2179.html' title='Multiple defined in 2 places.'>MSPACES</a>
<a name='L995'>
<a name='L996'><i><font color='green'>/*</font></i>
<a name='L997'><i><font color='green'>  mspace is an opaque type representing an independent</font></i>
<a name='L998'><i><font color='green'>  region of space that supports mspace_malloc, etc.</font></i>
<a name='L999'><i><font color='green'>*/</font></i>
<a name='L1000'><b>typedef</b> <b>void</b>* <a href='../R/9119.html' title='Multiple refered from 6 places.'>mspace</a>;
<a name='L1001'>
<a name='L1002'><i><font color='green'>/*</font></i>
<a name='L1003'><i><font color='green'>  create_mspace creates and returns a new independent space with the</font></i>
<a name='L1004'><i><font color='green'>  given initial capacity, or, if 0, the default granularity size.  It</font></i>
<a name='L1005'><i><font color='green'>  returns null if there is no system memory available to create the</font></i>
<a name='L1006'><i><font color='green'>  space.  If argument locked is non-zero, the space uses a separate</font></i>
<a name='L1007'><i><font color='green'>  lock to control access. The capacity of the space will grow</font></i>
<a name='L1008'><i><font color='green'>  dynamically as needed to service mspace_malloc requests.  You can</font></i>
<a name='L1009'><i><font color='green'>  control the sizes of incremental increases of this space by</font></i>
<a name='L1010'><i><font color='green'>  compiling with a different DEFAULT_GRANULARITY or dynamically</font></i>
<a name='L1011'><i><font color='green'>  setting with mallopt(M_GRANULARITY, value).</font></i>
<a name='L1012'><i><font color='green'>*/</font></i>
<a name='L1013'><a href='../S/2317.html#L1000' title='Defined at 1000 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace</a> <a href='../S/2317.html#L4426' title='Defined at 4426 in Modules/_ctypes/libffi/src/dlmalloc.c.'>create_mspace</a>(<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> capacity, <b>int</b> locked);
<a name='L1014'>
<a name='L1015'><i><font color='green'>/*</font></i>
<a name='L1016'><i><font color='green'>  destroy_mspace destroys the given space, and attempts to return all</font></i>
<a name='L1017'><i><font color='green'>  of its memory back to the system, returning the total number of</font></i>
<a name='L1018'><i><font color='green'>  bytes freed. After destruction, the results of access to all memory</font></i>
<a name='L1019'><i><font color='green'>  used by the space become undefined.</font></i>
<a name='L1020'><i><font color='green'>*/</font></i>
<a name='L1021'><a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> <a href='../S/2317.html#L4459' title='Defined at 4459 in Modules/_ctypes/libffi/src/dlmalloc.c.'>destroy_mspace</a>(mspace msp);
<a name='L1022'>
<a name='L1023'><i><font color='green'>/*</font></i>
<a name='L1024'><i><font color='green'>  create_mspace_with_base uses the memory supplied as the initial base</font></i>
<a name='L1025'><i><font color='green'>  of a new mspace. Part (less than 128*sizeof(size_t) bytes) of this</font></i>
<a name='L1026'><i><font color='green'>  space is used for bookkeeping, so the capacity must be at least this</font></i>
<a name='L1027'><i><font color='green'>  large. (Otherwise 0 is returned.) When this initial space is</font></i>
<a name='L1028'><i><font color='green'>  exhausted, additional memory will be obtained from the system.</font></i>
<a name='L1029'><i><font color='green'>  Destroying this space will deallocate all additionally allocated</font></i>
<a name='L1030'><i><font color='green'>  space (if possible) but not the initial base.</font></i>
<a name='L1031'><i><font color='green'>*/</font></i>
<a name='L1032'><a href='../S/2317.html#L1000' title='Defined at 1000 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace</a> <a href='../S/2317.html#L4445' title='Defined at 4445 in Modules/_ctypes/libffi/src/dlmalloc.c.'>create_mspace_with_base</a>(<b>void</b>* base, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> capacity, <b>int</b> locked);
<a name='L1033'>
<a name='L1034'><i><font color='green'>/*</font></i>
<a name='L1035'><i><font color='green'>  mspace_malloc behaves as malloc, but operates within</font></i>
<a name='L1036'><i><font color='green'>  the given space.</font></i>
<a name='L1037'><i><font color='green'>*/</font></i>
<a name='L1038'><b>void</b>* <a href='../S/2317.html#L4486' title='Defined at 4486 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace_malloc</a>(mspace msp, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> bytes);
<a name='L1039'>
<a name='L1040'><i><font color='green'>/*</font></i>
<a name='L1041'><i><font color='green'>  mspace_free behaves as free, but operates within</font></i>
<a name='L1042'><i><font color='green'>  the given space.</font></i>
<a name='L1043'><i><font color='green'></font></i>
<a name='L1044'><i><font color='green'>  If compiled with FOOTERS==1, mspace_free is not actually needed.</font></i>
<a name='L1045'><i><font color='green'>  free may be called instead of mspace_free because freed chunks from</font></i>
<a name='L1046'><i><font color='green'>  any space are handled by their originating spaces.</font></i>
<a name='L1047'><i><font color='green'>*/</font></i>
<a name='L1048'><b>void</b> <a href='../S/2317.html#L4600' title='Defined at 4600 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace_free</a>(mspace msp, <b>void</b>* mem);
<a name='L1049'>
<a name='L1050'><i><font color='green'>/*</font></i>
<a name='L1051'><i><font color='green'>  mspace_realloc behaves as realloc, but operates within</font></i>
<a name='L1052'><i><font color='green'>  the given space.</font></i>
<a name='L1053'><i><font color='green'></font></i>
<a name='L1054'><i><font color='green'>  If compiled with FOOTERS==1, mspace_realloc is not actually</font></i>
<a name='L1055'><i><font color='green'>  needed.  realloc may be called instead of mspace_realloc because</font></i>
<a name='L1056'><i><font color='green'>  realloced chunks from any space are handled by their originating</font></i>
<a name='L1057'><i><font color='green'>  spaces.</font></i>
<a name='L1058'><i><font color='green'>*/</font></i>
<a name='L1059'><b>void</b>* <a href='../S/2317.html#L4711' title='Defined at 4711 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace_realloc</a>(mspace msp, <b>void</b>* mem, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> newsize);
<a name='L1060'>
<a name='L1061'><i><font color='green'>/*</font></i>
<a name='L1062'><i><font color='green'>  mspace_calloc behaves as calloc, but operates within</font></i>
<a name='L1063'><i><font color='green'>  the given space.</font></i>
<a name='L1064'><i><font color='green'>*/</font></i>
<a name='L1065'><b>void</b>* <a href='../S/2317.html#L4691' title='Defined at 4691 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace_calloc</a>(mspace msp, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> n_elements, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> elem_size);
<a name='L1066'>
<a name='L1067'><i><font color='green'>/*</font></i>
<a name='L1068'><i><font color='green'>  mspace_memalign behaves as memalign, but operates within</font></i>
<a name='L1069'><i><font color='green'>  the given space.</font></i>
<a name='L1070'><i><font color='green'>*/</font></i>
<a name='L1071'><b>void</b>* <a href='../S/2317.html#L4735' title='Defined at 4735 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace_memalign</a>(mspace msp, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> alignment, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> bytes);
<a name='L1072'>
<a name='L1073'><i><font color='green'>/*</font></i>
<a name='L1074'><i><font color='green'>  mspace_independent_calloc behaves as independent_calloc, but</font></i>
<a name='L1075'><i><font color='green'>  operates within the given space.</font></i>
<a name='L1076'><i><font color='green'>*/</font></i>
<a name='L1077'><b>void</b>** <a href='../S/2317.html#L4744' title='Defined at 4744 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace_independent_calloc</a>(mspace msp, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> n_elements,
<a name='L1078'>                                 <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> elem_size, <b>void</b>* chunks[]);
<a name='L1079'>
<a name='L1080'><i><font color='green'>/*</font></i>
<a name='L1081'><i><font color='green'>  mspace_independent_comalloc behaves as independent_comalloc, but</font></i>
<a name='L1082'><i><font color='green'>  operates within the given space.</font></i>
<a name='L1083'><i><font color='green'>*/</font></i>
<a name='L1084'><b>void</b>** <a href='../S/2317.html#L4755' title='Defined at 4755 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace_independent_comalloc</a>(mspace msp, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> n_elements,
<a name='L1085'>                                   <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> sizes[], <b>void</b>* chunks[]);
<a name='L1086'>
<a name='L1087'><i><font color='green'>/*</font></i>
<a name='L1088'><i><font color='green'>  mspace_footprint() returns the number of bytes obtained from the</font></i>
<a name='L1089'><i><font color='green'>  system for this space.</font></i>
<a name='L1090'><i><font color='green'>*/</font></i>
<a name='L1091'><a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> <a href='../S/2317.html#L4790' title='Defined at 4790 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace_footprint</a>(mspace msp);
<a name='L1092'>
<a name='L1093'><i><font color='green'>/*</font></i>
<a name='L1094'><i><font color='green'>  mspace_max_footprint() returns the peak number of bytes obtained from the</font></i>
<a name='L1095'><i><font color='green'>  system for this space.</font></i>
<a name='L1096'><i><font color='green'>*/</font></i>
<a name='L1097'><a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> <a href='../S/2317.html#L4801' title='Defined at 4801 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace_max_footprint</a>(mspace msp);
<a name='L1098'>
<a name='L1099'>
<a name='L1100'><font color='darkred'>#if</font> !<a href='../D/2331.html' title='Multiple defined in 2 places.'>NO_MALLINFO</a>
<a name='L1101'><i><font color='green'>/*</font></i>
<a name='L1102'><i><font color='green'>  mspace_mallinfo behaves as mallinfo, but reports properties of</font></i>
<a name='L1103'><i><font color='green'>  the given space.</font></i>
<a name='L1104'><i><font color='green'>*/</font></i>
<a name='L1105'><b>struct</b> <a href='../S/2317.html#L617' title='Defined at 617 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mallinfo</a> <a href='../S/2317.html#L4813' title='Defined at 4813 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace_mallinfo</a>(mspace msp);
<a name='L1106'><font color='darkred'>#endif</font> <i><font color='green'>/* NO_MALLINFO */</font></i>
<a name='L1107'>
<a name='L1108'><i><font color='green'>/*</font></i>
<a name='L1109'><i><font color='green'>  mspace_malloc_stats behaves as malloc_stats, but reports</font></i>
<a name='L1110'><i><font color='green'>  properties of the given space.</font></i>
<a name='L1111'><i><font color='green'>*/</font></i>
<a name='L1112'><b>void</b> <a href='../S/2317.html#L4780' title='Defined at 4780 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace_malloc_stats</a>(mspace msp);
<a name='L1113'>
<a name='L1114'><i><font color='green'>/*</font></i>
<a name='L1115'><i><font color='green'>  mspace_trim behaves as malloc_trim, but</font></i>
<a name='L1116'><i><font color='green'>  operates within the given space.</font></i>
<a name='L1117'><i><font color='green'>*/</font></i>
<a name='L1118'><b>int</b> <a href='../S/2317.html#L4765' title='Defined at 4765 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace_trim</a>(mspace msp, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> pad);
<a name='L1119'>
<a name='L1120'><i><font color='green'>/*</font></i>
<a name='L1121'><i><font color='green'>  An alias for mallopt.</font></i>
<a name='L1122'><i><font color='green'>*/</font></i>
<a name='L1123'><b>int</b> <a href='../S/2317.html#L4822' title='Defined at 4822 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace_mallopt</a>(<b>int</b>, <b>int</b>);
<a name='L1124'>
<a name='L1125'><font color='darkred'>#endif</font> <i><font color='green'>/* MSPACES */</font></i>
<a name='L1126'>
<a name='L1127'><font color='darkred'>#ifdef</font> __cplusplus
<a name='L1128'><font color='red'>}</font>;  <i><font color='green'>/* end of extern "C" */</font></i>
<a name='L1129'><font color='darkred'>#endif</font> <i><font color='green'>/* __cplusplus */</font></i>
<a name='L1130'>
<a name='L1131'><i><font color='green'>/*</font></i>
<a name='L1132'><i><font color='green'>  ========================================================================</font></i>
<a name='L1133'><i><font color='green'>  To make a fully customizable malloc.h header file, cut everything</font></i>
<a name='L1134'><i><font color='green'>  above this line, put into file malloc.h, edit to suit, and #include it</font></i>
<a name='L1135'><i><font color='green'>  on the next line, as well as in programs that use this malloc.</font></i>
<a name='L1136'><i><font color='green'>  ========================================================================</font></i>
<a name='L1137'><i><font color='green'>*/</font></i>
<a name='L1138'>
<a name='L1139'><i><font color='green'>/* #include "malloc.h" */</font></i>
<a name='L1140'>
<a name='L1141'><i><font color='green'>/*------------------------------ internal #includes ---------------------- */</font></i>
<a name='L1142'>
<a name='L1143'><font color='darkred'>#ifdef</font> _MSC_VER
<a name='L1144'><font color='darkred'>#pragma</font> warning( disable : 4146 ) <i><font color='green'>/* no "unsigned" warnings */</font></i>
<a name='L1145'><font color='darkred'>#endif</font> <i><font color='green'>/* _MSC_VER */</font></i>
<a name='L1146'>
<a name='L1147'><font color='darkred'>#include</font> &lt;stdio.h&gt;       <i><font color='green'>/* for printing in malloc_stats */</font></i>
<a name='L1148'>
<a name='L1149'><font color='darkred'>#ifndef</font> <a href='../S/2317.html#L457' title='Defined at 457 in Modules/_ctypes/libffi/src/dlmalloc.c.'>LACKS_ERRNO_H</a>
<a name='L1150'><font color='darkred'>#include</font> &lt;errno.h&gt;       <i><font color='green'>/* for MALLOC_FAILURE_ACTION */</font></i>
<a name='L1151'><font color='darkred'>#endif</font> <i><font color='green'>/* LACKS_ERRNO_H */</font></i>
<a name='L1152'><font color='darkred'>#if</font> <a href='../S/2317.html#L491' title='Defined at 491 in Modules/_ctypes/libffi/src/dlmalloc.c.'>FOOTERS</a>
<a name='L1153'><font color='darkred'>#include</font> &lt;time.h&gt;        <i><font color='green'>/* for magic initialization */</font></i>
<a name='L1154'><font color='darkred'>#endif</font> <i><font color='green'>/* FOOTERS */</font></i>
<a name='L1155'><font color='darkred'>#ifndef</font> LACKS_STDLIB_H
<a name='L1156'><font color='darkred'>#include</font> &lt;stdlib.h&gt;      <i><font color='green'>/* for abort() */</font></i>
<a name='L1157'><font color='darkred'>#endif</font> <i><font color='green'>/* LACKS_STDLIB_H */</font></i>
<a name='L1158'><font color='darkred'>#ifdef</font> <a href='../D/728.html' title='Multiple defined in 2 places.'>DEBUG</a>
<a name='L1159'><font color='darkred'>#if</font> <a href='../S/2317.html#L497' title='Defined at 497 in Modules/_ctypes/libffi/src/dlmalloc.c.'>ABORT_ON_ASSERT_FAILURE</a>
<a name='L1160'><font color='darkred'>#define</font> <a href='../R/6060.html' title='Multiple refered from 1224 places.'>assert</a>(x) <b>if</b>(!(x)) <a href='../S/2317.html#L494' title='Defined at 494 in Modules/_ctypes/libffi/src/dlmalloc.c.'>ABORT</a>
<a name='L1161'><font color='darkred'>#else</font> <i><font color='green'>/* ABORT_ON_ASSERT_FAILURE */</font></i>
<a name='L1162'><font color='darkred'>#include</font> &lt;assert.h&gt;
<a name='L1163'><font color='darkred'>#endif</font> <i><font color='green'>/* ABORT_ON_ASSERT_FAILURE */</font></i>
<a name='L1164'><font color='darkred'>#else</font>  <i><font color='green'>/* DEBUG */</font></i>
<a name='L1165'><font color='darkred'>#define</font> <a href='../R/6060.html' title='Multiple refered from 1224 places.'>assert</a>(x)
<a name='L1166'><font color='darkred'>#endif</font> <i><font color='green'>/* DEBUG */</font></i>
<a name='L1167'><font color='darkred'>#ifndef</font> <a href='../S/2317.html#L454' title='Defined at 454 in Modules/_ctypes/libffi/src/dlmalloc.c.'>LACKS_STRING_H</a>
<a name='L1168'><font color='darkred'>#include</font> &lt;string.h&gt;      <i><font color='green'>/* for memset etc */</font></i>
<a name='L1169'><font color='darkred'>#endif</font>  <i><font color='green'>/* LACKS_STRING_H */</font></i>
<a name='L1170'><font color='darkred'>#if</font> <a href='../D/5382.html' title='Multiple defined in 3 places.'>USE_BUILTIN_FFS</a>
<a name='L1171'><font color='darkred'>#ifndef</font> <a href='../S/2317.html#L455' title='Defined at 455 in Modules/_ctypes/libffi/src/dlmalloc.c.'>LACKS_STRINGS_H</a>
<a name='L1172'><font color='darkred'>#include</font> &lt;strings.h&gt;     <i><font color='green'>/* for ffs */</font></i>
<a name='L1173'><font color='darkred'>#endif</font> <i><font color='green'>/* LACKS_STRINGS_H */</font></i>
<a name='L1174'><font color='darkred'>#endif</font> <i><font color='green'>/* USE_BUILTIN_FFS */</font></i>
<a name='L1175'><font color='darkred'>#if</font> <a href='../D/1532.html' title='Multiple defined in 5 places.'>HAVE_MMAP</a>
<a name='L1176'><font color='darkred'>#ifndef</font> <a href='../D/1880.html' title='Multiple defined in 2 places.'>LACKS_SYS_MMAN_H</a>
<a name='L1177'><font color='darkred'>#include</font> &lt;sys/mman.h&gt;    <i><font color='green'>/* for mmap */</font></i>
<a name='L1178'><font color='darkred'>#endif</font> <i><font color='green'>/* LACKS_SYS_MMAN_H */</font></i>
<a name='L1179'><font color='darkred'>#ifndef</font> LACKS_FCNTL_H
<a name='L1180'><font color='darkred'>#include</font> &lt;fcntl.h&gt;
<a name='L1181'><font color='darkred'>#endif</font> <i><font color='green'>/* LACKS_FCNTL_H */</font></i>
<a name='L1182'><font color='darkred'>#endif</font> <i><font color='green'>/* HAVE_MMAP */</font></i>
<a name='L1183'><font color='darkred'>#if</font> <a href='../D/1537.html' title='Multiple defined in 5 places.'>HAVE_MORECORE</a>
<a name='L1184'><font color='darkred'>#ifndef</font> <a href='../S/2317.html#L451' title='Defined at 451 in Modules/_ctypes/libffi/src/dlmalloc.c.'>LACKS_UNISTD_H</a>
<a name='L1185'><font color='darkred'>#include</font> &lt;unistd.h&gt;     <i><font color='green'>/* for sbrk */</font></i>
<a name='L1186'><font color='darkred'>#else</font> <i><font color='green'>/* LACKS_UNISTD_H */</font></i>
<a name='L1187'><font color='darkred'>#if</font> !<b>defined</b>(__FreeBSD__) &amp;&amp; !<b>defined</b>(__OpenBSD__) &amp;&amp; !<b>defined</b>(__NetBSD__)
<a name='L1188'><b>extern</b> <b>void</b>*     sbrk(<a href='../S/2773.html#L148' title='Defined at 148 in Modules/zlib/zutil.h.'>ptrdiff_t</a>);
<a name='L1189'><font color='darkred'>#endif</font> <i><font color='green'>/* FreeBSD etc */</font></i>
<a name='L1190'><font color='darkred'>#endif</font> <i><font color='green'>/* LACKS_UNISTD_H */</font></i>
<a name='L1191'><font color='darkred'>#endif</font> <i><font color='green'>/* HAVE_MMAP */</font></i>
<a name='L1192'>
<a name='L1193'><font color='darkred'>#ifndef</font> <a href='../D/5523.html' title='Multiple defined in 3 places.'>WIN32</a>
<a name='L1194'><font color='darkred'>#ifndef</font> <a href='../D/9692.html' title='Multiple defined in 9 places.'>malloc_getpagesize</a>
<a name='L1195'><font color='darkred'>#  ifdef</font> _SC_PAGESIZE         <i><font color='green'>/* some SVR4 systems omit an underscore */</font></i>
<a name='L1196'><font color='darkred'>#    ifndef</font> <a href='../S/2317.html#L1197' title='Defined at 1197 in Modules/_ctypes/libffi/src/dlmalloc.c.'>_SC_PAGE_SIZE</a>
<a name='L1197'><font color='darkred'>#      define</font> <a href='../R/5647.html' title='Multiple refered from 7 places.'>_SC_PAGE_SIZE</a> _SC_PAGESIZE
<a name='L1198'><font color='darkred'>#    endif</font>
<a name='L1199'><font color='darkred'>#  endif</font>
<a name='L1200'><font color='darkred'>#  ifdef</font> <a href='../S/2317.html#L1197' title='Defined at 1197 in Modules/_ctypes/libffi/src/dlmalloc.c.'>_SC_PAGE_SIZE</a>
<a name='L1201'><font color='darkred'>#    define</font> <a href='../R/8863.html' title='Multiple refered from 9 places.'>malloc_getpagesize</a> sysconf(<a href='../S/2317.html#L1197' title='Defined at 1197 in Modules/_ctypes/libffi/src/dlmalloc.c.'>_SC_PAGE_SIZE</a>)
<a name='L1202'><font color='darkred'>#  else</font>
<a name='L1203'><font color='darkred'>#    if</font> <b>defined</b>(BSD) || <b>defined</b>(DGUX) || <b>defined</b>(<a href='../S/2649.html#L20' title='Defined at 20 in Modules/expat/amigaconfig.h.'>HAVE_GETPAGESIZE</a>)
<a name='L1204'>       <b>extern</b> <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> getpagesize();
<a name='L1205'><font color='darkred'>#      define</font> <a href='../R/8863.html' title='Multiple refered from 9 places.'>malloc_getpagesize</a> getpagesize()
<a name='L1206'><font color='darkred'>#    else</font>
<a name='L1207'><font color='darkred'>#      ifdef</font> <a href='../D/5523.html' title='Multiple defined in 3 places.'>WIN32</a> <i><font color='green'>/* use supplied emulation of getpagesize */</font></i>
<a name='L1208'><font color='darkred'>#        define</font> <a href='../R/8863.html' title='Multiple refered from 9 places.'>malloc_getpagesize</a> getpagesize()
<a name='L1209'><font color='darkred'>#      else</font>
<a name='L1210'><font color='darkred'>#        ifndef</font> <a href='../S/2317.html#L452' title='Defined at 452 in Modules/_ctypes/libffi/src/dlmalloc.c.'>LACKS_SYS_PARAM_H</a>
<a name='L1211'><font color='darkred'>#          include</font> &lt;sys/param.h&gt;
<a name='L1212'><font color='darkred'>#        endif</font>
<a name='L1213'><font color='darkred'>#        ifdef</font> EXEC_PAGESIZE
<a name='L1214'><font color='darkred'>#          define</font> <a href='../R/8863.html' title='Multiple refered from 9 places.'>malloc_getpagesize</a> EXEC_PAGESIZE
<a name='L1215'><font color='darkred'>#        else</font>
<a name='L1216'><font color='darkred'>#          ifdef</font> NBPG
<a name='L1217'><font color='darkred'>#            ifndef</font> CLSIZE
<a name='L1218'><font color='darkred'>#              define</font> <a href='../R/8863.html' title='Multiple refered from 9 places.'>malloc_getpagesize</a> NBPG
<a name='L1219'><font color='darkred'>#            else</font>
<a name='L1220'><font color='darkred'>#              define</font> <a href='../R/8863.html' title='Multiple refered from 9 places.'>malloc_getpagesize</a> (NBPG * CLSIZE)
<a name='L1221'><font color='darkred'>#            endif</font>
<a name='L1222'><font color='darkred'>#          else</font>
<a name='L1223'><font color='darkred'>#            ifdef</font> NBPC
<a name='L1224'><font color='darkred'>#              define</font> <a href='../R/8863.html' title='Multiple refered from 9 places.'>malloc_getpagesize</a> NBPC
<a name='L1225'><font color='darkred'>#            else</font>
<a name='L1226'><font color='darkred'>#              ifdef</font> PAGESIZE
<a name='L1227'><font color='darkred'>#                define</font> <a href='../R/8863.html' title='Multiple refered from 9 places.'>malloc_getpagesize</a> PAGESIZE
<a name='L1228'><font color='darkred'>#              else</font> <i><font color='green'>/* just guess */</font></i>
<a name='L1229'><font color='darkred'>#                define</font> <a href='../R/8863.html' title='Multiple refered from 9 places.'>malloc_getpagesize</a> ((<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)4096U)
<a name='L1230'><font color='darkred'>#              endif</font>
<a name='L1231'><font color='darkred'>#            endif</font>
<a name='L1232'><font color='darkred'>#          endif</font>
<a name='L1233'><font color='darkred'>#        endif</font>
<a name='L1234'><font color='darkred'>#      endif</font>
<a name='L1235'><font color='darkred'>#    endif</font>
<a name='L1236'><font color='darkred'>#  endif</font>
<a name='L1237'><font color='darkred'>#endif</font>
<a name='L1238'><font color='darkred'>#endif</font>
<a name='L1239'>
<a name='L1240'><i><font color='green'>/* ------------------- size_t and alignment properties -------------------- */</font></i>
<a name='L1241'>
<a name='L1242'><i><font color='green'>/* The byte and bit size of a size_t */</font></i>
<a name='L1243'><font color='darkred'>#define</font> <a href='../R/4182.html' title='Multiple refered from 13 places.'>SIZE_T_SIZE</a>         (<b>sizeof</b>(<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>))
<a name='L1244'><font color='darkred'>#define</font> <a href='../R/4180.html' title='Multiple refered from 5 places.'>SIZE_T_BITSIZE</a>      (<b>sizeof</b>(<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>) &lt;&lt; 3)
<a name='L1245'>
<a name='L1246'><i><font color='green'>/* Some constants coerced to size_t */</font></i>
<a name='L1247'><i><font color='green'>/* Annoying but necessary to avoid errors on some plaftorms */</font></i>
<a name='L1248'><font color='darkred'>#define</font> <a href='../R/4184.html' title='Multiple refered from 2 places.'>SIZE_T_ZERO</a>         ((<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)0)
<a name='L1249'><font color='darkred'>#define</font> <a href='../R/4181.html' title='Multiple refered from 36 places.'>SIZE_T_ONE</a>          ((<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)1)
<a name='L1250'><font color='darkred'>#define</font> <a href='../S/2317.html#L1660' title='Refered from 1660 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_TWO</a>          ((<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)2)
<a name='L1251'><font color='darkred'>#define</font> <a href='../R/4577.html' title='Multiple refered from 5 places.'>TWO_SIZE_T_SIZES</a>    (<a href='../S/2317.html#L1243' title='Defined at 1243 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_SIZE</a>&lt;&lt;1)
<a name='L1252'><font color='darkred'>#define</font> <a href='../R/1157.html' title='Multiple refered from 3 places.'>FOUR_SIZE_T_SIZES</a>   (<a href='../S/2317.html#L1243' title='Defined at 1243 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_SIZE</a>&lt;&lt;2)
<a name='L1253'><font color='darkred'>#define</font> <a href='../R/4160.html' title='Multiple refered from 2 places.'>SIX_SIZE_T_SIZES</a>    (<a href='../S/2317.html#L1252' title='Defined at 1252 in Modules/_ctypes/libffi/src/dlmalloc.c.'>FOUR_SIZE_T_SIZES</a>+<a href='../S/2317.html#L1251' title='Defined at 1251 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TWO_SIZE_T_SIZES</a>)
<a name='L1254'><font color='darkred'>#define</font> <a href='../R/1305.html' title='Multiple refered from 7 places.'>HALF_MAX_SIZE_T</a>     (<a href='../S/2317.html#L475' title='Defined at 475 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MAX_SIZE_T</a> / 2U)
<a name='L1255'>
<a name='L1256'><i><font color='green'>/* The bit mask value corresponding to MALLOC_ALIGNMENT */</font></i>
<a name='L1257'><font color='darkred'>#define</font> <a href='../R/510.html' title='Multiple refered from 11 places.'>CHUNK_ALIGN_MASK</a>    (<a href='../S/2317.html#L488' title='Defined at 488 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MALLOC_ALIGNMENT</a> - <a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a>)
<a name='L1258'>
<a name='L1259'><i><font color='green'>/* True if address a has acceptable alignment */</font></i>
<a name='L1260'><font color='darkred'>#define</font> <a href='../R/8493.html' title='Multiple refered from 6 places.'>is_aligned</a>(<a href='../D/1.html' title='Multiple defined in 18 places.'>A</a>)       (((<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)((A)) &amp; (<a href='../S/2317.html#L1257' title='Defined at 1257 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CHUNK_ALIGN_MASK</a>)) == 0)
<a name='L1261'>
<a name='L1262'><i><font color='green'>/* the number of bytes to offset an address to align it */</font></i>
<a name='L1263'><font color='darkred'>#define</font> <a href='../R/5956.html' title='Multiple refered from 5 places.'>align_offset</a>(A)\
<a name='L1264'> ((((<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)(<a href='../D/1.html' title='Multiple defined in 18 places.'>A</a>) &amp; <a href='../S/2317.html#L1257' title='Defined at 1257 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CHUNK_ALIGN_MASK</a>) == 0)? 0 :\
<a name='L1265'>  ((<a href='../S/2317.html#L488' title='Defined at 488 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MALLOC_ALIGNMENT</a> - ((<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)(<a href='../D/1.html' title='Multiple defined in 18 places.'>A</a>) &amp; <a href='../S/2317.html#L1257' title='Defined at 1257 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CHUNK_ALIGN_MASK</a>)) &amp; <a href='../S/2317.html#L1257' title='Defined at 1257 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CHUNK_ALIGN_MASK</a>))
<a name='L1266'>
<a name='L1267'><i><font color='green'>/* -------------------------- MMAP preliminaries ------------------------- */</font></i>
<a name='L1268'>
<a name='L1269'><i><font color='green'>/*</font></i>
<a name='L1270'><i><font color='green'>   If HAVE_MORECORE or HAVE_MMAP are false, we just define calls and</font></i>
<a name='L1271'><i><font color='green'>   checks to fail so compiler optimizer can delete code rather than</font></i>
<a name='L1272'><i><font color='green'>   using so many "#if"s.</font></i>
<a name='L1273'><i><font color='green'>*/</font></i>
<a name='L1274'>
<a name='L1275'>
<a name='L1276'><i><font color='green'>/* MORECORE and MMAP must return MFAIL on failure */</font></i>
<a name='L1277'><font color='darkred'>#define</font> <a href='../R/1921.html' title='Multiple refered from 14 places.'>MFAIL</a>                ((<b>void</b>*)(<a href='../S/2317.html#L475' title='Defined at 475 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MAX_SIZE_T</a>))
<a name='L1278'><font color='darkred'>#define</font> <a href='../R/530.html' title='Multiple refered from 19 places.'>CMFAIL</a>               ((<b>char</b>*)(<a href='../S/2317.html#L1277' title='Defined at 1277 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MFAIL</a>)) <i><font color='green'>/* defined for convenience */</font></i>
<a name='L1279'>
<a name='L1280'><font color='darkred'>#if</font> !<a href='../D/1532.html' title='Multiple defined in 5 places.'>HAVE_MMAP</a>
<a name='L1281'><font color='darkred'>#define</font> <a href='../R/1596.html' title='Multiple refered from 16 places.'>IS_MMAPPED_BIT</a>       (<a href='../S/2317.html#L1248' title='Defined at 1248 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ZERO</a>)
<a name='L1282'><font color='darkred'>#define</font> <a href='../R/4775.html' title='Multiple refered from 5 places.'>USE_MMAP_BIT</a>         (<a href='../S/2317.html#L1248' title='Defined at 1248 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ZERO</a>)
<a name='L1283'><font color='darkred'>#define</font> <a href='../R/443.html' title='Multiple refered from 3 places.'>CALL_MMAP</a>(s)         <a href='../S/2317.html#L1277' title='Defined at 1277 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MFAIL</a>
<a name='L1284'><font color='darkred'>#define</font> <a href='../R/446.html' title='Multiple refered from 5 places.'>CALL_MUNMAP</a>(a, s)    (-1)
<a name='L1285'><font color='darkred'>#define</font> <a href='../S/2317.html#L3156' title='Refered from 3156 in Modules/_ctypes/libffi/src/dlmalloc.c.'>DIRECT_MMAP</a>(s)       <a href='../S/2317.html#L1277' title='Defined at 1277 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MFAIL</a>
<a name='L1286'>
<a name='L1287'><font color='darkred'>#else</font> <i><font color='green'>/* HAVE_MMAP */</font></i>
<a name='L1288'><font color='darkred'>#define</font> <a href='../R/1596.html' title='Multiple refered from 16 places.'>IS_MMAPPED_BIT</a>       (<a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a>)
<a name='L1289'><font color='darkred'>#define</font> <a href='../R/4775.html' title='Multiple refered from 5 places.'>USE_MMAP_BIT</a>         (<a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a>)
<a name='L1290'>
<a name='L1291'><font color='darkred'>#ifndef</font> <a href='../D/5523.html' title='Multiple defined in 3 places.'>WIN32</a>
<a name='L1292'><font color='darkred'>#define</font> <a href='../R/446.html' title='Multiple refered from 5 places.'>CALL_MUNMAP</a>(a, s)    munmap((a), (s))
<a name='L1293'><font color='darkred'>#define</font> <a href='../R/1950.html' title='Multiple refered from 3 places.'>MMAP_PROT</a>            (PROT_READ|PROT_WRITE)
<a name='L1294'><font color='darkred'>#if</font> !<b>defined</b>(<a href='../D/2021.html' title='Multiple defined in 5 places.'>MAP_ANONYMOUS</a>) &amp;&amp; <b>defined</b>(MAP_ANON)
<a name='L1295'><font color='darkred'>#define</font> <a href='../R/1822.html' title='Multiple refered from 17 places.'>MAP_ANONYMOUS</a>        MAP_ANON
<a name='L1296'><font color='darkred'>#endif</font> <i><font color='green'>/* MAP_ANON */</font></i>
<a name='L1297'><font color='darkred'>#ifdef</font> <a href='../D/2021.html' title='Multiple defined in 5 places.'>MAP_ANONYMOUS</a>
<a name='L1298'><font color='darkred'>#define</font> <a href='../R/1948.html' title='Multiple refered from 3 places.'>MMAP_FLAGS</a>           (MAP_PRIVATE|<a href='../D/2021.html' title='Multiple defined in 5 places.'>MAP_ANONYMOUS</a>)
<a name='L1299'><font color='darkred'>#define</font> <a href='../R/443.html' title='Multiple refered from 3 places.'>CALL_MMAP</a>(s)         mmap(0, (s), <a href='../S/2317.html#L1293' title='Defined at 1293 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MMAP_PROT</a>, <a href='../D/2151.html' title='Multiple defined in 2 places.'>MMAP_FLAGS</a>, -1, 0)
<a name='L1300'><font color='darkred'>#else</font> <i><font color='green'>/* MAP_ANONYMOUS */</font></i>
<a name='L1301'><i><font color='green'>/*</font></i>
<a name='L1302'><i><font color='green'>   Nearly all versions of mmap support MAP_ANONYMOUS, so the following</font></i>
<a name='L1303'><i><font color='green'>   is unlikely to be needed, but is supplied just in case.</font></i>
<a name='L1304'><i><font color='green'>*/</font></i>
<a name='L1305'><font color='darkred'>#define</font> <a href='../R/1948.html' title='Multiple refered from 3 places.'>MMAP_FLAGS</a>           (MAP_PRIVATE)
<a name='L1306'><b>static</b> <b>int</b> dev_zero_fd = -1; <i><font color='green'>/* Cached file descriptor for /dev/zero. */</font></i>
<a name='L1307'><font color='darkred'>#define</font> <a href='../R/443.html' title='Multiple refered from 3 places.'>CALL_MMAP</a>(s) ((dev_zero_fd &lt; 0) ? \
<a name='L1308'>           (dev_zero_fd = open("/dev/zero", O_RDWR), \
<a name='L1309'>            mmap(0, (s), <a href='../S/2317.html#L1293' title='Defined at 1293 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MMAP_PROT</a>, <a href='../D/2151.html' title='Multiple defined in 2 places.'>MMAP_FLAGS</a>, dev_zero_fd, 0)) : \
<a name='L1310'>            mmap(0, (s), <a href='../S/2317.html#L1293' title='Defined at 1293 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MMAP_PROT</a>, <a href='../D/2151.html' title='Multiple defined in 2 places.'>MMAP_FLAGS</a>, dev_zero_fd, 0))
<a name='L1311'><font color='darkred'>#endif</font> <i><font color='green'>/* MAP_ANONYMOUS */</font></i>
<a name='L1312'>
<a name='L1313'><font color='darkred'>#define</font> <a href='../S/2317.html#L3156' title='Refered from 3156 in Modules/_ctypes/libffi/src/dlmalloc.c.'>DIRECT_MMAP</a>(s)       <a href='../D/471.html' title='Multiple defined in 4 places.'>CALL_MMAP</a>(s)
<a name='L1314'><font color='darkred'>#else</font> <i><font color='green'>/* WIN32 */</font></i>
<a name='L1315'>
<a name='L1316'><i><font color='green'>/* Win32 MMAP via VirtualAlloc */</font></i>
<a name='L1317'><b>static</b> <b>void</b>* <a href='../S/2317.html#L1347' title='Refered from 1347 in Modules/_ctypes/libffi/src/dlmalloc.c.'>win32mmap</a>(<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> size) <font color='red'>{</font>
<a name='L1318'>  <b>void</b>* ptr = VirtualAlloc(0, size, MEM_RESERVE|MEM_COMMIT, PAGE_EXECUTE_READWRITE);
<a name='L1319'>  <b>return</b> (ptr != 0)? ptr: <a href='../S/2317.html#L1277' title='Defined at 1277 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MFAIL</a>;
<a name='L1320'><font color='red'>}</font>
<a name='L1321'>
<a name='L1322'><i><font color='green'>/* For direct MMAP, use MEM_TOP_DOWN to minimize interference */</font></i>
<a name='L1323'><b>static</b> <b>void</b>* <a href='../S/2317.html#L1349' title='Refered from 1349 in Modules/_ctypes/libffi/src/dlmalloc.c.'>win32direct_mmap</a>(<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> size) <font color='red'>{</font>
<a name='L1324'>  <b>void</b>* ptr = VirtualAlloc(0, size, MEM_RESERVE|MEM_COMMIT|MEM_TOP_DOWN,
<a name='L1325'>                           PAGE_EXECUTE_READWRITE);
<a name='L1326'>  <b>return</b> (ptr != 0)? ptr: <a href='../S/2317.html#L1277' title='Defined at 1277 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MFAIL</a>;
<a name='L1327'><font color='red'>}</font>
<a name='L1328'>
<a name='L1329'><i><font color='green'>/* This function supports releasing coalesed segments */</font></i>
<a name='L1330'><b>static</b> <b>int</b> <a href='../S/2317.html#L1348' title='Refered from 1348 in Modules/_ctypes/libffi/src/dlmalloc.c.'>win32munmap</a>(<b>void</b>* ptr, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> size) <font color='red'>{</font>
<a name='L1331'>  MEMORY_BASIC_INFORMATION minfo;
<a name='L1332'>  <b>char</b>* cptr = ptr;
<a name='L1333'>  <b>while</b> (size) <font color='red'>{</font>
<a name='L1334'>    <b>if</b> (VirtualQuery(cptr, &amp;minfo, <b>sizeof</b>(minfo)) == 0)
<a name='L1335'>      <b>return</b> -1;
<a name='L1336'>    <b>if</b> (minfo.BaseAddress != cptr || minfo.AllocationBase != cptr ||
<a name='L1337'>        minfo.State != MEM_COMMIT || minfo.RegionSize &gt; size)
<a name='L1338'>      <b>return</b> -1;
<a name='L1339'>    <b>if</b> (VirtualFree(cptr, 0, MEM_RELEASE) == 0)
<a name='L1340'>      <b>return</b> -1;
<a name='L1341'>    cptr += minfo.RegionSize;
<a name='L1342'>    size -= minfo.RegionSize;
<a name='L1343'>  <font color='red'>}</font>
<a name='L1344'>  <b>return</b> 0;
<a name='L1345'><font color='red'>}</font>
<a name='L1346'>
<a name='L1347'><font color='darkred'>#define</font> <a href='../R/443.html' title='Multiple refered from 3 places.'>CALL_MMAP</a>(s)         <a href='../S/2317.html#L1317' title='Defined at 1317 in Modules/_ctypes/libffi/src/dlmalloc.c.'>win32mmap</a>(s)
<a name='L1348'><font color='darkred'>#define</font> <a href='../R/446.html' title='Multiple refered from 5 places.'>CALL_MUNMAP</a>(a, s)    <a href='../S/2317.html#L1330' title='Defined at 1330 in Modules/_ctypes/libffi/src/dlmalloc.c.'>win32munmap</a>((a), (s))
<a name='L1349'><font color='darkred'>#define</font> <a href='../S/2317.html#L3156' title='Refered from 3156 in Modules/_ctypes/libffi/src/dlmalloc.c.'>DIRECT_MMAP</a>(s)       <a href='../S/2317.html#L1323' title='Defined at 1323 in Modules/_ctypes/libffi/src/dlmalloc.c.'>win32direct_mmap</a>(s)
<a name='L1350'><font color='darkred'>#endif</font> <i><font color='green'>/* WIN32 */</font></i>
<a name='L1351'><font color='darkred'>#endif</font> <i><font color='green'>/* HAVE_MMAP */</font></i>
<a name='L1352'>
<a name='L1353'><font color='darkred'>#if</font> <a href='../D/1532.html' title='Multiple defined in 5 places.'>HAVE_MMAP</a> &amp;&amp; <a href='../D/1538.html' title='Multiple defined in 3 places.'>HAVE_MREMAP</a>
<a name='L1354'><font color='darkred'>#define</font> <a href='../R/445.html' title='Multiple refered from 2 places.'>CALL_MREMAP</a>(addr, osz, nsz, mv) mremap((addr), (osz), (nsz), (mv))
<a name='L1355'><font color='darkred'>#else</font>  <i><font color='green'>/* HAVE_MMAP &amp;&amp; HAVE_MREMAP */</font></i>
<a name='L1356'><font color='darkred'>#define</font> <a href='../R/445.html' title='Multiple refered from 2 places.'>CALL_MREMAP</a>(addr, osz, nsz, mv) <a href='../S/2317.html#L1277' title='Defined at 1277 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MFAIL</a>
<a name='L1357'><font color='darkred'>#endif</font> <i><font color='green'>/* HAVE_MMAP &amp;&amp; HAVE_MREMAP */</font></i>
<a name='L1358'>
<a name='L1359'><font color='darkred'>#if</font> <a href='../D/1537.html' title='Multiple defined in 5 places.'>HAVE_MORECORE</a>
<a name='L1360'><font color='darkred'>#define</font> <a href='../R/444.html' title='Multiple refered from 10 places.'>CALL_MORECORE</a>(<a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>)     <a href='../S/2317.html#L535' title='Defined at 535 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MORECORE</a>(S)
<a name='L1361'><font color='darkred'>#else</font>  <i><font color='green'>/* HAVE_MORECORE */</font></i>
<a name='L1362'><font color='darkred'>#define</font> <a href='../R/444.html' title='Multiple refered from 10 places.'>CALL_MORECORE</a>(S)     <a href='../S/2317.html#L1277' title='Defined at 1277 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MFAIL</a>
<a name='L1363'><font color='darkred'>#endif</font> <i><font color='green'>/* HAVE_MORECORE */</font></i>
<a name='L1364'>
<a name='L1365'><i><font color='green'>/* mstate bit set if continguous morecore disabled or failed */</font></i>
<a name='L1366'><font color='darkred'>#define</font> <a href='../R/4776.html' title='Multiple refered from 3 places.'>USE_NONCONTIGUOUS_BIT</a> (4U)
<a name='L1367'>
<a name='L1368'><i><font color='green'>/* segment bit set in create_mspace_with_base */</font></i>
<a name='L1369'><font color='darkred'>#define</font> <a href='../R/930.html' title='Multiple refered from 3 places.'>EXTERN_BIT</a>            (8U)
<a name='L1370'>
<a name='L1371'>
<a name='L1372'><i><font color='green'>/* --------------------------- Lock preliminaries ------------------------ */</font></i>
<a name='L1373'>
<a name='L1374'><font color='darkred'>#if</font> <a href='../D/5395.html' title='Multiple defined in 2 places.'>USE_LOCKS</a>
<a name='L1375'>
<a name='L1376'><i><font color='green'>/*</font></i>
<a name='L1377'><i><font color='green'>  When locks are defined, there are up to two global locks:</font></i>
<a name='L1378'><i><font color='green'></font></i>
<a name='L1379'><i><font color='green'>  * If HAVE_MORECORE, morecore_mutex protects sequences of calls to</font></i>
<a name='L1380'><i><font color='green'>    MORECORE.  In many cases sys_alloc requires two calls, that should</font></i>
<a name='L1381'><i><font color='green'>    not be interleaved with calls by other threads.  This does not</font></i>
<a name='L1382'><i><font color='green'>    protect against direct calls to MORECORE by other threads not</font></i>
<a name='L1383'><i><font color='green'>    using this lock, so there is still code to cope the best we can on</font></i>
<a name='L1384'><i><font color='green'>    interference.</font></i>
<a name='L1385'><i><font color='green'></font></i>
<a name='L1386'><i><font color='green'>  * magic_init_mutex ensures that mparams.magic and other</font></i>
<a name='L1387'><i><font color='green'>    unique mparams values are initialized only once.</font></i>
<a name='L1388'><i><font color='green'>*/</font></i>
<a name='L1389'>
<a name='L1390'><font color='darkred'>#ifndef</font> <a href='../D/5523.html' title='Multiple defined in 3 places.'>WIN32</a>
<a name='L1391'><i><font color='green'>/* By default use posix locks */</font></i>
<a name='L1392'><font color='darkred'>#include</font> &lt;pthread.h&gt;
<a name='L1393'><font color='darkred'>#define</font> <a href='../R/1945.html' title='Multiple refered from 7 places.'>MLOCK_T</a> pthread_mutex_t
<a name='L1394'><font color='darkred'>#define</font> <a href='../R/1516.html' title='Multiple refered from 2 places.'>INITIAL_LOCK</a>(l)      pthread_mutex_init(l, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1395'><font color='darkred'>#define</font> <a href='../R/11.html' title='Multiple refered from 14 places.'>ACQUIRE_LOCK</a>(l)      pthread_mutex_lock(l)
<a name='L1396'><font color='darkred'>#define</font> <a href='../R/3936.html' title='Multiple refered from 18 places.'>RELEASE_LOCK</a>(l)      pthread_mutex_unlock(l)
<a name='L1397'>
<a name='L1398'><font color='darkred'>#if</font> <a href='../D/1537.html' title='Multiple defined in 5 places.'>HAVE_MORECORE</a>
<a name='L1399'><b>static</b> <a href='../D/2148.html' title='Multiple defined in 2 places.'>MLOCK_T</a> morecore_mutex = PTHREAD_MUTEX_INITIALIZER;
<a name='L1400'><font color='darkred'>#endif</font> <i><font color='green'>/* HAVE_MORECORE */</font></i>
<a name='L1401'>
<a name='L1402'><b>static</b> <a href='../D/2148.html' title='Multiple defined in 2 places.'>MLOCK_T</a> magic_init_mutex = PTHREAD_MUTEX_INITIALIZER;
<a name='L1403'>
<a name='L1404'><font color='darkred'>#else</font> <i><font color='green'>/* WIN32 */</font></i>
<a name='L1405'><i><font color='green'>/*</font></i>
<a name='L1406'><i><font color='green'>   Because lock-protected regions have bounded times, and there</font></i>
<a name='L1407'><i><font color='green'>   are no recursive lock calls, we can use simple spinlocks.</font></i>
<a name='L1408'><i><font color='green'>*/</font></i>
<a name='L1409'>
<a name='L1410'><font color='darkred'>#define</font> <a href='../R/1945.html' title='Multiple refered from 7 places.'>MLOCK_T</a> <b>long</b>
<a name='L1411'><b>static</b> <b>int</b> <a href='../S/2317.html#L1429' title='Refered from 1429 in Modules/_ctypes/libffi/src/dlmalloc.c.'>win32_acquire_lock</a> (<a href='../D/2148.html' title='Multiple defined in 2 places.'>MLOCK_T</a> *sl) <font color='red'>{</font>
<a name='L1412'>  <b>for</b> (;;) <font color='red'>{</font>
<a name='L1413'><font color='darkred'>#ifdef</font> InterlockedCompareExchangePointer
<a name='L1414'>    <b>if</b> (!InterlockedCompareExchange(sl, 1, 0))
<a name='L1415'>      <b>return</b> 0;
<a name='L1416'><font color='darkred'>#else</font>  <i><font color='green'>/* Use older void* version */</font></i>
<a name='L1417'>    <b>if</b> (!InterlockedCompareExchange((<b>void</b>**)sl, (<b>void</b>*)1, (<b>void</b>*)0))
<a name='L1418'>      <b>return</b> 0;
<a name='L1419'><font color='darkred'>#endif</font> <i><font color='green'>/* InterlockedCompareExchangePointer */</font></i>
<a name='L1420'>    <a href='../S/2618.html#L307' title='Defined at 307 in Modules/_tkinter.c.'>Sleep</a> (0);
<a name='L1421'>  <font color='red'>}</font>
<a name='L1422'><font color='red'>}</font>
<a name='L1423'>
<a name='L1424'><b>static</b> <b>void</b> <a href='../S/2317.html#L1430' title='Refered from 1430 in Modules/_ctypes/libffi/src/dlmalloc.c.'>win32_release_lock</a> (<a href='../D/2148.html' title='Multiple defined in 2 places.'>MLOCK_T</a> *sl) <font color='red'>{</font>
<a name='L1425'>  InterlockedExchange (sl, 0);
<a name='L1426'><font color='red'>}</font>
<a name='L1427'>
<a name='L1428'><font color='darkred'>#define</font> <a href='../R/1516.html' title='Multiple refered from 2 places.'>INITIAL_LOCK</a>(l)      *(l)=0
<a name='L1429'><font color='darkred'>#define</font> <a href='../R/11.html' title='Multiple refered from 14 places.'>ACQUIRE_LOCK</a>(l)      <a href='../S/2317.html#L1411' title='Defined at 1411 in Modules/_ctypes/libffi/src/dlmalloc.c.'>win32_acquire_lock</a>(l)
<a name='L1430'><font color='darkred'>#define</font> <a href='../R/3936.html' title='Multiple refered from 18 places.'>RELEASE_LOCK</a>(l)      <a href='../S/2317.html#L1424' title='Defined at 1424 in Modules/_ctypes/libffi/src/dlmalloc.c.'>win32_release_lock</a>(l)
<a name='L1431'><font color='darkred'>#if</font> <a href='../D/1537.html' title='Multiple defined in 5 places.'>HAVE_MORECORE</a>
<a name='L1432'><b>static</b> <a href='../D/2148.html' title='Multiple defined in 2 places.'>MLOCK_T</a> morecore_mutex;
<a name='L1433'><font color='darkred'>#endif</font> <i><font color='green'>/* HAVE_MORECORE */</font></i>
<a name='L1434'><b>static</b> <a href='../D/2148.html' title='Multiple defined in 2 places.'>MLOCK_T</a> magic_init_mutex;
<a name='L1435'><font color='darkred'>#endif</font> <i><font color='green'>/* WIN32 */</font></i>
<a name='L1436'>
<a name='L1437'><font color='darkred'>#define</font> <a href='../R/4774.html' title='Multiple refered from 7 places.'>USE_LOCK_BIT</a>               (2U)
<a name='L1438'><font color='darkred'>#else</font>  <i><font color='green'>/* USE_LOCKS */</font></i>
<a name='L1439'><font color='darkred'>#define</font> <a href='../R/4774.html' title='Multiple refered from 7 places.'>USE_LOCK_BIT</a>               (0U)
<a name='L1440'><font color='darkred'>#define</font> <a href='../R/1516.html' title='Multiple refered from 2 places.'>INITIAL_LOCK</a>(l)
<a name='L1441'><font color='darkred'>#endif</font> <i><font color='green'>/* USE_LOCKS */</font></i>
<a name='L1442'>
<a name='L1443'><font color='darkred'>#if</font> <a href='../D/5395.html' title='Multiple defined in 2 places.'>USE_LOCKS</a> &amp;&amp; <a href='../D/1537.html' title='Multiple defined in 5 places.'>HAVE_MORECORE</a>
<a name='L1444'><font color='darkred'>#define</font> <a href='../R/13.html' title='Multiple refered from 3 places.'>ACQUIRE_MORECORE_LOCK</a>()    <a href='../D/20.html' title='Multiple defined in 4 places.'>ACQUIRE_LOCK</a>(&amp;morecore_mutex);
<a name='L1445'><font color='darkred'>#define</font> <a href='../R/3938.html' title='Multiple refered from 3 places.'>RELEASE_MORECORE_LOCK</a>()    <a href='../D/4465.html' title='Multiple defined in 4 places.'>RELEASE_LOCK</a>(&amp;morecore_mutex);
<a name='L1446'><font color='darkred'>#else</font> <i><font color='green'>/* USE_LOCKS &amp;&amp; HAVE_MORECORE */</font></i>
<a name='L1447'><font color='darkred'>#define</font> <a href='../R/13.html' title='Multiple refered from 3 places.'>ACQUIRE_MORECORE_LOCK</a>()
<a name='L1448'><font color='darkred'>#define</font> <a href='../R/3938.html' title='Multiple refered from 3 places.'>RELEASE_MORECORE_LOCK</a>()
<a name='L1449'><font color='darkred'>#endif</font> <i><font color='green'>/* USE_LOCKS &amp;&amp; HAVE_MORECORE */</font></i>
<a name='L1450'>
<a name='L1451'><font color='darkred'>#if</font> <a href='../D/5395.html' title='Multiple defined in 2 places.'>USE_LOCKS</a>
<a name='L1452'><font color='darkred'>#define</font> <a href='../S/2317.html#L2486' title='Refered from 2486 in Modules/_ctypes/libffi/src/dlmalloc.c.'>ACQUIRE_MAGIC_INIT_LOCK</a>()  <a href='../D/20.html' title='Multiple defined in 4 places.'>ACQUIRE_LOCK</a>(&amp;magic_init_mutex);
<a name='L1453'><font color='darkred'>#define</font> <a href='../S/2317.html#L2493' title='Refered from 2493 in Modules/_ctypes/libffi/src/dlmalloc.c.'>RELEASE_MAGIC_INIT_LOCK</a>()  <a href='../D/4465.html' title='Multiple defined in 4 places.'>RELEASE_LOCK</a>(&amp;magic_init_mutex);
<a name='L1454'><font color='darkred'>#else</font>  <i><font color='green'>/* USE_LOCKS */</font></i>
<a name='L1455'><font color='darkred'>#define</font> <a href='../S/2317.html#L2486' title='Refered from 2486 in Modules/_ctypes/libffi/src/dlmalloc.c.'>ACQUIRE_MAGIC_INIT_LOCK</a>()
<a name='L1456'><font color='darkred'>#define</font> <a href='../S/2317.html#L2493' title='Refered from 2493 in Modules/_ctypes/libffi/src/dlmalloc.c.'>RELEASE_MAGIC_INIT_LOCK</a>()
<a name='L1457'><font color='darkred'>#endif</font> <i><font color='green'>/* USE_LOCKS */</font></i>
<a name='L1458'>
<a name='L1459'>
<a name='L1460'><i><font color='green'>/* -----------------------  Chunk representations ------------------------ */</font></i>
<a name='L1461'>
<a name='L1462'><i><font color='green'>/*</font></i>
<a name='L1463'><i><font color='green'>  (The following includes lightly edited explanations by Colin Plumb.)</font></i>
<a name='L1464'><i><font color='green'></font></i>
<a name='L1465'><i><font color='green'>  The malloc_chunk declaration below is misleading (but accurate and</font></i>
<a name='L1466'><i><font color='green'>  necessary).  It declares a "view" into memory allowing access to</font></i>
<a name='L1467'><i><font color='green'>  necessary fields at known offsets from a given base.</font></i>
<a name='L1468'><i><font color='green'></font></i>
<a name='L1469'><i><font color='green'>  Chunks of memory are maintained using a `boundary tag' method as</font></i>
<a name='L1470'><i><font color='green'>  originally described by Knuth.  (See the paper by Paul Wilson</font></i>
<a name='L1471'><i><font color='green'>  ftp://ftp.cs.utexas.edu/pub/garbage/allocsrv.ps for a survey of such</font></i>
<a name='L1472'><i><font color='green'>  techniques.)  Sizes of free chunks are stored both in the front of</font></i>
<a name='L1473'><i><font color='green'>  each chunk and at the end.  This makes consolidating fragmented</font></i>
<a name='L1474'><i><font color='green'>  chunks into bigger chunks fast.  The head fields also hold bits</font></i>
<a name='L1475'><i><font color='green'>  representing whether chunks are free or in use.</font></i>
<a name='L1476'><i><font color='green'></font></i>
<a name='L1477'><i><font color='green'>  Here are some pictures to make it clearer.  They are "exploded" to</font></i>
<a name='L1478'><i><font color='green'>  show that the state of a chunk can be thought of as extending from</font></i>
<a name='L1479'><i><font color='green'>  the high 31 bits of the head field of its header through the</font></i>
<a name='L1480'><i><font color='green'>  prev_foot and PINUSE_BIT bit of the following chunk header.</font></i>
<a name='L1481'><i><font color='green'></font></i>
<a name='L1482'><i><font color='green'>  A chunk that's in use looks like:</font></i>
<a name='L1483'><i><font color='green'></font></i>
<a name='L1484'><i><font color='green'>   chunk-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</font></i>
<a name='L1485'><i><font color='green'>           | Size of previous chunk (if P = 1)                             |</font></i>
<a name='L1486'><i><font color='green'>           +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</font></i>
<a name='L1487'><i><font color='green'>         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |P|</font></i>
<a name='L1488'><i><font color='green'>         | Size of this chunk                                         1| +-+</font></i>
<a name='L1489'><i><font color='green'>   mem-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</font></i>
<a name='L1490'><i><font color='green'>         |                                                               |</font></i>
<a name='L1491'><i><font color='green'>         +-                                                             -+</font></i>
<a name='L1492'><i><font color='green'>         |                                                               |</font></i>
<a name='L1493'><i><font color='green'>         +-                                                             -+</font></i>
<a name='L1494'><i><font color='green'>         |                                                               :</font></i>
<a name='L1495'><i><font color='green'>         +-      size - sizeof(size_t) available payload bytes          -+</font></i>
<a name='L1496'><i><font color='green'>         :                                                               |</font></i>
<a name='L1497'><i><font color='green'> chunk-&gt; +-                                                             -+</font></i>
<a name='L1498'><i><font color='green'>         |                                                               |</font></i>
<a name='L1499'><i><font color='green'>         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</font></i>
<a name='L1500'><i><font color='green'>       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |1|</font></i>
<a name='L1501'><i><font color='green'>       | Size of next chunk (may or may not be in use)               | +-+</font></i>
<a name='L1502'><i><font color='green'> mem-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</font></i>
<a name='L1503'><i><font color='green'></font></i>
<a name='L1504'><i><font color='green'>    And if it's free, it looks like this:</font></i>
<a name='L1505'><i><font color='green'></font></i>
<a name='L1506'><i><font color='green'>   chunk-&gt; +-                                                             -+</font></i>
<a name='L1507'><i><font color='green'>           | User payload (must be in use, or we would have merged!)       |</font></i>
<a name='L1508'><i><font color='green'>           +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</font></i>
<a name='L1509'><i><font color='green'>         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |P|</font></i>
<a name='L1510'><i><font color='green'>         | Size of this chunk                                         0| +-+</font></i>
<a name='L1511'><i><font color='green'>   mem-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</font></i>
<a name='L1512'><i><font color='green'>         | Next pointer                                                  |</font></i>
<a name='L1513'><i><font color='green'>         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</font></i>
<a name='L1514'><i><font color='green'>         | Prev pointer                                                  |</font></i>
<a name='L1515'><i><font color='green'>         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</font></i>
<a name='L1516'><i><font color='green'>         |                                                               :</font></i>
<a name='L1517'><i><font color='green'>         +-      size - sizeof(struct chunk) unused bytes               -+</font></i>
<a name='L1518'><i><font color='green'>         :                                                               |</font></i>
<a name='L1519'><i><font color='green'> chunk-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</font></i>
<a name='L1520'><i><font color='green'>         | Size of this chunk                                            |</font></i>
<a name='L1521'><i><font color='green'>         +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</font></i>
<a name='L1522'><i><font color='green'>       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |0|</font></i>
<a name='L1523'><i><font color='green'>       | Size of next chunk (must be in use, or we would have merged)| +-+</font></i>
<a name='L1524'><i><font color='green'> mem-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</font></i>
<a name='L1525'><i><font color='green'>       |                                                               :</font></i>
<a name='L1526'><i><font color='green'>       +- User payload                                                -+</font></i>
<a name='L1527'><i><font color='green'>       :                                                               |</font></i>
<a name='L1528'><i><font color='green'>       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</font></i>
<a name='L1529'><i><font color='green'>                                                                     |0|</font></i>
<a name='L1530'><i><font color='green'>                                                                     +-+</font></i>
<a name='L1531'><i><font color='green'>  Note that since we always merge adjacent free chunks, the chunks</font></i>
<a name='L1532'><i><font color='green'>  adjacent to a free chunk must be in use.</font></i>
<a name='L1533'><i><font color='green'></font></i>
<a name='L1534'><i><font color='green'>  Given a pointer to a chunk (which can be derived trivially from the</font></i>
<a name='L1535'><i><font color='green'>  payload pointer) we can, in O(1) time, find out whether the adjacent</font></i>
<a name='L1536'><i><font color='green'>  chunks are free, and if so, unlink them from the lists that they</font></i>
<a name='L1537'><i><font color='green'>  are on and merge them with the current chunk.</font></i>
<a name='L1538'><i><font color='green'></font></i>
<a name='L1539'><i><font color='green'>  Chunks always begin on even word boundaries, so the mem portion</font></i>
<a name='L1540'><i><font color='green'>  (which is returned to the user) is also on an even word boundary, and</font></i>
<a name='L1541'><i><font color='green'>  thus at least double-word aligned.</font></i>
<a name='L1542'><i><font color='green'></font></i>
<a name='L1543'><i><font color='green'>  The P (PINUSE_BIT) bit, stored in the unused low-order bit of the</font></i>
<a name='L1544'><i><font color='green'>  chunk size (which is always a multiple of two words), is an in-use</font></i>
<a name='L1545'><i><font color='green'>  bit for the *previous* chunk.  If that bit is *clear*, then the</font></i>
<a name='L1546'><i><font color='green'>  word before the current chunk size contains the previous chunk</font></i>
<a name='L1547'><i><font color='green'>  size, and can be used to find the front of the previous chunk.</font></i>
<a name='L1548'><i><font color='green'>  The very first chunk allocated always has this bit set, preventing</font></i>
<a name='L1549'><i><font color='green'>  access to non-existent (or non-owned) memory. If pinuse is set for</font></i>
<a name='L1550'><i><font color='green'>  any given chunk, then you CANNOT determine the size of the</font></i>
<a name='L1551'><i><font color='green'>  previous chunk, and might even get a memory addressing fault when</font></i>
<a name='L1552'><i><font color='green'>  trying to do so.</font></i>
<a name='L1553'><i><font color='green'></font></i>
<a name='L1554'><i><font color='green'>  The C (CINUSE_BIT) bit, stored in the unused second-lowest bit of</font></i>
<a name='L1555'><i><font color='green'>  the chunk size redundantly records whether the current chunk is</font></i>
<a name='L1556'><i><font color='green'>  inuse. This redundancy enables usage checks within free and realloc,</font></i>
<a name='L1557'><i><font color='green'>  and reduces indirection when freeing and consolidating chunks.</font></i>
<a name='L1558'><i><font color='green'></font></i>
<a name='L1559'><i><font color='green'>  Each freshly allocated chunk must have both cinuse and pinuse set.</font></i>
<a name='L1560'><i><font color='green'>  That is, each allocated chunk borders either a previously allocated</font></i>
<a name='L1561'><i><font color='green'>  and still in-use chunk, or the base of its memory arena. This is</font></i>
<a name='L1562'><i><font color='green'>  ensured by making all allocations from the the `lowest' part of any</font></i>
<a name='L1563'><i><font color='green'>  found chunk.  Further, no free chunk physically borders another one,</font></i>
<a name='L1564'><i><font color='green'>  so each free chunk is known to be preceded and followed by either</font></i>
<a name='L1565'><i><font color='green'>  inuse chunks or the ends of memory.</font></i>
<a name='L1566'><i><font color='green'></font></i>
<a name='L1567'><i><font color='green'>  Note that the `foot' of the current chunk is actually represented</font></i>
<a name='L1568'><i><font color='green'>  as the prev_foot of the NEXT chunk. This makes it easier to</font></i>
<a name='L1569'><i><font color='green'>  deal with alignments etc but can be very confusing when trying</font></i>
<a name='L1570'><i><font color='green'>  to extend or adapt this code.</font></i>
<a name='L1571'><i><font color='green'></font></i>
<a name='L1572'><i><font color='green'>  The exceptions to all this are</font></i>
<a name='L1573'><i><font color='green'></font></i>
<a name='L1574'><i><font color='green'>     1. The special chunk `top' is the top-most available chunk (i.e.,</font></i>
<a name='L1575'><i><font color='green'>        the one bordering the end of available memory). It is treated</font></i>
<a name='L1576'><i><font color='green'>        specially.  Top is never included in any bin, is used only if</font></i>
<a name='L1577'><i><font color='green'>        no other chunk is available, and is released back to the</font></i>
<a name='L1578'><i><font color='green'>        system if it is very large (see M_TRIM_THRESHOLD).  In effect,</font></i>
<a name='L1579'><i><font color='green'>        the top chunk is treated as larger (and thus less well</font></i>
<a name='L1580'><i><font color='green'>        fitting) than any other available chunk.  The top chunk</font></i>
<a name='L1581'><i><font color='green'>        doesn't update its trailing size field since there is no next</font></i>
<a name='L1582'><i><font color='green'>        contiguous chunk that would have to index off it. However,</font></i>
<a name='L1583'><i><font color='green'>        space is still allocated for it (TOP_FOOT_SIZE) to enable</font></i>
<a name='L1584'><i><font color='green'>        separation or merging when space is extended.</font></i>
<a name='L1585'><i><font color='green'></font></i>
<a name='L1586'><i><font color='green'>     3. Chunks allocated via mmap, which have the lowest-order bit</font></i>
<a name='L1587'><i><font color='green'>        (IS_MMAPPED_BIT) set in their prev_foot fields, and do not set</font></i>
<a name='L1588'><i><font color='green'>        PINUSE_BIT in their head fields.  Because they are allocated</font></i>
<a name='L1589'><i><font color='green'>        one-by-one, each must carry its own prev_foot field, which is</font></i>
<a name='L1590'><i><font color='green'>        also used to hold the offset this chunk has within its mmapped</font></i>
<a name='L1591'><i><font color='green'>        region, which is needed to preserve alignment. Each mmapped</font></i>
<a name='L1592'><i><font color='green'>        chunk is trailed by the first two fields of a fake next-chunk</font></i>
<a name='L1593'><i><font color='green'>        for sake of usage checks.</font></i>
<a name='L1594'><i><font color='green'></font></i>
<a name='L1595'><i><font color='green'>*/</font></i>
<a name='L1596'>
<a name='L1597'><b>struct</b> <a href='../R/8862.html' title='Multiple refered from 5 places.'>malloc_chunk</a> <font color='red'>{</font>
<a name='L1598'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>               prev_foot;  <i><font color='green'>/* Size of previous chunk (if free).  */</font></i>
<a name='L1599'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>               head;       <i><font color='green'>/* Size and inuse bits. */</font></i>
<a name='L1600'>  <b>struct</b> <a href='../S/2317.html#L1597' title='Defined at 1597 in Modules/_ctypes/libffi/src/dlmalloc.c.'>malloc_chunk</a>* fd;         <i><font color='green'>/* double links -- used only if free. */</font></i>
<a name='L1601'>  <b>struct</b> <a href='../S/2317.html#L1597' title='Defined at 1597 in Modules/_ctypes/libffi/src/dlmalloc.c.'>malloc_chunk</a>* bk;
<a name='L1602'><font color='red'>}</font>;
<a name='L1603'>
<a name='L1604'><b>typedef</b> <b>struct</b> <a href='../S/2317.html#L1597' title='Defined at 1597 in Modules/_ctypes/libffi/src/dlmalloc.c.'>malloc_chunk</a>  <a href='../S/2317.html#L1613' title='Refered from 1613 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunk</a>;
<a name='L1605'><b>typedef</b> <b>struct</b> <a href='../S/2317.html#L1597' title='Defined at 1597 in Modules/_ctypes/libffi/src/dlmalloc.c.'>malloc_chunk</a>* <a href='../R/8962.html' title='Multiple refered from 86 places.'>mchunkptr</a>;
<a name='L1606'><b>typedef</b> <b>struct</b> <a href='../S/2317.html#L1597' title='Defined at 1597 in Modules/_ctypes/libffi/src/dlmalloc.c.'>malloc_chunk</a>* <a href='../R/10118.html' title='Multiple refered from 4 places.'>sbinptr</a>;  <i><font color='green'>/* The type of bins of chunks */</font></i>
<a name='L1607'><b>typedef</b> <b>unsigned</b> <b>int</b> <a href='../R/6235.html' title='Multiple refered from 24 places.'>bindex_t</a>;         <i><font color='green'>/* Described below */</font></i>
<a name='L1608'><b>typedef</b> <b>unsigned</b> <b>int</b> <a href='../R/6237.html' title='Multiple refered from 12 places.'>binmap_t</a>;         <i><font color='green'>/* Described below */</font></i>
<a name='L1609'><b>typedef</b> <b>unsigned</b> <b>int</b> <a href='../R/7826.html' title='Multiple refered from 7 places.'>flag_t</a>;           <i><font color='green'>/* The type of various bit flag sets */</font></i>
<a name='L1610'>
<a name='L1611'><i><font color='green'>/* ------------------- Chunks sizes and alignments ----------------------- */</font></i>
<a name='L1612'>
<a name='L1613'><font color='darkred'>#define</font> <a href='../R/1899.html' title='Multiple refered from 2 places.'>MCHUNK_SIZE</a>         (<b>sizeof</b>(<a href='../S/2317.html#L1604' title='Defined at 1604 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunk</a>))
<a name='L1614'>
<a name='L1615'><font color='darkred'>#if</font> <a href='../S/2317.html#L491' title='Defined at 491 in Modules/_ctypes/libffi/src/dlmalloc.c.'>FOOTERS</a>
<a name='L1616'><font color='darkred'>#define</font> <a href='../R/511.html' title='Multiple refered from 6 places.'>CHUNK_OVERHEAD</a>      (<a href='../S/2317.html#L1251' title='Defined at 1251 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TWO_SIZE_T_SIZES</a>)
<a name='L1617'><font color='darkred'>#else</font> <i><font color='green'>/* FOOTERS */</font></i>
<a name='L1618'><font color='darkred'>#define</font> <a href='../R/511.html' title='Multiple refered from 6 places.'>CHUNK_OVERHEAD</a>      (<a href='../S/2317.html#L1243' title='Defined at 1243 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_SIZE</a>)
<a name='L1619'><font color='darkred'>#endif</font> <i><font color='green'>/* FOOTERS */</font></i>
<a name='L1620'>
<a name='L1621'><i><font color='green'>/* MMapped chunks need a second word of overhead ... */</font></i>
<a name='L1622'><font color='darkred'>#define</font> <a href='../S/2317.html#L1702' title='Refered from 1702 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MMAP_CHUNK_OVERHEAD</a> (<a href='../S/2317.html#L1251' title='Defined at 1251 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TWO_SIZE_T_SIZES</a>)
<a name='L1623'><i><font color='green'>/* ... and additional padding for fake next-chunk at foot */</font></i>
<a name='L1624'><font color='darkred'>#define</font> <a href='../R/1949.html' title='Multiple refered from 6 places.'>MMAP_FOOT_PAD</a>       (<a href='../S/2317.html#L1252' title='Defined at 1252 in Modules/_ctypes/libffi/src/dlmalloc.c.'>FOUR_SIZE_T_SIZES</a>)
<a name='L1625'>
<a name='L1626'><i><font color='green'>/* The smallest size we can malloc is an aligned minimal chunk */</font></i>
<a name='L1627'><font color='darkred'>#define</font> <a href='../R/1931.html' title='Multiple refered from 27 places.'>MIN_CHUNK_SIZE</a>\
<a name='L1628'>  ((<a href='../S/2317.html#L1613' title='Defined at 1613 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MCHUNK_SIZE</a> + <a href='../S/2317.html#L1257' title='Defined at 1257 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CHUNK_ALIGN_MASK</a>) &amp; ~<a href='../S/2317.html#L1257' title='Defined at 1257 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CHUNK_ALIGN_MASK</a>)
<a name='L1629'>
<a name='L1630'><i><font color='green'>/* conversion from malloc headers to user pointers, and back */</font></i>
<a name='L1631'><font color='darkred'>#define</font> <a href='../R/6651.html' title='Multiple refered from 35 places.'>chunk2mem</a>(p)        ((<b>void</b>*)((<b>char</b>*)(p)       + <a href='../S/2317.html#L1251' title='Defined at 1251 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TWO_SIZE_T_SIZES</a>))
<a name='L1632'><font color='darkred'>#define</font> <a href='../R/8969.html' title='Multiple refered from 16 places.'>mem2chunk</a>(mem)      ((<a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a>)((<b>char</b>*)(mem) - <a href='../S/2317.html#L1251' title='Defined at 1251 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TWO_SIZE_T_SIZES</a>))
<a name='L1633'><i><font color='green'>/* chunk associated with aligned address A */</font></i>
<a name='L1634'><font color='darkred'>#define</font> <a href='../R/5954.html' title='Multiple refered from 7 places.'>align_as_chunk</a>(<a href='../D/1.html' title='Multiple defined in 18 places.'>A</a>)   (<a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a>)((<a href='../D/1.html' title='Multiple defined in 18 places.'>A</a>) + <a href='../S/2317.html#L1263' title='Defined at 1263 in Modules/_ctypes/libffi/src/dlmalloc.c.'>align_offset</a>(<a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(A)))
<a name='L1635'>
<a name='L1636'><i><font color='green'>/* Bounds on request (not chunk) sizes. */</font></i>
<a name='L1637'><font color='darkred'>#define</font> <a href='../R/1878.html' title='Multiple refered from 5 places.'>MAX_REQUEST</a>         ((-<a href='../S/2317.html#L1627' title='Defined at 1627 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MIN_CHUNK_SIZE</a>) &lt;&lt; 2)
<a name='L1638'><font color='darkred'>#define</font> <a href='../R/1939.html' title='Multiple refered from 3 places.'>MIN_REQUEST</a>         (<a href='../S/2317.html#L1627' title='Defined at 1627 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MIN_CHUNK_SIZE</a> - <a href='../D/545.html' title='Multiple defined in 2 places.'>CHUNK_OVERHEAD</a> - <a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a>)
<a name='L1639'>
<a name='L1640'><i><font color='green'>/* pad request bytes into a usable size */</font></i>
<a name='L1641'><font color='darkred'>#define</font> <a href='../R/9441.html' title='Multiple refered from 10 places.'>pad_request</a>(req) \
<a name='L1642'>   (((req) + <a href='../D/545.html' title='Multiple defined in 2 places.'>CHUNK_OVERHEAD</a> + <a href='../S/2317.html#L1257' title='Defined at 1257 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CHUNK_ALIGN_MASK</a>) &amp; ~<a href='../S/2317.html#L1257' title='Defined at 1257 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CHUNK_ALIGN_MASK</a>)
<a name='L1643'>
<a name='L1644'><i><font color='green'>/* pad request, checking for minimum (but not maximum) */</font></i>
<a name='L1645'><font color='darkred'>#define</font> <a href='../R/10021.html' title='Multiple refered from 7 places.'>request2size</a>(req) \
<a name='L1646'>  (((req) &lt; <a href='../S/2317.html#L1638' title='Defined at 1638 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MIN_REQUEST</a>)? <a href='../S/2317.html#L1627' title='Defined at 1627 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MIN_CHUNK_SIZE</a> : <a href='../S/2317.html#L1641' title='Defined at 1641 in Modules/_ctypes/libffi/src/dlmalloc.c.'>pad_request</a>(req))
<a name='L1647'>
<a name='L1648'>
<a name='L1649'><i><font color='green'>/* ------------------ Operations on head and foot fields ----------------- */</font></i>
<a name='L1650'>
<a name='L1651'><i><font color='green'>/*</font></i>
<a name='L1652'><i><font color='green'>  The head field of a chunk is or'ed with PINUSE_BIT when previous</font></i>
<a name='L1653'><i><font color='green'>  adjacent chunk in use, and or'ed with CINUSE_BIT if this chunk is in</font></i>
<a name='L1654'><i><font color='green'>  use. If the chunk was obtained with mmap, the prev_foot field has</font></i>
<a name='L1655'><i><font color='green'>  IS_MMAPPED_BIT set, otherwise holding the offset of the base of the</font></i>
<a name='L1656'><i><font color='green'>  mmapped region to the base of the chunk.</font></i>
<a name='L1657'><i><font color='green'>*/</font></i>
<a name='L1658'>
<a name='L1659'><font color='darkred'>#define</font> <a href='../R/2255.html' title='Multiple refered from 27 places.'>PINUSE_BIT</a>          (<a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a>)
<a name='L1660'><font color='darkred'>#define</font> <a href='../R/520.html' title='Multiple refered from 15 places.'>CINUSE_BIT</a>          (<a href='../S/2317.html#L1250' title='Defined at 1250 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_TWO</a>)
<a name='L1661'><font color='darkred'>#define</font> <a href='../R/1560.html' title='Multiple refered from 5 places.'>INUSE_BITS</a>          (<a href='../S/2317.html#L1659' title='Defined at 1659 in Modules/_ctypes/libffi/src/dlmalloc.c.'>PINUSE_BIT</a>|<a href='../S/2317.html#L1660' title='Defined at 1660 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CINUSE_BIT</a>)
<a name='L1662'>
<a name='L1663'><i><font color='green'>/* Head value for fenceposts */</font></i>
<a name='L1664'><font color='darkred'>#define</font> <a href='../R/1003.html' title='Multiple refered from 11 places.'>FENCEPOST_HEAD</a>      (<a href='../S/2317.html#L1661' title='Defined at 1661 in Modules/_ctypes/libffi/src/dlmalloc.c.'>INUSE_BITS</a>|<a href='../S/2317.html#L1243' title='Defined at 1243 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_SIZE</a>)
<a name='L1665'>
<a name='L1666'><i><font color='green'>/* extraction of fields from head words */</font></i>
<a name='L1667'><font color='darkred'>#define</font> <a href='../R/6655.html' title='Multiple refered from 14 places.'>cinuse</a>(p)           ((p)-&gt;head &amp; <a href='../S/2317.html#L1660' title='Defined at 1660 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CINUSE_BIT</a>)
<a name='L1668'><font color='darkred'>#define</font> <a href='../R/9532.html' title='Multiple refered from 8 places.'>pinuse</a>(p)           ((p)-&gt;head &amp; <a href='../S/2317.html#L1659' title='Defined at 1659 in Modules/_ctypes/libffi/src/dlmalloc.c.'>PINUSE_BIT</a>)
<a name='L1669'><font color='darkred'>#define</font> <a href='../R/6654.html' title='Multiple refered from 56 places.'>chunksize</a>(p)        ((p)-&gt;head &amp; ~(<a href='../S/2317.html#L1661' title='Defined at 1661 in Modules/_ctypes/libffi/src/dlmalloc.c.'>INUSE_BITS</a>))
<a name='L1670'>
<a name='L1671'><font color='darkred'>#define</font> <a href='../S/2317.html#L1695' title='Refered from 1695 in Modules/_ctypes/libffi/src/dlmalloc.c.'>clear_pinuse</a>(p)     ((p)-&gt;head &amp;= ~<a href='../S/2317.html#L1659' title='Defined at 1659 in Modules/_ctypes/libffi/src/dlmalloc.c.'>PINUSE_BIT</a>)
<a name='L1672'><font color='darkred'>#define</font> clear_cinuse(p)     ((p)-&gt;head &amp;= ~<a href='../S/2317.html#L1660' title='Defined at 1660 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CINUSE_BIT</a>)
<a name='L1673'>
<a name='L1674'><i><font color='green'>/* Treat space at ptr +/- offset as a chunk */</font></i>
<a name='L1675'><font color='darkred'>#define</font> <a href='../R/6653.html' title='Multiple refered from 30 places.'>chunk_plus_offset</a>(p, s)  ((<a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a>)(((<b>char</b>*)(p)) + (s)))
<a name='L1676'><font color='darkred'>#define</font> <a href='../R/6652.html' title='Multiple refered from 2 places.'>chunk_minus_offset</a>(p, s) ((<a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a>)(((<b>char</b>*)(p)) - (s)))
<a name='L1677'>
<a name='L1678'><i><font color='green'>/* Ptr to next or previous physical malloc_chunk. */</font></i>
<a name='L1679'><font color='darkred'>#define</font> <a href='../R/9229.html' title='Multiple refered from 8 places.'>next_chunk</a>(p) ((<a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a>)( ((<b>char</b>*)(p)) + ((p)-&gt;head &amp; ~<a href='../S/2317.html#L1661' title='Defined at 1661 in Modules/_ctypes/libffi/src/dlmalloc.c.'>INUSE_BITS</a>)))
<a name='L1680'><font color='darkred'>#define</font> <a href='../S/2317.html#L2593' title='Refered from 2593 in Modules/_ctypes/libffi/src/dlmalloc.c.'>prev_chunk</a>(p) ((<a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a>)( ((<b>char</b>*)(p)) - ((p)-&gt;prev_foot) ))
<a name='L1681'>
<a name='L1682'><i><font color='green'>/* extract next chunk's pinuse bit */</font></i>
<a name='L1683'><font color='darkred'>#define</font> <a href='../R/9230.html' title='Multiple refered from 4 places.'>next_pinuse</a>(p)  ((<a href='../S/2317.html#L1679' title='Defined at 1679 in Modules/_ctypes/libffi/src/dlmalloc.c.'>next_chunk</a>(p)-&gt;head) &amp; <a href='../S/2317.html#L1659' title='Defined at 1659 in Modules/_ctypes/libffi/src/dlmalloc.c.'>PINUSE_BIT</a>)
<a name='L1684'>
<a name='L1685'><i><font color='green'>/* Get/set size at footer */</font></i>
<a name='L1686'><font color='darkred'>#define</font> get_foot(p, s)  (((<a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a>)((<b>char</b>*)(p) + (s)))-&gt;prev_foot)
<a name='L1687'><font color='darkred'>#define</font> <a href='../S/2317.html#L1691' title='Refered from 1691 in Modules/_ctypes/libffi/src/dlmalloc.c.'>set_foot</a>(p, s)  (((<a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a>)((<b>char</b>*)(p) + (s)))-&gt;prev_foot = (s))
<a name='L1688'>
<a name='L1689'><i><font color='green'>/* Set size, pinuse bit, and foot */</font></i>
<a name='L1690'><font color='darkred'>#define</font> <a href='../R/10247.html' title='Multiple refered from 12 places.'>set_size_and_pinuse_of_free_chunk</a>(p, s)\
<a name='L1691'>  ((p)-&gt;head = (s|<a href='../S/2317.html#L1659' title='Defined at 1659 in Modules/_ctypes/libffi/src/dlmalloc.c.'>PINUSE_BIT</a>), <a href='../S/2317.html#L1687' title='Defined at 1687 in Modules/_ctypes/libffi/src/dlmalloc.c.'>set_foot</a>(p, s))
<a name='L1692'>
<a name='L1693'><i><font color='green'>/* Set size, pinuse bit, foot, and clear next pinuse */</font></i>
<a name='L1694'><font color='darkred'>#define</font> <a href='../R/10205.html' title='Multiple refered from 6 places.'>set_free_with_pinuse</a>(p, s, n)\
<a name='L1695'>  (<a href='../S/2317.html#L1671' title='Defined at 1671 in Modules/_ctypes/libffi/src/dlmalloc.c.'>clear_pinuse</a>(n), <a href='../S/2317.html#L1690' title='Defined at 1690 in Modules/_ctypes/libffi/src/dlmalloc.c.'>set_size_and_pinuse_of_free_chunk</a>(p, s))
<a name='L1696'>
<a name='L1697'><font color='darkred'>#define</font> <a href='../R/8505.html' title='Multiple refered from 11 places.'>is_mmapped</a>(p)\
<a name='L1698'>  (!((p)-&gt;head &amp; <a href='../S/2317.html#L1659' title='Defined at 1659 in Modules/_ctypes/libffi/src/dlmalloc.c.'>PINUSE_BIT</a>) &amp;&amp; ((p)-&gt;prev_foot &amp; <a href='../D/1787.html' title='Multiple defined in 2 places.'>IS_MMAPPED_BIT</a>))
<a name='L1699'>
<a name='L1700'><i><font color='green'>/* Get the internal overhead associated with chunk p */</font></i>
<a name='L1701'><font color='darkred'>#define</font> <a href='../R/9436.html' title='Multiple refered from 2 places.'>overhead_for</a>(p)\
<a name='L1702'> (<a href='../S/2317.html#L1697' title='Defined at 1697 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_mmapped</a>(p)? <a href='../S/2317.html#L1622' title='Defined at 1622 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MMAP_CHUNK_OVERHEAD</a> : <a href='../D/545.html' title='Multiple defined in 2 places.'>CHUNK_OVERHEAD</a>)
<a name='L1703'>
<a name='L1704'><i><font color='green'>/* Return true if malloced space is not necessarily cleared */</font></i>
<a name='L1705'><font color='darkred'>#if</font> <a href='../D/2150.html' title='Multiple defined in 2 places.'>MMAP_CLEARS</a>
<a name='L1706'><font color='darkred'>#define</font> <a href='../R/6576.html' title='Multiple refered from 2 places.'>calloc_must_clear</a>(p) (!<a href='../S/2317.html#L1697' title='Defined at 1697 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_mmapped</a>(p))
<a name='L1707'><font color='darkred'>#else</font> <i><font color='green'>/* MMAP_CLEARS */</font></i>
<a name='L1708'><font color='darkred'>#define</font> <a href='../R/6576.html' title='Multiple refered from 2 places.'>calloc_must_clear</a>(p) (1)
<a name='L1709'><font color='darkred'>#endif</font> <i><font color='green'>/* MMAP_CLEARS */</font></i>
<a name='L1710'>
<a name='L1711'><i><font color='green'>/* ---------------------- Overlaid data structures ----------------------- */</font></i>
<a name='L1712'>
<a name='L1713'><i><font color='green'>/*</font></i>
<a name='L1714'><i><font color='green'>  When chunks are not in use, they are treated as nodes of either</font></i>
<a name='L1715'><i><font color='green'>  lists or trees.</font></i>
<a name='L1716'><i><font color='green'></font></i>
<a name='L1717'><i><font color='green'>  "Small"  chunks are stored in circular doubly-linked lists, and look</font></i>
<a name='L1718'><i><font color='green'>  like this:</font></i>
<a name='L1719'><i><font color='green'></font></i>
<a name='L1720'><i><font color='green'>    chunk-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</font></i>
<a name='L1721'><i><font color='green'>            |             Size of previous chunk                            |</font></i>
<a name='L1722'><i><font color='green'>            +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</font></i>
<a name='L1723'><i><font color='green'>    `head:' |             Size of chunk, in bytes                         |P|</font></i>
<a name='L1724'><i><font color='green'>      mem-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</font></i>
<a name='L1725'><i><font color='green'>            |             Forward pointer to next chunk in list             |</font></i>
<a name='L1726'><i><font color='green'>            +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</font></i>
<a name='L1727'><i><font color='green'>            |             Back pointer to previous chunk in list            |</font></i>
<a name='L1728'><i><font color='green'>            +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</font></i>
<a name='L1729'><i><font color='green'>            |             Unused space (may be 0 bytes long)                .</font></i>
<a name='L1730'><i><font color='green'>            .                                                               .</font></i>
<a name='L1731'><i><font color='green'>            .                                                               |</font></i>
<a name='L1732'><i><font color='green'>nextchunk-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</font></i>
<a name='L1733'><i><font color='green'>    `foot:' |             Size of chunk, in bytes                           |</font></i>
<a name='L1734'><i><font color='green'>            +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</font></i>
<a name='L1735'><i><font color='green'></font></i>
<a name='L1736'><i><font color='green'>  Larger chunks are kept in a form of bitwise digital trees (aka</font></i>
<a name='L1737'><i><font color='green'>  tries) keyed on chunksizes.  Because malloc_tree_chunks are only for</font></i>
<a name='L1738'><i><font color='green'>  free chunks greater than 256 bytes, their size doesn't impose any</font></i>
<a name='L1739'><i><font color='green'>  constraints on user chunk sizes.  Each node looks like:</font></i>
<a name='L1740'><i><font color='green'></font></i>
<a name='L1741'><i><font color='green'>    chunk-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</font></i>
<a name='L1742'><i><font color='green'>            |             Size of previous chunk                            |</font></i>
<a name='L1743'><i><font color='green'>            +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</font></i>
<a name='L1744'><i><font color='green'>    `head:' |             Size of chunk, in bytes                         |P|</font></i>
<a name='L1745'><i><font color='green'>      mem-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</font></i>
<a name='L1746'><i><font color='green'>            |             Forward pointer to next chunk of same size        |</font></i>
<a name='L1747'><i><font color='green'>            +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</font></i>
<a name='L1748'><i><font color='green'>            |             Back pointer to previous chunk of same size       |</font></i>
<a name='L1749'><i><font color='green'>            +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</font></i>
<a name='L1750'><i><font color='green'>            |             Pointer to left child (child[0])                  |</font></i>
<a name='L1751'><i><font color='green'>            +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</font></i>
<a name='L1752'><i><font color='green'>            |             Pointer to right child (child[1])                 |</font></i>
<a name='L1753'><i><font color='green'>            +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</font></i>
<a name='L1754'><i><font color='green'>            |             Pointer to parent                                 |</font></i>
<a name='L1755'><i><font color='green'>            +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</font></i>
<a name='L1756'><i><font color='green'>            |             bin index of this chunk                           |</font></i>
<a name='L1757'><i><font color='green'>            +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</font></i>
<a name='L1758'><i><font color='green'>            |             Unused space                                      .</font></i>
<a name='L1759'><i><font color='green'>            .                                                               |</font></i>
<a name='L1760'><i><font color='green'>nextchunk-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</font></i>
<a name='L1761'><i><font color='green'>    `foot:' |             Size of chunk, in bytes                           |</font></i>
<a name='L1762'><i><font color='green'>            +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</font></i>
<a name='L1763'><i><font color='green'></font></i>
<a name='L1764'><i><font color='green'>  Each tree holding treenodes is a tree of unique chunk sizes.  Chunks</font></i>
<a name='L1765'><i><font color='green'>  of the same size are arranged in a circularly-linked list, with only</font></i>
<a name='L1766'><i><font color='green'>  the oldest chunk (the next to be used, in our FIFO ordering)</font></i>
<a name='L1767'><i><font color='green'>  actually in the tree.  (Tree members are distinguished by a non-null</font></i>
<a name='L1768'><i><font color='green'>  parent pointer.)  If a chunk with the same size an an existing node</font></i>
<a name='L1769'><i><font color='green'>  is inserted, it is linked off the existing node using pointers that</font></i>
<a name='L1770'><i><font color='green'>  work in the same way as fd/bk pointers of small chunks.</font></i>
<a name='L1771'><i><font color='green'></font></i>
<a name='L1772'><i><font color='green'>  Each tree contains a power of 2 sized range of chunk sizes (the</font></i>
<a name='L1773'><i><font color='green'>  smallest is 0x100 &lt;= x &lt; 0x180), which is is divided in half at each</font></i>
<a name='L1774'><i><font color='green'>  tree level, with the chunks in the smaller half of the range (0x100</font></i>
<a name='L1775'><i><font color='green'>  &lt;= x &lt; 0x140 for the top nose) in the left subtree and the larger</font></i>
<a name='L1776'><i><font color='green'>  half (0x140 &lt;= x &lt; 0x180) in the right subtree.  This is, of course,</font></i>
<a name='L1777'><i><font color='green'>  done by inspecting individual bits.</font></i>
<a name='L1778'><i><font color='green'></font></i>
<a name='L1779'><i><font color='green'>  Using these rules, each node's left subtree contains all smaller</font></i>
<a name='L1780'><i><font color='green'>  sizes than its right subtree.  However, the node at the root of each</font></i>
<a name='L1781'><i><font color='green'>  subtree has no particular ordering relationship to either.  (The</font></i>
<a name='L1782'><i><font color='green'>  dividing line between the subtree sizes is based on trie relation.)</font></i>
<a name='L1783'><i><font color='green'>  If we remove the last chunk of a given size from the interior of the</font></i>
<a name='L1784'><i><font color='green'>  tree, we need to replace it with a leaf node.  The tree ordering</font></i>
<a name='L1785'><i><font color='green'>  rules permit a node to be replaced by any leaf below it.</font></i>
<a name='L1786'><i><font color='green'></font></i>
<a name='L1787'><i><font color='green'>  The smallest chunk in a tree (a common operation in a best-fit</font></i>
<a name='L1788'><i><font color='green'>  allocator) can be found by walking a path to the leftmost leaf in</font></i>
<a name='L1789'><i><font color='green'>  the tree.  Unlike a usual binary tree, where we follow left child</font></i>
<a name='L1790'><i><font color='green'>  pointers until we reach a null, here we follow the right child</font></i>
<a name='L1791'><i><font color='green'>  pointer any time the left one is null, until we reach a leaf with</font></i>
<a name='L1792'><i><font color='green'>  both child pointers null. The smallest chunk in the tree will be</font></i>
<a name='L1793'><i><font color='green'>  somewhere along that path.</font></i>
<a name='L1794'><i><font color='green'></font></i>
<a name='L1795'><i><font color='green'>  The worst case number of steps to add, find, or remove a node is</font></i>
<a name='L1796'><i><font color='green'>  bounded by the number of bits differentiating chunks within</font></i>
<a name='L1797'><i><font color='green'>  bins. Under current bin calculations, this ranges from 6 up to 21</font></i>
<a name='L1798'><i><font color='green'>  (for 32 bit sizes) or up to 53 (for 64 bit sizes). The typical case</font></i>
<a name='L1799'><i><font color='green'>  is of course much better.</font></i>
<a name='L1800'><i><font color='green'>*/</font></i>
<a name='L1801'>
<a name='L1802'><b>struct</b> <a href='../R/8867.html' title='Multiple refered from 7 places.'>malloc_tree_chunk</a> <font color='red'>{</font>
<a name='L1803'>  <i><font color='green'>/* The first four fields must be compatible with malloc_chunk */</font></i>
<a name='L1804'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>                    prev_foot;
<a name='L1805'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>                    head;
<a name='L1806'>  <b>struct</b> <a href='../S/2317.html#L1802' title='Defined at 1802 in Modules/_ctypes/libffi/src/dlmalloc.c.'>malloc_tree_chunk</a>* fd;
<a name='L1807'>  <b>struct</b> <a href='../S/2317.html#L1802' title='Defined at 1802 in Modules/_ctypes/libffi/src/dlmalloc.c.'>malloc_tree_chunk</a>* bk;
<a name='L1808'>
<a name='L1809'>  <b>struct</b> <a href='../S/2317.html#L1802' title='Defined at 1802 in Modules/_ctypes/libffi/src/dlmalloc.c.'>malloc_tree_chunk</a>* child[2];
<a name='L1810'>  <b>struct</b> <a href='../S/2317.html#L1802' title='Defined at 1802 in Modules/_ctypes/libffi/src/dlmalloc.c.'>malloc_tree_chunk</a>* parent;
<a name='L1811'>  <a href='../S/2317.html#L1607' title='Defined at 1607 in Modules/_ctypes/libffi/src/dlmalloc.c.'>bindex_t</a>                  index;
<a name='L1812'><font color='red'>}</font>;
<a name='L1813'>
<a name='L1814'><b>typedef</b> <b>struct</b> <a href='../S/2317.html#L1802' title='Defined at 1802 in Modules/_ctypes/libffi/src/dlmalloc.c.'>malloc_tree_chunk</a>  tchunk;
<a name='L1815'><b>typedef</b> <b>struct</b> <a href='../S/2317.html#L1802' title='Defined at 1802 in Modules/_ctypes/libffi/src/dlmalloc.c.'>malloc_tree_chunk</a>* <a href='../R/10741.html' title='Multiple refered from 24 places.'>tchunkptr</a>;
<a name='L1816'><b>typedef</b> <b>struct</b> <a href='../S/2317.html#L1802' title='Defined at 1802 in Modules/_ctypes/libffi/src/dlmalloc.c.'>malloc_tree_chunk</a>* <a href='../R/10740.html' title='Multiple refered from 5 places.'>tbinptr</a>; <i><font color='green'>/* The type of bins of trees */</font></i>
<a name='L1817'>
<a name='L1818'><i><font color='green'>/* A little helper macro for trees */</font></i>
<a name='L1819'><font color='darkred'>#define</font> <a href='../R/8627.html' title='Multiple refered from 2 places.'>leftmost_child</a>(t) ((t)-&gt;child[0] != 0? (t)-&gt;child[0] : (t)-&gt;child[1])
<a name='L1820'>
<a name='L1821'><i><font color='green'>/* ----------------------------- Segments -------------------------------- */</font></i>
<a name='L1822'>
<a name='L1823'><i><font color='green'>/*</font></i>
<a name='L1824'><i><font color='green'>  Each malloc space may include non-contiguous segments, held in a</font></i>
<a name='L1825'><i><font color='green'>  list headed by an embedded malloc_segment record representing the</font></i>
<a name='L1826'><i><font color='green'>  top-most space. Segments also include flags holding properties of</font></i>
<a name='L1827'><i><font color='green'>  the space. Large chunks that are directly allocated by mmap are not</font></i>
<a name='L1828'><i><font color='green'>  included in this list. They are instead independently created and</font></i>
<a name='L1829'><i><font color='green'>  destroyed without otherwise keeping track of them.</font></i>
<a name='L1830'><i><font color='green'></font></i>
<a name='L1831'><i><font color='green'>  Segment management mainly comes into play for spaces allocated by</font></i>
<a name='L1832'><i><font color='green'>  MMAP.  Any call to MMAP might or might not return memory that is</font></i>
<a name='L1833'><i><font color='green'>  adjacent to an existing segment.  MORECORE normally contiguously</font></i>
<a name='L1834'><i><font color='green'>  extends the current space, so this space is almost always adjacent,</font></i>
<a name='L1835'><i><font color='green'>  which is simpler and faster to deal with. (This is why MORECORE is</font></i>
<a name='L1836'><i><font color='green'>  used preferentially to MMAP when both are available -- see</font></i>
<a name='L1837'><i><font color='green'>  sys_alloc.)  When allocating using MMAP, we don't use any of the</font></i>
<a name='L1838'><i><font color='green'>  hinting mechanisms (inconsistently) supported in various</font></i>
<a name='L1839'><i><font color='green'>  implementations of unix mmap, or distinguish reserving from</font></i>
<a name='L1840'><i><font color='green'>  committing memory. Instead, we just ask for space, and exploit</font></i>
<a name='L1841'><i><font color='green'>  contiguity when we get it.  It is probably possible to do</font></i>
<a name='L1842'><i><font color='green'>  better than this on some systems, but no general scheme seems</font></i>
<a name='L1843'><i><font color='green'>  to be significantly better.</font></i>
<a name='L1844'><i><font color='green'></font></i>
<a name='L1845'><i><font color='green'>  Management entails a simpler variant of the consolidation scheme</font></i>
<a name='L1846'><i><font color='green'>  used for chunks to reduce fragmentation -- new adjacent memory is</font></i>
<a name='L1847'><i><font color='green'>  normally prepended or appended to an existing segment. However,</font></i>
<a name='L1848'><i><font color='green'>  there are limitations compared to chunk consolidation that mostly</font></i>
<a name='L1849'><i><font color='green'>  reflect the fact that segment processing is relatively infrequent</font></i>
<a name='L1850'><i><font color='green'>  (occurring only when getting memory from system) and that we</font></i>
<a name='L1851'><i><font color='green'>  don't expect to have huge numbers of segments:</font></i>
<a name='L1852'><i><font color='green'></font></i>
<a name='L1853'><i><font color='green'>  * Segments are not indexed, so traversal requires linear scans.  (It</font></i>
<a name='L1854'><i><font color='green'>    would be possible to index these, but is not worth the extra</font></i>
<a name='L1855'><i><font color='green'>    overhead and complexity for most programs on most platforms.)</font></i>
<a name='L1856'><i><font color='green'>  * New segments are only appended to old ones when holding top-most</font></i>
<a name='L1857'><i><font color='green'>    memory; if they cannot be prepended to others, they are held in</font></i>
<a name='L1858'><i><font color='green'>    different segments.</font></i>
<a name='L1859'><i><font color='green'></font></i>
<a name='L1860'><i><font color='green'>  Except for the top-most segment of an mstate, each segment record</font></i>
<a name='L1861'><i><font color='green'>  is kept at the tail of its segment. Segments are added by pushing</font></i>
<a name='L1862'><i><font color='green'>  segment records onto the list headed by &amp;mstate.seg for the</font></i>
<a name='L1863'><i><font color='green'>  containing mstate.</font></i>
<a name='L1864'><i><font color='green'></font></i>
<a name='L1865'><i><font color='green'>  Segment flags control allocation/merge/deallocation policies:</font></i>
<a name='L1866'><i><font color='green'>  * If EXTERN_BIT set, then we did not allocate this segment,</font></i>
<a name='L1867'><i><font color='green'>    and so should not try to deallocate or merge with others.</font></i>
<a name='L1868'><i><font color='green'>    (This currently holds only for the initial segment passed</font></i>
<a name='L1869'><i><font color='green'>    into create_mspace_with_base.)</font></i>
<a name='L1870'><i><font color='green'>  * If IS_MMAPPED_BIT set, the segment may be merged with</font></i>
<a name='L1871'><i><font color='green'>    other surrounding mmapped segments and trimmed/de-allocated</font></i>
<a name='L1872'><i><font color='green'>    using munmap.</font></i>
<a name='L1873'><i><font color='green'>  * If neither bit is set, then the segment was obtained using</font></i>
<a name='L1874'><i><font color='green'>    MORECORE so can be merged with surrounding MORECORE'd segments</font></i>
<a name='L1875'><i><font color='green'>    and deallocated/trimmed using MORECORE with negative arguments.</font></i>
<a name='L1876'><i><font color='green'>*/</font></i>
<a name='L1877'>
<a name='L1878'><b>struct</b> <a href='../R/8865.html' title='Multiple refered from 5 places.'>malloc_segment</a> <font color='red'>{</font>
<a name='L1879'>  <b>char</b>*        base;             <i><font color='green'>/* base address */</font></i>
<a name='L1880'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>       size;             <i><font color='green'>/* allocated size */</font></i>
<a name='L1881'>  <b>struct</b> <a href='../S/2317.html#L1878' title='Defined at 1878 in Modules/_ctypes/libffi/src/dlmalloc.c.'>malloc_segment</a>* next;   <i><font color='green'>/* ptr to next segment */</font></i>
<a name='L1882'><font color='darkred'>#if</font> <a href='../D/1156.html' title='Multiple defined in 2 places.'>FFI_MMAP_EXEC_WRIT</a>
<a name='L1883'>  <i><font color='green'>/* The mmap magic is supposed to store the address of the executable</font></i>
<a name='L1884'><i><font color='green'>     segment at the very end of the requested block.  */</font></i>
<a name='L1885'>
<a name='L1886'><font color='darkred'># define</font> <a href='../R/9065.html' title='Multiple refered from 5 places.'>mmap_exec_offset</a>(<a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a>,s) (*(<a href='../S/2773.html#L148' title='Defined at 148 in Modules/zlib/zutil.h.'>ptrdiff_t</a>*)((b)+(s)-<b>sizeof</b>(<a href='../S/2773.html#L148' title='Defined at 148 in Modules/zlib/zutil.h.'>ptrdiff_t</a>)))
<a name='L1887'>
<a name='L1888'>  <i><font color='green'>/* We can only merge segments if their corresponding executable</font></i>
<a name='L1889'><i><font color='green'>     segments are at identical offsets.  */</font></i>
<a name='L1890'><font color='darkred'># define</font> <a href='../R/6641.html' title='Multiple refered from 2 places.'>check_segment_merge</a>(S,b,s) \
<a name='L1891'>  (<a href='../S/2317.html#L1886' title='Defined at 1886 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mmap_exec_offset</a>((<a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a>),(s)) == (<a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>)-&gt;exec_offset)
<a name='L1892'>
<a name='L1893'><font color='darkred'># define</font> <a href='../R/5922.html' title='Multiple refered from 4 places.'>add_segment_exec_offset</a>(p,<a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>) ((<b>char</b>*)(p) + (S)-&gt;exec_offset)
<a name='L1894'><font color='darkred'># define</font> <a href='../S/2312.html#L561' title='Refered from 561 in Modules/_ctypes/libffi/src/closures.c.'>sub_segment_exec_offset</a>(p,<a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>) ((<b>char</b>*)(p) - (S)-&gt;exec_offset)
<a name='L1895'>
<a name='L1896'>  <i><font color='green'>/* The removal of sflags only works with HAVE_MORECORE == 0.  */</font></i>
<a name='L1897'>
<a name='L1898'><font color='darkred'># define</font> <a href='../R/8092.html' title='Multiple refered from 5 places.'>get_segment_flags</a>(S)   (<a href='../D/1787.html' title='Multiple defined in 2 places.'>IS_MMAPPED_BIT</a>)
<a name='L1899'><font color='darkred'># define</font> <a href='../R/10246.html' title='Multiple refered from 4 places.'>set_segment_flags</a>(S,v) \
<a name='L1900'>  (((v) != <a href='../D/1787.html' title='Multiple defined in 2 places.'>IS_MMAPPED_BIT</a>) ? (<a href='../S/2317.html#L494' title='Defined at 494 in Modules/_ctypes/libffi/src/dlmalloc.c.'>ABORT</a>, (v)) :                             \
<a name='L1901'>   (((<a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>)-&gt;exec_offset =                                                 \
<a name='L1902'>     <a href='../S/2317.html#L1886' title='Defined at 1886 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mmap_exec_offset</a>((<a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>)-&gt;base, (<a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>)-&gt;size)),                           \
<a name='L1903'>    (<a href='../S/2317.html#L1886' title='Defined at 1886 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mmap_exec_offset</a>((<a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>)-&gt;base + (<a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>)-&gt;exec_offset, (<a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>)-&gt;size) !=       \
<a name='L1904'>     (<a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>)-&gt;exec_offset) ? (<a href='../S/2317.html#L494' title='Defined at 494 in Modules/_ctypes/libffi/src/dlmalloc.c.'>ABORT</a>, (v)) :                                 \
<a name='L1905'>   (<a href='../S/2317.html#L1886' title='Defined at 1886 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mmap_exec_offset</a>((<a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>)-&gt;base, (<a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>)-&gt;size) = 0), (v)))
<a name='L1906'>
<a name='L1907'>  <i><font color='green'>/* We use an offset here, instead of a pointer, because then, when</font></i>
<a name='L1908'><i><font color='green'>     base changes, we don't have to modify this.  On architectures</font></i>
<a name='L1909'><i><font color='green'>     with segmented addresses, this might not work.  */</font></i>
<a name='L1910'>  <a href='../S/2773.html#L148' title='Defined at 148 in Modules/zlib/zutil.h.'>ptrdiff_t</a>    exec_offset;
<a name='L1911'><font color='darkred'>#else</font>
<a name='L1912'>
<a name='L1913'><font color='darkred'># define</font> <a href='../R/8092.html' title='Multiple refered from 5 places.'>get_segment_flags</a>(<a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>)   ((S)-&gt;sflags)
<a name='L1914'><font color='darkred'># define</font> <a href='../R/10246.html' title='Multiple refered from 4 places.'>set_segment_flags</a>(<a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>,v) ((S)-&gt;sflags = (v))
<a name='L1915'><font color='darkred'># define</font> <a href='../R/6641.html' title='Multiple refered from 2 places.'>check_segment_merge</a>(S,b,s) (1)
<a name='L1916'>
<a name='L1917'>  <a href='../S/2317.html#L1609' title='Defined at 1609 in Modules/_ctypes/libffi/src/dlmalloc.c.'>flag_t</a>       sflags;           <i><font color='green'>/* mmap and extern flag */</font></i>
<a name='L1918'><font color='darkred'>#endif</font>
<a name='L1919'><font color='red'>}</font>;
<a name='L1920'>
<a name='L1921'><font color='darkred'>#define</font> <a href='../R/8506.html' title='Multiple refered from 2 places.'>is_mmapped_segment</a>(<a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>)  (<a href='../D/8894.html' title='Multiple defined in 2 places.'>get_segment_flags</a>(S) &amp; <a href='../D/1787.html' title='Multiple defined in 2 places.'>IS_MMAPPED_BIT</a>)
<a name='L1922'><font color='darkred'>#define</font> <a href='../R/8499.html' title='Multiple refered from 4 places.'>is_extern_segment</a>(<a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>)   (<a href='../D/8894.html' title='Multiple defined in 2 places.'>get_segment_flags</a>(S) &amp; <a href='../S/2317.html#L1369' title='Defined at 1369 in Modules/_ctypes/libffi/src/dlmalloc.c.'>EXTERN_BIT</a>)
<a name='L1923'>
<a name='L1924'><b>typedef</b> <b>struct</b> <a href='../S/2317.html#L1878' title='Defined at 1878 in Modules/_ctypes/libffi/src/dlmalloc.c.'>malloc_segment</a>  <a href='../S/2317.html#L2030' title='Refered from 2030 in Modules/_ctypes/libffi/src/dlmalloc.c.'>msegment</a>;
<a name='L1925'><b>typedef</b> <b>struct</b> <a href='../S/2317.html#L1878' title='Defined at 1878 in Modules/_ctypes/libffi/src/dlmalloc.c.'>malloc_segment</a>* <a href='../R/9111.html' title='Multiple refered from 21 places.'>msegmentptr</a>;
<a name='L1926'>
<a name='L1927'><i><font color='green'>/* ---------------------------- malloc_state ----------------------------- */</font></i>
<a name='L1928'>
<a name='L1929'><i><font color='green'>/*</font></i>
<a name='L1930'><i><font color='green'>   A malloc_state holds all of the bookkeeping for a space.</font></i>
<a name='L1931'><i><font color='green'>   The main fields are:</font></i>
<a name='L1932'><i><font color='green'></font></i>
<a name='L1933'><i><font color='green'>  Top</font></i>
<a name='L1934'><i><font color='green'>    The topmost chunk of the currently active segment. Its size is</font></i>
<a name='L1935'><i><font color='green'>    cached in topsize.  The actual size of topmost space is</font></i>
<a name='L1936'><i><font color='green'>    topsize+TOP_FOOT_SIZE, which includes space reserved for adding</font></i>
<a name='L1937'><i><font color='green'>    fenceposts and segment records if necessary when getting more</font></i>
<a name='L1938'><i><font color='green'>    space from the system.  The size at which to autotrim top is</font></i>
<a name='L1939'><i><font color='green'>    cached from mparams in trim_check, except that it is disabled if</font></i>
<a name='L1940'><i><font color='green'>    an autotrim fails.</font></i>
<a name='L1941'><i><font color='green'></font></i>
<a name='L1942'><i><font color='green'>  Designated victim (dv)</font></i>
<a name='L1943'><i><font color='green'>    This is the preferred chunk for servicing small requests that</font></i>
<a name='L1944'><i><font color='green'>    don't have exact fits.  It is normally the chunk split off most</font></i>
<a name='L1945'><i><font color='green'>    recently to service another small request.  Its size is cached in</font></i>
<a name='L1946'><i><font color='green'>    dvsize. The link fields of this chunk are not maintained since it</font></i>
<a name='L1947'><i><font color='green'>    is not kept in a bin.</font></i>
<a name='L1948'><i><font color='green'></font></i>
<a name='L1949'><i><font color='green'>  SmallBins</font></i>
<a name='L1950'><i><font color='green'>    An array of bin headers for free chunks.  These bins hold chunks</font></i>
<a name='L1951'><i><font color='green'>    with sizes less than MIN_LARGE_SIZE bytes. Each bin contains</font></i>
<a name='L1952'><i><font color='green'>    chunks of all the same size, spaced 8 bytes apart.  To simplify</font></i>
<a name='L1953'><i><font color='green'>    use in double-linked lists, each bin header acts as a malloc_chunk</font></i>
<a name='L1954'><i><font color='green'>    pointing to the real first node, if it exists (else pointing to</font></i>
<a name='L1955'><i><font color='green'>    itself).  This avoids special-casing for headers.  But to avoid</font></i>
<a name='L1956'><i><font color='green'>    waste, we allocate only the fd/bk pointers of bins, and then use</font></i>
<a name='L1957'><i><font color='green'>    repositioning tricks to treat these as the fields of a chunk.</font></i>
<a name='L1958'><i><font color='green'></font></i>
<a name='L1959'><i><font color='green'>  TreeBins</font></i>
<a name='L1960'><i><font color='green'>    Treebins are pointers to the roots of trees holding a range of</font></i>
<a name='L1961'><i><font color='green'>    sizes. There are 2 equally spaced treebins for each power of two</font></i>
<a name='L1962'><i><font color='green'>    from TREE_SHIFT to TREE_SHIFT+16. The last bin holds anything</font></i>
<a name='L1963'><i><font color='green'>    larger.</font></i>
<a name='L1964'><i><font color='green'></font></i>
<a name='L1965'><i><font color='green'>  Bin maps</font></i>
<a name='L1966'><i><font color='green'>    There is one bit map for small bins ("smallmap") and one for</font></i>
<a name='L1967'><i><font color='green'>    treebins ("treemap).  Each bin sets its bit when non-empty, and</font></i>
<a name='L1968'><i><font color='green'>    clears the bit when empty.  Bit operations are then used to avoid</font></i>
<a name='L1969'><i><font color='green'>    bin-by-bin searching -- nearly all "search" is done without ever</font></i>
<a name='L1970'><i><font color='green'>    looking at bins that won't be selected.  The bit maps</font></i>
<a name='L1971'><i><font color='green'>    conservatively use 32 bits per map word, even if on 64bit system.</font></i>
<a name='L1972'><i><font color='green'>    For a good description of some of the bit-based techniques used</font></i>
<a name='L1973'><i><font color='green'>    here, see Henry S. Warren Jr's book "Hacker's Delight" (and</font></i>
<a name='L1974'><i><font color='green'>    supplement at http://hackersdelight.org/). Many of these are</font></i>
<a name='L1975'><i><font color='green'>    intended to reduce the branchiness of paths through malloc etc, as</font></i>
<a name='L1976'><i><font color='green'>    well as to reduce the number of memory locations read or written.</font></i>
<a name='L1977'><i><font color='green'></font></i>
<a name='L1978'><i><font color='green'>  Segments</font></i>
<a name='L1979'><i><font color='green'>    A list of segments headed by an embedded malloc_segment record</font></i>
<a name='L1980'><i><font color='green'>    representing the initial space.</font></i>
<a name='L1981'><i><font color='green'></font></i>
<a name='L1982'><i><font color='green'>  Address check support</font></i>
<a name='L1983'><i><font color='green'>    The least_addr field is the least address ever obtained from</font></i>
<a name='L1984'><i><font color='green'>    MORECORE or MMAP. Attempted frees and reallocs of any address less</font></i>
<a name='L1985'><i><font color='green'>    than this are trapped (unless INSECURE is defined).</font></i>
<a name='L1986'><i><font color='green'></font></i>
<a name='L1987'><i><font color='green'>  Magic tag</font></i>
<a name='L1988'><i><font color='green'>    A cross-check field that should always hold same value as mparams.magic.</font></i>
<a name='L1989'><i><font color='green'></font></i>
<a name='L1990'><i><font color='green'>  Flags</font></i>
<a name='L1991'><i><font color='green'>    Bits recording whether to use MMAP, locks, or contiguous MORECORE</font></i>
<a name='L1992'><i><font color='green'></font></i>
<a name='L1993'><i><font color='green'>  Statistics</font></i>
<a name='L1994'><i><font color='green'>    Each space keeps track of current and maximum system memory</font></i>
<a name='L1995'><i><font color='green'>    obtained via MORECORE or MMAP.</font></i>
<a name='L1996'><i><font color='green'></font></i>
<a name='L1997'><i><font color='green'>  Locking</font></i>
<a name='L1998'><i><font color='green'>    If USE_LOCKS is defined, the "mutex" lock is acquired and released</font></i>
<a name='L1999'><i><font color='green'>    around every public call using this mspace.</font></i>
<a name='L2000'><i><font color='green'>*/</font></i>
<a name='L2001'>
<a name='L2002'><i><font color='green'>/* Bin types, widths and sizes */</font></i>
<a name='L2003'><font color='darkred'>#define</font> <a href='../R/2121.html' title='Multiple refered from 4 places.'>NSMALLBINS</a>        (32U)
<a name='L2004'><font color='darkred'>#define</font> <a href='../R/2127.html' title='Multiple refered from 8 places.'>NTREEBINS</a>         (32U)
<a name='L2005'><font color='darkred'>#define</font> <a href='../R/4193.html' title='Multiple refered from 4 places.'>SMALLBIN_SHIFT</a>    (3U)
<a name='L2006'><font color='darkred'>#define</font> SMALLBIN_WIDTH    (<a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a> &lt;&lt; <a href='../S/2317.html#L2005' title='Defined at 2005 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SMALLBIN_SHIFT</a>)
<a name='L2007'><font color='darkred'>#define</font> <a href='../R/4565.html' title='Multiple refered from 9 places.'>TREEBIN_SHIFT</a>     (8U)
<a name='L2008'><font color='darkred'>#define</font> <a href='../R/1935.html' title='Multiple refered from 2 places.'>MIN_LARGE_SIZE</a>    (<a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a> &lt;&lt; <a href='../S/2317.html#L2007' title='Defined at 2007 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TREEBIN_SHIFT</a>)
<a name='L2009'><font color='darkred'>#define</font> <a href='../S/2317.html#L2010' title='Refered from 2010 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MAX_SMALL_SIZE</a>    (<a href='../S/2317.html#L2008' title='Defined at 2008 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MIN_LARGE_SIZE</a> - <a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a>)
<a name='L2010'><font color='darkred'>#define</font> <a href='../R/1882.html' title='Multiple refered from 2 places.'>MAX_SMALL_REQUEST</a> (<a href='../S/2317.html#L2009' title='Defined at 2009 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MAX_SMALL_SIZE</a> - <a href='../S/2317.html#L1257' title='Defined at 1257 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CHUNK_ALIGN_MASK</a> - <a href='../D/545.html' title='Multiple defined in 2 places.'>CHUNK_OVERHEAD</a>)
<a name='L2011'>
<a name='L2012'><b>struct</b> <a href='../R/8866.html' title='Multiple refered from 5 places.'>malloc_state</a> <font color='red'>{</font>
<a name='L2013'>  <a href='../S/2317.html#L1608' title='Defined at 1608 in Modules/_ctypes/libffi/src/dlmalloc.c.'>binmap_t</a>   smallmap;
<a name='L2014'>  <a href='../S/2317.html#L1608' title='Defined at 1608 in Modules/_ctypes/libffi/src/dlmalloc.c.'>binmap_t</a>   treemap;
<a name='L2015'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>     dvsize;
<a name='L2016'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>     topsize;
<a name='L2017'>  <b>char</b>*      least_addr;
<a name='L2018'>  <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a>  dv;
<a name='L2019'>  <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a>  top;
<a name='L2020'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>     trim_check;
<a name='L2021'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>     magic;
<a name='L2022'>  <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a>  smallbins[(<a href='../S/2317.html#L2003' title='Defined at 2003 in Modules/_ctypes/libffi/src/dlmalloc.c.'>NSMALLBINS</a>+1)*2];
<a name='L2023'>  <a href='../S/2317.html#L1816' title='Defined at 1816 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tbinptr</a>    treebins[<a href='../S/2317.html#L2004' title='Defined at 2004 in Modules/_ctypes/libffi/src/dlmalloc.c.'>NTREEBINS</a>];
<a name='L2024'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>     footprint;
<a name='L2025'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>     max_footprint;
<a name='L2026'>  <a href='../S/2317.html#L1609' title='Defined at 1609 in Modules/_ctypes/libffi/src/dlmalloc.c.'>flag_t</a>     mflags;
<a name='L2027'><font color='darkred'>#if</font> <a href='../D/5395.html' title='Multiple defined in 2 places.'>USE_LOCKS</a>
<a name='L2028'>  <a href='../D/2148.html' title='Multiple defined in 2 places.'>MLOCK_T</a>    mutex;     <i><font color='green'>/* locate lock among fields that rarely change */</font></i>
<a name='L2029'><font color='darkred'>#endif</font> <i><font color='green'>/* USE_LOCKS */</font></i>
<a name='L2030'>  <a href='../S/2317.html#L1924' title='Defined at 1924 in Modules/_ctypes/libffi/src/dlmalloc.c.'>msegment</a>   seg;
<a name='L2031'><font color='red'>}</font>;
<a name='L2032'>
<a name='L2033'><b>typedef</b> <b>struct</b> <a href='../S/2317.html#L2012' title='Defined at 2012 in Modules/_ctypes/libffi/src/dlmalloc.c.'>malloc_state</a>*    <a href='../R/9133.html' title='Multiple refered from 23 places.'>mstate</a>;
<a name='L2034'>
<a name='L2035'><i><font color='green'>/* ------------- Global malloc_state and malloc_params ------------------- */</font></i>
<a name='L2036'>
<a name='L2037'><i><font color='green'>/*</font></i>
<a name='L2038'><i><font color='green'>  malloc_params holds global properties, including those that can be</font></i>
<a name='L2039'><i><font color='green'>  dynamically set using mallopt. There is a single instance, mparams,</font></i>
<a name='L2040'><i><font color='green'>  initialized in init_mparams.</font></i>
<a name='L2041'><i><font color='green'>*/</font></i>
<a name='L2042'>
<a name='L2043'><b>struct</b> <a href='../S/2317.html#L2052' title='Refered from 2052 in Modules/_ctypes/libffi/src/dlmalloc.c.'>malloc_params</a> <font color='red'>{</font>
<a name='L2044'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> magic;
<a name='L2045'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> page_size;
<a name='L2046'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> granularity;
<a name='L2047'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> mmap_threshold;
<a name='L2048'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> trim_threshold;
<a name='L2049'>  <a href='../S/2317.html#L1609' title='Defined at 1609 in Modules/_ctypes/libffi/src/dlmalloc.c.'>flag_t</a> default_mflags;
<a name='L2050'><font color='red'>}</font>;
<a name='L2051'>
<a name='L2052'><b>static</b> <b>struct</b> <a href='../S/2317.html#L2043' title='Defined at 2043 in Modules/_ctypes/libffi/src/dlmalloc.c.'>malloc_params</a> mparams;
<a name='L2053'>
<a name='L2054'><i><font color='green'>/* The global malloc_state used for all non-"mspace" calls */</font></i>
<a name='L2055'><b>static</b> <b>struct</b> <a href='../S/2317.html#L2012' title='Defined at 2012 in Modules/_ctypes/libffi/src/dlmalloc.c.'>malloc_state</a> _gm_;
<a name='L2056'><font color='darkred'>#define</font> <a href='../R/8175.html' title='Multiple refered from 56 places.'>gm</a>                 (&amp;_gm_)
<a name='L2057'><font color='darkred'>#define</font> <a href='../S/2317.html#L3492' title='Refered from 3492 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_global</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>)       ((M) == &amp;_gm_)
<a name='L2058'><font color='darkred'>#define</font> <a href='../R/8502.html' title='Multiple refered from 5 places.'>is_initialized</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>)  ((M)-&gt;top != 0)
<a name='L2059'>
<a name='L2060'><i><font color='green'>/* -------------------------- system alloc setup ------------------------- */</font></i>
<a name='L2061'>
<a name='L2062'><i><font color='green'>/* Operations on mflags */</font></i>
<a name='L2063'>
<a name='L2064'><font color='darkred'>#define</font> <a href='../R/11198.html' title='Multiple refered from 2 places.'>use_lock</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>)           ((M)-&gt;mflags &amp;   <a href='../D/5396.html' title='Multiple defined in 2 places.'>USE_LOCK_BIT</a>)
<a name='L2065'><font color='darkred'>#define</font> enable_lock(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>)        ((M)-&gt;mflags |=  <a href='../D/5396.html' title='Multiple defined in 2 places.'>USE_LOCK_BIT</a>)
<a name='L2066'><font color='darkred'>#define</font> disable_lock(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>)       ((M)-&gt;mflags &amp;= ~<a href='../D/5396.html' title='Multiple defined in 2 places.'>USE_LOCK_BIT</a>)
<a name='L2067'>
<a name='L2068'><font color='darkred'>#define</font> <a href='../R/11199.html' title='Multiple refered from 3 places.'>use_mmap</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>)           ((M)-&gt;mflags &amp;   <a href='../D/5397.html' title='Multiple defined in 2 places.'>USE_MMAP_BIT</a>)
<a name='L2069'><font color='darkred'>#define</font> <a href='../S/2317.html#L3994' title='Refered from 3994 in Modules/_ctypes/libffi/src/dlmalloc.c.'>enable_mmap</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>)        ((M)-&gt;mflags |=  <a href='../D/5397.html' title='Multiple defined in 2 places.'>USE_MMAP_BIT</a>)
<a name='L2070'><font color='darkred'>#define</font> <a href='../S/2317.html#L3991' title='Refered from 3991 in Modules/_ctypes/libffi/src/dlmalloc.c.'>disable_mmap</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>)       ((M)-&gt;mflags &amp;= ~<a href='../D/5397.html' title='Multiple defined in 2 places.'>USE_MMAP_BIT</a>)
<a name='L2071'>
<a name='L2072'><font color='darkred'>#define</font> <a href='../S/2317.html#L3390' title='Refered from 3390 in Modules/_ctypes/libffi/src/dlmalloc.c.'>use_noncontiguous</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>)  ((M)-&gt;mflags &amp;   <a href='../S/2317.html#L1366' title='Defined at 1366 in Modules/_ctypes/libffi/src/dlmalloc.c.'>USE_NONCONTIGUOUS_BIT</a>)
<a name='L2073'><font color='darkred'>#define</font> <a href='../R/7387.html' title='Multiple refered from 2 places.'>disable_contiguous</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>) ((M)-&gt;mflags |=  <a href='../S/2317.html#L1366' title='Defined at 1366 in Modules/_ctypes/libffi/src/dlmalloc.c.'>USE_NONCONTIGUOUS_BIT</a>)
<a name='L2074'>
<a name='L2075'><font color='darkred'>#define</font> <a href='../R/10230.html' title='Multiple refered from 2 places.'>set_lock</a>(M,L)\
<a name='L2076'> ((<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>)-&gt;mflags = (<a href='../D/1875.html' title='Multiple defined in 7 places.'>L</a>)?\
<a name='L2077'>  ((<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>)-&gt;mflags | <a href='../D/5396.html' title='Multiple defined in 2 places.'>USE_LOCK_BIT</a>) :\
<a name='L2078'>  ((<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>)-&gt;mflags &amp; ~<a href='../D/5396.html' title='Multiple defined in 2 places.'>USE_LOCK_BIT</a>))
<a name='L2079'>
<a name='L2080'><i><font color='green'>/* page-align a size */</font></i>
<a name='L2081'><font color='darkred'>#define</font> <a href='../S/2317.html#L3402' title='Refered from 3402 in Modules/_ctypes/libffi/src/dlmalloc.c.'>page_align</a>(S)\
<a name='L2082'> (((<a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>) + (mparams.page_size)) &amp; ~(mparams.page_size - <a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a>))
<a name='L2083'>
<a name='L2084'><i><font color='green'>/* granularity-align a size */</font></i>
<a name='L2085'><font color='darkred'>#define</font> <a href='../R/8180.html' title='Multiple refered from 8 places.'>granularity_align</a>(S)\
<a name='L2086'>  (((<a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>) + (mparams.granularity)) &amp; ~(mparams.granularity - <a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a>))
<a name='L2087'>
<a name='L2088'><font color='darkred'>#define</font> <a href='../S/2317.html#L3401' title='Refered from 3401 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_page_aligned</a>(S)\
<a name='L2089'>   (((<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)(<a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>) &amp; (mparams.page_size - <a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a>)) == 0)
<a name='L2090'><font color='darkred'>#define</font> is_granularity_aligned(S)\
<a name='L2091'>   (((<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)(<a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>) &amp; (mparams.granularity - <a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a>)) == 0)
<a name='L2092'>
<a name='L2093'><i><font color='green'>/*  True if segment S holds address A */</font></i>
<a name='L2094'><font color='darkred'>#define</font> <a href='../R/10137.html' title='Multiple refered from 5 places.'>segment_holds</a>(S, A)\
<a name='L2095'>  ((<b>char</b>*)(<a href='../D/1.html' title='Multiple defined in 18 places.'>A</a>) &gt;= <a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>-&gt;base &amp;&amp; (<b>char</b>*)(<a href='../D/1.html' title='Multiple defined in 18 places.'>A</a>) &lt; <a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>-&gt;base + <a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>-&gt;size)
<a name='L2096'>
<a name='L2097'><i><font color='green'>/* Return segment holding given address */</font></i>
<a name='L2098'><b>static</b> <a href='../S/2317.html#L1925' title='Defined at 1925 in Modules/_ctypes/libffi/src/dlmalloc.c.'>msegmentptr</a> <a href='../R/10135.html' title='Multiple refered from 6 places.'>segment_holding</a>(mstate m, <b>char</b>* addr) <font color='red'>{</font>
<a name='L2099'>  <a href='../S/2317.html#L1925' title='Defined at 1925 in Modules/_ctypes/libffi/src/dlmalloc.c.'>msegmentptr</a> sp = &amp;m-&gt;seg;
<a name='L2100'>  <b>for</b> (;;) <font color='red'>{</font>
<a name='L2101'>    <b>if</b> (addr &gt;= sp-&gt;base &amp;&amp; addr &lt; sp-&gt;base + sp-&gt;size)
<a name='L2102'>      <b>return</b> sp;
<a name='L2103'>    <b>if</b> ((sp = sp-&gt;next) == 0)
<a name='L2104'>      <b>return</b> 0;
<a name='L2105'>  <font color='red'>}</font>
<a name='L2106'><font color='red'>}</font>
<a name='L2107'>
<a name='L2108'><i><font color='green'>/* Return true if segment contains a segment link */</font></i>
<a name='L2109'><b>static</b> <b>int</b> <a href='../S/2317.html#L3609' title='Refered from 3609 in Modules/_ctypes/libffi/src/dlmalloc.c.'>has_segment_link</a>(mstate m, msegmentptr ss) <font color='red'>{</font>
<a name='L2110'>  <a href='../S/2317.html#L1925' title='Defined at 1925 in Modules/_ctypes/libffi/src/dlmalloc.c.'>msegmentptr</a> sp = &amp;m-&gt;seg;
<a name='L2111'>  <b>for</b> (;;) <font color='red'>{</font>
<a name='L2112'>    <b>if</b> ((<b>char</b>*)sp &gt;= ss-&gt;base &amp;&amp; (<b>char</b>*)sp &lt; ss-&gt;base + ss-&gt;size)
<a name='L2113'>      <b>return</b> 1;
<a name='L2114'>    <b>if</b> ((sp = sp-&gt;next) == 0)
<a name='L2115'>      <b>return</b> 0;
<a name='L2116'>  <font color='red'>}</font>
<a name='L2117'><font color='red'>}</font>
<a name='L2118'>
<a name='L2119'><font color='darkred'>#ifndef</font> MORECORE_CANNOT_TRIM
<a name='L2120'><font color='darkred'>#define</font> <a href='../R/10300.html' title='Multiple refered from 2 places.'>should_trim</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>,s)  ((s) &gt; (M)-&gt;trim_check)
<a name='L2121'><font color='darkred'>#else</font>  <i><font color='green'>/* MORECORE_CANNOT_TRIM */</font></i>
<a name='L2122'><font color='darkred'>#define</font> <a href='../R/10300.html' title='Multiple refered from 2 places.'>should_trim</a>(M,s)  (0)
<a name='L2123'><font color='darkred'>#endif</font> <i><font color='green'>/* MORECORE_CANNOT_TRIM */</font></i>
<a name='L2124'>
<a name='L2125'><i><font color='green'>/*</font></i>
<a name='L2126'><i><font color='green'>  TOP_FOOT_SIZE is padding at the end of a segment, including space</font></i>
<a name='L2127'><i><font color='green'>  that may be needed to place segment records and fenceposts when new</font></i>
<a name='L2128'><i><font color='green'>  noncontiguous segments are added.</font></i>
<a name='L2129'><i><font color='green'>*/</font></i>
<a name='L2130'><font color='darkred'>#define</font> <a href='../R/4558.html' title='Multiple refered from 22 places.'>TOP_FOOT_SIZE</a>\
<a name='L2131'>  (<a href='../S/2317.html#L1263' title='Defined at 1263 in Modules/_ctypes/libffi/src/dlmalloc.c.'>align_offset</a>(<a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(0))+<a href='../S/2317.html#L1641' title='Defined at 1641 in Modules/_ctypes/libffi/src/dlmalloc.c.'>pad_request</a>(<b>sizeof</b>(<b>struct</b> <a href='../S/2317.html#L1878' title='Defined at 1878 in Modules/_ctypes/libffi/src/dlmalloc.c.'>malloc_segment</a>))+<a href='../S/2317.html#L1627' title='Defined at 1627 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MIN_CHUNK_SIZE</a>)
<a name='L2132'>
<a name='L2133'>
<a name='L2134'><i><font color='green'>/* -------------------------------  Hooks -------------------------------- */</font></i>
<a name='L2135'>
<a name='L2136'><i><font color='green'>/*</font></i>
<a name='L2137'><i><font color='green'>  PREACTION should be defined to return 0 on success, and nonzero on</font></i>
<a name='L2138'><i><font color='green'>  failure. If you are not using locking, you can redefine these to do</font></i>
<a name='L2139'><i><font color='green'>  anything you like.</font></i>
<a name='L2140'><i><font color='green'>*/</font></i>
<a name='L2141'>
<a name='L2142'><font color='darkred'>#if</font> <a href='../D/5395.html' title='Multiple defined in 2 places.'>USE_LOCKS</a>
<a name='L2143'>
<a name='L2144'><i><font color='green'>/* Ensure locks are initialized */</font></i>
<a name='L2145'><font color='darkred'>#define</font> <a href='../S/2317.html#L2147' title='Refered from 2147 in Modules/_ctypes/libffi/src/dlmalloc.c.'>GLOBALLY_INITIALIZE</a>() (mparams.page_size == 0 &amp;&amp; <a href='../S/2317.html#L2452' title='Defined at 2452 in Modules/_ctypes/libffi/src/dlmalloc.c.'>init_mparams</a>())
<a name='L2146'>
<a name='L2147'><font color='darkred'>#define</font> <a href='../R/2285.html' title='Multiple refered from 12 places.'>PREACTION</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>)  ((<a href='../S/2317.html#L2145' title='Defined at 2145 in Modules/_ctypes/libffi/src/dlmalloc.c.'>GLOBALLY_INITIALIZE</a>() || <a href='../S/2317.html#L2064' title='Defined at 2064 in Modules/_ctypes/libffi/src/dlmalloc.c.'>use_lock</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>))? <a href='../D/20.html' title='Multiple defined in 4 places.'>ACQUIRE_LOCK</a>(&amp;(M)-&gt;mutex) : 0)
<a name='L2148'><font color='darkred'>#define</font> <a href='../R/2281.html' title='Multiple refered from 13 places.'>POSTACTION</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>) <font color='red'>{</font> <b>if</b> (<a href='../S/2317.html#L2064' title='Defined at 2064 in Modules/_ctypes/libffi/src/dlmalloc.c.'>use_lock</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>)) <a href='../D/4465.html' title='Multiple defined in 4 places.'>RELEASE_LOCK</a>(&amp;(M)-&gt;mutex); <font color='red'>}</font>
<a name='L2149'><font color='darkred'>#else</font> <i><font color='green'>/* USE_LOCKS */</font></i>
<a name='L2150'>
<a name='L2151'><font color='darkred'>#ifndef</font> <a href='../D/2519.html' title='Multiple defined in 2 places.'>PREACTION</a>
<a name='L2152'><font color='darkred'>#define</font> <a href='../R/2285.html' title='Multiple refered from 12 places.'>PREACTION</a>(M) (0)
<a name='L2153'><font color='darkred'>#endif</font>  <i><font color='green'>/* PREACTION */</font></i>
<a name='L2154'>
<a name='L2155'><font color='darkred'>#ifndef</font> <a href='../D/2515.html' title='Multiple defined in 2 places.'>POSTACTION</a>
<a name='L2156'><font color='darkred'>#define</font> <a href='../R/2281.html' title='Multiple refered from 13 places.'>POSTACTION</a>(M)
<a name='L2157'><font color='darkred'>#endif</font>  <i><font color='green'>/* POSTACTION */</font></i>
<a name='L2158'>
<a name='L2159'><font color='darkred'>#endif</font> <i><font color='green'>/* USE_LOCKS */</font></i>
<a name='L2160'>
<a name='L2161'><i><font color='green'>/*</font></i>
<a name='L2162'><i><font color='green'>  CORRUPTION_ERROR_ACTION is triggered upon detected bad addresses.</font></i>
<a name='L2163'><i><font color='green'>  USAGE_ERROR_ACTION is triggered on detected bad frees and</font></i>
<a name='L2164'><i><font color='green'>  reallocs. The argument p is an address that might have triggered the</font></i>
<a name='L2165'><i><font color='green'>  fault. It is ignored by the two predefined actions, but might be</font></i>
<a name='L2166'><i><font color='green'>  useful in custom actions that try to help diagnose errors.</font></i>
<a name='L2167'><i><font color='green'>*/</font></i>
<a name='L2168'>
<a name='L2169'><font color='darkred'>#if</font> <a href='../S/2317.html#L500' title='Defined at 500 in Modules/_ctypes/libffi/src/dlmalloc.c.'>PROCEED_ON_ERROR</a>
<a name='L2170'>
<a name='L2171'><i><font color='green'>/* A count of the number of corruption errors causing resets */</font></i>
<a name='L2172'><b>int</b> malloc_corruption_error_count;
<a name='L2173'>
<a name='L2174'><i><font color='green'>/* default corruption action */</font></i>
<a name='L2175'><b>static</b> <b>void</b> <a href='../S/2317.html#L3244' title='Defined at 3244 in Modules/_ctypes/libffi/src/dlmalloc.c.'>reset_on_error</a>(mstate m);
<a name='L2176'>
<a name='L2177'><font color='darkred'>#define</font> <a href='../R/592.html' title='Multiple refered from 14 places.'>CORRUPTION_ERROR_ACTION</a>(m)  <a href='../S/2317.html#L3244' title='Defined at 3244 in Modules/_ctypes/libffi/src/dlmalloc.c.'>reset_on_error</a>(m)
<a name='L2178'><font color='darkred'>#define</font> <a href='../R/4758.html' title='Multiple refered from 19 places.'>USAGE_ERROR_ACTION</a>(m, p)
<a name='L2179'>
<a name='L2180'><font color='darkred'>#else</font> <i><font color='green'>/* PROCEED_ON_ERROR */</font></i>
<a name='L2181'>
<a name='L2182'><font color='darkred'>#ifndef</font> <a href='../D/635.html' title='Multiple defined in 2 places.'>CORRUPTION_ERROR_ACTION</a>
<a name='L2183'><font color='darkred'>#define</font> <a href='../R/592.html' title='Multiple refered from 14 places.'>CORRUPTION_ERROR_ACTION</a>(m) <a href='../S/2317.html#L494' title='Defined at 494 in Modules/_ctypes/libffi/src/dlmalloc.c.'>ABORT</a>
<a name='L2184'><font color='darkred'>#endif</font> <i><font color='green'>/* CORRUPTION_ERROR_ACTION */</font></i>
<a name='L2185'>
<a name='L2186'><font color='darkred'>#ifndef</font> <a href='../D/5379.html' title='Multiple defined in 2 places.'>USAGE_ERROR_ACTION</a>
<a name='L2187'><font color='darkred'>#define</font> <a href='../R/4758.html' title='Multiple refered from 19 places.'>USAGE_ERROR_ACTION</a>(m,p) <a href='../S/2317.html#L494' title='Defined at 494 in Modules/_ctypes/libffi/src/dlmalloc.c.'>ABORT</a>
<a name='L2188'><font color='darkred'>#endif</font> <i><font color='green'>/* USAGE_ERROR_ACTION */</font></i>
<a name='L2189'>
<a name='L2190'><font color='darkred'>#endif</font> <i><font color='green'>/* PROCEED_ON_ERROR */</font></i>
<a name='L2191'>
<a name='L2192'><i><font color='green'>/* -------------------------- Debugging setup ---------------------------- */</font></i>
<a name='L2193'>
<a name='L2194'><font color='darkred'>#if</font> ! <a href='../D/728.html' title='Multiple defined in 2 places.'>DEBUG</a>
<a name='L2195'>
<a name='L2196'><font color='darkred'>#define</font> <a href='../R/6630.html' title='Multiple refered from 3 places.'>check_free_chunk</a>(M,P)
<a name='L2197'><font color='darkred'>#define</font> <a href='../R/6633.html' title='Multiple refered from 6 places.'>check_inuse_chunk</a>(M,P)
<a name='L2198'><font color='darkred'>#define</font> <a href='../R/6636.html' title='Multiple refered from 14 places.'>check_malloced_chunk</a>(M,P,N)
<a name='L2199'><font color='darkred'>#define</font> <a href='../R/6639.html' title='Multiple refered from 2 places.'>check_mmapped_chunk</a>(M,P)
<a name='L2200'><font color='darkred'>#define</font> <a href='../R/6635.html' title='Multiple refered from 2 places.'>check_malloc_state</a>(M)
<a name='L2201'><font color='darkred'>#define</font> <a href='../R/6644.html' title='Multiple refered from 7 places.'>check_top_chunk</a>(M,P)
<a name='L2202'>
<a name='L2203'><font color='darkred'>#else</font> <i><font color='green'>/* DEBUG */</font></i>
<a name='L2204'><font color='darkred'>#define</font> <a href='../R/6630.html' title='Multiple refered from 3 places.'>check_free_chunk</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>,<a href='../D/2444.html' title='Multiple defined in 2 places.'>P</a>)       <a href='../S/2317.html#L2599' title='Defined at 2599 in Modules/_ctypes/libffi/src/dlmalloc.c.'>do_check_free_chunk</a>(M,P)
<a name='L2205'><font color='darkred'>#define</font> <a href='../R/6633.html' title='Multiple refered from 6 places.'>check_inuse_chunk</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>,<a href='../D/2444.html' title='Multiple defined in 2 places.'>P</a>)      <a href='../S/2317.html#L2588' title='Defined at 2588 in Modules/_ctypes/libffi/src/dlmalloc.c.'>do_check_inuse_chunk</a>(M,P)
<a name='L2206'><font color='darkred'>#define</font> <a href='../R/6644.html' title='Multiple refered from 7 places.'>check_top_chunk</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>,<a href='../D/2444.html' title='Multiple defined in 2 places.'>P</a>)        <a href='../S/2317.html#L2560' title='Defined at 2560 in Modules/_ctypes/libffi/src/dlmalloc.c.'>do_check_top_chunk</a>(M,P)
<a name='L2207'><font color='darkred'>#define</font> <a href='../R/6636.html' title='Multiple refered from 14 places.'>check_malloced_chunk</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>,<a href='../D/2444.html' title='Multiple defined in 2 places.'>P</a>,<a href='../D/2250.html' title='Multiple defined in 3 places.'>N</a>) <a href='../S/2317.html#L2622' title='Defined at 2622 in Modules/_ctypes/libffi/src/dlmalloc.c.'>do_check_malloced_chunk</a>(M,P,N)
<a name='L2208'><font color='darkred'>#define</font> <a href='../R/6639.html' title='Multiple refered from 2 places.'>check_mmapped_chunk</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>,<a href='../D/2444.html' title='Multiple defined in 2 places.'>P</a>)    <a href='../S/2317.html#L2574' title='Defined at 2574 in Modules/_ctypes/libffi/src/dlmalloc.c.'>do_check_mmapped_chunk</a>(M,P)
<a name='L2209'><font color='darkred'>#define</font> <a href='../R/6635.html' title='Multiple refered from 2 places.'>check_malloc_state</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>)       <a href='../S/2317.html#L2789' title='Defined at 2789 in Modules/_ctypes/libffi/src/dlmalloc.c.'>do_check_malloc_state</a>(M)
<a name='L2210'>
<a name='L2211'><b>static</b> <b>void</b>   <a href='../S/2317.html#L2554' title='Defined at 2554 in Modules/_ctypes/libffi/src/dlmalloc.c.'>do_check_any_chunk</a>(mstate m, mchunkptr p);
<a name='L2212'><b>static</b> <b>void</b>   <a href='../S/2317.html#L2560' title='Defined at 2560 in Modules/_ctypes/libffi/src/dlmalloc.c.'>do_check_top_chunk</a>(mstate m, mchunkptr p);
<a name='L2213'><b>static</b> <b>void</b>   <a href='../S/2317.html#L2574' title='Defined at 2574 in Modules/_ctypes/libffi/src/dlmalloc.c.'>do_check_mmapped_chunk</a>(mstate m, mchunkptr p);
<a name='L2214'><b>static</b> <b>void</b>   <a href='../S/2317.html#L2588' title='Defined at 2588 in Modules/_ctypes/libffi/src/dlmalloc.c.'>do_check_inuse_chunk</a>(mstate m, mchunkptr p);
<a name='L2215'><b>static</b> <b>void</b>   <a href='../S/2317.html#L2599' title='Defined at 2599 in Modules/_ctypes/libffi/src/dlmalloc.c.'>do_check_free_chunk</a>(mstate m, mchunkptr p);
<a name='L2216'><b>static</b> <b>void</b>   <a href='../S/2317.html#L2622' title='Defined at 2622 in Modules/_ctypes/libffi/src/dlmalloc.c.'>do_check_malloced_chunk</a>(mstate m, <b>void</b>* mem, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> s);
<a name='L2217'><b>static</b> <b>void</b>   <a href='../S/2317.html#L2636' title='Defined at 2636 in Modules/_ctypes/libffi/src/dlmalloc.c.'>do_check_tree</a>(mstate m, tchunkptr t);
<a name='L2218'><b>static</b> <b>void</b>   <a href='../S/2317.html#L2687' title='Defined at 2687 in Modules/_ctypes/libffi/src/dlmalloc.c.'>do_check_treebin</a>(mstate m, <a href='../S/2317.html#L1607' title='Defined at 1607 in Modules/_ctypes/libffi/src/dlmalloc.c.'>bindex_t</a> i);
<a name='L2219'><b>static</b> <b>void</b>   <a href='../S/2317.html#L2698' title='Defined at 2698 in Modules/_ctypes/libffi/src/dlmalloc.c.'>do_check_smallbin</a>(mstate m, <a href='../S/2317.html#L1607' title='Defined at 1607 in Modules/_ctypes/libffi/src/dlmalloc.c.'>bindex_t</a> i);
<a name='L2220'><b>static</b> <b>void</b>   <a href='../S/2317.html#L2789' title='Defined at 2789 in Modules/_ctypes/libffi/src/dlmalloc.c.'>do_check_malloc_state</a>(mstate m);
<a name='L2221'><b>static</b> <b>int</b>    <a href='../S/2317.html#L2722' title='Defined at 2722 in Modules/_ctypes/libffi/src/dlmalloc.c.'>bin_find</a>(mstate m, mchunkptr x);
<a name='L2222'><b>static</b> <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> <a href='../S/2317.html#L2758' title='Defined at 2758 in Modules/_ctypes/libffi/src/dlmalloc.c.'>traverse_and_check</a>(mstate m);
<a name='L2223'><font color='darkred'>#endif</font> <i><font color='green'>/* DEBUG */</font></i>
<a name='L2224'>
<a name='L2225'><i><font color='green'>/* ---------------------------- Indexing Bins ---------------------------- */</font></i>
<a name='L2226'>
<a name='L2227'><font color='darkred'>#define</font> <a href='../R/8516.html' title='Multiple refered from 6 places.'>is_small</a>(s)         (((s) &gt;&gt; <a href='../S/2317.html#L2005' title='Defined at 2005 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SMALLBIN_SHIFT</a>) &lt; <a href='../S/2317.html#L2003' title='Defined at 2003 in Modules/_ctypes/libffi/src/dlmalloc.c.'>NSMALLBINS</a>)
<a name='L2228'><font color='darkred'>#define</font> <a href='../R/10364.html' title='Multiple refered from 7 places.'>small_index</a>(s)      ((s)  &gt;&gt; <a href='../S/2317.html#L2005' title='Defined at 2005 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SMALLBIN_SHIFT</a>)
<a name='L2229'><font color='darkred'>#define</font> <a href='../R/10365.html' title='Multiple refered from 12 places.'>small_index2size</a>(i) ((i)  &lt;&lt; <a href='../S/2317.html#L2005' title='Defined at 2005 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SMALLBIN_SHIFT</a>)
<a name='L2230'><font color='darkred'>#define</font> MIN_SMALL_INDEX     (<a href='../S/2317.html#L2228' title='Defined at 2228 in Modules/_ctypes/libffi/src/dlmalloc.c.'>small_index</a>(<a href='../S/2317.html#L1627' title='Defined at 1627 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MIN_CHUNK_SIZE</a>))
<a name='L2231'>
<a name='L2232'><i><font color='green'>/* addressing by index. See above about smallbin repositioning */</font></i>
<a name='L2233'><font color='darkred'>#define</font> <a href='../R/10367.html' title='Multiple refered from 10 places.'>smallbin_at</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>, i)   ((<a href='../S/2317.html#L1606' title='Defined at 1606 in Modules/_ctypes/libffi/src/dlmalloc.c.'>sbinptr</a>)((<b>char</b>*)&amp;((M)-&gt;smallbins[(i)&lt;&lt;1])))
<a name='L2234'><font color='darkred'>#define</font> <a href='../R/10955.html' title='Multiple refered from 8 places.'>treebin_at</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>,i)     (&amp;((M)-&gt;treebins[i]))
<a name='L2235'>
<a name='L2236'><i><font color='green'>/* assign tree index for size S to variable I */</font></i>
<a name='L2237'><font color='darkred'>#if</font> <b>defined</b>(__GNUC__) &amp;&amp; <b>defined</b>(i386)
<a name='L2238'><font color='darkred'>#define</font> <a href='../R/6960.html' title='Multiple refered from 4 places.'>compute_tree_index</a>(S, I)\
<a name='L2239'><font color='red'>{</font>\
<a name='L2240'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> X = <a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a> &gt;&gt; <a href='../S/2317.html#L2007' title='Defined at 2007 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TREEBIN_SHIFT</a>;\
<a name='L2241'>  <b>if</b> (X == 0)\
<a name='L2242'>    <a href='../S/2690.html#L104' title='Defined at 104 in Modules/md5module.c.'>I</a> = 0;\
<a name='L2243'>  <b>else</b> <b>if</b> (X &gt; 0xFFFF)\
<a name='L2244'>    <a href='../S/2690.html#L104' title='Defined at 104 in Modules/md5module.c.'>I</a> = <a href='../S/2317.html#L2004' title='Defined at 2004 in Modules/_ctypes/libffi/src/dlmalloc.c.'>NTREEBINS</a>-1;\
<a name='L2245'>  <b>else</b> <font color='red'>{</font>\
<a name='L2246'>    <b>unsigned</b> <b>int</b> K;\
<a name='L2247'>    <b>__asm__</b>("bsrl %1,%0\n\t" : "=r" (K) : "rm"  (X));\
<a name='L2248'>    <a href='../S/2690.html#L104' title='Defined at 104 in Modules/md5module.c.'>I</a> =  (<a href='../S/2317.html#L1607' title='Defined at 1607 in Modules/_ctypes/libffi/src/dlmalloc.c.'>bindex_t</a>)((K &lt;&lt; 1) + ((<a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a> &gt;&gt; (K + (<a href='../S/2317.html#L2007' title='Defined at 2007 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TREEBIN_SHIFT</a>-1)) &amp; 1)));\
<a name='L2249'>  <font color='red'>}</font>\
<a name='L2250'><font color='red'>}</font>
<a name='L2251'><font color='darkred'>#else</font> <i><font color='green'>/* GNUC */</font></i>
<a name='L2252'><font color='darkred'>#define</font> <a href='../R/6960.html' title='Multiple refered from 4 places.'>compute_tree_index</a>(S, I)\
<a name='L2253'><font color='red'>{</font>\
<a name='L2254'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> X = <a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a> &gt;&gt; <a href='../S/2317.html#L2007' title='Defined at 2007 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TREEBIN_SHIFT</a>;\
<a name='L2255'>  <b>if</b> (X == 0)\
<a name='L2256'>    <a href='../S/2690.html#L104' title='Defined at 104 in Modules/md5module.c.'>I</a> = 0;\
<a name='L2257'>  <b>else</b> <b>if</b> (X &gt; 0xFFFF)\
<a name='L2258'>    <a href='../S/2690.html#L104' title='Defined at 104 in Modules/md5module.c.'>I</a> = <a href='../S/2317.html#L2004' title='Defined at 2004 in Modules/_ctypes/libffi/src/dlmalloc.c.'>NTREEBINS</a>-1;\
<a name='L2259'>  <b>else</b> <font color='red'>{</font>\
<a name='L2260'>    <b>unsigned</b> <b>int</b> Y = (<b>unsigned</b> <b>int</b>)X;\
<a name='L2261'>    <b>unsigned</b> <b>int</b> <a href='../D/2250.html' title='Multiple defined in 3 places.'>N</a> = ((Y - 0x100) &gt;&gt; 16) &amp; 8;\
<a name='L2262'>    <b>unsigned</b> <b>int</b> K = (((Y &lt;&lt;= <a href='../D/2250.html' title='Multiple defined in 3 places.'>N</a>) - 0x1000) &gt;&gt; 16) &amp; 4;\
<a name='L2263'>    <a href='../D/2250.html' title='Multiple defined in 3 places.'>N</a> += K;\
<a name='L2264'>    <a href='../D/2250.html' title='Multiple defined in 3 places.'>N</a> += K = (((Y &lt;&lt;= K) - 0x4000) &gt;&gt; 16) &amp; 2;\
<a name='L2265'>    K = 14 - <a href='../D/2250.html' title='Multiple defined in 3 places.'>N</a> + ((Y &lt;&lt;= K) &gt;&gt; 15);\
<a name='L2266'>    <a href='../S/2690.html#L104' title='Defined at 104 in Modules/md5module.c.'>I</a> = (K &lt;&lt; 1) + ((<a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a> &gt;&gt; (K + (<a href='../S/2317.html#L2007' title='Defined at 2007 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TREEBIN_SHIFT</a>-1)) &amp; 1));\
<a name='L2267'>  <font color='red'>}</font>\
<a name='L2268'><font color='red'>}</font>
<a name='L2269'><font color='darkred'>#endif</font> <i><font color='green'>/* GNUC */</font></i>
<a name='L2270'>
<a name='L2271'><i><font color='green'>/* Bit representing maximum resolved size in a treebin at i */</font></i>
<a name='L2272'><font color='darkred'>#define</font> bit_for_tree_index(i) \
<a name='L2273'>   (i == <a href='../S/2317.html#L2004' title='Defined at 2004 in Modules/_ctypes/libffi/src/dlmalloc.c.'>NTREEBINS</a>-1)? (<a href='../S/2317.html#L1244' title='Defined at 1244 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_BITSIZE</a>-1) : (((i) &gt;&gt; 1) + <a href='../S/2317.html#L2007' title='Defined at 2007 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TREEBIN_SHIFT</a> - 2)
<a name='L2274'>
<a name='L2275'><i><font color='green'>/* Shift placing maximum resolved bit in a treebin at i as sign bit */</font></i>
<a name='L2276'><font color='darkred'>#define</font> <a href='../R/8628.html' title='Multiple refered from 3 places.'>leftshift_for_tree_index</a>(i) \
<a name='L2277'>   ((i == <a href='../S/2317.html#L2004' title='Defined at 2004 in Modules/_ctypes/libffi/src/dlmalloc.c.'>NTREEBINS</a>-1)? 0 : \
<a name='L2278'>    ((<a href='../S/2317.html#L1244' title='Defined at 1244 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_BITSIZE</a>-<a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a>) - (((i) &gt;&gt; 1) + <a href='../S/2317.html#L2007' title='Defined at 2007 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TREEBIN_SHIFT</a> - 2)))
<a name='L2279'>
<a name='L2280'><i><font color='green'>/* The size of the smallest chunk held in bin with index i */</font></i>
<a name='L2281'><font color='darkred'>#define</font> <a href='../R/9051.html' title='Multiple refered from 2 places.'>minsize_for_tree_index</a>(i) \
<a name='L2282'>   ((<a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a> &lt;&lt; (((i) &gt;&gt; 1) + <a href='../S/2317.html#L2007' title='Defined at 2007 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TREEBIN_SHIFT</a>)) |  \
<a name='L2283'>   (((<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)((i) &amp; <a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a>)) &lt;&lt; (((i) &gt;&gt; 1) + <a href='../S/2317.html#L2007' title='Defined at 2007 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TREEBIN_SHIFT</a> - 1)))
<a name='L2284'>
<a name='L2285'>
<a name='L2286'><i><font color='green'>/* ------------------------ Operations on bin maps ----------------------- */</font></i>
<a name='L2287'>
<a name='L2288'><i><font color='green'>/* bit corresponding to given index */</font></i>
<a name='L2289'><font color='darkred'>#define</font> <a href='../R/8295.html' title='Multiple refered from 9 places.'>idx2bit</a>(i)              ((<a href='../S/2317.html#L1608' title='Defined at 1608 in Modules/_ctypes/libffi/src/dlmalloc.c.'>binmap_t</a>)(1) &lt;&lt; (i))
<a name='L2290'>
<a name='L2291'><i><font color='green'>/* Mark/Clear bits with given index */</font></i>
<a name='L2292'><font color='darkred'>#define</font> <a href='../S/2317.html#L2908' title='Refered from 2908 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mark_smallmap</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>,i)      ((M)-&gt;smallmap |=  <a href='../S/2317.html#L2289' title='Defined at 2289 in Modules/_ctypes/libffi/src/dlmalloc.c.'>idx2bit</a>(i))
<a name='L2293'><font color='darkred'>#define</font> <a href='../R/6673.html' title='Multiple refered from 2 places.'>clear_smallmap</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>,i)     ((M)-&gt;smallmap &amp;= ~<a href='../S/2317.html#L2289' title='Defined at 2289 in Modules/_ctypes/libffi/src/dlmalloc.c.'>idx2bit</a>(i))
<a name='L2294'><font color='darkred'>#define</font> <a href='../R/10369.html' title='Multiple refered from 2 places.'>smallmap_is_marked</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>,i) ((M)-&gt;smallmap &amp;   <a href='../S/2317.html#L2289' title='Defined at 2289 in Modules/_ctypes/libffi/src/dlmalloc.c.'>idx2bit</a>(i))
<a name='L2295'>
<a name='L2296'><font color='darkred'>#define</font> <a href='../S/2317.html#L2981' title='Refered from 2981 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mark_treemap</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>,i)       ((M)-&gt;treemap  |=  <a href='../S/2317.html#L2289' title='Defined at 2289 in Modules/_ctypes/libffi/src/dlmalloc.c.'>idx2bit</a>(i))
<a name='L2297'><font color='darkred'>#define</font> <a href='../S/2317.html#L3075' title='Refered from 3075 in Modules/_ctypes/libffi/src/dlmalloc.c.'>clear_treemap</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>,i)      ((M)-&gt;treemap  &amp;= ~<a href='../S/2317.html#L2289' title='Defined at 2289 in Modules/_ctypes/libffi/src/dlmalloc.c.'>idx2bit</a>(i))
<a name='L2298'><font color='darkred'>#define</font> <a href='../R/10963.html' title='Multiple refered from 2 places.'>treemap_is_marked</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>,i)  ((M)-&gt;treemap  &amp;   <a href='../S/2317.html#L2289' title='Defined at 2289 in Modules/_ctypes/libffi/src/dlmalloc.c.'>idx2bit</a>(i))
<a name='L2299'>
<a name='L2300'><i><font color='green'>/* index corresponding to given bit */</font></i>
<a name='L2301'>
<a name='L2302'><font color='darkred'>#if</font> <b>defined</b>(__GNUC__) &amp;&amp; <b>defined</b>(i386)
<a name='L2303'><font color='darkred'>#define</font> <a href='../R/6952.html' title='Multiple refered from 4 places.'>compute_bit2idx</a>(X, I)\
<a name='L2304'><font color='red'>{</font>\
<a name='L2305'>  <b>unsigned</b> <b>int</b> J;\
<a name='L2306'>  <b>__asm__</b>("bsfl %1,%0\n\t" : "=r" (J) : "rm" (X));\
<a name='L2307'>  <a href='../S/2690.html#L104' title='Defined at 104 in Modules/md5module.c.'>I</a> = (<a href='../S/2317.html#L1607' title='Defined at 1607 in Modules/_ctypes/libffi/src/dlmalloc.c.'>bindex_t</a>)J;\
<a name='L2308'><font color='red'>}</font>
<a name='L2309'>
<a name='L2310'><font color='darkred'>#else</font> <i><font color='green'>/* GNUC */</font></i>
<a name='L2311'><font color='darkred'>#if</font>  <a href='../D/5382.html' title='Multiple defined in 3 places.'>USE_BUILTIN_FFS</a>
<a name='L2312'><font color='darkred'>#define</font> <a href='../R/6952.html' title='Multiple refered from 4 places.'>compute_bit2idx</a>(X, <a href='../S/2690.html#L104' title='Defined at 104 in Modules/md5module.c.'>I</a>) I = ffs(X)-1
<a name='L2313'>
<a name='L2314'><font color='darkred'>#else</font> <i><font color='green'>/* USE_BUILTIN_FFS */</font></i>
<a name='L2315'><font color='darkred'>#define</font> <a href='../R/6952.html' title='Multiple refered from 4 places.'>compute_bit2idx</a>(X, I)\
<a name='L2316'><font color='red'>{</font>\
<a name='L2317'>  <b>unsigned</b> <b>int</b> Y = X - 1;\
<a name='L2318'>  <b>unsigned</b> <b>int</b> K = Y &gt;&gt; (16-4) &amp; 16;\
<a name='L2319'>  <b>unsigned</b> <b>int</b> <a href='../D/2250.html' title='Multiple defined in 3 places.'>N</a> = K;        Y &gt;&gt;= K;\
<a name='L2320'>  <a href='../D/2250.html' title='Multiple defined in 3 places.'>N</a> += K = Y &gt;&gt; (8-3) &amp;  8;  Y &gt;&gt;= K;\
<a name='L2321'>  <a href='../D/2250.html' title='Multiple defined in 3 places.'>N</a> += K = Y &gt;&gt; (4-2) &amp;  4;  Y &gt;&gt;= K;\
<a name='L2322'>  <a href='../D/2250.html' title='Multiple defined in 3 places.'>N</a> += K = Y &gt;&gt; (2-1) &amp;  2;  Y &gt;&gt;= K;\
<a name='L2323'>  <a href='../D/2250.html' title='Multiple defined in 3 places.'>N</a> += K = Y &gt;&gt; (1-0) &amp;  1;  Y &gt;&gt;= K;\
<a name='L2324'>  <a href='../S/2690.html#L104' title='Defined at 104 in Modules/md5module.c.'>I</a> = (<a href='../S/2317.html#L1607' title='Defined at 1607 in Modules/_ctypes/libffi/src/dlmalloc.c.'>bindex_t</a>)(<a href='../D/2250.html' title='Multiple defined in 3 places.'>N</a> + Y);\
<a name='L2325'><font color='red'>}</font>
<a name='L2326'><font color='darkred'>#endif</font> <i><font color='green'>/* USE_BUILTIN_FFS */</font></i>
<a name='L2327'><font color='darkred'>#endif</font> <i><font color='green'>/* GNUC */</font></i>
<a name='L2328'>
<a name='L2329'><i><font color='green'>/* isolate the least set bit of a bitmap */</font></i>
<a name='L2330'><font color='darkred'>#define</font> <a href='../R/8625.html' title='Multiple refered from 4 places.'>least_bit</a>(x)         ((x) &amp; -(x))
<a name='L2331'>
<a name='L2332'><i><font color='green'>/* mask with all bits to left of least bit of x on */</font></i>
<a name='L2333'><font color='darkred'>#define</font> <a href='../R/8626.html' title='Multiple refered from 3 places.'>left_bits</a>(x)         ((x&lt;&lt;1) | -(x&lt;&lt;1))
<a name='L2334'>
<a name='L2335'><i><font color='green'>/* mask with all bits to left of or equal to least bit of x on */</font></i>
<a name='L2336'><font color='darkred'>#define</font> same_or_left_bits(x) ((x) | -(x))
<a name='L2337'>
<a name='L2338'>
<a name='L2339'><i><font color='green'>/* ----------------------- Runtime Check Support ------------------------- */</font></i>
<a name='L2340'>
<a name='L2341'><i><font color='green'>/*</font></i>
<a name='L2342'><i><font color='green'>  For security, the main invariant is that malloc/free/etc never</font></i>
<a name='L2343'><i><font color='green'>  writes to a static address other than malloc_state, unless static</font></i>
<a name='L2344'><i><font color='green'>  malloc_state itself has been corrupted, which cannot occur via</font></i>
<a name='L2345'><i><font color='green'>  malloc (because of these checks). In essence this means that we</font></i>
<a name='L2346'><i><font color='green'>  believe all pointers, sizes, maps etc held in malloc_state, but</font></i>
<a name='L2347'><i><font color='green'>  check all of those linked or offsetted from other embedded data</font></i>
<a name='L2348'><i><font color='green'>  structures.  These checks are interspersed with main code in a way</font></i>
<a name='L2349'><i><font color='green'>  that tends to minimize their run-time cost.</font></i>
<a name='L2350'><i><font color='green'></font></i>
<a name='L2351'><i><font color='green'>  When FOOTERS is defined, in addition to range checking, we also</font></i>
<a name='L2352'><i><font color='green'>  verify footer fields of inuse chunks, which can be used guarantee</font></i>
<a name='L2353'><i><font color='green'>  that the mstate controlling malloc/free is intact.  This is a</font></i>
<a name='L2354'><i><font color='green'>  streamlined version of the approach described by William Robertson</font></i>
<a name='L2355'><i><font color='green'>  et al in "Run-time Detection of Heap-based Overflows" LISA'03</font></i>
<a name='L2356'><i><font color='green'>  http://www.usenix.org/events/lisa03/tech/robertson.html The footer</font></i>
<a name='L2357'><i><font color='green'>  of an inuse chunk holds the xor of its mstate and a random seed,</font></i>
<a name='L2358'><i><font color='green'>  that is checked upon calls to free() and realloc().  This is</font></i>
<a name='L2359'><i><font color='green'>  (probablistically) unguessable from outside the program, but can be</font></i>
<a name='L2360'><i><font color='green'>  computed by any code successfully malloc'ing any chunk, so does not</font></i>
<a name='L2361'><i><font color='green'>  itself provide protection against code that has already broken</font></i>
<a name='L2362'><i><font color='green'>  security through some other means.  Unlike Robertson et al, we</font></i>
<a name='L2363'><i><font color='green'>  always dynamically check addresses of all offset chunks (previous,</font></i>
<a name='L2364'><i><font color='green'>  next, etc). This turns out to be cheaper than relying on hashes.</font></i>
<a name='L2365'><i><font color='green'>*/</font></i>
<a name='L2366'>
<a name='L2367'><font color='darkred'>#if</font> !<a href='../S/2317.html#L506' title='Defined at 506 in Modules/_ctypes/libffi/src/dlmalloc.c.'>INSECURE</a>
<a name='L2368'><i><font color='green'>/* Check if address a is at least as high as any from MORECORE or MMAP */</font></i>
<a name='L2369'><font color='darkred'>#define</font> <a href='../R/9363.html' title='Multiple refered from 22 places.'>ok_address</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>, a) ((<b>char</b>*)(a) &gt;= (M)-&gt;least_addr)
<a name='L2370'><i><font color='green'>/* Check if address of next chunk n is higher than base chunk p */</font></i>
<a name='L2371'><font color='darkred'>#define</font> <a href='../R/9366.html' title='Multiple refered from 5 places.'>ok_next</a>(p, n)    ((<b>char</b>*)(p) &lt; (<b>char</b>*)(n))
<a name='L2372'><i><font color='green'>/* Check if p has its cinuse bit on */</font></i>
<a name='L2373'><font color='darkred'>#define</font> <a href='../R/9364.html' title='Multiple refered from 3 places.'>ok_cinuse</a>(p)     <a href='../S/2317.html#L1667' title='Defined at 1667 in Modules/_ctypes/libffi/src/dlmalloc.c.'>cinuse</a>(p)
<a name='L2374'><i><font color='green'>/* Check if p has its pinuse bit on */</font></i>
<a name='L2375'><font color='darkred'>#define</font> <a href='../R/9367.html' title='Multiple refered from 3 places.'>ok_pinuse</a>(p)     <a href='../S/2317.html#L1668' title='Defined at 1668 in Modules/_ctypes/libffi/src/dlmalloc.c.'>pinuse</a>(p)
<a name='L2376'>
<a name='L2377'><font color='darkred'>#else</font> <i><font color='green'>/* !INSECURE */</font></i>
<a name='L2378'><font color='darkred'>#define</font> <a href='../R/9363.html' title='Multiple refered from 22 places.'>ok_address</a>(M, a) (1)
<a name='L2379'><font color='darkred'>#define</font> <a href='../R/9366.html' title='Multiple refered from 5 places.'>ok_next</a>(b, n)    (1)
<a name='L2380'><font color='darkred'>#define</font> <a href='../R/9364.html' title='Multiple refered from 3 places.'>ok_cinuse</a>(p)     (1)
<a name='L2381'><font color='darkred'>#define</font> <a href='../R/9367.html' title='Multiple refered from 3 places.'>ok_pinuse</a>(p)     (1)
<a name='L2382'><font color='darkred'>#endif</font> <i><font color='green'>/* !INSECURE */</font></i>
<a name='L2383'>
<a name='L2384'><font color='darkred'>#if</font> (<a href='../S/2317.html#L491' title='Defined at 491 in Modules/_ctypes/libffi/src/dlmalloc.c.'>FOOTERS</a> &amp;&amp; !<a href='../S/2317.html#L506' title='Defined at 506 in Modules/_ctypes/libffi/src/dlmalloc.c.'>INSECURE</a>)
<a name='L2385'><i><font color='green'>/* Check if (alleged) mstate m has expected magic field */</font></i>
<a name='L2386'><font color='darkred'>#define</font> <a href='../R/9365.html' title='Multiple refered from 15 places.'>ok_magic</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>)      ((M)-&gt;magic == mparams.magic)
<a name='L2387'><font color='darkred'>#else</font>  <i><font color='green'>/* (FOOTERS &amp;&amp; !INSECURE) */</font></i>
<a name='L2388'><font color='darkred'>#define</font> <a href='../R/9365.html' title='Multiple refered from 15 places.'>ok_magic</a>(M)      (1)
<a name='L2389'><font color='darkred'>#endif</font> <i><font color='green'>/* (FOOTERS &amp;&amp; !INSECURE) */</font></i>
<a name='L2390'>
<a name='L2391'>
<a name='L2392'><i><font color='green'>/* In gcc, use __builtin_expect to minimize impact of checks */</font></i>
<a name='L2393'><font color='darkred'>#if</font> !<a href='../S/2317.html#L506' title='Defined at 506 in Modules/_ctypes/libffi/src/dlmalloc.c.'>INSECURE</a>
<a name='L2394'><font color='darkred'>#if</font> <b>defined</b>(__GNUC__) &amp;&amp; __GNUC__ &gt;= 3
<a name='L2395'><font color='darkred'>#define</font> <a href='../R/3987.html' title='Multiple refered from 22 places.'>RTCHECK</a>(e)  __builtin_expect(e, 1)
<a name='L2396'><font color='darkred'>#else</font> <i><font color='green'>/* GNUC */</font></i>
<a name='L2397'><font color='darkred'>#define</font> <a href='../R/3987.html' title='Multiple refered from 22 places.'>RTCHECK</a>(e)  (e)
<a name='L2398'><font color='darkred'>#endif</font> <i><font color='green'>/* GNUC */</font></i>
<a name='L2399'><font color='darkred'>#else</font> <i><font color='green'>/* !INSECURE */</font></i>
<a name='L2400'><font color='darkred'>#define</font> <a href='../R/3987.html' title='Multiple refered from 22 places.'>RTCHECK</a>(e)  (1)
<a name='L2401'><font color='darkred'>#endif</font> <i><font color='green'>/* !INSECURE */</font></i>
<a name='L2402'>
<a name='L2403'><i><font color='green'>/* macros to set up inuse chunks with or without footers */</font></i>
<a name='L2404'>
<a name='L2405'><font color='darkred'>#if</font> !<a href='../S/2317.html#L491' title='Defined at 491 in Modules/_ctypes/libffi/src/dlmalloc.c.'>FOOTERS</a>
<a name='L2406'>
<a name='L2407'><font color='darkred'>#define</font> <a href='../R/8877.html' title='Multiple refered from 5 places.'>mark_inuse_foot</a>(M,p,s)
<a name='L2408'>
<a name='L2409'><i><font color='green'>/* Set cinuse bit and pinuse bit of next chunk */</font></i>
<a name='L2410'><font color='darkred'>#define</font> <a href='../R/10218.html' title='Multiple refered from 7 places.'>set_inuse</a>(M,p,s)\
<a name='L2411'>  ((p)-&gt;head = (((p)-&gt;head &amp; <a href='../S/2317.html#L1659' title='Defined at 1659 in Modules/_ctypes/libffi/src/dlmalloc.c.'>PINUSE_BIT</a>)|s|<a href='../S/2317.html#L1660' title='Defined at 1660 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CINUSE_BIT</a>),\
<a name='L2412'>  ((<a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a>)(((<b>char</b>*)(p)) + (s)))-&gt;head |= <a href='../S/2317.html#L1659' title='Defined at 1659 in Modules/_ctypes/libffi/src/dlmalloc.c.'>PINUSE_BIT</a>)
<a name='L2413'>
<a name='L2414'><i><font color='green'>/* Set cinuse and pinuse of this chunk and pinuse of next chunk */</font></i>
<a name='L2415'><font color='darkred'>#define</font> <a href='../R/10219.html' title='Multiple refered from 8 places.'>set_inuse_and_pinuse</a>(M,p,s)\
<a name='L2416'>  ((p)-&gt;head = (s|<a href='../S/2317.html#L1659' title='Defined at 1659 in Modules/_ctypes/libffi/src/dlmalloc.c.'>PINUSE_BIT</a>|<a href='../S/2317.html#L1660' title='Defined at 1660 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CINUSE_BIT</a>),\
<a name='L2417'>  ((<a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a>)(((<b>char</b>*)(p)) + (s)))-&gt;head |= <a href='../S/2317.html#L1659' title='Defined at 1659 in Modules/_ctypes/libffi/src/dlmalloc.c.'>PINUSE_BIT</a>)
<a name='L2418'>
<a name='L2419'><i><font color='green'>/* Set size, cinuse and pinuse bit of this chunk */</font></i>
<a name='L2420'><font color='darkred'>#define</font> <a href='../R/10248.html' title='Multiple refered from 14 places.'>set_size_and_pinuse_of_inuse_chunk</a>(M, p, s)\
<a name='L2421'>  ((p)-&gt;head = (s|<a href='../S/2317.html#L1659' title='Defined at 1659 in Modules/_ctypes/libffi/src/dlmalloc.c.'>PINUSE_BIT</a>|<a href='../S/2317.html#L1660' title='Defined at 1660 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CINUSE_BIT</a>))
<a name='L2422'>
<a name='L2423'><font color='darkred'>#else</font> <i><font color='green'>/* FOOTERS */</font></i>
<a name='L2424'>
<a name='L2425'><i><font color='green'>/* Set foot of inuse chunk to be xor of mstate and seed */</font></i>
<a name='L2426'><font color='darkred'>#define</font> <a href='../R/8877.html' title='Multiple refered from 5 places.'>mark_inuse_foot</a>(M,p,s)\
<a name='L2427'>  (((<a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a>)((<b>char</b>*)(p) + (s)))-&gt;prev_foot = ((<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>) ^ mparams.magic))
<a name='L2428'>
<a name='L2429'><font color='darkred'>#define</font> <a href='../R/8074.html' title='Multiple refered from 4 places.'>get_mstate_for</a>(p)\
<a name='L2430'>  ((<a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a>)(((<a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a>)((<b>char</b>*)(p) +\
<a name='L2431'>    (<a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(p))))-&gt;prev_foot ^ mparams.magic))
<a name='L2432'>
<a name='L2433'><font color='darkred'>#define</font> <a href='../R/10218.html' title='Multiple refered from 7 places.'>set_inuse</a>(M,p,s)\
<a name='L2434'>  ((p)-&gt;head = (((p)-&gt;head &amp; <a href='../S/2317.html#L1659' title='Defined at 1659 in Modules/_ctypes/libffi/src/dlmalloc.c.'>PINUSE_BIT</a>)|s|<a href='../S/2317.html#L1660' title='Defined at 1660 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CINUSE_BIT</a>),\
<a name='L2435'>  (((<a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a>)(((<b>char</b>*)(p)) + (s)))-&gt;head |= <a href='../S/2317.html#L1659' title='Defined at 1659 in Modules/_ctypes/libffi/src/dlmalloc.c.'>PINUSE_BIT</a>), \
<a name='L2436'>  <a href='../D/9706.html' title='Multiple defined in 2 places.'>mark_inuse_foot</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>,p,s))
<a name='L2437'>
<a name='L2438'><font color='darkred'>#define</font> <a href='../R/10219.html' title='Multiple refered from 8 places.'>set_inuse_and_pinuse</a>(M,p,s)\
<a name='L2439'>  ((p)-&gt;head = (s|<a href='../S/2317.html#L1659' title='Defined at 1659 in Modules/_ctypes/libffi/src/dlmalloc.c.'>PINUSE_BIT</a>|<a href='../S/2317.html#L1660' title='Defined at 1660 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CINUSE_BIT</a>),\
<a name='L2440'>  (((<a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a>)(((<b>char</b>*)(p)) + (s)))-&gt;head |= <a href='../S/2317.html#L1659' title='Defined at 1659 in Modules/_ctypes/libffi/src/dlmalloc.c.'>PINUSE_BIT</a>),\
<a name='L2441'> <a href='../D/9706.html' title='Multiple defined in 2 places.'>mark_inuse_foot</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>,p,s))
<a name='L2442'>
<a name='L2443'><font color='darkred'>#define</font> <a href='../R/10248.html' title='Multiple refered from 14 places.'>set_size_and_pinuse_of_inuse_chunk</a>(M, p, s)\
<a name='L2444'>  ((p)-&gt;head = (s|<a href='../S/2317.html#L1659' title='Defined at 1659 in Modules/_ctypes/libffi/src/dlmalloc.c.'>PINUSE_BIT</a>|<a href='../S/2317.html#L1660' title='Defined at 1660 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CINUSE_BIT</a>),\
<a name='L2445'>  <a href='../D/9706.html' title='Multiple defined in 2 places.'>mark_inuse_foot</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>, p, s))
<a name='L2446'>
<a name='L2447'><font color='darkred'>#endif</font> <i><font color='green'>/* !FOOTERS */</font></i>
<a name='L2448'>
<a name='L2449'><i><font color='green'>/* ---------------------------- setting mparams -------------------------- */</font></i>
<a name='L2450'>
<a name='L2451'><i><font color='green'>/* Initialize mparams */</font></i>
<a name='L2452'><b>static</b> <b>int</b> <a href='../R/8385.html' title='Multiple refered from 7 places.'>init_mparams</a>(<b>void</b>) <font color='red'>{</font>
<a name='L2453'>  <b>if</b> (mparams.page_size == 0) <font color='red'>{</font>
<a name='L2454'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> s;
<a name='L2455'>
<a name='L2456'>    mparams.mmap_threshold = <a href='../D/758.html' title='Multiple defined in 3 places.'>DEFAULT_MMAP_THRESHOLD</a>;
<a name='L2457'>    mparams.trim_threshold = <a href='../D/760.html' title='Multiple defined in 3 places.'>DEFAULT_TRIM_THRESHOLD</a>;
<a name='L2458'><font color='darkred'>#if</font> <a href='../D/2167.html' title='Multiple defined in 2 places.'>MORECORE_CONTIGUOUS</a>
<a name='L2459'>    mparams.default_mflags = <a href='../D/5396.html' title='Multiple defined in 2 places.'>USE_LOCK_BIT</a>|<a href='../D/5397.html' title='Multiple defined in 2 places.'>USE_MMAP_BIT</a>;
<a name='L2460'><font color='darkred'>#else</font>  <i><font color='green'>/* MORECORE_CONTIGUOUS */</font></i>
<a name='L2461'>    mparams.default_mflags = <a href='../D/5396.html' title='Multiple defined in 2 places.'>USE_LOCK_BIT</a>|<a href='../D/5397.html' title='Multiple defined in 2 places.'>USE_MMAP_BIT</a>|<a href='../S/2317.html#L1366' title='Defined at 1366 in Modules/_ctypes/libffi/src/dlmalloc.c.'>USE_NONCONTIGUOUS_BIT</a>;
<a name='L2462'><font color='darkred'>#endif</font> <i><font color='green'>/* MORECORE_CONTIGUOUS */</font></i>
<a name='L2463'>
<a name='L2464'><font color='darkred'>#if</font> (<a href='../S/2317.html#L491' title='Defined at 491 in Modules/_ctypes/libffi/src/dlmalloc.c.'>FOOTERS</a> &amp;&amp; !<a href='../S/2317.html#L506' title='Defined at 506 in Modules/_ctypes/libffi/src/dlmalloc.c.'>INSECURE</a>)
<a name='L2465'>    <font color='red'>{</font>
<a name='L2466'><font color='darkred'>#if</font> <a href='../S/2317.html#L566' title='Defined at 566 in Modules/_ctypes/libffi/src/dlmalloc.c.'>USE_DEV_RANDOM</a>
<a name='L2467'>      <b>int</b> fd;
<a name='L2468'>      <b>unsigned</b> <b>char</b> buf[<b>sizeof</b>(<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)];
<a name='L2469'>      <i><font color='green'>/* Try to use /dev/urandom, else fall back on using time */</font></i>
<a name='L2470'>      <b>if</b> ((fd = open("/dev/urandom", <a href='../S/2694.html#L28' title='Defined at 28 in Modules/ossaudiodev.c.'>O_RDONLY</a>)) &gt;= 0 &amp;&amp;
<a name='L2471'>          read(fd, buf, <b>sizeof</b>(buf)) == <b>sizeof</b>(buf)) <font color='red'>{</font>
<a name='L2472'>        s = *((<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> *) buf);
<a name='L2473'>        close(fd);
<a name='L2474'>      <font color='red'>}</font>
<a name='L2475'>      <b>else</b>
<a name='L2476'><font color='darkred'>#endif</font> <i><font color='green'>/* USE_DEV_RANDOM */</font></i>
<a name='L2477'>        s = (<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)(time(0) ^ (<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)0x55555555U);
<a name='L2478'>
<a name='L2479'>      s |= (<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)8U;    <i><font color='green'>/* ensure nonzero */</font></i>
<a name='L2480'>      s &amp;= ~(<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)7U;   <i><font color='green'>/* improve chances of fault for bad values */</font></i>
<a name='L2481'>
<a name='L2482'>    <font color='red'>}</font>
<a name='L2483'><font color='darkred'>#else</font> <i><font color='green'>/* (FOOTERS &amp;&amp; !INSECURE) */</font></i>
<a name='L2484'>    s = (<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)0x58585858U;
<a name='L2485'><font color='darkred'>#endif</font> <i><font color='green'>/* (FOOTERS &amp;&amp; !INSECURE) */</font></i>
<a name='L2486'>    <a href='../D/21.html' title='Multiple defined in 2 places.'>ACQUIRE_MAGIC_INIT_LOCK</a>();
<a name='L2487'>    <b>if</b> (mparams.magic == 0) <font color='red'>{</font>
<a name='L2488'>      mparams.magic = s;
<a name='L2489'>      <i><font color='green'>/* Set up lock for main malloc area */</font></i>
<a name='L2490'>      <a href='../D/1705.html' title='Multiple defined in 3 places.'>INITIAL_LOCK</a>(&amp;<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>-&gt;mutex);
<a name='L2491'>      <a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>-&gt;mflags = mparams.default_mflags;
<a name='L2492'>    <font color='red'>}</font>
<a name='L2493'>    <a href='../D/4466.html' title='Multiple defined in 2 places.'>RELEASE_MAGIC_INIT_LOCK</a>();
<a name='L2494'>
<a name='L2495'><font color='darkred'>#ifndef</font> <a href='../D/5523.html' title='Multiple defined in 3 places.'>WIN32</a>
<a name='L2496'>    mparams.page_size = <a href='../D/9692.html' title='Multiple defined in 9 places.'>malloc_getpagesize</a>;
<a name='L2497'>    mparams.granularity = ((<a href='../D/755.html' title='Multiple defined in 3 places.'>DEFAULT_GRANULARITY</a> != 0)?
<a name='L2498'>                           <a href='../D/755.html' title='Multiple defined in 3 places.'>DEFAULT_GRANULARITY</a> : mparams.page_size);
<a name='L2499'><font color='darkred'>#else</font> <i><font color='green'>/* WIN32 */</font></i>
<a name='L2500'>    <font color='red'>{</font>
<a name='L2501'>      SYSTEM_INFO system_info;
<a name='L2502'>      GetSystemInfo(&amp;system_info);
<a name='L2503'>      mparams.page_size = system_info.dwPageSize;
<a name='L2504'>      mparams.granularity = system_info.dwAllocationGranularity;
<a name='L2505'>    <font color='red'>}</font>
<a name='L2506'><font color='darkred'>#endif</font> <i><font color='green'>/* WIN32 */</font></i>
<a name='L2507'>
<a name='L2508'>    <i><font color='green'>/* Sanity-check configuration:</font></i>
<a name='L2509'><i><font color='green'>       size_t must be unsigned and as wide as pointer type.</font></i>
<a name='L2510'><i><font color='green'>       ints must be at least 4 bytes.</font></i>
<a name='L2511'><i><font color='green'>       alignment must be at least 8.</font></i>
<a name='L2512'><i><font color='green'>       Alignment, min chunk size, and page size must all be powers of 2.</font></i>
<a name='L2513'><i><font color='green'>    */</font></i>
<a name='L2514'>    <b>if</b> ((<b>sizeof</b>(<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>) != <b>sizeof</b>(<b>char</b>*)) ||
<a name='L2515'>        (<a href='../S/2317.html#L475' title='Defined at 475 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MAX_SIZE_T</a> &lt; <a href='../S/2317.html#L1627' title='Defined at 1627 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MIN_CHUNK_SIZE</a>)  ||
<a name='L2516'>        (<b>sizeof</b>(<b>int</b>) &lt; 4)  ||
<a name='L2517'>        (<a href='../S/2317.html#L488' title='Defined at 488 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MALLOC_ALIGNMENT</a> &lt; (<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)8U) ||
<a name='L2518'>        ((<a href='../S/2317.html#L488' title='Defined at 488 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MALLOC_ALIGNMENT</a>    &amp; (<a href='../S/2317.html#L488' title='Defined at 488 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MALLOC_ALIGNMENT</a>-<a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a>))    != 0) ||
<a name='L2519'>        ((<a href='../S/2317.html#L1613' title='Defined at 1613 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MCHUNK_SIZE</a>         &amp; (<a href='../S/2317.html#L1613' title='Defined at 1613 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MCHUNK_SIZE</a>-<a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a>))         != 0) ||
<a name='L2520'>        ((mparams.granularity &amp; (mparams.granularity-<a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a>)) != 0) ||
<a name='L2521'>        ((mparams.page_size   &amp; (mparams.page_size-<a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a>))   != 0))
<a name='L2522'>      <a href='../S/2317.html#L494' title='Defined at 494 in Modules/_ctypes/libffi/src/dlmalloc.c.'>ABORT</a>;
<a name='L2523'>  <font color='red'>}</font>
<a name='L2524'>  <b>return</b> 0;
<a name='L2525'><font color='red'>}</font>
<a name='L2526'>
<a name='L2527'><i><font color='green'>/* support for mallopt */</font></i>
<a name='L2528'><b>static</b> <b>int</b> <a href='../R/6601.html' title='Multiple refered from 2 places.'>change_mparam</a>(<b>int</b> param_number, <b>int</b> value) <font color='red'>{</font>
<a name='L2529'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> val = (<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)<a href='../S/2252.html#L27' title='Defined at 27 in Modules/_ctypes/ctypes.h.'>value</a>;
<a name='L2530'>  <a href='../S/2317.html#L2452' title='Defined at 2452 in Modules/_ctypes/libffi/src/dlmalloc.c.'>init_mparams</a>();
<a name='L2531'>  <b>switch</b>(param_number) <font color='red'>{</font>
<a name='L2532'>  <b>case</b> <a href='../S/2317.html#L582' title='Defined at 582 in Modules/_ctypes/libffi/src/dlmalloc.c.'>M_TRIM_THRESHOLD</a>:
<a name='L2533'>    mparams.trim_threshold = val;
<a name='L2534'>    <b>return</b> 1;
<a name='L2535'>  <b>case</b> <a href='../S/2317.html#L583' title='Defined at 583 in Modules/_ctypes/libffi/src/dlmalloc.c.'>M_GRANULARITY</a>:
<a name='L2536'>    <b>if</b> (val &gt;= mparams.page_size &amp;&amp; ((val &amp; (val-1)) == 0)) <font color='red'>{</font>
<a name='L2537'>      mparams.granularity = val;
<a name='L2538'>      <b>return</b> 1;
<a name='L2539'>    <font color='red'>}</font>
<a name='L2540'>    <b>else</b>
<a name='L2541'>      <b>return</b> 0;
<a name='L2542'>  <b>case</b> <a href='../S/2317.html#L584' title='Defined at 584 in Modules/_ctypes/libffi/src/dlmalloc.c.'>M_MMAP_THRESHOLD</a>:
<a name='L2543'>    mparams.mmap_threshold = val;
<a name='L2544'>    <b>return</b> 1;
<a name='L2545'>  <b>default</b>:
<a name='L2546'>    <b>return</b> 0;
<a name='L2547'>  <font color='red'>}</font>
<a name='L2548'><font color='red'>}</font>
<a name='L2549'>
<a name='L2550'><font color='darkred'>#if</font> <a href='../D/728.html' title='Multiple defined in 2 places.'>DEBUG</a>
<a name='L2551'><i><font color='green'>/* ------------------------- Debugging Support --------------------------- */</font></i>
<a name='L2552'>
<a name='L2553'><i><font color='green'>/* Check properties of any chunk, whether free, inuse, mmapped etc  */</font></i>
<a name='L2554'><b>static</b> <b>void</b> <a href='../R/7426.html' title='Multiple refered from 5 places.'>do_check_any_chunk</a>(mstate m, mchunkptr p) <font color='red'>{</font>
<a name='L2555'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>((<a href='../S/2317.html#L1260' title='Defined at 1260 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_aligned</a>(<a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(p))) || (p-&gt;head == <a href='../S/2317.html#L1664' title='Defined at 1664 in Modules/_ctypes/libffi/src/dlmalloc.c.'>FENCEPOST_HEAD</a>));
<a name='L2556'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../D/10195.html' title='Multiple defined in 2 places.'>ok_address</a>(m, p));
<a name='L2557'><font color='red'>}</font>
<a name='L2558'>
<a name='L2559'><i><font color='green'>/* Check properties of top chunk */</font></i>
<a name='L2560'><b>static</b> <b>void</b> <a href='../R/7433.html' title='Multiple refered from 3 places.'>do_check_top_chunk</a>(mstate m, mchunkptr p) <font color='red'>{</font>
<a name='L2561'>  <a href='../S/2317.html#L1925' title='Defined at 1925 in Modules/_ctypes/libffi/src/dlmalloc.c.'>msegmentptr</a> sp = <a href='../S/2317.html#L2098' title='Defined at 2098 in Modules/_ctypes/libffi/src/dlmalloc.c.'>segment_holding</a>(m, (<b>char</b>*)p);
<a name='L2562'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>  sz = <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(p);
<a name='L2563'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(sp != 0);
<a name='L2564'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>((<a href='../S/2317.html#L1260' title='Defined at 1260 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_aligned</a>(<a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(p))) || (p-&gt;head == <a href='../S/2317.html#L1664' title='Defined at 1664 in Modules/_ctypes/libffi/src/dlmalloc.c.'>FENCEPOST_HEAD</a>));
<a name='L2565'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../D/10195.html' title='Multiple defined in 2 places.'>ok_address</a>(m, p));
<a name='L2566'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(sz == m-&gt;topsize);
<a name='L2567'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(sz &gt; 0);
<a name='L2568'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(sz == ((sp-&gt;base + sp-&gt;size) - (<b>char</b>*)p) - <a href='../S/2317.html#L2130' title='Defined at 2130 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TOP_FOOT_SIZE</a>);
<a name='L2569'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../S/2317.html#L1668' title='Defined at 1668 in Modules/_ctypes/libffi/src/dlmalloc.c.'>pinuse</a>(p));
<a name='L2570'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(!<a href='../S/2317.html#L1683' title='Defined at 1683 in Modules/_ctypes/libffi/src/dlmalloc.c.'>next_pinuse</a>(p));
<a name='L2571'><font color='red'>}</font>
<a name='L2572'>
<a name='L2573'><i><font color='green'>/* Check properties of (inuse) mmapped chunks */</font></i>
<a name='L2574'><b>static</b> <b>void</b> <a href='../R/7431.html' title='Multiple refered from 3 places.'>do_check_mmapped_chunk</a>(mstate m, mchunkptr p) <font color='red'>{</font>
<a name='L2575'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>  sz = <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(p);
<a name='L2576'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> len = (sz + (p-&gt;prev_foot &amp; ~<a href='../D/1787.html' title='Multiple defined in 2 places.'>IS_MMAPPED_BIT</a>) + <a href='../S/2317.html#L1624' title='Defined at 1624 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MMAP_FOOT_PAD</a>);
<a name='L2577'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../S/2317.html#L1697' title='Defined at 1697 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_mmapped</a>(p));
<a name='L2578'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../S/2317.html#L2068' title='Defined at 2068 in Modules/_ctypes/libffi/src/dlmalloc.c.'>use_mmap</a>(m));
<a name='L2579'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>((<a href='../S/2317.html#L1260' title='Defined at 1260 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_aligned</a>(<a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(p))) || (p-&gt;head == <a href='../S/2317.html#L1664' title='Defined at 1664 in Modules/_ctypes/libffi/src/dlmalloc.c.'>FENCEPOST_HEAD</a>));
<a name='L2580'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../D/10195.html' title='Multiple defined in 2 places.'>ok_address</a>(m, p));
<a name='L2581'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(!<a href='../S/2317.html#L2227' title='Defined at 2227 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_small</a>(sz));
<a name='L2582'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>((len &amp; (mparams.page_size-<a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a>)) == 0);
<a name='L2583'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../S/2317.html#L1675' title='Defined at 1675 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk_plus_offset</a>(p, sz)-&gt;head == <a href='../S/2317.html#L1664' title='Defined at 1664 in Modules/_ctypes/libffi/src/dlmalloc.c.'>FENCEPOST_HEAD</a>);
<a name='L2584'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../S/2317.html#L1675' title='Defined at 1675 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk_plus_offset</a>(p, sz+<a href='../S/2317.html#L1243' title='Defined at 1243 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_SIZE</a>)-&gt;head == 0);
<a name='L2585'><font color='red'>}</font>
<a name='L2586'>
<a name='L2587'><i><font color='green'>/* Check properties of inuse chunks */</font></i>
<a name='L2588'><b>static</b> <b>void</b> <a href='../R/7428.html' title='Multiple refered from 5 places.'>do_check_inuse_chunk</a>(mstate m, mchunkptr p) <font color='red'>{</font>
<a name='L2589'>  <a href='../S/2317.html#L2554' title='Defined at 2554 in Modules/_ctypes/libffi/src/dlmalloc.c.'>do_check_any_chunk</a>(m, p);
<a name='L2590'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../S/2317.html#L1667' title='Defined at 1667 in Modules/_ctypes/libffi/src/dlmalloc.c.'>cinuse</a>(p));
<a name='L2591'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../S/2317.html#L1683' title='Defined at 1683 in Modules/_ctypes/libffi/src/dlmalloc.c.'>next_pinuse</a>(p));
<a name='L2592'>  <i><font color='green'>/* If not pinuse and not mmapped, previous chunk has OK offset */</font></i>
<a name='L2593'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../S/2317.html#L1697' title='Defined at 1697 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_mmapped</a>(p) || <a href='../S/2317.html#L1668' title='Defined at 1668 in Modules/_ctypes/libffi/src/dlmalloc.c.'>pinuse</a>(p) || <a href='../S/2317.html#L1679' title='Defined at 1679 in Modules/_ctypes/libffi/src/dlmalloc.c.'>next_chunk</a>(<a href='../S/2317.html#L1680' title='Defined at 1680 in Modules/_ctypes/libffi/src/dlmalloc.c.'>prev_chunk</a>(p)) == p);
<a name='L2594'>  <b>if</b> (<a href='../S/2317.html#L1697' title='Defined at 1697 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_mmapped</a>(p))
<a name='L2595'>    <a href='../S/2317.html#L2574' title='Defined at 2574 in Modules/_ctypes/libffi/src/dlmalloc.c.'>do_check_mmapped_chunk</a>(m, p);
<a name='L2596'><font color='red'>}</font>
<a name='L2597'>
<a name='L2598'><i><font color='green'>/* Check properties of free chunks */</font></i>
<a name='L2599'><b>static</b> <b>void</b> <a href='../R/7427.html' title='Multiple refered from 4 places.'>do_check_free_chunk</a>(mstate m, mchunkptr p) <font color='red'>{</font>
<a name='L2600'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> sz = p-&gt;head &amp; ~(<a href='../S/2317.html#L1659' title='Defined at 1659 in Modules/_ctypes/libffi/src/dlmalloc.c.'>PINUSE_BIT</a>|<a href='../S/2317.html#L1660' title='Defined at 1660 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CINUSE_BIT</a>);
<a name='L2601'>  <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> next = <a href='../S/2317.html#L1675' title='Defined at 1675 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk_plus_offset</a>(p, sz);
<a name='L2602'>  <a href='../S/2317.html#L2554' title='Defined at 2554 in Modules/_ctypes/libffi/src/dlmalloc.c.'>do_check_any_chunk</a>(m, p);
<a name='L2603'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(!<a href='../S/2317.html#L1667' title='Defined at 1667 in Modules/_ctypes/libffi/src/dlmalloc.c.'>cinuse</a>(p));
<a name='L2604'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(!<a href='../S/2317.html#L1683' title='Defined at 1683 in Modules/_ctypes/libffi/src/dlmalloc.c.'>next_pinuse</a>(p));
<a name='L2605'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a> (!<a href='../S/2317.html#L1697' title='Defined at 1697 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_mmapped</a>(p));
<a name='L2606'>  <b>if</b> (p != m-&gt;dv &amp;&amp; p != m-&gt;top) <font color='red'>{</font>
<a name='L2607'>    <b>if</b> (sz &gt;= <a href='../S/2317.html#L1627' title='Defined at 1627 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MIN_CHUNK_SIZE</a>) <font color='red'>{</font>
<a name='L2608'>      <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>((sz &amp; <a href='../S/2317.html#L1257' title='Defined at 1257 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CHUNK_ALIGN_MASK</a>) == 0);
<a name='L2609'>      <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../S/2317.html#L1260' title='Defined at 1260 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_aligned</a>(<a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(p)));
<a name='L2610'>      <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(next-&gt;prev_foot == sz);
<a name='L2611'>      <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../S/2317.html#L1668' title='Defined at 1668 in Modules/_ctypes/libffi/src/dlmalloc.c.'>pinuse</a>(p));
<a name='L2612'>      <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a> (next == m-&gt;top || <a href='../S/2317.html#L1667' title='Defined at 1667 in Modules/_ctypes/libffi/src/dlmalloc.c.'>cinuse</a>(next));
<a name='L2613'>      <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(p-&gt;fd-&gt;bk == p);
<a name='L2614'>      <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(p-&gt;bk-&gt;fd == p);
<a name='L2615'>    <font color='red'>}</font>
<a name='L2616'>    <b>else</b>  <i><font color='green'>/* markers are always of size SIZE_T_SIZE */</font></i>
<a name='L2617'>      <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(sz == <a href='../S/2317.html#L1243' title='Defined at 1243 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_SIZE</a>);
<a name='L2618'>  <font color='red'>}</font>
<a name='L2619'><font color='red'>}</font>
<a name='L2620'>
<a name='L2621'><i><font color='green'>/* Check properties of malloced chunks at the point they are malloced */</font></i>
<a name='L2622'><b>static</b> <b>void</b> <a href='../R/7430.html' title='Multiple refered from 2 places.'>do_check_malloced_chunk</a>(mstate m, <b>void</b>* mem, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> s) <font color='red'>{</font>
<a name='L2623'>  <b>if</b> (mem != 0) <font color='red'>{</font>
<a name='L2624'>    <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> p = <a href='../S/2317.html#L1632' title='Defined at 1632 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mem2chunk</a>(mem);
<a name='L2625'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> sz = p-&gt;head &amp; ~(<a href='../S/2317.html#L1659' title='Defined at 1659 in Modules/_ctypes/libffi/src/dlmalloc.c.'>PINUSE_BIT</a>|<a href='../S/2317.html#L1660' title='Defined at 1660 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CINUSE_BIT</a>);
<a name='L2626'>    <a href='../S/2317.html#L2588' title='Defined at 2588 in Modules/_ctypes/libffi/src/dlmalloc.c.'>do_check_inuse_chunk</a>(m, p);
<a name='L2627'>    <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>((sz &amp; <a href='../S/2317.html#L1257' title='Defined at 1257 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CHUNK_ALIGN_MASK</a>) == 0);
<a name='L2628'>    <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(sz &gt;= <a href='../S/2317.html#L1627' title='Defined at 1627 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MIN_CHUNK_SIZE</a>);
<a name='L2629'>    <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(sz &gt;= s);
<a name='L2630'>    <i><font color='green'>/* unless mmapped, size is less than MIN_CHUNK_SIZE more than request */</font></i>
<a name='L2631'>    <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../S/2317.html#L1697' title='Defined at 1697 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_mmapped</a>(p) || sz &lt; (s + <a href='../S/2317.html#L1627' title='Defined at 1627 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MIN_CHUNK_SIZE</a>));
<a name='L2632'>  <font color='red'>}</font>
<a name='L2633'><font color='red'>}</font>
<a name='L2634'>
<a name='L2635'><i><font color='green'>/* Check a tree and its subtrees.  */</font></i>
<a name='L2636'><b>static</b> <b>void</b> <a href='../R/7434.html' title='Multiple refered from 4 places.'>do_check_tree</a>(mstate m, tchunkptr t) <font color='red'>{</font>
<a name='L2637'>  <a href='../S/2317.html#L1815' title='Defined at 1815 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tchunkptr</a> head = 0;
<a name='L2638'>  <a href='../S/2317.html#L1815' title='Defined at 1815 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tchunkptr</a> u = t;
<a name='L2639'>  <a href='../S/2317.html#L1607' title='Defined at 1607 in Modules/_ctypes/libffi/src/dlmalloc.c.'>bindex_t</a> tindex = t-&gt;index;
<a name='L2640'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> tsize = <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(t);
<a name='L2641'>  <a href='../S/2317.html#L1607' title='Defined at 1607 in Modules/_ctypes/libffi/src/dlmalloc.c.'>bindex_t</a> idx;
<a name='L2642'>  <a href='../D/7736.html' title='Multiple defined in 2 places.'>compute_tree_index</a>(tsize, idx);
<a name='L2643'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(tindex == idx);
<a name='L2644'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(tsize &gt;= <a href='../S/2317.html#L2008' title='Defined at 2008 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MIN_LARGE_SIZE</a>);
<a name='L2645'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(tsize &gt;= <a href='../S/2317.html#L2281' title='Defined at 2281 in Modules/_ctypes/libffi/src/dlmalloc.c.'>minsize_for_tree_index</a>(idx));
<a name='L2646'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>((idx == <a href='../S/2317.html#L2004' title='Defined at 2004 in Modules/_ctypes/libffi/src/dlmalloc.c.'>NTREEBINS</a>-1) || (tsize &lt; <a href='../S/2317.html#L2281' title='Defined at 2281 in Modules/_ctypes/libffi/src/dlmalloc.c.'>minsize_for_tree_index</a>((idx+1))));
<a name='L2647'>
<a name='L2648'>  <b>do</b> <font color='red'>{</font> <i><font color='green'>/* traverse through chain of same-sized nodes */</font></i>
<a name='L2649'>    <a href='../S/2317.html#L2554' title='Defined at 2554 in Modules/_ctypes/libffi/src/dlmalloc.c.'>do_check_any_chunk</a>(m, ((<a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a>)u));
<a name='L2650'>    <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(u-&gt;index == tindex);
<a name='L2651'>    <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(u) == tsize);
<a name='L2652'>    <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(!<a href='../S/2317.html#L1667' title='Defined at 1667 in Modules/_ctypes/libffi/src/dlmalloc.c.'>cinuse</a>(u));
<a name='L2653'>    <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(!<a href='../S/2317.html#L1683' title='Defined at 1683 in Modules/_ctypes/libffi/src/dlmalloc.c.'>next_pinuse</a>(u));
<a name='L2654'>    <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(u-&gt;fd-&gt;bk == u);
<a name='L2655'>    <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(u-&gt;bk-&gt;fd == u);
<a name='L2656'>    <b>if</b> (u-&gt;parent == 0) <font color='red'>{</font>
<a name='L2657'>      <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(u-&gt;child[0] == 0);
<a name='L2658'>      <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(u-&gt;child[1] == 0);
<a name='L2659'>    <font color='red'>}</font>
<a name='L2660'>    <b>else</b> <font color='red'>{</font>
<a name='L2661'>      <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(head == 0); <i><font color='green'>/* only one node on chain has parent */</font></i>
<a name='L2662'>      head = u;
<a name='L2663'>      <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(u-&gt;parent != u);
<a name='L2664'>      <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a> (u-&gt;parent-&gt;child[0] == u ||
<a name='L2665'>              u-&gt;parent-&gt;child[1] == u ||
<a name='L2666'>              *((<a href='../S/2317.html#L1816' title='Defined at 1816 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tbinptr</a>*)(u-&gt;parent)) == u);
<a name='L2667'>      <b>if</b> (u-&gt;child[0] != 0) <font color='red'>{</font>
<a name='L2668'>        <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(u-&gt;child[0]-&gt;parent == u);
<a name='L2669'>        <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(u-&gt;child[0] != u);
<a name='L2670'>        <a href='../S/2317.html#L2636' title='Defined at 2636 in Modules/_ctypes/libffi/src/dlmalloc.c.'>do_check_tree</a>(m, u-&gt;child[0]);
<a name='L2671'>      <font color='red'>}</font>
<a name='L2672'>      <b>if</b> (u-&gt;child[1] != 0) <font color='red'>{</font>
<a name='L2673'>        <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(u-&gt;child[1]-&gt;parent == u);
<a name='L2674'>        <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(u-&gt;child[1] != u);
<a name='L2675'>        <a href='../S/2317.html#L2636' title='Defined at 2636 in Modules/_ctypes/libffi/src/dlmalloc.c.'>do_check_tree</a>(m, u-&gt;child[1]);
<a name='L2676'>      <font color='red'>}</font>
<a name='L2677'>      <b>if</b> (u-&gt;child[0] != 0 &amp;&amp; u-&gt;child[1] != 0) <font color='red'>{</font>
<a name='L2678'>        <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(u-&gt;child[0]) &lt; <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(u-&gt;child[1]));
<a name='L2679'>      <font color='red'>}</font>
<a name='L2680'>    <font color='red'>}</font>
<a name='L2681'>    u = u-&gt;fd;
<a name='L2682'>  <font color='red'>}</font> <b>while</b> (u != t);
<a name='L2683'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(head != 0);
<a name='L2684'><font color='red'>}</font>
<a name='L2685'>
<a name='L2686'><i><font color='green'>/*  Check all the chunks in a treebin.  */</font></i>
<a name='L2687'><b>static</b> <b>void</b> <a href='../R/7435.html' title='Multiple refered from 2 places.'>do_check_treebin</a>(mstate m, <a href='../S/2317.html#L1607' title='Defined at 1607 in Modules/_ctypes/libffi/src/dlmalloc.c.'>bindex_t</a> i) <font color='red'>{</font>
<a name='L2688'>  <a href='../S/2317.html#L1816' title='Defined at 1816 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tbinptr</a>* tb = <a href='../S/2317.html#L2234' title='Defined at 2234 in Modules/_ctypes/libffi/src/dlmalloc.c.'>treebin_at</a>(m, i);
<a name='L2689'>  <a href='../S/2317.html#L1815' title='Defined at 1815 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tchunkptr</a> t = *tb;
<a name='L2690'>  <b>int</b> empty = (m-&gt;treemap &amp; (1U &lt;&lt; i)) == 0;
<a name='L2691'>  <b>if</b> (t == 0)
<a name='L2692'>    <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(empty);
<a name='L2693'>  <b>if</b> (!empty)
<a name='L2694'>    <a href='../S/2317.html#L2636' title='Defined at 2636 in Modules/_ctypes/libffi/src/dlmalloc.c.'>do_check_tree</a>(m, t);
<a name='L2695'><font color='red'>}</font>
<a name='L2696'>
<a name='L2697'><i><font color='green'>/*  Check all the chunks in a smallbin.  */</font></i>
<a name='L2698'><b>static</b> <b>void</b> <a href='../R/7432.html' title='Multiple refered from 2 places.'>do_check_smallbin</a>(mstate m, <a href='../S/2317.html#L1607' title='Defined at 1607 in Modules/_ctypes/libffi/src/dlmalloc.c.'>bindex_t</a> i) <font color='red'>{</font>
<a name='L2699'>  <a href='../S/2317.html#L1606' title='Defined at 1606 in Modules/_ctypes/libffi/src/dlmalloc.c.'>sbinptr</a> <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a> = <a href='../S/2317.html#L2233' title='Defined at 2233 in Modules/_ctypes/libffi/src/dlmalloc.c.'>smallbin_at</a>(m, i);
<a name='L2700'>  <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> p = <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a>-&gt;bk;
<a name='L2701'>  <b>unsigned</b> <b>int</b> empty = (m-&gt;smallmap &amp; (1U &lt;&lt; i)) == 0;
<a name='L2702'>  <b>if</b> (p == <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a>)
<a name='L2703'>    <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(empty);
<a name='L2704'>  <b>if</b> (!empty) <font color='red'>{</font>
<a name='L2705'>    <b>for</b> (; p != <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a>; p = p-&gt;bk) <font color='red'>{</font>
<a name='L2706'>      <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> size = <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(p);
<a name='L2707'>      <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> q;
<a name='L2708'>      <i><font color='green'>/* each chunk claims to be free */</font></i>
<a name='L2709'>      <a href='../S/2317.html#L2599' title='Defined at 2599 in Modules/_ctypes/libffi/src/dlmalloc.c.'>do_check_free_chunk</a>(m, p);
<a name='L2710'>      <i><font color='green'>/* chunk belongs in bin */</font></i>
<a name='L2711'>      <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../S/2317.html#L2228' title='Defined at 2228 in Modules/_ctypes/libffi/src/dlmalloc.c.'>small_index</a>(size) == i);
<a name='L2712'>      <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(p-&gt;bk == <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a> || <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(p-&gt;bk) == <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(p));
<a name='L2713'>      <i><font color='green'>/* chunk is followed by an inuse chunk */</font></i>
<a name='L2714'>      q = <a href='../S/2317.html#L1679' title='Defined at 1679 in Modules/_ctypes/libffi/src/dlmalloc.c.'>next_chunk</a>(p);
<a name='L2715'>      <b>if</b> (q-&gt;head != <a href='../S/2317.html#L1664' title='Defined at 1664 in Modules/_ctypes/libffi/src/dlmalloc.c.'>FENCEPOST_HEAD</a>)
<a name='L2716'>        <a href='../S/2317.html#L2588' title='Defined at 2588 in Modules/_ctypes/libffi/src/dlmalloc.c.'>do_check_inuse_chunk</a>(m, q);
<a name='L2717'>    <font color='red'>}</font>
<a name='L2718'>  <font color='red'>}</font>
<a name='L2719'><font color='red'>}</font>
<a name='L2720'>
<a name='L2721'><i><font color='green'>/* Find x in a bin. Used in other check functions. */</font></i>
<a name='L2722'><b>static</b> <b>int</b> <a href='../R/6214.html' title='Multiple refered from 5 places.'>bin_find</a>(mstate m, mchunkptr x) <font color='red'>{</font>
<a name='L2723'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> size = <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(x);
<a name='L2724'>  <b>if</b> (<a href='../S/2317.html#L2227' title='Defined at 2227 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_small</a>(size)) <font color='red'>{</font>
<a name='L2725'>    <a href='../S/2317.html#L1607' title='Defined at 1607 in Modules/_ctypes/libffi/src/dlmalloc.c.'>bindex_t</a> sidx = <a href='../S/2317.html#L2228' title='Defined at 2228 in Modules/_ctypes/libffi/src/dlmalloc.c.'>small_index</a>(size);
<a name='L2726'>    <a href='../S/2317.html#L1606' title='Defined at 1606 in Modules/_ctypes/libffi/src/dlmalloc.c.'>sbinptr</a> <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a> = <a href='../S/2317.html#L2233' title='Defined at 2233 in Modules/_ctypes/libffi/src/dlmalloc.c.'>smallbin_at</a>(m, sidx);
<a name='L2727'>    <b>if</b> (<a href='../S/2317.html#L2294' title='Defined at 2294 in Modules/_ctypes/libffi/src/dlmalloc.c.'>smallmap_is_marked</a>(m, sidx)) <font color='red'>{</font>
<a name='L2728'>      <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> p = <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a>;
<a name='L2729'>      <b>do</b> <font color='red'>{</font>
<a name='L2730'>        <b>if</b> (p == x)
<a name='L2731'>          <b>return</b> 1;
<a name='L2732'>      <font color='red'>}</font> <b>while</b> ((p = p-&gt;fd) != <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a>);
<a name='L2733'>    <font color='red'>}</font>
<a name='L2734'>  <font color='red'>}</font>
<a name='L2735'>  <b>else</b> <font color='red'>{</font>
<a name='L2736'>    <a href='../S/2317.html#L1607' title='Defined at 1607 in Modules/_ctypes/libffi/src/dlmalloc.c.'>bindex_t</a> tidx;
<a name='L2737'>    <a href='../D/7736.html' title='Multiple defined in 2 places.'>compute_tree_index</a>(size, tidx);
<a name='L2738'>    <b>if</b> (<a href='../S/2317.html#L2298' title='Defined at 2298 in Modules/_ctypes/libffi/src/dlmalloc.c.'>treemap_is_marked</a>(m, tidx)) <font color='red'>{</font>
<a name='L2739'>      <a href='../S/2317.html#L1815' title='Defined at 1815 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tchunkptr</a> t = *<a href='../S/2317.html#L2234' title='Defined at 2234 in Modules/_ctypes/libffi/src/dlmalloc.c.'>treebin_at</a>(m, tidx);
<a name='L2740'>      <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> sizebits = size &lt;&lt; <a href='../S/2317.html#L2276' title='Defined at 2276 in Modules/_ctypes/libffi/src/dlmalloc.c.'>leftshift_for_tree_index</a>(tidx);
<a name='L2741'>      <b>while</b> (t != 0 &amp;&amp; <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(t) != size) <font color='red'>{</font>
<a name='L2742'>        t = t-&gt;child[(sizebits &gt;&gt; (<a href='../S/2317.html#L1244' title='Defined at 1244 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_BITSIZE</a>-<a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a>)) &amp; 1];
<a name='L2743'>        sizebits &lt;&lt;= 1;
<a name='L2744'>      <font color='red'>}</font>
<a name='L2745'>      <b>if</b> (t != 0) <font color='red'>{</font>
<a name='L2746'>        <a href='../S/2317.html#L1815' title='Defined at 1815 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tchunkptr</a> u = t;
<a name='L2747'>        <b>do</b> <font color='red'>{</font>
<a name='L2748'>          <b>if</b> (u == (<a href='../S/2317.html#L1815' title='Defined at 1815 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tchunkptr</a>)x)
<a name='L2749'>            <b>return</b> 1;
<a name='L2750'>        <font color='red'>}</font> <b>while</b> ((u = u-&gt;fd) != t);
<a name='L2751'>      <font color='red'>}</font>
<a name='L2752'>    <font color='red'>}</font>
<a name='L2753'>  <font color='red'>}</font>
<a name='L2754'>  <b>return</b> 0;
<a name='L2755'><font color='red'>}</font>
<a name='L2756'>
<a name='L2757'><i><font color='green'>/* Traverse each chunk and check it; return total */</font></i>
<a name='L2758'><b>static</b> <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> <a href='../R/10951.html' title='Multiple refered from 2 places.'>traverse_and_check</a>(mstate m) <font color='red'>{</font>
<a name='L2759'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> sum = 0;
<a name='L2760'>  <b>if</b> (<a href='../S/2317.html#L2058' title='Defined at 2058 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_initialized</a>(m)) <font color='red'>{</font>
<a name='L2761'>    <a href='../S/2317.html#L1925' title='Defined at 1925 in Modules/_ctypes/libffi/src/dlmalloc.c.'>msegmentptr</a> s = &amp;m-&gt;seg;
<a name='L2762'>    sum += m-&gt;topsize + <a href='../S/2317.html#L2130' title='Defined at 2130 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TOP_FOOT_SIZE</a>;
<a name='L2763'>    <b>while</b> (s != 0) <font color='red'>{</font>
<a name='L2764'>      <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> q = <a href='../S/2317.html#L1634' title='Defined at 1634 in Modules/_ctypes/libffi/src/dlmalloc.c.'>align_as_chunk</a>(s-&gt;base);
<a name='L2765'>      <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> lastq = 0;
<a name='L2766'>      <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../S/2317.html#L1668' title='Defined at 1668 in Modules/_ctypes/libffi/src/dlmalloc.c.'>pinuse</a>(q));
<a name='L2767'>      <b>while</b> (<a href='../S/2317.html#L2094' title='Defined at 2094 in Modules/_ctypes/libffi/src/dlmalloc.c.'>segment_holds</a>(s, q) &amp;&amp;
<a name='L2768'>             q != m-&gt;top &amp;&amp; q-&gt;head != <a href='../S/2317.html#L1664' title='Defined at 1664 in Modules/_ctypes/libffi/src/dlmalloc.c.'>FENCEPOST_HEAD</a>) <font color='red'>{</font>
<a name='L2769'>        sum += <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(q);
<a name='L2770'>        <b>if</b> (<a href='../S/2317.html#L1667' title='Defined at 1667 in Modules/_ctypes/libffi/src/dlmalloc.c.'>cinuse</a>(q)) <font color='red'>{</font>
<a name='L2771'>          <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(!<a href='../S/2317.html#L2722' title='Defined at 2722 in Modules/_ctypes/libffi/src/dlmalloc.c.'>bin_find</a>(m, q));
<a name='L2772'>          <a href='../S/2317.html#L2588' title='Defined at 2588 in Modules/_ctypes/libffi/src/dlmalloc.c.'>do_check_inuse_chunk</a>(m, q);
<a name='L2773'>        <font color='red'>}</font>
<a name='L2774'>        <b>else</b> <font color='red'>{</font>
<a name='L2775'>          <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(q == m-&gt;dv || <a href='../S/2317.html#L2722' title='Defined at 2722 in Modules/_ctypes/libffi/src/dlmalloc.c.'>bin_find</a>(m, q));
<a name='L2776'>          <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(lastq == 0 || <a href='../S/2317.html#L1667' title='Defined at 1667 in Modules/_ctypes/libffi/src/dlmalloc.c.'>cinuse</a>(lastq)); <i><font color='green'>/* Not 2 consecutive free */</font></i>
<a name='L2777'>          <a href='../S/2317.html#L2599' title='Defined at 2599 in Modules/_ctypes/libffi/src/dlmalloc.c.'>do_check_free_chunk</a>(m, q);
<a name='L2778'>        <font color='red'>}</font>
<a name='L2779'>        lastq = q;
<a name='L2780'>        q = <a href='../S/2317.html#L1679' title='Defined at 1679 in Modules/_ctypes/libffi/src/dlmalloc.c.'>next_chunk</a>(q);
<a name='L2781'>      <font color='red'>}</font>
<a name='L2782'>      s = s-&gt;next;
<a name='L2783'>    <font color='red'>}</font>
<a name='L2784'>  <font color='red'>}</font>
<a name='L2785'>  <b>return</b> sum;
<a name='L2786'><font color='red'>}</font>
<a name='L2787'>
<a name='L2788'><i><font color='green'>/* Check all properties of malloc_state. */</font></i>
<a name='L2789'><b>static</b> <b>void</b> <a href='../R/7429.html' title='Multiple refered from 2 places.'>do_check_malloc_state</a>(mstate m) <font color='red'>{</font>
<a name='L2790'>  <a href='../S/2317.html#L1607' title='Defined at 1607 in Modules/_ctypes/libffi/src/dlmalloc.c.'>bindex_t</a> i;
<a name='L2791'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> total;
<a name='L2792'>  <i><font color='green'>/* check bins */</font></i>
<a name='L2793'>  <b>for</b> (i = 0; i &lt; <a href='../S/2317.html#L2003' title='Defined at 2003 in Modules/_ctypes/libffi/src/dlmalloc.c.'>NSMALLBINS</a>; ++i)
<a name='L2794'>    <a href='../S/2317.html#L2698' title='Defined at 2698 in Modules/_ctypes/libffi/src/dlmalloc.c.'>do_check_smallbin</a>(m, i);
<a name='L2795'>  <b>for</b> (i = 0; i &lt; <a href='../S/2317.html#L2004' title='Defined at 2004 in Modules/_ctypes/libffi/src/dlmalloc.c.'>NTREEBINS</a>; ++i)
<a name='L2796'>    <a href='../S/2317.html#L2687' title='Defined at 2687 in Modules/_ctypes/libffi/src/dlmalloc.c.'>do_check_treebin</a>(m, i);
<a name='L2797'>
<a name='L2798'>  <b>if</b> (m-&gt;dvsize != 0) <font color='red'>{</font> <i><font color='green'>/* check dv chunk */</font></i>
<a name='L2799'>    <a href='../S/2317.html#L2554' title='Defined at 2554 in Modules/_ctypes/libffi/src/dlmalloc.c.'>do_check_any_chunk</a>(m, m-&gt;dv);
<a name='L2800'>    <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(m-&gt;dvsize == <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(m-&gt;dv));
<a name='L2801'>    <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(m-&gt;dvsize &gt;= <a href='../S/2317.html#L1627' title='Defined at 1627 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MIN_CHUNK_SIZE</a>);
<a name='L2802'>    <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../S/2317.html#L2722' title='Defined at 2722 in Modules/_ctypes/libffi/src/dlmalloc.c.'>bin_find</a>(m, m-&gt;dv) == 0);
<a name='L2803'>  <font color='red'>}</font>
<a name='L2804'>
<a name='L2805'>  <b>if</b> (m-&gt;top != 0) <font color='red'>{</font>   <i><font color='green'>/* check top chunk */</font></i>
<a name='L2806'>    <a href='../S/2317.html#L2560' title='Defined at 2560 in Modules/_ctypes/libffi/src/dlmalloc.c.'>do_check_top_chunk</a>(m, m-&gt;top);
<a name='L2807'>    <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(m-&gt;topsize == <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(m-&gt;top));
<a name='L2808'>    <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(m-&gt;topsize &gt; 0);
<a name='L2809'>    <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../S/2317.html#L2722' title='Defined at 2722 in Modules/_ctypes/libffi/src/dlmalloc.c.'>bin_find</a>(m, m-&gt;top) == 0);
<a name='L2810'>  <font color='red'>}</font>
<a name='L2811'>
<a name='L2812'>  total = <a href='../S/2317.html#L2758' title='Defined at 2758 in Modules/_ctypes/libffi/src/dlmalloc.c.'>traverse_and_check</a>(m);
<a name='L2813'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(total &lt;= m-&gt;footprint);
<a name='L2814'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(m-&gt;footprint &lt;= m-&gt;max_footprint);
<a name='L2815'><font color='red'>}</font>
<a name='L2816'><font color='darkred'>#endif</font> <i><font color='green'>/* DEBUG */</font></i>
<a name='L2817'>
<a name='L2818'><i><font color='green'>/* ----------------------------- statistics ------------------------------ */</font></i>
<a name='L2819'>
<a name='L2820'><font color='darkred'>#if</font> !<a href='../D/2331.html' title='Multiple defined in 2 places.'>NO_MALLINFO</a>
<a name='L2821'><b>static</b> <b>struct</b> <a href='../S/2317.html#L617' title='Defined at 617 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mallinfo</a> <a href='../R/8449.html' title='Multiple refered from 2 places.'>internal_mallinfo</a>(mstate m) <font color='red'>{</font>
<a name='L2822'>  <b>struct</b> <a href='../S/2317.html#L617' title='Defined at 617 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mallinfo</a> nm = <font color='red'>{</font> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 <font color='red'>}</font>;
<a name='L2823'>  <b>if</b> (!<a href='../D/2519.html' title='Multiple defined in 2 places.'>PREACTION</a>(m)) <font color='red'>{</font>
<a name='L2824'>    <a href='../D/7407.html' title='Multiple defined in 2 places.'>check_malloc_state</a>(m);
<a name='L2825'>    <b>if</b> (<a href='../S/2317.html#L2058' title='Defined at 2058 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_initialized</a>(m)) <font color='red'>{</font>
<a name='L2826'>      <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> nfree = <a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a>; <i><font color='green'>/* top always free */</font></i>
<a name='L2827'>      <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> mfree = m-&gt;topsize + <a href='../S/2317.html#L2130' title='Defined at 2130 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TOP_FOOT_SIZE</a>;
<a name='L2828'>      <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> sum = mfree;
<a name='L2829'>      <a href='../S/2317.html#L1925' title='Defined at 1925 in Modules/_ctypes/libffi/src/dlmalloc.c.'>msegmentptr</a> s = &amp;m-&gt;seg;
<a name='L2830'>      <b>while</b> (s != 0) <font color='red'>{</font>
<a name='L2831'>        <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> q = <a href='../S/2317.html#L1634' title='Defined at 1634 in Modules/_ctypes/libffi/src/dlmalloc.c.'>align_as_chunk</a>(s-&gt;base);
<a name='L2832'>        <b>while</b> (<a href='../S/2317.html#L2094' title='Defined at 2094 in Modules/_ctypes/libffi/src/dlmalloc.c.'>segment_holds</a>(s, q) &amp;&amp;
<a name='L2833'>               q != m-&gt;top &amp;&amp; q-&gt;head != <a href='../S/2317.html#L1664' title='Defined at 1664 in Modules/_ctypes/libffi/src/dlmalloc.c.'>FENCEPOST_HEAD</a>) <font color='red'>{</font>
<a name='L2834'>          <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> sz = <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(q);
<a name='L2835'>          sum += sz;
<a name='L2836'>          <b>if</b> (!<a href='../S/2317.html#L1667' title='Defined at 1667 in Modules/_ctypes/libffi/src/dlmalloc.c.'>cinuse</a>(q)) <font color='red'>{</font>
<a name='L2837'>            mfree += sz;
<a name='L2838'>            ++nfree;
<a name='L2839'>          <font color='red'>}</font>
<a name='L2840'>          q = <a href='../S/2317.html#L1679' title='Defined at 1679 in Modules/_ctypes/libffi/src/dlmalloc.c.'>next_chunk</a>(q);
<a name='L2841'>        <font color='red'>}</font>
<a name='L2842'>        s = s-&gt;next;
<a name='L2843'>      <font color='red'>}</font>
<a name='L2844'>
<a name='L2845'>      nm.arena    = sum;
<a name='L2846'>      nm.ordblks  = nfree;
<a name='L2847'>      nm.hblkhd   = m-&gt;footprint - sum;
<a name='L2848'>      nm.usmblks  = m-&gt;max_footprint;
<a name='L2849'>      nm.uordblks = m-&gt;footprint - mfree;
<a name='L2850'>      nm.fordblks = mfree;
<a name='L2851'>      nm.keepcost = m-&gt;topsize;
<a name='L2852'>    <font color='red'>}</font>
<a name='L2853'>
<a name='L2854'>    <a href='../D/2515.html' title='Multiple defined in 2 places.'>POSTACTION</a>(m);
<a name='L2855'>  <font color='red'>}</font>
<a name='L2856'>  <b>return</b> nm;
<a name='L2857'><font color='red'>}</font>
<a name='L2858'><font color='darkred'>#endif</font> <i><font color='green'>/* !NO_MALLINFO */</font></i>
<a name='L2859'>
<a name='L2860'><b>static</b> <b>void</b> <a href='../R/8451.html' title='Multiple refered from 2 places.'>internal_malloc_stats</a>(mstate m) <font color='red'>{</font>
<a name='L2861'>  <b>if</b> (!<a href='../D/2519.html' title='Multiple defined in 2 places.'>PREACTION</a>(m)) <font color='red'>{</font>
<a name='L2862'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> maxfp = 0;
<a name='L2863'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> fp = 0;
<a name='L2864'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> used = 0;
<a name='L2865'>    <a href='../D/7407.html' title='Multiple defined in 2 places.'>check_malloc_state</a>(m);
<a name='L2866'>    <b>if</b> (<a href='../S/2317.html#L2058' title='Defined at 2058 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_initialized</a>(m)) <font color='red'>{</font>
<a name='L2867'>      <a href='../S/2317.html#L1925' title='Defined at 1925 in Modules/_ctypes/libffi/src/dlmalloc.c.'>msegmentptr</a> s = &amp;m-&gt;seg;
<a name='L2868'>      maxfp = m-&gt;max_footprint;
<a name='L2869'>      fp = m-&gt;footprint;
<a name='L2870'>      used = fp - (m-&gt;topsize + <a href='../S/2317.html#L2130' title='Defined at 2130 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TOP_FOOT_SIZE</a>);
<a name='L2871'>
<a name='L2872'>      <b>while</b> (s != 0) <font color='red'>{</font>
<a name='L2873'>        <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> q = <a href='../S/2317.html#L1634' title='Defined at 1634 in Modules/_ctypes/libffi/src/dlmalloc.c.'>align_as_chunk</a>(s-&gt;base);
<a name='L2874'>        <b>while</b> (<a href='../S/2317.html#L2094' title='Defined at 2094 in Modules/_ctypes/libffi/src/dlmalloc.c.'>segment_holds</a>(s, q) &amp;&amp;
<a name='L2875'>               q != m-&gt;top &amp;&amp; q-&gt;head != <a href='../S/2317.html#L1664' title='Defined at 1664 in Modules/_ctypes/libffi/src/dlmalloc.c.'>FENCEPOST_HEAD</a>) <font color='red'>{</font>
<a name='L2876'>          <b>if</b> (!<a href='../S/2317.html#L1667' title='Defined at 1667 in Modules/_ctypes/libffi/src/dlmalloc.c.'>cinuse</a>(q))
<a name='L2877'>            used -= <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(q);
<a name='L2878'>          q = <a href='../S/2317.html#L1679' title='Defined at 1679 in Modules/_ctypes/libffi/src/dlmalloc.c.'>next_chunk</a>(q);
<a name='L2879'>        <font color='red'>}</font>
<a name='L2880'>        s = s-&gt;next;
<a name='L2881'>      <font color='red'>}</font>
<a name='L2882'>    <font color='red'>}</font>
<a name='L2883'>
<a name='L2884'>    fprintf(stderr, "max system bytes = %10lu\n", (<b>unsigned</b> <b>long</b>)(maxfp));
<a name='L2885'>    fprintf(stderr, "system bytes     = %10lu\n", (<b>unsigned</b> <b>long</b>)(fp));
<a name='L2886'>    fprintf(stderr, "in use bytes     = %10lu\n", (<b>unsigned</b> <b>long</b>)(used));
<a name='L2887'>
<a name='L2888'>    <a href='../D/2515.html' title='Multiple defined in 2 places.'>POSTACTION</a>(m);
<a name='L2889'>  <font color='red'>}</font>
<a name='L2890'><font color='red'>}</font>
<a name='L2891'>
<a name='L2892'><i><font color='green'>/* ----------------------- Operations on smallbins ----------------------- */</font></i>
<a name='L2893'>
<a name='L2894'><i><font color='green'>/*</font></i>
<a name='L2895'><i><font color='green'>  Various forms of linking and unlinking are defined as macros.  Even</font></i>
<a name='L2896'><i><font color='green'>  the ones for trees, which are very long but have very short typical</font></i>
<a name='L2897'><i><font color='green'>  paths.  This is ugly but reduces reliance on inlining support of</font></i>
<a name='L2898'><i><font color='green'>  compilers.</font></i>
<a name='L2899'><i><font color='green'>*/</font></i>
<a name='L2900'>
<a name='L2901'><i><font color='green'>/* Link a free chunk into a smallbin  */</font></i>
<a name='L2902'><font color='darkred'>#define</font> <a href='../R/8415.html' title='Multiple refered from 2 places.'>insert_small_chunk</a>(M, P, S) <font color='red'>{</font>\
<a name='L2903'>  <a href='../S/2317.html#L1607' title='Defined at 1607 in Modules/_ctypes/libffi/src/dlmalloc.c.'>bindex_t</a> <a href='../S/2690.html#L104' title='Defined at 104 in Modules/md5module.c.'>I</a>  = <a href='../S/2317.html#L2228' title='Defined at 2228 in Modules/_ctypes/libffi/src/dlmalloc.c.'>small_index</a>(<a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>);\
<a name='L2904'>  <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> <a href='../D/233.html' title='Multiple defined in 18 places.'>B</a> = <a href='../S/2317.html#L2233' title='Defined at 2233 in Modules/_ctypes/libffi/src/dlmalloc.c.'>smallbin_at</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>, <a href='../S/2690.html#L104' title='Defined at 104 in Modules/md5module.c.'>I</a>);\
<a name='L2905'>  <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> <a href='../S/2690.html#L101' title='Defined at 101 in Modules/md5module.c.'>F</a> = <a href='../D/233.html' title='Multiple defined in 18 places.'>B</a>;\
<a name='L2906'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a> &gt;= <a href='../S/2317.html#L1627' title='Defined at 1627 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MIN_CHUNK_SIZE</a>);\
<a name='L2907'>  <b>if</b> (!<a href='../S/2317.html#L2294' title='Defined at 2294 in Modules/_ctypes/libffi/src/dlmalloc.c.'>smallmap_is_marked</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>, <a href='../S/2690.html#L104' title='Defined at 104 in Modules/md5module.c.'>I</a>))\
<a name='L2908'>    <a href='../S/2317.html#L2292' title='Defined at 2292 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mark_smallmap</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>, <a href='../S/2690.html#L104' title='Defined at 104 in Modules/md5module.c.'>I</a>);\
<a name='L2909'>  <b>else</b> <b>if</b> (<a href='../D/4519.html' title='Multiple defined in 3 places.'>RTCHECK</a>(<a href='../D/10195.html' title='Multiple defined in 2 places.'>ok_address</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>, <a href='../D/233.html' title='Multiple defined in 18 places.'>B</a>-&gt;fd)))\
<a name='L2910'>    <a href='../S/2690.html#L101' title='Defined at 101 in Modules/md5module.c.'>F</a> = <a href='../D/233.html' title='Multiple defined in 18 places.'>B</a>-&gt;fd;\
<a name='L2911'>  <b>else</b> <font color='red'>{</font>\
<a name='L2912'>    <a href='../D/635.html' title='Multiple defined in 2 places.'>CORRUPTION_ERROR_ACTION</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>);\
<a name='L2913'>  <font color='red'>}</font>\
<a name='L2914'>  <a href='../D/233.html' title='Multiple defined in 18 places.'>B</a>-&gt;fd = <a href='../D/2444.html' title='Multiple defined in 2 places.'>P</a>;\
<a name='L2915'>  <a href='../S/2690.html#L101' title='Defined at 101 in Modules/md5module.c.'>F</a>-&gt;bk = <a href='../D/2444.html' title='Multiple defined in 2 places.'>P</a>;\
<a name='L2916'>  <a href='../D/2444.html' title='Multiple defined in 2 places.'>P</a>-&gt;fd = <a href='../S/2690.html#L101' title='Defined at 101 in Modules/md5module.c.'>F</a>;\
<a name='L2917'>  <a href='../D/2444.html' title='Multiple defined in 2 places.'>P</a>-&gt;bk = <a href='../D/233.html' title='Multiple defined in 18 places.'>B</a>;\
<a name='L2918'><font color='red'>}</font>
<a name='L2919'>
<a name='L2920'><i><font color='green'>/* Unlink a chunk from a smallbin  */</font></i>
<a name='L2921'><font color='darkred'>#define</font> <a href='../S/2317.html#L3119' title='Refered from 3119 in Modules/_ctypes/libffi/src/dlmalloc.c.'>unlink_small_chunk</a>(M, P, S) <font color='red'>{</font>\
<a name='L2922'>  <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> <a href='../S/2690.html#L101' title='Defined at 101 in Modules/md5module.c.'>F</a> = <a href='../D/2444.html' title='Multiple defined in 2 places.'>P</a>-&gt;fd;\
<a name='L2923'>  <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> <a href='../D/233.html' title='Multiple defined in 18 places.'>B</a> = <a href='../D/2444.html' title='Multiple defined in 2 places.'>P</a>-&gt;bk;\
<a name='L2924'>  <a href='../S/2317.html#L1607' title='Defined at 1607 in Modules/_ctypes/libffi/src/dlmalloc.c.'>bindex_t</a> <a href='../S/2690.html#L104' title='Defined at 104 in Modules/md5module.c.'>I</a> = <a href='../S/2317.html#L2228' title='Defined at 2228 in Modules/_ctypes/libffi/src/dlmalloc.c.'>small_index</a>(<a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>);\
<a name='L2925'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../D/2444.html' title='Multiple defined in 2 places.'>P</a> != <a href='../D/233.html' title='Multiple defined in 18 places.'>B</a>);\
<a name='L2926'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../D/2444.html' title='Multiple defined in 2 places.'>P</a> != <a href='../S/2690.html#L101' title='Defined at 101 in Modules/md5module.c.'>F</a>);\
<a name='L2927'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(<a href='../D/2444.html' title='Multiple defined in 2 places.'>P</a>) == <a href='../S/2317.html#L2229' title='Defined at 2229 in Modules/_ctypes/libffi/src/dlmalloc.c.'>small_index2size</a>(<a href='../S/2690.html#L104' title='Defined at 104 in Modules/md5module.c.'>I</a>));\
<a name='L2928'>  <b>if</b> (<a href='../S/2690.html#L101' title='Defined at 101 in Modules/md5module.c.'>F</a> == <a href='../D/233.html' title='Multiple defined in 18 places.'>B</a>)\
<a name='L2929'>    <a href='../S/2317.html#L2293' title='Defined at 2293 in Modules/_ctypes/libffi/src/dlmalloc.c.'>clear_smallmap</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>, <a href='../S/2690.html#L104' title='Defined at 104 in Modules/md5module.c.'>I</a>);\
<a name='L2930'>  <b>else</b> <b>if</b> (<a href='../D/4519.html' title='Multiple defined in 3 places.'>RTCHECK</a>((<a href='../S/2690.html#L101' title='Defined at 101 in Modules/md5module.c.'>F</a> == <a href='../S/2317.html#L2233' title='Defined at 2233 in Modules/_ctypes/libffi/src/dlmalloc.c.'>smallbin_at</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>,<a href='../S/2690.html#L104' title='Defined at 104 in Modules/md5module.c.'>I</a>) || <a href='../D/10195.html' title='Multiple defined in 2 places.'>ok_address</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>, <a href='../S/2690.html#L101' title='Defined at 101 in Modules/md5module.c.'>F</a>)) &amp;&amp;\
<a name='L2931'>                   (<a href='../D/233.html' title='Multiple defined in 18 places.'>B</a> == <a href='../S/2317.html#L2233' title='Defined at 2233 in Modules/_ctypes/libffi/src/dlmalloc.c.'>smallbin_at</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>,<a href='../S/2690.html#L104' title='Defined at 104 in Modules/md5module.c.'>I</a>) || <a href='../D/10195.html' title='Multiple defined in 2 places.'>ok_address</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>, <a href='../D/233.html' title='Multiple defined in 18 places.'>B</a>)))) <font color='red'>{</font>\
<a name='L2932'>    <a href='../S/2690.html#L101' title='Defined at 101 in Modules/md5module.c.'>F</a>-&gt;bk = <a href='../D/233.html' title='Multiple defined in 18 places.'>B</a>;\
<a name='L2933'>    <a href='../D/233.html' title='Multiple defined in 18 places.'>B</a>-&gt;fd = <a href='../S/2690.html#L101' title='Defined at 101 in Modules/md5module.c.'>F</a>;\
<a name='L2934'>  <font color='red'>}</font>\
<a name='L2935'>  <b>else</b> <font color='red'>{</font>\
<a name='L2936'>    <a href='../D/635.html' title='Multiple defined in 2 places.'>CORRUPTION_ERROR_ACTION</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>);\
<a name='L2937'>  <font color='red'>}</font>\
<a name='L2938'><font color='red'>}</font>
<a name='L2939'>
<a name='L2940'><i><font color='green'>/* Unlink the first chunk from a smallbin */</font></i>
<a name='L2941'><font color='darkred'>#define</font> <a href='../R/11168.html' title='Multiple refered from 4 places.'>unlink_first_small_chunk</a>(M, B, P, I) <font color='red'>{</font>\
<a name='L2942'>  <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> <a href='../S/2690.html#L101' title='Defined at 101 in Modules/md5module.c.'>F</a> = <a href='../D/2444.html' title='Multiple defined in 2 places.'>P</a>-&gt;fd;\
<a name='L2943'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../D/2444.html' title='Multiple defined in 2 places.'>P</a> != <a href='../D/233.html' title='Multiple defined in 18 places.'>B</a>);\
<a name='L2944'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../D/2444.html' title='Multiple defined in 2 places.'>P</a> != <a href='../S/2690.html#L101' title='Defined at 101 in Modules/md5module.c.'>F</a>);\
<a name='L2945'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(<a href='../D/2444.html' title='Multiple defined in 2 places.'>P</a>) == <a href='../S/2317.html#L2229' title='Defined at 2229 in Modules/_ctypes/libffi/src/dlmalloc.c.'>small_index2size</a>(<a href='../S/2690.html#L104' title='Defined at 104 in Modules/md5module.c.'>I</a>));\
<a name='L2946'>  <b>if</b> (<a href='../D/233.html' title='Multiple defined in 18 places.'>B</a> == <a href='../S/2690.html#L101' title='Defined at 101 in Modules/md5module.c.'>F</a>)\
<a name='L2947'>    <a href='../S/2317.html#L2293' title='Defined at 2293 in Modules/_ctypes/libffi/src/dlmalloc.c.'>clear_smallmap</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>, <a href='../S/2690.html#L104' title='Defined at 104 in Modules/md5module.c.'>I</a>);\
<a name='L2948'>  <b>else</b> <b>if</b> (<a href='../D/4519.html' title='Multiple defined in 3 places.'>RTCHECK</a>(<a href='../D/10195.html' title='Multiple defined in 2 places.'>ok_address</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>, <a href='../S/2690.html#L101' title='Defined at 101 in Modules/md5module.c.'>F</a>))) <font color='red'>{</font>\
<a name='L2949'>    <a href='../D/233.html' title='Multiple defined in 18 places.'>B</a>-&gt;fd = <a href='../S/2690.html#L101' title='Defined at 101 in Modules/md5module.c.'>F</a>;\
<a name='L2950'>    <a href='../S/2690.html#L101' title='Defined at 101 in Modules/md5module.c.'>F</a>-&gt;bk = <a href='../D/233.html' title='Multiple defined in 18 places.'>B</a>;\
<a name='L2951'>  <font color='red'>}</font>\
<a name='L2952'>  <b>else</b> <font color='red'>{</font>\
<a name='L2953'>    <a href='../D/635.html' title='Multiple defined in 2 places.'>CORRUPTION_ERROR_ACTION</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>);\
<a name='L2954'>  <font color='red'>}</font>\
<a name='L2955'><font color='red'>}</font>
<a name='L2956'>
<a name='L2957'><i><font color='green'>/* Replace dv node, binning the old one */</font></i>
<a name='L2958'><i><font color='green'>/* Used only when dvsize known to be small */</font></i>
<a name='L2959'><font color='darkred'>#define</font> <a href='../R/10016.html' title='Multiple refered from 3 places.'>replace_dv</a>(M, P, S) <font color='red'>{</font>\
<a name='L2960'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> DVS = <a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>-&gt;dvsize;\
<a name='L2961'>  <b>if</b> (DVS != 0) <font color='red'>{</font>\
<a name='L2962'>    <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> DV = <a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>-&gt;dv;\
<a name='L2963'>    <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../S/2317.html#L2227' title='Defined at 2227 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_small</a>(DVS));\
<a name='L2964'>    <a href='../S/2317.html#L2902' title='Defined at 2902 in Modules/_ctypes/libffi/src/dlmalloc.c.'>insert_small_chunk</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>, DV, DVS);\
<a name='L2965'>  <font color='red'>}</font>\
<a name='L2966'>  <a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>-&gt;dvsize = <a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>;\
<a name='L2967'>  <a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>-&gt;dv = <a href='../D/2444.html' title='Multiple defined in 2 places.'>P</a>;\
<a name='L2968'><font color='red'>}</font>
<a name='L2969'>
<a name='L2970'><i><font color='green'>/* ------------------------- Operations on trees ------------------------- */</font></i>
<a name='L2971'>
<a name='L2972'><i><font color='green'>/* Insert chunk into tree */</font></i>
<a name='L2973'><font color='darkred'>#define</font> <a href='../R/8413.html' title='Multiple refered from 2 places.'>insert_large_chunk</a>(M, X, S) <font color='red'>{</font>\
<a name='L2974'>  <a href='../S/2317.html#L1816' title='Defined at 1816 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tbinptr</a>* <a href='../S/2690.html#L103' title='Defined at 103 in Modules/md5module.c.'>H</a>;\
<a name='L2975'>  <a href='../S/2317.html#L1607' title='Defined at 1607 in Modules/_ctypes/libffi/src/dlmalloc.c.'>bindex_t</a> <a href='../S/2690.html#L104' title='Defined at 104 in Modules/md5module.c.'>I</a>;\
<a name='L2976'>  <a href='../D/7736.html' title='Multiple defined in 2 places.'>compute_tree_index</a>(<a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>, <a href='../S/2690.html#L104' title='Defined at 104 in Modules/md5module.c.'>I</a>);\
<a name='L2977'>  <a href='../S/2690.html#L103' title='Defined at 103 in Modules/md5module.c.'>H</a> = <a href='../S/2317.html#L2234' title='Defined at 2234 in Modules/_ctypes/libffi/src/dlmalloc.c.'>treebin_at</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>, <a href='../S/2690.html#L104' title='Defined at 104 in Modules/md5module.c.'>I</a>);\
<a name='L2978'>  X-&gt;index = <a href='../S/2690.html#L104' title='Defined at 104 in Modules/md5module.c.'>I</a>;\
<a name='L2979'>  X-&gt;child[0] = X-&gt;child[1] = 0;\
<a name='L2980'>  <b>if</b> (!<a href='../S/2317.html#L2298' title='Defined at 2298 in Modules/_ctypes/libffi/src/dlmalloc.c.'>treemap_is_marked</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>, <a href='../S/2690.html#L104' title='Defined at 104 in Modules/md5module.c.'>I</a>)) <font color='red'>{</font>\
<a name='L2981'>    <a href='../S/2317.html#L2296' title='Defined at 2296 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mark_treemap</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>, <a href='../S/2690.html#L104' title='Defined at 104 in Modules/md5module.c.'>I</a>);\
<a name='L2982'>    *<a href='../S/2690.html#L103' title='Defined at 103 in Modules/md5module.c.'>H</a> = X;\
<a name='L2983'>    X-&gt;parent = (<a href='../S/2317.html#L1815' title='Defined at 1815 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tchunkptr</a>)<a href='../S/2690.html#L103' title='Defined at 103 in Modules/md5module.c.'>H</a>;\
<a name='L2984'>    X-&gt;fd = X-&gt;bk = X;\
<a name='L2985'>  <font color='red'>}</font>\
<a name='L2986'>  <b>else</b> <font color='red'>{</font>\
<a name='L2987'>    <a href='../S/2317.html#L1815' title='Defined at 1815 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tchunkptr</a> T = *<a href='../S/2690.html#L103' title='Defined at 103 in Modules/md5module.c.'>H</a>;\
<a name='L2988'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> K = <a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a> &lt;&lt; <a href='../S/2317.html#L2276' title='Defined at 2276 in Modules/_ctypes/libffi/src/dlmalloc.c.'>leftshift_for_tree_index</a>(<a href='../S/2690.html#L104' title='Defined at 104 in Modules/md5module.c.'>I</a>);\
<a name='L2989'>    <b>for</b> (;;) <font color='red'>{</font>\
<a name='L2990'>      <b>if</b> (<a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(T) != <a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>) <font color='red'>{</font>\
<a name='L2991'>        <a href='../S/2317.html#L1815' title='Defined at 1815 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tchunkptr</a>* <a href='../D/462.html' title='Multiple defined in 9 places.'>C</a> = &amp;(T-&gt;child[(K &gt;&gt; (<a href='../S/2317.html#L1244' title='Defined at 1244 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_BITSIZE</a>-<a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a>)) &amp; 1]);\
<a name='L2992'>        K &lt;&lt;= 1;\
<a name='L2993'>        <b>if</b> (*<a href='../D/462.html' title='Multiple defined in 9 places.'>C</a> != 0)\
<a name='L2994'>          T = *<a href='../D/462.html' title='Multiple defined in 9 places.'>C</a>;\
<a name='L2995'>        <b>else</b> <b>if</b> (<a href='../D/4519.html' title='Multiple defined in 3 places.'>RTCHECK</a>(<a href='../D/10195.html' title='Multiple defined in 2 places.'>ok_address</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>, <a href='../D/462.html' title='Multiple defined in 9 places.'>C</a>))) <font color='red'>{</font>\
<a name='L2996'>          *<a href='../D/462.html' title='Multiple defined in 9 places.'>C</a> = X;\
<a name='L2997'>          X-&gt;parent = T;\
<a name='L2998'>          X-&gt;fd = X-&gt;bk = X;\
<a name='L2999'>          <b>break</b>;\
<a name='L3000'>        <font color='red'>}</font>\
<a name='L3001'>        <b>else</b> <font color='red'>{</font>\
<a name='L3002'>          <a href='../D/635.html' title='Multiple defined in 2 places.'>CORRUPTION_ERROR_ACTION</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>);\
<a name='L3003'>          <b>break</b>;\
<a name='L3004'>        <font color='red'>}</font>\
<a name='L3005'>      <font color='red'>}</font>\
<a name='L3006'>      <b>else</b> <font color='red'>{</font>\
<a name='L3007'>        <a href='../S/2317.html#L1815' title='Defined at 1815 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tchunkptr</a> <a href='../S/2690.html#L101' title='Defined at 101 in Modules/md5module.c.'>F</a> = T-&gt;fd;\
<a name='L3008'>        <b>if</b> (<a href='../D/4519.html' title='Multiple defined in 3 places.'>RTCHECK</a>(<a href='../D/10195.html' title='Multiple defined in 2 places.'>ok_address</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>, T) &amp;&amp; <a href='../D/10195.html' title='Multiple defined in 2 places.'>ok_address</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>, <a href='../S/2690.html#L101' title='Defined at 101 in Modules/md5module.c.'>F</a>))) <font color='red'>{</font>\
<a name='L3009'>          T-&gt;fd = <a href='../S/2690.html#L101' title='Defined at 101 in Modules/md5module.c.'>F</a>-&gt;bk = X;\
<a name='L3010'>          X-&gt;fd = <a href='../S/2690.html#L101' title='Defined at 101 in Modules/md5module.c.'>F</a>;\
<a name='L3011'>          X-&gt;bk = T;\
<a name='L3012'>          X-&gt;parent = 0;\
<a name='L3013'>          <b>break</b>;\
<a name='L3014'>        <font color='red'>}</font>\
<a name='L3015'>        <b>else</b> <font color='red'>{</font>\
<a name='L3016'>          <a href='../D/635.html' title='Multiple defined in 2 places.'>CORRUPTION_ERROR_ACTION</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>);\
<a name='L3017'>          <b>break</b>;\
<a name='L3018'>        <font color='red'>}</font>\
<a name='L3019'>      <font color='red'>}</font>\
<a name='L3020'>    <font color='red'>}</font>\
<a name='L3021'>  <font color='red'>}</font>\
<a name='L3022'><font color='red'>}</font>
<a name='L3023'>
<a name='L3024'><i><font color='green'>/*</font></i>
<a name='L3025'><i><font color='green'>  Unlink steps:</font></i>
<a name='L3026'><i><font color='green'></font></i>
<a name='L3027'><i><font color='green'>  1. If x is a chained node, unlink it from its same-sized fd/bk links</font></i>
<a name='L3028'><i><font color='green'>     and choose its bk node as its replacement.</font></i>
<a name='L3029'><i><font color='green'>  2. If x was the last node of its size, but not a leaf node, it must</font></i>
<a name='L3030'><i><font color='green'>     be replaced with a leaf node (not merely one with an open left or</font></i>
<a name='L3031'><i><font color='green'>     right), to make sure that lefts and rights of descendents</font></i>
<a name='L3032'><i><font color='green'>     correspond properly to bit masks.  We use the rightmost descendent</font></i>
<a name='L3033'><i><font color='green'>     of x.  We could use any other leaf, but this is easy to locate and</font></i>
<a name='L3034'><i><font color='green'>     tends to counteract removal of leftmosts elsewhere, and so keeps</font></i>
<a name='L3035'><i><font color='green'>     paths shorter than minimally guaranteed.  This doesn't loop much</font></i>
<a name='L3036'><i><font color='green'>     because on average a node in a tree is near the bottom.</font></i>
<a name='L3037'><i><font color='green'>  3. If x is the base of a chain (i.e., has parent links) relink</font></i>
<a name='L3038'><i><font color='green'>     x's parent and children to x's replacement (or null if none).</font></i>
<a name='L3039'><i><font color='green'>*/</font></i>
<a name='L3040'>
<a name='L3041'><font color='darkred'>#define</font> <a href='../R/11169.html' title='Multiple refered from 4 places.'>unlink_large_chunk</a>(M, X) <font color='red'>{</font>\
<a name='L3042'>  <a href='../S/2317.html#L1815' title='Defined at 1815 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tchunkptr</a> XP = X-&gt;parent;\
<a name='L3043'>  <a href='../S/2317.html#L1815' title='Defined at 1815 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tchunkptr</a> <a href='../D/4412.html' title='Multiple defined in 2 places.'>R</a>;\
<a name='L3044'>  <b>if</b> (X-&gt;bk != X) <font color='red'>{</font>\
<a name='L3045'>    <a href='../S/2317.html#L1815' title='Defined at 1815 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tchunkptr</a> <a href='../S/2690.html#L101' title='Defined at 101 in Modules/md5module.c.'>F</a> = X-&gt;fd;\
<a name='L3046'>    <a href='../D/4412.html' title='Multiple defined in 2 places.'>R</a> = X-&gt;bk;\
<a name='L3047'>    <b>if</b> (<a href='../D/4519.html' title='Multiple defined in 3 places.'>RTCHECK</a>(<a href='../D/10195.html' title='Multiple defined in 2 places.'>ok_address</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>, <a href='../S/2690.html#L101' title='Defined at 101 in Modules/md5module.c.'>F</a>))) <font color='red'>{</font>\
<a name='L3048'>      <a href='../S/2690.html#L101' title='Defined at 101 in Modules/md5module.c.'>F</a>-&gt;bk = <a href='../D/4412.html' title='Multiple defined in 2 places.'>R</a>;\
<a name='L3049'>      <a href='../D/4412.html' title='Multiple defined in 2 places.'>R</a>-&gt;fd = <a href='../S/2690.html#L101' title='Defined at 101 in Modules/md5module.c.'>F</a>;\
<a name='L3050'>    <font color='red'>}</font>\
<a name='L3051'>    <b>else</b> <font color='red'>{</font>\
<a name='L3052'>      <a href='../D/635.html' title='Multiple defined in 2 places.'>CORRUPTION_ERROR_ACTION</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>);\
<a name='L3053'>    <font color='red'>}</font>\
<a name='L3054'>  <font color='red'>}</font>\
<a name='L3055'>  <b>else</b> <font color='red'>{</font>\
<a name='L3056'>    <a href='../S/2317.html#L1815' title='Defined at 1815 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tchunkptr</a>* RP;\
<a name='L3057'>    <b>if</b> (((<a href='../D/4412.html' title='Multiple defined in 2 places.'>R</a> = *(RP = &amp;(X-&gt;child[1]))) != 0) ||\
<a name='L3058'>        ((<a href='../D/4412.html' title='Multiple defined in 2 places.'>R</a> = *(RP = &amp;(X-&gt;child[0]))) != 0)) <font color='red'>{</font>\
<a name='L3059'>      <a href='../S/2317.html#L1815' title='Defined at 1815 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tchunkptr</a>* CP;\
<a name='L3060'>      <b>while</b> ((*(CP = &amp;(<a href='../D/4412.html' title='Multiple defined in 2 places.'>R</a>-&gt;child[1])) != 0) ||\
<a name='L3061'>             (*(CP = &amp;(<a href='../D/4412.html' title='Multiple defined in 2 places.'>R</a>-&gt;child[0])) != 0)) <font color='red'>{</font>\
<a name='L3062'>        <a href='../D/4412.html' title='Multiple defined in 2 places.'>R</a> = *(RP = CP);\
<a name='L3063'>      <font color='red'>}</font>\
<a name='L3064'>      <b>if</b> (<a href='../D/4519.html' title='Multiple defined in 3 places.'>RTCHECK</a>(<a href='../D/10195.html' title='Multiple defined in 2 places.'>ok_address</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>, RP)))\
<a name='L3065'>        *RP = 0;\
<a name='L3066'>      <b>else</b> <font color='red'>{</font>\
<a name='L3067'>        <a href='../D/635.html' title='Multiple defined in 2 places.'>CORRUPTION_ERROR_ACTION</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>);\
<a name='L3068'>      <font color='red'>}</font>\
<a name='L3069'>    <font color='red'>}</font>\
<a name='L3070'>  <font color='red'>}</font>\
<a name='L3071'>  <b>if</b> (XP != 0) <font color='red'>{</font>\
<a name='L3072'>    <a href='../S/2317.html#L1816' title='Defined at 1816 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tbinptr</a>* <a href='../S/2690.html#L103' title='Defined at 103 in Modules/md5module.c.'>H</a> = <a href='../S/2317.html#L2234' title='Defined at 2234 in Modules/_ctypes/libffi/src/dlmalloc.c.'>treebin_at</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>, X-&gt;index);\
<a name='L3073'>    <b>if</b> (X == *<a href='../S/2690.html#L103' title='Defined at 103 in Modules/md5module.c.'>H</a>) <font color='red'>{</font>\
<a name='L3074'>      <b>if</b> ((*<a href='../S/2690.html#L103' title='Defined at 103 in Modules/md5module.c.'>H</a> = <a href='../D/4412.html' title='Multiple defined in 2 places.'>R</a>) == 0) \
<a name='L3075'>        <a href='../S/2317.html#L2297' title='Defined at 2297 in Modules/_ctypes/libffi/src/dlmalloc.c.'>clear_treemap</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>, X-&gt;index);\
<a name='L3076'>    <font color='red'>}</font>\
<a name='L3077'>    <b>else</b> <b>if</b> (<a href='../D/4519.html' title='Multiple defined in 3 places.'>RTCHECK</a>(<a href='../D/10195.html' title='Multiple defined in 2 places.'>ok_address</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>, XP))) <font color='red'>{</font>\
<a name='L3078'>      <b>if</b> (XP-&gt;child[0] == X) \
<a name='L3079'>        XP-&gt;child[0] = <a href='../D/4412.html' title='Multiple defined in 2 places.'>R</a>;\
<a name='L3080'>      <b>else</b> \
<a name='L3081'>        XP-&gt;child[1] = <a href='../D/4412.html' title='Multiple defined in 2 places.'>R</a>;\
<a name='L3082'>    <font color='red'>}</font>\
<a name='L3083'>    <b>else</b>\
<a name='L3084'>      <a href='../D/635.html' title='Multiple defined in 2 places.'>CORRUPTION_ERROR_ACTION</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>);\
<a name='L3085'>    <b>if</b> (<a href='../D/4412.html' title='Multiple defined in 2 places.'>R</a> != 0) <font color='red'>{</font>\
<a name='L3086'>      <b>if</b> (<a href='../D/4519.html' title='Multiple defined in 3 places.'>RTCHECK</a>(<a href='../D/10195.html' title='Multiple defined in 2 places.'>ok_address</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>, <a href='../D/4412.html' title='Multiple defined in 2 places.'>R</a>))) <font color='red'>{</font>\
<a name='L3087'>        <a href='../S/2317.html#L1815' title='Defined at 1815 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tchunkptr</a> C0, C1;\
<a name='L3088'>        <a href='../D/4412.html' title='Multiple defined in 2 places.'>R</a>-&gt;parent = XP;\
<a name='L3089'>        <b>if</b> ((C0 = X-&gt;child[0]) != 0) <font color='red'>{</font>\
<a name='L3090'>          <b>if</b> (<a href='../D/4519.html' title='Multiple defined in 3 places.'>RTCHECK</a>(<a href='../D/10195.html' title='Multiple defined in 2 places.'>ok_address</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>, C0))) <font color='red'>{</font>\
<a name='L3091'>            <a href='../D/4412.html' title='Multiple defined in 2 places.'>R</a>-&gt;child[0] = C0;\
<a name='L3092'>            C0-&gt;parent = <a href='../D/4412.html' title='Multiple defined in 2 places.'>R</a>;\
<a name='L3093'>          <font color='red'>}</font>\
<a name='L3094'>          <b>else</b>\
<a name='L3095'>            <a href='../D/635.html' title='Multiple defined in 2 places.'>CORRUPTION_ERROR_ACTION</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>);\
<a name='L3096'>        <font color='red'>}</font>\
<a name='L3097'>        <b>if</b> ((C1 = X-&gt;child[1]) != 0) <font color='red'>{</font>\
<a name='L3098'>          <b>if</b> (<a href='../D/4519.html' title='Multiple defined in 3 places.'>RTCHECK</a>(<a href='../D/10195.html' title='Multiple defined in 2 places.'>ok_address</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>, C1))) <font color='red'>{</font>\
<a name='L3099'>            <a href='../D/4412.html' title='Multiple defined in 2 places.'>R</a>-&gt;child[1] = C1;\
<a name='L3100'>            C1-&gt;parent = <a href='../D/4412.html' title='Multiple defined in 2 places.'>R</a>;\
<a name='L3101'>          <font color='red'>}</font>\
<a name='L3102'>          <b>else</b>\
<a name='L3103'>            <a href='../D/635.html' title='Multiple defined in 2 places.'>CORRUPTION_ERROR_ACTION</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>);\
<a name='L3104'>        <font color='red'>}</font>\
<a name='L3105'>      <font color='red'>}</font>\
<a name='L3106'>      <b>else</b>\
<a name='L3107'>        <a href='../D/635.html' title='Multiple defined in 2 places.'>CORRUPTION_ERROR_ACTION</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>);\
<a name='L3108'>    <font color='red'>}</font>\
<a name='L3109'>  <font color='red'>}</font>\
<a name='L3110'><font color='red'>}</font>
<a name='L3111'>
<a name='L3112'><i><font color='green'>/* Relays to large vs small bin operations */</font></i>
<a name='L3113'>
<a name='L3114'><font color='darkred'>#define</font> <a href='../R/8411.html' title='Multiple refered from 5 places.'>insert_chunk</a>(M, P, S)\
<a name='L3115'>  <b>if</b> (<a href='../S/2317.html#L2227' title='Defined at 2227 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_small</a>(<a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>)) <a href='../S/2317.html#L2902' title='Defined at 2902 in Modules/_ctypes/libffi/src/dlmalloc.c.'>insert_small_chunk</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>, <a href='../D/2444.html' title='Multiple defined in 2 places.'>P</a>, <a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>)\
<a name='L3116'>  <b>else</b> <font color='red'>{</font> <a href='../S/2317.html#L1815' title='Defined at 1815 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tchunkptr</a> TP = (<a href='../S/2317.html#L1815' title='Defined at 1815 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tchunkptr</a>)(<a href='../D/2444.html' title='Multiple defined in 2 places.'>P</a>); <a href='../S/2317.html#L2973' title='Defined at 2973 in Modules/_ctypes/libffi/src/dlmalloc.c.'>insert_large_chunk</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>, TP, <a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>); <font color='red'>}</font>
<a name='L3117'>
<a name='L3118'><font color='darkred'>#define</font> <a href='../R/11167.html' title='Multiple refered from 5 places.'>unlink_chunk</a>(M, P, S)\
<a name='L3119'>  <b>if</b> (<a href='../S/2317.html#L2227' title='Defined at 2227 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_small</a>(<a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>)) <a href='../S/2317.html#L2921' title='Defined at 2921 in Modules/_ctypes/libffi/src/dlmalloc.c.'>unlink_small_chunk</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>, <a href='../D/2444.html' title='Multiple defined in 2 places.'>P</a>, <a href='../D/4558.html' title='Multiple defined in 3 places.'>S</a>)\
<a name='L3120'>  <b>else</b> <font color='red'>{</font> <a href='../S/2317.html#L1815' title='Defined at 1815 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tchunkptr</a> TP = (<a href='../S/2317.html#L1815' title='Defined at 1815 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tchunkptr</a>)(<a href='../D/2444.html' title='Multiple defined in 2 places.'>P</a>); <a href='../S/2317.html#L3041' title='Defined at 3041 in Modules/_ctypes/libffi/src/dlmalloc.c.'>unlink_large_chunk</a>(<a href='../D/2001.html' title='Multiple defined in 2 places.'>M</a>, TP); <font color='red'>}</font>
<a name='L3121'>
<a name='L3122'>
<a name='L3123'><i><font color='green'>/* Relays to internal calls to malloc/free from realloc, memalign etc */</font></i>
<a name='L3124'>
<a name='L3125'><font color='darkred'>#if</font> <a href='../S/2317.html#L478' title='Defined at 478 in Modules/_ctypes/libffi/src/dlmalloc.c.'>ONLY_MSPACES</a>
<a name='L3126'><font color='darkred'>#define</font> <a href='../R/8450.html' title='Multiple refered from 6 places.'>internal_malloc</a>(m, <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a>) <a href='../S/2317.html#L4486' title='Defined at 4486 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace_malloc</a>(m, b)
<a name='L3127'><font color='darkred'>#define</font> <a href='../R/8448.html' title='Multiple refered from 4 places.'>internal_free</a>(m, mem) <a href='../S/2317.html#L4600' title='Defined at 4600 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace_free</a>(m,mem);
<a name='L3128'><font color='darkred'>#else</font> <i><font color='green'>/* ONLY_MSPACES */</font></i>
<a name='L3129'><font color='darkred'>#if</font> <a href='../D/2179.html' title='Multiple defined in 2 places.'>MSPACES</a>
<a name='L3130'><font color='darkred'>#define</font> <a href='../R/8450.html' title='Multiple refered from 6 places.'>internal_malloc</a>(m, b)\
<a name='L3131'>   (m == <a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>)? <a href='../D/8185.html' title='Multiple defined in 2 places.'>dlmalloc</a>(<a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a>) : <a href='../S/2317.html#L4486' title='Defined at 4486 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace_malloc</a>(m, <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a>)
<a name='L3132'><font color='darkred'>#define</font> <a href='../R/8448.html' title='Multiple refered from 4 places.'>internal_free</a>(m, mem)\
<a name='L3133'>   <b>if</b> (m == <a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>) <a href='../D/8181.html' title='Multiple defined in 2 places.'>dlfree</a>(mem); <b>else</b> <a href='../S/2317.html#L4600' title='Defined at 4600 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace_free</a>(m,mem);
<a name='L3134'><font color='darkred'>#else</font> <i><font color='green'>/* MSPACES */</font></i>
<a name='L3135'><font color='darkred'>#define</font> <a href='../R/8450.html' title='Multiple refered from 6 places.'>internal_malloc</a>(m, <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a>) <a href='../D/8185.html' title='Multiple defined in 2 places.'>dlmalloc</a>(b)
<a name='L3136'><font color='darkred'>#define</font> <a href='../R/8448.html' title='Multiple refered from 4 places.'>internal_free</a>(m, mem) <a href='../D/8181.html' title='Multiple defined in 2 places.'>dlfree</a>(mem)
<a name='L3137'><font color='darkred'>#endif</font> <i><font color='green'>/* MSPACES */</font></i>
<a name='L3138'><font color='darkred'>#endif</font> <i><font color='green'>/* ONLY_MSPACES */</font></i>
<a name='L3139'>
<a name='L3140'><i><font color='green'>/* -----------------------  Direct-mmapping chunks ----------------------- */</font></i>
<a name='L3141'>
<a name='L3142'><i><font color='green'>/*</font></i>
<a name='L3143'><i><font color='green'>  Directly mmapped chunks are set up with an offset to the start of</font></i>
<a name='L3144'><i><font color='green'>  the mmapped region stored in the prev_foot field of the chunk. This</font></i>
<a name='L3145'><i><font color='green'>  allows reconstruction of the required argument to MUNMAP when freed,</font></i>
<a name='L3146'><i><font color='green'>  and also allows adjustment of the returned chunk to meet alignment</font></i>
<a name='L3147'><i><font color='green'>  requirements (especially in memalign).  There is also enough space</font></i>
<a name='L3148'><i><font color='green'>  allocated to hold a fake next chunk of size SIZE_T_SIZE to maintain</font></i>
<a name='L3149'><i><font color='green'>  the PINUSE bit so frees can be checked.</font></i>
<a name='L3150'><i><font color='green'>*/</font></i>
<a name='L3151'>
<a name='L3152'><i><font color='green'>/* Malloc using mmap */</font></i>
<a name='L3153'><b>static</b> <b>void</b>* <a href='../S/2317.html#L3368' title='Refered from 3368 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mmap_alloc</a>(mstate m, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> nb) <font color='red'>{</font>
<a name='L3154'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> mmsize = <a href='../S/2317.html#L2085' title='Defined at 2085 in Modules/_ctypes/libffi/src/dlmalloc.c.'>granularity_align</a>(nb + <a href='../S/2317.html#L1253' title='Defined at 1253 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIX_SIZE_T_SIZES</a> + <a href='../S/2317.html#L1257' title='Defined at 1257 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CHUNK_ALIGN_MASK</a>);
<a name='L3155'>  <b>if</b> (mmsize &gt; nb) <font color='red'>{</font>     <i><font color='green'>/* Check for wrap around 0 */</font></i>
<a name='L3156'>    <b>char</b>* mm = (<b>char</b>*)(<a href='../D/788.html' title='Multiple defined in 3 places.'>DIRECT_MMAP</a>(mmsize));
<a name='L3157'>    <b>if</b> (mm != <a href='../S/2317.html#L1278' title='Defined at 1278 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CMFAIL</a>) <font color='red'>{</font>
<a name='L3158'>      <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> offset = <a href='../S/2317.html#L1263' title='Defined at 1263 in Modules/_ctypes/libffi/src/dlmalloc.c.'>align_offset</a>(<a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(mm));
<a name='L3159'>      <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> psize = mmsize - offset - <a href='../S/2317.html#L1624' title='Defined at 1624 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MMAP_FOOT_PAD</a>;
<a name='L3160'>      <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> p = (<a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a>)(mm + offset);
<a name='L3161'>      p-&gt;prev_foot = offset | <a href='../D/1787.html' title='Multiple defined in 2 places.'>IS_MMAPPED_BIT</a>;
<a name='L3162'>      (p)-&gt;head = (psize|<a href='../S/2317.html#L1660' title='Defined at 1660 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CINUSE_BIT</a>);
<a name='L3163'>      <a href='../D/9706.html' title='Multiple defined in 2 places.'>mark_inuse_foot</a>(m, p, psize);
<a name='L3164'>      <a href='../S/2317.html#L1675' title='Defined at 1675 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk_plus_offset</a>(p, psize)-&gt;head = <a href='../S/2317.html#L1664' title='Defined at 1664 in Modules/_ctypes/libffi/src/dlmalloc.c.'>FENCEPOST_HEAD</a>;
<a name='L3165'>      <a href='../S/2317.html#L1675' title='Defined at 1675 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk_plus_offset</a>(p, psize+<a href='../S/2317.html#L1243' title='Defined at 1243 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_SIZE</a>)-&gt;head = 0;
<a name='L3166'>
<a name='L3167'>      <b>if</b> (mm &lt; m-&gt;least_addr)
<a name='L3168'>        m-&gt;least_addr = mm;
<a name='L3169'>      <b>if</b> ((m-&gt;footprint += mmsize) &gt; m-&gt;max_footprint)
<a name='L3170'>        m-&gt;max_footprint = m-&gt;footprint;
<a name='L3171'>      <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../S/2317.html#L1260' title='Defined at 1260 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_aligned</a>(<a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(p)));
<a name='L3172'>      <a href='../D/7411.html' title='Multiple defined in 2 places.'>check_mmapped_chunk</a>(m, p);
<a name='L3173'>      <b>return</b> <a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(p);
<a name='L3174'>    <font color='red'>}</font>
<a name='L3175'>  <font color='red'>}</font>
<a name='L3176'>  <b>return</b> 0;
<a name='L3177'><font color='red'>}</font>
<a name='L3178'>
<a name='L3179'><i><font color='green'>/* Realloc using mmap */</font></i>
<a name='L3180'><b>static</b> <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> <a href='../S/2317.html#L3790' title='Refered from 3790 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mmap_resize</a>(mstate m, mchunkptr oldp, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> nb) <font color='red'>{</font>
<a name='L3181'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> oldsize = <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(oldp);
<a name='L3182'>  <b>if</b> (<a href='../S/2317.html#L2227' title='Defined at 2227 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_small</a>(nb)) <i><font color='green'>/* Can't shrink mmap regions below small size */</font></i>
<a name='L3183'>    <b>return</b> 0;
<a name='L3184'>  <i><font color='green'>/* Keep old chunk if big enough but not too big */</font></i>
<a name='L3185'>  <b>if</b> (oldsize &gt;= nb + <a href='../S/2317.html#L1243' title='Defined at 1243 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_SIZE</a> &amp;&amp;
<a name='L3186'>      (oldsize - nb) &lt;= (mparams.granularity &lt;&lt; 1))
<a name='L3187'>    <b>return</b> oldp;
<a name='L3188'>  <b>else</b> <font color='red'>{</font>
<a name='L3189'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> offset = oldp-&gt;prev_foot &amp; ~<a href='../D/1787.html' title='Multiple defined in 2 places.'>IS_MMAPPED_BIT</a>;
<a name='L3190'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> oldmmsize = oldsize + offset + <a href='../S/2317.html#L1624' title='Defined at 1624 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MMAP_FOOT_PAD</a>;
<a name='L3191'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> newmmsize = <a href='../S/2317.html#L2085' title='Defined at 2085 in Modules/_ctypes/libffi/src/dlmalloc.c.'>granularity_align</a>(nb + <a href='../S/2317.html#L1253' title='Defined at 1253 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIX_SIZE_T_SIZES</a> +
<a name='L3192'>                                         <a href='../S/2317.html#L1257' title='Defined at 1257 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CHUNK_ALIGN_MASK</a>);
<a name='L3193'>    <b>char</b>* cp = (<b>char</b>*)<a href='../D/473.html' title='Multiple defined in 2 places.'>CALL_MREMAP</a>((<b>char</b>*)oldp - offset,
<a name='L3194'>                                  oldmmsize, newmmsize, 1);
<a name='L3195'>    <b>if</b> (cp != <a href='../S/2317.html#L1278' title='Defined at 1278 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CMFAIL</a>) <font color='red'>{</font>
<a name='L3196'>      <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> newp = (<a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a>)(cp + offset);
<a name='L3197'>      <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> psize = newmmsize - offset - <a href='../S/2317.html#L1624' title='Defined at 1624 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MMAP_FOOT_PAD</a>;
<a name='L3198'>      newp-&gt;head = (psize|<a href='../S/2317.html#L1660' title='Defined at 1660 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CINUSE_BIT</a>);
<a name='L3199'>      <a href='../D/9706.html' title='Multiple defined in 2 places.'>mark_inuse_foot</a>(m, newp, psize);
<a name='L3200'>      <a href='../S/2317.html#L1675' title='Defined at 1675 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk_plus_offset</a>(newp, psize)-&gt;head = <a href='../S/2317.html#L1664' title='Defined at 1664 in Modules/_ctypes/libffi/src/dlmalloc.c.'>FENCEPOST_HEAD</a>;
<a name='L3201'>      <a href='../S/2317.html#L1675' title='Defined at 1675 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk_plus_offset</a>(newp, psize+<a href='../S/2317.html#L1243' title='Defined at 1243 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_SIZE</a>)-&gt;head = 0;
<a name='L3202'>
<a name='L3203'>      <b>if</b> (cp &lt; m-&gt;least_addr)
<a name='L3204'>        m-&gt;least_addr = cp;
<a name='L3205'>      <b>if</b> ((m-&gt;footprint += newmmsize - oldmmsize) &gt; m-&gt;max_footprint)
<a name='L3206'>        m-&gt;max_footprint = m-&gt;footprint;
<a name='L3207'>      <a href='../D/7411.html' title='Multiple defined in 2 places.'>check_mmapped_chunk</a>(m, newp);
<a name='L3208'>      <b>return</b> newp;
<a name='L3209'>    <font color='red'>}</font>
<a name='L3210'>  <font color='red'>}</font>
<a name='L3211'>  <b>return</b> 0;
<a name='L3212'><font color='red'>}</font>
<a name='L3213'>
<a name='L3214'><i><font color='green'>/* -------------------------- mspace management -------------------------- */</font></i>
<a name='L3215'>
<a name='L3216'><i><font color='green'>/* Initialize top chunk and its size */</font></i>
<a name='L3217'><b>static</b> <b>void</b> <a href='../R/8389.html' title='Multiple refered from 6 places.'>init_top</a>(mstate m, mchunkptr p, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> psize) <font color='red'>{</font>
<a name='L3218'>  <i><font color='green'>/* Ensure alignment */</font></i>
<a name='L3219'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> offset = <a href='../S/2317.html#L1263' title='Defined at 1263 in Modules/_ctypes/libffi/src/dlmalloc.c.'>align_offset</a>(<a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(p));
<a name='L3220'>  p = (<a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a>)((<b>char</b>*)p + offset);
<a name='L3221'>  psize -= offset;
<a name='L3222'>
<a name='L3223'>  m-&gt;top = p;
<a name='L3224'>  m-&gt;topsize = psize;
<a name='L3225'>  p-&gt;head = psize | <a href='../S/2317.html#L1659' title='Defined at 1659 in Modules/_ctypes/libffi/src/dlmalloc.c.'>PINUSE_BIT</a>;
<a name='L3226'>  <i><font color='green'>/* set size of fake trailing chunk holding overhead space only once */</font></i>
<a name='L3227'>  <a href='../S/2317.html#L1675' title='Defined at 1675 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk_plus_offset</a>(p, psize)-&gt;head = <a href='../S/2317.html#L2130' title='Defined at 2130 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TOP_FOOT_SIZE</a>;
<a name='L3228'>  m-&gt;trim_check = mparams.trim_threshold; <i><font color='green'>/* reset on each update */</font></i>
<a name='L3229'><font color='red'>}</font>
<a name='L3230'>
<a name='L3231'><i><font color='green'>/* Initialize bins for a new mstate that is otherwise zeroed out */</font></i>
<a name='L3232'><b>static</b> <b>void</b> <a href='../R/8379.html' title='Multiple refered from 3 places.'>init_bins</a>(mstate m) <font color='red'>{</font>
<a name='L3233'>  <i><font color='green'>/* Establish circular links for smallbins */</font></i>
<a name='L3234'>  <a href='../S/2317.html#L1607' title='Defined at 1607 in Modules/_ctypes/libffi/src/dlmalloc.c.'>bindex_t</a> i;
<a name='L3235'>  <b>for</b> (i = 0; i &lt; <a href='../S/2317.html#L2003' title='Defined at 2003 in Modules/_ctypes/libffi/src/dlmalloc.c.'>NSMALLBINS</a>; ++i) <font color='red'>{</font>
<a name='L3236'>    <a href='../S/2317.html#L1606' title='Defined at 1606 in Modules/_ctypes/libffi/src/dlmalloc.c.'>sbinptr</a> bin = <a href='../S/2317.html#L2233' title='Defined at 2233 in Modules/_ctypes/libffi/src/dlmalloc.c.'>smallbin_at</a>(m,i);
<a name='L3237'>    bin-&gt;fd = bin-&gt;bk = bin;
<a name='L3238'>  <font color='red'>}</font>
<a name='L3239'><font color='red'>}</font>
<a name='L3240'>
<a name='L3241'><font color='darkred'>#if</font> <a href='../S/2317.html#L500' title='Defined at 500 in Modules/_ctypes/libffi/src/dlmalloc.c.'>PROCEED_ON_ERROR</a>
<a name='L3242'>
<a name='L3243'><i><font color='green'>/* default corruption action */</font></i>
<a name='L3244'><b>static</b> <b>void</b> <a href='../R/10022.html' title='Multiple refered from 2 places.'>reset_on_error</a>(mstate m) <font color='red'>{</font>
<a name='L3245'>  <b>int</b> i;
<a name='L3246'>  ++malloc_corruption_error_count;
<a name='L3247'>  <i><font color='green'>/* Reinitialize fields to forget about all memory */</font></i>
<a name='L3248'>  m-&gt;smallbins = m-&gt;treebins = 0;
<a name='L3249'>  m-&gt;dvsize = m-&gt;topsize = 0;
<a name='L3250'>  m-&gt;seg.base = 0;
<a name='L3251'>  m-&gt;seg.size = 0;
<a name='L3252'>  m-&gt;seg.next = 0;
<a name='L3253'>  m-&gt;top = m-&gt;dv = 0;
<a name='L3254'>  <b>for</b> (i = 0; i &lt; <a href='../S/2317.html#L2004' title='Defined at 2004 in Modules/_ctypes/libffi/src/dlmalloc.c.'>NTREEBINS</a>; ++i)
<a name='L3255'>    *<a href='../S/2317.html#L2234' title='Defined at 2234 in Modules/_ctypes/libffi/src/dlmalloc.c.'>treebin_at</a>(m, i) = 0;
<a name='L3256'>  <a href='../S/2317.html#L3232' title='Defined at 3232 in Modules/_ctypes/libffi/src/dlmalloc.c.'>init_bins</a>(m);
<a name='L3257'><font color='red'>}</font>
<a name='L3258'><font color='darkred'>#endif</font> <i><font color='green'>/* PROCEED_ON_ERROR */</font></i>
<a name='L3259'>
<a name='L3260'><i><font color='green'>/* Allocate chunk and prepend remainder with chunk in successor base. */</font></i>
<a name='L3261'><b>static</b> <b>void</b>* <a href='../S/2317.html#L3527' title='Refered from 3527 in Modules/_ctypes/libffi/src/dlmalloc.c.'>prepend_alloc</a>(mstate m, <b>char</b>* newbase, <b>char</b>* oldbase,
<a name='L3262'>                           <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> nb) <font color='red'>{</font>
<a name='L3263'>  <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> p = <a href='../S/2317.html#L1634' title='Defined at 1634 in Modules/_ctypes/libffi/src/dlmalloc.c.'>align_as_chunk</a>(newbase);
<a name='L3264'>  <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> oldfirst = <a href='../S/2317.html#L1634' title='Defined at 1634 in Modules/_ctypes/libffi/src/dlmalloc.c.'>align_as_chunk</a>(oldbase);
<a name='L3265'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> psize = (<b>char</b>*)oldfirst - (<b>char</b>*)p;
<a name='L3266'>  <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> q = <a href='../S/2317.html#L1675' title='Defined at 1675 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk_plus_offset</a>(p, nb);
<a name='L3267'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> qsize = psize - nb;
<a name='L3268'>  <a href='../D/11108.html' title='Multiple defined in 2 places.'>set_size_and_pinuse_of_inuse_chunk</a>(m, p, nb);
<a name='L3269'>
<a name='L3270'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>((<b>char</b>*)oldfirst &gt; (<b>char</b>*)q);
<a name='L3271'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../S/2317.html#L1668' title='Defined at 1668 in Modules/_ctypes/libffi/src/dlmalloc.c.'>pinuse</a>(oldfirst));
<a name='L3272'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(qsize &gt;= <a href='../S/2317.html#L1627' title='Defined at 1627 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MIN_CHUNK_SIZE</a>);
<a name='L3273'>
<a name='L3274'>  <i><font color='green'>/* consolidate remainder with first chunk of old base */</font></i>
<a name='L3275'>  <b>if</b> (oldfirst == m-&gt;top) <font color='red'>{</font>
<a name='L3276'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> tsize = m-&gt;topsize += qsize;
<a name='L3277'>    m-&gt;top = q;
<a name='L3278'>    q-&gt;head = tsize | <a href='../S/2317.html#L1659' title='Defined at 1659 in Modules/_ctypes/libffi/src/dlmalloc.c.'>PINUSE_BIT</a>;
<a name='L3279'>    <a href='../D/7416.html' title='Multiple defined in 2 places.'>check_top_chunk</a>(m, q);
<a name='L3280'>  <font color='red'>}</font>
<a name='L3281'>  <b>else</b> <b>if</b> (oldfirst == m-&gt;dv) <font color='red'>{</font>
<a name='L3282'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> dsize = m-&gt;dvsize += qsize;
<a name='L3283'>    m-&gt;dv = q;
<a name='L3284'>    <a href='../S/2317.html#L1690' title='Defined at 1690 in Modules/_ctypes/libffi/src/dlmalloc.c.'>set_size_and_pinuse_of_free_chunk</a>(q, dsize);
<a name='L3285'>  <font color='red'>}</font>
<a name='L3286'>  <b>else</b> <font color='red'>{</font>
<a name='L3287'>    <b>if</b> (!<a href='../S/2317.html#L1667' title='Defined at 1667 in Modules/_ctypes/libffi/src/dlmalloc.c.'>cinuse</a>(oldfirst)) <font color='red'>{</font>
<a name='L3288'>      <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> nsize = <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(oldfirst);
<a name='L3289'>      <a href='../S/2317.html#L3118' title='Defined at 3118 in Modules/_ctypes/libffi/src/dlmalloc.c.'>unlink_chunk</a>(m, oldfirst, nsize);
<a name='L3290'>      oldfirst = <a href='../S/2317.html#L1675' title='Defined at 1675 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk_plus_offset</a>(oldfirst, nsize);
<a name='L3291'>      qsize += nsize;
<a name='L3292'>    <font color='red'>}</font>
<a name='L3293'>    <a href='../S/2317.html#L1694' title='Defined at 1694 in Modules/_ctypes/libffi/src/dlmalloc.c.'>set_free_with_pinuse</a>(q, qsize, oldfirst);
<a name='L3294'>    <a href='../S/2317.html#L3114' title='Defined at 3114 in Modules/_ctypes/libffi/src/dlmalloc.c.'>insert_chunk</a>(m, q, qsize);
<a name='L3295'>    <a href='../D/7402.html' title='Multiple defined in 2 places.'>check_free_chunk</a>(m, q);
<a name='L3296'>  <font color='red'>}</font>
<a name='L3297'>
<a name='L3298'>  <a href='../D/7408.html' title='Multiple defined in 2 places.'>check_malloced_chunk</a>(m, <a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(p), nb);
<a name='L3299'>  <b>return</b> <a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(p);
<a name='L3300'><font color='red'>}</font>
<a name='L3301'>
<a name='L3302'>
<a name='L3303'><i><font color='green'>/* Add a segment to hold a new noncontiguous region */</font></i>
<a name='L3304'><b>static</b> <b>void</b> <a href='../S/2317.html#L3530' title='Refered from 3530 in Modules/_ctypes/libffi/src/dlmalloc.c.'>add_segment</a>(mstate m, <b>char</b>* tbase, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> tsize, <a href='../S/2317.html#L1609' title='Defined at 1609 in Modules/_ctypes/libffi/src/dlmalloc.c.'>flag_t</a> mmapped) <font color='red'>{</font>
<a name='L3305'>  <i><font color='green'>/* Determine locations and sizes of segment, fenceposts, old top */</font></i>
<a name='L3306'>  <b>char</b>* old_top = (<b>char</b>*)m-&gt;top;
<a name='L3307'>  <a href='../S/2317.html#L1925' title='Defined at 1925 in Modules/_ctypes/libffi/src/dlmalloc.c.'>msegmentptr</a> oldsp = <a href='../S/2317.html#L2098' title='Defined at 2098 in Modules/_ctypes/libffi/src/dlmalloc.c.'>segment_holding</a>(m, old_top);
<a name='L3308'>  <b>char</b>* old_end = oldsp-&gt;base + oldsp-&gt;size;
<a name='L3309'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> ssize = <a href='../S/2317.html#L1641' title='Defined at 1641 in Modules/_ctypes/libffi/src/dlmalloc.c.'>pad_request</a>(<b>sizeof</b>(<b>struct</b> <a href='../S/2317.html#L1878' title='Defined at 1878 in Modules/_ctypes/libffi/src/dlmalloc.c.'>malloc_segment</a>));
<a name='L3310'>  <b>char</b>* rawsp = old_end - (ssize + <a href='../S/2317.html#L1252' title='Defined at 1252 in Modules/_ctypes/libffi/src/dlmalloc.c.'>FOUR_SIZE_T_SIZES</a> + <a href='../S/2317.html#L1257' title='Defined at 1257 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CHUNK_ALIGN_MASK</a>);
<a name='L3311'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> offset = <a href='../S/2317.html#L1263' title='Defined at 1263 in Modules/_ctypes/libffi/src/dlmalloc.c.'>align_offset</a>(<a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(rawsp));
<a name='L3312'>  <b>char</b>* asp = rawsp + offset;
<a name='L3313'>  <b>char</b>* csp = (asp &lt; (old_top + <a href='../S/2317.html#L1627' title='Defined at 1627 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MIN_CHUNK_SIZE</a>))? old_top : asp;
<a name='L3314'>  <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> sp = (<a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a>)csp;
<a name='L3315'>  <a href='../S/2317.html#L1925' title='Defined at 1925 in Modules/_ctypes/libffi/src/dlmalloc.c.'>msegmentptr</a> ss = (<a href='../S/2317.html#L1925' title='Defined at 1925 in Modules/_ctypes/libffi/src/dlmalloc.c.'>msegmentptr</a>)(<a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(sp));
<a name='L3316'>  <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> tnext = <a href='../S/2317.html#L1675' title='Defined at 1675 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk_plus_offset</a>(sp, ssize);
<a name='L3317'>  <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> p = tnext;
<a name='L3318'>  <b>int</b> nfences = 0;
<a name='L3319'>
<a name='L3320'>  <i><font color='green'>/* reset top to new space */</font></i>
<a name='L3321'>  <a href='../S/2317.html#L3217' title='Defined at 3217 in Modules/_ctypes/libffi/src/dlmalloc.c.'>init_top</a>(m, (<a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a>)tbase, tsize - <a href='../S/2317.html#L2130' title='Defined at 2130 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TOP_FOOT_SIZE</a>);
<a name='L3322'>
<a name='L3323'>  <i><font color='green'>/* Set up segment record */</font></i>
<a name='L3324'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../S/2317.html#L1260' title='Defined at 1260 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_aligned</a>(ss));
<a name='L3325'>  <a href='../D/11108.html' title='Multiple defined in 2 places.'>set_size_and_pinuse_of_inuse_chunk</a>(m, sp, ssize);
<a name='L3326'>  *ss = m-&gt;seg; <i><font color='green'>/* Push current record */</font></i>
<a name='L3327'>  m-&gt;seg.base = tbase;
<a name='L3328'>  m-&gt;seg.size = tsize;
<a name='L3329'>  <a href='../D/11106.html' title='Multiple defined in 2 places.'>set_segment_flags</a>(&amp;m-&gt;seg, mmapped);
<a name='L3330'>  m-&gt;seg.next = ss;
<a name='L3331'>
<a name='L3332'>  <i><font color='green'>/* Insert trailing fenceposts */</font></i>
<a name='L3333'>  <b>for</b> (;;) <font color='red'>{</font>
<a name='L3334'>    <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> nextp = <a href='../S/2317.html#L1675' title='Defined at 1675 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk_plus_offset</a>(p, <a href='../S/2317.html#L1243' title='Defined at 1243 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_SIZE</a>);
<a name='L3335'>    p-&gt;head = <a href='../S/2317.html#L1664' title='Defined at 1664 in Modules/_ctypes/libffi/src/dlmalloc.c.'>FENCEPOST_HEAD</a>;
<a name='L3336'>    ++nfences;
<a name='L3337'>    <b>if</b> ((<b>char</b>*)(&amp;(nextp-&gt;head)) &lt; old_end)
<a name='L3338'>      p = nextp;
<a name='L3339'>    <b>else</b>
<a name='L3340'>      <b>break</b>;
<a name='L3341'>  <font color='red'>}</font>
<a name='L3342'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(nfences &gt;= 2);
<a name='L3343'>
<a name='L3344'>  <i><font color='green'>/* Insert the rest of old top into a bin as an ordinary free chunk */</font></i>
<a name='L3345'>  <b>if</b> (csp != old_top) <font color='red'>{</font>
<a name='L3346'>    <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> q = (<a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a>)old_top;
<a name='L3347'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> psize = csp - old_top;
<a name='L3348'>    <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> tn = <a href='../S/2317.html#L1675' title='Defined at 1675 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk_plus_offset</a>(q, psize);
<a name='L3349'>    <a href='../S/2317.html#L1694' title='Defined at 1694 in Modules/_ctypes/libffi/src/dlmalloc.c.'>set_free_with_pinuse</a>(q, psize, tn);
<a name='L3350'>    <a href='../S/2317.html#L3114' title='Defined at 3114 in Modules/_ctypes/libffi/src/dlmalloc.c.'>insert_chunk</a>(m, q, psize);
<a name='L3351'>  <font color='red'>}</font>
<a name='L3352'>
<a name='L3353'>  <a href='../D/7416.html' title='Multiple defined in 2 places.'>check_top_chunk</a>(m, m-&gt;top);
<a name='L3354'><font color='red'>}</font>
<a name='L3355'>
<a name='L3356'><i><font color='green'>/* -------------------------- System allocation -------------------------- */</font></i>
<a name='L3357'>
<a name='L3358'><i><font color='green'>/* Get memory from system using MORECORE or MMAP */</font></i>
<a name='L3359'><b>static</b> <b>void</b>* <a href='../R/10668.html' title='Multiple refered from 2 places.'>sys_alloc</a>(mstate m, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> nb) <font color='red'>{</font>
<a name='L3360'>  <b>char</b>* tbase = <a href='../S/2317.html#L1278' title='Defined at 1278 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CMFAIL</a>;
<a name='L3361'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> tsize = 0;
<a name='L3362'>  <a href='../S/2317.html#L1609' title='Defined at 1609 in Modules/_ctypes/libffi/src/dlmalloc.c.'>flag_t</a> mmap_flag = 0;
<a name='L3363'>
<a name='L3364'>  <a href='../S/2317.html#L2452' title='Defined at 2452 in Modules/_ctypes/libffi/src/dlmalloc.c.'>init_mparams</a>();
<a name='L3365'>
<a name='L3366'>  <i><font color='green'>/* Directly map large chunks */</font></i>
<a name='L3367'>  <b>if</b> (<a href='../S/2317.html#L2068' title='Defined at 2068 in Modules/_ctypes/libffi/src/dlmalloc.c.'>use_mmap</a>(m) &amp;&amp; nb &gt;= mparams.mmap_threshold) <font color='red'>{</font>
<a name='L3368'>    <b>void</b>* mem = <a href='../S/2317.html#L3153' title='Defined at 3153 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mmap_alloc</a>(m, nb);
<a name='L3369'>    <b>if</b> (mem != 0)
<a name='L3370'>      <b>return</b> mem;
<a name='L3371'>  <font color='red'>}</font>
<a name='L3372'>
<a name='L3373'>  <i><font color='green'>/*</font></i>
<a name='L3374'><i><font color='green'>    Try getting memory in any of three ways (in most-preferred to</font></i>
<a name='L3375'><i><font color='green'>    least-preferred order):</font></i>
<a name='L3376'><i><font color='green'>    1. A call to MORECORE that can normally contiguously extend memory.</font></i>
<a name='L3377'><i><font color='green'>       (disabled if not MORECORE_CONTIGUOUS or not HAVE_MORECORE or</font></i>
<a name='L3378'><i><font color='green'>       or main space is mmapped or a previous contiguous call failed)</font></i>
<a name='L3379'><i><font color='green'>    2. A call to MMAP new space (disabled if not HAVE_MMAP).</font></i>
<a name='L3380'><i><font color='green'>       Note that under the default settings, if MORECORE is unable to</font></i>
<a name='L3381'><i><font color='green'>       fulfill a request, and HAVE_MMAP is true, then mmap is</font></i>
<a name='L3382'><i><font color='green'>       used as a noncontiguous system allocator. This is a useful backup</font></i>
<a name='L3383'><i><font color='green'>       strategy for systems with holes in address spaces -- in this case</font></i>
<a name='L3384'><i><font color='green'>       sbrk cannot contiguously expand the heap, but mmap may be able to</font></i>
<a name='L3385'><i><font color='green'>       find space.</font></i>
<a name='L3386'><i><font color='green'>    3. A call to MORECORE that cannot usually contiguously extend memory.</font></i>
<a name='L3387'><i><font color='green'>       (disabled if not HAVE_MORECORE)</font></i>
<a name='L3388'><i><font color='green'>  */</font></i>
<a name='L3389'>
<a name='L3390'>  <b>if</b> (<a href='../D/2167.html' title='Multiple defined in 2 places.'>MORECORE_CONTIGUOUS</a> &amp;&amp; !<a href='../S/2317.html#L2072' title='Defined at 2072 in Modules/_ctypes/libffi/src/dlmalloc.c.'>use_noncontiguous</a>(m)) <font color='red'>{</font>
<a name='L3391'>    <b>char</b>* br = <a href='../S/2317.html#L1278' title='Defined at 1278 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CMFAIL</a>;
<a name='L3392'>    <a href='../S/2317.html#L1925' title='Defined at 1925 in Modules/_ctypes/libffi/src/dlmalloc.c.'>msegmentptr</a> ss = (m-&gt;top == 0)? 0 : <a href='../S/2317.html#L2098' title='Defined at 2098 in Modules/_ctypes/libffi/src/dlmalloc.c.'>segment_holding</a>(m, (<b>char</b>*)m-&gt;top);
<a name='L3393'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> asize = 0;
<a name='L3394'>    <a href='../D/22.html' title='Multiple defined in 2 places.'>ACQUIRE_MORECORE_LOCK</a>();
<a name='L3395'>
<a name='L3396'>    <b>if</b> (ss == 0) <font color='red'>{</font>  <i><font color='green'>/* First time through or recovery */</font></i>
<a name='L3397'>      <b>char</b>* base = (<b>char</b>*)<a href='../D/472.html' title='Multiple defined in 2 places.'>CALL_MORECORE</a>(0);
<a name='L3398'>      <b>if</b> (base != <a href='../S/2317.html#L1278' title='Defined at 1278 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CMFAIL</a>) <font color='red'>{</font>
<a name='L3399'>        asize = <a href='../S/2317.html#L2085' title='Defined at 2085 in Modules/_ctypes/libffi/src/dlmalloc.c.'>granularity_align</a>(nb + <a href='../S/2317.html#L2130' title='Defined at 2130 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TOP_FOOT_SIZE</a> + <a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a>);
<a name='L3400'>        <i><font color='green'>/* Adjust to end on a page boundary */</font></i>
<a name='L3401'>        <b>if</b> (!<a href='../S/2317.html#L2088' title='Defined at 2088 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_page_aligned</a>(base))
<a name='L3402'>          asize += (<a href='../S/2317.html#L2081' title='Defined at 2081 in Modules/_ctypes/libffi/src/dlmalloc.c.'>page_align</a>((<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)base) - (<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)base);
<a name='L3403'>        <i><font color='green'>/* Can't call MORECORE if size is negative when treated as signed */</font></i>
<a name='L3404'>        <b>if</b> (asize &lt; <a href='../S/2317.html#L1254' title='Defined at 1254 in Modules/_ctypes/libffi/src/dlmalloc.c.'>HALF_MAX_SIZE_T</a> &amp;&amp;
<a name='L3405'>            (br = (<b>char</b>*)(<a href='../D/472.html' title='Multiple defined in 2 places.'>CALL_MORECORE</a>(asize))) == base) <font color='red'>{</font>
<a name='L3406'>          tbase = base;
<a name='L3407'>          tsize = asize;
<a name='L3408'>        <font color='red'>}</font>
<a name='L3409'>      <font color='red'>}</font>
<a name='L3410'>    <font color='red'>}</font>
<a name='L3411'>    <b>else</b> <font color='red'>{</font>
<a name='L3412'>      <i><font color='green'>/* Subtract out existing available top space from MORECORE request. */</font></i>
<a name='L3413'>      asize = <a href='../S/2317.html#L2085' title='Defined at 2085 in Modules/_ctypes/libffi/src/dlmalloc.c.'>granularity_align</a>(nb - m-&gt;topsize + <a href='../S/2317.html#L2130' title='Defined at 2130 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TOP_FOOT_SIZE</a> + <a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a>);
<a name='L3414'>      <i><font color='green'>/* Use mem here only if it did continuously extend old space */</font></i>
<a name='L3415'>      <b>if</b> (asize &lt; <a href='../S/2317.html#L1254' title='Defined at 1254 in Modules/_ctypes/libffi/src/dlmalloc.c.'>HALF_MAX_SIZE_T</a> &amp;&amp;
<a name='L3416'>          (br = (<b>char</b>*)(<a href='../D/472.html' title='Multiple defined in 2 places.'>CALL_MORECORE</a>(asize))) == ss-&gt;base+ss-&gt;size) <font color='red'>{</font>
<a name='L3417'>        tbase = br;
<a name='L3418'>        tsize = asize;
<a name='L3419'>      <font color='red'>}</font>
<a name='L3420'>    <font color='red'>}</font>
<a name='L3421'>
<a name='L3422'>    <b>if</b> (tbase == <a href='../S/2317.html#L1278' title='Defined at 1278 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CMFAIL</a>) <font color='red'>{</font>    <i><font color='green'>/* Cope with partial failure */</font></i>
<a name='L3423'>      <b>if</b> (br != <a href='../S/2317.html#L1278' title='Defined at 1278 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CMFAIL</a>) <font color='red'>{</font>    <i><font color='green'>/* Try to use/extend the space we did get */</font></i>
<a name='L3424'>        <b>if</b> (asize &lt; <a href='../S/2317.html#L1254' title='Defined at 1254 in Modules/_ctypes/libffi/src/dlmalloc.c.'>HALF_MAX_SIZE_T</a> &amp;&amp;
<a name='L3425'>            asize &lt; nb + <a href='../S/2317.html#L2130' title='Defined at 2130 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TOP_FOOT_SIZE</a> + <a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a>) <font color='red'>{</font>
<a name='L3426'>          <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> esize = <a href='../S/2317.html#L2085' title='Defined at 2085 in Modules/_ctypes/libffi/src/dlmalloc.c.'>granularity_align</a>(nb + <a href='../S/2317.html#L2130' title='Defined at 2130 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TOP_FOOT_SIZE</a> + <a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a> - asize);
<a name='L3427'>          <b>if</b> (esize &lt; <a href='../S/2317.html#L1254' title='Defined at 1254 in Modules/_ctypes/libffi/src/dlmalloc.c.'>HALF_MAX_SIZE_T</a>) <font color='red'>{</font>
<a name='L3428'>            <b>char</b>* end = (<b>char</b>*)<a href='../D/472.html' title='Multiple defined in 2 places.'>CALL_MORECORE</a>(esize);
<a name='L3429'>            <b>if</b> (end != <a href='../S/2317.html#L1278' title='Defined at 1278 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CMFAIL</a>)
<a name='L3430'>              asize += esize;
<a name='L3431'>            <b>else</b> <font color='red'>{</font>            <i><font color='green'>/* Can't use; try to release */</font></i>
<a name='L3432'>              (<b>void</b>)<a href='../D/472.html' title='Multiple defined in 2 places.'>CALL_MORECORE</a>(-asize);
<a name='L3433'>              br = <a href='../S/2317.html#L1278' title='Defined at 1278 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CMFAIL</a>;
<a name='L3434'>            <font color='red'>}</font>
<a name='L3435'>          <font color='red'>}</font>
<a name='L3436'>        <font color='red'>}</font>
<a name='L3437'>      <font color='red'>}</font>
<a name='L3438'>      <b>if</b> (br != <a href='../S/2317.html#L1278' title='Defined at 1278 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CMFAIL</a>) <font color='red'>{</font>    <i><font color='green'>/* Use the space we did get */</font></i>
<a name='L3439'>        tbase = br;
<a name='L3440'>        tsize = asize;
<a name='L3441'>      <font color='red'>}</font>
<a name='L3442'>      <b>else</b>
<a name='L3443'>        <a href='../S/2317.html#L2073' title='Defined at 2073 in Modules/_ctypes/libffi/src/dlmalloc.c.'>disable_contiguous</a>(m); <i><font color='green'>/* Don't try contiguous path in the future */</font></i>
<a name='L3444'>    <font color='red'>}</font>
<a name='L3445'>
<a name='L3446'>    <a href='../D/4467.html' title='Multiple defined in 2 places.'>RELEASE_MORECORE_LOCK</a>();
<a name='L3447'>  <font color='red'>}</font>
<a name='L3448'>
<a name='L3449'>  <b>if</b> (<a href='../D/1532.html' title='Multiple defined in 5 places.'>HAVE_MMAP</a> &amp;&amp; tbase == <a href='../S/2317.html#L1278' title='Defined at 1278 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CMFAIL</a>) <font color='red'>{</font>  <i><font color='green'>/* Try MMAP */</font></i>
<a name='L3450'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> req = nb + <a href='../S/2317.html#L2130' title='Defined at 2130 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TOP_FOOT_SIZE</a> + <a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a>;
<a name='L3451'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> rsize = <a href='../S/2317.html#L2085' title='Defined at 2085 in Modules/_ctypes/libffi/src/dlmalloc.c.'>granularity_align</a>(req);
<a name='L3452'>    <b>if</b> (rsize &gt; nb) <font color='red'>{</font> <i><font color='green'>/* Fail if wraps around zero */</font></i>
<a name='L3453'>      <b>char</b>* mp = (<b>char</b>*)(<a href='../D/471.html' title='Multiple defined in 4 places.'>CALL_MMAP</a>(rsize));
<a name='L3454'>      <b>if</b> (mp != <a href='../S/2317.html#L1278' title='Defined at 1278 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CMFAIL</a>) <font color='red'>{</font>
<a name='L3455'>        tbase = mp;
<a name='L3456'>        tsize = rsize;
<a name='L3457'>        mmap_flag = <a href='../D/1787.html' title='Multiple defined in 2 places.'>IS_MMAPPED_BIT</a>;
<a name='L3458'>      <font color='red'>}</font>
<a name='L3459'>    <font color='red'>}</font>
<a name='L3460'>  <font color='red'>}</font>
<a name='L3461'>
<a name='L3462'>  <b>if</b> (<a href='../D/1537.html' title='Multiple defined in 5 places.'>HAVE_MORECORE</a> &amp;&amp; tbase == <a href='../S/2317.html#L1278' title='Defined at 1278 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CMFAIL</a>) <font color='red'>{</font> <i><font color='green'>/* Try noncontiguous MORECORE */</font></i>
<a name='L3463'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> asize = <a href='../S/2317.html#L2085' title='Defined at 2085 in Modules/_ctypes/libffi/src/dlmalloc.c.'>granularity_align</a>(nb + <a href='../S/2317.html#L2130' title='Defined at 2130 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TOP_FOOT_SIZE</a> + <a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a>);
<a name='L3464'>    <b>if</b> (asize &lt; <a href='../S/2317.html#L1254' title='Defined at 1254 in Modules/_ctypes/libffi/src/dlmalloc.c.'>HALF_MAX_SIZE_T</a>) <font color='red'>{</font>
<a name='L3465'>      <b>char</b>* br = <a href='../S/2317.html#L1278' title='Defined at 1278 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CMFAIL</a>;
<a name='L3466'>      <b>char</b>* end = <a href='../S/2317.html#L1278' title='Defined at 1278 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CMFAIL</a>;
<a name='L3467'>      <a href='../D/22.html' title='Multiple defined in 2 places.'>ACQUIRE_MORECORE_LOCK</a>();
<a name='L3468'>      br = (<b>char</b>*)(<a href='../D/472.html' title='Multiple defined in 2 places.'>CALL_MORECORE</a>(asize));
<a name='L3469'>      end = (<b>char</b>*)(<a href='../D/472.html' title='Multiple defined in 2 places.'>CALL_MORECORE</a>(0));
<a name='L3470'>      <a href='../D/4467.html' title='Multiple defined in 2 places.'>RELEASE_MORECORE_LOCK</a>();
<a name='L3471'>      <b>if</b> (br != <a href='../S/2317.html#L1278' title='Defined at 1278 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CMFAIL</a> &amp;&amp; end != <a href='../S/2317.html#L1278' title='Defined at 1278 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CMFAIL</a> &amp;&amp; br &lt; end) <font color='red'>{</font>
<a name='L3472'>        <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> ssize = end - br;
<a name='L3473'>        <b>if</b> (ssize &gt; nb + <a href='../S/2317.html#L2130' title='Defined at 2130 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TOP_FOOT_SIZE</a>) <font color='red'>{</font>
<a name='L3474'>          tbase = br;
<a name='L3475'>          tsize = ssize;
<a name='L3476'>        <font color='red'>}</font>
<a name='L3477'>      <font color='red'>}</font>
<a name='L3478'>    <font color='red'>}</font>
<a name='L3479'>  <font color='red'>}</font>
<a name='L3480'>
<a name='L3481'>  <b>if</b> (tbase != <a href='../S/2317.html#L1278' title='Defined at 1278 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CMFAIL</a>) <font color='red'>{</font>
<a name='L3482'>
<a name='L3483'>    <b>if</b> ((m-&gt;footprint += tsize) &gt; m-&gt;max_footprint)
<a name='L3484'>      m-&gt;max_footprint = m-&gt;footprint;
<a name='L3485'>
<a name='L3486'>    <b>if</b> (!<a href='../S/2317.html#L2058' title='Defined at 2058 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_initialized</a>(m)) <font color='red'>{</font> <i><font color='green'>/* first-time initialization */</font></i>
<a name='L3487'>      m-&gt;seg.base = m-&gt;least_addr = tbase;
<a name='L3488'>      m-&gt;seg.size = tsize;
<a name='L3489'>      <a href='../D/11106.html' title='Multiple defined in 2 places.'>set_segment_flags</a>(&amp;m-&gt;seg, mmap_flag);
<a name='L3490'>      m-&gt;magic = mparams.magic;
<a name='L3491'>      <a href='../S/2317.html#L3232' title='Defined at 3232 in Modules/_ctypes/libffi/src/dlmalloc.c.'>init_bins</a>(m);
<a name='L3492'>      <b>if</b> (<a href='../S/2317.html#L2057' title='Defined at 2057 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_global</a>(m)) 
<a name='L3493'>        <a href='../S/2317.html#L3217' title='Defined at 3217 in Modules/_ctypes/libffi/src/dlmalloc.c.'>init_top</a>(m, (<a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a>)tbase, tsize - <a href='../S/2317.html#L2130' title='Defined at 2130 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TOP_FOOT_SIZE</a>);
<a name='L3494'>      <b>else</b> <font color='red'>{</font>
<a name='L3495'>        <i><font color='green'>/* Offset top by embedded malloc_state */</font></i>
<a name='L3496'>        <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> mn = <a href='../S/2317.html#L1679' title='Defined at 1679 in Modules/_ctypes/libffi/src/dlmalloc.c.'>next_chunk</a>(<a href='../S/2317.html#L1632' title='Defined at 1632 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mem2chunk</a>(m));
<a name='L3497'>        <a href='../S/2317.html#L3217' title='Defined at 3217 in Modules/_ctypes/libffi/src/dlmalloc.c.'>init_top</a>(m, mn, (<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)((tbase + tsize) - (<b>char</b>*)mn) -<a href='../S/2317.html#L2130' title='Defined at 2130 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TOP_FOOT_SIZE</a>);
<a name='L3498'>      <font color='red'>}</font>
<a name='L3499'>    <font color='red'>}</font>
<a name='L3500'>
<a name='L3501'>    <b>else</b> <font color='red'>{</font>
<a name='L3502'>      <i><font color='green'>/* Try to merge with an existing segment */</font></i>
<a name='L3503'>      <a href='../S/2317.html#L1925' title='Defined at 1925 in Modules/_ctypes/libffi/src/dlmalloc.c.'>msegmentptr</a> sp = &amp;m-&gt;seg;
<a name='L3504'>      <b>while</b> (sp != 0 &amp;&amp; tbase != sp-&gt;base + sp-&gt;size)
<a name='L3505'>        sp = sp-&gt;next;
<a name='L3506'>      <b>if</b> (sp != 0 &amp;&amp;
<a name='L3507'>          !<a href='../S/2317.html#L1922' title='Defined at 1922 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_extern_segment</a>(sp) &amp;&amp;
<a name='L3508'>          <a href='../D/7413.html' title='Multiple defined in 2 places.'>check_segment_merge</a>(sp, tbase, tsize) &amp;&amp;
<a name='L3509'>          (<a href='../D/8894.html' title='Multiple defined in 2 places.'>get_segment_flags</a>(sp) &amp; <a href='../D/1787.html' title='Multiple defined in 2 places.'>IS_MMAPPED_BIT</a>) == mmap_flag &amp;&amp;
<a name='L3510'>          <a href='../S/2317.html#L2094' title='Defined at 2094 in Modules/_ctypes/libffi/src/dlmalloc.c.'>segment_holds</a>(sp, m-&gt;top)) <font color='red'>{</font> <i><font color='green'>/* append */</font></i>
<a name='L3511'>        sp-&gt;size += tsize;
<a name='L3512'>        <a href='../S/2317.html#L3217' title='Defined at 3217 in Modules/_ctypes/libffi/src/dlmalloc.c.'>init_top</a>(m, m-&gt;top, m-&gt;topsize + tsize);
<a name='L3513'>      <font color='red'>}</font>
<a name='L3514'>      <b>else</b> <font color='red'>{</font>
<a name='L3515'>        <b>if</b> (tbase &lt; m-&gt;least_addr)
<a name='L3516'>          m-&gt;least_addr = tbase;
<a name='L3517'>        sp = &amp;m-&gt;seg;
<a name='L3518'>        <b>while</b> (sp != 0 &amp;&amp; sp-&gt;base != tbase + tsize)
<a name='L3519'>          sp = sp-&gt;next;
<a name='L3520'>        <b>if</b> (sp != 0 &amp;&amp;
<a name='L3521'>            !<a href='../S/2317.html#L1922' title='Defined at 1922 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_extern_segment</a>(sp) &amp;&amp;
<a name='L3522'>            <a href='../D/7413.html' title='Multiple defined in 2 places.'>check_segment_merge</a>(sp, tbase, tsize) &amp;&amp;
<a name='L3523'>            (<a href='../D/8894.html' title='Multiple defined in 2 places.'>get_segment_flags</a>(sp) &amp; <a href='../D/1787.html' title='Multiple defined in 2 places.'>IS_MMAPPED_BIT</a>) == mmap_flag) <font color='red'>{</font>
<a name='L3524'>          <b>char</b>* oldbase = sp-&gt;base;
<a name='L3525'>          sp-&gt;base = tbase;
<a name='L3526'>          sp-&gt;size += tsize;
<a name='L3527'>          <b>return</b> <a href='../S/2317.html#L3261' title='Defined at 3261 in Modules/_ctypes/libffi/src/dlmalloc.c.'>prepend_alloc</a>(m, tbase, oldbase, nb);
<a name='L3528'>        <font color='red'>}</font>
<a name='L3529'>        <b>else</b>
<a name='L3530'>          <a href='../S/2317.html#L3304' title='Defined at 3304 in Modules/_ctypes/libffi/src/dlmalloc.c.'>add_segment</a>(m, tbase, tsize, mmap_flag);
<a name='L3531'>      <font color='red'>}</font>
<a name='L3532'>    <font color='red'>}</font>
<a name='L3533'>
<a name='L3534'>    <b>if</b> (nb &lt; m-&gt;topsize) <font color='red'>{</font> <i><font color='green'>/* Allocate from new or extended top space */</font></i>
<a name='L3535'>      <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> rsize = m-&gt;topsize -= nb;
<a name='L3536'>      <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> p = m-&gt;top;
<a name='L3537'>      <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> r = m-&gt;top = <a href='../S/2317.html#L1675' title='Defined at 1675 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk_plus_offset</a>(p, nb);
<a name='L3538'>      r-&gt;head = rsize | <a href='../S/2317.html#L1659' title='Defined at 1659 in Modules/_ctypes/libffi/src/dlmalloc.c.'>PINUSE_BIT</a>;
<a name='L3539'>      <a href='../D/11108.html' title='Multiple defined in 2 places.'>set_size_and_pinuse_of_inuse_chunk</a>(m, p, nb);
<a name='L3540'>      <a href='../D/7416.html' title='Multiple defined in 2 places.'>check_top_chunk</a>(m, m-&gt;top);
<a name='L3541'>      <a href='../D/7408.html' title='Multiple defined in 2 places.'>check_malloced_chunk</a>(m, <a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(p), nb);
<a name='L3542'>      <b>return</b> <a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(p);
<a name='L3543'>    <font color='red'>}</font>
<a name='L3544'>  <font color='red'>}</font>
<a name='L3545'>
<a name='L3546'>  <a href='../D/2013.html' title='Multiple defined in 2 places.'>MALLOC_FAILURE_ACTION</a>;
<a name='L3547'>  <b>return</b> 0;
<a name='L3548'><font color='red'>}</font>
<a name='L3549'>
<a name='L3550'><i><font color='green'>/* -----------------------  system deallocation -------------------------- */</font></i>
<a name='L3551'>
<a name='L3552'><i><font color='green'>/* Unmap and unlink any mmapped segments that don't contain used chunks */</font></i>
<a name='L3553'><b>static</b> <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> <a href='../S/2317.html#L3646' title='Refered from 3646 in Modules/_ctypes/libffi/src/dlmalloc.c.'>release_unused_segments</a>(mstate m) <font color='red'>{</font>
<a name='L3554'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> released = 0;
<a name='L3555'>  <a href='../S/2317.html#L1925' title='Defined at 1925 in Modules/_ctypes/libffi/src/dlmalloc.c.'>msegmentptr</a> pred = &amp;m-&gt;seg;
<a name='L3556'>  <a href='../S/2317.html#L1925' title='Defined at 1925 in Modules/_ctypes/libffi/src/dlmalloc.c.'>msegmentptr</a> sp = pred-&gt;next;
<a name='L3557'>  <b>while</b> (sp != 0) <font color='red'>{</font>
<a name='L3558'>    <b>char</b>* base = sp-&gt;base;
<a name='L3559'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> size = sp-&gt;size;
<a name='L3560'>    <a href='../S/2317.html#L1925' title='Defined at 1925 in Modules/_ctypes/libffi/src/dlmalloc.c.'>msegmentptr</a> next = sp-&gt;next;
<a name='L3561'>    <b>if</b> (<a href='../S/2317.html#L1921' title='Defined at 1921 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_mmapped_segment</a>(sp) &amp;&amp; !<a href='../S/2317.html#L1922' title='Defined at 1922 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_extern_segment</a>(sp)) <font color='red'>{</font>
<a name='L3562'>      <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> p = <a href='../S/2317.html#L1634' title='Defined at 1634 in Modules/_ctypes/libffi/src/dlmalloc.c.'>align_as_chunk</a>(base);
<a name='L3563'>      <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> psize = <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(p);
<a name='L3564'>      <i><font color='green'>/* Can unmap if first chunk holds entire segment and not pinned */</font></i>
<a name='L3565'>      <b>if</b> (!<a href='../S/2317.html#L1667' title='Defined at 1667 in Modules/_ctypes/libffi/src/dlmalloc.c.'>cinuse</a>(p) &amp;&amp; (<b>char</b>*)p + psize &gt;= base + size - <a href='../S/2317.html#L2130' title='Defined at 2130 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TOP_FOOT_SIZE</a>) <font color='red'>{</font>
<a name='L3566'>        <a href='../S/2317.html#L1815' title='Defined at 1815 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tchunkptr</a> tp = (<a href='../S/2317.html#L1815' title='Defined at 1815 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tchunkptr</a>)p;
<a name='L3567'>        <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../S/2317.html#L2094' title='Defined at 2094 in Modules/_ctypes/libffi/src/dlmalloc.c.'>segment_holds</a>(sp, (<b>char</b>*)sp));
<a name='L3568'>        <b>if</b> (p == m-&gt;dv) <font color='red'>{</font>
<a name='L3569'>          m-&gt;dv = 0;
<a name='L3570'>          m-&gt;dvsize = 0;
<a name='L3571'>        <font color='red'>}</font>
<a name='L3572'>        <b>else</b> <font color='red'>{</font>
<a name='L3573'>          <a href='../S/2317.html#L3041' title='Defined at 3041 in Modules/_ctypes/libffi/src/dlmalloc.c.'>unlink_large_chunk</a>(m, tp);
<a name='L3574'>        <font color='red'>}</font>
<a name='L3575'>        <b>if</b> (<a href='../D/474.html' title='Multiple defined in 3 places.'>CALL_MUNMAP</a>(base, size) == 0) <font color='red'>{</font>
<a name='L3576'>          released += size;
<a name='L3577'>          m-&gt;footprint -= size;
<a name='L3578'>          <i><font color='green'>/* unlink obsoleted record */</font></i>
<a name='L3579'>          sp = pred;
<a name='L3580'>          sp-&gt;next = next;
<a name='L3581'>        <font color='red'>}</font>
<a name='L3582'>        <b>else</b> <font color='red'>{</font> <i><font color='green'>/* back out if cannot unmap */</font></i>
<a name='L3583'>          <a href='../S/2317.html#L2973' title='Defined at 2973 in Modules/_ctypes/libffi/src/dlmalloc.c.'>insert_large_chunk</a>(m, tp, psize);
<a name='L3584'>        <font color='red'>}</font>
<a name='L3585'>      <font color='red'>}</font>
<a name='L3586'>    <font color='red'>}</font>
<a name='L3587'>    pred = sp;
<a name='L3588'>    sp = next;
<a name='L3589'>  <font color='red'>}</font>
<a name='L3590'>  <b>return</b> released;
<a name='L3591'><font color='red'>}</font>
<a name='L3592'>
<a name='L3593'><b>static</b> <b>int</b> <a href='../R/10703.html' title='Multiple refered from 4 places.'>sys_trim</a>(mstate m, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> pad) <font color='red'>{</font>
<a name='L3594'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> released = 0;
<a name='L3595'>  <b>if</b> (<a href='../S/2828.html#L6780' title='Defined at 6780 in Objects/unicodeobject.c.'>pad</a> &lt; <a href='../S/2317.html#L1637' title='Defined at 1637 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MAX_REQUEST</a> &amp;&amp; <a href='../S/2317.html#L2058' title='Defined at 2058 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_initialized</a>(m)) <font color='red'>{</font>
<a name='L3596'>    <a href='../S/2828.html#L6780' title='Defined at 6780 in Objects/unicodeobject.c.'>pad</a> += <a href='../S/2317.html#L2130' title='Defined at 2130 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TOP_FOOT_SIZE</a>; <i><font color='green'>/* ensure enough room for segment overhead */</font></i>
<a name='L3597'>
<a name='L3598'>    <b>if</b> (m-&gt;topsize &gt; <a href='../S/2828.html#L6780' title='Defined at 6780 in Objects/unicodeobject.c.'>pad</a>) <font color='red'>{</font>
<a name='L3599'>      <i><font color='green'>/* Shrink top space in granularity-size units, keeping at least one */</font></i>
<a name='L3600'>      <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> unit = mparams.granularity;
<a name='L3601'>      <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> extra = ((m-&gt;topsize - <a href='../S/2828.html#L6780' title='Defined at 6780 in Objects/unicodeobject.c.'>pad</a> + (unit - <a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a>)) / unit -
<a name='L3602'>                      <a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a>) * unit;
<a name='L3603'>      <a href='../S/2317.html#L1925' title='Defined at 1925 in Modules/_ctypes/libffi/src/dlmalloc.c.'>msegmentptr</a> sp = <a href='../S/2317.html#L2098' title='Defined at 2098 in Modules/_ctypes/libffi/src/dlmalloc.c.'>segment_holding</a>(m, (<b>char</b>*)m-&gt;top);
<a name='L3604'>
<a name='L3605'>      <b>if</b> (!<a href='../S/2317.html#L1922' title='Defined at 1922 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_extern_segment</a>(sp)) <font color='red'>{</font>
<a name='L3606'>        <b>if</b> (<a href='../S/2317.html#L1921' title='Defined at 1921 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_mmapped_segment</a>(sp)) <font color='red'>{</font>
<a name='L3607'>          <b>if</b> (<a href='../D/1532.html' title='Multiple defined in 5 places.'>HAVE_MMAP</a> &amp;&amp;
<a name='L3608'>              sp-&gt;size &gt;= extra &amp;&amp;
<a name='L3609'>              !<a href='../S/2317.html#L2109' title='Defined at 2109 in Modules/_ctypes/libffi/src/dlmalloc.c.'>has_segment_link</a>(m, sp)) <font color='red'>{</font> <i><font color='green'>/* can't shrink if pinned */</font></i>
<a name='L3610'>            <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> newsize = sp-&gt;size - extra;
<a name='L3611'>            <i><font color='green'>/* Prefer mremap, fall back to munmap */</font></i>
<a name='L3612'>            <b>if</b> ((<a href='../D/473.html' title='Multiple defined in 2 places.'>CALL_MREMAP</a>(sp-&gt;base, sp-&gt;size, newsize, 0) != <a href='../S/2317.html#L1277' title='Defined at 1277 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MFAIL</a>) ||
<a name='L3613'>                (<a href='../D/474.html' title='Multiple defined in 3 places.'>CALL_MUNMAP</a>(sp-&gt;base + newsize, extra) == 0)) <font color='red'>{</font>
<a name='L3614'>              released = extra;
<a name='L3615'>            <font color='red'>}</font>
<a name='L3616'>          <font color='red'>}</font>
<a name='L3617'>        <font color='red'>}</font>
<a name='L3618'>        <b>else</b> <b>if</b> (<a href='../D/1537.html' title='Multiple defined in 5 places.'>HAVE_MORECORE</a>) <font color='red'>{</font>
<a name='L3619'>          <b>if</b> (extra &gt;= <a href='../S/2317.html#L1254' title='Defined at 1254 in Modules/_ctypes/libffi/src/dlmalloc.c.'>HALF_MAX_SIZE_T</a>) <i><font color='green'>/* Avoid wrapping negative */</font></i>
<a name='L3620'>            extra = (<a href='../S/2317.html#L1254' title='Defined at 1254 in Modules/_ctypes/libffi/src/dlmalloc.c.'>HALF_MAX_SIZE_T</a>) + <a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a> - unit;
<a name='L3621'>          <a href='../D/22.html' title='Multiple defined in 2 places.'>ACQUIRE_MORECORE_LOCK</a>();
<a name='L3622'>          <font color='red'>{</font>
<a name='L3623'>            <i><font color='green'>/* Make sure end of memory is where we last set it. */</font></i>
<a name='L3624'>            <b>char</b>* old_br = (<b>char</b>*)(<a href='../D/472.html' title='Multiple defined in 2 places.'>CALL_MORECORE</a>(0));
<a name='L3625'>            <b>if</b> (old_br == sp-&gt;base + sp-&gt;size) <font color='red'>{</font>
<a name='L3626'>              <b>char</b>* rel_br = (<b>char</b>*)(<a href='../D/472.html' title='Multiple defined in 2 places.'>CALL_MORECORE</a>(-extra));
<a name='L3627'>              <b>char</b>* new_br = (<b>char</b>*)(<a href='../D/472.html' title='Multiple defined in 2 places.'>CALL_MORECORE</a>(0));
<a name='L3628'>              <b>if</b> (rel_br != <a href='../S/2317.html#L1278' title='Defined at 1278 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CMFAIL</a> &amp;&amp; new_br &lt; old_br)
<a name='L3629'>                released = old_br - new_br;
<a name='L3630'>            <font color='red'>}</font>
<a name='L3631'>          <font color='red'>}</font>
<a name='L3632'>          <a href='../D/4467.html' title='Multiple defined in 2 places.'>RELEASE_MORECORE_LOCK</a>();
<a name='L3633'>        <font color='red'>}</font>
<a name='L3634'>      <font color='red'>}</font>
<a name='L3635'>
<a name='L3636'>      <b>if</b> (released != 0) <font color='red'>{</font>
<a name='L3637'>        sp-&gt;size -= released;
<a name='L3638'>        m-&gt;footprint -= released;
<a name='L3639'>        <a href='../S/2317.html#L3217' title='Defined at 3217 in Modules/_ctypes/libffi/src/dlmalloc.c.'>init_top</a>(m, m-&gt;top, m-&gt;topsize - released);
<a name='L3640'>        <a href='../D/7416.html' title='Multiple defined in 2 places.'>check_top_chunk</a>(m, m-&gt;top);
<a name='L3641'>      <font color='red'>}</font>
<a name='L3642'>    <font color='red'>}</font>
<a name='L3643'>
<a name='L3644'>    <i><font color='green'>/* Unmap any unused mmapped segments */</font></i>
<a name='L3645'>    <b>if</b> (<a href='../D/1532.html' title='Multiple defined in 5 places.'>HAVE_MMAP</a>) 
<a name='L3646'>      released += <a href='../S/2317.html#L3553' title='Defined at 3553 in Modules/_ctypes/libffi/src/dlmalloc.c.'>release_unused_segments</a>(m);
<a name='L3647'>
<a name='L3648'>    <i><font color='green'>/* On failure, disable autotrim to avoid repeated failed future calls */</font></i>
<a name='L3649'>    <b>if</b> (released == 0)
<a name='L3650'>      m-&gt;trim_check = <a href='../S/2317.html#L475' title='Defined at 475 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MAX_SIZE_T</a>;
<a name='L3651'>  <font color='red'>}</font>
<a name='L3652'>
<a name='L3653'>  <b>return</b> (released != 0)? 1 : 0;
<a name='L3654'><font color='red'>}</font>
<a name='L3655'>
<a name='L3656'><i><font color='green'>/* ---------------------------- malloc support --------------------------- */</font></i>
<a name='L3657'>
<a name='L3658'><i><font color='green'>/* allocate a large request from the best fitting chunk in a treebin */</font></i>
<a name='L3659'><b>static</b> <b>void</b>* <a href='../R/10925.html' title='Multiple refered from 2 places.'>tmalloc_large</a>(mstate m, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> nb) <font color='red'>{</font>
<a name='L3660'>  <a href='../S/2317.html#L1815' title='Defined at 1815 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tchunkptr</a> v = 0;
<a name='L3661'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> rsize = -nb; <i><font color='green'>/* Unsigned negation */</font></i>
<a name='L3662'>  <a href='../S/2317.html#L1815' title='Defined at 1815 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tchunkptr</a> t;
<a name='L3663'>  <a href='../S/2317.html#L1607' title='Defined at 1607 in Modules/_ctypes/libffi/src/dlmalloc.c.'>bindex_t</a> idx;
<a name='L3664'>  <a href='../D/7736.html' title='Multiple defined in 2 places.'>compute_tree_index</a>(nb, idx);
<a name='L3665'>
<a name='L3666'>  <b>if</b> ((t = *<a href='../S/2317.html#L2234' title='Defined at 2234 in Modules/_ctypes/libffi/src/dlmalloc.c.'>treebin_at</a>(m, idx)) != 0) <font color='red'>{</font>
<a name='L3667'>    <i><font color='green'>/* Traverse tree for this bin looking for node with size == nb */</font></i>
<a name='L3668'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> sizebits = nb &lt;&lt; <a href='../S/2317.html#L2276' title='Defined at 2276 in Modules/_ctypes/libffi/src/dlmalloc.c.'>leftshift_for_tree_index</a>(idx);
<a name='L3669'>    <a href='../S/2317.html#L1815' title='Defined at 1815 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tchunkptr</a> rst = 0;  <i><font color='green'>/* The deepest untaken right subtree */</font></i>
<a name='L3670'>    <b>for</b> (;;) <font color='red'>{</font>
<a name='L3671'>      <a href='../S/2317.html#L1815' title='Defined at 1815 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tchunkptr</a> rt;
<a name='L3672'>      <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> trem = <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(t) - nb;
<a name='L3673'>      <b>if</b> (trem &lt; rsize) <font color='red'>{</font>
<a name='L3674'>        v = t;
<a name='L3675'>        <b>if</b> ((rsize = trem) == 0)
<a name='L3676'>          <b>break</b>;
<a name='L3677'>      <font color='red'>}</font>
<a name='L3678'>      rt = t-&gt;child[1];
<a name='L3679'>      t = t-&gt;child[(sizebits &gt;&gt; (<a href='../S/2317.html#L1244' title='Defined at 1244 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_BITSIZE</a>-<a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a>)) &amp; 1];
<a name='L3680'>      <b>if</b> (rt != 0 &amp;&amp; rt != t)
<a name='L3681'>        rst = rt;
<a name='L3682'>      <b>if</b> (t == 0) <font color='red'>{</font>
<a name='L3683'>        t = rst; <i><font color='green'>/* set t to least subtree holding sizes &gt; nb */</font></i>
<a name='L3684'>        <b>break</b>;
<a name='L3685'>      <font color='red'>}</font>
<a name='L3686'>      sizebits &lt;&lt;= 1;
<a name='L3687'>    <font color='red'>}</font>
<a name='L3688'>  <font color='red'>}</font>
<a name='L3689'>
<a name='L3690'>  <b>if</b> (t == 0 &amp;&amp; v == 0) <font color='red'>{</font> <i><font color='green'>/* set t to root of next non-empty treebin */</font></i>
<a name='L3691'>    <a href='../S/2317.html#L1608' title='Defined at 1608 in Modules/_ctypes/libffi/src/dlmalloc.c.'>binmap_t</a> leftbits = <a href='../S/2317.html#L2333' title='Defined at 2333 in Modules/_ctypes/libffi/src/dlmalloc.c.'>left_bits</a>(<a href='../S/2317.html#L2289' title='Defined at 2289 in Modules/_ctypes/libffi/src/dlmalloc.c.'>idx2bit</a>(idx)) &amp; m-&gt;treemap;
<a name='L3692'>    <b>if</b> (leftbits != 0) <font color='red'>{</font>
<a name='L3693'>      <a href='../S/2317.html#L1607' title='Defined at 1607 in Modules/_ctypes/libffi/src/dlmalloc.c.'>bindex_t</a> i;
<a name='L3694'>      <a href='../S/2317.html#L1608' title='Defined at 1608 in Modules/_ctypes/libffi/src/dlmalloc.c.'>binmap_t</a> leastbit = <a href='../S/2317.html#L2330' title='Defined at 2330 in Modules/_ctypes/libffi/src/dlmalloc.c.'>least_bit</a>(leftbits);
<a name='L3695'>      <a href='../D/7728.html' title='Multiple defined in 3 places.'>compute_bit2idx</a>(leastbit, i);
<a name='L3696'>      t = *<a href='../S/2317.html#L2234' title='Defined at 2234 in Modules/_ctypes/libffi/src/dlmalloc.c.'>treebin_at</a>(m, i);
<a name='L3697'>    <font color='red'>}</font>
<a name='L3698'>  <font color='red'>}</font>
<a name='L3699'>
<a name='L3700'>  <b>while</b> (t != 0) <font color='red'>{</font> <i><font color='green'>/* find smallest of tree or subtree */</font></i>
<a name='L3701'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> trem = <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(t) - nb;
<a name='L3702'>    <b>if</b> (trem &lt; rsize) <font color='red'>{</font>
<a name='L3703'>      rsize = trem;
<a name='L3704'>      v = t;
<a name='L3705'>    <font color='red'>}</font>
<a name='L3706'>    t = <a href='../S/2317.html#L1819' title='Defined at 1819 in Modules/_ctypes/libffi/src/dlmalloc.c.'>leftmost_child</a>(t);
<a name='L3707'>  <font color='red'>}</font>
<a name='L3708'>
<a name='L3709'>  <i><font color='green'>/*  If dv is a better fit, return 0 so malloc will use it */</font></i>
<a name='L3710'>  <b>if</b> (v != 0 &amp;&amp; rsize &lt; (<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)(m-&gt;dvsize - nb)) <font color='red'>{</font>
<a name='L3711'>    <b>if</b> (<a href='../D/4519.html' title='Multiple defined in 3 places.'>RTCHECK</a>(<a href='../D/10195.html' title='Multiple defined in 2 places.'>ok_address</a>(m, v))) <font color='red'>{</font> <i><font color='green'>/* split */</font></i>
<a name='L3712'>      <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> r = <a href='../S/2317.html#L1675' title='Defined at 1675 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk_plus_offset</a>(v, nb);
<a name='L3713'>      <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(v) == rsize + nb);
<a name='L3714'>      <b>if</b> (<a href='../D/4519.html' title='Multiple defined in 3 places.'>RTCHECK</a>(<a href='../D/10198.html' title='Multiple defined in 2 places.'>ok_next</a>(v, r))) <font color='red'>{</font>
<a name='L3715'>        <a href='../S/2317.html#L3041' title='Defined at 3041 in Modules/_ctypes/libffi/src/dlmalloc.c.'>unlink_large_chunk</a>(m, v);
<a name='L3716'>        <b>if</b> (rsize &lt; <a href='../S/2317.html#L1627' title='Defined at 1627 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MIN_CHUNK_SIZE</a>)
<a name='L3717'>          <a href='../D/11079.html' title='Multiple defined in 2 places.'>set_inuse_and_pinuse</a>(m, v, (rsize + nb));
<a name='L3718'>        <b>else</b> <font color='red'>{</font>
<a name='L3719'>          <a href='../D/11108.html' title='Multiple defined in 2 places.'>set_size_and_pinuse_of_inuse_chunk</a>(m, v, nb);
<a name='L3720'>          <a href='../S/2317.html#L1690' title='Defined at 1690 in Modules/_ctypes/libffi/src/dlmalloc.c.'>set_size_and_pinuse_of_free_chunk</a>(r, rsize);
<a name='L3721'>          <a href='../S/2317.html#L3114' title='Defined at 3114 in Modules/_ctypes/libffi/src/dlmalloc.c.'>insert_chunk</a>(m, r, rsize);
<a name='L3722'>        <font color='red'>}</font>
<a name='L3723'>        <b>return</b> <a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(v);
<a name='L3724'>      <font color='red'>}</font>
<a name='L3725'>    <font color='red'>}</font>
<a name='L3726'>    <a href='../D/635.html' title='Multiple defined in 2 places.'>CORRUPTION_ERROR_ACTION</a>(m);
<a name='L3727'>  <font color='red'>}</font>
<a name='L3728'>  <b>return</b> 0;
<a name='L3729'><font color='red'>}</font>
<a name='L3730'>
<a name='L3731'><i><font color='green'>/* allocate a small request from the best fitting chunk in a treebin */</font></i>
<a name='L3732'><b>static</b> <b>void</b>* <a href='../R/10926.html' title='Multiple refered from 2 places.'>tmalloc_small</a>(mstate m, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> nb) <font color='red'>{</font>
<a name='L3733'>  <a href='../S/2317.html#L1815' title='Defined at 1815 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tchunkptr</a> t, v;
<a name='L3734'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> rsize;
<a name='L3735'>  <a href='../S/2317.html#L1607' title='Defined at 1607 in Modules/_ctypes/libffi/src/dlmalloc.c.'>bindex_t</a> i;
<a name='L3736'>  <a href='../S/2317.html#L1608' title='Defined at 1608 in Modules/_ctypes/libffi/src/dlmalloc.c.'>binmap_t</a> leastbit = <a href='../S/2317.html#L2330' title='Defined at 2330 in Modules/_ctypes/libffi/src/dlmalloc.c.'>least_bit</a>(m-&gt;treemap);
<a name='L3737'>  <a href='../D/7728.html' title='Multiple defined in 3 places.'>compute_bit2idx</a>(leastbit, i);
<a name='L3738'>
<a name='L3739'>  v = t = *<a href='../S/2317.html#L2234' title='Defined at 2234 in Modules/_ctypes/libffi/src/dlmalloc.c.'>treebin_at</a>(m, i);
<a name='L3740'>  rsize = <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(t) - nb;
<a name='L3741'>
<a name='L3742'>  <b>while</b> ((t = <a href='../S/2317.html#L1819' title='Defined at 1819 in Modules/_ctypes/libffi/src/dlmalloc.c.'>leftmost_child</a>(t)) != 0) <font color='red'>{</font>
<a name='L3743'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> trem = <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(t) - nb;
<a name='L3744'>    <b>if</b> (trem &lt; rsize) <font color='red'>{</font>
<a name='L3745'>      rsize = trem;
<a name='L3746'>      v = t;
<a name='L3747'>    <font color='red'>}</font>
<a name='L3748'>  <font color='red'>}</font>
<a name='L3749'>
<a name='L3750'>  <b>if</b> (<a href='../D/4519.html' title='Multiple defined in 3 places.'>RTCHECK</a>(<a href='../D/10195.html' title='Multiple defined in 2 places.'>ok_address</a>(m, v))) <font color='red'>{</font>
<a name='L3751'>    <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> r = <a href='../S/2317.html#L1675' title='Defined at 1675 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk_plus_offset</a>(v, nb);
<a name='L3752'>    <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(v) == rsize + nb);
<a name='L3753'>    <b>if</b> (<a href='../D/4519.html' title='Multiple defined in 3 places.'>RTCHECK</a>(<a href='../D/10198.html' title='Multiple defined in 2 places.'>ok_next</a>(v, r))) <font color='red'>{</font>
<a name='L3754'>      <a href='../S/2317.html#L3041' title='Defined at 3041 in Modules/_ctypes/libffi/src/dlmalloc.c.'>unlink_large_chunk</a>(m, v);
<a name='L3755'>      <b>if</b> (rsize &lt; <a href='../S/2317.html#L1627' title='Defined at 1627 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MIN_CHUNK_SIZE</a>)
<a name='L3756'>        <a href='../D/11079.html' title='Multiple defined in 2 places.'>set_inuse_and_pinuse</a>(m, v, (rsize + nb));
<a name='L3757'>      <b>else</b> <font color='red'>{</font>
<a name='L3758'>        <a href='../D/11108.html' title='Multiple defined in 2 places.'>set_size_and_pinuse_of_inuse_chunk</a>(m, v, nb);
<a name='L3759'>        <a href='../S/2317.html#L1690' title='Defined at 1690 in Modules/_ctypes/libffi/src/dlmalloc.c.'>set_size_and_pinuse_of_free_chunk</a>(r, rsize);
<a name='L3760'>        <a href='../S/2317.html#L2959' title='Defined at 2959 in Modules/_ctypes/libffi/src/dlmalloc.c.'>replace_dv</a>(m, r, rsize);
<a name='L3761'>      <font color='red'>}</font>
<a name='L3762'>      <b>return</b> <a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(v);
<a name='L3763'>    <font color='red'>}</font>
<a name='L3764'>  <font color='red'>}</font>
<a name='L3765'>
<a name='L3766'>  <a href='../D/635.html' title='Multiple defined in 2 places.'>CORRUPTION_ERROR_ACTION</a>(m);
<a name='L3767'>  <b>return</b> 0;
<a name='L3768'><font color='red'>}</font>
<a name='L3769'>
<a name='L3770'><i><font color='green'>/* --------------------------- realloc support --------------------------- */</font></i>
<a name='L3771'>
<a name='L3772'><b>static</b> <b>void</b>* <a href='../R/8453.html' title='Multiple refered from 2 places.'>internal_realloc</a>(mstate m, <b>void</b>* oldmem, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> bytes) <font color='red'>{</font>
<a name='L3773'>  <b>if</b> (<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> &gt;= <a href='../S/2317.html#L1637' title='Defined at 1637 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MAX_REQUEST</a>) <font color='red'>{</font>
<a name='L3774'>    <a href='../D/2013.html' title='Multiple defined in 2 places.'>MALLOC_FAILURE_ACTION</a>;
<a name='L3775'>    <b>return</b> 0;
<a name='L3776'>  <font color='red'>}</font>
<a name='L3777'>  <b>if</b> (!<a href='../D/2519.html' title='Multiple defined in 2 places.'>PREACTION</a>(m)) <font color='red'>{</font>
<a name='L3778'>    <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> oldp = <a href='../S/2317.html#L1632' title='Defined at 1632 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mem2chunk</a>(oldmem);
<a name='L3779'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> oldsize = <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(oldp);
<a name='L3780'>    <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> next = <a href='../S/2317.html#L1675' title='Defined at 1675 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk_plus_offset</a>(oldp, oldsize);
<a name='L3781'>    <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> newp = 0;
<a name='L3782'>    <b>void</b>* extra = 0;
<a name='L3783'>
<a name='L3784'>    <i><font color='green'>/* Try to either shrink or extend into top. Else malloc-copy-free */</font></i>
<a name='L3785'>
<a name='L3786'>    <b>if</b> (<a href='../D/4519.html' title='Multiple defined in 3 places.'>RTCHECK</a>(<a href='../D/10195.html' title='Multiple defined in 2 places.'>ok_address</a>(m, oldp) &amp;&amp; <a href='../D/10196.html' title='Multiple defined in 2 places.'>ok_cinuse</a>(oldp) &amp;&amp;
<a name='L3787'>                <a href='../D/10198.html' title='Multiple defined in 2 places.'>ok_next</a>(oldp, next) &amp;&amp; <a href='../D/10199.html' title='Multiple defined in 2 places.'>ok_pinuse</a>(next))) <font color='red'>{</font>
<a name='L3788'>      <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> nb = <a href='../S/2317.html#L1645' title='Defined at 1645 in Modules/_ctypes/libffi/src/dlmalloc.c.'>request2size</a>(<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>);
<a name='L3789'>      <b>if</b> (<a href='../S/2317.html#L1697' title='Defined at 1697 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_mmapped</a>(oldp))
<a name='L3790'>        newp = <a href='../S/2317.html#L3180' title='Defined at 3180 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mmap_resize</a>(m, oldp, nb);
<a name='L3791'>      <b>else</b> <b>if</b> (oldsize &gt;= nb) <font color='red'>{</font> <i><font color='green'>/* already big enough */</font></i>
<a name='L3792'>        <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> rsize = oldsize - nb;
<a name='L3793'>        newp = oldp;
<a name='L3794'>        <b>if</b> (rsize &gt;= <a href='../S/2317.html#L1627' title='Defined at 1627 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MIN_CHUNK_SIZE</a>) <font color='red'>{</font>
<a name='L3795'>          <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> remainder = <a href='../S/2317.html#L1675' title='Defined at 1675 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk_plus_offset</a>(newp, nb);
<a name='L3796'>          <a href='../D/11078.html' title='Multiple defined in 2 places.'>set_inuse</a>(m, newp, nb);
<a name='L3797'>          <a href='../D/11078.html' title='Multiple defined in 2 places.'>set_inuse</a>(m, remainder, rsize);
<a name='L3798'>          extra = <a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(remainder);
<a name='L3799'>        <font color='red'>}</font>
<a name='L3800'>      <font color='red'>}</font>
<a name='L3801'>      <b>else</b> <b>if</b> (next == m-&gt;top &amp;&amp; oldsize + m-&gt;topsize &gt; nb) <font color='red'>{</font>
<a name='L3802'>        <i><font color='green'>/* Expand into top */</font></i>
<a name='L3803'>        <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> newsize = oldsize + m-&gt;topsize;
<a name='L3804'>        <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> newtopsize = newsize - nb;
<a name='L3805'>        <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> newtop = <a href='../S/2317.html#L1675' title='Defined at 1675 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk_plus_offset</a>(oldp, nb);
<a name='L3806'>        <a href='../D/11078.html' title='Multiple defined in 2 places.'>set_inuse</a>(m, oldp, nb);
<a name='L3807'>        newtop-&gt;head = newtopsize |<a href='../S/2317.html#L1659' title='Defined at 1659 in Modules/_ctypes/libffi/src/dlmalloc.c.'>PINUSE_BIT</a>;
<a name='L3808'>        m-&gt;top = newtop;
<a name='L3809'>        m-&gt;topsize = newtopsize;
<a name='L3810'>        newp = oldp;
<a name='L3811'>      <font color='red'>}</font>
<a name='L3812'>    <font color='red'>}</font>
<a name='L3813'>    <b>else</b> <font color='red'>{</font>
<a name='L3814'>      <a href='../D/5379.html' title='Multiple defined in 2 places.'>USAGE_ERROR_ACTION</a>(m, oldmem);
<a name='L3815'>      <a href='../D/2515.html' title='Multiple defined in 2 places.'>POSTACTION</a>(m);
<a name='L3816'>      <b>return</b> 0;
<a name='L3817'>    <font color='red'>}</font>
<a name='L3818'>
<a name='L3819'>    <a href='../D/2515.html' title='Multiple defined in 2 places.'>POSTACTION</a>(m);
<a name='L3820'>
<a name='L3821'>    <b>if</b> (newp != 0) <font color='red'>{</font>
<a name='L3822'>      <b>if</b> (extra != 0) <font color='red'>{</font>
<a name='L3823'>        <a href='../D/9258.html' title='Multiple defined in 3 places.'>internal_free</a>(m, extra);
<a name='L3824'>      <font color='red'>}</font>
<a name='L3825'>      <a href='../D/7405.html' title='Multiple defined in 2 places.'>check_inuse_chunk</a>(m, newp);
<a name='L3826'>      <b>return</b> <a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(newp);
<a name='L3827'>    <font color='red'>}</font>
<a name='L3828'>    <b>else</b> <font color='red'>{</font>
<a name='L3829'>      <b>void</b>* newmem = <a href='../D/9260.html' title='Multiple defined in 3 places.'>internal_malloc</a>(m, <a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>);
<a name='L3830'>      <b>if</b> (newmem != 0) <font color='red'>{</font>
<a name='L3831'>        <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> oc = oldsize - <a href='../S/2317.html#L1701' title='Defined at 1701 in Modules/_ctypes/libffi/src/dlmalloc.c.'>overhead_for</a>(oldp);
<a name='L3832'>        <a href='../D/9803.html' title='Multiple defined in 4 places.'>memcpy</a>(newmem, oldmem, (oc &lt; <a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>)? oc : <a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>);
<a name='L3833'>        <a href='../D/9258.html' title='Multiple defined in 3 places.'>internal_free</a>(m, oldmem);
<a name='L3834'>      <font color='red'>}</font>
<a name='L3835'>      <b>return</b> newmem;
<a name='L3836'>    <font color='red'>}</font>
<a name='L3837'>  <font color='red'>}</font>
<a name='L3838'>  <b>return</b> 0;
<a name='L3839'><font color='red'>}</font>
<a name='L3840'>
<a name='L3841'><i><font color='green'>/* --------------------------- memalign support -------------------------- */</font></i>
<a name='L3842'>
<a name='L3843'><b>static</b> <b>void</b>* <a href='../R/8452.html' title='Multiple refered from 2 places.'>internal_memalign</a>(mstate m, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> alignment, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> bytes) <font color='red'>{</font>
<a name='L3844'>  <b>if</b> (alignment &lt;= <a href='../S/2317.html#L488' title='Defined at 488 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MALLOC_ALIGNMENT</a>)    <i><font color='green'>/* Can just use malloc */</font></i>
<a name='L3845'>    <b>return</b> <a href='../D/9260.html' title='Multiple defined in 3 places.'>internal_malloc</a>(m, <a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>);
<a name='L3846'>  <b>if</b> (alignment &lt;  <a href='../S/2317.html#L1627' title='Defined at 1627 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MIN_CHUNK_SIZE</a>) <i><font color='green'>/* must be at least a minimum chunk size */</font></i>
<a name='L3847'>    alignment = <a href='../S/2317.html#L1627' title='Defined at 1627 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MIN_CHUNK_SIZE</a>;
<a name='L3848'>  <b>if</b> ((alignment &amp; (alignment-<a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a>)) != 0) <font color='red'>{</font><i><font color='green'>/* Ensure a power of 2 */</font></i>
<a name='L3849'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> a = <a href='../S/2317.html#L488' title='Defined at 488 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MALLOC_ALIGNMENT</a> &lt;&lt; 1;
<a name='L3850'>    <b>while</b> (a &lt; alignment) a &lt;&lt;= 1;
<a name='L3851'>    alignment = a;
<a name='L3852'>  <font color='red'>}</font>
<a name='L3853'>  
<a name='L3854'>  <b>if</b> (<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> &gt;= <a href='../S/2317.html#L1637' title='Defined at 1637 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MAX_REQUEST</a> - alignment) <font color='red'>{</font>
<a name='L3855'>    <b>if</b> (m != 0)  <font color='red'>{</font> <i><font color='green'>/* Test isn't needed but avoids compiler warning */</font></i>
<a name='L3856'>      <a href='../D/2013.html' title='Multiple defined in 2 places.'>MALLOC_FAILURE_ACTION</a>;
<a name='L3857'>    <font color='red'>}</font>
<a name='L3858'>  <font color='red'>}</font>
<a name='L3859'>  <b>else</b> <font color='red'>{</font>
<a name='L3860'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> nb = <a href='../S/2317.html#L1645' title='Defined at 1645 in Modules/_ctypes/libffi/src/dlmalloc.c.'>request2size</a>(<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>);
<a name='L3861'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> req = nb + alignment + <a href='../S/2317.html#L1627' title='Defined at 1627 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MIN_CHUNK_SIZE</a> - <a href='../D/545.html' title='Multiple defined in 2 places.'>CHUNK_OVERHEAD</a>;
<a name='L3862'>    <b>char</b>* mem = (<b>char</b>*)<a href='../D/9260.html' title='Multiple defined in 3 places.'>internal_malloc</a>(m, req);
<a name='L3863'>    <b>if</b> (mem != 0) <font color='red'>{</font>
<a name='L3864'>      <b>void</b>* leader = 0;
<a name='L3865'>      <b>void</b>* <a href='../S/529.html#L69' title='Defined at 69 in Include/graminit.h.'>trailer</a> = 0;
<a name='L3866'>      <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> p = <a href='../S/2317.html#L1632' title='Defined at 1632 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mem2chunk</a>(mem);
<a name='L3867'>
<a name='L3868'>      <b>if</b> (<a href='../D/2519.html' title='Multiple defined in 2 places.'>PREACTION</a>(m)) <b>return</b> 0;
<a name='L3869'>      <b>if</b> ((((<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)(mem)) % alignment) != 0) <font color='red'>{</font> <i><font color='green'>/* misaligned */</font></i>
<a name='L3870'>        <i><font color='green'>/*</font></i>
<a name='L3871'><i><font color='green'>          Find an aligned spot inside chunk.  Since we need to give</font></i>
<a name='L3872'><i><font color='green'>          back leading space in a chunk of at least MIN_CHUNK_SIZE, if</font></i>
<a name='L3873'><i><font color='green'>          the first calculation places us at a spot with less than</font></i>
<a name='L3874'><i><font color='green'>          MIN_CHUNK_SIZE leader, we can move to the next aligned spot.</font></i>
<a name='L3875'><i><font color='green'>          We've allocated enough total room so that this is always</font></i>
<a name='L3876'><i><font color='green'>          possible.</font></i>
<a name='L3877'><i><font color='green'>        */</font></i>
<a name='L3878'>        <b>char</b>* br = (<b>char</b>*)<a href='../S/2317.html#L1632' title='Defined at 1632 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mem2chunk</a>((<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)(((<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)(mem +
<a name='L3879'>                                                       alignment -
<a name='L3880'>                                                       <a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a>)) &amp;
<a name='L3881'>                                             -alignment));
<a name='L3882'>        <b>char</b>* pos = ((<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)(br - (<b>char</b>*)(p)) &gt;= <a href='../S/2317.html#L1627' title='Defined at 1627 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MIN_CHUNK_SIZE</a>)?
<a name='L3883'>          br : br+alignment;
<a name='L3884'>        <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> newp = (<a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a>)pos;
<a name='L3885'>        <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> leadsize = pos - (<b>char</b>*)(p);
<a name='L3886'>        <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> newsize = <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(p) - leadsize;
<a name='L3887'>
<a name='L3888'>        <b>if</b> (<a href='../S/2317.html#L1697' title='Defined at 1697 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_mmapped</a>(p)) <font color='red'>{</font> <i><font color='green'>/* For mmapped chunks, just adjust offset */</font></i>
<a name='L3889'>          newp-&gt;prev_foot = p-&gt;prev_foot + leadsize;
<a name='L3890'>          newp-&gt;head = (newsize|<a href='../S/2317.html#L1660' title='Defined at 1660 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CINUSE_BIT</a>);
<a name='L3891'>        <font color='red'>}</font>
<a name='L3892'>        <b>else</b> <font color='red'>{</font> <i><font color='green'>/* Otherwise, give back leader, use the rest */</font></i>
<a name='L3893'>          <a href='../D/11078.html' title='Multiple defined in 2 places.'>set_inuse</a>(m, newp, newsize);
<a name='L3894'>          <a href='../D/11078.html' title='Multiple defined in 2 places.'>set_inuse</a>(m, p, leadsize);
<a name='L3895'>          leader = <a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(p);
<a name='L3896'>        <font color='red'>}</font>
<a name='L3897'>        p = newp;
<a name='L3898'>      <font color='red'>}</font>
<a name='L3899'>
<a name='L3900'>      <i><font color='green'>/* Give back spare room at the end */</font></i>
<a name='L3901'>      <b>if</b> (!<a href='../S/2317.html#L1697' title='Defined at 1697 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_mmapped</a>(p)) <font color='red'>{</font>
<a name='L3902'>        <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> size = <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(p);
<a name='L3903'>        <b>if</b> (size &gt; nb + <a href='../S/2317.html#L1627' title='Defined at 1627 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MIN_CHUNK_SIZE</a>) <font color='red'>{</font>
<a name='L3904'>          <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> remainder_size = size - nb;
<a name='L3905'>          <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> remainder = <a href='../S/2317.html#L1675' title='Defined at 1675 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk_plus_offset</a>(p, nb);
<a name='L3906'>          <a href='../D/11078.html' title='Multiple defined in 2 places.'>set_inuse</a>(m, p, nb);
<a name='L3907'>          <a href='../D/11078.html' title='Multiple defined in 2 places.'>set_inuse</a>(m, remainder, remainder_size);
<a name='L3908'>          <a href='../S/529.html#L69' title='Defined at 69 in Include/graminit.h.'>trailer</a> = <a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(remainder);
<a name='L3909'>        <font color='red'>}</font>
<a name='L3910'>      <font color='red'>}</font>
<a name='L3911'>
<a name='L3912'>      <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a> (<a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(p) &gt;= nb);
<a name='L3913'>      <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>((((<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)(<a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(p))) % alignment) == 0);
<a name='L3914'>      <a href='../D/7405.html' title='Multiple defined in 2 places.'>check_inuse_chunk</a>(m, p);
<a name='L3915'>      <a href='../D/2515.html' title='Multiple defined in 2 places.'>POSTACTION</a>(m);
<a name='L3916'>      <b>if</b> (leader != 0) <font color='red'>{</font>
<a name='L3917'>        <a href='../D/9258.html' title='Multiple defined in 3 places.'>internal_free</a>(m, leader);
<a name='L3918'>      <font color='red'>}</font>
<a name='L3919'>      <b>if</b> (<a href='../S/529.html#L69' title='Defined at 69 in Include/graminit.h.'>trailer</a> != 0) <font color='red'>{</font>
<a name='L3920'>        <a href='../D/9258.html' title='Multiple defined in 3 places.'>internal_free</a>(m, <a href='../S/529.html#L69' title='Defined at 69 in Include/graminit.h.'>trailer</a>);
<a name='L3921'>      <font color='red'>}</font>
<a name='L3922'>      <b>return</b> <a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(p);
<a name='L3923'>    <font color='red'>}</font>
<a name='L3924'>  <font color='red'>}</font>
<a name='L3925'>  <b>return</b> 0;
<a name='L3926'><font color='red'>}</font>
<a name='L3927'>
<a name='L3928'><i><font color='green'>/* ------------------------ comalloc/coalloc support --------------------- */</font></i>
<a name='L3929'>
<a name='L3930'><b>static</b> <b>void</b>** <a href='../R/8292.html' title='Multiple refered from 4 places.'>ialloc</a>(mstate m,
<a name='L3931'>                     <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> n_elements,
<a name='L3932'>                     <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>* sizes,
<a name='L3933'>                     <b>int</b> opts,
<a name='L3934'>                     <b>void</b>* chunks[]) <font color='red'>{</font>
<a name='L3935'>  <i><font color='green'>/*</font></i>
<a name='L3936'><i><font color='green'>    This provides common support for independent_X routines, handling</font></i>
<a name='L3937'><i><font color='green'>    all of the combinations that can result.</font></i>
<a name='L3938'><i><font color='green'></font></i>
<a name='L3939'><i><font color='green'>    The opts arg has:</font></i>
<a name='L3940'><i><font color='green'>    bit 0 set if all elements are same size (using sizes[0])</font></i>
<a name='L3941'><i><font color='green'>    bit 1 set if elements should be zeroed</font></i>
<a name='L3942'><i><font color='green'>  */</font></i>
<a name='L3943'>
<a name='L3944'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>    element_size;   <i><font color='green'>/* chunksize of each element, if all same */</font></i>
<a name='L3945'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>    contents_size;  <i><font color='green'>/* total size of elements */</font></i>
<a name='L3946'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>    array_size;     <i><font color='green'>/* request size of pointer array */</font></i>
<a name='L3947'>  <b>void</b>*     mem;            <i><font color='green'>/* malloced aggregate space */</font></i>
<a name='L3948'>  <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> p;              <i><font color='green'>/* corresponding chunk */</font></i>
<a name='L3949'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>    remainder_size; <i><font color='green'>/* remaining bytes while splitting */</font></i>
<a name='L3950'>  <b>void</b>**    marray;         <i><font color='green'>/* either "chunks" or malloced ptr array */</font></i>
<a name='L3951'>  <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> array_chunk;    <i><font color='green'>/* chunk for malloced ptr array */</font></i>
<a name='L3952'>  <a href='../S/2317.html#L1609' title='Defined at 1609 in Modules/_ctypes/libffi/src/dlmalloc.c.'>flag_t</a>    was_enabled;    <i><font color='green'>/* to disable mmap */</font></i>
<a name='L3953'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>    size;
<a name='L3954'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>    i;
<a name='L3955'>
<a name='L3956'>  <i><font color='green'>/* compute array length, if needed */</font></i>
<a name='L3957'>  <b>if</b> (chunks != 0) <font color='red'>{</font>
<a name='L3958'>    <b>if</b> (n_elements == 0)
<a name='L3959'>      <b>return</b> chunks; <i><font color='green'>/* nothing to do */</font></i>
<a name='L3960'>    marray = chunks;
<a name='L3961'>    array_size = 0;
<a name='L3962'>  <font color='red'>}</font>
<a name='L3963'>  <b>else</b> <font color='red'>{</font>
<a name='L3964'>    <i><font color='green'>/* if empty req, must still return chunk representing empty array */</font></i>
<a name='L3965'>    <b>if</b> (n_elements == 0)
<a name='L3966'>      <b>return</b> (<b>void</b>**)<a href='../D/9260.html' title='Multiple defined in 3 places.'>internal_malloc</a>(m, 0);
<a name='L3967'>    marray = 0;
<a name='L3968'>    array_size = <a href='../S/2317.html#L1645' title='Defined at 1645 in Modules/_ctypes/libffi/src/dlmalloc.c.'>request2size</a>(n_elements * (<b>sizeof</b>(<b>void</b>*)));
<a name='L3969'>  <font color='red'>}</font>
<a name='L3970'>
<a name='L3971'>  <i><font color='green'>/* compute total element size */</font></i>
<a name='L3972'>  <b>if</b> (opts &amp; 0x1) <font color='red'>{</font> <i><font color='green'>/* all-same-size */</font></i>
<a name='L3973'>    element_size = <a href='../S/2317.html#L1645' title='Defined at 1645 in Modules/_ctypes/libffi/src/dlmalloc.c.'>request2size</a>(*sizes);
<a name='L3974'>    contents_size = n_elements * element_size;
<a name='L3975'>  <font color='red'>}</font>
<a name='L3976'>  <b>else</b> <font color='red'>{</font> <i><font color='green'>/* add up all the sizes */</font></i>
<a name='L3977'>    element_size = 0;
<a name='L3978'>    contents_size = 0;
<a name='L3979'>    <b>for</b> (i = 0; i != n_elements; ++i)
<a name='L3980'>      contents_size += <a href='../S/2317.html#L1645' title='Defined at 1645 in Modules/_ctypes/libffi/src/dlmalloc.c.'>request2size</a>(sizes[i]);
<a name='L3981'>  <font color='red'>}</font>
<a name='L3982'>
<a name='L3983'>  size = contents_size + array_size;
<a name='L3984'>
<a name='L3985'>  <i><font color='green'>/*</font></i>
<a name='L3986'><i><font color='green'>     Allocate the aggregate chunk.  First disable direct-mmapping so</font></i>
<a name='L3987'><i><font color='green'>     malloc won't use it, since we would not be able to later</font></i>
<a name='L3988'><i><font color='green'>     free/realloc space internal to a segregated mmap region.</font></i>
<a name='L3989'><i><font color='green'>  */</font></i>
<a name='L3990'>  was_enabled = <a href='../S/2317.html#L2068' title='Defined at 2068 in Modules/_ctypes/libffi/src/dlmalloc.c.'>use_mmap</a>(m);
<a name='L3991'>  <a href='../S/2317.html#L2070' title='Defined at 2070 in Modules/_ctypes/libffi/src/dlmalloc.c.'>disable_mmap</a>(m);
<a name='L3992'>  mem = <a href='../D/9260.html' title='Multiple defined in 3 places.'>internal_malloc</a>(m, size - <a href='../D/545.html' title='Multiple defined in 2 places.'>CHUNK_OVERHEAD</a>);
<a name='L3993'>  <b>if</b> (was_enabled)
<a name='L3994'>    <a href='../S/2317.html#L2069' title='Defined at 2069 in Modules/_ctypes/libffi/src/dlmalloc.c.'>enable_mmap</a>(m);
<a name='L3995'>  <b>if</b> (mem == 0)
<a name='L3996'>    <b>return</b> 0;
<a name='L3997'>
<a name='L3998'>  <b>if</b> (<a href='../D/2519.html' title='Multiple defined in 2 places.'>PREACTION</a>(m)) <b>return</b> 0;
<a name='L3999'>  p = <a href='../S/2317.html#L1632' title='Defined at 1632 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mem2chunk</a>(mem);
<a name='L4000'>  remainder_size = <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(p);
<a name='L4001'>
<a name='L4002'>  <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(!<a href='../S/2317.html#L1697' title='Defined at 1697 in Modules/_ctypes/libffi/src/dlmalloc.c.'>is_mmapped</a>(p));
<a name='L4003'>
<a name='L4004'>  <b>if</b> (opts &amp; 0x2) <font color='red'>{</font>       <i><font color='green'>/* optionally clear the elements */</font></i>
<a name='L4005'>    memset((<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>*)mem, 0, remainder_size - <a href='../S/2317.html#L1243' title='Defined at 1243 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_SIZE</a> - array_size);
<a name='L4006'>  <font color='red'>}</font>
<a name='L4007'>
<a name='L4008'>  <i><font color='green'>/* If not provided, allocate the pointer array as final part of chunk */</font></i>
<a name='L4009'>  <b>if</b> (marray == 0) <font color='red'>{</font>
<a name='L4010'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>  array_chunk_size;
<a name='L4011'>    array_chunk = <a href='../S/2317.html#L1675' title='Defined at 1675 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk_plus_offset</a>(p, contents_size);
<a name='L4012'>    array_chunk_size = remainder_size - contents_size;
<a name='L4013'>    marray = (<b>void</b>**) (<a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(array_chunk));
<a name='L4014'>    <a href='../D/11108.html' title='Multiple defined in 2 places.'>set_size_and_pinuse_of_inuse_chunk</a>(m, array_chunk, array_chunk_size);
<a name='L4015'>    remainder_size = contents_size;
<a name='L4016'>  <font color='red'>}</font>
<a name='L4017'>
<a name='L4018'>  <i><font color='green'>/* split out elements */</font></i>
<a name='L4019'>  <b>for</b> (i = 0; ; ++i) <font color='red'>{</font>
<a name='L4020'>    marray[i] = <a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(p);
<a name='L4021'>    <b>if</b> (i != n_elements-1) <font color='red'>{</font>
<a name='L4022'>      <b>if</b> (element_size != 0)
<a name='L4023'>        size = element_size;
<a name='L4024'>      <b>else</b>
<a name='L4025'>        size = <a href='../S/2317.html#L1645' title='Defined at 1645 in Modules/_ctypes/libffi/src/dlmalloc.c.'>request2size</a>(sizes[i]);
<a name='L4026'>      remainder_size -= size;
<a name='L4027'>      <a href='../D/11108.html' title='Multiple defined in 2 places.'>set_size_and_pinuse_of_inuse_chunk</a>(m, p, size);
<a name='L4028'>      p = <a href='../S/2317.html#L1675' title='Defined at 1675 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk_plus_offset</a>(p, size);
<a name='L4029'>    <font color='red'>}</font>
<a name='L4030'>    <b>else</b> <font color='red'>{</font> <i><font color='green'>/* the final element absorbs any overallocation slop */</font></i>
<a name='L4031'>      <a href='../D/11108.html' title='Multiple defined in 2 places.'>set_size_and_pinuse_of_inuse_chunk</a>(m, p, remainder_size);
<a name='L4032'>      <b>break</b>;
<a name='L4033'>    <font color='red'>}</font>
<a name='L4034'>  <font color='red'>}</font>
<a name='L4035'>
<a name='L4036'><font color='darkred'>#if</font> <a href='../D/728.html' title='Multiple defined in 2 places.'>DEBUG</a>
<a name='L4037'>  <b>if</b> (marray != chunks) <font color='red'>{</font>
<a name='L4038'>    <i><font color='green'>/* final element must have exactly exhausted chunk */</font></i>
<a name='L4039'>    <b>if</b> (element_size != 0) <font color='red'>{</font>
<a name='L4040'>      <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(remainder_size == element_size);
<a name='L4041'>    <font color='red'>}</font>
<a name='L4042'>    <b>else</b> <font color='red'>{</font>
<a name='L4043'>      <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(remainder_size == <a href='../S/2317.html#L1645' title='Defined at 1645 in Modules/_ctypes/libffi/src/dlmalloc.c.'>request2size</a>(sizes[i]));
<a name='L4044'>    <font color='red'>}</font>
<a name='L4045'>    <a href='../D/7405.html' title='Multiple defined in 2 places.'>check_inuse_chunk</a>(m, <a href='../S/2317.html#L1632' title='Defined at 1632 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mem2chunk</a>(marray));
<a name='L4046'>  <font color='red'>}</font>
<a name='L4047'>  <b>for</b> (i = 0; i != n_elements; ++i)
<a name='L4048'>    <a href='../D/7405.html' title='Multiple defined in 2 places.'>check_inuse_chunk</a>(m, <a href='../S/2317.html#L1632' title='Defined at 1632 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mem2chunk</a>(marray[i]));
<a name='L4049'>
<a name='L4050'><font color='darkred'>#endif</font> <i><font color='green'>/* DEBUG */</font></i>
<a name='L4051'>
<a name='L4052'>  <a href='../D/2515.html' title='Multiple defined in 2 places.'>POSTACTION</a>(m);
<a name='L4053'>  <b>return</b> marray;
<a name='L4054'><font color='red'>}</font>
<a name='L4055'>
<a name='L4056'>
<a name='L4057'><i><font color='green'>/* -------------------------- public routines ---------------------------- */</font></i>
<a name='L4058'>
<a name='L4059'><font color='darkred'>#if</font> !<a href='../S/2317.html#L478' title='Defined at 478 in Modules/_ctypes/libffi/src/dlmalloc.c.'>ONLY_MSPACES</a>
<a name='L4060'>
<a name='L4061'><b>void</b>* <a href='../R/7403.html' title='Multiple refered from 8 places.'>dlmalloc</a>(<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> bytes) <font color='red'>{</font>
<a name='L4062'>  <i><font color='green'>/*</font></i>
<a name='L4063'><i><font color='green'>     Basic algorithm:</font></i>
<a name='L4064'><i><font color='green'>     If a small request (&lt; 256 bytes minus per-chunk overhead):</font></i>
<a name='L4065'><i><font color='green'>       1. If one exists, use a remainderless chunk in associated smallbin.</font></i>
<a name='L4066'><i><font color='green'>          (Remainderless means that there are too few excess bytes to</font></i>
<a name='L4067'><i><font color='green'>          represent as a chunk.)</font></i>
<a name='L4068'><i><font color='green'>       2. If it is big enough, use the dv chunk, which is normally the</font></i>
<a name='L4069'><i><font color='green'>          chunk adjacent to the one used for the most recent small request.</font></i>
<a name='L4070'><i><font color='green'>       3. If one exists, split the smallest available chunk in a bin,</font></i>
<a name='L4071'><i><font color='green'>          saving remainder in dv.</font></i>
<a name='L4072'><i><font color='green'>       4. If it is big enough, use the top chunk.</font></i>
<a name='L4073'><i><font color='green'>       5. If available, get memory from system and use it</font></i>
<a name='L4074'><i><font color='green'>     Otherwise, for a large request:</font></i>
<a name='L4075'><i><font color='green'>       1. Find the smallest available binned chunk that fits, and use it</font></i>
<a name='L4076'><i><font color='green'>          if it is better fitting than dv chunk, splitting if necessary.</font></i>
<a name='L4077'><i><font color='green'>       2. If better fitting than any binned chunk, use the dv chunk.</font></i>
<a name='L4078'><i><font color='green'>       3. If it is big enough, use the top chunk.</font></i>
<a name='L4079'><i><font color='green'>       4. If request size &gt;= mmap threshold, try to directly mmap this chunk.</font></i>
<a name='L4080'><i><font color='green'>       5. If available, get memory from system and use it</font></i>
<a name='L4081'><i><font color='green'></font></i>
<a name='L4082'><i><font color='green'>     The ugly goto's here ensure that postaction occurs along all paths.</font></i>
<a name='L4083'><i><font color='green'>  */</font></i>
<a name='L4084'>
<a name='L4085'>  <b>if</b> (!<a href='../D/2519.html' title='Multiple defined in 2 places.'>PREACTION</a>(<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>)) <font color='red'>{</font>
<a name='L4086'>    <b>void</b>* mem;
<a name='L4087'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> nb;
<a name='L4088'>    <b>if</b> (<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> &lt;= <a href='../S/2317.html#L2010' title='Defined at 2010 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MAX_SMALL_REQUEST</a>) <font color='red'>{</font>
<a name='L4089'>      <a href='../S/2317.html#L1607' title='Defined at 1607 in Modules/_ctypes/libffi/src/dlmalloc.c.'>bindex_t</a> idx;
<a name='L4090'>      <a href='../S/2317.html#L1608' title='Defined at 1608 in Modules/_ctypes/libffi/src/dlmalloc.c.'>binmap_t</a> smallbits;
<a name='L4091'>      nb = (<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> &lt; <a href='../S/2317.html#L1638' title='Defined at 1638 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MIN_REQUEST</a>)? <a href='../S/2317.html#L1627' title='Defined at 1627 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MIN_CHUNK_SIZE</a> : <a href='../S/2317.html#L1641' title='Defined at 1641 in Modules/_ctypes/libffi/src/dlmalloc.c.'>pad_request</a>(<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>);
<a name='L4092'>      idx = <a href='../S/2317.html#L2228' title='Defined at 2228 in Modules/_ctypes/libffi/src/dlmalloc.c.'>small_index</a>(nb);
<a name='L4093'>      smallbits = <a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>-&gt;smallmap &gt;&gt; idx;
<a name='L4094'>
<a name='L4095'>      <b>if</b> ((smallbits &amp; 0x3U) != 0) <font color='red'>{</font> <i><font color='green'>/* Remainderless fit to a smallbin. */</font></i>
<a name='L4096'>        <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a>, p;
<a name='L4097'>        idx += ~smallbits &amp; 1;       <i><font color='green'>/* Uses next bin if idx empty */</font></i>
<a name='L4098'>        <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a> = <a href='../S/2317.html#L2233' title='Defined at 2233 in Modules/_ctypes/libffi/src/dlmalloc.c.'>smallbin_at</a>(<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>, idx);
<a name='L4099'>        p = <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a>-&gt;fd;
<a name='L4100'>        <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(p) == <a href='../S/2317.html#L2229' title='Defined at 2229 in Modules/_ctypes/libffi/src/dlmalloc.c.'>small_index2size</a>(idx));
<a name='L4101'>        <a href='../S/2317.html#L2941' title='Defined at 2941 in Modules/_ctypes/libffi/src/dlmalloc.c.'>unlink_first_small_chunk</a>(<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>, <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a>, p, idx);
<a name='L4102'>        <a href='../D/11079.html' title='Multiple defined in 2 places.'>set_inuse_and_pinuse</a>(<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>, p, <a href='../S/2317.html#L2229' title='Defined at 2229 in Modules/_ctypes/libffi/src/dlmalloc.c.'>small_index2size</a>(idx));
<a name='L4103'>        mem = <a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(p);
<a name='L4104'>        <a href='../D/7408.html' title='Multiple defined in 2 places.'>check_malloced_chunk</a>(<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>, mem, nb);
<a name='L4105'>        <b>goto</b> postaction;
<a name='L4106'>      <font color='red'>}</font>
<a name='L4107'>
<a name='L4108'>      <b>else</b> <b>if</b> (nb &gt; <a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>-&gt;dvsize) <font color='red'>{</font>
<a name='L4109'>        <b>if</b> (smallbits != 0) <font color='red'>{</font> <i><font color='green'>/* Use chunk in next nonempty smallbin */</font></i>
<a name='L4110'>          <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a>, p, r;
<a name='L4111'>          <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> rsize;
<a name='L4112'>          <a href='../S/2317.html#L1607' title='Defined at 1607 in Modules/_ctypes/libffi/src/dlmalloc.c.'>bindex_t</a> i;
<a name='L4113'>          <a href='../S/2317.html#L1608' title='Defined at 1608 in Modules/_ctypes/libffi/src/dlmalloc.c.'>binmap_t</a> leftbits = (smallbits &lt;&lt; idx) &amp; <a href='../S/2317.html#L2333' title='Defined at 2333 in Modules/_ctypes/libffi/src/dlmalloc.c.'>left_bits</a>(<a href='../S/2317.html#L2289' title='Defined at 2289 in Modules/_ctypes/libffi/src/dlmalloc.c.'>idx2bit</a>(idx));
<a name='L4114'>          <a href='../S/2317.html#L1608' title='Defined at 1608 in Modules/_ctypes/libffi/src/dlmalloc.c.'>binmap_t</a> leastbit = <a href='../S/2317.html#L2330' title='Defined at 2330 in Modules/_ctypes/libffi/src/dlmalloc.c.'>least_bit</a>(leftbits);
<a name='L4115'>          <a href='../D/7728.html' title='Multiple defined in 3 places.'>compute_bit2idx</a>(leastbit, i);
<a name='L4116'>          <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a> = <a href='../S/2317.html#L2233' title='Defined at 2233 in Modules/_ctypes/libffi/src/dlmalloc.c.'>smallbin_at</a>(<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>, i);
<a name='L4117'>          p = <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a>-&gt;fd;
<a name='L4118'>          <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(p) == <a href='../S/2317.html#L2229' title='Defined at 2229 in Modules/_ctypes/libffi/src/dlmalloc.c.'>small_index2size</a>(i));
<a name='L4119'>          <a href='../S/2317.html#L2941' title='Defined at 2941 in Modules/_ctypes/libffi/src/dlmalloc.c.'>unlink_first_small_chunk</a>(<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>, <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a>, p, i);
<a name='L4120'>          rsize = <a href='../S/2317.html#L2229' title='Defined at 2229 in Modules/_ctypes/libffi/src/dlmalloc.c.'>small_index2size</a>(i) - nb;
<a name='L4121'>          <i><font color='green'>/* Fit here cannot be remainderless if 4byte sizes */</font></i>
<a name='L4122'>          <b>if</b> (<a href='../S/2317.html#L1243' title='Defined at 1243 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_SIZE</a> != 4 &amp;&amp; rsize &lt; <a href='../S/2317.html#L1627' title='Defined at 1627 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MIN_CHUNK_SIZE</a>)
<a name='L4123'>            <a href='../D/11079.html' title='Multiple defined in 2 places.'>set_inuse_and_pinuse</a>(<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>, p, <a href='../S/2317.html#L2229' title='Defined at 2229 in Modules/_ctypes/libffi/src/dlmalloc.c.'>small_index2size</a>(i));
<a name='L4124'>          <b>else</b> <font color='red'>{</font>
<a name='L4125'>            <a href='../D/11108.html' title='Multiple defined in 2 places.'>set_size_and_pinuse_of_inuse_chunk</a>(<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>, p, nb);
<a name='L4126'>            r = <a href='../S/2317.html#L1675' title='Defined at 1675 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk_plus_offset</a>(p, nb);
<a name='L4127'>            <a href='../S/2317.html#L1690' title='Defined at 1690 in Modules/_ctypes/libffi/src/dlmalloc.c.'>set_size_and_pinuse_of_free_chunk</a>(r, rsize);
<a name='L4128'>            <a href='../S/2317.html#L2959' title='Defined at 2959 in Modules/_ctypes/libffi/src/dlmalloc.c.'>replace_dv</a>(<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>, r, rsize);
<a name='L4129'>          <font color='red'>}</font>
<a name='L4130'>          mem = <a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(p);
<a name='L4131'>          <a href='../D/7408.html' title='Multiple defined in 2 places.'>check_malloced_chunk</a>(<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>, mem, nb);
<a name='L4132'>          <b>goto</b> postaction;
<a name='L4133'>        <font color='red'>}</font>
<a name='L4134'>
<a name='L4135'>        <b>else</b> <b>if</b> (<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>-&gt;treemap != 0 &amp;&amp; (mem = <a href='../S/2317.html#L3732' title='Defined at 3732 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tmalloc_small</a>(<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>, nb)) != 0) <font color='red'>{</font>
<a name='L4136'>          <a href='../D/7408.html' title='Multiple defined in 2 places.'>check_malloced_chunk</a>(<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>, mem, nb);
<a name='L4137'>          <b>goto</b> postaction;
<a name='L4138'>        <font color='red'>}</font>
<a name='L4139'>      <font color='red'>}</font>
<a name='L4140'>    <font color='red'>}</font>
<a name='L4141'>    <b>else</b> <b>if</b> (<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> &gt;= <a href='../S/2317.html#L1637' title='Defined at 1637 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MAX_REQUEST</a>)
<a name='L4142'>      nb = <a href='../S/2317.html#L475' title='Defined at 475 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MAX_SIZE_T</a>; <i><font color='green'>/* Too big to allocate. Force failure (in sys alloc) */</font></i>
<a name='L4143'>    <b>else</b> <font color='red'>{</font>
<a name='L4144'>      nb = <a href='../S/2317.html#L1641' title='Defined at 1641 in Modules/_ctypes/libffi/src/dlmalloc.c.'>pad_request</a>(<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>);
<a name='L4145'>      <b>if</b> (<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>-&gt;treemap != 0 &amp;&amp; (mem = <a href='../S/2317.html#L3659' title='Defined at 3659 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tmalloc_large</a>(<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>, nb)) != 0) <font color='red'>{</font>
<a name='L4146'>        <a href='../D/7408.html' title='Multiple defined in 2 places.'>check_malloced_chunk</a>(<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>, mem, nb);
<a name='L4147'>        <b>goto</b> postaction;
<a name='L4148'>      <font color='red'>}</font>
<a name='L4149'>    <font color='red'>}</font>
<a name='L4150'>
<a name='L4151'>    <b>if</b> (nb &lt;= <a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>-&gt;dvsize) <font color='red'>{</font>
<a name='L4152'>      <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> rsize = <a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>-&gt;dvsize - nb;
<a name='L4153'>      <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> p = <a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>-&gt;dv;
<a name='L4154'>      <b>if</b> (rsize &gt;= <a href='../S/2317.html#L1627' title='Defined at 1627 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MIN_CHUNK_SIZE</a>) <font color='red'>{</font> <i><font color='green'>/* split dv */</font></i>
<a name='L4155'>        <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> r = <a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>-&gt;dv = <a href='../S/2317.html#L1675' title='Defined at 1675 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk_plus_offset</a>(p, nb);
<a name='L4156'>        <a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>-&gt;dvsize = rsize;
<a name='L4157'>        <a href='../S/2317.html#L1690' title='Defined at 1690 in Modules/_ctypes/libffi/src/dlmalloc.c.'>set_size_and_pinuse_of_free_chunk</a>(r, rsize);
<a name='L4158'>        <a href='../D/11108.html' title='Multiple defined in 2 places.'>set_size_and_pinuse_of_inuse_chunk</a>(<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>, p, nb);
<a name='L4159'>      <font color='red'>}</font>
<a name='L4160'>      <b>else</b> <font color='red'>{</font> <i><font color='green'>/* exhaust dv */</font></i>
<a name='L4161'>        <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> dvs = <a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>-&gt;dvsize;
<a name='L4162'>        <a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>-&gt;dvsize = 0;
<a name='L4163'>        <a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>-&gt;dv = 0;
<a name='L4164'>        <a href='../D/11079.html' title='Multiple defined in 2 places.'>set_inuse_and_pinuse</a>(<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>, p, dvs);
<a name='L4165'>      <font color='red'>}</font>
<a name='L4166'>      mem = <a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(p);
<a name='L4167'>      <a href='../D/7408.html' title='Multiple defined in 2 places.'>check_malloced_chunk</a>(<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>, mem, nb);
<a name='L4168'>      <b>goto</b> postaction;
<a name='L4169'>    <font color='red'>}</font>
<a name='L4170'>
<a name='L4171'>    <b>else</b> <b>if</b> (nb &lt; <a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>-&gt;topsize) <font color='red'>{</font> <i><font color='green'>/* Split top */</font></i>
<a name='L4172'>      <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> rsize = <a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>-&gt;topsize -= nb;
<a name='L4173'>      <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> p = <a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>-&gt;top;
<a name='L4174'>      <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> r = <a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>-&gt;top = <a href='../S/2317.html#L1675' title='Defined at 1675 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk_plus_offset</a>(p, nb);
<a name='L4175'>      r-&gt;head = rsize | <a href='../S/2317.html#L1659' title='Defined at 1659 in Modules/_ctypes/libffi/src/dlmalloc.c.'>PINUSE_BIT</a>;
<a name='L4176'>      <a href='../D/11108.html' title='Multiple defined in 2 places.'>set_size_and_pinuse_of_inuse_chunk</a>(<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>, p, nb);
<a name='L4177'>      mem = <a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(p);
<a name='L4178'>      <a href='../D/7416.html' title='Multiple defined in 2 places.'>check_top_chunk</a>(<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>, <a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>-&gt;top);
<a name='L4179'>      <a href='../D/7408.html' title='Multiple defined in 2 places.'>check_malloced_chunk</a>(<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>, mem, nb);
<a name='L4180'>      <b>goto</b> postaction;
<a name='L4181'>    <font color='red'>}</font>
<a name='L4182'>
<a name='L4183'>    mem = <a href='../S/2317.html#L3359' title='Defined at 3359 in Modules/_ctypes/libffi/src/dlmalloc.c.'>sys_alloc</a>(<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>, nb);
<a name='L4184'>
<a name='L4185'>  postaction:
<a name='L4186'>    <a href='../D/2515.html' title='Multiple defined in 2 places.'>POSTACTION</a>(<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>);
<a name='L4187'>    <b>return</b> mem;
<a name='L4188'>  <font color='red'>}</font>
<a name='L4189'>
<a name='L4190'>  <b>return</b> 0;
<a name='L4191'><font color='red'>}</font>
<a name='L4192'>
<a name='L4193'><b>void</b> <a href='../R/7399.html' title='Multiple refered from 7 places.'>dlfree</a>(<b>void</b>* mem) <font color='red'>{</font>
<a name='L4194'>  <i><font color='green'>/*</font></i>
<a name='L4195'><i><font color='green'>     Consolidate freed chunks with preceeding or succeeding bordering</font></i>
<a name='L4196'><i><font color='green'>     free chunks, if they exist, and then place in a bin.  Intermixed</font></i>
<a name='L4197'><i><font color='green'>     with special cases for top, dv, mmapped chunks, and usage errors.</font></i>
<a name='L4198'><i><font color='green'>  */</font></i>
<a name='L4199'>
<a name='L4200'>  <b>if</b> (mem != 0) <font color='red'>{</font>
<a name='L4201'>    <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> p  = <a href='../S/2317.html#L1632' title='Defined at 1632 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mem2chunk</a>(mem);
<a name='L4202'><font color='darkred'>#if</font> <a href='../S/2317.html#L491' title='Defined at 491 in Modules/_ctypes/libffi/src/dlmalloc.c.'>FOOTERS</a>
<a name='L4203'>    <a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a> <a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a> = <a href='../S/2317.html#L2429' title='Defined at 2429 in Modules/_ctypes/libffi/src/dlmalloc.c.'>get_mstate_for</a>(p);
<a name='L4204'>    <b>if</b> (!<a href='../D/10197.html' title='Multiple defined in 2 places.'>ok_magic</a>(<a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>)) <font color='red'>{</font>
<a name='L4205'>      <a href='../D/5379.html' title='Multiple defined in 2 places.'>USAGE_ERROR_ACTION</a>(<a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>, p);
<a name='L4206'>      <b>return</b>;
<a name='L4207'>    <font color='red'>}</font>
<a name='L4208'><font color='darkred'>#else</font> <i><font color='green'>/* FOOTERS */</font></i>
<a name='L4209'><font color='darkred'>#define</font> <a href='../R/7878.html' title='Multiple refered from 59 places.'>fm</a> <a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>
<a name='L4210'><font color='darkred'>#endif</font> <i><font color='green'>/* FOOTERS */</font></i>
<a name='L4211'>    <b>if</b> (!<a href='../D/2519.html' title='Multiple defined in 2 places.'>PREACTION</a>(<a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>)) <font color='red'>{</font>
<a name='L4212'>      <a href='../D/7405.html' title='Multiple defined in 2 places.'>check_inuse_chunk</a>(<a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>, p);
<a name='L4213'>      <b>if</b> (<a href='../D/4519.html' title='Multiple defined in 3 places.'>RTCHECK</a>(<a href='../D/10195.html' title='Multiple defined in 2 places.'>ok_address</a>(<a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>, p) &amp;&amp; <a href='../D/10196.html' title='Multiple defined in 2 places.'>ok_cinuse</a>(p))) <font color='red'>{</font>
<a name='L4214'>        <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> psize = <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(p);
<a name='L4215'>        <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> next = <a href='../S/2317.html#L1675' title='Defined at 1675 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk_plus_offset</a>(p, psize);
<a name='L4216'>        <b>if</b> (!<a href='../S/2317.html#L1668' title='Defined at 1668 in Modules/_ctypes/libffi/src/dlmalloc.c.'>pinuse</a>(p)) <font color='red'>{</font>
<a name='L4217'>          <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> prevsize = p-&gt;prev_foot;
<a name='L4218'>          <b>if</b> ((prevsize &amp; <a href='../D/1787.html' title='Multiple defined in 2 places.'>IS_MMAPPED_BIT</a>) != 0) <font color='red'>{</font>
<a name='L4219'>            prevsize &amp;= ~<a href='../D/1787.html' title='Multiple defined in 2 places.'>IS_MMAPPED_BIT</a>;
<a name='L4220'>            psize += prevsize + <a href='../S/2317.html#L1624' title='Defined at 1624 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MMAP_FOOT_PAD</a>;
<a name='L4221'>            <b>if</b> (<a href='../D/474.html' title='Multiple defined in 3 places.'>CALL_MUNMAP</a>((<b>char</b>*)p - prevsize, psize) == 0)
<a name='L4222'>              <a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>-&gt;footprint -= psize;
<a name='L4223'>            <b>goto</b> postaction;
<a name='L4224'>          <font color='red'>}</font>
<a name='L4225'>          <b>else</b> <font color='red'>{</font>
<a name='L4226'>            <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> prev = <a href='../S/2317.html#L1676' title='Defined at 1676 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk_minus_offset</a>(p, prevsize);
<a name='L4227'>            psize += prevsize;
<a name='L4228'>            p = prev;
<a name='L4229'>            <b>if</b> (<a href='../D/4519.html' title='Multiple defined in 3 places.'>RTCHECK</a>(<a href='../D/10195.html' title='Multiple defined in 2 places.'>ok_address</a>(<a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>, prev))) <font color='red'>{</font> <i><font color='green'>/* consolidate backward */</font></i>
<a name='L4230'>              <b>if</b> (p != <a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>-&gt;dv) <font color='red'>{</font>
<a name='L4231'>                <a href='../S/2317.html#L3118' title='Defined at 3118 in Modules/_ctypes/libffi/src/dlmalloc.c.'>unlink_chunk</a>(<a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>, p, prevsize);
<a name='L4232'>              <font color='red'>}</font>
<a name='L4233'>              <b>else</b> <b>if</b> ((next-&gt;head &amp; <a href='../S/2317.html#L1661' title='Defined at 1661 in Modules/_ctypes/libffi/src/dlmalloc.c.'>INUSE_BITS</a>) == <a href='../S/2317.html#L1661' title='Defined at 1661 in Modules/_ctypes/libffi/src/dlmalloc.c.'>INUSE_BITS</a>) <font color='red'>{</font>
<a name='L4234'>                <a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>-&gt;dvsize = psize;
<a name='L4235'>                <a href='../S/2317.html#L1694' title='Defined at 1694 in Modules/_ctypes/libffi/src/dlmalloc.c.'>set_free_with_pinuse</a>(p, psize, next);
<a name='L4236'>                <b>goto</b> postaction;
<a name='L4237'>              <font color='red'>}</font>
<a name='L4238'>            <font color='red'>}</font>
<a name='L4239'>            <b>else</b>
<a name='L4240'>              <b>goto</b> erroraction;
<a name='L4241'>          <font color='red'>}</font>
<a name='L4242'>        <font color='red'>}</font>
<a name='L4243'>
<a name='L4244'>        <b>if</b> (<a href='../D/4519.html' title='Multiple defined in 3 places.'>RTCHECK</a>(<a href='../D/10198.html' title='Multiple defined in 2 places.'>ok_next</a>(p, next) &amp;&amp; <a href='../D/10199.html' title='Multiple defined in 2 places.'>ok_pinuse</a>(next))) <font color='red'>{</font>
<a name='L4245'>          <b>if</b> (!<a href='../S/2317.html#L1667' title='Defined at 1667 in Modules/_ctypes/libffi/src/dlmalloc.c.'>cinuse</a>(next)) <font color='red'>{</font>  <i><font color='green'>/* consolidate forward */</font></i>
<a name='L4246'>            <b>if</b> (next == <a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>-&gt;top) <font color='red'>{</font>
<a name='L4247'>              <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> tsize = <a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>-&gt;topsize += psize;
<a name='L4248'>              <a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>-&gt;top = p;
<a name='L4249'>              p-&gt;head = tsize | <a href='../S/2317.html#L1659' title='Defined at 1659 in Modules/_ctypes/libffi/src/dlmalloc.c.'>PINUSE_BIT</a>;
<a name='L4250'>              <b>if</b> (p == <a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>-&gt;dv) <font color='red'>{</font>
<a name='L4251'>                <a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>-&gt;dv = 0;
<a name='L4252'>                <a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>-&gt;dvsize = 0;
<a name='L4253'>              <font color='red'>}</font>
<a name='L4254'>              <b>if</b> (<a href='../D/11160.html' title='Multiple defined in 2 places.'>should_trim</a>(<a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>, tsize))
<a name='L4255'>                <a href='../S/2317.html#L3593' title='Defined at 3593 in Modules/_ctypes/libffi/src/dlmalloc.c.'>sys_trim</a>(<a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>, 0);
<a name='L4256'>              <b>goto</b> postaction;
<a name='L4257'>            <font color='red'>}</font>
<a name='L4258'>            <b>else</b> <b>if</b> (next == <a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>-&gt;dv) <font color='red'>{</font>
<a name='L4259'>              <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> dsize = <a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>-&gt;dvsize += psize;
<a name='L4260'>              <a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>-&gt;dv = p;
<a name='L4261'>              <a href='../S/2317.html#L1690' title='Defined at 1690 in Modules/_ctypes/libffi/src/dlmalloc.c.'>set_size_and_pinuse_of_free_chunk</a>(p, dsize);
<a name='L4262'>              <b>goto</b> postaction;
<a name='L4263'>            <font color='red'>}</font>
<a name='L4264'>            <b>else</b> <font color='red'>{</font>
<a name='L4265'>              <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> nsize = <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(next);
<a name='L4266'>              psize += nsize;
<a name='L4267'>              <a href='../S/2317.html#L3118' title='Defined at 3118 in Modules/_ctypes/libffi/src/dlmalloc.c.'>unlink_chunk</a>(<a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>, next, nsize);
<a name='L4268'>              <a href='../S/2317.html#L1690' title='Defined at 1690 in Modules/_ctypes/libffi/src/dlmalloc.c.'>set_size_and_pinuse_of_free_chunk</a>(p, psize);
<a name='L4269'>              <b>if</b> (p == <a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>-&gt;dv) <font color='red'>{</font>
<a name='L4270'>                <a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>-&gt;dvsize = psize;
<a name='L4271'>                <b>goto</b> postaction;
<a name='L4272'>              <font color='red'>}</font>
<a name='L4273'>            <font color='red'>}</font>
<a name='L4274'>          <font color='red'>}</font>
<a name='L4275'>          <b>else</b>
<a name='L4276'>            <a href='../S/2317.html#L1694' title='Defined at 1694 in Modules/_ctypes/libffi/src/dlmalloc.c.'>set_free_with_pinuse</a>(p, psize, next);
<a name='L4277'>          <a href='../S/2317.html#L3114' title='Defined at 3114 in Modules/_ctypes/libffi/src/dlmalloc.c.'>insert_chunk</a>(<a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>, p, psize);
<a name='L4278'>          <a href='../D/7402.html' title='Multiple defined in 2 places.'>check_free_chunk</a>(<a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>, p);
<a name='L4279'>          <b>goto</b> postaction;
<a name='L4280'>        <font color='red'>}</font>
<a name='L4281'>      <font color='red'>}</font>
<a name='L4282'>    erroraction:
<a name='L4283'>      <a href='../D/5379.html' title='Multiple defined in 2 places.'>USAGE_ERROR_ACTION</a>(<a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>, p);
<a name='L4284'>    postaction:
<a name='L4285'>      <a href='../D/2515.html' title='Multiple defined in 2 places.'>POSTACTION</a>(<a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>);
<a name='L4286'>    <font color='red'>}</font>
<a name='L4287'>  <font color='red'>}</font>
<a name='L4288'><font color='darkred'>#if</font> !<a href='../S/2317.html#L491' title='Defined at 491 in Modules/_ctypes/libffi/src/dlmalloc.c.'>FOOTERS</a>
<a name='L4289'><font color='darkred'>#undef</font> <a href='../R/7878.html' title='Multiple refered from 59 places.'>fm</a>
<a name='L4290'><font color='darkred'>#endif</font> <i><font color='green'>/* FOOTERS */</font></i>
<a name='L4291'><font color='red'>}</font>
<a name='L4292'>
<a name='L4293'><b>void</b>* <a href='../R/7396.html' title='Multiple refered from 2 places.'>dlcalloc</a>(<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> n_elements, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> elem_size) <font color='red'>{</font>
<a name='L4294'>  <b>void</b>* mem;
<a name='L4295'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> req = 0;
<a name='L4296'>  <b>if</b> (n_elements != 0) <font color='red'>{</font>
<a name='L4297'>    req = n_elements * elem_size;
<a name='L4298'>    <b>if</b> (((n_elements | elem_size) &amp; ~(<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)0xffff) &amp;&amp;
<a name='L4299'>        (req / n_elements != elem_size))
<a name='L4300'>      req = <a href='../S/2317.html#L475' title='Defined at 475 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MAX_SIZE_T</a>; <i><font color='green'>/* force downstream failure on overflow */</font></i>
<a name='L4301'>  <font color='red'>}</font>
<a name='L4302'>  mem = <a href='../D/8185.html' title='Multiple defined in 2 places.'>dlmalloc</a>(req);
<a name='L4303'>  <b>if</b> (mem != 0 &amp;&amp; <a href='../D/7348.html' title='Multiple defined in 2 places.'>calloc_must_clear</a>(<a href='../S/2317.html#L1632' title='Defined at 1632 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mem2chunk</a>(mem)))
<a name='L4304'>    memset(mem, 0, req);
<a name='L4305'>  <b>return</b> mem;
<a name='L4306'><font color='red'>}</font>
<a name='L4307'>
<a name='L4308'><b>void</b>* <a href='../S/2317.html#L716' title='Refered from 716 in Modules/_ctypes/libffi/src/dlmalloc.c.'>dlrealloc</a>(<b>void</b>* oldmem, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> bytes) <font color='red'>{</font>
<a name='L4309'>  <b>if</b> (oldmem == 0)
<a name='L4310'>    <b>return</b> <a href='../D/8185.html' title='Multiple defined in 2 places.'>dlmalloc</a>(<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>);
<a name='L4311'><font color='darkred'>#ifdef</font> REALLOC_ZERO_BYTES_FREES
<a name='L4312'>  <b>if</b> (<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> == 0) <font color='red'>{</font>
<a name='L4313'>    <a href='../D/8181.html' title='Multiple defined in 2 places.'>dlfree</a>(oldmem);
<a name='L4314'>    <b>return</b> 0;
<a name='L4315'>  <font color='red'>}</font>
<a name='L4316'><font color='darkred'>#endif</font> <i><font color='green'>/* REALLOC_ZERO_BYTES_FREES */</font></i>
<a name='L4317'>  <b>else</b> <font color='red'>{</font>
<a name='L4318'><font color='darkred'>#if</font> ! <a href='../S/2317.html#L491' title='Defined at 491 in Modules/_ctypes/libffi/src/dlmalloc.c.'>FOOTERS</a>
<a name='L4319'>    <a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a> m = <a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>;
<a name='L4320'><font color='darkred'>#else</font> <i><font color='green'>/* FOOTERS */</font></i>
<a name='L4321'>    <a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a> m = <a href='../S/2317.html#L2429' title='Defined at 2429 in Modules/_ctypes/libffi/src/dlmalloc.c.'>get_mstate_for</a>(<a href='../S/2317.html#L1632' title='Defined at 1632 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mem2chunk</a>(oldmem));
<a name='L4322'>    <b>if</b> (!<a href='../D/10197.html' title='Multiple defined in 2 places.'>ok_magic</a>(m)) <font color='red'>{</font>
<a name='L4323'>      <a href='../D/5379.html' title='Multiple defined in 2 places.'>USAGE_ERROR_ACTION</a>(m, oldmem);
<a name='L4324'>      <b>return</b> 0;
<a name='L4325'>    <font color='red'>}</font>
<a name='L4326'><font color='darkred'>#endif</font> <i><font color='green'>/* FOOTERS */</font></i>
<a name='L4327'>    <b>return</b> <a href='../S/2317.html#L3772' title='Defined at 3772 in Modules/_ctypes/libffi/src/dlmalloc.c.'>internal_realloc</a>(m, oldmem, <a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>);
<a name='L4328'>  <font color='red'>}</font>
<a name='L4329'><font color='red'>}</font>
<a name='L4330'>
<a name='L4331'><b>void</b>* <a href='../R/7410.html' title='Multiple refered from 3 places.'>dlmemalign</a>(<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> alignment, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> bytes) <font color='red'>{</font>
<a name='L4332'>  <b>return</b> <a href='../S/2317.html#L3843' title='Defined at 3843 in Modules/_ctypes/libffi/src/dlmalloc.c.'>internal_memalign</a>(<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>, alignment, <a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>);
<a name='L4333'><font color='red'>}</font>
<a name='L4334'>
<a name='L4335'><b>void</b>** <a href='../S/2317.html#L861' title='Refered from 861 in Modules/_ctypes/libffi/src/dlmalloc.c.'>dlindependent_calloc</a>(<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> n_elements, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> elem_size,
<a name='L4336'>                                 <b>void</b>* chunks[]) <font color='red'>{</font>
<a name='L4337'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> sz = elem_size; <i><font color='green'>/* serves as 1-element array */</font></i>
<a name='L4338'>  <b>return</b> <a href='../S/2317.html#L3930' title='Defined at 3930 in Modules/_ctypes/libffi/src/dlmalloc.c.'>ialloc</a>(<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>, n_elements, &amp;sz, 3, chunks);
<a name='L4339'><font color='red'>}</font>
<a name='L4340'>
<a name='L4341'><b>void</b>** <a href='../S/2317.html#L922' title='Refered from 922 in Modules/_ctypes/libffi/src/dlmalloc.c.'>dlindependent_comalloc</a>(<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> n_elements, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> sizes[],
<a name='L4342'>                                   <b>void</b>* chunks[]) <font color='red'>{</font>
<a name='L4343'>  <b>return</b> <a href='../S/2317.html#L3930' title='Defined at 3930 in Modules/_ctypes/libffi/src/dlmalloc.c.'>ialloc</a>(<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>, n_elements, sizes, 0, chunks);
<a name='L4344'><font color='red'>}</font>
<a name='L4345'>
<a name='L4346'><b>void</b>* <a href='../S/2317.html#L737' title='Refered from 737 in Modules/_ctypes/libffi/src/dlmalloc.c.'>dlvalloc</a>(<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> bytes) <font color='red'>{</font>
<a name='L4347'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> pagesz;
<a name='L4348'>  <a href='../S/2317.html#L2452' title='Defined at 2452 in Modules/_ctypes/libffi/src/dlmalloc.c.'>init_mparams</a>();
<a name='L4349'>  pagesz = mparams.page_size;
<a name='L4350'>  <b>return</b> <a href='../D/8192.html' title='Multiple defined in 2 places.'>dlmemalign</a>(pagesz, <a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>);
<a name='L4351'><font color='red'>}</font>
<a name='L4352'>
<a name='L4353'><b>void</b>* <a href='../S/2317.html#L930' title='Refered from 930 in Modules/_ctypes/libffi/src/dlmalloc.c.'>dlpvalloc</a>(<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> bytes) <font color='red'>{</font>
<a name='L4354'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> pagesz;
<a name='L4355'>  <a href='../S/2317.html#L2452' title='Defined at 2452 in Modules/_ctypes/libffi/src/dlmalloc.c.'>init_mparams</a>();
<a name='L4356'>  pagesz = mparams.page_size;
<a name='L4357'>  <b>return</b> <a href='../D/8192.html' title='Multiple defined in 2 places.'>dlmemalign</a>(pagesz, (<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> + pagesz - <a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a>) &amp; ~(pagesz - <a href='../S/2317.html#L1249' title='Defined at 1249 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_ONE</a>));
<a name='L4358'><font color='red'>}</font>
<a name='L4359'>
<a name='L4360'><b>int</b> <a href='../S/2317.html#L953' title='Refered from 953 in Modules/_ctypes/libffi/src/dlmalloc.c.'>dlmalloc_trim</a>(<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> pad) <font color='red'>{</font>
<a name='L4361'>  <b>int</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = 0;
<a name='L4362'>  <b>if</b> (!<a href='../D/2519.html' title='Multiple defined in 2 places.'>PREACTION</a>(<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>)) <font color='red'>{</font>
<a name='L4363'>    <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = <a href='../S/2317.html#L3593' title='Defined at 3593 in Modules/_ctypes/libffi/src/dlmalloc.c.'>sys_trim</a>(<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>, <a href='../S/2828.html#L6780' title='Defined at 6780 in Objects/unicodeobject.c.'>pad</a>);
<a name='L4364'>    <a href='../D/2515.html' title='Multiple defined in 2 places.'>POSTACTION</a>(<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>);
<a name='L4365'>  <font color='red'>}</font>
<a name='L4366'>  <b>return</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L4367'><font color='red'>}</font>
<a name='L4368'>
<a name='L4369'><a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> <a href='../S/2317.html#L768' title='Refered from 768 in Modules/_ctypes/libffi/src/dlmalloc.c.'>dlmalloc_footprint</a>(<b>void</b>) <font color='red'>{</font>
<a name='L4370'>  <b>return</b> <a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>-&gt;footprint;
<a name='L4371'><font color='red'>}</font>
<a name='L4372'>
<a name='L4373'><a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> <a href='../S/2317.html#L781' title='Refered from 781 in Modules/_ctypes/libffi/src/dlmalloc.c.'>dlmalloc_max_footprint</a>(<b>void</b>) <font color='red'>{</font>
<a name='L4374'>  <b>return</b> <a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>-&gt;max_footprint;
<a name='L4375'><font color='red'>}</font>
<a name='L4376'>
<a name='L4377'><font color='darkred'>#if</font> !<a href='../D/2331.html' title='Multiple defined in 2 places.'>NO_MALLINFO</a>
<a name='L4378'><b>struct</b> <a href='../S/2317.html#L617' title='Defined at 617 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mallinfo</a> <a href='../S/2317.html#L806' title='Refered from 806 in Modules/_ctypes/libffi/src/dlmalloc.c.'>dlmallinfo</a>(<b>void</b>) <font color='red'>{</font>
<a name='L4379'>  <b>return</b> <a href='../S/2317.html#L2821' title='Defined at 2821 in Modules/_ctypes/libffi/src/dlmalloc.c.'>internal_mallinfo</a>(<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>);
<a name='L4380'><font color='red'>}</font>
<a name='L4381'><font color='darkred'>#endif</font> <i><font color='green'>/* NO_MALLINFO */</font></i>
<a name='L4382'>
<a name='L4383'><b>void</b> <a href='../S/2317.html#L990' title='Refered from 990 in Modules/_ctypes/libffi/src/dlmalloc.c.'>dlmalloc_stats</a>() <font color='red'>{</font>
<a name='L4384'>  <a href='../S/2317.html#L2860' title='Defined at 2860 in Modules/_ctypes/libffi/src/dlmalloc.c.'>internal_malloc_stats</a>(<a href='../S/2317.html#L2056' title='Defined at 2056 in Modules/_ctypes/libffi/src/dlmalloc.c.'>gm</a>);
<a name='L4385'><font color='red'>}</font>
<a name='L4386'>
<a name='L4387'><a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> <a href='../S/2317.html#L969' title='Refered from 969 in Modules/_ctypes/libffi/src/dlmalloc.c.'>dlmalloc_usable_size</a>(<b>void</b>* mem) <font color='red'>{</font>
<a name='L4388'>  <b>if</b> (mem != 0) <font color='red'>{</font>
<a name='L4389'>    <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> p = <a href='../S/2317.html#L1632' title='Defined at 1632 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mem2chunk</a>(mem);
<a name='L4390'>    <b>if</b> (<a href='../S/2317.html#L1667' title='Defined at 1667 in Modules/_ctypes/libffi/src/dlmalloc.c.'>cinuse</a>(p))
<a name='L4391'>      <b>return</b> <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(p) - <a href='../S/2317.html#L1701' title='Defined at 1701 in Modules/_ctypes/libffi/src/dlmalloc.c.'>overhead_for</a>(p);
<a name='L4392'>  <font color='red'>}</font>
<a name='L4393'>  <b>return</b> 0;
<a name='L4394'><font color='red'>}</font>
<a name='L4395'>
<a name='L4396'><b>int</b> <a href='../S/2317.html#L757' title='Refered from 757 in Modules/_ctypes/libffi/src/dlmalloc.c.'>dlmallopt</a>(<b>int</b> param_number, <b>int</b> value) <font color='red'>{</font>
<a name='L4397'>  <b>return</b> <a href='../S/2317.html#L2528' title='Defined at 2528 in Modules/_ctypes/libffi/src/dlmalloc.c.'>change_mparam</a>(param_number, <a href='../S/2252.html#L27' title='Defined at 27 in Modules/_ctypes/ctypes.h.'>value</a>);
<a name='L4398'><font color='red'>}</font>
<a name='L4399'>
<a name='L4400'><font color='darkred'>#endif</font> <i><font color='green'>/* !ONLY_MSPACES */</font></i>
<a name='L4401'>
<a name='L4402'><i><font color='green'>/* ----------------------------- user mspaces ---------------------------- */</font></i>
<a name='L4403'>
<a name='L4404'><font color='darkred'>#if</font> <a href='../D/2179.html' title='Multiple defined in 2 places.'>MSPACES</a>
<a name='L4405'>
<a name='L4406'><b>static</b> <a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a> <a href='../R/8391.html' title='Multiple refered from 2 places.'>init_user_mstate</a>(<b>char</b>* tbase, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> tsize) <font color='red'>{</font>
<a name='L4407'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> msize = <a href='../S/2317.html#L1641' title='Defined at 1641 in Modules/_ctypes/libffi/src/dlmalloc.c.'>pad_request</a>(<b>sizeof</b>(<b>struct</b> <a href='../S/2317.html#L2012' title='Defined at 2012 in Modules/_ctypes/libffi/src/dlmalloc.c.'>malloc_state</a>));
<a name='L4408'>  <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> mn;
<a name='L4409'>  <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> msp = <a href='../S/2317.html#L1634' title='Defined at 1634 in Modules/_ctypes/libffi/src/dlmalloc.c.'>align_as_chunk</a>(tbase);
<a name='L4410'>  <a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a> m = (<a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a>)(<a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(msp));
<a name='L4411'>  memset(m, 0, msize);
<a name='L4412'>  <a href='../D/1705.html' title='Multiple defined in 3 places.'>INITIAL_LOCK</a>(&amp;m-&gt;mutex);
<a name='L4413'>  msp-&gt;head = (msize|<a href='../S/2317.html#L1659' title='Defined at 1659 in Modules/_ctypes/libffi/src/dlmalloc.c.'>PINUSE_BIT</a>|<a href='../S/2317.html#L1660' title='Defined at 1660 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CINUSE_BIT</a>);
<a name='L4414'>  m-&gt;seg.base = m-&gt;least_addr = tbase;
<a name='L4415'>  m-&gt;seg.size = m-&gt;footprint = m-&gt;max_footprint = tsize;
<a name='L4416'>  m-&gt;magic = mparams.magic;
<a name='L4417'>  m-&gt;mflags = mparams.default_mflags;
<a name='L4418'>  <a href='../S/2317.html#L2073' title='Defined at 2073 in Modules/_ctypes/libffi/src/dlmalloc.c.'>disable_contiguous</a>(m);
<a name='L4419'>  <a href='../S/2317.html#L3232' title='Defined at 3232 in Modules/_ctypes/libffi/src/dlmalloc.c.'>init_bins</a>(m);
<a name='L4420'>  mn = <a href='../S/2317.html#L1679' title='Defined at 1679 in Modules/_ctypes/libffi/src/dlmalloc.c.'>next_chunk</a>(<a href='../S/2317.html#L1632' title='Defined at 1632 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mem2chunk</a>(m));
<a name='L4421'>  <a href='../S/2317.html#L3217' title='Defined at 3217 in Modules/_ctypes/libffi/src/dlmalloc.c.'>init_top</a>(m, mn, (<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)((tbase + tsize) - (<b>char</b>*)mn) - <a href='../S/2317.html#L2130' title='Defined at 2130 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TOP_FOOT_SIZE</a>);
<a name='L4422'>  <a href='../D/7416.html' title='Multiple defined in 2 places.'>check_top_chunk</a>(m, m-&gt;top);
<a name='L4423'>  <b>return</b> m;
<a name='L4424'><font color='red'>}</font>
<a name='L4425'>
<a name='L4426'><a href='../S/2317.html#L1000' title='Defined at 1000 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace</a> <a href='../S/2317.html#L1013' title='Refered from 1013 in Modules/_ctypes/libffi/src/dlmalloc.c.'>create_mspace</a>(<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> capacity, <b>int</b> locked) <font color='red'>{</font>
<a name='L4427'>  <a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a> m = 0;
<a name='L4428'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> msize = <a href='../S/2317.html#L1641' title='Defined at 1641 in Modules/_ctypes/libffi/src/dlmalloc.c.'>pad_request</a>(<b>sizeof</b>(<b>struct</b> <a href='../S/2317.html#L2012' title='Defined at 2012 in Modules/_ctypes/libffi/src/dlmalloc.c.'>malloc_state</a>));
<a name='L4429'>  <a href='../S/2317.html#L2452' title='Defined at 2452 in Modules/_ctypes/libffi/src/dlmalloc.c.'>init_mparams</a>(); <i><font color='green'>/* Ensure pagesize etc initialized */</font></i>
<a name='L4430'>
<a name='L4431'>  <b>if</b> (capacity &lt; (<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>) -(msize + <a href='../S/2317.html#L2130' title='Defined at 2130 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TOP_FOOT_SIZE</a> + mparams.page_size)) <font color='red'>{</font>
<a name='L4432'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> rs = ((capacity == 0)? mparams.granularity :
<a name='L4433'>                 (capacity + <a href='../S/2317.html#L2130' title='Defined at 2130 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TOP_FOOT_SIZE</a> + msize));
<a name='L4434'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> tsize = <a href='../S/2317.html#L2085' title='Defined at 2085 in Modules/_ctypes/libffi/src/dlmalloc.c.'>granularity_align</a>(rs);
<a name='L4435'>    <b>char</b>* tbase = (<b>char</b>*)(<a href='../D/471.html' title='Multiple defined in 4 places.'>CALL_MMAP</a>(tsize));
<a name='L4436'>    <b>if</b> (tbase != <a href='../S/2317.html#L1278' title='Defined at 1278 in Modules/_ctypes/libffi/src/dlmalloc.c.'>CMFAIL</a>) <font color='red'>{</font>
<a name='L4437'>      m = <a href='../S/2317.html#L4406' title='Defined at 4406 in Modules/_ctypes/libffi/src/dlmalloc.c.'>init_user_mstate</a>(tbase, tsize);
<a name='L4438'>      <a href='../D/11106.html' title='Multiple defined in 2 places.'>set_segment_flags</a>(&amp;m-&gt;seg, <a href='../D/1787.html' title='Multiple defined in 2 places.'>IS_MMAPPED_BIT</a>);
<a name='L4439'>      <a href='../S/2317.html#L2075' title='Defined at 2075 in Modules/_ctypes/libffi/src/dlmalloc.c.'>set_lock</a>(m, locked);
<a name='L4440'>    <font color='red'>}</font>
<a name='L4441'>  <font color='red'>}</font>
<a name='L4442'>  <b>return</b> (<a href='../S/2317.html#L1000' title='Defined at 1000 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace</a>)m;
<a name='L4443'><font color='red'>}</font>
<a name='L4444'>
<a name='L4445'><a href='../S/2317.html#L1000' title='Defined at 1000 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace</a> <a href='../S/2317.html#L1032' title='Refered from 1032 in Modules/_ctypes/libffi/src/dlmalloc.c.'>create_mspace_with_base</a>(<b>void</b>* base, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> capacity, <b>int</b> locked) <font color='red'>{</font>
<a name='L4446'>  <a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a> m = 0;
<a name='L4447'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> msize = <a href='../S/2317.html#L1641' title='Defined at 1641 in Modules/_ctypes/libffi/src/dlmalloc.c.'>pad_request</a>(<b>sizeof</b>(<b>struct</b> <a href='../S/2317.html#L2012' title='Defined at 2012 in Modules/_ctypes/libffi/src/dlmalloc.c.'>malloc_state</a>));
<a name='L4448'>  <a href='../S/2317.html#L2452' title='Defined at 2452 in Modules/_ctypes/libffi/src/dlmalloc.c.'>init_mparams</a>(); <i><font color='green'>/* Ensure pagesize etc initialized */</font></i>
<a name='L4449'>
<a name='L4450'>  <b>if</b> (capacity &gt; msize + <a href='../S/2317.html#L2130' title='Defined at 2130 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TOP_FOOT_SIZE</a> &amp;&amp;
<a name='L4451'>      capacity &lt; (<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>) -(msize + <a href='../S/2317.html#L2130' title='Defined at 2130 in Modules/_ctypes/libffi/src/dlmalloc.c.'>TOP_FOOT_SIZE</a> + mparams.page_size)) <font color='red'>{</font>
<a name='L4452'>    m = <a href='../S/2317.html#L4406' title='Defined at 4406 in Modules/_ctypes/libffi/src/dlmalloc.c.'>init_user_mstate</a>((<b>char</b>*)base, capacity);
<a name='L4453'>    <a href='../D/11106.html' title='Multiple defined in 2 places.'>set_segment_flags</a>(&amp;m-&gt;seg, <a href='../S/2317.html#L1369' title='Defined at 1369 in Modules/_ctypes/libffi/src/dlmalloc.c.'>EXTERN_BIT</a>);
<a name='L4454'>    <a href='../S/2317.html#L2075' title='Defined at 2075 in Modules/_ctypes/libffi/src/dlmalloc.c.'>set_lock</a>(m, locked);
<a name='L4455'>  <font color='red'>}</font>
<a name='L4456'>  <b>return</b> (<a href='../S/2317.html#L1000' title='Defined at 1000 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace</a>)m;
<a name='L4457'><font color='red'>}</font>
<a name='L4458'>
<a name='L4459'><a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> <a href='../S/2317.html#L1021' title='Refered from 1021 in Modules/_ctypes/libffi/src/dlmalloc.c.'>destroy_mspace</a>(mspace msp) <font color='red'>{</font>
<a name='L4460'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> freed = 0;
<a name='L4461'>  <a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a> ms = (<a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a>)msp;
<a name='L4462'>  <b>if</b> (<a href='../D/10197.html' title='Multiple defined in 2 places.'>ok_magic</a>(ms)) <font color='red'>{</font>
<a name='L4463'>    <a href='../S/2317.html#L1925' title='Defined at 1925 in Modules/_ctypes/libffi/src/dlmalloc.c.'>msegmentptr</a> sp = &amp;ms-&gt;seg;
<a name='L4464'>    <b>while</b> (sp != 0) <font color='red'>{</font>
<a name='L4465'>      <b>char</b>* base = sp-&gt;base;
<a name='L4466'>      <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> size = sp-&gt;size;
<a name='L4467'>      <a href='../S/2317.html#L1609' title='Defined at 1609 in Modules/_ctypes/libffi/src/dlmalloc.c.'>flag_t</a> flag = <a href='../D/8894.html' title='Multiple defined in 2 places.'>get_segment_flags</a>(sp);
<a name='L4468'>      sp = sp-&gt;next;
<a name='L4469'>      <b>if</b> ((flag &amp; <a href='../D/1787.html' title='Multiple defined in 2 places.'>IS_MMAPPED_BIT</a>) &amp;&amp; !(flag &amp; <a href='../S/2317.html#L1369' title='Defined at 1369 in Modules/_ctypes/libffi/src/dlmalloc.c.'>EXTERN_BIT</a>) &amp;&amp;
<a name='L4470'>          <a href='../D/474.html' title='Multiple defined in 3 places.'>CALL_MUNMAP</a>(base, size) == 0)
<a name='L4471'>        freed += size;
<a name='L4472'>    <font color='red'>}</font>
<a name='L4473'>  <font color='red'>}</font>
<a name='L4474'>  <b>else</b> <font color='red'>{</font>
<a name='L4475'>    <a href='../D/5379.html' title='Multiple defined in 2 places.'>USAGE_ERROR_ACTION</a>(ms,ms);
<a name='L4476'>  <font color='red'>}</font>
<a name='L4477'>  <b>return</b> freed;
<a name='L4478'><font color='red'>}</font>
<a name='L4479'>
<a name='L4480'><i><font color='green'>/*</font></i>
<a name='L4481'><i><font color='green'>  mspace versions of routines are near-clones of the global</font></i>
<a name='L4482'><i><font color='green'>  versions. This is not so nice but better than the alternatives.</font></i>
<a name='L4483'><i><font color='green'>*/</font></i>
<a name='L4484'>
<a name='L4485'>
<a name='L4486'><b>void</b>* <a href='../R/9126.html' title='Multiple refered from 4 places.'>mspace_malloc</a>(mspace msp, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> bytes) <font color='red'>{</font>
<a name='L4487'>  <a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a> ms = (<a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a>)msp;
<a name='L4488'>  <b>if</b> (!<a href='../D/10197.html' title='Multiple defined in 2 places.'>ok_magic</a>(ms)) <font color='red'>{</font>
<a name='L4489'>    <a href='../D/5379.html' title='Multiple defined in 2 places.'>USAGE_ERROR_ACTION</a>(ms,ms);
<a name='L4490'>    <b>return</b> 0;
<a name='L4491'>  <font color='red'>}</font>
<a name='L4492'>  <b>if</b> (!<a href='../D/2519.html' title='Multiple defined in 2 places.'>PREACTION</a>(ms)) <font color='red'>{</font>
<a name='L4493'>    <b>void</b>* mem;
<a name='L4494'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> nb;
<a name='L4495'>    <b>if</b> (<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> &lt;= <a href='../S/2317.html#L2010' title='Defined at 2010 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MAX_SMALL_REQUEST</a>) <font color='red'>{</font>
<a name='L4496'>      <a href='../S/2317.html#L1607' title='Defined at 1607 in Modules/_ctypes/libffi/src/dlmalloc.c.'>bindex_t</a> idx;
<a name='L4497'>      <a href='../S/2317.html#L1608' title='Defined at 1608 in Modules/_ctypes/libffi/src/dlmalloc.c.'>binmap_t</a> smallbits;
<a name='L4498'>      nb = (<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> &lt; <a href='../S/2317.html#L1638' title='Defined at 1638 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MIN_REQUEST</a>)? <a href='../S/2317.html#L1627' title='Defined at 1627 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MIN_CHUNK_SIZE</a> : <a href='../S/2317.html#L1641' title='Defined at 1641 in Modules/_ctypes/libffi/src/dlmalloc.c.'>pad_request</a>(<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>);
<a name='L4499'>      idx = <a href='../S/2317.html#L2228' title='Defined at 2228 in Modules/_ctypes/libffi/src/dlmalloc.c.'>small_index</a>(nb);
<a name='L4500'>      smallbits = ms-&gt;smallmap &gt;&gt; idx;
<a name='L4501'>
<a name='L4502'>      <b>if</b> ((smallbits &amp; 0x3U) != 0) <font color='red'>{</font> <i><font color='green'>/* Remainderless fit to a smallbin. */</font></i>
<a name='L4503'>        <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a>, p;
<a name='L4504'>        idx += ~smallbits &amp; 1;       <i><font color='green'>/* Uses next bin if idx empty */</font></i>
<a name='L4505'>        <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a> = <a href='../S/2317.html#L2233' title='Defined at 2233 in Modules/_ctypes/libffi/src/dlmalloc.c.'>smallbin_at</a>(ms, idx);
<a name='L4506'>        p = <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a>-&gt;fd;
<a name='L4507'>        <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(p) == <a href='../S/2317.html#L2229' title='Defined at 2229 in Modules/_ctypes/libffi/src/dlmalloc.c.'>small_index2size</a>(idx));
<a name='L4508'>        <a href='../S/2317.html#L2941' title='Defined at 2941 in Modules/_ctypes/libffi/src/dlmalloc.c.'>unlink_first_small_chunk</a>(ms, <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a>, p, idx);
<a name='L4509'>        <a href='../D/11079.html' title='Multiple defined in 2 places.'>set_inuse_and_pinuse</a>(ms, p, <a href='../S/2317.html#L2229' title='Defined at 2229 in Modules/_ctypes/libffi/src/dlmalloc.c.'>small_index2size</a>(idx));
<a name='L4510'>        mem = <a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(p);
<a name='L4511'>        <a href='../D/7408.html' title='Multiple defined in 2 places.'>check_malloced_chunk</a>(ms, mem, nb);
<a name='L4512'>        <b>goto</b> postaction;
<a name='L4513'>      <font color='red'>}</font>
<a name='L4514'>
<a name='L4515'>      <b>else</b> <b>if</b> (nb &gt; ms-&gt;dvsize) <font color='red'>{</font>
<a name='L4516'>        <b>if</b> (smallbits != 0) <font color='red'>{</font> <i><font color='green'>/* Use chunk in next nonempty smallbin */</font></i>
<a name='L4517'>          <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a>, p, r;
<a name='L4518'>          <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> rsize;
<a name='L4519'>          <a href='../S/2317.html#L1607' title='Defined at 1607 in Modules/_ctypes/libffi/src/dlmalloc.c.'>bindex_t</a> i;
<a name='L4520'>          <a href='../S/2317.html#L1608' title='Defined at 1608 in Modules/_ctypes/libffi/src/dlmalloc.c.'>binmap_t</a> leftbits = (smallbits &lt;&lt; idx) &amp; <a href='../S/2317.html#L2333' title='Defined at 2333 in Modules/_ctypes/libffi/src/dlmalloc.c.'>left_bits</a>(<a href='../S/2317.html#L2289' title='Defined at 2289 in Modules/_ctypes/libffi/src/dlmalloc.c.'>idx2bit</a>(idx));
<a name='L4521'>          <a href='../S/2317.html#L1608' title='Defined at 1608 in Modules/_ctypes/libffi/src/dlmalloc.c.'>binmap_t</a> leastbit = <a href='../S/2317.html#L2330' title='Defined at 2330 in Modules/_ctypes/libffi/src/dlmalloc.c.'>least_bit</a>(leftbits);
<a name='L4522'>          <a href='../D/7728.html' title='Multiple defined in 3 places.'>compute_bit2idx</a>(leastbit, i);
<a name='L4523'>          <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a> = <a href='../S/2317.html#L2233' title='Defined at 2233 in Modules/_ctypes/libffi/src/dlmalloc.c.'>smallbin_at</a>(ms, i);
<a name='L4524'>          p = <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a>-&gt;fd;
<a name='L4525'>          <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(<a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(p) == <a href='../S/2317.html#L2229' title='Defined at 2229 in Modules/_ctypes/libffi/src/dlmalloc.c.'>small_index2size</a>(i));
<a name='L4526'>          <a href='../S/2317.html#L2941' title='Defined at 2941 in Modules/_ctypes/libffi/src/dlmalloc.c.'>unlink_first_small_chunk</a>(ms, <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a>, p, i);
<a name='L4527'>          rsize = <a href='../S/2317.html#L2229' title='Defined at 2229 in Modules/_ctypes/libffi/src/dlmalloc.c.'>small_index2size</a>(i) - nb;
<a name='L4528'>          <i><font color='green'>/* Fit here cannot be remainderless if 4byte sizes */</font></i>
<a name='L4529'>          <b>if</b> (<a href='../S/2317.html#L1243' title='Defined at 1243 in Modules/_ctypes/libffi/src/dlmalloc.c.'>SIZE_T_SIZE</a> != 4 &amp;&amp; rsize &lt; <a href='../S/2317.html#L1627' title='Defined at 1627 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MIN_CHUNK_SIZE</a>)
<a name='L4530'>            <a href='../D/11079.html' title='Multiple defined in 2 places.'>set_inuse_and_pinuse</a>(ms, p, <a href='../S/2317.html#L2229' title='Defined at 2229 in Modules/_ctypes/libffi/src/dlmalloc.c.'>small_index2size</a>(i));
<a name='L4531'>          <b>else</b> <font color='red'>{</font>
<a name='L4532'>            <a href='../D/11108.html' title='Multiple defined in 2 places.'>set_size_and_pinuse_of_inuse_chunk</a>(ms, p, nb);
<a name='L4533'>            r = <a href='../S/2317.html#L1675' title='Defined at 1675 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk_plus_offset</a>(p, nb);
<a name='L4534'>            <a href='../S/2317.html#L1690' title='Defined at 1690 in Modules/_ctypes/libffi/src/dlmalloc.c.'>set_size_and_pinuse_of_free_chunk</a>(r, rsize);
<a name='L4535'>            <a href='../S/2317.html#L2959' title='Defined at 2959 in Modules/_ctypes/libffi/src/dlmalloc.c.'>replace_dv</a>(ms, r, rsize);
<a name='L4536'>          <font color='red'>}</font>
<a name='L4537'>          mem = <a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(p);
<a name='L4538'>          <a href='../D/7408.html' title='Multiple defined in 2 places.'>check_malloced_chunk</a>(ms, mem, nb);
<a name='L4539'>          <b>goto</b> postaction;
<a name='L4540'>        <font color='red'>}</font>
<a name='L4541'>
<a name='L4542'>        <b>else</b> <b>if</b> (ms-&gt;treemap != 0 &amp;&amp; (mem = <a href='../S/2317.html#L3732' title='Defined at 3732 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tmalloc_small</a>(ms, nb)) != 0) <font color='red'>{</font>
<a name='L4543'>          <a href='../D/7408.html' title='Multiple defined in 2 places.'>check_malloced_chunk</a>(ms, mem, nb);
<a name='L4544'>          <b>goto</b> postaction;
<a name='L4545'>        <font color='red'>}</font>
<a name='L4546'>      <font color='red'>}</font>
<a name='L4547'>    <font color='red'>}</font>
<a name='L4548'>    <b>else</b> <b>if</b> (<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> &gt;= <a href='../S/2317.html#L1637' title='Defined at 1637 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MAX_REQUEST</a>)
<a name='L4549'>      nb = <a href='../S/2317.html#L475' title='Defined at 475 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MAX_SIZE_T</a>; <i><font color='green'>/* Too big to allocate. Force failure (in sys alloc) */</font></i>
<a name='L4550'>    <b>else</b> <font color='red'>{</font>
<a name='L4551'>      nb = <a href='../S/2317.html#L1641' title='Defined at 1641 in Modules/_ctypes/libffi/src/dlmalloc.c.'>pad_request</a>(<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>);
<a name='L4552'>      <b>if</b> (ms-&gt;treemap != 0 &amp;&amp; (mem = <a href='../S/2317.html#L3659' title='Defined at 3659 in Modules/_ctypes/libffi/src/dlmalloc.c.'>tmalloc_large</a>(ms, nb)) != 0) <font color='red'>{</font>
<a name='L4553'>        <a href='../D/7408.html' title='Multiple defined in 2 places.'>check_malloced_chunk</a>(ms, mem, nb);
<a name='L4554'>        <b>goto</b> postaction;
<a name='L4555'>      <font color='red'>}</font>
<a name='L4556'>    <font color='red'>}</font>
<a name='L4557'>
<a name='L4558'>    <b>if</b> (nb &lt;= ms-&gt;dvsize) <font color='red'>{</font>
<a name='L4559'>      <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> rsize = ms-&gt;dvsize - nb;
<a name='L4560'>      <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> p = ms-&gt;dv;
<a name='L4561'>      <b>if</b> (rsize &gt;= <a href='../S/2317.html#L1627' title='Defined at 1627 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MIN_CHUNK_SIZE</a>) <font color='red'>{</font> <i><font color='green'>/* split dv */</font></i>
<a name='L4562'>        <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> r = ms-&gt;dv = <a href='../S/2317.html#L1675' title='Defined at 1675 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk_plus_offset</a>(p, nb);
<a name='L4563'>        ms-&gt;dvsize = rsize;
<a name='L4564'>        <a href='../S/2317.html#L1690' title='Defined at 1690 in Modules/_ctypes/libffi/src/dlmalloc.c.'>set_size_and_pinuse_of_free_chunk</a>(r, rsize);
<a name='L4565'>        <a href='../D/11108.html' title='Multiple defined in 2 places.'>set_size_and_pinuse_of_inuse_chunk</a>(ms, p, nb);
<a name='L4566'>      <font color='red'>}</font>
<a name='L4567'>      <b>else</b> <font color='red'>{</font> <i><font color='green'>/* exhaust dv */</font></i>
<a name='L4568'>        <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> dvs = ms-&gt;dvsize;
<a name='L4569'>        ms-&gt;dvsize = 0;
<a name='L4570'>        ms-&gt;dv = 0;
<a name='L4571'>        <a href='../D/11079.html' title='Multiple defined in 2 places.'>set_inuse_and_pinuse</a>(ms, p, dvs);
<a name='L4572'>      <font color='red'>}</font>
<a name='L4573'>      mem = <a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(p);
<a name='L4574'>      <a href='../D/7408.html' title='Multiple defined in 2 places.'>check_malloced_chunk</a>(ms, mem, nb);
<a name='L4575'>      <b>goto</b> postaction;
<a name='L4576'>    <font color='red'>}</font>
<a name='L4577'>
<a name='L4578'>    <b>else</b> <b>if</b> (nb &lt; ms-&gt;topsize) <font color='red'>{</font> <i><font color='green'>/* Split top */</font></i>
<a name='L4579'>      <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> rsize = ms-&gt;topsize -= nb;
<a name='L4580'>      <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> p = ms-&gt;top;
<a name='L4581'>      <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> r = ms-&gt;top = <a href='../S/2317.html#L1675' title='Defined at 1675 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk_plus_offset</a>(p, nb);
<a name='L4582'>      r-&gt;head = rsize | <a href='../S/2317.html#L1659' title='Defined at 1659 in Modules/_ctypes/libffi/src/dlmalloc.c.'>PINUSE_BIT</a>;
<a name='L4583'>      <a href='../D/11108.html' title='Multiple defined in 2 places.'>set_size_and_pinuse_of_inuse_chunk</a>(ms, p, nb);
<a name='L4584'>      mem = <a href='../S/2317.html#L1631' title='Defined at 1631 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk2mem</a>(p);
<a name='L4585'>      <a href='../D/7416.html' title='Multiple defined in 2 places.'>check_top_chunk</a>(ms, ms-&gt;top);
<a name='L4586'>      <a href='../D/7408.html' title='Multiple defined in 2 places.'>check_malloced_chunk</a>(ms, mem, nb);
<a name='L4587'>      <b>goto</b> postaction;
<a name='L4588'>    <font color='red'>}</font>
<a name='L4589'>
<a name='L4590'>    mem = <a href='../S/2317.html#L3359' title='Defined at 3359 in Modules/_ctypes/libffi/src/dlmalloc.c.'>sys_alloc</a>(ms, nb);
<a name='L4591'>
<a name='L4592'>  postaction:
<a name='L4593'>    <a href='../D/2515.html' title='Multiple defined in 2 places.'>POSTACTION</a>(ms);
<a name='L4594'>    <b>return</b> mem;
<a name='L4595'>  <font color='red'>}</font>
<a name='L4596'>
<a name='L4597'>  <b>return</b> 0;
<a name='L4598'><font color='red'>}</font>
<a name='L4599'>
<a name='L4600'><b>void</b> <a href='../R/9122.html' title='Multiple refered from 4 places.'>mspace_free</a>(mspace msp, <b>void</b>* mem) <font color='red'>{</font>
<a name='L4601'>  <b>if</b> (mem != 0) <font color='red'>{</font>
<a name='L4602'>    <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> p  = <a href='../S/2317.html#L1632' title='Defined at 1632 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mem2chunk</a>(mem);
<a name='L4603'><font color='darkred'>#if</font> <a href='../S/2317.html#L491' title='Defined at 491 in Modules/_ctypes/libffi/src/dlmalloc.c.'>FOOTERS</a>
<a name='L4604'>    <a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a> <a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a> = <a href='../S/2317.html#L2429' title='Defined at 2429 in Modules/_ctypes/libffi/src/dlmalloc.c.'>get_mstate_for</a>(p);
<a name='L4605'><font color='darkred'>#else</font> <i><font color='green'>/* FOOTERS */</font></i>
<a name='L4606'>    <a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a> <a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a> = (<a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a>)msp;
<a name='L4607'><font color='darkred'>#endif</font> <i><font color='green'>/* FOOTERS */</font></i>
<a name='L4608'>    <b>if</b> (!<a href='../D/10197.html' title='Multiple defined in 2 places.'>ok_magic</a>(<a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>)) <font color='red'>{</font>
<a name='L4609'>      <a href='../D/5379.html' title='Multiple defined in 2 places.'>USAGE_ERROR_ACTION</a>(<a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>, p);
<a name='L4610'>      <b>return</b>;
<a name='L4611'>    <font color='red'>}</font>
<a name='L4612'>    <b>if</b> (!<a href='../D/2519.html' title='Multiple defined in 2 places.'>PREACTION</a>(<a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>)) <font color='red'>{</font>
<a name='L4613'>      <a href='../D/7405.html' title='Multiple defined in 2 places.'>check_inuse_chunk</a>(<a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>, p);
<a name='L4614'>      <b>if</b> (<a href='../D/4519.html' title='Multiple defined in 3 places.'>RTCHECK</a>(<a href='../D/10195.html' title='Multiple defined in 2 places.'>ok_address</a>(<a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>, p) &amp;&amp; <a href='../D/10196.html' title='Multiple defined in 2 places.'>ok_cinuse</a>(p))) <font color='red'>{</font>
<a name='L4615'>        <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> psize = <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(p);
<a name='L4616'>        <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> next = <a href='../S/2317.html#L1675' title='Defined at 1675 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk_plus_offset</a>(p, psize);
<a name='L4617'>        <b>if</b> (!<a href='../S/2317.html#L1668' title='Defined at 1668 in Modules/_ctypes/libffi/src/dlmalloc.c.'>pinuse</a>(p)) <font color='red'>{</font>
<a name='L4618'>          <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> prevsize = p-&gt;prev_foot;
<a name='L4619'>          <b>if</b> ((prevsize &amp; <a href='../D/1787.html' title='Multiple defined in 2 places.'>IS_MMAPPED_BIT</a>) != 0) <font color='red'>{</font>
<a name='L4620'>            prevsize &amp;= ~<a href='../D/1787.html' title='Multiple defined in 2 places.'>IS_MMAPPED_BIT</a>;
<a name='L4621'>            psize += prevsize + <a href='../S/2317.html#L1624' title='Defined at 1624 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MMAP_FOOT_PAD</a>;
<a name='L4622'>            <b>if</b> (<a href='../D/474.html' title='Multiple defined in 3 places.'>CALL_MUNMAP</a>((<b>char</b>*)p - prevsize, psize) == 0)
<a name='L4623'>              <a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>-&gt;footprint -= psize;
<a name='L4624'>            <b>goto</b> postaction;
<a name='L4625'>          <font color='red'>}</font>
<a name='L4626'>          <b>else</b> <font color='red'>{</font>
<a name='L4627'>            <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> prev = <a href='../S/2317.html#L1676' title='Defined at 1676 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunk_minus_offset</a>(p, prevsize);
<a name='L4628'>            psize += prevsize;
<a name='L4629'>            p = prev;
<a name='L4630'>            <b>if</b> (<a href='../D/4519.html' title='Multiple defined in 3 places.'>RTCHECK</a>(<a href='../D/10195.html' title='Multiple defined in 2 places.'>ok_address</a>(<a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>, prev))) <font color='red'>{</font> <i><font color='green'>/* consolidate backward */</font></i>
<a name='L4631'>              <b>if</b> (p != <a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>-&gt;dv) <font color='red'>{</font>
<a name='L4632'>                <a href='../S/2317.html#L3118' title='Defined at 3118 in Modules/_ctypes/libffi/src/dlmalloc.c.'>unlink_chunk</a>(<a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>, p, prevsize);
<a name='L4633'>              <font color='red'>}</font>
<a name='L4634'>              <b>else</b> <b>if</b> ((next-&gt;head &amp; <a href='../S/2317.html#L1661' title='Defined at 1661 in Modules/_ctypes/libffi/src/dlmalloc.c.'>INUSE_BITS</a>) == <a href='../S/2317.html#L1661' title='Defined at 1661 in Modules/_ctypes/libffi/src/dlmalloc.c.'>INUSE_BITS</a>) <font color='red'>{</font>
<a name='L4635'>                <a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>-&gt;dvsize = psize;
<a name='L4636'>                <a href='../S/2317.html#L1694' title='Defined at 1694 in Modules/_ctypes/libffi/src/dlmalloc.c.'>set_free_with_pinuse</a>(p, psize, next);
<a name='L4637'>                <b>goto</b> postaction;
<a name='L4638'>              <font color='red'>}</font>
<a name='L4639'>            <font color='red'>}</font>
<a name='L4640'>            <b>else</b>
<a name='L4641'>              <b>goto</b> erroraction;
<a name='L4642'>          <font color='red'>}</font>
<a name='L4643'>        <font color='red'>}</font>
<a name='L4644'>
<a name='L4645'>        <b>if</b> (<a href='../D/4519.html' title='Multiple defined in 3 places.'>RTCHECK</a>(<a href='../D/10198.html' title='Multiple defined in 2 places.'>ok_next</a>(p, next) &amp;&amp; <a href='../D/10199.html' title='Multiple defined in 2 places.'>ok_pinuse</a>(next))) <font color='red'>{</font>
<a name='L4646'>          <b>if</b> (!<a href='../S/2317.html#L1667' title='Defined at 1667 in Modules/_ctypes/libffi/src/dlmalloc.c.'>cinuse</a>(next)) <font color='red'>{</font>  <i><font color='green'>/* consolidate forward */</font></i>
<a name='L4647'>            <b>if</b> (next == <a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>-&gt;top) <font color='red'>{</font>
<a name='L4648'>              <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> tsize = <a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>-&gt;topsize += psize;
<a name='L4649'>              <a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>-&gt;top = p;
<a name='L4650'>              p-&gt;head = tsize | <a href='../S/2317.html#L1659' title='Defined at 1659 in Modules/_ctypes/libffi/src/dlmalloc.c.'>PINUSE_BIT</a>;
<a name='L4651'>              <b>if</b> (p == <a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>-&gt;dv) <font color='red'>{</font>
<a name='L4652'>                <a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>-&gt;dv = 0;
<a name='L4653'>                <a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>-&gt;dvsize = 0;
<a name='L4654'>              <font color='red'>}</font>
<a name='L4655'>              <b>if</b> (<a href='../D/11160.html' title='Multiple defined in 2 places.'>should_trim</a>(<a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>, tsize))
<a name='L4656'>                <a href='../S/2317.html#L3593' title='Defined at 3593 in Modules/_ctypes/libffi/src/dlmalloc.c.'>sys_trim</a>(<a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>, 0);
<a name='L4657'>              <b>goto</b> postaction;
<a name='L4658'>            <font color='red'>}</font>
<a name='L4659'>            <b>else</b> <b>if</b> (next == <a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>-&gt;dv) <font color='red'>{</font>
<a name='L4660'>              <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> dsize = <a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>-&gt;dvsize += psize;
<a name='L4661'>              <a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>-&gt;dv = p;
<a name='L4662'>              <a href='../S/2317.html#L1690' title='Defined at 1690 in Modules/_ctypes/libffi/src/dlmalloc.c.'>set_size_and_pinuse_of_free_chunk</a>(p, dsize);
<a name='L4663'>              <b>goto</b> postaction;
<a name='L4664'>            <font color='red'>}</font>
<a name='L4665'>            <b>else</b> <font color='red'>{</font>
<a name='L4666'>              <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> nsize = <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>(next);
<a name='L4667'>              psize += nsize;
<a name='L4668'>              <a href='../S/2317.html#L3118' title='Defined at 3118 in Modules/_ctypes/libffi/src/dlmalloc.c.'>unlink_chunk</a>(<a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>, next, nsize);
<a name='L4669'>              <a href='../S/2317.html#L1690' title='Defined at 1690 in Modules/_ctypes/libffi/src/dlmalloc.c.'>set_size_and_pinuse_of_free_chunk</a>(p, psize);
<a name='L4670'>              <b>if</b> (p == <a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>-&gt;dv) <font color='red'>{</font>
<a name='L4671'>                <a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>-&gt;dvsize = psize;
<a name='L4672'>                <b>goto</b> postaction;
<a name='L4673'>              <font color='red'>}</font>
<a name='L4674'>            <font color='red'>}</font>
<a name='L4675'>          <font color='red'>}</font>
<a name='L4676'>          <b>else</b>
<a name='L4677'>            <a href='../S/2317.html#L1694' title='Defined at 1694 in Modules/_ctypes/libffi/src/dlmalloc.c.'>set_free_with_pinuse</a>(p, psize, next);
<a name='L4678'>          <a href='../S/2317.html#L3114' title='Defined at 3114 in Modules/_ctypes/libffi/src/dlmalloc.c.'>insert_chunk</a>(<a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>, p, psize);
<a name='L4679'>          <a href='../D/7402.html' title='Multiple defined in 2 places.'>check_free_chunk</a>(<a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>, p);
<a name='L4680'>          <b>goto</b> postaction;
<a name='L4681'>        <font color='red'>}</font>
<a name='L4682'>      <font color='red'>}</font>
<a name='L4683'>    erroraction:
<a name='L4684'>      <a href='../D/5379.html' title='Multiple defined in 2 places.'>USAGE_ERROR_ACTION</a>(<a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>, p);
<a name='L4685'>    postaction:
<a name='L4686'>      <a href='../D/2515.html' title='Multiple defined in 2 places.'>POSTACTION</a>(<a href='../D/8677.html' title='Multiple defined in 2 places.'>fm</a>);
<a name='L4687'>    <font color='red'>}</font>
<a name='L4688'>  <font color='red'>}</font>
<a name='L4689'><font color='red'>}</font>
<a name='L4690'>
<a name='L4691'><b>void</b>* <a href='../S/2317.html#L1065' title='Refered from 1065 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace_calloc</a>(mspace msp, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> n_elements, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> elem_size) <font color='red'>{</font>
<a name='L4692'>  <b>void</b>* mem;
<a name='L4693'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> req = 0;
<a name='L4694'>  <a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a> ms = (<a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a>)msp;
<a name='L4695'>  <b>if</b> (!<a href='../D/10197.html' title='Multiple defined in 2 places.'>ok_magic</a>(ms)) <font color='red'>{</font>
<a name='L4696'>    <a href='../D/5379.html' title='Multiple defined in 2 places.'>USAGE_ERROR_ACTION</a>(ms,ms);
<a name='L4697'>    <b>return</b> 0;
<a name='L4698'>  <font color='red'>}</font>
<a name='L4699'>  <b>if</b> (n_elements != 0) <font color='red'>{</font>
<a name='L4700'>    req = n_elements * elem_size;
<a name='L4701'>    <b>if</b> (((n_elements | elem_size) &amp; ~(<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)0xffff) &amp;&amp;
<a name='L4702'>        (req / n_elements != elem_size))
<a name='L4703'>      req = <a href='../S/2317.html#L475' title='Defined at 475 in Modules/_ctypes/libffi/src/dlmalloc.c.'>MAX_SIZE_T</a>; <i><font color='green'>/* force downstream failure on overflow */</font></i>
<a name='L4704'>  <font color='red'>}</font>
<a name='L4705'>  mem = <a href='../D/9260.html' title='Multiple defined in 3 places.'>internal_malloc</a>(ms, req);
<a name='L4706'>  <b>if</b> (mem != 0 &amp;&amp; <a href='../D/7348.html' title='Multiple defined in 2 places.'>calloc_must_clear</a>(<a href='../S/2317.html#L1632' title='Defined at 1632 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mem2chunk</a>(mem)))
<a name='L4707'>    memset(mem, 0, req);
<a name='L4708'>  <b>return</b> mem;
<a name='L4709'><font color='red'>}</font>
<a name='L4710'>
<a name='L4711'><b>void</b>* <a href='../S/2317.html#L1059' title='Refered from 1059 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace_realloc</a>(mspace msp, <b>void</b>* oldmem, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> bytes) <font color='red'>{</font>
<a name='L4712'>  <b>if</b> (oldmem == 0)
<a name='L4713'>    <b>return</b> <a href='../S/2317.html#L4486' title='Defined at 4486 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace_malloc</a>(msp, <a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>);
<a name='L4714'><font color='darkred'>#ifdef</font> REALLOC_ZERO_BYTES_FREES
<a name='L4715'>  <b>if</b> (<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> == 0) <font color='red'>{</font>
<a name='L4716'>    <a href='../S/2317.html#L4600' title='Defined at 4600 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace_free</a>(msp, oldmem);
<a name='L4717'>    <b>return</b> 0;
<a name='L4718'>  <font color='red'>}</font>
<a name='L4719'><font color='darkred'>#endif</font> <i><font color='green'>/* REALLOC_ZERO_BYTES_FREES */</font></i>
<a name='L4720'>  <b>else</b> <font color='red'>{</font>
<a name='L4721'><font color='darkred'>#if</font> <a href='../S/2317.html#L491' title='Defined at 491 in Modules/_ctypes/libffi/src/dlmalloc.c.'>FOOTERS</a>
<a name='L4722'>    <a href='../S/2317.html#L1605' title='Defined at 1605 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mchunkptr</a> p  = <a href='../S/2317.html#L1632' title='Defined at 1632 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mem2chunk</a>(oldmem);
<a name='L4723'>    <a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a> ms = <a href='../S/2317.html#L2429' title='Defined at 2429 in Modules/_ctypes/libffi/src/dlmalloc.c.'>get_mstate_for</a>(p);
<a name='L4724'><font color='darkred'>#else</font> <i><font color='green'>/* FOOTERS */</font></i>
<a name='L4725'>    <a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a> ms = (<a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a>)msp;
<a name='L4726'><font color='darkred'>#endif</font> <i><font color='green'>/* FOOTERS */</font></i>
<a name='L4727'>    <b>if</b> (!<a href='../D/10197.html' title='Multiple defined in 2 places.'>ok_magic</a>(ms)) <font color='red'>{</font>
<a name='L4728'>      <a href='../D/5379.html' title='Multiple defined in 2 places.'>USAGE_ERROR_ACTION</a>(ms,ms);
<a name='L4729'>      <b>return</b> 0;
<a name='L4730'>    <font color='red'>}</font>
<a name='L4731'>    <b>return</b> <a href='../S/2317.html#L3772' title='Defined at 3772 in Modules/_ctypes/libffi/src/dlmalloc.c.'>internal_realloc</a>(ms, oldmem, <a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>);
<a name='L4732'>  <font color='red'>}</font>
<a name='L4733'><font color='red'>}</font>
<a name='L4734'>
<a name='L4735'><b>void</b>* <a href='../S/2317.html#L1071' title='Refered from 1071 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace_memalign</a>(mspace msp, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> alignment, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> bytes) <font color='red'>{</font>
<a name='L4736'>  <a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a> ms = (<a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a>)msp;
<a name='L4737'>  <b>if</b> (!<a href='../D/10197.html' title='Multiple defined in 2 places.'>ok_magic</a>(ms)) <font color='red'>{</font>
<a name='L4738'>    <a href='../D/5379.html' title='Multiple defined in 2 places.'>USAGE_ERROR_ACTION</a>(ms,ms);
<a name='L4739'>    <b>return</b> 0;
<a name='L4740'>  <font color='red'>}</font>
<a name='L4741'>  <b>return</b> <a href='../S/2317.html#L3843' title='Defined at 3843 in Modules/_ctypes/libffi/src/dlmalloc.c.'>internal_memalign</a>(ms, alignment, <a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>);
<a name='L4742'><font color='red'>}</font>
<a name='L4743'>
<a name='L4744'><b>void</b>** <a href='../S/2317.html#L1077' title='Refered from 1077 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace_independent_calloc</a>(mspace msp, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> n_elements,
<a name='L4745'>                                 <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> elem_size, <b>void</b>* chunks[]) <font color='red'>{</font>
<a name='L4746'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> sz = elem_size; <i><font color='green'>/* serves as 1-element array */</font></i>
<a name='L4747'>  <a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a> ms = (<a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a>)msp;
<a name='L4748'>  <b>if</b> (!<a href='../D/10197.html' title='Multiple defined in 2 places.'>ok_magic</a>(ms)) <font color='red'>{</font>
<a name='L4749'>    <a href='../D/5379.html' title='Multiple defined in 2 places.'>USAGE_ERROR_ACTION</a>(ms,ms);
<a name='L4750'>    <b>return</b> 0;
<a name='L4751'>  <font color='red'>}</font>
<a name='L4752'>  <b>return</b> <a href='../S/2317.html#L3930' title='Defined at 3930 in Modules/_ctypes/libffi/src/dlmalloc.c.'>ialloc</a>(ms, n_elements, &amp;sz, 3, chunks);
<a name='L4753'><font color='red'>}</font>
<a name='L4754'>
<a name='L4755'><b>void</b>** <a href='../S/2317.html#L1084' title='Refered from 1084 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace_independent_comalloc</a>(mspace msp, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> n_elements,
<a name='L4756'>                                   <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> sizes[], <b>void</b>* chunks[]) <font color='red'>{</font>
<a name='L4757'>  <a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a> ms = (<a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a>)msp;
<a name='L4758'>  <b>if</b> (!<a href='../D/10197.html' title='Multiple defined in 2 places.'>ok_magic</a>(ms)) <font color='red'>{</font>
<a name='L4759'>    <a href='../D/5379.html' title='Multiple defined in 2 places.'>USAGE_ERROR_ACTION</a>(ms,ms);
<a name='L4760'>    <b>return</b> 0;
<a name='L4761'>  <font color='red'>}</font>
<a name='L4762'>  <b>return</b> <a href='../S/2317.html#L3930' title='Defined at 3930 in Modules/_ctypes/libffi/src/dlmalloc.c.'>ialloc</a>(ms, n_elements, sizes, 0, chunks);
<a name='L4763'><font color='red'>}</font>
<a name='L4764'>
<a name='L4765'><b>int</b> <a href='../S/2317.html#L1118' title='Refered from 1118 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace_trim</a>(mspace msp, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> pad) <font color='red'>{</font>
<a name='L4766'>  <b>int</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = 0;
<a name='L4767'>  <a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a> ms = (<a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a>)msp;
<a name='L4768'>  <b>if</b> (<a href='../D/10197.html' title='Multiple defined in 2 places.'>ok_magic</a>(ms)) <font color='red'>{</font>
<a name='L4769'>    <b>if</b> (!<a href='../D/2519.html' title='Multiple defined in 2 places.'>PREACTION</a>(ms)) <font color='red'>{</font>
<a name='L4770'>      <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = <a href='../S/2317.html#L3593' title='Defined at 3593 in Modules/_ctypes/libffi/src/dlmalloc.c.'>sys_trim</a>(ms, <a href='../S/2828.html#L6780' title='Defined at 6780 in Objects/unicodeobject.c.'>pad</a>);
<a name='L4771'>      <a href='../D/2515.html' title='Multiple defined in 2 places.'>POSTACTION</a>(ms);
<a name='L4772'>    <font color='red'>}</font>
<a name='L4773'>  <font color='red'>}</font>
<a name='L4774'>  <b>else</b> <font color='red'>{</font>
<a name='L4775'>    <a href='../D/5379.html' title='Multiple defined in 2 places.'>USAGE_ERROR_ACTION</a>(ms,ms);
<a name='L4776'>  <font color='red'>}</font>
<a name='L4777'>  <b>return</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L4778'><font color='red'>}</font>
<a name='L4779'>
<a name='L4780'><b>void</b> <a href='../S/2317.html#L1112' title='Refered from 1112 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace_malloc_stats</a>(mspace msp) <font color='red'>{</font>
<a name='L4781'>  <a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a> ms = (<a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a>)msp;
<a name='L4782'>  <b>if</b> (<a href='../D/10197.html' title='Multiple defined in 2 places.'>ok_magic</a>(ms)) <font color='red'>{</font>
<a name='L4783'>    <a href='../S/2317.html#L2860' title='Defined at 2860 in Modules/_ctypes/libffi/src/dlmalloc.c.'>internal_malloc_stats</a>(ms);
<a name='L4784'>  <font color='red'>}</font>
<a name='L4785'>  <b>else</b> <font color='red'>{</font>
<a name='L4786'>    <a href='../D/5379.html' title='Multiple defined in 2 places.'>USAGE_ERROR_ACTION</a>(ms,ms);
<a name='L4787'>  <font color='red'>}</font>
<a name='L4788'><font color='red'>}</font>
<a name='L4789'>
<a name='L4790'><a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> <a href='../S/2317.html#L1091' title='Refered from 1091 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace_footprint</a>(mspace msp) <font color='red'>{</font>
<a name='L4791'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L4792'>  <a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a> ms = (<a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a>)msp;
<a name='L4793'>  <b>if</b> (<a href='../D/10197.html' title='Multiple defined in 2 places.'>ok_magic</a>(ms)) <font color='red'>{</font>
<a name='L4794'>    <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = ms-&gt;footprint;
<a name='L4795'>  <font color='red'>}</font>
<a name='L4796'>  <a href='../D/5379.html' title='Multiple defined in 2 places.'>USAGE_ERROR_ACTION</a>(ms,ms);
<a name='L4797'>  <b>return</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L4798'><font color='red'>}</font>
<a name='L4799'>
<a name='L4800'>
<a name='L4801'><a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> <a href='../S/2317.html#L1097' title='Refered from 1097 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace_max_footprint</a>(mspace msp) <font color='red'>{</font>
<a name='L4802'>  <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L4803'>  <a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a> ms = (<a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a>)msp;
<a name='L4804'>  <b>if</b> (<a href='../D/10197.html' title='Multiple defined in 2 places.'>ok_magic</a>(ms)) <font color='red'>{</font>
<a name='L4805'>    <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = ms-&gt;max_footprint;
<a name='L4806'>  <font color='red'>}</font>
<a name='L4807'>  <a href='../D/5379.html' title='Multiple defined in 2 places.'>USAGE_ERROR_ACTION</a>(ms,ms);
<a name='L4808'>  <b>return</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L4809'><font color='red'>}</font>
<a name='L4810'>
<a name='L4811'>
<a name='L4812'><font color='darkred'>#if</font> !<a href='../D/2331.html' title='Multiple defined in 2 places.'>NO_MALLINFO</a>
<a name='L4813'><b>struct</b> <a href='../S/2317.html#L617' title='Defined at 617 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mallinfo</a> <a href='../S/2317.html#L1105' title='Refered from 1105 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace_mallinfo</a>(mspace msp) <font color='red'>{</font>
<a name='L4814'>  <a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a> ms = (<a href='../S/2317.html#L2033' title='Defined at 2033 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mstate</a>)msp;
<a name='L4815'>  <b>if</b> (!<a href='../D/10197.html' title='Multiple defined in 2 places.'>ok_magic</a>(ms)) <font color='red'>{</font>
<a name='L4816'>    <a href='../D/5379.html' title='Multiple defined in 2 places.'>USAGE_ERROR_ACTION</a>(ms,ms);
<a name='L4817'>  <font color='red'>}</font>
<a name='L4818'>  <b>return</b> <a href='../S/2317.html#L2821' title='Defined at 2821 in Modules/_ctypes/libffi/src/dlmalloc.c.'>internal_mallinfo</a>(ms);
<a name='L4819'><font color='red'>}</font>
<a name='L4820'><font color='darkred'>#endif</font> <i><font color='green'>/* NO_MALLINFO */</font></i>
<a name='L4821'>
<a name='L4822'><b>int</b> <a href='../S/2317.html#L1123' title='Refered from 1123 in Modules/_ctypes/libffi/src/dlmalloc.c.'>mspace_mallopt</a>(<b>int</b> param_number, <b>int</b> value) <font color='red'>{</font>
<a name='L4823'>  <b>return</b> <a href='../S/2317.html#L2528' title='Defined at 2528 in Modules/_ctypes/libffi/src/dlmalloc.c.'>change_mparam</a>(param_number, <a href='../S/2252.html#L27' title='Defined at 27 in Modules/_ctypes/ctypes.h.'>value</a>);
<a name='L4824'><font color='red'>}</font>
<a name='L4825'>
<a name='L4826'><font color='darkred'>#endif</font> <i><font color='green'>/* MSPACES */</font></i>
<a name='L4827'>
<a name='L4828'><i><font color='green'>/* -------------------- Alternative MORECORE functions ------------------- */</font></i>
<a name='L4829'>
<a name='L4830'><i><font color='green'>/*</font></i>
<a name='L4831'><i><font color='green'>  Guidelines for creating a custom version of MORECORE:</font></i>
<a name='L4832'><i><font color='green'></font></i>
<a name='L4833'><i><font color='green'>  * For best performance, MORECORE should allocate in multiples of pagesize.</font></i>
<a name='L4834'><i><font color='green'>  * MORECORE may allocate more memory than requested. (Or even less,</font></i>
<a name='L4835'><i><font color='green'>      but this will usually result in a malloc failure.)</font></i>
<a name='L4836'><i><font color='green'>  * MORECORE must not allocate memory when given argument zero, but</font></i>
<a name='L4837'><i><font color='green'>      instead return one past the end address of memory from previous</font></i>
<a name='L4838'><i><font color='green'>      nonzero call.</font></i>
<a name='L4839'><i><font color='green'>  * For best performance, consecutive calls to MORECORE with positive</font></i>
<a name='L4840'><i><font color='green'>      arguments should return increasing addresses, indicating that</font></i>
<a name='L4841'><i><font color='green'>      space has been contiguously extended.</font></i>
<a name='L4842'><i><font color='green'>  * Even though consecutive calls to MORECORE need not return contiguous</font></i>
<a name='L4843'><i><font color='green'>      addresses, it must be OK for malloc'ed chunks to span multiple</font></i>
<a name='L4844'><i><font color='green'>      regions in those cases where they do happen to be contiguous.</font></i>
<a name='L4845'><i><font color='green'>  * MORECORE need not handle negative arguments -- it may instead</font></i>
<a name='L4846'><i><font color='green'>      just return MFAIL when given negative arguments.</font></i>
<a name='L4847'><i><font color='green'>      Negative arguments are always multiples of pagesize. MORECORE</font></i>
<a name='L4848'><i><font color='green'>      must not misinterpret negative args as large positive unsigned</font></i>
<a name='L4849'><i><font color='green'>      args. You can suppress all such calls from even occurring by defining</font></i>
<a name='L4850'><i><font color='green'>      MORECORE_CANNOT_TRIM,</font></i>
<a name='L4851'><i><font color='green'></font></i>
<a name='L4852'><i><font color='green'>  As an example alternative MORECORE, here is a custom allocator</font></i>
<a name='L4853'><i><font color='green'>  kindly contributed for pre-OSX macOS.  It uses virtually but not</font></i>
<a name='L4854'><i><font color='green'>  necessarily physically contiguous non-paged memory (locked in,</font></i>
<a name='L4855'><i><font color='green'>  present and won't get swapped out).  You can use it by uncommenting</font></i>
<a name='L4856'><i><font color='green'>  this section, adding some #includes, and setting up the appropriate</font></i>
<a name='L4857'><i><font color='green'>  defines above:</font></i>
<a name='L4858'><i><font color='green'></font></i>
<a name='L4859'><i><font color='green'>      #define MORECORE osMoreCore</font></i>
<a name='L4860'><i><font color='green'></font></i>
<a name='L4861'><i><font color='green'>  There is also a shutdown routine that should somehow be called for</font></i>
<a name='L4862'><i><font color='green'>  cleanup upon program exit.</font></i>
<a name='L4863'><i><font color='green'></font></i>
<a name='L4864'><i><font color='green'>  #define MAX_POOL_ENTRIES 100</font></i>
<a name='L4865'><i><font color='green'>  #define MINIMUM_MORECORE_SIZE  (64 * 1024U)</font></i>
<a name='L4866'><i><font color='green'>  static int next_os_pool;</font></i>
<a name='L4867'><i><font color='green'>  void *our_os_pools[MAX_POOL_ENTRIES];</font></i>
<a name='L4868'><i><font color='green'></font></i>
<a name='L4869'><i><font color='green'>  void *osMoreCore(int size)</font></i>
<a name='L4870'><i><font color='green'>  {</font></i>
<a name='L4871'><i><font color='green'>    void *ptr = 0;</font></i>
<a name='L4872'><i><font color='green'>    static void *sbrk_top = 0;</font></i>
<a name='L4873'><i><font color='green'></font></i>
<a name='L4874'><i><font color='green'>    if (size &gt; 0)</font></i>
<a name='L4875'><i><font color='green'>    {</font></i>
<a name='L4876'><i><font color='green'>      if (size &lt; MINIMUM_MORECORE_SIZE)</font></i>
<a name='L4877'><i><font color='green'>         size = MINIMUM_MORECORE_SIZE;</font></i>
<a name='L4878'><i><font color='green'>      if (CurrentExecutionLevel() == kTaskLevel)</font></i>
<a name='L4879'><i><font color='green'>         ptr = PoolAllocateResident(size + RM_PAGE_SIZE, 0);</font></i>
<a name='L4880'><i><font color='green'>      if (ptr == 0)</font></i>
<a name='L4881'><i><font color='green'>      {</font></i>
<a name='L4882'><i><font color='green'>        return (void *) MFAIL;</font></i>
<a name='L4883'><i><font color='green'>      }</font></i>
<a name='L4884'><i><font color='green'>      // save ptrs so they can be freed during cleanup</font></i>
<a name='L4885'><i><font color='green'>      our_os_pools[next_os_pool] = ptr;</font></i>
<a name='L4886'><i><font color='green'>      next_os_pool++;</font></i>
<a name='L4887'><i><font color='green'>      ptr = (void *) ((((size_t) ptr) + RM_PAGE_MASK) &amp; ~RM_PAGE_MASK);</font></i>
<a name='L4888'><i><font color='green'>      sbrk_top = (char *) ptr + size;</font></i>
<a name='L4889'><i><font color='green'>      return ptr;</font></i>
<a name='L4890'><i><font color='green'>    }</font></i>
<a name='L4891'><i><font color='green'>    else if (size &lt; 0)</font></i>
<a name='L4892'><i><font color='green'>    {</font></i>
<a name='L4893'><i><font color='green'>      // we don't currently support shrink behavior</font></i>
<a name='L4894'><i><font color='green'>      return (void *) MFAIL;</font></i>
<a name='L4895'><i><font color='green'>    }</font></i>
<a name='L4896'><i><font color='green'>    else</font></i>
<a name='L4897'><i><font color='green'>    {</font></i>
<a name='L4898'><i><font color='green'>      return sbrk_top;</font></i>
<a name='L4899'><i><font color='green'>    }</font></i>
<a name='L4900'><i><font color='green'>  }</font></i>
<a name='L4901'><i><font color='green'></font></i>
<a name='L4902'><i><font color='green'>  // cleanup any allocated memory pools</font></i>
<a name='L4903'><i><font color='green'>  // called as last thing before shutting down driver</font></i>
<a name='L4904'><i><font color='green'></font></i>
<a name='L4905'><i><font color='green'>  void osCleanupMem(void)</font></i>
<a name='L4906'><i><font color='green'>  {</font></i>
<a name='L4907'><i><font color='green'>    void **ptr;</font></i>
<a name='L4908'><i><font color='green'></font></i>
<a name='L4909'><i><font color='green'>    for (ptr = our_os_pools; ptr &lt; &amp;our_os_pools[MAX_POOL_ENTRIES]; ptr++)</font></i>
<a name='L4910'><i><font color='green'>      if (*ptr)</font></i>
<a name='L4911'><i><font color='green'>      {</font></i>
<a name='L4912'><i><font color='green'>         PoolDeallocate(*ptr);</font></i>
<a name='L4913'><i><font color='green'>         *ptr = 0;</font></i>
<a name='L4914'><i><font color='green'>      }</font></i>
<a name='L4915'><i><font color='green'>  }</font></i>
<a name='L4916'><i><font color='green'></font></i>
<a name='L4917'><i><font color='green'>*/</font></i>
<a name='L4918'>
<a name='L4919'>
<a name='L4920'><i><font color='green'>/* -----------------------------------------------------------------------</font></i>
<a name='L4921'><i><font color='green'>History:</font></i>
<a name='L4922'><i><font color='green'>    V2.8.3 Thu Sep 22 11:16:32 2005  Doug Lea  (dl at gee)</font></i>
<a name='L4923'><i><font color='green'>      * Add max_footprint functions</font></i>
<a name='L4924'><i><font color='green'>      * Ensure all appropriate literals are size_t</font></i>
<a name='L4925'><i><font color='green'>      * Fix conditional compilation problem for some #define settings</font></i>
<a name='L4926'><i><font color='green'>      * Avoid concatenating segments with the one provided</font></i>
<a name='L4927'><i><font color='green'>        in create_mspace_with_base</font></i>
<a name='L4928'><i><font color='green'>      * Rename some variables to avoid compiler shadowing warnings</font></i>
<a name='L4929'><i><font color='green'>      * Use explicit lock initialization.</font></i>
<a name='L4930'><i><font color='green'>      * Better handling of sbrk interference.</font></i>
<a name='L4931'><i><font color='green'>      * Simplify and fix segment insertion, trimming and mspace_destroy</font></i>
<a name='L4932'><i><font color='green'>      * Reinstate REALLOC_ZERO_BYTES_FREES option from 2.7.x</font></i>
<a name='L4933'><i><font color='green'>      * Thanks especially to Dennis Flanagan for help on these.</font></i>
<a name='L4934'><i><font color='green'></font></i>
<a name='L4935'><i><font color='green'>    V2.8.2 Sun Jun 12 16:01:10 2005  Doug Lea  (dl at gee)</font></i>
<a name='L4936'><i><font color='green'>      * Fix memalign brace error.</font></i>
<a name='L4937'><i><font color='green'></font></i>
<a name='L4938'><i><font color='green'>    V2.8.1 Wed Jun  8 16:11:46 2005  Doug Lea  (dl at gee)</font></i>
<a name='L4939'><i><font color='green'>      * Fix improper #endif nesting in C++</font></i>
<a name='L4940'><i><font color='green'>      * Add explicit casts needed for C++</font></i>
<a name='L4941'><i><font color='green'></font></i>
<a name='L4942'><i><font color='green'>    V2.8.0 Mon May 30 14:09:02 2005  Doug Lea  (dl at gee)</font></i>
<a name='L4943'><i><font color='green'>      * Use trees for large bins</font></i>
<a name='L4944'><i><font color='green'>      * Support mspaces</font></i>
<a name='L4945'><i><font color='green'>      * Use segments to unify sbrk-based and mmap-based system allocation,</font></i>
<a name='L4946'><i><font color='green'>        removing need for emulation on most platforms without sbrk.</font></i>
<a name='L4947'><i><font color='green'>      * Default safety checks</font></i>
<a name='L4948'><i><font color='green'>      * Optional footer checks. Thanks to William Robertson for the idea.</font></i>
<a name='L4949'><i><font color='green'>      * Internal code refactoring</font></i>
<a name='L4950'><i><font color='green'>      * Incorporate suggestions and platform-specific changes.</font></i>
<a name='L4951'><i><font color='green'>        Thanks to Dennis Flanagan, Colin Plumb, Niall Douglas,</font></i>
<a name='L4952'><i><font color='green'>        Aaron Bachmann,  Emery Berger, and others.</font></i>
<a name='L4953'><i><font color='green'>      * Speed up non-fastbin processing enough to remove fastbins.</font></i>
<a name='L4954'><i><font color='green'>      * Remove useless cfree() to avoid conflicts with other apps.</font></i>
<a name='L4955'><i><font color='green'>      * Remove internal memcpy, memset. Compilers handle builtins better.</font></i>
<a name='L4956'><i><font color='green'>      * Remove some options that no one ever used and rename others.</font></i>
<a name='L4957'><i><font color='green'></font></i>
<a name='L4958'><i><font color='green'>    V2.7.2 Sat Aug 17 09:07:30 2002  Doug Lea  (dl at gee)</font></i>
<a name='L4959'><i><font color='green'>      * Fix malloc_state bitmap array misdeclaration</font></i>
<a name='L4960'><i><font color='green'></font></i>
<a name='L4961'><i><font color='green'>    V2.7.1 Thu Jul 25 10:58:03 2002  Doug Lea  (dl at gee)</font></i>
<a name='L4962'><i><font color='green'>      * Allow tuning of FIRST_SORTED_BIN_SIZE</font></i>
<a name='L4963'><i><font color='green'>      * Use PTR_UINT as type for all ptr-&gt;int casts. Thanks to John Belmonte.</font></i>
<a name='L4964'><i><font color='green'>      * Better detection and support for non-contiguousness of MORECORE.</font></i>
<a name='L4965'><i><font color='green'>        Thanks to Andreas Mueller, Conal Walsh, and Wolfram Gloger</font></i>
<a name='L4966'><i><font color='green'>      * Bypass most of malloc if no frees. Thanks To Emery Berger.</font></i>
<a name='L4967'><i><font color='green'>      * Fix freeing of old top non-contiguous chunk im sysmalloc.</font></i>
<a name='L4968'><i><font color='green'>      * Raised default trim and map thresholds to 256K.</font></i>
<a name='L4969'><i><font color='green'>      * Fix mmap-related #defines. Thanks to Lubos Lunak.</font></i>
<a name='L4970'><i><font color='green'>      * Fix copy macros; added LACKS_FCNTL_H. Thanks to Neal Walfield.</font></i>
<a name='L4971'><i><font color='green'>      * Branch-free bin calculation</font></i>
<a name='L4972'><i><font color='green'>      * Default trim and mmap thresholds now 256K.</font></i>
<a name='L4973'><i><font color='green'></font></i>
<a name='L4974'><i><font color='green'>    V2.7.0 Sun Mar 11 14:14:06 2001  Doug Lea  (dl at gee)</font></i>
<a name='L4975'><i><font color='green'>      * Introduce independent_comalloc and independent_calloc.</font></i>
<a name='L4976'><i><font color='green'>        Thanks to Michael Pachos for motivation and help.</font></i>
<a name='L4977'><i><font color='green'>      * Make optional .h file available</font></i>
<a name='L4978'><i><font color='green'>      * Allow &gt; 2GB requests on 32bit systems.</font></i>
<a name='L4979'><i><font color='green'>      * new WIN32 sbrk, mmap, munmap, lock code from &lt;Walter@GeNeSys-e.de&gt;.</font></i>
<a name='L4980'><i><font color='green'>        Thanks also to Andreas Mueller &lt;a.mueller at paradatec.de&gt;,</font></i>
<a name='L4981'><i><font color='green'>        and Anonymous.</font></i>
<a name='L4982'><i><font color='green'>      * Allow override of MALLOC_ALIGNMENT (Thanks to Ruud Waij for</font></i>
<a name='L4983'><i><font color='green'>        helping test this.)</font></i>
<a name='L4984'><i><font color='green'>      * memalign: check alignment arg</font></i>
<a name='L4985'><i><font color='green'>      * realloc: don't try to shift chunks backwards, since this</font></i>
<a name='L4986'><i><font color='green'>        leads to  more fragmentation in some programs and doesn't</font></i>
<a name='L4987'><i><font color='green'>        seem to help in any others.</font></i>
<a name='L4988'><i><font color='green'>      * Collect all cases in malloc requiring system memory into sysmalloc</font></i>
<a name='L4989'><i><font color='green'>      * Use mmap as backup to sbrk</font></i>
<a name='L4990'><i><font color='green'>      * Place all internal state in malloc_state</font></i>
<a name='L4991'><i><font color='green'>      * Introduce fastbins (although similar to 2.5.1)</font></i>
<a name='L4992'><i><font color='green'>      * Many minor tunings and cosmetic improvements</font></i>
<a name='L4993'><i><font color='green'>      * Introduce USE_PUBLIC_MALLOC_WRAPPERS, USE_MALLOC_LOCK</font></i>
<a name='L4994'><i><font color='green'>      * Introduce MALLOC_FAILURE_ACTION, MORECORE_CONTIGUOUS</font></i>
<a name='L4995'><i><font color='green'>        Thanks to Tony E. Bennett &lt;tbennett@nvidia.com&gt; and others.</font></i>
<a name='L4996'><i><font color='green'>      * Include errno.h to support default failure action.</font></i>
<a name='L4997'><i><font color='green'></font></i>
<a name='L4998'><i><font color='green'>    V2.6.6 Sun Dec  5 07:42:19 1999  Doug Lea  (dl at gee)</font></i>
<a name='L4999'><i><font color='green'>      * return null for negative arguments</font></i>
<a name='L5000'><i><font color='green'>      * Added Several WIN32 cleanups from Martin C. Fong &lt;mcfong at yahoo.com&gt;</font></i>
<a name='L5001'><i><font color='green'>         * Add 'LACKS_SYS_PARAM_H' for those systems without 'sys/param.h'</font></i>
<a name='L5002'><i><font color='green'>          (e.g. WIN32 platforms)</font></i>
<a name='L5003'><i><font color='green'>         * Cleanup header file inclusion for WIN32 platforms</font></i>
<a name='L5004'><i><font color='green'>         * Cleanup code to avoid Microsoft Visual C++ compiler complaints</font></i>
<a name='L5005'><i><font color='green'>         * Add 'USE_DL_PREFIX' to quickly allow co-existence with existing</font></i>
<a name='L5006'><i><font color='green'>           memory allocation routines</font></i>
<a name='L5007'><i><font color='green'>         * Set 'malloc_getpagesize' for WIN32 platforms (needs more work)</font></i>
<a name='L5008'><i><font color='green'>         * Use 'assert' rather than 'ASSERT' in WIN32 code to conform to</font></i>
<a name='L5009'><i><font color='green'>           usage of 'assert' in non-WIN32 code</font></i>
<a name='L5010'><i><font color='green'>         * Improve WIN32 'sbrk()' emulation's 'findRegion()' routine to</font></i>
<a name='L5011'><i><font color='green'>           avoid infinite loop</font></i>
<a name='L5012'><i><font color='green'>      * Always call 'fREe()' rather than 'free()'</font></i>
<a name='L5013'><i><font color='green'></font></i>
<a name='L5014'><i><font color='green'>    V2.6.5 Wed Jun 17 15:57:31 1998  Doug Lea  (dl at gee)</font></i>
<a name='L5015'><i><font color='green'>      * Fixed ordering problem with boundary-stamping</font></i>
<a name='L5016'><i><font color='green'></font></i>
<a name='L5017'><i><font color='green'>    V2.6.3 Sun May 19 08:17:58 1996  Doug Lea  (dl at gee)</font></i>
<a name='L5018'><i><font color='green'>      * Added pvalloc, as recommended by H.J. Liu</font></i>
<a name='L5019'><i><font color='green'>      * Added 64bit pointer support mainly from Wolfram Gloger</font></i>
<a name='L5020'><i><font color='green'>      * Added anonymously donated WIN32 sbrk emulation</font></i>
<a name='L5021'><i><font color='green'>      * Malloc, calloc, getpagesize: add optimizations from Raymond Nijssen</font></i>
<a name='L5022'><i><font color='green'>      * malloc_extend_top: fix mask error that caused wastage after</font></i>
<a name='L5023'><i><font color='green'>        foreign sbrks</font></i>
<a name='L5024'><i><font color='green'>      * Add linux mremap support code from HJ Liu</font></i>
<a name='L5025'><i><font color='green'></font></i>
<a name='L5026'><i><font color='green'>    V2.6.2 Tue Dec  5 06:52:55 1995  Doug Lea  (dl at gee)</font></i>
<a name='L5027'><i><font color='green'>      * Integrated most documentation with the code.</font></i>
<a name='L5028'><i><font color='green'>      * Add support for mmap, with help from</font></i>
<a name='L5029'><i><font color='green'>        Wolfram Gloger (Gloger@lrz.uni-muenchen.de).</font></i>
<a name='L5030'><i><font color='green'>      * Use last_remainder in more cases.</font></i>
<a name='L5031'><i><font color='green'>      * Pack bins using idea from  colin@nyx10.cs.du.edu</font></i>
<a name='L5032'><i><font color='green'>      * Use ordered bins instead of best-fit threshhold</font></i>
<a name='L5033'><i><font color='green'>      * Eliminate block-local decls to simplify tracing and debugging.</font></i>
<a name='L5034'><i><font color='green'>      * Support another case of realloc via move into top</font></i>
<a name='L5035'><i><font color='green'>      * Fix error occuring when initial sbrk_base not word-aligned.</font></i>
<a name='L5036'><i><font color='green'>      * Rely on page size for units instead of SBRK_UNIT to</font></i>
<a name='L5037'><i><font color='green'>        avoid surprises about sbrk alignment conventions.</font></i>
<a name='L5038'><i><font color='green'>      * Add mallinfo, mallopt. Thanks to Raymond Nijssen</font></i>
<a name='L5039'><i><font color='green'>        (raymond@es.ele.tue.nl) for the suggestion.</font></i>
<a name='L5040'><i><font color='green'>      * Add `pad' argument to malloc_trim and top_pad mallopt parameter.</font></i>
<a name='L5041'><i><font color='green'>      * More precautions for cases where other routines call sbrk,</font></i>
<a name='L5042'><i><font color='green'>        courtesy of Wolfram Gloger (Gloger@lrz.uni-muenchen.de).</font></i>
<a name='L5043'><i><font color='green'>      * Added macros etc., allowing use in linux libc from</font></i>
<a name='L5044'><i><font color='green'>        H.J. Lu (hjl@gnu.ai.mit.edu)</font></i>
<a name='L5045'><i><font color='green'>      * Inverted this history list</font></i>
<a name='L5046'><i><font color='green'></font></i>
<a name='L5047'><i><font color='green'>    V2.6.1 Sat Dec  2 14:10:57 1995  Doug Lea  (dl at gee)</font></i>
<a name='L5048'><i><font color='green'>      * Re-tuned and fixed to behave more nicely with V2.6.0 changes.</font></i>
<a name='L5049'><i><font color='green'>      * Removed all preallocation code since under current scheme</font></i>
<a name='L5050'><i><font color='green'>        the work required to undo bad preallocations exceeds</font></i>
<a name='L5051'><i><font color='green'>        the work saved in good cases for most test programs.</font></i>
<a name='L5052'><i><font color='green'>      * No longer use return list or unconsolidated bins since</font></i>
<a name='L5053'><i><font color='green'>        no scheme using them consistently outperforms those that don't</font></i>
<a name='L5054'><i><font color='green'>        given above changes.</font></i>
<a name='L5055'><i><font color='green'>      * Use best fit for very large chunks to prevent some worst-cases.</font></i>
<a name='L5056'><i><font color='green'>      * Added some support for debugging</font></i>
<a name='L5057'><i><font color='green'></font></i>
<a name='L5058'><i><font color='green'>    V2.6.0 Sat Nov  4 07:05:23 1995  Doug Lea  (dl at gee)</font></i>
<a name='L5059'><i><font color='green'>      * Removed footers when chunks are in use. Thanks to</font></i>
<a name='L5060'><i><font color='green'>        Paul Wilson (wilson@cs.texas.edu) for the suggestion.</font></i>
<a name='L5061'><i><font color='green'></font></i>
<a name='L5062'><i><font color='green'>    V2.5.4 Wed Nov  1 07:54:51 1995  Doug Lea  (dl at gee)</font></i>
<a name='L5063'><i><font color='green'>      * Added malloc_trim, with help from Wolfram Gloger</font></i>
<a name='L5064'><i><font color='green'>        (wmglo@Dent.MED.Uni-Muenchen.DE).</font></i>
<a name='L5065'><i><font color='green'></font></i>
<a name='L5066'><i><font color='green'>    V2.5.3 Tue Apr 26 10:16:01 1994  Doug Lea  (dl at g)</font></i>
<a name='L5067'><i><font color='green'></font></i>
<a name='L5068'><i><font color='green'>    V2.5.2 Tue Apr  5 16:20:40 1994  Doug Lea  (dl at g)</font></i>
<a name='L5069'><i><font color='green'>      * realloc: try to expand in both directions</font></i>
<a name='L5070'><i><font color='green'>      * malloc: swap order of clean-bin strategy;</font></i>
<a name='L5071'><i><font color='green'>      * realloc: only conditionally expand backwards</font></i>
<a name='L5072'><i><font color='green'>      * Try not to scavenge used bins</font></i>
<a name='L5073'><i><font color='green'>      * Use bin counts as a guide to preallocation</font></i>
<a name='L5074'><i><font color='green'>      * Occasionally bin return list chunks in first scan</font></i>
<a name='L5075'><i><font color='green'>      * Add a few optimizations from colin@nyx10.cs.du.edu</font></i>
<a name='L5076'><i><font color='green'></font></i>
<a name='L5077'><i><font color='green'>    V2.5.1 Sat Aug 14 15:40:43 1993  Doug Lea  (dl at g)</font></i>
<a name='L5078'><i><font color='green'>      * faster bin computation &amp; slightly different binning</font></i>
<a name='L5079'><i><font color='green'>      * merged all consolidations to one part of malloc proper</font></i>
<a name='L5080'><i><font color='green'>         (eliminating old malloc_find_space &amp; malloc_clean_bin)</font></i>
<a name='L5081'><i><font color='green'>      * Scan 2 returns chunks (not just 1)</font></i>
<a name='L5082'><i><font color='green'>      * Propagate failure in realloc if malloc returns 0</font></i>
<a name='L5083'><i><font color='green'>      * Add stuff to allow compilation on non-ANSI compilers</font></i>
<a name='L5084'><i><font color='green'>          from kpv@research.att.com</font></i>
<a name='L5085'><i><font color='green'></font></i>
<a name='L5086'><i><font color='green'>    V2.5 Sat Aug  7 07:41:59 1993  Doug Lea  (dl at g.oswego.edu)</font></i>
<a name='L5087'><i><font color='green'>      * removed potential for odd address access in prev_chunk</font></i>
<a name='L5088'><i><font color='green'>      * removed dependency on getpagesize.h</font></i>
<a name='L5089'><i><font color='green'>      * misc cosmetics and a bit more internal documentation</font></i>
<a name='L5090'><i><font color='green'>      * anticosmetics: mangled names in macros to evade debugger strangeness</font></i>
<a name='L5091'><i><font color='green'>      * tested on sparc, hp-700, dec-mips, rs6000</font></i>
<a name='L5092'><i><font color='green'>          with gcc &amp; native cc (hp, dec only) allowing</font></i>
<a name='L5093'><i><font color='green'>          Detlefs &amp; Zorn comparison study (in SIGPLAN Notices.)</font></i>
<a name='L5094'><i><font color='green'></font></i>
<a name='L5095'><i><font color='green'>    Trial version Fri Aug 28 13:14:29 1992  Doug Lea  (dl at g.oswego.edu)</font></i>
<a name='L5096'><i><font color='green'>      * Based loosely on libg++-1.2X malloc. (It retains some of the overall</font></i>
<a name='L5097'><i><font color='green'>         structure of old version,  but most details differ.)</font></i>
<a name='L5098'><i><font color='green'> </font></i>
<a name='L5099'><i><font color='green'>*/</font></i>
</pre>
<hr>
<a name='BOTTOM'>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L1317'>[^]</a><a href='#L4822'>[v]</a><a href='#TOP'>[top]</a>[bottom]<a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
</body>
</html>
