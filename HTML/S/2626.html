<html>
<head>
<title>Modules/bz2module.c</title>
<meta name='robots' content='noindex,nofollow'>
<meta name='generator' content='GLOBAL-5.8.1'>
</head>
<body text='#191970' bgcolor='#f5f5dc' vlink='gray'>
<a name='TOP'><h2><a href='../mains.html'>root</a>/<a href='../files/3353.html'>Modules</a>/bz2module.c</h2>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L145'>[^]</a><a href='#L2154'>[v]</a>[top]<a href='#BOTTOM'>[bottom]</a><a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
<hr>
<h2>DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href='#L145' title='Defined at 145.'>check_iterbuffered</a>
<li><a href='#L158' title='Defined at 158.'>Util_CatchBZ2Error</a>
<li><a href='#L229' title='Defined at 229.'>Util_NewBufferSize</a>
<li><a href='#L244' title='Defined at 244.'>Util_GetLine</a>
<li><a href='#L314' title='Defined at 314.'>Util_DropReadAhead</a>
<li><a href='#L324' title='Defined at 324.'>Util_ReadAhead</a>
<li><a href='#L364' title='Defined at 364.'>Util_ReadAheadGetLineSkip</a>
<li><a href='#L419' title='Defined at 419.'>BZ2File_read</a>
<li><a href='#L514' title='Defined at 514.'>BZ2File_readline</a>
<li><a href='#L563' title='Defined at 563.'>BZ2File_readlines</a>
<li><a href='#L724' title='Defined at 724.'>BZ2File_write</a>
<li><a href='#L782' title='Defined at 782.'>BZ2File_writelines</a>
<li><a href='#L918' title='Defined at 918.'>BZ2File_seek</a>
<li><a href='#L1058' title='Defined at 1058.'>BZ2File_tell</a>
<li><a href='#L1087' title='Defined at 1087.'>BZ2File_close</a>
<li><a href='#L1126' title='Defined at 1126.'>BZ2File_enter</a>
<li><a href='#L1141' title='Defined at 1141.'>BZ2File_exit</a>
<li><a href='#L1173' title='Defined at 1173.'>BZ2File_get_closed</a>
<li><a href='#L1189' title='Defined at 1189.'>BZ2File_init</a>
<li><a href='#L1299' title='Defined at 1299.'>BZ2File_dealloc</a>
<li><a href='#L1324' title='Defined at 1324.'>BZ2File_getiter</a>
<li><a href='#L1338' title='Defined at 1338.'>BZ2File_iternext</a>
<li><a href='#L1429' title='Defined at 1429.'>BZ2Comp_compress</a>
<li><a href='#L1513' title='Defined at 1513.'>BZ2Comp_flush</a>
<li><a href='#L1587' title='Defined at 1587.'>BZ2Comp_init</a>
<li><a href='#L1632' title='Defined at 1632.'>BZ2Comp_dealloc</a>
<li><a href='#L1725' title='Defined at 1725.'>BZ2Decomp_decompress</a>
<li><a href='#L1819' title='Defined at 1819.'>BZ2Decomp_init</a>
<li><a href='#L1861' title='Defined at 1861.'>BZ2Decomp_dealloc</a>
<li><a href='#L1940' title='Defined at 1940.'>bz2_compress</a>
<li><a href='#L2036' title='Defined at 2036.'>bz2_decompress</a>
<li><a href='#L2154' title='Defined at 2154.'>PyInit_bz2</a>
</ol>
<hr>
<pre>
<a name='L1'><i><font color='green'>/*</font></i>
<a name='L2'><i><font color='green'></font></i>
<a name='L3'><i><font color='green'>python-bz2 - python bz2 library interface</font></i>
<a name='L4'><i><font color='green'></font></i>
<a name='L5'><i><font color='green'>Copyright (c) 2002  Gustavo Niemeyer &lt;niemeyer@conectiva.com&gt;</font></i>
<a name='L6'><i><font color='green'>Copyright (c) 2002  Python Software Foundation; All Rights Reserved</font></i>
<a name='L7'><i><font color='green'></font></i>
<a name='L8'><i><font color='green'>*/</font></i>
<a name='L9'>
<a name='L10'><font color='darkred'>#include</font> "<a href='570.html'>Python.h</a>"
<a name='L11'><font color='darkred'>#include</font> &lt;stdio.h&gt;
<a name='L12'><font color='darkred'>#include</font> &lt;bzlib.h&gt;
<a name='L13'><font color='darkred'>#include</font> "<a href='577.html'>structmember.h</a>"
<a name='L14'>
<a name='L15'><font color='darkred'>#ifdef</font> <a href='../D/5537.html' title='Multiple defined in 3 places.'>WITH_THREAD</a>
<a name='L16'><font color='darkred'>#include</font> "<a href='572.html'>pythread.h</a>"
<a name='L17'><font color='darkred'>#endif</font>
<a name='L18'>
<a name='L19'><b>static</b> <b>char</b> __author__[] =
<a name='L20'>"The bz2 python module was written by:\n\
<a name='L21'>\n\
<a name='L22'>    Gustavo Niemeyer &lt;niemeyer@conectiva.com&gt;\n\
<a name='L23'>";
<a name='L24'>
<a name='L25'><i><font color='green'>/* Our very own off_t-like type, 64-bit if possible */</font></i>
<a name='L26'><i><font color='green'>/* copied from Objects/fileobject.c */</font></i>
<a name='L27'><font color='darkred'>#if</font> !<b>defined</b>(<a href='../D/1522.html' title='Multiple defined in 4 places.'>HAVE_LARGEFILE_SUPPORT</a>)
<a name='L28'><b>typedef</b> <a href='../D/10193.html' title='Multiple defined in 2 places.'>off_t</a> <a href='../R/3862.html' title='Multiple refered from 48 places.'>Py_off_t</a>;
<a name='L29'><font color='darkred'>#elif</font> <a href='../D/4737.html' title='Multiple defined in 3 places.'>SIZEOF_OFF_T</a> &gt;= 8
<a name='L30'><b>typedef</b> <a href='../D/10193.html' title='Multiple defined in 2 places.'>off_t</a> <a href='../R/3862.html' title='Multiple refered from 48 places.'>Py_off_t</a>;
<a name='L31'><font color='darkred'>#elif</font> <a href='../D/4729.html' title='Multiple defined in 2 places.'>SIZEOF_FPOS_T</a> &gt;= 8
<a name='L32'><b>typedef</b> fpos_t <a href='../R/3862.html' title='Multiple refered from 48 places.'>Py_off_t</a>;
<a name='L33'><font color='darkred'>#else</font>
<a name='L34'><font color='darkred'>#error</font> "Large file support, but neither off_t nor fpos_t is large enough."
<a name='L35'><font color='darkred'>#endif</font>
<a name='L36'>
<a name='L37'><font color='darkred'>#define</font> <a href='../R/326.html' title='Multiple refered from 22 places.'>BUF</a>(v) PyBytes_AS_STRING(v)
<a name='L38'>
<a name='L39'><font color='darkred'>#define</font> <a href='../R/1954.html' title='Multiple refered from 13 places.'>MODE_CLOSED</a>   0
<a name='L40'><font color='darkred'>#define</font> <a href='../R/1955.html' title='Multiple refered from 8 places.'>MODE_READ</a>     1
<a name='L41'><font color='darkred'>#define</font> <a href='../R/1956.html' title='Multiple refered from 15 places.'>MODE_READ_EOF</a> 2
<a name='L42'><font color='darkred'>#define</font> <a href='../R/1957.html' title='Multiple refered from 5 places.'>MODE_WRITE</a>    3
<a name='L43'>
<a name='L44'><font color='darkred'>#define</font> BZ2FileObject_Check(v)  (<a href='../D/4259.html' title='Multiple defined in 5 places.'>Py_TYPE</a>(v) == &amp;BZ2File_Type)
<a name='L45'>
<a name='L46'>
<a name='L47'><font color='darkred'>#ifdef</font> BZ_CONFIG_ERROR
<a name='L48'>
<a name='L49'><font color='darkred'>#if</font> <a href='../D/4734.html' title='Multiple defined in 7 places.'>SIZEOF_LONG</a> &gt;= 8
<a name='L50'><font color='darkred'>#define</font> <a href='../R/383.html' title='Multiple refered from 13 places.'>BZS_TOTAL_OUT</a>(bzs) \
<a name='L51'>    (((<b>long</b>)bzs-&gt;total_out_hi32 &lt;&lt; 32) + bzs-&gt;total_out_lo32)
<a name='L52'><font color='darkred'>#elif</font> <a href='../D/4736.html' title='Multiple defined in 2 places.'>SIZEOF_LONG_LONG</a> &gt;= 8
<a name='L53'><font color='darkred'>#define</font> <a href='../R/383.html' title='Multiple refered from 13 places.'>BZS_TOTAL_OUT</a>(bzs) \
<a name='L54'>    (((<a href='../D/2608.html' title='Multiple defined in 3 places.'>PY_LONG_LONG</a>)bzs-&gt;total_out_hi32 &lt;&lt; 32) + bzs-&gt;total_out_lo32)
<a name='L55'><font color='darkred'>#else</font>
<a name='L56'><font color='darkred'>#define</font> <a href='../R/383.html' title='Multiple refered from 13 places.'>BZS_TOTAL_OUT</a>(bzs) \
<a name='L57'>    bzs-&gt;total_out_lo32
<a name='L58'><font color='darkred'>#endif</font>
<a name='L59'>
<a name='L60'><font color='darkred'>#else</font> <i><font color='green'>/* ! BZ_CONFIG_ERROR */</font></i>
<a name='L61'>
<a name='L62'><font color='darkred'>#define</font> <a href='../R/377.html' title='Multiple refered from 6 places.'>BZ2_bzRead</a> bzRead
<a name='L63'><font color='darkred'>#define</font> <a href='../R/379.html' title='Multiple refered from 2 places.'>BZ2_bzReadOpen</a> bzReadOpen
<a name='L64'><font color='darkred'>#define</font> <a href='../R/378.html' title='Multiple refered from 3 places.'>BZ2_bzReadClose</a> bzReadClose
<a name='L65'><font color='darkred'>#define</font> <a href='../R/380.html' title='Multiple refered from 2 places.'>BZ2_bzWrite</a> bzWrite
<a name='L66'><font color='darkred'>#define</font> <a href='../S/2626.html#L1274' title='Refered from 1274 in Modules/bz2module.c.'>BZ2_bzWriteOpen</a> bzWriteOpen
<a name='L67'><font color='darkred'>#define</font> <a href='../R/381.html' title='Multiple refered from 2 places.'>BZ2_bzWriteClose</a> bzWriteClose
<a name='L68'><font color='darkred'>#define</font> <a href='../R/371.html' title='Multiple refered from 3 places.'>BZ2_bzCompress</a> bzCompress
<a name='L69'><font color='darkred'>#define</font> <a href='../R/373.html' title='Multiple refered from 2 places.'>BZ2_bzCompressInit</a> bzCompressInit
<a name='L70'><font color='darkred'>#define</font> <a href='../R/372.html' title='Multiple refered from 5 places.'>BZ2_bzCompressEnd</a> bzCompressEnd
<a name='L71'><font color='darkred'>#define</font> <a href='../R/374.html' title='Multiple refered from 2 places.'>BZ2_bzDecompress</a> bzDecompress
<a name='L72'><font color='darkred'>#define</font> <a href='../R/376.html' title='Multiple refered from 2 places.'>BZ2_bzDecompressInit</a> bzDecompressInit
<a name='L73'><font color='darkred'>#define</font> <a href='../R/375.html' title='Multiple refered from 6 places.'>BZ2_bzDecompressEnd</a> bzDecompressEnd
<a name='L74'>
<a name='L75'><font color='darkred'>#define</font> <a href='../R/383.html' title='Multiple refered from 13 places.'>BZS_TOTAL_OUT</a>(bzs) bzs-&gt;total_out
<a name='L76'>
<a name='L77'><font color='darkred'>#endif</font> <i><font color='green'>/* ! BZ_CONFIG_ERROR */</font></i>
<a name='L78'>
<a name='L79'>
<a name='L80'><font color='darkred'>#ifdef</font> <a href='../D/5537.html' title='Multiple defined in 3 places.'>WITH_THREAD</a>
<a name='L81'><font color='darkred'>#define</font> <a href='../R/11.html' title='Multiple refered from 14 places.'>ACQUIRE_LOCK</a>(obj) <b>do</b> <font color='red'>{</font> \
<a name='L82'>    <b>if</b> (!<a href='../D/3846.html' title='Multiple defined in 10 places.'>PyThread_acquire_lock</a>(obj-&gt;<a href='../S/3148.html#L9' title='Defined at 9 in Python/thread_lwp.h.'>lock</a>, 0)) <font color='red'>{</font> \
<a name='L83'>        <a href='../D/4080.html' title='Multiple defined in 2 places.'>Py_BEGIN_ALLOW_THREADS</a> \
<a name='L84'>        <a href='../D/3846.html' title='Multiple defined in 10 places.'>PyThread_acquire_lock</a>(obj-&gt;<a href='../S/3148.html#L9' title='Defined at 9 in Python/thread_lwp.h.'>lock</a>, 1); \
<a name='L85'>        <a href='../D/4114.html' title='Multiple defined in 2 places.'>Py_END_ALLOW_THREADS</a> \
<a name='L86'>    <font color='red'>}</font> <font color='red'>}</font> <b>while</b>(0)
<a name='L87'><font color='darkred'>#define</font> <a href='../R/3936.html' title='Multiple refered from 18 places.'>RELEASE_LOCK</a>(obj) <a href='../D/3858.html' title='Multiple defined in 11 places.'>PyThread_release_lock</a>(obj-&gt;<a href='../S/3148.html#L9' title='Defined at 9 in Python/thread_lwp.h.'>lock</a>)
<a name='L88'><font color='darkred'>#else</font>
<a name='L89'><font color='darkred'>#define</font> <a href='../R/11.html' title='Multiple refered from 14 places.'>ACQUIRE_LOCK</a>(obj)
<a name='L90'><font color='darkred'>#define</font> <a href='../R/3936.html' title='Multiple refered from 18 places.'>RELEASE_LOCK</a>(obj)
<a name='L91'><font color='darkred'>#endif</font>
<a name='L92'>
<a name='L93'><i><font color='green'>/* Bits in f_newlinetypes */</font></i>
<a name='L94'><font color='darkred'>#define</font> NEWLINE_UNKNOWN 0       <i><font color='green'>/* No newline seen, yet */</font></i>
<a name='L95'><font color='darkred'>#define</font> <a href='../R/2069.html' title='Multiple refered from 2 places.'>NEWLINE_CR</a> 1            <i><font color='green'>/* \r newline seen */</font></i>
<a name='L96'><font color='darkred'>#define</font> <a href='../S/2790.html#L295' title='Refered from 295 in Objects/fileobject.c.'>NEWLINE_LF</a> 2            <i><font color='green'>/* \n newline seen */</font></i>
<a name='L97'><font color='darkred'>#define</font> <a href='../S/2790.html#L275' title='Refered from 275 in Objects/fileobject.c.'>NEWLINE_CRLF</a> 4          <i><font color='green'>/* \r\n newline seen */</font></i>
<a name='L98'>
<a name='L99'><i><font color='green'>/* ===================================================================== */</font></i>
<a name='L100'><i><font color='green'>/* Structure definitions. */</font></i>
<a name='L101'>
<a name='L102'><b>typedef</b> <b>struct</b> <font color='red'>{</font>
<a name='L103'>    <a href='../S/544.html#L82' title='Defined at 82 in Include/object.h.'>PyObject_HEAD</a>
<a name='L104'>    FILE *rawfp;
<a name='L105'>
<a name='L106'>    <b>char</b>* f_buf;                <i><font color='green'>/* Allocated readahead buffer */</font></i>
<a name='L107'>    <b>char</b>* f_bufend;             <i><font color='green'>/* Points after last occupied position */</font></i>
<a name='L108'>    <b>char</b>* f_bufptr;             <i><font color='green'>/* Current buffer position */</font></i>
<a name='L109'>
<a name='L110'>    BZFILE *fp;
<a name='L111'>    <b>int</b> mode;
<a name='L112'>    <a href='../D/4353.html' title='Multiple defined in 3 places.'>Py_off_t</a> pos;
<a name='L113'>    <a href='../D/4353.html' title='Multiple defined in 3 places.'>Py_off_t</a> size;
<a name='L114'><font color='darkred'>#ifdef</font> <a href='../D/5537.html' title='Multiple defined in 3 places.'>WITH_THREAD</a>
<a name='L115'>    <a href='../S/572.html#L5' title='Defined at 5 in Include/pythread.h.'>PyThread_type_lock</a> <a href='../S/3148.html#L9' title='Defined at 9 in Python/thread_lwp.h.'>lock</a>;
<a name='L116'><font color='darkred'>#endif</font>
<a name='L117'><font color='red'>}</font> <a href='../S/2626.html#L1375' title='Refered from 1375 in Modules/bz2module.c.'>BZ2FileObject</a>;
<a name='L118'>
<a name='L119'><b>typedef</b> <b>struct</b> <font color='red'>{</font>
<a name='L120'>    <a href='../S/544.html#L82' title='Defined at 82 in Include/object.h.'>PyObject_HEAD</a>
<a name='L121'>    bz_stream bzs;
<a name='L122'>    <b>int</b> running;
<a name='L123'><font color='darkred'>#ifdef</font> <a href='../D/5537.html' title='Multiple defined in 3 places.'>WITH_THREAD</a>
<a name='L124'>    <a href='../S/572.html#L5' title='Defined at 5 in Include/pythread.h.'>PyThread_type_lock</a> <a href='../S/3148.html#L9' title='Defined at 9 in Python/thread_lwp.h.'>lock</a>;
<a name='L125'><font color='darkred'>#endif</font>
<a name='L126'><font color='red'>}</font> <a href='../S/2626.html#L1658' title='Refered from 1658 in Modules/bz2module.c.'>BZ2CompObject</a>;
<a name='L127'>
<a name='L128'><b>typedef</b> <b>struct</b> <font color='red'>{</font>
<a name='L129'>    <a href='../S/544.html#L82' title='Defined at 82 in Include/object.h.'>PyObject_HEAD</a>
<a name='L130'>    bz_stream bzs;
<a name='L131'>    <b>int</b> running;
<a name='L132'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *unused_data;
<a name='L133'><font color='darkred'>#ifdef</font> <a href='../D/5537.html' title='Multiple defined in 3 places.'>WITH_THREAD</a>
<a name='L134'>    <a href='../S/572.html#L5' title='Defined at 5 in Include/pythread.h.'>PyThread_type_lock</a> <a href='../S/3148.html#L9' title='Defined at 9 in Python/thread_lwp.h.'>lock</a>;
<a name='L135'><font color='darkred'>#endif</font>
<a name='L136'><font color='red'>}</font> <a href='../R/351.html' title='Multiple refered from 2 places.'>BZ2DecompObject</a>;
<a name='L137'>
<a name='L138'><i><font color='green'>/* ===================================================================== */</font></i>
<a name='L139'><i><font color='green'>/* Utility functions. */</font></i>
<a name='L140'>
<a name='L141'><i><font color='green'>/* Refuse regular I/O if there's data in the iteration-buffer.</font></i>
<a name='L142'><i><font color='green'> * Mixing them would cause data to arrive out of order, as the read*</font></i>
<a name='L143'><i><font color='green'> * methods don't use the iteration buffer. */</font></i>
<a name='L144'><b>static</b> <b>int</b>
<a name='L145'><a href='../R/6634.html' title='Multiple refered from 3 places.'>check_iterbuffered</a>(BZ2FileObject *f)
<a name='L146'><font color='red'>{</font>
<a name='L147'>    <b>if</b> (f-&gt;f_buf != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp;
<a name='L148'>        (f-&gt;f_bufend - f-&gt;f_bufptr) &gt; 0 &amp;&amp;
<a name='L149'>        f-&gt;f_buf[0] != '\0') <font color='red'>{</font>
<a name='L150'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError,
<a name='L151'>            "Mixing iteration and read methods would lose data");
<a name='L152'>        <b>return</b> -1;
<a name='L153'>    <font color='red'>}</font>
<a name='L154'>    <b>return</b> 0;
<a name='L155'><font color='red'>}</font>
<a name='L156'>
<a name='L157'><b>static</b> <b>int</b>
<a name='L158'><a href='../R/4834.html' title='Multiple refered from 21 places.'>Util_CatchBZ2Error</a>(<b>int</b> bzerror)
<a name='L159'><font color='red'>{</font>
<a name='L160'>    <b>int</b> ret = 0;
<a name='L161'>    <b>switch</b>(bzerror) <font color='red'>{</font>
<a name='L162'>        <b>case</b> BZ_OK:
<a name='L163'>        <b>case</b> BZ_STREAM_END:
<a name='L164'>            <b>break</b>;
<a name='L165'>
<a name='L166'><font color='darkred'>#ifdef</font> BZ_CONFIG_ERROR
<a name='L167'>        <b>case</b> BZ_CONFIG_ERROR:
<a name='L168'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_SystemError,
<a name='L169'>                            "the bz2 library was not compiled "
<a name='L170'>                            "correctly");
<a name='L171'>            ret = 1;
<a name='L172'>            <b>break</b>;
<a name='L173'><font color='darkred'>#endif</font>
<a name='L174'>
<a name='L175'>        <b>case</b> BZ_PARAM_ERROR:
<a name='L176'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError,
<a name='L177'>                            "the bz2 library has received wrong "
<a name='L178'>                            "parameters");
<a name='L179'>            ret = 1;
<a name='L180'>            <b>break</b>;
<a name='L181'>
<a name='L182'>        <b>case</b> BZ_MEM_ERROR:
<a name='L183'>            <a href='../S/3106.html#L334' title='Defined at 334 in Python/errors.c.'>PyErr_NoMemory</a>();
<a name='L184'>            ret = 1;
<a name='L185'>            <b>break</b>;
<a name='L186'>
<a name='L187'>        <b>case</b> BZ_DATA_ERROR:
<a name='L188'>        <b>case</b> BZ_DATA_ERROR_MAGIC:
<a name='L189'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_IOError, "invalid data stream");
<a name='L190'>            ret = 1;
<a name='L191'>            <b>break</b>;
<a name='L192'>
<a name='L193'>        <b>case</b> BZ_IO_ERROR:
<a name='L194'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_IOError, "unknown IO error");
<a name='L195'>            ret = 1;
<a name='L196'>            <b>break</b>;
<a name='L197'>
<a name='L198'>        <b>case</b> BZ_UNEXPECTED_EOF:
<a name='L199'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_EOFError,
<a name='L200'>                            "compressed file ended before the "
<a name='L201'>                            "logical end-of-stream was detected");
<a name='L202'>            ret = 1;
<a name='L203'>            <b>break</b>;
<a name='L204'>
<a name='L205'>        <b>case</b> BZ_SEQUENCE_ERROR:
<a name='L206'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_RuntimeError,
<a name='L207'>                            "wrong sequence of bz2 library "
<a name='L208'>                            "commands used");
<a name='L209'>            ret = 1;
<a name='L210'>            <b>break</b>;
<a name='L211'>    <font color='red'>}</font>
<a name='L212'>    <b>return</b> ret;
<a name='L213'><font color='red'>}</font>
<a name='L214'>
<a name='L215'><font color='darkred'>#if</font> BUFSIZ &lt; 8192
<a name='L216'><font color='darkred'>#define</font> <a href='../R/4194.html' title='Multiple refered from 14 places.'>SMALLCHUNK</a> 8192
<a name='L217'><font color='darkred'>#else</font>
<a name='L218'><font color='darkred'>#define</font> <a href='../R/4194.html' title='Multiple refered from 14 places.'>SMALLCHUNK</a> BUFSIZ
<a name='L219'><font color='darkred'>#endif</font>
<a name='L220'>
<a name='L221'><font color='darkred'>#if</font> <a href='../D/4733.html' title='Multiple defined in 3 places.'>SIZEOF_INT</a> &lt; 4
<a name='L222'><font color='darkred'>#define</font> <a href='../R/234.html' title='Multiple refered from 4 places.'>BIGCHUNK</a>  (512 * 32)
<a name='L223'><font color='darkred'>#else</font>
<a name='L224'><font color='darkred'>#define</font> <a href='../R/234.html' title='Multiple refered from 4 places.'>BIGCHUNK</a>  (512 * 1024)
<a name='L225'><font color='darkred'>#endif</font>
<a name='L226'>
<a name='L227'><i><font color='green'>/* This is a hacked version of Python's fileobject.c:new_buffersize(). */</font></i>
<a name='L228'><b>static</b> <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>
<a name='L229'><a href='../R/4837.html' title='Multiple refered from 7 places.'>Util_NewBufferSize</a>(<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> currentsize)
<a name='L230'><font color='red'>{</font>
<a name='L231'>    <b>if</b> (currentsize &gt; <a href='../D/4764.html' title='Multiple defined in 4 places.'>SMALLCHUNK</a>) <font color='red'>{</font>
<a name='L232'>        <i><font color='green'>/* Keep doubling until we reach BIGCHUNK;</font></i>
<a name='L233'><i><font color='green'>           then keep adding BIGCHUNK. */</font></i>
<a name='L234'>        <b>if</b> (currentsize &lt;= <a href='../D/258.html' title='Multiple defined in 4 places.'>BIGCHUNK</a>)
<a name='L235'>            <b>return</b> currentsize + currentsize;
<a name='L236'>        <b>else</b>
<a name='L237'>            <b>return</b> currentsize + <a href='../D/258.html' title='Multiple defined in 4 places.'>BIGCHUNK</a>;
<a name='L238'>    <font color='red'>}</font>
<a name='L239'>    <b>return</b> currentsize + <a href='../D/4764.html' title='Multiple defined in 4 places.'>SMALLCHUNK</a>;
<a name='L240'><font color='red'>}</font>
<a name='L241'>
<a name='L242'><i><font color='green'>/* This is a hacked version of Python's fileobject.c:get_line(). */</font></i>
<a name='L243'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L244'><a href='../R/4836.html' title='Multiple refered from 2 places.'>Util_GetLine</a>(BZ2FileObject *f, <b>int</b> n)
<a name='L245'><font color='red'>{</font>
<a name='L246'>    <b>char</b> c;
<a name='L247'>    <b>char</b> *buf, *end;
<a name='L248'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> total_v_size;        <i><font color='green'>/* total # of slots in buffer */</font></i>
<a name='L249'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> used_v_size;         <i><font color='green'>/* # used slots in buffer */</font></i>
<a name='L250'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> increment;       <i><font color='green'>/* amount to increment the buffer */</font></i>
<a name='L251'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *v;
<a name='L252'>    <b>int</b> bzerror;
<a name='L253'>    <b>int</b> bytes_read;
<a name='L254'>
<a name='L255'>    total_v_size = n &gt; 0 ? n : 100;
<a name='L256'>    v = <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>((<b>char</b> *)<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, total_v_size);
<a name='L257'>    <b>if</b> (v == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L258'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L259'>
<a name='L260'>    buf = <a href='../S/2626.html#L37' title='Defined at 37 in Modules/bz2module.c.'>BUF</a>(v);
<a name='L261'>    end = buf + total_v_size;
<a name='L262'>
<a name='L263'>    <b>for</b> (;;) <font color='red'>{</font>
<a name='L264'>        <a href='../D/4080.html' title='Multiple defined in 2 places.'>Py_BEGIN_ALLOW_THREADS</a>
<a name='L265'>        <b>do</b> <font color='red'>{</font>
<a name='L266'>            bytes_read = <a href='../S/2626.html#L62' title='Defined at 62 in Modules/bz2module.c.'>BZ2_bzRead</a>(&amp;bzerror, f-&gt;fp, &amp;c, 1);
<a name='L267'>            f-&gt;pos++;
<a name='L268'>            <b>if</b> (bytes_read == 0)
<a name='L269'>                <b>break</b>;
<a name='L270'>            *buf++ = c;
<a name='L271'>        <font color='red'>}</font> <b>while</b> (bzerror == BZ_OK &amp;&amp; c != '\n' &amp;&amp; buf != end);
<a name='L272'>        <a href='../D/4114.html' title='Multiple defined in 2 places.'>Py_END_ALLOW_THREADS</a>
<a name='L273'>        <b>if</b> (bzerror == BZ_STREAM_END) <font color='red'>{</font>
<a name='L274'>            f-&gt;size = f-&gt;pos;
<a name='L275'>            f-&gt;mode = <a href='../S/2626.html#L41' title='Defined at 41 in Modules/bz2module.c.'>MODE_READ_EOF</a>;
<a name='L276'>            <b>break</b>;
<a name='L277'>        <font color='red'>}</font> <b>else</b> <b>if</b> (bzerror != BZ_OK) <font color='red'>{</font>
<a name='L278'>            <a href='../S/2626.html#L158' title='Defined at 158 in Modules/bz2module.c.'>Util_CatchBZ2Error</a>(bzerror);
<a name='L279'>            Py_DECREF(v);
<a name='L280'>            <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L281'>        <font color='red'>}</font>
<a name='L282'>        <b>if</b> (c == '\n')
<a name='L283'>            <b>break</b>;
<a name='L284'>        <i><font color='green'>/* Must be because buf == end */</font></i>
<a name='L285'>        <b>if</b> (n &gt; 0)
<a name='L286'>            <b>break</b>;
<a name='L287'>        used_v_size = total_v_size;
<a name='L288'>        increment = total_v_size &gt;&gt; 2; <i><font color='green'>/* mild exponential growth */</font></i>
<a name='L289'>        total_v_size += increment;
<a name='L290'>        <b>if</b> (total_v_size &gt; <a href='../S/565.html#L753' title='Defined at 753 in Include/pyport.h.'>INT_MAX</a>) <font color='red'>{</font>
<a name='L291'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_OverflowError,
<a name='L292'>                "line is longer than a Python string can hold");
<a name='L293'>            Py_DECREF(v);
<a name='L294'>            <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L295'>        <font color='red'>}</font>
<a name='L296'>        <b>if</b> (<a href='../S/2779.html#L2822' title='Defined at 2822 in Objects/bytesobject.c.'>_PyBytes_Resize</a>(&amp;v, total_v_size) &lt; 0) <font color='red'>{</font>
<a name='L297'>            <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L298'>        <font color='red'>}</font>
<a name='L299'>        buf = <a href='../S/2626.html#L37' title='Defined at 37 in Modules/bz2module.c.'>BUF</a>(v) + used_v_size;
<a name='L300'>        end = <a href='../S/2626.html#L37' title='Defined at 37 in Modules/bz2module.c.'>BUF</a>(v) + total_v_size;
<a name='L301'>    <font color='red'>}</font>
<a name='L302'>
<a name='L303'>    used_v_size = buf - <a href='../S/2626.html#L37' title='Defined at 37 in Modules/bz2module.c.'>BUF</a>(v);
<a name='L304'>    <b>if</b> (used_v_size != total_v_size) <font color='red'>{</font>
<a name='L305'>        <b>if</b> (<a href='../S/2779.html#L2822' title='Defined at 2822 in Objects/bytesobject.c.'>_PyBytes_Resize</a>(&amp;v, used_v_size) &lt; 0) <font color='red'>{</font>
<a name='L306'>            v = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L307'>        <font color='red'>}</font>
<a name='L308'>    <font color='red'>}</font>
<a name='L309'>    <b>return</b> v;
<a name='L310'><font color='red'>}</font>
<a name='L311'>
<a name='L312'><i><font color='green'>/* This is a hacked version of Python's fileobject.c:drop_readahead(). */</font></i>
<a name='L313'><b>static</b> <b>void</b>
<a name='L314'><a href='../R/4835.html' title='Multiple refered from 5 places.'>Util_DropReadAhead</a>(BZ2FileObject *f)
<a name='L315'><font color='red'>{</font>
<a name='L316'>    <b>if</b> (f-&gt;f_buf != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L317'>        <a href='../S/2803.html#L1781' title='Defined at 1781 in Objects/object.c.'>PyMem_Free</a>(f-&gt;f_buf);
<a name='L318'>        f-&gt;f_buf = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L319'>    <font color='red'>}</font>
<a name='L320'><font color='red'>}</font>
<a name='L321'>
<a name='L322'><i><font color='green'>/* This is a hacked version of Python's fileobject.c:readahead(). */</font></i>
<a name='L323'><b>static</b> <b>int</b>
<a name='L324'><a href='../S/2626.html#L372' title='Refered from 372 in Modules/bz2module.c.'>Util_ReadAhead</a>(BZ2FileObject *f, <b>int</b> bufsize)
<a name='L325'><font color='red'>{</font>
<a name='L326'>    <b>int</b> <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>;
<a name='L327'>    <b>int</b> bzerror;
<a name='L328'>
<a name='L329'>    <b>if</b> (f-&gt;f_buf != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L330'>        <b>if</b>((f-&gt;f_bufend - f-&gt;f_bufptr) &gt;= 1)
<a name='L331'>            <b>return</b> 0;
<a name='L332'>        <b>else</b>
<a name='L333'>            <a href='../S/2626.html#L314' title='Defined at 314 in Modules/bz2module.c.'>Util_DropReadAhead</a>(f);
<a name='L334'>    <font color='red'>}</font>
<a name='L335'>    <b>if</b> (f-&gt;mode == <a href='../S/2626.html#L41' title='Defined at 41 in Modules/bz2module.c.'>MODE_READ_EOF</a>) <font color='red'>{</font>
<a name='L336'>        f-&gt;f_bufptr = f-&gt;f_buf;
<a name='L337'>        f-&gt;f_bufend = f-&gt;f_buf;
<a name='L338'>        <b>return</b> 0;
<a name='L339'>    <font color='red'>}</font>
<a name='L340'>    <b>if</b> ((f-&gt;f_buf = <a href='../S/2803.html#L1769' title='Defined at 1769 in Objects/object.c.'>PyMem_Malloc</a>(bufsize)) == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L341'>        <a href='../S/3106.html#L334' title='Defined at 334 in Python/errors.c.'>PyErr_NoMemory</a>();
<a name='L342'>        <b>return</b> -1;
<a name='L343'>    <font color='red'>}</font>
<a name='L344'>    <a href='../D/4080.html' title='Multiple defined in 2 places.'>Py_BEGIN_ALLOW_THREADS</a>
<a name='L345'>    <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a> = <a href='../S/2626.html#L62' title='Defined at 62 in Modules/bz2module.c.'>BZ2_bzRead</a>(&amp;bzerror, f-&gt;fp, f-&gt;f_buf, bufsize);
<a name='L346'>    <a href='../D/4114.html' title='Multiple defined in 2 places.'>Py_END_ALLOW_THREADS</a>
<a name='L347'>    f-&gt;pos += <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>;
<a name='L348'>    <b>if</b> (bzerror == BZ_STREAM_END) <font color='red'>{</font>
<a name='L349'>        f-&gt;size = f-&gt;pos;
<a name='L350'>        f-&gt;mode = <a href='../S/2626.html#L41' title='Defined at 41 in Modules/bz2module.c.'>MODE_READ_EOF</a>;
<a name='L351'>    <font color='red'>}</font> <b>else</b> <b>if</b> (bzerror != BZ_OK) <font color='red'>{</font>
<a name='L352'>        <a href='../S/2626.html#L158' title='Defined at 158 in Modules/bz2module.c.'>Util_CatchBZ2Error</a>(bzerror);
<a name='L353'>        <a href='../S/2626.html#L314' title='Defined at 314 in Modules/bz2module.c.'>Util_DropReadAhead</a>(f);
<a name='L354'>        <b>return</b> -1;
<a name='L355'>    <font color='red'>}</font>
<a name='L356'>    f-&gt;f_bufptr = f-&gt;f_buf;
<a name='L357'>    f-&gt;f_bufend = f-&gt;f_buf + <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>;
<a name='L358'>    <b>return</b> 0;
<a name='L359'><font color='red'>}</font>
<a name='L360'>
<a name='L361'><i><font color='green'>/* This is a hacked version of Python's</font></i>
<a name='L362'><i><font color='green'> * fileobject.c:readahead_get_line_skip(). */</font></i>
<a name='L363'><b>static</b> <a href='../S/507.html#L41' title='Defined at 41 in Include/bytesobject.h.'>PyBytesObject</a> *
<a name='L364'><a href='../R/4839.html' title='Multiple refered from 2 places.'>Util_ReadAheadGetLineSkip</a>(BZ2FileObject *f, <b>int</b> skip, <b>int</b> bufsize)
<a name='L365'><font color='red'>{</font>
<a name='L366'>    <a href='../S/507.html#L41' title='Defined at 41 in Include/bytesobject.h.'>PyBytesObject</a>* s;
<a name='L367'>    <b>char</b> *bufptr;
<a name='L368'>    <b>char</b> *buf;
<a name='L369'>    <b>int</b> len;
<a name='L370'>
<a name='L371'>    <b>if</b> (f-&gt;f_buf == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L372'>        <b>if</b> (<a href='../S/2626.html#L324' title='Defined at 324 in Modules/bz2module.c.'>Util_ReadAhead</a>(f, bufsize) &lt; 0)
<a name='L373'>            <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L374'>
<a name='L375'>    len = f-&gt;f_bufend - f-&gt;f_bufptr;
<a name='L376'>    <b>if</b> (len == 0)
<a name='L377'>        <b>return</b> (<a href='../S/507.html#L41' title='Defined at 41 in Include/bytesobject.h.'>PyBytesObject</a> *)
<a name='L378'>            <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, skip);
<a name='L379'>    bufptr = memchr(f-&gt;f_bufptr, '\n', len);
<a name='L380'>    <b>if</b> (bufptr != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L381'>        bufptr++;                               <i><font color='green'>/* Count the '\n' */</font></i>
<a name='L382'>        len = bufptr - f-&gt;f_bufptr;
<a name='L383'>        s = (<a href='../S/507.html#L41' title='Defined at 41 in Include/bytesobject.h.'>PyBytesObject</a> *)
<a name='L384'>            <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, skip+len);
<a name='L385'>        <b>if</b> (s == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L386'>            <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L387'>        <a href='../D/9803.html' title='Multiple defined in 4 places.'>memcpy</a>(PyBytes_AS_STRING(s)+skip, f-&gt;f_bufptr, len);
<a name='L388'>        f-&gt;f_bufptr = bufptr;
<a name='L389'>        <b>if</b> (bufptr == f-&gt;f_bufend)
<a name='L390'>            <a href='../S/2626.html#L314' title='Defined at 314 in Modules/bz2module.c.'>Util_DropReadAhead</a>(f);
<a name='L391'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L392'>        bufptr = f-&gt;f_bufptr;
<a name='L393'>        buf = f-&gt;f_buf;
<a name='L394'>        f-&gt;f_buf = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;                <i><font color='green'>/* Force new readahead buffer */</font></i>
<a name='L395'>        s = <a href='../S/2626.html#L364' title='Defined at 364 in Modules/bz2module.c.'>Util_ReadAheadGetLineSkip</a>(f, skip+len,
<a name='L396'>                                      bufsize + (bufsize&gt;&gt;2));
<a name='L397'>        <b>if</b> (s == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L398'>            <a href='../S/2803.html#L1781' title='Defined at 1781 in Objects/object.c.'>PyMem_Free</a>(buf);
<a name='L399'>            <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L400'>        <font color='red'>}</font>
<a name='L401'>        <a href='../D/9803.html' title='Multiple defined in 4 places.'>memcpy</a>(PyBytes_AS_STRING(s)+skip, bufptr, len);
<a name='L402'>        <a href='../S/2803.html#L1781' title='Defined at 1781 in Objects/object.c.'>PyMem_Free</a>(buf);
<a name='L403'>    <font color='red'>}</font>
<a name='L404'>    <b>return</b> s;
<a name='L405'><font color='red'>}</font>
<a name='L406'>
<a name='L407'><i><font color='green'>/* ===================================================================== */</font></i>
<a name='L408'><i><font color='green'>/* Methods of BZ2File. */</font></i>
<a name='L409'>
<a name='L410'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(BZ2File_read__doc__,
<a name='L411'>"read([size]) -&gt; string\n\
<a name='L412'>\n\
<a name='L413'>Read at most size uncompressed bytes, returned as a string. If the size\n\
<a name='L414'>argument is negative or omitted, read until EOF is reached.\n\
<a name='L415'>");
<a name='L416'>
<a name='L417'><i><font color='green'>/* This is a hacked version of Python's fileobject.c:file_read(). */</font></i>
<a name='L418'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L419'><a href='../S/2626.html#L1155' title='Refered from 1155 in Modules/bz2module.c.'>BZ2File_read</a>(BZ2FileObject *self, PyObject *args)
<a name='L420'><font color='red'>{</font>
<a name='L421'>    <b>long</b> bytesrequested = -1;
<a name='L422'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> bytesread, buffersize, <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>;
<a name='L423'>    <b>int</b> bzerror;
<a name='L424'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *ret = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L425'>
<a name='L426'>    <b>if</b> (!<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "|l:read", &amp;bytesrequested))
<a name='L427'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L428'>
<a name='L429'>    <a href='../D/20.html' title='Multiple defined in 4 places.'>ACQUIRE_LOCK</a>(self);
<a name='L430'>    <b>switch</b> (self-&gt;mode) <font color='red'>{</font>
<a name='L431'>        <b>case</b> <a href='../S/2626.html#L40' title='Defined at 40 in Modules/bz2module.c.'>MODE_READ</a>:
<a name='L432'>            <b>break</b>;
<a name='L433'>        <b>case</b> <a href='../S/2626.html#L41' title='Defined at 41 in Modules/bz2module.c.'>MODE_READ_EOF</a>:
<a name='L434'>            ret = <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>("", 0);
<a name='L435'>            <b>goto</b> cleanup;
<a name='L436'>        <b>case</b> <a href='../S/2626.html#L39' title='Defined at 39 in Modules/bz2module.c.'>MODE_CLOSED</a>:
<a name='L437'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError,
<a name='L438'>                            "I/O operation on closed file");
<a name='L439'>            <b>goto</b> cleanup;
<a name='L440'>        <b>default</b>:
<a name='L441'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_IOError,
<a name='L442'>                            "file is not ready for reading");
<a name='L443'>            <b>goto</b> cleanup;
<a name='L444'>    <font color='red'>}</font>
<a name='L445'>
<a name='L446'>    <i><font color='green'>/* refuse to mix with f.next() */</font></i>
<a name='L447'>    <b>if</b> (<a href='../S/2626.html#L145' title='Defined at 145 in Modules/bz2module.c.'>check_iterbuffered</a>(self))
<a name='L448'>        <b>goto</b> cleanup;
<a name='L449'>
<a name='L450'>    <b>if</b> (bytesrequested &lt; 0)
<a name='L451'>        buffersize = <a href='../S/2626.html#L229' title='Defined at 229 in Modules/bz2module.c.'>Util_NewBufferSize</a>((<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)0);
<a name='L452'>    <b>else</b>
<a name='L453'>        buffersize = bytesrequested;
<a name='L454'>    <b>if</b> (buffersize &gt; <a href='../S/565.html#L753' title='Defined at 753 in Include/pyport.h.'>INT_MAX</a>) <font color='red'>{</font>
<a name='L455'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_OverflowError,
<a name='L456'>                        "requested number of bytes is "
<a name='L457'>                        "more than a Python string can hold");
<a name='L458'>        <b>goto</b> cleanup;
<a name='L459'>    <font color='red'>}</font>
<a name='L460'>    ret = <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>((<b>char</b> *)<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, buffersize);
<a name='L461'>    <b>if</b> (ret == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> || buffersize == 0)
<a name='L462'>        <b>goto</b> cleanup;
<a name='L463'>    bytesread = 0;
<a name='L464'>
<a name='L465'>    <b>for</b> (;;) <font color='red'>{</font>
<a name='L466'>        <a href='../D/4080.html' title='Multiple defined in 2 places.'>Py_BEGIN_ALLOW_THREADS</a>
<a name='L467'>        <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a> = <a href='../S/2626.html#L62' title='Defined at 62 in Modules/bz2module.c.'>BZ2_bzRead</a>(&amp;bzerror, self-&gt;fp,
<a name='L468'>                               <a href='../S/2626.html#L37' title='Defined at 37 in Modules/bz2module.c.'>BUF</a>(ret)+bytesread,
<a name='L469'>                               buffersize-bytesread);
<a name='L470'>        self-&gt;pos += <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>;
<a name='L471'>        <a href='../D/4114.html' title='Multiple defined in 2 places.'>Py_END_ALLOW_THREADS</a>
<a name='L472'>        bytesread += <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>;
<a name='L473'>        <b>if</b> (bzerror == BZ_STREAM_END) <font color='red'>{</font>
<a name='L474'>            self-&gt;size = self-&gt;pos;
<a name='L475'>            self-&gt;mode = <a href='../S/2626.html#L41' title='Defined at 41 in Modules/bz2module.c.'>MODE_READ_EOF</a>;
<a name='L476'>            <b>break</b>;
<a name='L477'>        <font color='red'>}</font> <b>else</b> <b>if</b> (bzerror != BZ_OK) <font color='red'>{</font>
<a name='L478'>            <a href='../S/2626.html#L158' title='Defined at 158 in Modules/bz2module.c.'>Util_CatchBZ2Error</a>(bzerror);
<a name='L479'>            Py_DECREF(ret);
<a name='L480'>            ret = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L481'>            <b>goto</b> cleanup;
<a name='L482'>        <font color='red'>}</font>
<a name='L483'>        <b>if</b> (bytesrequested &lt; 0) <font color='red'>{</font>
<a name='L484'>            buffersize = <a href='../S/2626.html#L229' title='Defined at 229 in Modules/bz2module.c.'>Util_NewBufferSize</a>(buffersize);
<a name='L485'>            <b>if</b> (<a href='../S/2779.html#L2822' title='Defined at 2822 in Objects/bytesobject.c.'>_PyBytes_Resize</a>(&amp;ret, buffersize) &lt; 0) <font color='red'>{</font>
<a name='L486'>                ret = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L487'>                <b>goto</b> cleanup;
<a name='L488'>            <font color='red'>}</font>
<a name='L489'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L490'>            <b>break</b>;
<a name='L491'>        <font color='red'>}</font>
<a name='L492'>    <font color='red'>}</font>
<a name='L493'>    <b>if</b> (bytesread != buffersize) <font color='red'>{</font>
<a name='L494'>        <b>if</b> (<a href='../S/2779.html#L2822' title='Defined at 2822 in Objects/bytesobject.c.'>_PyBytes_Resize</a>(&amp;ret, bytesread) &lt; 0) <font color='red'>{</font>
<a name='L495'>            ret = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L496'>        <font color='red'>}</font>
<a name='L497'>    <font color='red'>}</font>
<a name='L498'>
<a name='L499'>cleanup:
<a name='L500'>    <a href='../D/4465.html' title='Multiple defined in 4 places.'>RELEASE_LOCK</a>(self);
<a name='L501'>    <b>return</b> ret;
<a name='L502'><font color='red'>}</font>
<a name='L503'>
<a name='L504'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(BZ2File_readline__doc__,
<a name='L505'>"readline([size]) -&gt; string\n\
<a name='L506'>\n\
<a name='L507'>Return the next line from the file, as a string, retaining newline.\n\
<a name='L508'>A non-negative size argument will limit the maximum number of bytes to\n\
<a name='L509'>return (an incomplete line may be returned then). Return an empty\n\
<a name='L510'>string at EOF.\n\
<a name='L511'>");
<a name='L512'>
<a name='L513'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L514'><a href='../S/2626.html#L1156' title='Refered from 1156 in Modules/bz2module.c.'>BZ2File_readline</a>(BZ2FileObject *self, PyObject *args)
<a name='L515'><font color='red'>{</font>
<a name='L516'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *ret = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L517'>    <b>int</b> sizehint = -1;
<a name='L518'>
<a name='L519'>    <b>if</b> (!<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "|i:readline", &amp;sizehint))
<a name='L520'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L521'>
<a name='L522'>    <a href='../D/20.html' title='Multiple defined in 4 places.'>ACQUIRE_LOCK</a>(self);
<a name='L523'>    <b>switch</b> (self-&gt;mode) <font color='red'>{</font>
<a name='L524'>        <b>case</b> <a href='../S/2626.html#L40' title='Defined at 40 in Modules/bz2module.c.'>MODE_READ</a>:
<a name='L525'>            <b>break</b>;
<a name='L526'>        <b>case</b> <a href='../S/2626.html#L41' title='Defined at 41 in Modules/bz2module.c.'>MODE_READ_EOF</a>:
<a name='L527'>            ret = <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>("", 0);
<a name='L528'>            <b>goto</b> cleanup;
<a name='L529'>        <b>case</b> <a href='../S/2626.html#L39' title='Defined at 39 in Modules/bz2module.c.'>MODE_CLOSED</a>:
<a name='L530'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError,
<a name='L531'>                            "I/O operation on closed file");
<a name='L532'>            <b>goto</b> cleanup;
<a name='L533'>        <b>default</b>:
<a name='L534'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_IOError,
<a name='L535'>                            "file is not ready for reading");
<a name='L536'>            <b>goto</b> cleanup;
<a name='L537'>    <font color='red'>}</font>
<a name='L538'>
<a name='L539'>    <i><font color='green'>/* refuse to mix with f.next() */</font></i>
<a name='L540'>    <b>if</b> (<a href='../S/2626.html#L145' title='Defined at 145 in Modules/bz2module.c.'>check_iterbuffered</a>(self))
<a name='L541'>        <b>goto</b> cleanup;
<a name='L542'>
<a name='L543'>    <b>if</b> (sizehint == 0)
<a name='L544'>        ret = <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>("", 0);
<a name='L545'>    <b>else</b>
<a name='L546'>        ret = <a href='../S/2626.html#L244' title='Defined at 244 in Modules/bz2module.c.'>Util_GetLine</a>(self, (sizehint &lt; 0) ? 0 : sizehint);
<a name='L547'>
<a name='L548'>cleanup:
<a name='L549'>    <a href='../D/4465.html' title='Multiple defined in 4 places.'>RELEASE_LOCK</a>(self);
<a name='L550'>    <b>return</b> ret;
<a name='L551'><font color='red'>}</font>
<a name='L552'>
<a name='L553'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(BZ2File_readlines__doc__,
<a name='L554'>"readlines([size]) -&gt; list\n\
<a name='L555'>\n\
<a name='L556'>Call readline() repeatedly and return a list of lines read.\n\
<a name='L557'>The optional size argument, if given, is an approximate bound on the\n\
<a name='L558'>total number of bytes in the lines returned.\n\
<a name='L559'>");
<a name='L560'>
<a name='L561'><i><font color='green'>/* This is a hacked version of Python's fileobject.c:file_readlines(). */</font></i>
<a name='L562'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L563'><a href='../S/2626.html#L1157' title='Refered from 1157 in Modules/bz2module.c.'>BZ2File_readlines</a>(BZ2FileObject *self, PyObject *args)
<a name='L564'><font color='red'>{</font>
<a name='L565'>    <b>long</b> sizehint = 0;
<a name='L566'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *list = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L567'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *line;
<a name='L568'>    <b>char</b> small_buffer[<a href='../D/4764.html' title='Multiple defined in 4 places.'>SMALLCHUNK</a>];
<a name='L569'>    <b>char</b> *<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a> = small_buffer;
<a name='L570'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> buffersize = <a href='../D/4764.html' title='Multiple defined in 4 places.'>SMALLCHUNK</a>;
<a name='L571'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *big_buffer = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L572'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> nfilled = 0;
<a name='L573'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> nread;
<a name='L574'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> totalread = 0;
<a name='L575'>    <b>char</b> *p, *q, *end;
<a name='L576'>    <b>int</b> err;
<a name='L577'>    <b>int</b> shortread = 0;
<a name='L578'>    <b>int</b> bzerror;
<a name='L579'>
<a name='L580'>    <b>if</b> (!<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "|l:readlines", &amp;sizehint))
<a name='L581'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L582'>
<a name='L583'>    <a href='../D/20.html' title='Multiple defined in 4 places.'>ACQUIRE_LOCK</a>(self);
<a name='L584'>    <b>switch</b> (self-&gt;mode) <font color='red'>{</font>
<a name='L585'>        <b>case</b> <a href='../S/2626.html#L40' title='Defined at 40 in Modules/bz2module.c.'>MODE_READ</a>:
<a name='L586'>            <b>break</b>;
<a name='L587'>        <b>case</b> <a href='../S/2626.html#L41' title='Defined at 41 in Modules/bz2module.c.'>MODE_READ_EOF</a>:
<a name='L588'>            list = <a href='../S/2796.html#L113' title='Defined at 113 in Objects/listobject.c.'>PyList_New</a>(0);
<a name='L589'>            <b>goto</b> cleanup;
<a name='L590'>        <b>case</b> <a href='../S/2626.html#L39' title='Defined at 39 in Modules/bz2module.c.'>MODE_CLOSED</a>:
<a name='L591'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError,
<a name='L592'>                            "I/O operation on closed file");
<a name='L593'>            <b>goto</b> cleanup;
<a name='L594'>        <b>default</b>:
<a name='L595'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_IOError,
<a name='L596'>                            "file is not ready for reading");
<a name='L597'>            <b>goto</b> cleanup;
<a name='L598'>    <font color='red'>}</font>
<a name='L599'>
<a name='L600'>    <i><font color='green'>/* refuse to mix with f.next() */</font></i>
<a name='L601'>    <b>if</b> (<a href='../S/2626.html#L145' title='Defined at 145 in Modules/bz2module.c.'>check_iterbuffered</a>(self))
<a name='L602'>        <b>goto</b> cleanup;
<a name='L603'>
<a name='L604'>    <b>if</b> ((list = <a href='../S/2796.html#L113' title='Defined at 113 in Objects/listobject.c.'>PyList_New</a>(0)) == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L605'>        <b>goto</b> cleanup;
<a name='L606'>
<a name='L607'>    <b>for</b> (;;) <font color='red'>{</font>
<a name='L608'>        <a href='../D/4080.html' title='Multiple defined in 2 places.'>Py_BEGIN_ALLOW_THREADS</a>
<a name='L609'>        nread = <a href='../S/2626.html#L62' title='Defined at 62 in Modules/bz2module.c.'>BZ2_bzRead</a>(&amp;bzerror, self-&gt;fp,
<a name='L610'>                           <a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>+nfilled, buffersize-nfilled);
<a name='L611'>        self-&gt;pos += nread;
<a name='L612'>        <a href='../D/4114.html' title='Multiple defined in 2 places.'>Py_END_ALLOW_THREADS</a>
<a name='L613'>        <b>if</b> (bzerror == BZ_STREAM_END) <font color='red'>{</font>
<a name='L614'>            self-&gt;size = self-&gt;pos;
<a name='L615'>            self-&gt;mode = <a href='../S/2626.html#L41' title='Defined at 41 in Modules/bz2module.c.'>MODE_READ_EOF</a>;
<a name='L616'>            <b>if</b> (nread == 0) <font color='red'>{</font>
<a name='L617'>                sizehint = 0;
<a name='L618'>                <b>break</b>;
<a name='L619'>            <font color='red'>}</font>
<a name='L620'>            shortread = 1;
<a name='L621'>        <font color='red'>}</font> <b>else</b> <b>if</b> (bzerror != BZ_OK) <font color='red'>{</font>
<a name='L622'>            <a href='../S/2626.html#L158' title='Defined at 158 in Modules/bz2module.c.'>Util_CatchBZ2Error</a>(bzerror);
<a name='L623'>          <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>:
<a name='L624'>            Py_DECREF(list);
<a name='L625'>            list = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L626'>            <b>goto</b> cleanup;
<a name='L627'>        <font color='red'>}</font>
<a name='L628'>        totalread += nread;
<a name='L629'>        p = memchr(<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>+nfilled, '\n', nread);
<a name='L630'>        <b>if</b> (!shortread &amp;&amp; p == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L631'>            <i><font color='green'>/* Need a larger buffer to fit this line */</font></i>
<a name='L632'>            nfilled += nread;
<a name='L633'>            buffersize *= 2;
<a name='L634'>            <b>if</b> (buffersize &gt; <a href='../S/565.html#L753' title='Defined at 753 in Include/pyport.h.'>INT_MAX</a>) <font color='red'>{</font>
<a name='L635'>                <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_OverflowError,
<a name='L636'>                "line is longer than a Python string can hold");
<a name='L637'>                <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L638'>            <font color='red'>}</font>
<a name='L639'>            <b>if</b> (big_buffer == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L640'>                <i><font color='green'>/* Create the big buffer */</font></i>
<a name='L641'>                big_buffer = <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>(
<a name='L642'>                    <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, buffersize);
<a name='L643'>                <b>if</b> (big_buffer == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L644'>                    <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L645'>                <a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a> = PyBytes_AS_STRING(big_buffer);
<a name='L646'>                <a href='../D/9803.html' title='Multiple defined in 4 places.'>memcpy</a>(<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>, small_buffer, nfilled);
<a name='L647'>            <font color='red'>}</font>
<a name='L648'>            <b>else</b> <font color='red'>{</font>
<a name='L649'>                <i><font color='green'>/* Grow the big buffer */</font></i>
<a name='L650'>                <b>if</b> (<a href='../S/2779.html#L2822' title='Defined at 2822 in Objects/bytesobject.c.'>_PyBytes_Resize</a>(&amp;big_buffer, buffersize) &lt; 0)<font color='red'>{</font>
<a name='L651'>                    big_buffer = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L652'>                    <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L653'>                <font color='red'>}</font>
<a name='L654'>                <a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a> = PyBytes_AS_STRING(big_buffer);
<a name='L655'>            <font color='red'>}</font>
<a name='L656'>            <b>continue</b>;
<a name='L657'>        <font color='red'>}</font>
<a name='L658'>        end = <a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>+nfilled+nread;
<a name='L659'>        q = <a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>;
<a name='L660'>        <b>while</b> (p != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L661'>            <i><font color='green'>/* Process complete lines */</font></i>
<a name='L662'>            p++;
<a name='L663'>            line = <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>(q, p-q);
<a name='L664'>            <b>if</b> (line == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L665'>                <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L666'>            err = <a href='../S/2796.html#L286' title='Defined at 286 in Objects/listobject.c.'>PyList_Append</a>(list, line);
<a name='L667'>            Py_DECREF(line);
<a name='L668'>            <b>if</b> (err != 0)
<a name='L669'>                <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L670'>            q = p;
<a name='L671'>            p = memchr(q, '\n', end-q);
<a name='L672'>        <font color='red'>}</font>
<a name='L673'>        <i><font color='green'>/* Move the remaining incomplete line to the start */</font></i>
<a name='L674'>        nfilled = end-q;
<a name='L675'>        <a href='../S/2664.html#L75' title='Defined at 75 in Modules/expat/xmlparse.c.'>memmove</a>(<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>, q, nfilled);
<a name='L676'>        <b>if</b> (sizehint &gt; 0)
<a name='L677'>            <b>if</b> (totalread &gt;= (<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)sizehint)
<a name='L678'>                <b>break</b>;
<a name='L679'>        <b>if</b> (shortread) <font color='red'>{</font>
<a name='L680'>            sizehint = 0;
<a name='L681'>            <b>break</b>;
<a name='L682'>        <font color='red'>}</font>
<a name='L683'>    <font color='red'>}</font>
<a name='L684'>    <b>if</b> (nfilled != 0) <font color='red'>{</font>
<a name='L685'>        <i><font color='green'>/* Partial last line */</font></i>
<a name='L686'>        line = <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>(<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>, nfilled);
<a name='L687'>        <b>if</b> (line == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L688'>            <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L689'>        <b>if</b> (sizehint &gt; 0) <font color='red'>{</font>
<a name='L690'>            <i><font color='green'>/* Need to complete the last line */</font></i>
<a name='L691'>            <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *rest = <a href='../S/2626.html#L244' title='Defined at 244 in Modules/bz2module.c.'>Util_GetLine</a>(self, 0);
<a name='L692'>            <b>if</b> (rest == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L693'>                Py_DECREF(line);
<a name='L694'>                <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L695'>            <font color='red'>}</font>
<a name='L696'>            <a href='../S/2779.html#L2783' title='Defined at 2783 in Objects/bytesobject.c.'>PyBytes_Concat</a>(&amp;line, rest);
<a name='L697'>            Py_DECREF(rest);
<a name='L698'>            <b>if</b> (line == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L699'>                <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L700'>        <font color='red'>}</font>
<a name='L701'>        err = <a href='../S/2796.html#L286' title='Defined at 286 in Objects/listobject.c.'>PyList_Append</a>(list, line);
<a name='L702'>        Py_DECREF(line);
<a name='L703'>        <b>if</b> (err != 0)
<a name='L704'>            <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L705'>    <font color='red'>}</font>
<a name='L706'>
<a name='L707'>  cleanup:
<a name='L708'>    <a href='../D/4465.html' title='Multiple defined in 4 places.'>RELEASE_LOCK</a>(self);
<a name='L709'>    <b>if</b> (big_buffer) <font color='red'>{</font>
<a name='L710'>        Py_DECREF(big_buffer);
<a name='L711'>    <font color='red'>}</font>
<a name='L712'>    <b>return</b> list;
<a name='L713'><font color='red'>}</font>
<a name='L714'>
<a name='L715'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(BZ2File_write__doc__,
<a name='L716'>"write(data) -&gt; None\n\
<a name='L717'>\n\
<a name='L718'>Write the 'data' string to file. Note that due to buffering, close() may\n\
<a name='L719'>be needed before the file on disk reflects the data written.\n\
<a name='L720'>");
<a name='L721'>
<a name='L722'><i><font color='green'>/* This is a hacked version of Python's fileobject.c:file_write(). */</font></i>
<a name='L723'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L724'><a href='../S/2626.html#L1158' title='Refered from 1158 in Modules/bz2module.c.'>BZ2File_write</a>(BZ2FileObject *self, PyObject *args)
<a name='L725'><font color='red'>{</font>
<a name='L726'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *ret = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L727'>    <a href='../S/544.html#L163' title='Defined at 163 in Include/object.h.'>Py_buffer</a> pbuf;
<a name='L728'>    <b>char</b> *buf;
<a name='L729'>    <b>int</b> len;
<a name='L730'>    <b>int</b> bzerror;
<a name='L731'>
<a name='L732'>    <b>if</b> (!<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "y*:write", &amp;pbuf))
<a name='L733'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L734'>    buf = pbuf.buf;
<a name='L735'>    len = pbuf.len;
<a name='L736'>
<a name='L737'>    <a href='../D/20.html' title='Multiple defined in 4 places.'>ACQUIRE_LOCK</a>(self);
<a name='L738'>    <b>switch</b> (self-&gt;mode) <font color='red'>{</font>
<a name='L739'>        <b>case</b> <a href='../S/2626.html#L42' title='Defined at 42 in Modules/bz2module.c.'>MODE_WRITE</a>:
<a name='L740'>            <b>break</b>;
<a name='L741'>
<a name='L742'>        <b>case</b> <a href='../S/2626.html#L39' title='Defined at 39 in Modules/bz2module.c.'>MODE_CLOSED</a>:
<a name='L743'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError,
<a name='L744'>                            "I/O operation on closed file");
<a name='L745'>            <b>goto</b> cleanup;
<a name='L746'>
<a name='L747'>        <b>default</b>:
<a name='L748'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_IOError,
<a name='L749'>                            "file is not ready for writing");
<a name='L750'>            <b>goto</b> cleanup;
<a name='L751'>    <font color='red'>}</font>
<a name='L752'>
<a name='L753'>    <a href='../D/4080.html' title='Multiple defined in 2 places.'>Py_BEGIN_ALLOW_THREADS</a>
<a name='L754'>    <a href='../S/2626.html#L65' title='Defined at 65 in Modules/bz2module.c.'>BZ2_bzWrite</a> (&amp;bzerror, self-&gt;fp, buf, len);
<a name='L755'>    self-&gt;pos += len;
<a name='L756'>    <a href='../D/4114.html' title='Multiple defined in 2 places.'>Py_END_ALLOW_THREADS</a>
<a name='L757'>
<a name='L758'>    <b>if</b> (bzerror != BZ_OK) <font color='red'>{</font>
<a name='L759'>        <a href='../S/2626.html#L158' title='Defined at 158 in Modules/bz2module.c.'>Util_CatchBZ2Error</a>(bzerror);
<a name='L760'>        <b>goto</b> cleanup;
<a name='L761'>    <font color='red'>}</font>
<a name='L762'>
<a name='L763'>    Py_INCREF(Py_None);
<a name='L764'>    ret = Py_None;
<a name='L765'>
<a name='L766'>cleanup:
<a name='L767'>    <a href='../S/2775.html#L684' title='Defined at 684 in Objects/abstract.c.'>PyBuffer_Release</a>(&amp;pbuf);
<a name='L768'>    <a href='../D/4465.html' title='Multiple defined in 4 places.'>RELEASE_LOCK</a>(self);
<a name='L769'>    <b>return</b> ret;
<a name='L770'><font color='red'>}</font>
<a name='L771'>
<a name='L772'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(BZ2File_writelines__doc__,
<a name='L773'>"writelines(sequence_of_strings) -&gt; None\n\
<a name='L774'>\n\
<a name='L775'>Write the sequence of strings to the file. Note that newlines are not\n\
<a name='L776'>added. The sequence can be any iterable object producing strings. This is\n\
<a name='L777'>equivalent to calling write() for each string.\n\
<a name='L778'>");
<a name='L779'>
<a name='L780'><i><font color='green'>/* This is a hacked version of Python's fileobject.c:file_writelines(). */</font></i>
<a name='L781'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L782'><a href='../S/2626.html#L1159' title='Refered from 1159 in Modules/bz2module.c.'>BZ2File_writelines</a>(BZ2FileObject *self, PyObject *seq)
<a name='L783'><font color='red'>{</font>
<a name='L784'><font color='darkred'>#define</font> <a href='../R/509.html' title='Multiple refered from 5 places.'>CHUNKSIZE</a> 1000
<a name='L785'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *list = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L786'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *iter = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L787'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *ret = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L788'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *line;
<a name='L789'>    <b>int</b> i, j, index, len, islist;
<a name='L790'>    <b>int</b> bzerror;
<a name='L791'>
<a name='L792'>    <a href='../D/20.html' title='Multiple defined in 4 places.'>ACQUIRE_LOCK</a>(self);
<a name='L793'>    <b>switch</b> (self-&gt;mode) <font color='red'>{</font>
<a name='L794'>        <b>case</b> <a href='../S/2626.html#L42' title='Defined at 42 in Modules/bz2module.c.'>MODE_WRITE</a>:
<a name='L795'>            <b>break</b>;
<a name='L796'>
<a name='L797'>        <b>case</b> <a href='../S/2626.html#L39' title='Defined at 39 in Modules/bz2module.c.'>MODE_CLOSED</a>:
<a name='L798'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError,
<a name='L799'>                            "I/O operation on closed file");
<a name='L800'>            <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L801'>
<a name='L802'>        <b>default</b>:
<a name='L803'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_IOError,
<a name='L804'>                            "file is not ready for writing");
<a name='L805'>            <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L806'>    <font color='red'>}</font>
<a name='L807'>
<a name='L808'>    islist = PyList_Check(seq);
<a name='L809'>    <b>if</b>  (!islist) <font color='red'>{</font>
<a name='L810'>        iter = <a href='../S/2775.html#L2668' title='Defined at 2668 in Objects/abstract.c.'>PyObject_GetIter</a>(seq);
<a name='L811'>        <b>if</b> (iter == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L812'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_TypeError,
<a name='L813'>                "writelines() requires an iterable argument");
<a name='L814'>            <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L815'>        <font color='red'>}</font>
<a name='L816'>        list = <a href='../S/2796.html#L113' title='Defined at 113 in Objects/listobject.c.'>PyList_New</a>(<a href='../D/543.html' title='Multiple defined in 2 places.'>CHUNKSIZE</a>);
<a name='L817'>        <b>if</b> (list == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L818'>            <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L819'>    <font color='red'>}</font>
<a name='L820'>
<a name='L821'>    <i><font color='green'>/* Strategy: slurp CHUNKSIZE lines into a private list,</font></i>
<a name='L822'><i><font color='green'>       checking that they are all strings, then write that list</font></i>
<a name='L823'><i><font color='green'>       without holding the interpreter lock, then come back for more. */</font></i>
<a name='L824'>    <b>for</b> (index = 0; ; index += <a href='../D/543.html' title='Multiple defined in 2 places.'>CHUNKSIZE</a>) <font color='red'>{</font>
<a name='L825'>        <b>if</b> (islist) <font color='red'>{</font>
<a name='L826'>            <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(list);
<a name='L827'>            list = <a href='../S/2796.html#L455' title='Defined at 455 in Objects/listobject.c.'>PyList_GetSlice</a>(seq, index, index+<a href='../D/543.html' title='Multiple defined in 2 places.'>CHUNKSIZE</a>);
<a name='L828'>            <b>if</b> (list == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L829'>                <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L830'>            j = <a href='../S/534.html#L71' title='Defined at 71 in Include/listobject.h.'>PyList_GET_SIZE</a>(list);
<a name='L831'>        <font color='red'>}</font>
<a name='L832'>        <b>else</b> <font color='red'>{</font>
<a name='L833'>            <b>for</b> (j = 0; j &lt; <a href='../D/543.html' title='Multiple defined in 2 places.'>CHUNKSIZE</a>; j++) <font color='red'>{</font>
<a name='L834'>                line = <a href='../S/2775.html#L2700' title='Defined at 2700 in Objects/abstract.c.'>PyIter_Next</a>(iter);
<a name='L835'>                <b>if</b> (line == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L836'>                    <b>if</b> (<a href='../D/3154.html' title='Multiple defined in 2 places.'>PyErr_Occurred</a>())
<a name='L837'>                        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L838'>                    <b>break</b>;
<a name='L839'>                <font color='red'>}</font>
<a name='L840'>                <a href='../S/2796.html#L199' title='Defined at 199 in Objects/listobject.c.'>PyList_SetItem</a>(list, j, line);
<a name='L841'>            <font color='red'>}</font>
<a name='L842'>        <font color='red'>}</font>
<a name='L843'>        <b>if</b> (j == 0)
<a name='L844'>            <b>break</b>;
<a name='L845'>
<a name='L846'>        <i><font color='green'>/* Check that all entries are indeed byte strings. If not,</font></i>
<a name='L847'><i><font color='green'>           apply the same rules as for file.write() and</font></i>
<a name='L848'><i><font color='green'>           convert the rets to strings. This is slow, but</font></i>
<a name='L849'><i><font color='green'>           seems to be the only way since all conversion APIs</font></i>
<a name='L850'><i><font color='green'>           could potentially execute Python code. */</font></i>
<a name='L851'>        <b>for</b> (i = 0; i &lt; j; i++) <font color='red'>{</font>
<a name='L852'>            <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *v = PyList_GET_ITEM(list, i);
<a name='L853'>            <b>if</b> (!PyBytes_Check(v)) <font color='red'>{</font>
<a name='L854'>                <b>const</b> <b>char</b> *<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>;
<a name='L855'>                <a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a> len;
<a name='L856'>                <b>if</b> (<a href='../S/2775.html#L226' title='Defined at 226 in Objects/abstract.c.'>PyObject_AsCharBuffer</a>(v, &amp;<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>, &amp;len)) <font color='red'>{</font>
<a name='L857'>                    <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_TypeError,
<a name='L858'>                                    "writelines() "
<a name='L859'>                                    "argument must be "
<a name='L860'>                                    "a sequence of "
<a name='L861'>                                    "bytes objects");
<a name='L862'>                    <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L863'>                <font color='red'>}</font>
<a name='L864'>                line = <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>(<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>,
<a name='L865'>                                                  len);
<a name='L866'>                <b>if</b> (line == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L867'>                    <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L868'>                Py_DECREF(v);
<a name='L869'>                PyList_SET_ITEM(list, i, line);
<a name='L870'>            <font color='red'>}</font>
<a name='L871'>        <font color='red'>}</font>
<a name='L872'>
<a name='L873'>        <i><font color='green'>/* Since we are releasing the global lock, the</font></i>
<a name='L874'><i><font color='green'>           following code may *not* execute Python code. */</font></i>
<a name='L875'>        <a href='../D/4080.html' title='Multiple defined in 2 places.'>Py_BEGIN_ALLOW_THREADS</a>
<a name='L876'>        <b>for</b> (i = 0; i &lt; j; i++) <font color='red'>{</font>
<a name='L877'>            line = PyList_GET_ITEM(list, i);
<a name='L878'>            len = PyBytes_GET_SIZE(line);
<a name='L879'>            <a href='../S/2626.html#L65' title='Defined at 65 in Modules/bz2module.c.'>BZ2_bzWrite</a> (&amp;bzerror, self-&gt;fp,
<a name='L880'>                         PyBytes_AS_STRING(line), len);
<a name='L881'>            <b>if</b> (bzerror != BZ_OK) <font color='red'>{</font>
<a name='L882'>                <a href='../D/4082.html' title='Multiple defined in 2 places.'>Py_BLOCK_THREADS</a>
<a name='L883'>                <a href='../S/2626.html#L158' title='Defined at 158 in Modules/bz2module.c.'>Util_CatchBZ2Error</a>(bzerror);
<a name='L884'>                <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L885'>            <font color='red'>}</font>
<a name='L886'>        <font color='red'>}</font>
<a name='L887'>        <a href='../D/4114.html' title='Multiple defined in 2 places.'>Py_END_ALLOW_THREADS</a>
<a name='L888'>
<a name='L889'>        <b>if</b> (j &lt; <a href='../D/543.html' title='Multiple defined in 2 places.'>CHUNKSIZE</a>)
<a name='L890'>            <b>break</b>;
<a name='L891'>    <font color='red'>}</font>
<a name='L892'>
<a name='L893'>    Py_INCREF(Py_None);
<a name='L894'>    ret = Py_None;
<a name='L895'>
<a name='L896'>  <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>:
<a name='L897'>    <a href='../D/4465.html' title='Multiple defined in 4 places.'>RELEASE_LOCK</a>(self);
<a name='L898'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(list);
<a name='L899'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(iter);
<a name='L900'>    <b>return</b> ret;
<a name='L901'><font color='darkred'>#undef</font> <a href='../R/509.html' title='Multiple refered from 5 places.'>CHUNKSIZE</a>
<a name='L902'><font color='red'>}</font>
<a name='L903'>
<a name='L904'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(BZ2File_seek__doc__,
<a name='L905'>"seek(offset [, whence]) -&gt; None\n\
<a name='L906'>\n\
<a name='L907'>Move to new file position. Argument offset is a byte count. Optional\n\
<a name='L908'>argument whence defaults to 0 (offset from start of file, offset\n\
<a name='L909'>should be &gt;= 0); other values are 1 (move relative to current position,\n\
<a name='L910'>positive or negative), and 2 (move relative to end of file, usually\n\
<a name='L911'>negative, although many platforms allow seeking beyond the end of a file).\n\
<a name='L912'>\n\
<a name='L913'>Note that seeking of bz2 files is emulated, and depending on the parameters\n\
<a name='L914'>the operation may be extremely slow.\n\
<a name='L915'>");
<a name='L916'>
<a name='L917'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L918'><a href='../S/2626.html#L1160' title='Refered from 1160 in Modules/bz2module.c.'>BZ2File_seek</a>(BZ2FileObject *self, PyObject *args)
<a name='L919'><font color='red'>{</font>
<a name='L920'>    <b>int</b> where = 0;
<a name='L921'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *offobj;
<a name='L922'>    <a href='../D/4353.html' title='Multiple defined in 3 places.'>Py_off_t</a> offset;
<a name='L923'>    <b>char</b> small_buffer[<a href='../D/4764.html' title='Multiple defined in 4 places.'>SMALLCHUNK</a>];
<a name='L924'>    <b>char</b> *<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a> = small_buffer;
<a name='L925'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> buffersize = <a href='../D/4764.html' title='Multiple defined in 4 places.'>SMALLCHUNK</a>;
<a name='L926'>    <a href='../D/4353.html' title='Multiple defined in 3 places.'>Py_off_t</a> bytesread = 0;
<a name='L927'>    <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> readsize;
<a name='L928'>    <b>int</b> <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>;
<a name='L929'>    <b>int</b> bzerror;
<a name='L930'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *ret = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L931'>
<a name='L932'>    <b>if</b> (!<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "O|i:seek", &amp;offobj, &amp;where))
<a name='L933'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L934'><font color='darkred'>#if</font> !<b>defined</b>(<a href='../D/1522.html' title='Multiple defined in 4 places.'>HAVE_LARGEFILE_SUPPORT</a>)
<a name='L935'>    offset = <a href='../S/2799.html#L416' title='Defined at 416 in Objects/longobject.c.'>PyLong_AsLong</a>(offobj);
<a name='L936'><font color='darkred'>#else</font>
<a name='L937'>    offset = PyLong_Check(offobj) ?
<a name='L938'>        <a href='../S/2799.html#L1137' title='Defined at 1137 in Objects/longobject.c.'>PyLong_AsLongLong</a>(offobj) : <a href='../S/2799.html#L416' title='Defined at 416 in Objects/longobject.c.'>PyLong_AsLong</a>(offobj);
<a name='L939'><font color='darkred'>#endif</font>
<a name='L940'>    <b>if</b> (<a href='../D/3154.html' title='Multiple defined in 2 places.'>PyErr_Occurred</a>())
<a name='L941'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L942'>
<a name='L943'>    <a href='../D/20.html' title='Multiple defined in 4 places.'>ACQUIRE_LOCK</a>(self);
<a name='L944'>    <a href='../S/2626.html#L314' title='Defined at 314 in Modules/bz2module.c.'>Util_DropReadAhead</a>(self);
<a name='L945'>    <b>switch</b> (self-&gt;mode) <font color='red'>{</font>
<a name='L946'>        <b>case</b> <a href='../S/2626.html#L40' title='Defined at 40 in Modules/bz2module.c.'>MODE_READ</a>:
<a name='L947'>        <b>case</b> <a href='../S/2626.html#L41' title='Defined at 41 in Modules/bz2module.c.'>MODE_READ_EOF</a>:
<a name='L948'>            <b>break</b>;
<a name='L949'>
<a name='L950'>        <b>case</b> <a href='../S/2626.html#L39' title='Defined at 39 in Modules/bz2module.c.'>MODE_CLOSED</a>:
<a name='L951'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError,
<a name='L952'>                            "I/O operation on closed file");
<a name='L953'>            <b>goto</b> cleanup;
<a name='L954'>
<a name='L955'>        <b>default</b>:
<a name='L956'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_IOError,
<a name='L957'>                            "seek works only while reading");
<a name='L958'>            <b>goto</b> cleanup;
<a name='L959'>    <font color='red'>}</font>
<a name='L960'>
<a name='L961'>    <b>if</b> (where == 2) <font color='red'>{</font>
<a name='L962'>        <b>if</b> (self-&gt;size == -1) <font color='red'>{</font>
<a name='L963'>            <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(self-&gt;mode != <a href='../S/2626.html#L41' title='Defined at 41 in Modules/bz2module.c.'>MODE_READ_EOF</a>);
<a name='L964'>            <b>for</b> (;;) <font color='red'>{</font>
<a name='L965'>                <a href='../D/4080.html' title='Multiple defined in 2 places.'>Py_BEGIN_ALLOW_THREADS</a>
<a name='L966'>                <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a> = <a href='../S/2626.html#L62' title='Defined at 62 in Modules/bz2module.c.'>BZ2_bzRead</a>(&amp;bzerror, self-&gt;fp,
<a name='L967'>                                       <a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>, buffersize);
<a name='L968'>                self-&gt;pos += <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>;
<a name='L969'>                <a href='../D/4114.html' title='Multiple defined in 2 places.'>Py_END_ALLOW_THREADS</a>
<a name='L970'>
<a name='L971'>                bytesread += <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>;
<a name='L972'>                <b>if</b> (bzerror == BZ_STREAM_END) <font color='red'>{</font>
<a name='L973'>                    <b>break</b>;
<a name='L974'>                <font color='red'>}</font> <b>else</b> <b>if</b> (bzerror != BZ_OK) <font color='red'>{</font>
<a name='L975'>                    <a href='../S/2626.html#L158' title='Defined at 158 in Modules/bz2module.c.'>Util_CatchBZ2Error</a>(bzerror);
<a name='L976'>                    <b>goto</b> cleanup;
<a name='L977'>                <font color='red'>}</font>
<a name='L978'>            <font color='red'>}</font>
<a name='L979'>            self-&gt;mode = <a href='../S/2626.html#L41' title='Defined at 41 in Modules/bz2module.c.'>MODE_READ_EOF</a>;
<a name='L980'>            self-&gt;size = self-&gt;pos;
<a name='L981'>            bytesread = 0;
<a name='L982'>        <font color='red'>}</font>
<a name='L983'>        offset = self-&gt;size + offset;
<a name='L984'>    <font color='red'>}</font> <b>else</b> <b>if</b> (where == 1) <font color='red'>{</font>
<a name='L985'>        offset = self-&gt;pos + offset;
<a name='L986'>    <font color='red'>}</font>
<a name='L987'>
<a name='L988'>    <i><font color='green'>/* Before getting here, offset must be the absolute position the file</font></i>
<a name='L989'><i><font color='green'>     * pointer should be set to. */</font></i>
<a name='L990'>
<a name='L991'>    <b>if</b> (offset &gt;= self-&gt;pos) <font color='red'>{</font>
<a name='L992'>        <i><font color='green'>/* we can move forward */</font></i>
<a name='L993'>        offset -= self-&gt;pos;
<a name='L994'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L995'>        <i><font color='green'>/* we cannot move back, so rewind the stream */</font></i>
<a name='L996'>        <a href='../S/2626.html#L64' title='Defined at 64 in Modules/bz2module.c.'>BZ2_bzReadClose</a>(&amp;bzerror, self-&gt;fp);
<a name='L997'>        <b>if</b> (bzerror != BZ_OK) <font color='red'>{</font>
<a name='L998'>            <a href='../S/2626.html#L158' title='Defined at 158 in Modules/bz2module.c.'>Util_CatchBZ2Error</a>(bzerror);
<a name='L999'>            <b>goto</b> cleanup;
<a name='L1000'>        <font color='red'>}</font>
<a name='L1001'>        rewind(self-&gt;rawfp);
<a name='L1002'>        self-&gt;pos = 0;
<a name='L1003'>        self-&gt;fp = <a href='../S/2626.html#L63' title='Defined at 63 in Modules/bz2module.c.'>BZ2_bzReadOpen</a>(&amp;bzerror, self-&gt;rawfp,
<a name='L1004'>                                  0, 0, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, 0);
<a name='L1005'>        <b>if</b> (bzerror != BZ_OK) <font color='red'>{</font>
<a name='L1006'>            <a href='../S/2626.html#L158' title='Defined at 158 in Modules/bz2module.c.'>Util_CatchBZ2Error</a>(bzerror);
<a name='L1007'>            <b>goto</b> cleanup;
<a name='L1008'>        <font color='red'>}</font>
<a name='L1009'>        self-&gt;mode = <a href='../S/2626.html#L40' title='Defined at 40 in Modules/bz2module.c.'>MODE_READ</a>;
<a name='L1010'>    <font color='red'>}</font>
<a name='L1011'>
<a name='L1012'>    <b>if</b> (offset &lt;= 0 || self-&gt;mode == <a href='../S/2626.html#L41' title='Defined at 41 in Modules/bz2module.c.'>MODE_READ_EOF</a>)
<a name='L1013'>        <b>goto</b> exit;
<a name='L1014'>
<a name='L1015'>    <i><font color='green'>/* Before getting here, offset must be set to the number of bytes</font></i>
<a name='L1016'><i><font color='green'>     * to walk forward. */</font></i>
<a name='L1017'>    <b>for</b> (;;) <font color='red'>{</font>
<a name='L1018'>        <b>if</b> (offset-bytesread &gt; buffersize)
<a name='L1019'>            readsize = buffersize;
<a name='L1020'>        <b>else</b>
<a name='L1021'>            <i><font color='green'>/* offset might be wider that readsize, but the result</font></i>
<a name='L1022'><i><font color='green'>             * of the subtraction is bound by buffersize (see the</font></i>
<a name='L1023'><i><font color='green'>             * condition above). buffersize is 8192. */</font></i>
<a name='L1024'>            readsize = (<a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>)(offset-bytesread);
<a name='L1025'>        <a href='../D/4080.html' title='Multiple defined in 2 places.'>Py_BEGIN_ALLOW_THREADS</a>
<a name='L1026'>        <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a> = <a href='../S/2626.html#L62' title='Defined at 62 in Modules/bz2module.c.'>BZ2_bzRead</a>(&amp;bzerror, self-&gt;fp, <a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>, readsize);
<a name='L1027'>        self-&gt;pos += <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>;
<a name='L1028'>        <a href='../D/4114.html' title='Multiple defined in 2 places.'>Py_END_ALLOW_THREADS</a>
<a name='L1029'>        bytesread += <a href='../S/2317.html#L1669' title='Defined at 1669 in Modules/_ctypes/libffi/src/dlmalloc.c.'>chunksize</a>;
<a name='L1030'>        <b>if</b> (bzerror == BZ_STREAM_END) <font color='red'>{</font>
<a name='L1031'>            self-&gt;size = self-&gt;pos;
<a name='L1032'>            self-&gt;mode = <a href='../S/2626.html#L41' title='Defined at 41 in Modules/bz2module.c.'>MODE_READ_EOF</a>;
<a name='L1033'>            <b>break</b>;
<a name='L1034'>        <font color='red'>}</font> <b>else</b> <b>if</b> (bzerror != BZ_OK) <font color='red'>{</font>
<a name='L1035'>            <a href='../S/2626.html#L158' title='Defined at 158 in Modules/bz2module.c.'>Util_CatchBZ2Error</a>(bzerror);
<a name='L1036'>            <b>goto</b> cleanup;
<a name='L1037'>        <font color='red'>}</font>
<a name='L1038'>        <b>if</b> (bytesread == offset)
<a name='L1039'>            <b>break</b>;
<a name='L1040'>    <font color='red'>}</font>
<a name='L1041'>
<a name='L1042'>exit:
<a name='L1043'>    Py_INCREF(Py_None);
<a name='L1044'>    ret = Py_None;
<a name='L1045'>
<a name='L1046'>cleanup:
<a name='L1047'>    <a href='../D/4465.html' title='Multiple defined in 4 places.'>RELEASE_LOCK</a>(self);
<a name='L1048'>    <b>return</b> ret;
<a name='L1049'><font color='red'>}</font>
<a name='L1050'>
<a name='L1051'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(BZ2File_tell__doc__,
<a name='L1052'>"tell() -&gt; int\n\
<a name='L1053'>\n\
<a name='L1054'>Return the current file position, an integer (may be a long integer).\n\
<a name='L1055'>");
<a name='L1056'>
<a name='L1057'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1058'><a href='../S/2626.html#L1161' title='Refered from 1161 in Modules/bz2module.c.'>BZ2File_tell</a>(BZ2FileObject *self, PyObject *args)
<a name='L1059'><font color='red'>{</font>
<a name='L1060'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *ret = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1061'>
<a name='L1062'>    <b>if</b> (self-&gt;mode == <a href='../S/2626.html#L39' title='Defined at 39 in Modules/bz2module.c.'>MODE_CLOSED</a>) <font color='red'>{</font>
<a name='L1063'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError,
<a name='L1064'>                        "I/O operation on closed file");
<a name='L1065'>        <b>goto</b> cleanup;
<a name='L1066'>    <font color='red'>}</font>
<a name='L1067'>
<a name='L1068'><font color='darkred'>#if</font> !<b>defined</b>(<a href='../D/1522.html' title='Multiple defined in 4 places.'>HAVE_LARGEFILE_SUPPORT</a>)
<a name='L1069'>    ret = <a href='../S/2799.html#L176' title='Defined at 176 in Objects/longobject.c.'>PyLong_FromLong</a>(self-&gt;pos);
<a name='L1070'><font color='darkred'>#else</font>
<a name='L1071'>    ret = <a href='../S/2799.html#L994' title='Defined at 994 in Objects/longobject.c.'>PyLong_FromLongLong</a>(self-&gt;pos);
<a name='L1072'><font color='darkred'>#endif</font>
<a name='L1073'>
<a name='L1074'>cleanup:
<a name='L1075'>    <b>return</b> ret;
<a name='L1076'><font color='red'>}</font>
<a name='L1077'>
<a name='L1078'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(BZ2File_close__doc__,
<a name='L1079'>"close() -&gt; None or (perhaps) an integer\n\
<a name='L1080'>\n\
<a name='L1081'>Close the file. Sets data attribute .closed to true. A closed file\n\
<a name='L1082'>cannot be used for further I/O operations. close() may be called more\n\
<a name='L1083'>than once without error.\n\
<a name='L1084'>");
<a name='L1085'>
<a name='L1086'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1087'><a href='../S/2626.html#L1162' title='Refered from 1162 in Modules/bz2module.c.'>BZ2File_close</a>(BZ2FileObject *self)
<a name='L1088'><font color='red'>{</font>
<a name='L1089'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *ret = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1090'>    <b>int</b> bzerror = BZ_OK;
<a name='L1091'>
<a name='L1092'>    <b>if</b> (self-&gt;mode == <a href='../S/2626.html#L39' title='Defined at 39 in Modules/bz2module.c.'>MODE_CLOSED</a>) <font color='red'>{</font>
<a name='L1093'>        <a href='../S/2562.html#L112' title='Defined at 112 in Modules/_elementtree.c.'>Py_RETURN_NONE</a>;
<a name='L1094'>    <font color='red'>}</font>
<a name='L1095'>
<a name='L1096'>    <a href='../D/20.html' title='Multiple defined in 4 places.'>ACQUIRE_LOCK</a>(self);
<a name='L1097'>    <b>switch</b> (self-&gt;mode) <font color='red'>{</font>
<a name='L1098'>        <b>case</b> <a href='../S/2626.html#L40' title='Defined at 40 in Modules/bz2module.c.'>MODE_READ</a>:
<a name='L1099'>        <b>case</b> <a href='../S/2626.html#L41' title='Defined at 41 in Modules/bz2module.c.'>MODE_READ_EOF</a>:
<a name='L1100'>            <a href='../S/2626.html#L64' title='Defined at 64 in Modules/bz2module.c.'>BZ2_bzReadClose</a>(&amp;bzerror, self-&gt;fp);
<a name='L1101'>            <b>break</b>;
<a name='L1102'>        <b>case</b> <a href='../S/2626.html#L42' title='Defined at 42 in Modules/bz2module.c.'>MODE_WRITE</a>:
<a name='L1103'>            <a href='../S/2626.html#L67' title='Defined at 67 in Modules/bz2module.c.'>BZ2_bzWriteClose</a>(&amp;bzerror, self-&gt;fp,
<a name='L1104'>                             0, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L1105'>            <b>break</b>;
<a name='L1106'>    <font color='red'>}</font>
<a name='L1107'>    self-&gt;mode = <a href='../S/2626.html#L39' title='Defined at 39 in Modules/bz2module.c.'>MODE_CLOSED</a>;
<a name='L1108'>    fclose(self-&gt;rawfp);
<a name='L1109'>    self-&gt;rawfp = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1110'>    <b>if</b> (bzerror == BZ_OK) <font color='red'>{</font>
<a name='L1111'>        Py_INCREF(Py_None);
<a name='L1112'>        ret = Py_None;
<a name='L1113'>    <font color='red'>}</font>
<a name='L1114'>    <b>else</b> <font color='red'>{</font>
<a name='L1115'>        <a href='../S/2626.html#L158' title='Defined at 158 in Modules/bz2module.c.'>Util_CatchBZ2Error</a>(bzerror);
<a name='L1116'>    <font color='red'>}</font>
<a name='L1117'>
<a name='L1118'>    <a href='../D/4465.html' title='Multiple defined in 4 places.'>RELEASE_LOCK</a>(self);
<a name='L1119'>    <b>return</b> ret;
<a name='L1120'><font color='red'>}</font>
<a name='L1121'>
<a name='L1122'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(BZ2File_enter_doc,
<a name='L1123'>"__enter__() -&gt; self.");
<a name='L1124'>
<a name='L1125'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1126'><a href='../S/2626.html#L1163' title='Refered from 1163 in Modules/bz2module.c.'>BZ2File_enter</a>(BZ2FileObject *self)
<a name='L1127'><font color='red'>{</font>
<a name='L1128'>    <b>if</b> (self-&gt;mode == <a href='../S/2626.html#L39' title='Defined at 39 in Modules/bz2module.c.'>MODE_CLOSED</a>) <font color='red'>{</font>
<a name='L1129'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError,
<a name='L1130'>            "I/O operation on closed file");
<a name='L1131'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1132'>    <font color='red'>}</font>
<a name='L1133'>    Py_INCREF(self);
<a name='L1134'>    <b>return</b> (<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *) self;
<a name='L1135'><font color='red'>}</font>
<a name='L1136'>
<a name='L1137'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(BZ2File_exit_doc,
<a name='L1138'>"__exit__(*excinfo) -&gt; None.  Closes the file.");
<a name='L1139'>
<a name='L1140'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1141'><a href='../S/2626.html#L1164' title='Refered from 1164 in Modules/bz2module.c.'>BZ2File_exit</a>(BZ2FileObject *self, PyObject *args)
<a name='L1142'><font color='red'>{</font>
<a name='L1143'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *ret = <a href='../D/3603.html' title='Multiple defined in 2 places.'>PyObject_CallMethod</a>((<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *) self, "close", <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L1144'>    <b>if</b> (!ret)
<a name='L1145'>        <i><font color='green'>/* If error occurred, pass through */</font></i>
<a name='L1146'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1147'>    Py_DECREF(ret);
<a name='L1148'>    <a href='../S/2562.html#L112' title='Defined at 112 in Modules/_elementtree.c.'>Py_RETURN_NONE</a>;
<a name='L1149'><font color='red'>}</font>
<a name='L1150'>
<a name='L1151'>
<a name='L1152'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *<a href='../S/2626.html#L1324' title='Defined at 1324 in Modules/bz2module.c.'>BZ2File_getiter</a>(BZ2FileObject *self);
<a name='L1153'>
<a name='L1154'><b>static</b> <a href='../D/3525.html' title='Multiple defined in 3 places.'>PyMethodDef</a> BZ2File_methods[] = <font color='red'>{</font>
<a name='L1155'>    <font color='red'>{</font>"read", (PyCFunction)<a href='../S/2626.html#L419' title='Defined at 419 in Modules/bz2module.c.'>BZ2File_read</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a>, BZ2File_read__doc__<font color='red'>}</font>,
<a name='L1156'>    <font color='red'>{</font>"readline", (PyCFunction)<a href='../S/2626.html#L514' title='Defined at 514 in Modules/bz2module.c.'>BZ2File_readline</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a>, BZ2File_readline__doc__<font color='red'>}</font>,
<a name='L1157'>    <font color='red'>{</font>"readlines", (PyCFunction)<a href='../S/2626.html#L563' title='Defined at 563 in Modules/bz2module.c.'>BZ2File_readlines</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a>, BZ2File_readlines__doc__<font color='red'>}</font>,
<a name='L1158'>    <font color='red'>{</font>"write", (PyCFunction)<a href='../S/2626.html#L724' title='Defined at 724 in Modules/bz2module.c.'>BZ2File_write</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a>, BZ2File_write__doc__<font color='red'>}</font>,
<a name='L1159'>    <font color='red'>{</font>"writelines", (PyCFunction)<a href='../S/2626.html#L782' title='Defined at 782 in Modules/bz2module.c.'>BZ2File_writelines</a>, METH_O, BZ2File_writelines__doc__<font color='red'>}</font>,
<a name='L1160'>    <font color='red'>{</font>"seek", (PyCFunction)<a href='../S/2626.html#L918' title='Defined at 918 in Modules/bz2module.c.'>BZ2File_seek</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a>, BZ2File_seek__doc__<font color='red'>}</font>,
<a name='L1161'>    <font color='red'>{</font>"tell", (PyCFunction)<a href='../S/2626.html#L1058' title='Defined at 1058 in Modules/bz2module.c.'>BZ2File_tell</a>, <a href='../S/2858.html#L634' title='Defined at 634 in PC/bdist_wininst/install.c.'>METH_NOARGS</a>, BZ2File_tell__doc__<font color='red'>}</font>,
<a name='L1162'>    <font color='red'>{</font>"close", (PyCFunction)<a href='../S/2626.html#L1087' title='Defined at 1087 in Modules/bz2module.c.'>BZ2File_close</a>, <a href='../S/2858.html#L634' title='Defined at 634 in PC/bdist_wininst/install.c.'>METH_NOARGS</a>, BZ2File_close__doc__<font color='red'>}</font>,
<a name='L1163'>    <font color='red'>{</font>"__enter__", (PyCFunction)<a href='../S/2626.html#L1126' title='Defined at 1126 in Modules/bz2module.c.'>BZ2File_enter</a>, <a href='../S/2858.html#L634' title='Defined at 634 in PC/bdist_wininst/install.c.'>METH_NOARGS</a>, BZ2File_enter_doc<font color='red'>}</font>,
<a name='L1164'>    <font color='red'>{</font>"__exit__", (PyCFunction)<a href='../S/2626.html#L1141' title='Defined at 1141 in Modules/bz2module.c.'>BZ2File_exit</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a>, BZ2File_exit_doc<font color='red'>}</font>,
<a name='L1165'>    <font color='red'>{</font><a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,              <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>           <i><font color='green'>/* sentinel */</font></i>
<a name='L1166'><font color='red'>}</font>;
<a name='L1167'>
<a name='L1168'>
<a name='L1169'><i><font color='green'>/* ===================================================================== */</font></i>
<a name='L1170'><i><font color='green'>/* Getters and setters of BZ2File. */</font></i>
<a name='L1171'>
<a name='L1172'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1173'><a href='../S/2626.html#L1179' title='Refered from 1179 in Modules/bz2module.c.'>BZ2File_get_closed</a>(BZ2FileObject *self, <b>void</b> *closure)
<a name='L1174'><font color='red'>{</font>
<a name='L1175'>    <b>return</b> <a href='../S/2799.html#L176' title='Defined at 176 in Objects/longobject.c.'>PyLong_FromLong</a>(self-&gt;mode == <a href='../S/2626.html#L39' title='Defined at 39 in Modules/bz2module.c.'>MODE_CLOSED</a>);
<a name='L1176'><font color='red'>}</font>
<a name='L1177'>
<a name='L1178'><b>static</b> <a href='../D/3272.html' title='Multiple defined in 2 places.'>PyGetSetDef</a> BZ2File_getset[] = <font color='red'>{</font>
<a name='L1179'>    <font color='red'>{</font>"closed", (getter)<a href='../S/2626.html#L1173' title='Defined at 1173 in Modules/bz2module.c.'>BZ2File_get_closed</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L1180'>                    "True if the file is closed"<font color='red'>}</font>,
<a name='L1181'>    <font color='red'>{</font><a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>      <i><font color='green'>/* Sentinel */</font></i>
<a name='L1182'><font color='red'>}</font>;
<a name='L1183'>
<a name='L1184'>
<a name='L1185'><i><font color='green'>/* ===================================================================== */</font></i>
<a name='L1186'><i><font color='green'>/* Slot definitions for BZ2File_Type. */</font></i>
<a name='L1187'>
<a name='L1188'><b>static</b> <b>int</b>
<a name='L1189'><a href='../S/2626.html#L1408' title='Refered from 1408 in Modules/bz2module.c.'>BZ2File_init</a>(BZ2FileObject *self, PyObject *args, PyObject *kwargs)
<a name='L1190'><font color='red'>{</font>
<a name='L1191'>    <b>static</b> <b>char</b> *kwlist[] = <font color='red'>{</font>"filename", "mode", "buffering",
<a name='L1192'>                             "compresslevel", 0<font color='red'>}</font>;
<a name='L1193'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *name_obj = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1194'>    <b>char</b> *name;
<a name='L1195'>    <b>char</b> *mode = "r";
<a name='L1196'>    <b>int</b> buffering = -1;
<a name='L1197'>    <b>int</b> compresslevel = 9;
<a name='L1198'>    <b>int</b> bzerror;
<a name='L1199'>    <b>int</b> mode_char = 0;
<a name='L1200'>
<a name='L1201'>    self-&gt;size = -1;
<a name='L1202'>
<a name='L1203'>    <b>if</b> (!<a href='../D/2732.html' title='Multiple defined in 2 places.'>PyArg_ParseTupleAndKeywords</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, kwargs, "O&amp;|sii:BZ2File",
<a name='L1204'>                                     kwlist, <a href='../D/4003.html' title='Multiple defined in 3 places.'>PyUnicode_FSConverter</a>, &amp;name_obj,
<a name='L1205'>                                     &amp;mode, &amp;buffering,
<a name='L1206'>                                     &amp;compresslevel))
<a name='L1207'>        <b>return</b> -1;
<a name='L1208'>
<a name='L1209'>    name = <a href='../S/2779.html#L517' title='Defined at 517 in Objects/bytesobject.c.'>PyBytes_AsString</a>(name_obj);
<a name='L1210'>    <b>if</b> (compresslevel &lt; 1 || compresslevel &gt; 9) <font color='red'>{</font>
<a name='L1211'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError,
<a name='L1212'>                        "compresslevel must be between 1 and 9");
<a name='L1213'>        Py_DECREF(name_obj);
<a name='L1214'>        <b>return</b> -1;
<a name='L1215'>    <font color='red'>}</font>
<a name='L1216'>
<a name='L1217'>    <b>for</b> (;;) <font color='red'>{</font>
<a name='L1218'>        <b>int</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a> = 0;
<a name='L1219'>        <b>switch</b> (*mode) <font color='red'>{</font>
<a name='L1220'>            <b>case</b> 'r':
<a name='L1221'>            <b>case</b> 'w':
<a name='L1222'>                <b>if</b> (mode_char)
<a name='L1223'>                    <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a> = 1;
<a name='L1224'>                mode_char = *mode;
<a name='L1225'>                <b>break</b>;
<a name='L1226'>
<a name='L1227'>            <b>case</b> 'b':
<a name='L1228'>                <b>break</b>;
<a name='L1229'>
<a name='L1230'>            <b>default</b>:
<a name='L1231'>                <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a> = 1;
<a name='L1232'>                <b>break</b>;
<a name='L1233'>        <font color='red'>}</font>
<a name='L1234'>        <b>if</b> (<a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>) <font color='red'>{</font>
<a name='L1235'>            <a href='../S/3106.html#L600' title='Defined at 600 in Python/errors.c.'>PyErr_Format</a>(PyExc_ValueError,
<a name='L1236'>                         "invalid mode char %c", *mode);
<a name='L1237'>            Py_DECREF(name_obj);
<a name='L1238'>            <b>return</b> -1;
<a name='L1239'>        <font color='red'>}</font>
<a name='L1240'>        mode++;
<a name='L1241'>        <b>if</b> (*mode == '\0')
<a name='L1242'>            <b>break</b>;
<a name='L1243'>    <font color='red'>}</font>
<a name='L1244'>
<a name='L1245'>    <b>if</b> (mode_char == 0) <font color='red'>{</font>
<a name='L1246'>        mode_char = 'r';
<a name='L1247'>    <font color='red'>}</font>
<a name='L1248'>
<a name='L1249'>    mode = (mode_char == 'r') ? "rb" : "wb";
<a name='L1250'>
<a name='L1251'>    self-&gt;rawfp = fopen(name, mode);
<a name='L1252'>    Py_DECREF(name_obj);
<a name='L1253'>    <b>if</b> (self-&gt;rawfp == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L1254'>        <a href='../S/3106.html#L452' title='Defined at 452 in Python/errors.c.'>PyErr_SetFromErrno</a>(PyExc_IOError);
<a name='L1255'>        <b>return</b> -1;
<a name='L1256'>    <font color='red'>}</font>
<a name='L1257'>    <i><font color='green'>/* XXX Ignore buffering */</font></i>
<a name='L1258'>
<a name='L1259'>    <i><font color='green'>/* From now on, we have stuff to dealloc, so jump to error label</font></i>
<a name='L1260'><i><font color='green'>     * instead of returning */</font></i>
<a name='L1261'>
<a name='L1262'><font color='darkred'>#ifdef</font> <a href='../D/5537.html' title='Multiple defined in 3 places.'>WITH_THREAD</a>
<a name='L1263'>    self-&gt;<a href='../S/3148.html#L9' title='Defined at 9 in Python/thread_lwp.h.'>lock</a> = <a href='../D/3848.html' title='Multiple defined in 11 places.'>PyThread_allocate_lock</a>();
<a name='L1264'>    <b>if</b> (!self-&gt;<a href='../S/3148.html#L9' title='Defined at 9 in Python/thread_lwp.h.'>lock</a>) <font color='red'>{</font>
<a name='L1265'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_MemoryError, "unable to allocate lock");
<a name='L1266'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1267'>    <font color='red'>}</font>
<a name='L1268'><font color='darkred'>#endif</font>
<a name='L1269'>
<a name='L1270'>    <b>if</b> (mode_char == 'r')
<a name='L1271'>        self-&gt;fp = <a href='../S/2626.html#L63' title='Defined at 63 in Modules/bz2module.c.'>BZ2_bzReadOpen</a>(&amp;bzerror, self-&gt;rawfp,
<a name='L1272'>                                  0, 0, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, 0);
<a name='L1273'>    <b>else</b>
<a name='L1274'>        self-&gt;fp = <a href='../S/2626.html#L66' title='Defined at 66 in Modules/bz2module.c.'>BZ2_bzWriteOpen</a>(&amp;bzerror, self-&gt;rawfp,
<a name='L1275'>                                   compresslevel, 0, 0);
<a name='L1276'>
<a name='L1277'>    <b>if</b> (bzerror != BZ_OK) <font color='red'>{</font>
<a name='L1278'>        <a href='../S/2626.html#L158' title='Defined at 158 in Modules/bz2module.c.'>Util_CatchBZ2Error</a>(bzerror);
<a name='L1279'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1280'>    <font color='red'>}</font>
<a name='L1281'>
<a name='L1282'>    self-&gt;mode = (mode_char == 'r') ? <a href='../S/2626.html#L40' title='Defined at 40 in Modules/bz2module.c.'>MODE_READ</a> : <a href='../S/2626.html#L42' title='Defined at 42 in Modules/bz2module.c.'>MODE_WRITE</a>;
<a name='L1283'>
<a name='L1284'>    <b>return</b> 0;
<a name='L1285'>
<a name='L1286'><a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>:
<a name='L1287'>    fclose(self-&gt;rawfp);
<a name='L1288'>    self-&gt;rawfp = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1289'><font color='darkred'>#ifdef</font> <a href='../D/5537.html' title='Multiple defined in 3 places.'>WITH_THREAD</a>
<a name='L1290'>    <b>if</b> (self-&gt;<a href='../S/3148.html#L9' title='Defined at 9 in Python/thread_lwp.h.'>lock</a>) <font color='red'>{</font>
<a name='L1291'>        <a href='../D/3853.html' title='Multiple defined in 11 places.'>PyThread_free_lock</a>(self-&gt;<a href='../S/3148.html#L9' title='Defined at 9 in Python/thread_lwp.h.'>lock</a>);
<a name='L1292'>        self-&gt;<a href='../S/3148.html#L9' title='Defined at 9 in Python/thread_lwp.h.'>lock</a> = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1293'>    <font color='red'>}</font>
<a name='L1294'><font color='darkred'>#endif</font>
<a name='L1295'>    <b>return</b> -1;
<a name='L1296'><font color='red'>}</font>
<a name='L1297'>
<a name='L1298'><b>static</b> <b>void</b>
<a name='L1299'><a href='../S/2626.html#L1377' title='Refered from 1377 in Modules/bz2module.c.'>BZ2File_dealloc</a>(BZ2FileObject *self)
<a name='L1300'><font color='red'>{</font>
<a name='L1301'>    <b>int</b> bzerror;
<a name='L1302'><font color='darkred'>#ifdef</font> <a href='../D/5537.html' title='Multiple defined in 3 places.'>WITH_THREAD</a>
<a name='L1303'>    <b>if</b> (self-&gt;<a href='../S/3148.html#L9' title='Defined at 9 in Python/thread_lwp.h.'>lock</a>)
<a name='L1304'>        <a href='../D/3853.html' title='Multiple defined in 11 places.'>PyThread_free_lock</a>(self-&gt;<a href='../S/3148.html#L9' title='Defined at 9 in Python/thread_lwp.h.'>lock</a>);
<a name='L1305'><font color='darkred'>#endif</font>
<a name='L1306'>    <b>switch</b> (self-&gt;mode) <font color='red'>{</font>
<a name='L1307'>        <b>case</b> <a href='../S/2626.html#L40' title='Defined at 40 in Modules/bz2module.c.'>MODE_READ</a>:
<a name='L1308'>        <b>case</b> <a href='../S/2626.html#L41' title='Defined at 41 in Modules/bz2module.c.'>MODE_READ_EOF</a>:
<a name='L1309'>            <a href='../S/2626.html#L64' title='Defined at 64 in Modules/bz2module.c.'>BZ2_bzReadClose</a>(&amp;bzerror, self-&gt;fp);
<a name='L1310'>            <b>break</b>;
<a name='L1311'>        <b>case</b> <a href='../S/2626.html#L42' title='Defined at 42 in Modules/bz2module.c.'>MODE_WRITE</a>:
<a name='L1312'>            <a href='../S/2626.html#L67' title='Defined at 67 in Modules/bz2module.c.'>BZ2_bzWriteClose</a>(&amp;bzerror, self-&gt;fp,
<a name='L1313'>                             0, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L1314'>            <b>break</b>;
<a name='L1315'>    <font color='red'>}</font>
<a name='L1316'>    <a href='../S/2626.html#L314' title='Defined at 314 in Modules/bz2module.c.'>Util_DropReadAhead</a>(self);
<a name='L1317'>    <b>if</b> (self-&gt;rawfp != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1318'>        fclose(self-&gt;rawfp);
<a name='L1319'>    <a href='../D/4259.html' title='Multiple defined in 5 places.'>Py_TYPE</a>(self)-&gt;tp_free((<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *)self);
<a name='L1320'><font color='red'>}</font>
<a name='L1321'>
<a name='L1322'><i><font color='green'>/* This is a hacked version of Python's fileobject.c:file_getiter(). */</font></i>
<a name='L1323'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1324'><a href='../R/361.html' title='Multiple refered from 2 places.'>BZ2File_getiter</a>(BZ2FileObject *self)
<a name='L1325'><font color='red'>{</font>
<a name='L1326'>    <b>if</b> (self-&gt;mode == <a href='../S/2626.html#L39' title='Defined at 39 in Modules/bz2module.c.'>MODE_CLOSED</a>) <font color='red'>{</font>
<a name='L1327'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError,
<a name='L1328'>                        "I/O operation on closed file");
<a name='L1329'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1330'>    <font color='red'>}</font>
<a name='L1331'>    Py_INCREF((<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a>*)self);
<a name='L1332'>    <b>return</b> (<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *)self;
<a name='L1333'><font color='red'>}</font>
<a name='L1334'>
<a name='L1335'><i><font color='green'>/* This is a hacked version of Python's fileobject.c:file_iternext(). */</font></i>
<a name='L1336'><font color='darkred'>#define</font> <a href='../S/2626.html#L1348' title='Refered from 1348 in Modules/bz2module.c.'>READAHEAD_BUFSIZE</a> 8192
<a name='L1337'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1338'><a href='../S/2626.html#L1399' title='Refered from 1399 in Modules/bz2module.c.'>BZ2File_iternext</a>(BZ2FileObject *self)
<a name='L1339'><font color='red'>{</font>
<a name='L1340'>    <a href='../S/507.html#L41' title='Defined at 41 in Include/bytesobject.h.'>PyBytesObject</a>* ret;
<a name='L1341'>    <a href='../D/20.html' title='Multiple defined in 4 places.'>ACQUIRE_LOCK</a>(self);
<a name='L1342'>    <b>if</b> (self-&gt;mode == <a href='../S/2626.html#L39' title='Defined at 39 in Modules/bz2module.c.'>MODE_CLOSED</a>) <font color='red'>{</font>
<a name='L1343'>        <a href='../D/4465.html' title='Multiple defined in 4 places.'>RELEASE_LOCK</a>(self);
<a name='L1344'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError,
<a name='L1345'>                        "I/O operation on closed file");
<a name='L1346'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1347'>    <font color='red'>}</font>
<a name='L1348'>    ret = <a href='../S/2626.html#L364' title='Defined at 364 in Modules/bz2module.c.'>Util_ReadAheadGetLineSkip</a>(self, 0, <a href='../S/2626.html#L1336' title='Defined at 1336 in Modules/bz2module.c.'>READAHEAD_BUFSIZE</a>);
<a name='L1349'>    <a href='../D/4465.html' title='Multiple defined in 4 places.'>RELEASE_LOCK</a>(self);
<a name='L1350'>    <b>if</b> (ret == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> || PyBytes_GET_SIZE(ret) == 0) <font color='red'>{</font>
<a name='L1351'>        <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(ret);
<a name='L1352'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1353'>    <font color='red'>}</font>
<a name='L1354'>    <b>return</b> (<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *)ret;
<a name='L1355'><font color='red'>}</font>
<a name='L1356'>
<a name='L1357'><i><font color='green'>/* ===================================================================== */</font></i>
<a name='L1358'><i><font color='green'>/* BZ2File_Type definition. */</font></i>
<a name='L1359'>
<a name='L1360'><a href='../S/570.html#L160' title='Defined at 160 in Include/Python.h.'>PyDoc_VAR</a>(BZ2File__doc__) =
<a name='L1361'><a href='../D/3130.html' title='Multiple defined in 4 places.'>PyDoc_STR</a>(
<a name='L1362'>"BZ2File(name [, mode='r', buffering=0, compresslevel=9]) -&gt; file object\n\
<a name='L1363'>\n\
<a name='L1364'>Open a bz2 file. The mode can be 'r' or 'w', for reading (default) or\n\
<a name='L1365'>writing. When opened for writing, the file will be created if it doesn't\n\
<a name='L1366'>exist, and truncated otherwise. If the buffering argument is given, 0 means\n\
<a name='L1367'>unbuffered, and larger numbers specify the buffer size. If compresslevel\n\
<a name='L1368'>is given, must be a number between 1 and 9.\n\
<a name='L1369'>Data read is always returned in bytes; data written ought to be bytes.\n\
<a name='L1370'>");
<a name='L1371'>
<a name='L1372'><b>static</b> <a href='../D/3899.html' title='Multiple defined in 3 places.'>PyTypeObject</a> BZ2File_Type = <font color='red'>{</font>
<a name='L1373'>    <a href='../D/4042.html' title='Multiple defined in 3 places.'>PyVarObject_HEAD_INIT</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, 0)
<a name='L1374'>    "bz2.BZ2File",              <i><font color='green'>/*tp_name*/</font></i>
<a name='L1375'>    <b>sizeof</b>(<a href='../S/2626.html#L117' title='Defined at 117 in Modules/bz2module.c.'>BZ2FileObject</a>),      <i><font color='green'>/*tp_basicsize*/</font></i>
<a name='L1376'>    0,                          <i><font color='green'>/*tp_itemsize*/</font></i>
<a name='L1377'>    (<a href='../D/8095.html' title='Multiple defined in 2 places.'>destructor</a>)<a href='../S/2626.html#L1299' title='Defined at 1299 in Modules/bz2module.c.'>BZ2File_dealloc</a>, <i><font color='green'>/*tp_dealloc*/</font></i>
<a name='L1378'>    0,                          <i><font color='green'>/*tp_print*/</font></i>
<a name='L1379'>    0,                          <i><font color='green'>/*tp_getattr*/</font></i>
<a name='L1380'>    0,                          <i><font color='green'>/*tp_setattr*/</font></i>
<a name='L1381'>    0,                          <i><font color='green'>/*tp_reserved*/</font></i>
<a name='L1382'>    0,                          <i><font color='green'>/*tp_repr*/</font></i>
<a name='L1383'>    0,                          <i><font color='green'>/*tp_as_number*/</font></i>
<a name='L1384'>    0,                          <i><font color='green'>/*tp_as_sequence*/</font></i>
<a name='L1385'>    0,                          <i><font color='green'>/*tp_as_mapping*/</font></i>
<a name='L1386'>    0,                          <i><font color='green'>/*tp_hash*/</font></i>
<a name='L1387'>    0,                      <i><font color='green'>/*tp_call*/</font></i>
<a name='L1388'>    0,                      <i><font color='green'>/*tp_str*/</font></i>
<a name='L1389'>    <a href='../S/2803.html#L1046' title='Defined at 1046 in Objects/object.c.'>PyObject_GenericGetAttr</a>,<i><font color='green'>/*tp_getattro*/</font></i>
<a name='L1390'>    <a href='../S/2803.html#L1130' title='Defined at 1130 in Objects/object.c.'>PyObject_GenericSetAttr</a>,<i><font color='green'>/*tp_setattro*/</font></i>
<a name='L1391'>    0,                      <i><font color='green'>/*tp_as_buffer*/</font></i>
<a name='L1392'>    Py_TPFLAGS_DEFAULT|Py_TPFLAGS_BASETYPE, <i><font color='green'>/*tp_flags*/</font></i>
<a name='L1393'>    BZ2File__doc__,         <i><font color='green'>/*tp_doc*/</font></i>
<a name='L1394'>    0,                      <i><font color='green'>/*tp_traverse*/</font></i>
<a name='L1395'>    0,                      <i><font color='green'>/*tp_clear*/</font></i>
<a name='L1396'>    0,                      <i><font color='green'>/*tp_richcompare*/</font></i>
<a name='L1397'>    0,                      <i><font color='green'>/*tp_weaklistoffset*/</font></i>
<a name='L1398'>    (getiterfunc)<a href='../S/2626.html#L1324' title='Defined at 1324 in Modules/bz2module.c.'>BZ2File_getiter</a>, <i><font color='green'>/*tp_iter*/</font></i>
<a name='L1399'>    (iternextfunc)<a href='../S/2626.html#L1338' title='Defined at 1338 in Modules/bz2module.c.'>BZ2File_iternext</a>, <i><font color='green'>/*tp_iternext*/</font></i>
<a name='L1400'>    BZ2File_methods,        <i><font color='green'>/*tp_methods*/</font></i>
<a name='L1401'>    0,                          <i><font color='green'>/*tp_members*/</font></i>
<a name='L1402'>    BZ2File_getset,         <i><font color='green'>/*tp_getset*/</font></i>
<a name='L1403'>    0,                      <i><font color='green'>/*tp_base*/</font></i>
<a name='L1404'>    0,                      <i><font color='green'>/*tp_dict*/</font></i>
<a name='L1405'>    0,                      <i><font color='green'>/*tp_descr_get*/</font></i>
<a name='L1406'>    0,                      <i><font color='green'>/*tp_descr_set*/</font></i>
<a name='L1407'>    0,                      <i><font color='green'>/*tp_dictoffset*/</font></i>
<a name='L1408'>    (initproc)<a href='../S/2626.html#L1189' title='Defined at 1189 in Modules/bz2module.c.'>BZ2File_init</a>, <i><font color='green'>/*tp_init*/</font></i>
<a name='L1409'>    <a href='../S/2824.html#L700' title='Defined at 700 in Objects/typeobject.c.'>PyType_GenericAlloc</a>,    <i><font color='green'>/*tp_alloc*/</font></i>
<a name='L1410'>    <a href='../S/2824.html#L730' title='Defined at 730 in Objects/typeobject.c.'>PyType_GenericNew</a>,      <i><font color='green'>/*tp_new*/</font></i>
<a name='L1411'>    <a href='../D/3616.html' title='Multiple defined in 3 places.'>PyObject_Free</a>,          <i><font color='green'>/*tp_free*/</font></i>
<a name='L1412'>    0,                      <i><font color='green'>/*tp_is_gc*/</font></i>
<a name='L1413'><font color='red'>}</font>;
<a name='L1414'>
<a name='L1415'>
<a name='L1416'><i><font color='green'>/* ===================================================================== */</font></i>
<a name='L1417'><i><font color='green'>/* Methods of BZ2Comp. */</font></i>
<a name='L1418'>
<a name='L1419'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(BZ2Comp_compress__doc__,
<a name='L1420'>"compress(data) -&gt; string\n\
<a name='L1421'>\n\
<a name='L1422'>Provide more data to the compressor object. It will return chunks of\n\
<a name='L1423'>compressed data whenever possible. When you've finished providing data\n\
<a name='L1424'>to compress, call the flush() method to finish the compression process,\n\
<a name='L1425'>and return what is left in the internal buffers.\n\
<a name='L1426'>");
<a name='L1427'>
<a name='L1428'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1429'><a href='../S/2626.html#L1575' title='Refered from 1575 in Modules/bz2module.c.'>BZ2Comp_compress</a>(BZ2CompObject *self, PyObject *args)
<a name='L1430'><font color='red'>{</font>
<a name='L1431'>    <a href='../S/544.html#L163' title='Defined at 163 in Include/object.h.'>Py_buffer</a> pdata;
<a name='L1432'>    <b>char</b> *data;
<a name='L1433'>    <b>int</b> datasize;
<a name='L1434'>    <b>int</b> bufsize = <a href='../D/4764.html' title='Multiple defined in 4 places.'>SMALLCHUNK</a>;
<a name='L1435'>    <a href='../D/2608.html' title='Multiple defined in 3 places.'>PY_LONG_LONG</a> totalout;
<a name='L1436'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *ret = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1437'>    bz_stream *bzs = &amp;self-&gt;bzs;
<a name='L1438'>    <b>int</b> bzerror;
<a name='L1439'>
<a name='L1440'>    <b>if</b> (!<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "y*:compress", &amp;pdata))
<a name='L1441'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1442'>    data = pdata.buf;
<a name='L1443'>    datasize = pdata.len;
<a name='L1444'>
<a name='L1445'>    <b>if</b> (datasize == 0) <font color='red'>{</font>
<a name='L1446'>        <a href='../S/2775.html#L684' title='Defined at 684 in Objects/abstract.c.'>PyBuffer_Release</a>(&amp;pdata);
<a name='L1447'>        <b>return</b> <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>("", 0);
<a name='L1448'>    <font color='red'>}</font>
<a name='L1449'>
<a name='L1450'>    <a href='../D/20.html' title='Multiple defined in 4 places.'>ACQUIRE_LOCK</a>(self);
<a name='L1451'>    <b>if</b> (!self-&gt;running) <font color='red'>{</font>
<a name='L1452'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError,
<a name='L1453'>                        "this object was already flushed");
<a name='L1454'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1455'>    <font color='red'>}</font>
<a name='L1456'>
<a name='L1457'>    ret = <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, bufsize);
<a name='L1458'>    <b>if</b> (!ret)
<a name='L1459'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1460'>
<a name='L1461'>    bzs-&gt;next_in = data;
<a name='L1462'>    bzs-&gt;avail_in = datasize;
<a name='L1463'>    bzs-&gt;next_out = <a href='../S/2626.html#L37' title='Defined at 37 in Modules/bz2module.c.'>BUF</a>(ret);
<a name='L1464'>    bzs-&gt;avail_out = bufsize;
<a name='L1465'>
<a name='L1466'>    totalout = <a href='../D/411.html' title='Multiple defined in 4 places.'>BZS_TOTAL_OUT</a>(bzs);
<a name='L1467'>
<a name='L1468'>    <b>for</b> (;;) <font color='red'>{</font>
<a name='L1469'>        <a href='../D/4080.html' title='Multiple defined in 2 places.'>Py_BEGIN_ALLOW_THREADS</a>
<a name='L1470'>        bzerror = <a href='../S/2626.html#L68' title='Defined at 68 in Modules/bz2module.c.'>BZ2_bzCompress</a>(bzs, BZ_RUN);
<a name='L1471'>        <a href='../D/4114.html' title='Multiple defined in 2 places.'>Py_END_ALLOW_THREADS</a>
<a name='L1472'>        <b>if</b> (bzerror != BZ_RUN_OK) <font color='red'>{</font>
<a name='L1473'>            <a href='../S/2626.html#L158' title='Defined at 158 in Modules/bz2module.c.'>Util_CatchBZ2Error</a>(bzerror);
<a name='L1474'>            <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1475'>        <font color='red'>}</font>
<a name='L1476'>        <b>if</b> (bzs-&gt;avail_in == 0)
<a name='L1477'>            <b>break</b>; <i><font color='green'>/* no more input data */</font></i>
<a name='L1478'>        <b>if</b> (bzs-&gt;avail_out == 0) <font color='red'>{</font>
<a name='L1479'>            bufsize = <a href='../S/2626.html#L229' title='Defined at 229 in Modules/bz2module.c.'>Util_NewBufferSize</a>(bufsize);
<a name='L1480'>            <b>if</b> (<a href='../S/2779.html#L2822' title='Defined at 2822 in Objects/bytesobject.c.'>_PyBytes_Resize</a>(&amp;ret, bufsize) &lt; 0) <font color='red'>{</font>
<a name='L1481'>                <a href='../S/2626.html#L70' title='Defined at 70 in Modules/bz2module.c.'>BZ2_bzCompressEnd</a>(bzs);
<a name='L1482'>                <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1483'>            <font color='red'>}</font>
<a name='L1484'>            bzs-&gt;next_out = <a href='../S/2626.html#L37' title='Defined at 37 in Modules/bz2module.c.'>BUF</a>(ret) + (<a href='../D/411.html' title='Multiple defined in 4 places.'>BZS_TOTAL_OUT</a>(bzs)
<a name='L1485'>                                        - totalout);
<a name='L1486'>            bzs-&gt;avail_out = bufsize - (bzs-&gt;next_out - <a href='../S/2626.html#L37' title='Defined at 37 in Modules/bz2module.c.'>BUF</a>(ret));
<a name='L1487'>        <font color='red'>}</font>
<a name='L1488'>    <font color='red'>}</font>
<a name='L1489'>
<a name='L1490'>    <b>if</b> (<a href='../S/2779.html#L2822' title='Defined at 2822 in Objects/bytesobject.c.'>_PyBytes_Resize</a>(&amp;ret,
<a name='L1491'>                       (<a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a>)(<a href='../D/411.html' title='Multiple defined in 4 places.'>BZS_TOTAL_OUT</a>(bzs) - totalout)) &lt; 0)
<a name='L1492'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1493'>
<a name='L1494'>    <a href='../D/4465.html' title='Multiple defined in 4 places.'>RELEASE_LOCK</a>(self);
<a name='L1495'>    <a href='../S/2775.html#L684' title='Defined at 684 in Objects/abstract.c.'>PyBuffer_Release</a>(&amp;pdata);
<a name='L1496'>    <b>return</b> ret;
<a name='L1497'>
<a name='L1498'><a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>:
<a name='L1499'>    <a href='../D/4465.html' title='Multiple defined in 4 places.'>RELEASE_LOCK</a>(self);
<a name='L1500'>    <a href='../S/2775.html#L684' title='Defined at 684 in Objects/abstract.c.'>PyBuffer_Release</a>(&amp;pdata);
<a name='L1501'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(ret);
<a name='L1502'>    <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1503'><font color='red'>}</font>
<a name='L1504'>
<a name='L1505'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(BZ2Comp_flush__doc__,
<a name='L1506'>"flush() -&gt; string\n\
<a name='L1507'>\n\
<a name='L1508'>Finish the compression process and return what is left in internal buffers.\n\
<a name='L1509'>You must not use the compressor object after calling this method.\n\
<a name='L1510'>");
<a name='L1511'>
<a name='L1512'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1513'><a href='../S/2626.html#L1577' title='Refered from 1577 in Modules/bz2module.c.'>BZ2Comp_flush</a>(BZ2CompObject *self)
<a name='L1514'><font color='red'>{</font>
<a name='L1515'>    <b>int</b> bufsize = <a href='../D/4764.html' title='Multiple defined in 4 places.'>SMALLCHUNK</a>;
<a name='L1516'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *ret = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1517'>    bz_stream *bzs = &amp;self-&gt;bzs;
<a name='L1518'>    <a href='../D/2608.html' title='Multiple defined in 3 places.'>PY_LONG_LONG</a> totalout;
<a name='L1519'>    <b>int</b> bzerror;
<a name='L1520'>
<a name='L1521'>    <a href='../D/20.html' title='Multiple defined in 4 places.'>ACQUIRE_LOCK</a>(self);
<a name='L1522'>    <b>if</b> (!self-&gt;running) <font color='red'>{</font>
<a name='L1523'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError, "object was already "
<a name='L1524'>                                          "flushed");
<a name='L1525'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1526'>    <font color='red'>}</font>
<a name='L1527'>    self-&gt;running = 0;
<a name='L1528'>
<a name='L1529'>    ret = <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, bufsize);
<a name='L1530'>    <b>if</b> (!ret)
<a name='L1531'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1532'>
<a name='L1533'>    bzs-&gt;next_out = <a href='../S/2626.html#L37' title='Defined at 37 in Modules/bz2module.c.'>BUF</a>(ret);
<a name='L1534'>    bzs-&gt;avail_out = bufsize;
<a name='L1535'>
<a name='L1536'>    totalout = <a href='../D/411.html' title='Multiple defined in 4 places.'>BZS_TOTAL_OUT</a>(bzs);
<a name='L1537'>
<a name='L1538'>    <b>for</b> (;;) <font color='red'>{</font>
<a name='L1539'>        <a href='../D/4080.html' title='Multiple defined in 2 places.'>Py_BEGIN_ALLOW_THREADS</a>
<a name='L1540'>        bzerror = <a href='../S/2626.html#L68' title='Defined at 68 in Modules/bz2module.c.'>BZ2_bzCompress</a>(bzs, BZ_FINISH);
<a name='L1541'>        <a href='../D/4114.html' title='Multiple defined in 2 places.'>Py_END_ALLOW_THREADS</a>
<a name='L1542'>        <b>if</b> (bzerror == BZ_STREAM_END) <font color='red'>{</font>
<a name='L1543'>            <b>break</b>;
<a name='L1544'>        <font color='red'>}</font> <b>else</b> <b>if</b> (bzerror != BZ_FINISH_OK) <font color='red'>{</font>
<a name='L1545'>            <a href='../S/2626.html#L158' title='Defined at 158 in Modules/bz2module.c.'>Util_CatchBZ2Error</a>(bzerror);
<a name='L1546'>            <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1547'>        <font color='red'>}</font>
<a name='L1548'>        <b>if</b> (bzs-&gt;avail_out == 0) <font color='red'>{</font>
<a name='L1549'>            bufsize = <a href='../S/2626.html#L229' title='Defined at 229 in Modules/bz2module.c.'>Util_NewBufferSize</a>(bufsize);
<a name='L1550'>            <b>if</b> (<a href='../S/2779.html#L2822' title='Defined at 2822 in Objects/bytesobject.c.'>_PyBytes_Resize</a>(&amp;ret, bufsize) &lt; 0)
<a name='L1551'>                <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1552'>            bzs-&gt;next_out = <a href='../S/2626.html#L37' title='Defined at 37 in Modules/bz2module.c.'>BUF</a>(ret);
<a name='L1553'>            bzs-&gt;next_out = <a href='../S/2626.html#L37' title='Defined at 37 in Modules/bz2module.c.'>BUF</a>(ret) + (<a href='../D/411.html' title='Multiple defined in 4 places.'>BZS_TOTAL_OUT</a>(bzs)
<a name='L1554'>                                        - totalout);
<a name='L1555'>            bzs-&gt;avail_out = bufsize - (bzs-&gt;next_out - <a href='../S/2626.html#L37' title='Defined at 37 in Modules/bz2module.c.'>BUF</a>(ret));
<a name='L1556'>        <font color='red'>}</font>
<a name='L1557'>    <font color='red'>}</font>
<a name='L1558'>
<a name='L1559'>    <b>if</b> (bzs-&gt;avail_out != 0) <font color='red'>{</font>
<a name='L1560'>        <b>if</b> (<a href='../S/2779.html#L2822' title='Defined at 2822 in Objects/bytesobject.c.'>_PyBytes_Resize</a>(&amp;ret,
<a name='L1561'>                    (<a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a>)(<a href='../D/411.html' title='Multiple defined in 4 places.'>BZS_TOTAL_OUT</a>(bzs) - totalout)) &lt; 0)
<a name='L1562'>            <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1563'>    <font color='red'>}</font>
<a name='L1564'>
<a name='L1565'>    <a href='../D/4465.html' title='Multiple defined in 4 places.'>RELEASE_LOCK</a>(self);
<a name='L1566'>    <b>return</b> ret;
<a name='L1567'>
<a name='L1568'><a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>:
<a name='L1569'>    <a href='../D/4465.html' title='Multiple defined in 4 places.'>RELEASE_LOCK</a>(self);
<a name='L1570'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(ret);
<a name='L1571'>    <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1572'><font color='red'>}</font>
<a name='L1573'>
<a name='L1574'><b>static</b> <a href='../D/3525.html' title='Multiple defined in 3 places.'>PyMethodDef</a> BZ2Comp_methods[] = <font color='red'>{</font>
<a name='L1575'>    <font color='red'>{</font>"compress", (PyCFunction)<a href='../S/2626.html#L1429' title='Defined at 1429 in Modules/bz2module.c.'>BZ2Comp_compress</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a>,
<a name='L1576'>     BZ2Comp_compress__doc__<font color='red'>}</font>,
<a name='L1577'>    <font color='red'>{</font>"flush", (PyCFunction)<a href='../S/2626.html#L1513' title='Defined at 1513 in Modules/bz2module.c.'>BZ2Comp_flush</a>, <a href='../S/2858.html#L634' title='Defined at 634 in PC/bdist_wininst/install.c.'>METH_NOARGS</a>,
<a name='L1578'>     BZ2Comp_flush__doc__<font color='red'>}</font>,
<a name='L1579'>    <font color='red'>{</font><a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,              <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>           <i><font color='green'>/* sentinel */</font></i>
<a name='L1580'><font color='red'>}</font>;
<a name='L1581'>
<a name='L1582'>
<a name='L1583'><i><font color='green'>/* ===================================================================== */</font></i>
<a name='L1584'><i><font color='green'>/* Slot definitions for BZ2Comp_Type. */</font></i>
<a name='L1585'>
<a name='L1586'><b>static</b> <b>int</b>
<a name='L1587'><a href='../S/2626.html#L1691' title='Refered from 1691 in Modules/bz2module.c.'>BZ2Comp_init</a>(BZ2CompObject *self, PyObject *args, PyObject *kwargs)
<a name='L1588'><font color='red'>{</font>
<a name='L1589'>    <b>int</b> compresslevel = 9;
<a name='L1590'>    <b>int</b> bzerror;
<a name='L1591'>    <b>static</b> <b>char</b> *kwlist[] = <font color='red'>{</font>"compresslevel", 0<font color='red'>}</font>;
<a name='L1592'>
<a name='L1593'>    <b>if</b> (!<a href='../D/2732.html' title='Multiple defined in 2 places.'>PyArg_ParseTupleAndKeywords</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, kwargs, "|i:BZ2Compressor",
<a name='L1594'>                                     kwlist, &amp;compresslevel))
<a name='L1595'>        <b>return</b> -1;
<a name='L1596'>
<a name='L1597'>    <b>if</b> (compresslevel &lt; 1 || compresslevel &gt; 9) <font color='red'>{</font>
<a name='L1598'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError,
<a name='L1599'>                        "compresslevel must be between 1 and 9");
<a name='L1600'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1601'>    <font color='red'>}</font>
<a name='L1602'>
<a name='L1603'><font color='darkred'>#ifdef</font> <a href='../D/5537.html' title='Multiple defined in 3 places.'>WITH_THREAD</a>
<a name='L1604'>    self-&gt;<a href='../S/3148.html#L9' title='Defined at 9 in Python/thread_lwp.h.'>lock</a> = <a href='../D/3848.html' title='Multiple defined in 11 places.'>PyThread_allocate_lock</a>();
<a name='L1605'>    <b>if</b> (!self-&gt;<a href='../S/3148.html#L9' title='Defined at 9 in Python/thread_lwp.h.'>lock</a>) <font color='red'>{</font>
<a name='L1606'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_MemoryError, "unable to allocate lock");
<a name='L1607'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1608'>    <font color='red'>}</font>
<a name='L1609'><font color='darkred'>#endif</font>
<a name='L1610'>
<a name='L1611'>    memset(&amp;self-&gt;bzs, 0, <b>sizeof</b>(bz_stream));
<a name='L1612'>    bzerror = <a href='../S/2626.html#L69' title='Defined at 69 in Modules/bz2module.c.'>BZ2_bzCompressInit</a>(&amp;self-&gt;bzs, compresslevel, 0, 0);
<a name='L1613'>    <b>if</b> (bzerror != BZ_OK) <font color='red'>{</font>
<a name='L1614'>        <a href='../S/2626.html#L158' title='Defined at 158 in Modules/bz2module.c.'>Util_CatchBZ2Error</a>(bzerror);
<a name='L1615'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1616'>    <font color='red'>}</font>
<a name='L1617'>
<a name='L1618'>    self-&gt;running = 1;
<a name='L1619'>
<a name='L1620'>    <b>return</b> 0;
<a name='L1621'><a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>:
<a name='L1622'><font color='darkred'>#ifdef</font> <a href='../D/5537.html' title='Multiple defined in 3 places.'>WITH_THREAD</a>
<a name='L1623'>    <b>if</b> (self-&gt;<a href='../S/3148.html#L9' title='Defined at 9 in Python/thread_lwp.h.'>lock</a>) <font color='red'>{</font>
<a name='L1624'>        <a href='../D/3853.html' title='Multiple defined in 11 places.'>PyThread_free_lock</a>(self-&gt;<a href='../S/3148.html#L9' title='Defined at 9 in Python/thread_lwp.h.'>lock</a>);
<a name='L1625'>        self-&gt;<a href='../S/3148.html#L9' title='Defined at 9 in Python/thread_lwp.h.'>lock</a> = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1626'>    <font color='red'>}</font>
<a name='L1627'><font color='darkred'>#endif</font>
<a name='L1628'>    <b>return</b> -1;
<a name='L1629'><font color='red'>}</font>
<a name='L1630'>
<a name='L1631'><b>static</b> <b>void</b>
<a name='L1632'><a href='../S/2626.html#L1660' title='Refered from 1660 in Modules/bz2module.c.'>BZ2Comp_dealloc</a>(BZ2CompObject *self)
<a name='L1633'><font color='red'>{</font>
<a name='L1634'><font color='darkred'>#ifdef</font> <a href='../D/5537.html' title='Multiple defined in 3 places.'>WITH_THREAD</a>
<a name='L1635'>    <b>if</b> (self-&gt;<a href='../S/3148.html#L9' title='Defined at 9 in Python/thread_lwp.h.'>lock</a>)
<a name='L1636'>        <a href='../D/3853.html' title='Multiple defined in 11 places.'>PyThread_free_lock</a>(self-&gt;<a href='../S/3148.html#L9' title='Defined at 9 in Python/thread_lwp.h.'>lock</a>);
<a name='L1637'><font color='darkred'>#endif</font>
<a name='L1638'>    <a href='../S/2626.html#L70' title='Defined at 70 in Modules/bz2module.c.'>BZ2_bzCompressEnd</a>(&amp;self-&gt;bzs);
<a name='L1639'>    <a href='../D/4259.html' title='Multiple defined in 5 places.'>Py_TYPE</a>(self)-&gt;tp_free((<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *)self);
<a name='L1640'><font color='red'>}</font>
<a name='L1641'>
<a name='L1642'>
<a name='L1643'><i><font color='green'>/* ===================================================================== */</font></i>
<a name='L1644'><i><font color='green'>/* BZ2Comp_Type definition. */</font></i>
<a name='L1645'>
<a name='L1646'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(BZ2Comp__doc__,
<a name='L1647'>"BZ2Compressor([compresslevel=9]) -&gt; compressor object\n\
<a name='L1648'>\n\
<a name='L1649'>Create a new compressor object. This object may be used to compress\n\
<a name='L1650'>data sequentially. If you want to compress data in one shot, use the\n\
<a name='L1651'>compress() function instead. The compresslevel parameter, if given,\n\
<a name='L1652'>must be a number between 1 and 9.\n\
<a name='L1653'>");
<a name='L1654'>
<a name='L1655'><b>static</b> <a href='../D/3899.html' title='Multiple defined in 3 places.'>PyTypeObject</a> BZ2Comp_Type = <font color='red'>{</font>
<a name='L1656'>    <a href='../D/4042.html' title='Multiple defined in 3 places.'>PyVarObject_HEAD_INIT</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, 0)
<a name='L1657'>    "bz2.BZ2Compressor",        <i><font color='green'>/*tp_name*/</font></i>
<a name='L1658'>    <b>sizeof</b>(<a href='../S/2626.html#L126' title='Defined at 126 in Modules/bz2module.c.'>BZ2CompObject</a>),      <i><font color='green'>/*tp_basicsize*/</font></i>
<a name='L1659'>    0,                          <i><font color='green'>/*tp_itemsize*/</font></i>
<a name='L1660'>    (<a href='../D/8095.html' title='Multiple defined in 2 places.'>destructor</a>)<a href='../S/2626.html#L1632' title='Defined at 1632 in Modules/bz2module.c.'>BZ2Comp_dealloc</a>, <i><font color='green'>/*tp_dealloc*/</font></i>
<a name='L1661'>    0,                          <i><font color='green'>/*tp_print*/</font></i>
<a name='L1662'>    0,                          <i><font color='green'>/*tp_getattr*/</font></i>
<a name='L1663'>    0,                          <i><font color='green'>/*tp_setattr*/</font></i>
<a name='L1664'>    0,                          <i><font color='green'>/*tp_reserved*/</font></i>
<a name='L1665'>    0,                          <i><font color='green'>/*tp_repr*/</font></i>
<a name='L1666'>    0,                          <i><font color='green'>/*tp_as_number*/</font></i>
<a name='L1667'>    0,                          <i><font color='green'>/*tp_as_sequence*/</font></i>
<a name='L1668'>    0,                          <i><font color='green'>/*tp_as_mapping*/</font></i>
<a name='L1669'>    0,                          <i><font color='green'>/*tp_hash*/</font></i>
<a name='L1670'>    0,                      <i><font color='green'>/*tp_call*/</font></i>
<a name='L1671'>    0,                      <i><font color='green'>/*tp_str*/</font></i>
<a name='L1672'>    <a href='../S/2803.html#L1046' title='Defined at 1046 in Objects/object.c.'>PyObject_GenericGetAttr</a>,<i><font color='green'>/*tp_getattro*/</font></i>
<a name='L1673'>    <a href='../S/2803.html#L1130' title='Defined at 1130 in Objects/object.c.'>PyObject_GenericSetAttr</a>,<i><font color='green'>/*tp_setattro*/</font></i>
<a name='L1674'>    0,                      <i><font color='green'>/*tp_as_buffer*/</font></i>
<a name='L1675'>    Py_TPFLAGS_DEFAULT|Py_TPFLAGS_BASETYPE, <i><font color='green'>/*tp_flags*/</font></i>
<a name='L1676'>    BZ2Comp__doc__,         <i><font color='green'>/*tp_doc*/</font></i>
<a name='L1677'>    0,                      <i><font color='green'>/*tp_traverse*/</font></i>
<a name='L1678'>    0,                      <i><font color='green'>/*tp_clear*/</font></i>
<a name='L1679'>    0,                      <i><font color='green'>/*tp_richcompare*/</font></i>
<a name='L1680'>    0,                      <i><font color='green'>/*tp_weaklistoffset*/</font></i>
<a name='L1681'>    0,                      <i><font color='green'>/*tp_iter*/</font></i>
<a name='L1682'>    0,                      <i><font color='green'>/*tp_iternext*/</font></i>
<a name='L1683'>    BZ2Comp_methods,        <i><font color='green'>/*tp_methods*/</font></i>
<a name='L1684'>    0,                      <i><font color='green'>/*tp_members*/</font></i>
<a name='L1685'>    0,                      <i><font color='green'>/*tp_getset*/</font></i>
<a name='L1686'>    0,                      <i><font color='green'>/*tp_base*/</font></i>
<a name='L1687'>    0,                      <i><font color='green'>/*tp_dict*/</font></i>
<a name='L1688'>    0,                      <i><font color='green'>/*tp_descr_get*/</font></i>
<a name='L1689'>    0,                      <i><font color='green'>/*tp_descr_set*/</font></i>
<a name='L1690'>    0,                      <i><font color='green'>/*tp_dictoffset*/</font></i>
<a name='L1691'>    (initproc)<a href='../S/2626.html#L1587' title='Defined at 1587 in Modules/bz2module.c.'>BZ2Comp_init</a>, <i><font color='green'>/*tp_init*/</font></i>
<a name='L1692'>    <a href='../S/2824.html#L700' title='Defined at 700 in Objects/typeobject.c.'>PyType_GenericAlloc</a>,    <i><font color='green'>/*tp_alloc*/</font></i>
<a name='L1693'>    <a href='../S/2824.html#L730' title='Defined at 730 in Objects/typeobject.c.'>PyType_GenericNew</a>,      <i><font color='green'>/*tp_new*/</font></i>
<a name='L1694'>    <a href='../D/3616.html' title='Multiple defined in 3 places.'>PyObject_Free</a>,          <i><font color='green'>/*tp_free*/</font></i>
<a name='L1695'>    0,                      <i><font color='green'>/*tp_is_gc*/</font></i>
<a name='L1696'><font color='red'>}</font>;
<a name='L1697'>
<a name='L1698'>
<a name='L1699'><i><font color='green'>/* ===================================================================== */</font></i>
<a name='L1700'><i><font color='green'>/* Members of BZ2Decomp. */</font></i>
<a name='L1701'>
<a name='L1702'><font color='darkred'>#undef</font> <a href='../R/2175.html' title='Multiple refered from 57 places.'>OFF</a>
<a name='L1703'><font color='darkred'>#define</font> <a href='../R/2175.html' title='Multiple refered from 57 places.'>OFF</a>(x) <a href='../D/10194.html' title='Multiple defined in 2 places.'>offsetof</a>(<a href='../S/2626.html#L136' title='Defined at 136 in Modules/bz2module.c.'>BZ2DecompObject</a>, x)
<a name='L1704'>
<a name='L1705'><b>static</b> <a href='../D/3506.html' title='Multiple defined in 2 places.'>PyMemberDef</a> BZ2Decomp_members[] = <font color='red'>{</font>
<a name='L1706'>    <font color='red'>{</font>"unused_data", <a href='../S/577.html#L44' title='Defined at 44 in Include/structmember.h.'>T_OBJECT</a>, <a href='../D/2402.html' title='Multiple defined in 16 places.'>OFF</a>(unused_data), <a href='../S/577.html#L73' title='Defined at 73 in Include/structmember.h.'>READONLY</a><font color='red'>}</font>,
<a name='L1707'>    <font color='red'>{</font><a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>      <i><font color='green'>/* Sentinel */</font></i>
<a name='L1708'><font color='red'>}</font>;
<a name='L1709'>
<a name='L1710'>
<a name='L1711'><i><font color='green'>/* ===================================================================== */</font></i>
<a name='L1712'><i><font color='green'>/* Methods of BZ2Decomp. */</font></i>
<a name='L1713'>
<a name='L1714'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(BZ2Decomp_decompress__doc__,
<a name='L1715'>"decompress(data) -&gt; string\n\
<a name='L1716'>\n\
<a name='L1717'>Provide more data to the decompressor object. It will return chunks\n\
<a name='L1718'>of decompressed data whenever possible. If you try to decompress data\n\
<a name='L1719'>after the end of stream is found, EOFError will be raised. If any data\n\
<a name='L1720'>was found after the end of stream, it'll be ignored and saved in\n\
<a name='L1721'>unused_data attribute.\n\
<a name='L1722'>");
<a name='L1723'>
<a name='L1724'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1725'><a href='../S/2626.html#L1810' title='Refered from 1810 in Modules/bz2module.c.'>BZ2Decomp_decompress</a>(BZ2DecompObject *self, PyObject *args)
<a name='L1726'><font color='red'>{</font>
<a name='L1727'>    <a href='../S/544.html#L163' title='Defined at 163 in Include/object.h.'>Py_buffer</a> pdata;
<a name='L1728'>    <b>char</b> *data;
<a name='L1729'>    <b>int</b> datasize;
<a name='L1730'>    <b>int</b> bufsize = <a href='../D/4764.html' title='Multiple defined in 4 places.'>SMALLCHUNK</a>;
<a name='L1731'>    <a href='../D/2608.html' title='Multiple defined in 3 places.'>PY_LONG_LONG</a> totalout;
<a name='L1732'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *ret = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1733'>    bz_stream *bzs = &amp;self-&gt;bzs;
<a name='L1734'>    <b>int</b> bzerror;
<a name='L1735'>
<a name='L1736'>    <b>if</b> (!<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "y*:decompress", &amp;pdata))
<a name='L1737'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1738'>    data = pdata.buf;
<a name='L1739'>    datasize = pdata.len;
<a name='L1740'>
<a name='L1741'>    <a href='../D/20.html' title='Multiple defined in 4 places.'>ACQUIRE_LOCK</a>(self);
<a name='L1742'>    <b>if</b> (!self-&gt;running) <font color='red'>{</font>
<a name='L1743'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_EOFError, "end of stream was "
<a name='L1744'>                                        "already found");
<a name='L1745'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1746'>    <font color='red'>}</font>
<a name='L1747'>
<a name='L1748'>    ret = <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, bufsize);
<a name='L1749'>    <b>if</b> (!ret)
<a name='L1750'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1751'>
<a name='L1752'>    bzs-&gt;next_in = data;
<a name='L1753'>    bzs-&gt;avail_in = datasize;
<a name='L1754'>    bzs-&gt;next_out = <a href='../S/2626.html#L37' title='Defined at 37 in Modules/bz2module.c.'>BUF</a>(ret);
<a name='L1755'>    bzs-&gt;avail_out = bufsize;
<a name='L1756'>
<a name='L1757'>    totalout = <a href='../D/411.html' title='Multiple defined in 4 places.'>BZS_TOTAL_OUT</a>(bzs);
<a name='L1758'>
<a name='L1759'>    <b>for</b> (;;) <font color='red'>{</font>
<a name='L1760'>        <a href='../D/4080.html' title='Multiple defined in 2 places.'>Py_BEGIN_ALLOW_THREADS</a>
<a name='L1761'>        bzerror = <a href='../S/2626.html#L71' title='Defined at 71 in Modules/bz2module.c.'>BZ2_bzDecompress</a>(bzs);
<a name='L1762'>        <a href='../D/4114.html' title='Multiple defined in 2 places.'>Py_END_ALLOW_THREADS</a>
<a name='L1763'>        <b>if</b> (bzerror == BZ_STREAM_END) <font color='red'>{</font>
<a name='L1764'>            <b>if</b> (bzs-&gt;avail_in != 0) <font color='red'>{</font>
<a name='L1765'>                Py_DECREF(self-&gt;unused_data);
<a name='L1766'>                self-&gt;unused_data =
<a name='L1767'>                    <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>(bzs-&gt;next_in,
<a name='L1768'>                                               bzs-&gt;avail_in);
<a name='L1769'>            <font color='red'>}</font>
<a name='L1770'>            self-&gt;running = 0;
<a name='L1771'>            <b>break</b>;
<a name='L1772'>        <font color='red'>}</font>
<a name='L1773'>        <b>if</b> (bzerror != BZ_OK) <font color='red'>{</font>
<a name='L1774'>            <a href='../S/2626.html#L158' title='Defined at 158 in Modules/bz2module.c.'>Util_CatchBZ2Error</a>(bzerror);
<a name='L1775'>            <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1776'>        <font color='red'>}</font>
<a name='L1777'>        <b>if</b> (bzs-&gt;avail_in == 0)
<a name='L1778'>            <b>break</b>; <i><font color='green'>/* no more input data */</font></i>
<a name='L1779'>        <b>if</b> (bzs-&gt;avail_out == 0) <font color='red'>{</font>
<a name='L1780'>            bufsize = <a href='../S/2626.html#L229' title='Defined at 229 in Modules/bz2module.c.'>Util_NewBufferSize</a>(bufsize);
<a name='L1781'>            <b>if</b> (<a href='../S/2779.html#L2822' title='Defined at 2822 in Objects/bytesobject.c.'>_PyBytes_Resize</a>(&amp;ret, bufsize) &lt; 0) <font color='red'>{</font>
<a name='L1782'>                <a href='../S/2626.html#L73' title='Defined at 73 in Modules/bz2module.c.'>BZ2_bzDecompressEnd</a>(bzs);
<a name='L1783'>                <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1784'>            <font color='red'>}</font>
<a name='L1785'>            bzs-&gt;next_out = <a href='../S/2626.html#L37' title='Defined at 37 in Modules/bz2module.c.'>BUF</a>(ret);
<a name='L1786'>            bzs-&gt;next_out = <a href='../S/2626.html#L37' title='Defined at 37 in Modules/bz2module.c.'>BUF</a>(ret) + (<a href='../D/411.html' title='Multiple defined in 4 places.'>BZS_TOTAL_OUT</a>(bzs)
<a name='L1787'>                                        - totalout);
<a name='L1788'>            bzs-&gt;avail_out = bufsize - (bzs-&gt;next_out - <a href='../S/2626.html#L37' title='Defined at 37 in Modules/bz2module.c.'>BUF</a>(ret));
<a name='L1789'>        <font color='red'>}</font>
<a name='L1790'>    <font color='red'>}</font>
<a name='L1791'>
<a name='L1792'>    <b>if</b> (bzs-&gt;avail_out != 0) <font color='red'>{</font>
<a name='L1793'>        <b>if</b> (<a href='../S/2779.html#L2822' title='Defined at 2822 in Objects/bytesobject.c.'>_PyBytes_Resize</a>(&amp;ret,
<a name='L1794'>                    (<a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a>)(<a href='../D/411.html' title='Multiple defined in 4 places.'>BZS_TOTAL_OUT</a>(bzs) - totalout)) &lt; 0)
<a name='L1795'>            <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1796'>    <font color='red'>}</font>
<a name='L1797'>
<a name='L1798'>    <a href='../D/4465.html' title='Multiple defined in 4 places.'>RELEASE_LOCK</a>(self);
<a name='L1799'>    <a href='../S/2775.html#L684' title='Defined at 684 in Objects/abstract.c.'>PyBuffer_Release</a>(&amp;pdata);
<a name='L1800'>    <b>return</b> ret;
<a name='L1801'>
<a name='L1802'><a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>:
<a name='L1803'>    <a href='../D/4465.html' title='Multiple defined in 4 places.'>RELEASE_LOCK</a>(self);
<a name='L1804'>    <a href='../S/2775.html#L684' title='Defined at 684 in Objects/abstract.c.'>PyBuffer_Release</a>(&amp;pdata);
<a name='L1805'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(ret);
<a name='L1806'>    <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1807'><font color='red'>}</font>
<a name='L1808'>
<a name='L1809'><b>static</b> <a href='../D/3525.html' title='Multiple defined in 3 places.'>PyMethodDef</a> BZ2Decomp_methods[] = <font color='red'>{</font>
<a name='L1810'>    <font color='red'>{</font>"decompress", (PyCFunction)<a href='../S/2626.html#L1725' title='Defined at 1725 in Modules/bz2module.c.'>BZ2Decomp_decompress</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a>, BZ2Decomp_decompress__doc__<font color='red'>}</font>,
<a name='L1811'>    <font color='red'>{</font><a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,              <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>           <i><font color='green'>/* sentinel */</font></i>
<a name='L1812'><font color='red'>}</font>;
<a name='L1813'>
<a name='L1814'>
<a name='L1815'><i><font color='green'>/* ===================================================================== */</font></i>
<a name='L1816'><i><font color='green'>/* Slot definitions for BZ2Decomp_Type. */</font></i>
<a name='L1817'>
<a name='L1818'><b>static</b> <b>int</b>
<a name='L1819'><a href='../S/2626.html#L1920' title='Refered from 1920 in Modules/bz2module.c.'>BZ2Decomp_init</a>(BZ2DecompObject *self, PyObject *args, PyObject *kwargs)
<a name='L1820'><font color='red'>{</font>
<a name='L1821'>    <b>int</b> bzerror;
<a name='L1822'>
<a name='L1823'>    <b>if</b> (!<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, ":BZ2Decompressor"))
<a name='L1824'>        <b>return</b> -1;
<a name='L1825'>
<a name='L1826'><font color='darkred'>#ifdef</font> <a href='../D/5537.html' title='Multiple defined in 3 places.'>WITH_THREAD</a>
<a name='L1827'>    self-&gt;<a href='../S/3148.html#L9' title='Defined at 9 in Python/thread_lwp.h.'>lock</a> = <a href='../D/3848.html' title='Multiple defined in 11 places.'>PyThread_allocate_lock</a>();
<a name='L1828'>    <b>if</b> (!self-&gt;<a href='../S/3148.html#L9' title='Defined at 9 in Python/thread_lwp.h.'>lock</a>) <font color='red'>{</font>
<a name='L1829'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_MemoryError, "unable to allocate lock");
<a name='L1830'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1831'>    <font color='red'>}</font>
<a name='L1832'><font color='darkred'>#endif</font>
<a name='L1833'>
<a name='L1834'>    self-&gt;unused_data = <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>("", 0);
<a name='L1835'>    <b>if</b> (!self-&gt;unused_data)
<a name='L1836'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1837'>
<a name='L1838'>    memset(&amp;self-&gt;bzs, 0, <b>sizeof</b>(bz_stream));
<a name='L1839'>    bzerror = <a href='../S/2626.html#L72' title='Defined at 72 in Modules/bz2module.c.'>BZ2_bzDecompressInit</a>(&amp;self-&gt;bzs, 0, 0);
<a name='L1840'>    <b>if</b> (bzerror != BZ_OK) <font color='red'>{</font>
<a name='L1841'>        <a href='../S/2626.html#L158' title='Defined at 158 in Modules/bz2module.c.'>Util_CatchBZ2Error</a>(bzerror);
<a name='L1842'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1843'>    <font color='red'>}</font>
<a name='L1844'>
<a name='L1845'>    self-&gt;running = 1;
<a name='L1846'>
<a name='L1847'>    <b>return</b> 0;
<a name='L1848'>
<a name='L1849'><a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>:
<a name='L1850'><font color='darkred'>#ifdef</font> <a href='../D/5537.html' title='Multiple defined in 3 places.'>WITH_THREAD</a>
<a name='L1851'>    <b>if</b> (self-&gt;<a href='../S/3148.html#L9' title='Defined at 9 in Python/thread_lwp.h.'>lock</a>) <font color='red'>{</font>
<a name='L1852'>        <a href='../D/3853.html' title='Multiple defined in 11 places.'>PyThread_free_lock</a>(self-&gt;<a href='../S/3148.html#L9' title='Defined at 9 in Python/thread_lwp.h.'>lock</a>);
<a name='L1853'>        self-&gt;<a href='../S/3148.html#L9' title='Defined at 9 in Python/thread_lwp.h.'>lock</a> = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1854'>    <font color='red'>}</font>
<a name='L1855'><font color='darkred'>#endif</font>
<a name='L1856'>    <a href='../D/4095.html' title='Multiple defined in 2 places.'>Py_CLEAR</a>(self-&gt;unused_data);
<a name='L1857'>    <b>return</b> -1;
<a name='L1858'><font color='red'>}</font>
<a name='L1859'>
<a name='L1860'><b>static</b> <b>void</b>
<a name='L1861'><a href='../S/2626.html#L1889' title='Refered from 1889 in Modules/bz2module.c.'>BZ2Decomp_dealloc</a>(BZ2DecompObject *self)
<a name='L1862'><font color='red'>{</font>
<a name='L1863'><font color='darkred'>#ifdef</font> <a href='../D/5537.html' title='Multiple defined in 3 places.'>WITH_THREAD</a>
<a name='L1864'>    <b>if</b> (self-&gt;<a href='../S/3148.html#L9' title='Defined at 9 in Python/thread_lwp.h.'>lock</a>)
<a name='L1865'>        <a href='../D/3853.html' title='Multiple defined in 11 places.'>PyThread_free_lock</a>(self-&gt;<a href='../S/3148.html#L9' title='Defined at 9 in Python/thread_lwp.h.'>lock</a>);
<a name='L1866'><font color='darkred'>#endif</font>
<a name='L1867'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(self-&gt;unused_data);
<a name='L1868'>    <a href='../S/2626.html#L73' title='Defined at 73 in Modules/bz2module.c.'>BZ2_bzDecompressEnd</a>(&amp;self-&gt;bzs);
<a name='L1869'>    <a href='../D/4259.html' title='Multiple defined in 5 places.'>Py_TYPE</a>(self)-&gt;tp_free((<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *)self);
<a name='L1870'><font color='red'>}</font>
<a name='L1871'>
<a name='L1872'>
<a name='L1873'><i><font color='green'>/* ===================================================================== */</font></i>
<a name='L1874'><i><font color='green'>/* BZ2Decomp_Type definition. */</font></i>
<a name='L1875'>
<a name='L1876'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(BZ2Decomp__doc__,
<a name='L1877'>"BZ2Decompressor() -&gt; decompressor object\n\
<a name='L1878'>\n\
<a name='L1879'>Create a new decompressor object. This object may be used to decompress\n\
<a name='L1880'>data sequentially. If you want to decompress data in one shot, use the\n\
<a name='L1881'>decompress() function instead.\n\
<a name='L1882'>");
<a name='L1883'>
<a name='L1884'><b>static</b> <a href='../D/3899.html' title='Multiple defined in 3 places.'>PyTypeObject</a> BZ2Decomp_Type = <font color='red'>{</font>
<a name='L1885'>    <a href='../D/4042.html' title='Multiple defined in 3 places.'>PyVarObject_HEAD_INIT</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, 0)
<a name='L1886'>    "bz2.BZ2Decompressor",      <i><font color='green'>/*tp_name*/</font></i>
<a name='L1887'>    <b>sizeof</b>(<a href='../S/2626.html#L136' title='Defined at 136 in Modules/bz2module.c.'>BZ2DecompObject</a>), <i><font color='green'>/*tp_basicsize*/</font></i>
<a name='L1888'>    0,                          <i><font color='green'>/*tp_itemsize*/</font></i>
<a name='L1889'>    (<a href='../D/8095.html' title='Multiple defined in 2 places.'>destructor</a>)<a href='../S/2626.html#L1861' title='Defined at 1861 in Modules/bz2module.c.'>BZ2Decomp_dealloc</a>, <i><font color='green'>/*tp_dealloc*/</font></i>
<a name='L1890'>    0,                          <i><font color='green'>/*tp_print*/</font></i>
<a name='L1891'>    0,                          <i><font color='green'>/*tp_getattr*/</font></i>
<a name='L1892'>    0,                          <i><font color='green'>/*tp_setattr*/</font></i>
<a name='L1893'>    0,                          <i><font color='green'>/*tp_reserved*/</font></i>
<a name='L1894'>    0,                          <i><font color='green'>/*tp_repr*/</font></i>
<a name='L1895'>    0,                          <i><font color='green'>/*tp_as_number*/</font></i>
<a name='L1896'>    0,                          <i><font color='green'>/*tp_as_sequence*/</font></i>
<a name='L1897'>    0,                          <i><font color='green'>/*tp_as_mapping*/</font></i>
<a name='L1898'>    0,                          <i><font color='green'>/*tp_hash*/</font></i>
<a name='L1899'>    0,                      <i><font color='green'>/*tp_call*/</font></i>
<a name='L1900'>    0,                      <i><font color='green'>/*tp_str*/</font></i>
<a name='L1901'>    <a href='../S/2803.html#L1046' title='Defined at 1046 in Objects/object.c.'>PyObject_GenericGetAttr</a>,<i><font color='green'>/*tp_getattro*/</font></i>
<a name='L1902'>    <a href='../S/2803.html#L1130' title='Defined at 1130 in Objects/object.c.'>PyObject_GenericSetAttr</a>,<i><font color='green'>/*tp_setattro*/</font></i>
<a name='L1903'>    0,                      <i><font color='green'>/*tp_as_buffer*/</font></i>
<a name='L1904'>    Py_TPFLAGS_DEFAULT|Py_TPFLAGS_BASETYPE, <i><font color='green'>/*tp_flags*/</font></i>
<a name='L1905'>    BZ2Decomp__doc__,       <i><font color='green'>/*tp_doc*/</font></i>
<a name='L1906'>    0,                      <i><font color='green'>/*tp_traverse*/</font></i>
<a name='L1907'>    0,                      <i><font color='green'>/*tp_clear*/</font></i>
<a name='L1908'>    0,                      <i><font color='green'>/*tp_richcompare*/</font></i>
<a name='L1909'>    0,                      <i><font color='green'>/*tp_weaklistoffset*/</font></i>
<a name='L1910'>    0,                      <i><font color='green'>/*tp_iter*/</font></i>
<a name='L1911'>    0,                      <i><font color='green'>/*tp_iternext*/</font></i>
<a name='L1912'>    BZ2Decomp_methods,      <i><font color='green'>/*tp_methods*/</font></i>
<a name='L1913'>    BZ2Decomp_members,      <i><font color='green'>/*tp_members*/</font></i>
<a name='L1914'>    0,                      <i><font color='green'>/*tp_getset*/</font></i>
<a name='L1915'>    0,                      <i><font color='green'>/*tp_base*/</font></i>
<a name='L1916'>    0,                      <i><font color='green'>/*tp_dict*/</font></i>
<a name='L1917'>    0,                      <i><font color='green'>/*tp_descr_get*/</font></i>
<a name='L1918'>    0,                      <i><font color='green'>/*tp_descr_set*/</font></i>
<a name='L1919'>    0,                      <i><font color='green'>/*tp_dictoffset*/</font></i>
<a name='L1920'>    (initproc)<a href='../S/2626.html#L1819' title='Defined at 1819 in Modules/bz2module.c.'>BZ2Decomp_init</a>, <i><font color='green'>/*tp_init*/</font></i>
<a name='L1921'>    <a href='../S/2824.html#L700' title='Defined at 700 in Objects/typeobject.c.'>PyType_GenericAlloc</a>,    <i><font color='green'>/*tp_alloc*/</font></i>
<a name='L1922'>    <a href='../S/2824.html#L730' title='Defined at 730 in Objects/typeobject.c.'>PyType_GenericNew</a>,      <i><font color='green'>/*tp_new*/</font></i>
<a name='L1923'>    <a href='../D/3616.html' title='Multiple defined in 3 places.'>PyObject_Free</a>,          <i><font color='green'>/*tp_free*/</font></i>
<a name='L1924'>    0,                      <i><font color='green'>/*tp_is_gc*/</font></i>
<a name='L1925'><font color='red'>}</font>;
<a name='L1926'>
<a name='L1927'>
<a name='L1928'><i><font color='green'>/* ===================================================================== */</font></i>
<a name='L1929'><i><font color='green'>/* Module functions. */</font></i>
<a name='L1930'>
<a name='L1931'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(bz2_compress__doc__,
<a name='L1932'>"compress(data [, compresslevel=9]) -&gt; string\n\
<a name='L1933'>\n\
<a name='L1934'>Compress data in one shot. If you want to compress data sequentially,\n\
<a name='L1935'>use an instance of BZ2Compressor instead. The compresslevel parameter, if\n\
<a name='L1936'>given, must be a number between 1 and 9.\n\
<a name='L1937'>");
<a name='L1938'>
<a name='L1939'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1940'><a href='../S/2626.html#L2123' title='Refered from 2123 in Modules/bz2module.c.'>bz2_compress</a>(PyObject *self, PyObject *args, PyObject *kwargs)
<a name='L1941'><font color='red'>{</font>
<a name='L1942'>    <b>int</b> compresslevel=9;
<a name='L1943'>    <a href='../S/544.html#L163' title='Defined at 163 in Include/object.h.'>Py_buffer</a> pdata;
<a name='L1944'>    <b>char</b> *data;
<a name='L1945'>    <b>int</b> datasize;
<a name='L1946'>    <b>int</b> bufsize;
<a name='L1947'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *ret = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1948'>    bz_stream _bzs;
<a name='L1949'>    bz_stream *bzs = &amp;_bzs;
<a name='L1950'>    <b>int</b> bzerror;
<a name='L1951'>    <b>static</b> <b>char</b> *kwlist[] = <font color='red'>{</font>"data", "compresslevel", 0<font color='red'>}</font>;
<a name='L1952'>
<a name='L1953'>    <b>if</b> (!<a href='../D/2732.html' title='Multiple defined in 2 places.'>PyArg_ParseTupleAndKeywords</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, kwargs, "y*|i",
<a name='L1954'>                                     kwlist, &amp;pdata,
<a name='L1955'>                                     &amp;compresslevel))
<a name='L1956'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1957'>    data = pdata.buf;
<a name='L1958'>    datasize = pdata.len;
<a name='L1959'>
<a name='L1960'>    <b>if</b> (compresslevel &lt; 1 || compresslevel &gt; 9) <font color='red'>{</font>
<a name='L1961'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError,
<a name='L1962'>                        "compresslevel must be between 1 and 9");
<a name='L1963'>        <a href='../S/2775.html#L684' title='Defined at 684 in Objects/abstract.c.'>PyBuffer_Release</a>(&amp;pdata);
<a name='L1964'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1965'>    <font color='red'>}</font>
<a name='L1966'>
<a name='L1967'>    <i><font color='green'>/* Conforming to bz2 manual, this is large enough to fit compressed</font></i>
<a name='L1968'><i><font color='green'>     * data in one shot. We will check it later anyway. */</font></i>
<a name='L1969'>    bufsize = datasize + (datasize/100+1) + 600;
<a name='L1970'>
<a name='L1971'>    ret = <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, bufsize);
<a name='L1972'>    <b>if</b> (!ret) <font color='red'>{</font>
<a name='L1973'>        <a href='../S/2775.html#L684' title='Defined at 684 in Objects/abstract.c.'>PyBuffer_Release</a>(&amp;pdata);
<a name='L1974'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1975'>    <font color='red'>}</font>
<a name='L1976'>
<a name='L1977'>    memset(bzs, 0, <b>sizeof</b>(bz_stream));
<a name='L1978'>
<a name='L1979'>    bzs-&gt;next_in = data;
<a name='L1980'>    bzs-&gt;avail_in = datasize;
<a name='L1981'>    bzs-&gt;next_out = <a href='../S/2626.html#L37' title='Defined at 37 in Modules/bz2module.c.'>BUF</a>(ret);
<a name='L1982'>    bzs-&gt;avail_out = bufsize;
<a name='L1983'>
<a name='L1984'>    bzerror = <a href='../S/2626.html#L69' title='Defined at 69 in Modules/bz2module.c.'>BZ2_bzCompressInit</a>(bzs, compresslevel, 0, 0);
<a name='L1985'>    <b>if</b> (bzerror != BZ_OK) <font color='red'>{</font>
<a name='L1986'>        <a href='../S/2626.html#L158' title='Defined at 158 in Modules/bz2module.c.'>Util_CatchBZ2Error</a>(bzerror);
<a name='L1987'>        <a href='../S/2775.html#L684' title='Defined at 684 in Objects/abstract.c.'>PyBuffer_Release</a>(&amp;pdata);
<a name='L1988'>        Py_DECREF(ret);
<a name='L1989'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1990'>    <font color='red'>}</font>
<a name='L1991'>
<a name='L1992'>    <b>for</b> (;;) <font color='red'>{</font>
<a name='L1993'>        <a href='../D/4080.html' title='Multiple defined in 2 places.'>Py_BEGIN_ALLOW_THREADS</a>
<a name='L1994'>        bzerror = <a href='../S/2626.html#L68' title='Defined at 68 in Modules/bz2module.c.'>BZ2_bzCompress</a>(bzs, BZ_FINISH);
<a name='L1995'>        <a href='../D/4114.html' title='Multiple defined in 2 places.'>Py_END_ALLOW_THREADS</a>
<a name='L1996'>        <b>if</b> (bzerror == BZ_STREAM_END) <font color='red'>{</font>
<a name='L1997'>            <b>break</b>;
<a name='L1998'>        <font color='red'>}</font> <b>else</b> <b>if</b> (bzerror != BZ_FINISH_OK) <font color='red'>{</font>
<a name='L1999'>            <a href='../S/2626.html#L70' title='Defined at 70 in Modules/bz2module.c.'>BZ2_bzCompressEnd</a>(bzs);
<a name='L2000'>            <a href='../S/2626.html#L158' title='Defined at 158 in Modules/bz2module.c.'>Util_CatchBZ2Error</a>(bzerror);
<a name='L2001'>            <a href='../S/2775.html#L684' title='Defined at 684 in Objects/abstract.c.'>PyBuffer_Release</a>(&amp;pdata);
<a name='L2002'>            Py_DECREF(ret);
<a name='L2003'>            <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L2004'>        <font color='red'>}</font>
<a name='L2005'>        <b>if</b> (bzs-&gt;avail_out == 0) <font color='red'>{</font>
<a name='L2006'>            bufsize = <a href='../S/2626.html#L229' title='Defined at 229 in Modules/bz2module.c.'>Util_NewBufferSize</a>(bufsize);
<a name='L2007'>            <b>if</b> (<a href='../S/2779.html#L2822' title='Defined at 2822 in Objects/bytesobject.c.'>_PyBytes_Resize</a>(&amp;ret, bufsize) &lt; 0) <font color='red'>{</font>
<a name='L2008'>                <a href='../S/2626.html#L70' title='Defined at 70 in Modules/bz2module.c.'>BZ2_bzCompressEnd</a>(bzs);
<a name='L2009'>                <a href='../S/2775.html#L684' title='Defined at 684 in Objects/abstract.c.'>PyBuffer_Release</a>(&amp;pdata);
<a name='L2010'>                <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L2011'>            <font color='red'>}</font>
<a name='L2012'>            bzs-&gt;next_out = <a href='../S/2626.html#L37' title='Defined at 37 in Modules/bz2module.c.'>BUF</a>(ret) + <a href='../D/411.html' title='Multiple defined in 4 places.'>BZS_TOTAL_OUT</a>(bzs);
<a name='L2013'>            bzs-&gt;avail_out = bufsize - (bzs-&gt;next_out - <a href='../S/2626.html#L37' title='Defined at 37 in Modules/bz2module.c.'>BUF</a>(ret));
<a name='L2014'>        <font color='red'>}</font>
<a name='L2015'>    <font color='red'>}</font>
<a name='L2016'>
<a name='L2017'>    <b>if</b> (bzs-&gt;avail_out != 0) <font color='red'>{</font>
<a name='L2018'>        <b>if</b> (<a href='../S/2779.html#L2822' title='Defined at 2822 in Objects/bytesobject.c.'>_PyBytes_Resize</a>(&amp;ret, (<a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a>)<a href='../D/411.html' title='Multiple defined in 4 places.'>BZS_TOTAL_OUT</a>(bzs)) &lt; 0) <font color='red'>{</font>
<a name='L2019'>            ret = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L2020'>        <font color='red'>}</font>
<a name='L2021'>    <font color='red'>}</font>
<a name='L2022'>    <a href='../S/2626.html#L70' title='Defined at 70 in Modules/bz2module.c.'>BZ2_bzCompressEnd</a>(bzs);
<a name='L2023'>
<a name='L2024'>    <a href='../S/2775.html#L684' title='Defined at 684 in Objects/abstract.c.'>PyBuffer_Release</a>(&amp;pdata);
<a name='L2025'>    <b>return</b> ret;
<a name='L2026'><font color='red'>}</font>
<a name='L2027'>
<a name='L2028'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(bz2_decompress__doc__,
<a name='L2029'>"decompress(data) -&gt; decompressed data\n\
<a name='L2030'>\n\
<a name='L2031'>Decompress data in one shot. If you want to decompress data sequentially,\n\
<a name='L2032'>use an instance of BZ2Decompressor instead.\n\
<a name='L2033'>");
<a name='L2034'>
<a name='L2035'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L2036'><a href='../S/2626.html#L2125' title='Refered from 2125 in Modules/bz2module.c.'>bz2_decompress</a>(PyObject *self, PyObject *args)
<a name='L2037'><font color='red'>{</font>
<a name='L2038'>    <a href='../S/544.html#L163' title='Defined at 163 in Include/object.h.'>Py_buffer</a> pdata;
<a name='L2039'>    <b>char</b> *data;
<a name='L2040'>    <b>int</b> datasize;
<a name='L2041'>    <b>int</b> bufsize = <a href='../D/4764.html' title='Multiple defined in 4 places.'>SMALLCHUNK</a>;
<a name='L2042'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *ret;
<a name='L2043'>    bz_stream _bzs;
<a name='L2044'>    bz_stream *bzs = &amp;_bzs;
<a name='L2045'>    <b>int</b> bzerror;
<a name='L2046'>
<a name='L2047'>    <b>if</b> (!<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "y*:decompress", &amp;pdata))
<a name='L2048'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L2049'>    data = pdata.buf;
<a name='L2050'>    datasize = pdata.len;
<a name='L2051'>
<a name='L2052'>    <b>if</b> (datasize == 0) <font color='red'>{</font>
<a name='L2053'>        <a href='../S/2775.html#L684' title='Defined at 684 in Objects/abstract.c.'>PyBuffer_Release</a>(&amp;pdata);
<a name='L2054'>        <b>return</b> <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>("", 0);
<a name='L2055'>    <font color='red'>}</font>
<a name='L2056'>
<a name='L2057'>    ret = <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, bufsize);
<a name='L2058'>    <b>if</b> (!ret) <font color='red'>{</font>
<a name='L2059'>        <a href='../S/2775.html#L684' title='Defined at 684 in Objects/abstract.c.'>PyBuffer_Release</a>(&amp;pdata);
<a name='L2060'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L2061'>    <font color='red'>}</font>
<a name='L2062'>
<a name='L2063'>    memset(bzs, 0, <b>sizeof</b>(bz_stream));
<a name='L2064'>
<a name='L2065'>    bzs-&gt;next_in = data;
<a name='L2066'>    bzs-&gt;avail_in = datasize;
<a name='L2067'>    bzs-&gt;next_out = <a href='../S/2626.html#L37' title='Defined at 37 in Modules/bz2module.c.'>BUF</a>(ret);
<a name='L2068'>    bzs-&gt;avail_out = bufsize;
<a name='L2069'>
<a name='L2070'>    bzerror = <a href='../S/2626.html#L72' title='Defined at 72 in Modules/bz2module.c.'>BZ2_bzDecompressInit</a>(bzs, 0, 0);
<a name='L2071'>    <b>if</b> (bzerror != BZ_OK) <font color='red'>{</font>
<a name='L2072'>        <a href='../S/2626.html#L158' title='Defined at 158 in Modules/bz2module.c.'>Util_CatchBZ2Error</a>(bzerror);
<a name='L2073'>        Py_DECREF(ret);
<a name='L2074'>        <a href='../S/2775.html#L684' title='Defined at 684 in Objects/abstract.c.'>PyBuffer_Release</a>(&amp;pdata);
<a name='L2075'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L2076'>    <font color='red'>}</font>
<a name='L2077'>
<a name='L2078'>    <b>for</b> (;;) <font color='red'>{</font>
<a name='L2079'>        <a href='../D/4080.html' title='Multiple defined in 2 places.'>Py_BEGIN_ALLOW_THREADS</a>
<a name='L2080'>        bzerror = <a href='../S/2626.html#L71' title='Defined at 71 in Modules/bz2module.c.'>BZ2_bzDecompress</a>(bzs);
<a name='L2081'>        <a href='../D/4114.html' title='Multiple defined in 2 places.'>Py_END_ALLOW_THREADS</a>
<a name='L2082'>        <b>if</b> (bzerror == BZ_STREAM_END) <font color='red'>{</font>
<a name='L2083'>            <b>break</b>;
<a name='L2084'>        <font color='red'>}</font> <b>else</b> <b>if</b> (bzerror != BZ_OK) <font color='red'>{</font>
<a name='L2085'>            <a href='../S/2626.html#L73' title='Defined at 73 in Modules/bz2module.c.'>BZ2_bzDecompressEnd</a>(bzs);
<a name='L2086'>            <a href='../S/2626.html#L158' title='Defined at 158 in Modules/bz2module.c.'>Util_CatchBZ2Error</a>(bzerror);
<a name='L2087'>            <a href='../S/2775.html#L684' title='Defined at 684 in Objects/abstract.c.'>PyBuffer_Release</a>(&amp;pdata);
<a name='L2088'>            Py_DECREF(ret);
<a name='L2089'>            <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L2090'>        <font color='red'>}</font>
<a name='L2091'>        <b>if</b> (bzs-&gt;avail_in == 0) <font color='red'>{</font>
<a name='L2092'>            <a href='../S/2626.html#L73' title='Defined at 73 in Modules/bz2module.c.'>BZ2_bzDecompressEnd</a>(bzs);
<a name='L2093'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError,
<a name='L2094'>                            "couldn't find end of stream");
<a name='L2095'>            <a href='../S/2775.html#L684' title='Defined at 684 in Objects/abstract.c.'>PyBuffer_Release</a>(&amp;pdata);
<a name='L2096'>            Py_DECREF(ret);
<a name='L2097'>            <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L2098'>        <font color='red'>}</font>
<a name='L2099'>        <b>if</b> (bzs-&gt;avail_out == 0) <font color='red'>{</font>
<a name='L2100'>            bufsize = <a href='../S/2626.html#L229' title='Defined at 229 in Modules/bz2module.c.'>Util_NewBufferSize</a>(bufsize);
<a name='L2101'>            <b>if</b> (<a href='../S/2779.html#L2822' title='Defined at 2822 in Objects/bytesobject.c.'>_PyBytes_Resize</a>(&amp;ret, bufsize) &lt; 0) <font color='red'>{</font>
<a name='L2102'>                <a href='../S/2626.html#L73' title='Defined at 73 in Modules/bz2module.c.'>BZ2_bzDecompressEnd</a>(bzs);
<a name='L2103'>                <a href='../S/2775.html#L684' title='Defined at 684 in Objects/abstract.c.'>PyBuffer_Release</a>(&amp;pdata);
<a name='L2104'>                <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L2105'>            <font color='red'>}</font>
<a name='L2106'>            bzs-&gt;next_out = <a href='../S/2626.html#L37' title='Defined at 37 in Modules/bz2module.c.'>BUF</a>(ret) + <a href='../D/411.html' title='Multiple defined in 4 places.'>BZS_TOTAL_OUT</a>(bzs);
<a name='L2107'>            bzs-&gt;avail_out = bufsize - (bzs-&gt;next_out - <a href='../S/2626.html#L37' title='Defined at 37 in Modules/bz2module.c.'>BUF</a>(ret));
<a name='L2108'>        <font color='red'>}</font>
<a name='L2109'>    <font color='red'>}</font>
<a name='L2110'>
<a name='L2111'>    <b>if</b> (bzs-&gt;avail_out != 0) <font color='red'>{</font>
<a name='L2112'>        <b>if</b> (<a href='../S/2779.html#L2822' title='Defined at 2822 in Objects/bytesobject.c.'>_PyBytes_Resize</a>(&amp;ret, (<a href='../D/4364.html' title='Multiple defined in 6 places.'>Py_ssize_t</a>)<a href='../D/411.html' title='Multiple defined in 4 places.'>BZS_TOTAL_OUT</a>(bzs)) &lt; 0) <font color='red'>{</font>
<a name='L2113'>            ret = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L2114'>        <font color='red'>}</font>
<a name='L2115'>    <font color='red'>}</font>
<a name='L2116'>    <a href='../S/2626.html#L73' title='Defined at 73 in Modules/bz2module.c.'>BZ2_bzDecompressEnd</a>(bzs);
<a name='L2117'>    <a href='../S/2775.html#L684' title='Defined at 684 in Objects/abstract.c.'>PyBuffer_Release</a>(&amp;pdata);
<a name='L2118'>
<a name='L2119'>    <b>return</b> ret;
<a name='L2120'><font color='red'>}</font>
<a name='L2121'>
<a name='L2122'><b>static</b> <a href='../D/3525.html' title='Multiple defined in 3 places.'>PyMethodDef</a> bz2_methods[] = <font color='red'>{</font>
<a name='L2123'>    <font color='red'>{</font>"compress", (PyCFunction) <a href='../S/2626.html#L1940' title='Defined at 1940 in Modules/bz2module.c.'>bz2_compress</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a>|METH_KEYWORDS,
<a name='L2124'>        bz2_compress__doc__<font color='red'>}</font>,
<a name='L2125'>    <font color='red'>{</font>"decompress", (PyCFunction) <a href='../S/2626.html#L2036' title='Defined at 2036 in Modules/bz2module.c.'>bz2_decompress</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a>,
<a name='L2126'>        bz2_decompress__doc__<font color='red'>}</font>,
<a name='L2127'>    <font color='red'>{</font><a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,              <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>           <i><font color='green'>/* sentinel */</font></i>
<a name='L2128'><font color='red'>}</font>;
<a name='L2129'>
<a name='L2130'><i><font color='green'>/* ===================================================================== */</font></i>
<a name='L2131'><i><font color='green'>/* Initialization function. */</font></i>
<a name='L2132'>
<a name='L2133'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(bz2__doc__,
<a name='L2134'>"The python bz2 module provides a comprehensive interface for\n\
<a name='L2135'>the bz2 compression library. It implements a complete file\n\
<a name='L2136'>interface, one shot (de)compression functions, and types for\n\
<a name='L2137'>sequential (de)compression.\n\
<a name='L2138'>");
<a name='L2139'>
<a name='L2140'>
<a name='L2141'><b>static</b> <b>struct</b> <a href='../D/3534.html' title='Multiple defined in 2 places.'>PyModuleDef</a> bz2module = <font color='red'>{</font>
<a name='L2142'>    <a href='../S/542.html#L33' title='Defined at 33 in Include/moduleobject.h.'>PyModuleDef_HEAD_INIT</a>,
<a name='L2143'>    "bz2",
<a name='L2144'>    bz2__doc__,
<a name='L2145'>    -1,
<a name='L2146'>    bz2_methods,
<a name='L2147'>    <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L2148'>    <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L2149'>    <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L2150'>    <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>
<a name='L2151'><font color='red'>}</font>;
<a name='L2152'>
<a name='L2153'><a href='../D/3482.html' title='Multiple defined in 10 places.'>PyMODINIT_FUNC</a>
<a name='L2154'>PyInit_bz2(<b>void</b>)
<a name='L2155'><font color='red'>{</font>
<a name='L2156'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *m;
<a name='L2157'>
<a name='L2158'>    <b>if</b> (<a href='../S/2824.html#L3799' title='Defined at 3799 in Objects/typeobject.c.'>PyType_Ready</a>(&amp;BZ2File_Type) &lt; 0)
<a name='L2159'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L2160'>    <b>if</b> (<a href='../S/2824.html#L3799' title='Defined at 3799 in Objects/typeobject.c.'>PyType_Ready</a>(&amp;BZ2Comp_Type) &lt; 0)
<a name='L2161'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L2162'>    <b>if</b> (<a href='../S/2824.html#L3799' title='Defined at 3799 in Objects/typeobject.c.'>PyType_Ready</a>(&amp;BZ2Decomp_Type) &lt; 0)
<a name='L2163'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L2164'>
<a name='L2165'>    m = PyModule_Create(&amp;bz2module);
<a name='L2166'>    <b>if</b> (m == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L2167'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L2168'>
<a name='L2169'>    <a href='../S/3125.html#L525' title='Defined at 525 in Python/modsupport.c.'>PyModule_AddObject</a>(m, "__author__", <a href='../D/4012.html' title='Multiple defined in 3 places.'>PyUnicode_FromString</a>(__author__));
<a name='L2170'>
<a name='L2171'>    Py_INCREF(&amp;BZ2File_Type);
<a name='L2172'>    <a href='../S/3125.html#L525' title='Defined at 525 in Python/modsupport.c.'>PyModule_AddObject</a>(m, "BZ2File", (<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *)&amp;BZ2File_Type);
<a name='L2173'>
<a name='L2174'>    Py_INCREF(&amp;BZ2Comp_Type);
<a name='L2175'>    <a href='../S/3125.html#L525' title='Defined at 525 in Python/modsupport.c.'>PyModule_AddObject</a>(m, "BZ2Compressor", (<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *)&amp;BZ2Comp_Type);
<a name='L2176'>
<a name='L2177'>    Py_INCREF(&amp;BZ2Decomp_Type);
<a name='L2178'>    <a href='../S/3125.html#L525' title='Defined at 525 in Python/modsupport.c.'>PyModule_AddObject</a>(m, "BZ2Decompressor", (<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *)&amp;BZ2Decomp_Type);
<a name='L2179'>    <b>return</b> m;
<a name='L2180'><font color='red'>}</font>
</pre>
<hr>
<a name='BOTTOM'>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L145'>[^]</a><a href='#L2154'>[v]</a><a href='#TOP'>[top]</a>[bottom]<a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
</body>
</html>
