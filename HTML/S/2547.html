<html>
<head>
<title>Modules/_ctypes/libffi_osx/powerpc/ppc-ffi_darwin.c</title>
<meta name='robots' content='noindex,nofollow'>
<meta name='generator' content='GLOBAL-5.8.1'>
</head>
<body text='#191970' bgcolor='#f5f5dc' vlink='gray'>
<a name='TOP'><h2><a href='../mains.html'>root</a>/<a href='../files/3353.html'>Modules</a>/<a href='../files/3354.html'>_ctypes</a>/<a href='../files/3381.html'>libffi_osx</a>/<a href='../files/3383.html'>powerpc</a>/ppc-ffi_darwin.c</h2>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L91'>[^]</a><a href='#L1724'>[v]</a>[top]<a href='#BOTTOM'>[bottom]</a><a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
<hr>
<h2>DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href='#L91' title='Defined at 91.'>ffi_prep_args</a>
<li><a href='#L308' title='Defined at 308.'>ffi64_struct_contains_fp</a>
<li><a href='#L331' title='Defined at 331.'>ffi_prep_cif_machdep</a>
<li><a href='#L581' title='Defined at 581.'>ffi_call</a>
<li><a href='#L684' title='Defined at 684.'>flush_icache</a>
<li><a href='#L699' title='Defined at 699.'>flush_range</a>
<li><a href='#L714' title='Defined at 714.'>ffi_prep_closure</a>
<li><a href='#L814' title='Defined at 814.'>ffi_closure_helper_DARWIN</a>
<li><a href='#L1031' title='Defined at 1031.'>ffi64_struct_to_ram_form</a>
<li><a href='#L1294' title='Defined at 1294.'>ffi64_struct_to_reg_form</a>
<li><a href='#L1608' title='Defined at 1608.'>ffi64_stret_needs_ptr</a>
<li><a href='#L1724' title='Defined at 1724.'>ffi64_data_size</a>
</ol>
<hr>
<pre>
<a name='L1'><font color='darkred'>#if</font> <b>defined</b>(__ppc__) || <b>defined</b>(__ppc64__)
<a name='L2'>
<a name='L3'><i><font color='green'>/* -----------------------------------------------------------------------</font></i>
<a name='L4'><i><font color='green'>   ffi.c - Copyright (c) 1998 Geoffrey Keating</font></i>
<a name='L5'><i><font color='green'></font></i>
<a name='L6'><i><font color='green'>   PowerPC Foreign Function Interface</font></i>
<a name='L7'><i><font color='green'></font></i>
<a name='L8'><i><font color='green'>   Darwin ABI support (c) 2001 John Hornkvist</font></i>
<a name='L9'><i><font color='green'>   AIX ABI support (c) 2002 Free Software Foundation, Inc.</font></i>
<a name='L10'><i><font color='green'></font></i>
<a name='L11'><i><font color='green'>   Permission is hereby granted, free of charge, to any person obtaining</font></i>
<a name='L12'><i><font color='green'>   a copy of this software and associated documentation files (the</font></i>
<a name='L13'><i><font color='green'>   ``Software''), to deal in the Software without restriction, including</font></i>
<a name='L14'><i><font color='green'>   without limitation the rights to use, copy, modify, merge, publish,</font></i>
<a name='L15'><i><font color='green'>   distribute, sublicense, and/or sell copies of the Software, and to</font></i>
<a name='L16'><i><font color='green'>   permit persons to whom the Software is furnished to do so, subject to</font></i>
<a name='L17'><i><font color='green'>   the following conditions:</font></i>
<a name='L18'><i><font color='green'></font></i>
<a name='L19'><i><font color='green'>   The above copyright notice and this permission notice shall be included</font></i>
<a name='L20'><i><font color='green'>   in all copies or substantial portions of the Software.</font></i>
<a name='L21'><i><font color='green'></font></i>
<a name='L22'><i><font color='green'>   THE SOFTWARE IS PROVIDED ``AS IS'', WITHOUT WARRANTY OF ANY KIND, EXPRESS</font></i>
<a name='L23'><i><font color='green'>   OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF</font></i>
<a name='L24'><i><font color='green'>   MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.</font></i>
<a name='L25'><i><font color='green'>   IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY CLAIM, DAMAGES OR</font></i>
<a name='L26'><i><font color='green'>   OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,</font></i>
<a name='L27'><i><font color='green'>   ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR</font></i>
<a name='L28'><i><font color='green'>   OTHER DEALINGS IN THE SOFTWARE.</font></i>
<a name='L29'><i><font color='green'>   ----------------------------------------------------------------------- */</font></i>
<a name='L30'>
<a name='L31'><font color='darkred'>#include</font> &lt;<a href='../I/325.html'>ffi.h</a>&gt;
<a name='L32'><font color='darkred'>#include</font> &lt;<a href='../I/119.html'>ffi_common.h</a>&gt;
<a name='L33'>
<a name='L34'><font color='darkred'>#include</font> &lt;stdbool.h&gt;
<a name='L35'><font color='darkred'>#include</font> &lt;stdio.h&gt;
<a name='L36'><font color='darkred'>#include</font> &lt;stdlib.h&gt;
<a name='L37'><font color='darkred'>#include</font> &lt;<a href='2544.html'>ppc-darwin.h</a>&gt;
<a name='L38'><font color='darkred'>#include</font> &lt;architecture/ppc/mode_independent_asm.h&gt;
<a name='L39'>
<a name='L40'><font color='darkred'>#if</font> 0
<a name='L41'><font color='darkred'>#if</font> <b>defined</b>(<a href='../S/2537.html#L63' title='Defined at 63 in Modules/_ctypes/libffi_osx/include/ffi.h.'>POWERPC_DARWIN</a>)
<a name='L42'><font color='darkred'>#include</font> &lt;libkern/OSCacheControl.h&gt;     <i><font color='green'>// for sys_icache_invalidate()</font></i>
<a name='L43'><font color='darkred'>#endif</font>
<a name='L44'>
<a name='L45'><font color='darkred'>#else</font>
<a name='L46'>
<a name='L47'><font color='darkred'>#pragma</font> weak sys_icache_invalidate
<a name='L48'><b>extern</b> <b>void</b> sys_icache_invalidate(<b>void</b> *start, <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a> len);
<a name='L49'>
<a name='L50'><font color='darkred'>#endif</font>
<a name='L51'>
<a name='L52'>
<a name='L53'><b>extern</b> <b>void</b> ffi_closure_ASM(<b>void</b>);
<a name='L54'>
<a name='L55'><i><font color='green'>// The layout of a function descriptor.  A C function pointer really</font></i>
<a name='L56'><i><font color='green'>// points to one of these.</font></i>
<a name='L57'><b>typedef</b> <b>struct</b> aix_fd_struct <font color='red'>{</font>
<a name='L58'>  <b>void</b>* code_pointer;
<a name='L59'>  <b>void</b>* toc;
<a name='L60'><font color='red'>}</font> <a href='../R/5946.html' title='Multiple refered from 3 places.'>aix_fd</a>;
<a name='L61'>
<a name='L62'><i><font color='green'>/* ffi_prep_args is called by the assembly routine once stack space</font></i>
<a name='L63'><i><font color='green'>   has been allocated for the function's arguments.</font></i>
<a name='L64'><i><font color='green'></font></i>
<a name='L65'><i><font color='green'>   The stack layout we want looks like this:</font></i>
<a name='L66'><i><font color='green'></font></i>
<a name='L67'><i><font color='green'>   |   Return address from ffi_call_DARWIN      |       higher addresses</font></i>
<a name='L68'><i><font color='green'>   |--------------------------------------------|</font></i>
<a name='L69'><i><font color='green'>   |   Previous backchain pointer      4/8      |           stack pointer here</font></i>
<a name='L70'><i><font color='green'>   |--------------------------------------------|-\ &lt;&lt;&lt; on entry to</font></i>
<a name='L71'><i><font color='green'>   |   Saved r28-r31                 (4/8)*4    | |         ffi_call_DARWIN</font></i>
<a name='L72'><i><font color='green'>   |--------------------------------------------| |</font></i>
<a name='L73'><i><font color='green'>   |   Parameters      (at least 8*(4/8)=32/64) | | (176) +112 - +288</font></i>
<a name='L74'><i><font color='green'>   |--------------------------------------------| |</font></i>
<a name='L75'><i><font color='green'>   |   Space for GPR2                  4/8      | |</font></i>
<a name='L76'><i><font color='green'>   |--------------------------------------------| |     stack   |</font></i>
<a name='L77'><i><font color='green'>   |   Reserved                                          (4/8)*2    | | grows   |</font></i>
<a name='L78'><i><font color='green'>   |--------------------------------------------| |     down    V</font></i>
<a name='L79'><i><font color='green'>   |   Space for callee's LR           4/8      | |</font></i>
<a name='L80'><i><font color='green'>   |--------------------------------------------| |     lower addresses</font></i>
<a name='L81'><i><font color='green'>   |   Saved CR                        4/8      | |</font></i>
<a name='L82'><i><font color='green'>   |--------------------------------------------| |     stack pointer here</font></i>
<a name='L83'><i><font color='green'>   |   Current backchain pointer       4/8      | |     during</font></i>
<a name='L84'><i><font color='green'>   |--------------------------------------------|-/ &lt;&lt;&lt; ffi_call_DARWIN</font></i>
<a name='L85'><i><font color='green'></font></i>
<a name='L86'><i><font color='green'>        Note: ppc64 CR is saved in the low word of a long on the stack.</font></i>
<a name='L87'><i><font color='green'>*/</font></i>
<a name='L88'>
<a name='L89'><i><font color='green'>/*@-exportheader@*/</font></i>
<a name='L90'><b>void</b>
<a name='L91'><a href='../R/7708.html' title='Multiple refered from 25 places.'>ffi_prep_args</a>(
<a name='L92'>        extended_cif*   inEcif,
<a name='L93'>        <b>unsigned</b> *<b>const</b> stack)
<a name='L94'><i><font color='green'>/*@=exportheader@*/</font></i>
<a name='L95'><font color='red'>{</font>
<a name='L96'>        <i><font color='green'>/*      Copy the ecif to a local var so we can trample the arg.</font></i>
<a name='L97'><i><font color='green'>                BC note: test this with GP later for possible problems...       */</font></i>
<a name='L98'>        <b>volatile</b> <a href='../D/8426.html' title='Multiple defined in 5 places.'>extended_cif</a>*  ecif    = inEcif;
<a name='L99'>
<a name='L100'>        <b>const</b> <b>unsigned</b> <a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>    = ecif-&gt;cif-&gt;<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>;
<a name='L101'>        <b>const</b> <b>unsigned</b> <a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a>    = ecif-&gt;cif-&gt;<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a>;
<a name='L102'>
<a name='L103'>        <i><font color='green'>/*      Cast the stack arg from int* to long*. sizeof(long) == 4 in 32-bit mode</font></i>
<a name='L104'><i><font color='green'>                and 8 in 64-bit mode.   */</font></i>
<a name='L105'>        <b>unsigned</b> <b>long</b> *<b>const</b> longStack  = (<b>unsigned</b> <b>long</b> *<b>const</b>)<a href='../S/2844.html#L22' title='Defined at 22 in Parser/parser.h.'>stack</a>;
<a name='L106'>
<a name='L107'>        <i><font color='green'>/* 'stacktop' points at the previous backchain pointer. */</font></i>
<a name='L108'><font color='darkred'>#if</font> <b>defined</b>(__ppc64__)
<a name='L109'>        <i><font color='green'>//      In ppc-darwin.s, an extra 96 bytes is reserved for the linkage area,</font></i>
<a name='L110'>        <i><font color='green'>//      saved registers, and an extra FPR.</font></i>
<a name='L111'>        <b>unsigned</b> <b>long</b> *<b>const</b> stacktop   =
<a name='L112'>                (<b>unsigned</b> <b>long</b> *)(<b>unsigned</b> <b>long</b>)((<b>char</b>*)longStack + <a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> + 96);
<a name='L113'><font color='darkred'>#elif</font> <b>defined</b>(__ppc__)
<a name='L114'>        <b>unsigned</b> <b>long</b> *<b>const</b> stacktop   = longStack + (<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> / <b>sizeof</b>(<b>long</b>));
<a name='L115'><font color='darkred'>#else</font>
<a name='L116'><font color='darkred'>#error</font> undefined architecture
<a name='L117'><font color='darkred'>#endif</font>
<a name='L118'>
<a name='L119'>        <i><font color='green'>/* 'fpr_base' points at the space for fpr1, and grows upwards as</font></i>
<a name='L120'><i><font color='green'>                we use FPR registers.  */</font></i>
<a name='L121'>        <b>double</b>*         fpr_base = (<b>double</b>*)(stacktop - <a href='../D/160.html' title='Multiple defined in 3 places.'>ASM_NEEDS_REGISTERS</a>) -
<a name='L122'>                <a href='../D/2354.html' title='Multiple defined in 2 places.'>NUM_FPR_ARG_REGISTERS</a>;
<a name='L123'>
<a name='L124'><font color='darkred'>#if</font> <b>defined</b>(__ppc64__)
<a name='L125'>        <i><font color='green'>//      64-bit saves an extra register, and uses an extra FPR. Knock fpr_base</font></i>
<a name='L126'>        <i><font color='green'>//      down a couple pegs.</font></i>
<a name='L127'>        fpr_base -= 2;
<a name='L128'><font color='darkred'>#endif</font>
<a name='L129'>
<a name='L130'>        <b>unsigned</b> <b>int</b>    fparg_count = 0;
<a name='L131'>
<a name='L132'>        <i><font color='green'>/* 'next_arg' grows up as we put parameters in it.  */</font></i>
<a name='L133'>        <b>unsigned</b> <b>long</b>*  next_arg = longStack + 6; <i><font color='green'>/* 6 reserved positions.  */</font></i>
<a name='L134'>
<a name='L135'>        <b>int</b>                             i;
<a name='L136'>        <b>double</b>                  double_tmp;
<a name='L137'>        <b>void</b>**                  p_argv = ecif-&gt;avalue;
<a name='L138'>        <b>unsigned</b> <b>long</b>   gprvalue;
<a name='L139'>        <a href='../D/8534.html' title='Multiple defined in 3 places.'>ffi_type</a>**              ptr = ecif-&gt;cif-&gt;arg_types;
<a name='L140'>
<a name='L141'>        <i><font color='green'>/* Check that everything starts aligned properly.  */</font></i>
<a name='L142'>        <a href='../D/1120.html' title='Multiple defined in 8 places.'>FFI_ASSERT</a>(<a href='../S/2844.html#L22' title='Defined at 22 in Parser/parser.h.'>stack</a> == SF_ROUND(<a href='../S/2844.html#L22' title='Defined at 22 in Parser/parser.h.'>stack</a>));
<a name='L143'>        <a href='../D/1120.html' title='Multiple defined in 8 places.'>FFI_ASSERT</a>(stacktop == SF_ROUND(stacktop));
<a name='L144'>        <a href='../D/1120.html' title='Multiple defined in 8 places.'>FFI_ASSERT</a>(<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> == SF_ROUND(<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>));
<a name='L145'>
<a name='L146'>        <i><font color='green'>/*      Deal with return values that are actually pass-by-reference.</font></i>
<a name='L147'><i><font color='green'>                Rule:</font></i>
<a name='L148'><i><font color='green'>                Return values are referenced by r3, so r4 is the first parameter.  */</font></i>
<a name='L149'>
<a name='L150'>        <b>if</b> (<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> &amp; <a href='../D/1258.html' title='Multiple defined in 3 places.'>FLAG_RETVAL_REFERENCE</a>)
<a name='L151'>                *next_arg++ = (<b>unsigned</b> <b>long</b>)(<b>char</b>*)ecif-&gt;rvalue;
<a name='L152'>
<a name='L153'>        <i><font color='green'>/* Now for the arguments.  */</font></i>
<a name='L154'>        <b>for</b> (i = ecif-&gt;cif-&gt;nargs; i &gt; 0; i--, ptr++, p_argv++)
<a name='L155'>    <font color='red'>{</font>
<a name='L156'>                <b>switch</b> ((*ptr)-&gt;type)
<a name='L157'>                <font color='red'>{</font>
<a name='L158'>                        <i><font color='green'>/*      If a floating-point parameter appears before all of the general-</font></i>
<a name='L159'><i><font color='green'>                                purpose registers are filled, the corresponding GPRs that match</font></i>
<a name='L160'><i><font color='green'>                                the size of the floating-point parameter are shadowed for the</font></i>
<a name='L161'><i><font color='green'>                                benefit of vararg and pre-ANSI functions.       */</font></i>
<a name='L162'>                        <b>case</b> <a href='../D/1181.html' title='Multiple defined in 3 places.'>FFI_TYPE_FLOAT</a>:
<a name='L163'>                                double_tmp = *(<b>float</b>*)*p_argv;
<a name='L164'>
<a name='L165'>                                <b>if</b> (fparg_count &lt; <a href='../D/2354.html' title='Multiple defined in 2 places.'>NUM_FPR_ARG_REGISTERS</a>)
<a name='L166'>                                        *fpr_base++ = double_tmp;
<a name='L167'>
<a name='L168'>                                *(<b>double</b>*)next_arg = double_tmp;
<a name='L169'>
<a name='L170'>                                next_arg++;
<a name='L171'>                                fparg_count++;
<a name='L172'>                                <a href='../D/1120.html' title='Multiple defined in 8 places.'>FFI_ASSERT</a>(<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> &amp; <a href='../D/1251.html' title='Multiple defined in 3 places.'>FLAG_FP_ARGUMENTS</a>);
<a name='L173'>
<a name='L174'>                                <b>break</b>;
<a name='L175'>
<a name='L176'>                        <b>case</b> <a href='../D/1180.html' title='Multiple defined in 3 places.'>FFI_TYPE_DOUBLE</a>:
<a name='L177'>                                double_tmp = *(<b>double</b>*)*p_argv;
<a name='L178'>
<a name='L179'>                                <b>if</b> (fparg_count &lt; <a href='../D/2354.html' title='Multiple defined in 2 places.'>NUM_FPR_ARG_REGISTERS</a>)
<a name='L180'>                                        *fpr_base++ = double_tmp;
<a name='L181'>
<a name='L182'>                                *(<b>double</b>*)next_arg = double_tmp;
<a name='L183'>
<a name='L184'>                                next_arg += <a href='../D/2156.html' title='Multiple defined in 4 places.'>MODE_CHOICE</a>(2,1);
<a name='L185'>                                fparg_count++;
<a name='L186'>                                <a href='../D/1120.html' title='Multiple defined in 8 places.'>FFI_ASSERT</a>(<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> &amp; <a href='../D/1251.html' title='Multiple defined in 3 places.'>FLAG_FP_ARGUMENTS</a>);
<a name='L187'>
<a name='L188'>                                <b>break</b>;
<a name='L189'>
<a name='L190'><font color='darkred'>#if</font> <a href='../D/1184.html' title='Multiple defined in 8 places.'>FFI_TYPE_LONGDOUBLE</a> != <a href='../D/1180.html' title='Multiple defined in 3 places.'>FFI_TYPE_DOUBLE</a>
<a name='L191'>                        <b>case</b> <a href='../D/1184.html' title='Multiple defined in 8 places.'>FFI_TYPE_LONGDOUBLE</a>:
<a name='L192'><font color='darkred'>#if</font> <b>defined</b>(__ppc64__)
<a name='L193'>                                <b>if</b> (fparg_count &lt; <a href='../D/2354.html' title='Multiple defined in 2 places.'>NUM_FPR_ARG_REGISTERS</a>)
<a name='L194'>                                        *(<b>long</b> <b>double</b>*)fpr_base = *(<b>long</b> <b>double</b>*)*p_argv;
<a name='L195'><font color='darkred'>#elif</font> <b>defined</b>(__ppc__)
<a name='L196'>                                <b>if</b> (fparg_count &lt; <a href='../D/2354.html' title='Multiple defined in 2 places.'>NUM_FPR_ARG_REGISTERS</a> - 1)
<a name='L197'>                                        *(<b>long</b> <b>double</b>*)fpr_base = *(<b>long</b> <b>double</b>*)*p_argv;
<a name='L198'>                                <b>else</b> <b>if</b> (fparg_count == <a href='../D/2354.html' title='Multiple defined in 2 places.'>NUM_FPR_ARG_REGISTERS</a> - 1)
<a name='L199'>                                        *(<b>double</b>*)fpr_base      = *(<b>double</b>*)*p_argv;
<a name='L200'><font color='darkred'>#else</font>
<a name='L201'><font color='darkred'>#error</font> undefined architecture
<a name='L202'><font color='darkred'>#endif</font>
<a name='L203'>
<a name='L204'>                                *(<b>long</b> <b>double</b>*)next_arg = *(<b>long</b> <b>double</b>*)*p_argv;
<a name='L205'>                                fparg_count += 2;
<a name='L206'>                                fpr_base += 2;
<a name='L207'>                                next_arg += <a href='../D/2156.html' title='Multiple defined in 4 places.'>MODE_CHOICE</a>(4,2);
<a name='L208'>                                <a href='../D/1120.html' title='Multiple defined in 8 places.'>FFI_ASSERT</a>(<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> &amp; <a href='../D/1251.html' title='Multiple defined in 3 places.'>FLAG_FP_ARGUMENTS</a>);
<a name='L209'>
<a name='L210'>                                <b>break</b>;
<a name='L211'><font color='darkred'>#endif</font>  <i><font color='green'>//      FFI_TYPE_LONGDOUBLE != FFI_TYPE_DOUBLE</font></i>
<a name='L212'>
<a name='L213'>                        <b>case</b> <a href='../D/1221.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT64</a>:
<a name='L214'>                        <b>case</b> <a href='../D/1188.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT64</a>:
<a name='L215'><font color='darkred'>#if</font> <b>defined</b>(__ppc64__)
<a name='L216'>                                gprvalue = *(<b>long</b> <b>long</b>*)*p_argv;
<a name='L217'>                                <b>goto</b> putgpr;
<a name='L218'><font color='darkred'>#elif</font> <b>defined</b>(__ppc__)
<a name='L219'>                                *(<b>long</b> <b>long</b>*)next_arg = *(<b>long</b> <b>long</b>*)*p_argv;
<a name='L220'>                                next_arg += 2;
<a name='L221'>                                <b>break</b>;
<a name='L222'><font color='darkred'>#else</font>
<a name='L223'><font color='darkred'>#error</font> undefined architecture
<a name='L224'><font color='darkred'>#endif</font>
<a name='L225'>
<a name='L226'>                        <b>case</b> <a href='../D/1185.html' title='Multiple defined in 3 places.'>FFI_TYPE_POINTER</a>:
<a name='L227'>                                gprvalue = *(<b>unsigned</b> <b>long</b>*)*p_argv;
<a name='L228'>                                <b>goto</b> putgpr;
<a name='L229'>
<a name='L230'>                        <b>case</b> <a href='../D/1222.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT8</a>:
<a name='L231'>                                gprvalue = *(<b>unsigned</b> <b>char</b>*)*p_argv;
<a name='L232'>                                <b>goto</b> putgpr;
<a name='L233'>
<a name='L234'>                        <b>case</b> <a href='../D/1189.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT8</a>:
<a name='L235'>                                gprvalue = *(<b>signed</b> <b>char</b>*)*p_argv;
<a name='L236'>                                <b>goto</b> putgpr;
<a name='L237'>
<a name='L238'>                        <b>case</b> <a href='../D/1219.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT16</a>:
<a name='L239'>                                gprvalue = *(<b>unsigned</b> <b>short</b>*)*p_argv;
<a name='L240'>                                <b>goto</b> putgpr;
<a name='L241'>
<a name='L242'>                        <b>case</b> <a href='../D/1186.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT16</a>:
<a name='L243'>                                gprvalue = *(<b>signed</b> <b>short</b>*)*p_argv;
<a name='L244'>                                <b>goto</b> putgpr;
<a name='L245'>
<a name='L246'>                        <b>case</b> <a href='../D/1202.html' title='Multiple defined in 3 places.'>FFI_TYPE_STRUCT</a>:
<a name='L247'>                        <font color='red'>{</font>
<a name='L248'><font color='darkred'>#if</font> <b>defined</b>(__ppc64__)
<a name='L249'>                                <b>unsigned</b> <b>int</b>    gprSize = 0;
<a name='L250'>                                <b>unsigned</b> <b>int</b>    fprSize = 0;
<a name='L251'>
<a name='L252'>                                <a href='../S/2547.html#L1294' title='Defined at 1294 in Modules/_ctypes/libffi_osx/powerpc/ppc-ffi_darwin.c.'>ffi64_struct_to_reg_form</a>(*ptr, (<b>char</b>*)*p_argv, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, &amp;fparg_count,
<a name='L253'>                                        (<b>char</b>*)next_arg, &amp;gprSize, (<b>char</b>*)fpr_base, &amp;fprSize);
<a name='L254'>                                next_arg += gprSize / <b>sizeof</b>(<b>long</b>);
<a name='L255'>                                fpr_base += fprSize / <b>sizeof</b>(<b>double</b>);
<a name='L256'>
<a name='L257'><font color='darkred'>#elif</font> <b>defined</b>(__ppc__)
<a name='L258'>                                <b>char</b>*   dest_cpy = (<b>char</b>*)next_arg;
<a name='L259'>
<a name='L260'>                        <i><font color='green'>/*      Structures that match the basic modes (QI 1 byte, HI 2 bytes,</font></i>
<a name='L261'><i><font color='green'>                                SI 4 bytes) are aligned as if they were those modes.</font></i>
<a name='L262'><i><font color='green'>                                Structures with 3 byte in size are padded upwards.  */</font></i>
<a name='L263'>                                <b>unsigned</b> size_al = (*ptr)-&gt;size;
<a name='L264'>
<a name='L265'>                        <i><font color='green'>/*      If the first member of the struct is a double, then align</font></i>
<a name='L266'><i><font color='green'>                                the struct to double-word.  */</font></i>
<a name='L267'>                                <b>if</b> ((*ptr)-&gt;elements[0]-&gt;type == <a href='../D/1180.html' title='Multiple defined in 3 places.'>FFI_TYPE_DOUBLE</a>)
<a name='L268'>                                        size_al = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>((*ptr)-&gt;size, 8);
<a name='L269'>
<a name='L270'>                                <b>if</b> (ecif-&gt;cif-&gt;abi == <a href='../D/1129.html' title='Multiple defined in 6 places.'>FFI_DARWIN</a>)
<a name='L271'>                                <font color='red'>{</font>
<a name='L272'>                                        <b>if</b> (size_al &lt; 3)
<a name='L273'>                                                dest_cpy += 4 - size_al;
<a name='L274'>                                <font color='red'>}</font>
<a name='L275'>
<a name='L276'>                                <a href='../D/9803.html' title='Multiple defined in 4 places.'>memcpy</a>((<b>char</b>*)dest_cpy, (<b>char</b>*)*p_argv, size_al);
<a name='L277'>                                next_arg += (size_al + 3) / 4;
<a name='L278'><font color='darkred'>#else</font>
<a name='L279'><font color='darkred'>#error</font> undefined architecture
<a name='L280'><font color='darkred'>#endif</font>
<a name='L281'>                                <b>break</b>;
<a name='L282'>                        <font color='red'>}</font>
<a name='L283'>
<a name='L284'>                        <b>case</b> <a href='../D/1182.html' title='Multiple defined in 3 places.'>FFI_TYPE_INT</a>:
<a name='L285'>                        <b>case</b> <a href='../D/1220.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT32</a>:
<a name='L286'>                        <b>case</b> <a href='../D/1187.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT32</a>:
<a name='L287'>                                gprvalue = *(<b>unsigned</b>*)*p_argv;
<a name='L288'>
<a name='L289'>putgpr:
<a name='L290'>                                *next_arg++ = gprvalue;
<a name='L291'>                                <b>break</b>;
<a name='L292'>
<a name='L293'>                        <b>default</b>:
<a name='L294'>                                <b>break</b>;
<a name='L295'>                <font color='red'>}</font>
<a name='L296'>        <font color='red'>}</font>
<a name='L297'>
<a name='L298'>  <i><font color='green'>/* Check that we didn't overrun the stack...  */</font></i>
<a name='L299'>  <i><font color='green'>//FFI_ASSERT(gpr_base &lt;= stacktop - ASM_NEEDS_REGISTERS);</font></i>
<a name='L300'>  <i><font color='green'>//FFI_ASSERT((unsigned *)fpr_base</font></i>
<a name='L301'>  <i><font color='green'>//         &lt;= stacktop - ASM_NEEDS_REGISTERS - NUM_GPR_ARG_REGISTERS);</font></i>
<a name='L302'>  <i><font color='green'>//FFI_ASSERT(flags &amp; FLAG_4_GPR_ARGUMENTS || intarg_count &lt;= 4);</font></i>
<a name='L303'><font color='red'>}</font>
<a name='L304'>
<a name='L305'><font color='darkred'>#if</font> <b>defined</b>(__ppc64__)
<a name='L306'>
<a name='L307'>bool
<a name='L308'><a href='../R/7677.html' title='Multiple refered from 2 places.'>ffi64_struct_contains_fp</a>(
<a name='L309'>        <b>const</b> ffi_type* inType)
<a name='L310'><font color='red'>{</font>
<a name='L311'>        bool                    containsFP      = false;
<a name='L312'>        <b>unsigned</b> <b>int</b>    i;
<a name='L313'>
<a name='L314'>        <b>for</b> (i = 0; inType-&gt;elements[i] != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; !containsFP; i++)
<a name='L315'>        <font color='red'>{</font>
<a name='L316'>                <b>if</b> (inType-&gt;elements[i]-&gt;type == <a href='../D/1181.html' title='Multiple defined in 3 places.'>FFI_TYPE_FLOAT</a>         ||
<a name='L317'>                        inType-&gt;elements[i]-&gt;type == <a href='../D/1180.html' title='Multiple defined in 3 places.'>FFI_TYPE_DOUBLE</a>    ||
<a name='L318'>                        inType-&gt;elements[i]-&gt;type == <a href='../D/1184.html' title='Multiple defined in 8 places.'>FFI_TYPE_LONGDOUBLE</a>)
<a name='L319'>                        containsFP = true;
<a name='L320'>                <b>else</b> <b>if</b> (inType-&gt;elements[i]-&gt;type == <a href='../D/1202.html' title='Multiple defined in 3 places.'>FFI_TYPE_STRUCT</a>)
<a name='L321'>                        containsFP = <a href='../S/2547.html#L308' title='Defined at 308 in Modules/_ctypes/libffi_osx/powerpc/ppc-ffi_darwin.c.'>ffi64_struct_contains_fp</a>(inType-&gt;elements[i]);
<a name='L322'>        <font color='red'>}</font>
<a name='L323'>
<a name='L324'>        <b>return</b> containsFP;
<a name='L325'><font color='red'>}</font>
<a name='L326'>
<a name='L327'><font color='darkred'>#endif</font>  <i><font color='green'>// defined(__ppc64__)</font></i>
<a name='L328'>
<a name='L329'><i><font color='green'>/* Perform machine dependent cif processing.  */</font></i>
<a name='L330'><a href='../D/8530.html' title='Multiple defined in 4 places.'>ffi_status</a>
<a name='L331'><a href='../R/7714.html' title='Multiple refered from 9 places.'>ffi_prep_cif_machdep</a>(
<a name='L332'>        ffi_cif*        cif)
<a name='L333'><font color='red'>{</font>
<a name='L334'>        <i><font color='green'>/* All this is for the DARWIN ABI.  */</font></i>
<a name='L335'>        <b>int</b>                             i;
<a name='L336'>        <a href='../D/8534.html' title='Multiple defined in 3 places.'>ffi_type</a>**              ptr;
<a name='L337'>        <b>int</b>                             intarg_count = 0;
<a name='L338'>        <b>int</b>                             fparg_count = 0;
<a name='L339'>        <b>unsigned</b> <b>int</b>    <a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> = 0;
<a name='L340'>        <b>unsigned</b> <b>int</b>    size_al = 0;
<a name='L341'>
<a name='L342'>        <i><font color='green'>/*      All the machine-independent calculation of cif-&gt;bytes will be wrong.</font></i>
<a name='L343'><i><font color='green'>                Redo the calculation for DARWIN.  */</font></i>
<a name='L344'>
<a name='L345'>        <i><font color='green'>/*      Space for the frame pointer, callee's LR, CR, etc, and for</font></i>
<a name='L346'><i><font color='green'>                the asm's temp regs.  */</font></i>
<a name='L347'>        <b>unsigned</b> <b>int</b>    <a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> = (6 + <a href='../D/160.html' title='Multiple defined in 3 places.'>ASM_NEEDS_REGISTERS</a>) * <b>sizeof</b>(<b>long</b>);
<a name='L348'>
<a name='L349'>        <i><font color='green'>/*      Return value handling.  The rules are as follows:</font></i>
<a name='L350'><i><font color='green'>                - 32-bit (or less) integer values are returned in gpr3;</font></i>
<a name='L351'><i><font color='green'>                - Structures of size &lt;= 4 bytes also returned in gpr3;</font></i>
<a name='L352'><i><font color='green'>                - 64-bit integer values and structures between 5 and 8 bytes are</font></i>
<a name='L353'><i><font color='green'>                        returned in gpr3 and gpr4;</font></i>
<a name='L354'><i><font color='green'>                - Single/double FP values are returned in fpr1;</font></i>
<a name='L355'><i><font color='green'>                - Long double FP (if not equivalent to double) values are returned in</font></i>
<a name='L356'><i><font color='green'>                        fpr1 and fpr2;</font></i>
<a name='L357'><i><font color='green'>                - Larger structures values are allocated space and a pointer is passed</font></i>
<a name='L358'><i><font color='green'>                        as the first argument.  */</font></i>
<a name='L359'>        <b>switch</b> (cif-&gt;rtype-&gt;type)
<a name='L360'>        <font color='red'>{</font>
<a name='L361'><font color='darkred'>#if</font> <a href='../D/1184.html' title='Multiple defined in 8 places.'>FFI_TYPE_LONGDOUBLE</a> != <a href='../D/1180.html' title='Multiple defined in 3 places.'>FFI_TYPE_DOUBLE</a>
<a name='L362'>                <b>case</b> <a href='../D/1184.html' title='Multiple defined in 8 places.'>FFI_TYPE_LONGDOUBLE</a>:
<a name='L363'>                        <a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> |= <a href='../D/1252.html' title='Multiple defined in 3 places.'>FLAG_RETURNS_128BITS</a>;
<a name='L364'>                        <a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> |= <a href='../D/1254.html' title='Multiple defined in 3 places.'>FLAG_RETURNS_FP</a>;
<a name='L365'>                        <b>break</b>;
<a name='L366'><font color='darkred'>#endif</font>  <i><font color='green'>// FFI_TYPE_LONGDOUBLE != FFI_TYPE_DOUBLE</font></i>
<a name='L367'>
<a name='L368'>                <b>case</b> <a href='../D/1180.html' title='Multiple defined in 3 places.'>FFI_TYPE_DOUBLE</a>:
<a name='L369'>                        <a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> |= <a href='../D/1253.html' title='Multiple defined in 3 places.'>FLAG_RETURNS_64BITS</a>;
<a name='L370'>                        <i><font color='green'>/* Fall through.  */</font></i>
<a name='L371'>                <b>case</b> <a href='../D/1181.html' title='Multiple defined in 3 places.'>FFI_TYPE_FLOAT</a>:
<a name='L372'>                        <a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> |= <a href='../D/1254.html' title='Multiple defined in 3 places.'>FLAG_RETURNS_FP</a>;
<a name='L373'>                        <b>break</b>;
<a name='L374'>
<a name='L375'><font color='darkred'>#if</font> <b>defined</b>(__ppc64__)
<a name='L376'>                <b>case</b> <a href='../D/1185.html' title='Multiple defined in 3 places.'>FFI_TYPE_POINTER</a>:
<a name='L377'><font color='darkred'>#endif</font>
<a name='L378'>                <b>case</b> <a href='../D/1221.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT64</a>:
<a name='L379'>                <b>case</b> <a href='../D/1188.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT64</a>:
<a name='L380'>                        <a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> |= <a href='../D/1253.html' title='Multiple defined in 3 places.'>FLAG_RETURNS_64BITS</a>;
<a name='L381'>                        <b>break</b>;
<a name='L382'>
<a name='L383'>                <b>case</b> <a href='../D/1202.html' title='Multiple defined in 3 places.'>FFI_TYPE_STRUCT</a>:
<a name='L384'>                <font color='red'>{</font>
<a name='L385'><font color='darkred'>#if</font> <b>defined</b>(__ppc64__)
<a name='L386'>
<a name='L387'>                        <b>if</b> (<a href='../S/2547.html#L1608' title='Defined at 1608 in Modules/_ctypes/libffi_osx/powerpc/ppc-ffi_darwin.c.'>ffi64_stret_needs_ptr</a>(cif-&gt;rtype, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>))
<a name='L388'>                        <font color='red'>{</font>
<a name='L389'>                                <a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> |= <a href='../D/1258.html' title='Multiple defined in 3 places.'>FLAG_RETVAL_REFERENCE</a>;
<a name='L390'>                                <a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> |= <a href='../D/1255.html' title='Multiple defined in 3 places.'>FLAG_RETURNS_NOTHING</a>;
<a name='L391'>                                intarg_count++;
<a name='L392'>                        <font color='red'>}</font>
<a name='L393'>                        <b>else</b>
<a name='L394'>                        <font color='red'>{</font>
<a name='L395'>                                <a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> |= <a href='../S/2544.html#L67' title='Defined at 67 in Modules/_ctypes/libffi_osx/powerpc/ppc-darwin.h.'>FLAG_RETURNS_STRUCT</a>;
<a name='L396'>
<a name='L397'>                                <b>if</b> (<a href='../S/2547.html#L308' title='Defined at 308 in Modules/_ctypes/libffi_osx/powerpc/ppc-ffi_darwin.c.'>ffi64_struct_contains_fp</a>(cif-&gt;rtype))
<a name='L398'>                                        <a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> |= <a href='../S/2544.html#L68' title='Defined at 68 in Modules/_ctypes/libffi_osx/powerpc/ppc-darwin.h.'>FLAG_STRUCT_CONTAINS_FP</a>;
<a name='L399'>                        <font color='red'>}</font>
<a name='L400'>
<a name='L401'><font color='darkred'>#elif</font> <b>defined</b>(__ppc__)
<a name='L402'>
<a name='L403'>                        <a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> |= <a href='../D/1258.html' title='Multiple defined in 3 places.'>FLAG_RETVAL_REFERENCE</a>;
<a name='L404'>                        <a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> |= <a href='../D/1255.html' title='Multiple defined in 3 places.'>FLAG_RETURNS_NOTHING</a>;
<a name='L405'>                        intarg_count++;
<a name='L406'>
<a name='L407'><font color='darkred'>#else</font>
<a name='L408'><font color='darkred'>#error</font> undefined architecture
<a name='L409'><font color='darkred'>#endif</font>
<a name='L410'>                        <b>break</b>;
<a name='L411'>                <font color='red'>}</font>
<a name='L412'>
<a name='L413'>                <b>case</b> <a href='../D/1223.html' title='Multiple defined in 3 places.'>FFI_TYPE_VOID</a>:
<a name='L414'>                        <a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> |= <a href='../D/1255.html' title='Multiple defined in 3 places.'>FLAG_RETURNS_NOTHING</a>;
<a name='L415'>                        <b>break</b>;
<a name='L416'>
<a name='L417'>                <b>default</b>:
<a name='L418'>                        <i><font color='green'>/* Returns 32-bit integer, or similar.  Nothing to do here.  */</font></i>
<a name='L419'>                        <b>break</b>;
<a name='L420'>        <font color='red'>}</font>
<a name='L421'>
<a name='L422'>        <i><font color='green'>/*      The first NUM_GPR_ARG_REGISTERS words of integer arguments, and the</font></i>
<a name='L423'><i><font color='green'>                first NUM_FPR_ARG_REGISTERS fp arguments, go in registers; the rest</font></i>
<a name='L424'><i><font color='green'>                goes on the stack.  Structures are passed as a pointer to a copy of</font></i>
<a name='L425'><i><font color='green'>                the structure. Stuff on the stack needs to keep proper alignment.  */</font></i>
<a name='L426'>        <b>for</b> (ptr = cif-&gt;arg_types, i = cif-&gt;nargs; i &gt; 0; i--, ptr++)
<a name='L427'>        <font color='red'>{</font>
<a name='L428'>                <b>switch</b> ((*ptr)-&gt;type)
<a name='L429'>                <font color='red'>{</font>
<a name='L430'>                        <b>case</b> <a href='../D/1181.html' title='Multiple defined in 3 places.'>FFI_TYPE_FLOAT</a>:
<a name='L431'>                        <b>case</b> <a href='../D/1180.html' title='Multiple defined in 3 places.'>FFI_TYPE_DOUBLE</a>:
<a name='L432'>                                fparg_count++;
<a name='L433'>                                <i><font color='green'>/*      If this FP arg is going on the stack, it must be</font></i>
<a name='L434'><i><font color='green'>                                        8-byte-aligned.  */</font></i>
<a name='L435'>                                <b>if</b> (fparg_count &gt; <a href='../D/2354.html' title='Multiple defined in 2 places.'>NUM_FPR_ARG_REGISTERS</a>
<a name='L436'>                                        &amp;&amp; intarg_count % 2 != 0)
<a name='L437'>                                        intarg_count++;
<a name='L438'>                                <b>break</b>;
<a name='L439'>
<a name='L440'><font color='darkred'>#if</font> <a href='../D/1184.html' title='Multiple defined in 8 places.'>FFI_TYPE_LONGDOUBLE</a> != <a href='../D/1180.html' title='Multiple defined in 3 places.'>FFI_TYPE_DOUBLE</a>
<a name='L441'>                        <b>case</b> <a href='../D/1184.html' title='Multiple defined in 8 places.'>FFI_TYPE_LONGDOUBLE</a>:
<a name='L442'>                                fparg_count += 2;
<a name='L443'>                                <i><font color='green'>/*      If this FP arg is going on the stack, it must be</font></i>
<a name='L444'><i><font color='green'>                                        8-byte-aligned.  */</font></i>
<a name='L445'>
<a name='L446'>                                <b>if</b> (
<a name='L447'><font color='darkred'>#if</font> <b>defined</b>(__ppc64__)
<a name='L448'>                                        fparg_count &gt; <a href='../D/2354.html' title='Multiple defined in 2 places.'>NUM_FPR_ARG_REGISTERS</a> + 1
<a name='L449'><font color='darkred'>#elif</font> <b>defined</b>(__ppc__)
<a name='L450'>                                        fparg_count &gt; <a href='../D/2354.html' title='Multiple defined in 2 places.'>NUM_FPR_ARG_REGISTERS</a>
<a name='L451'><font color='darkred'>#else</font>
<a name='L452'><font color='darkred'>#error</font> undefined architecture
<a name='L453'><font color='darkred'>#endif</font>
<a name='L454'>                                        &amp;&amp; intarg_count % 2 != 0)
<a name='L455'>                                        intarg_count++;
<a name='L456'>
<a name='L457'>                                intarg_count += 2;
<a name='L458'>                                <b>break</b>;
<a name='L459'><font color='darkred'>#endif</font>  <i><font color='green'>// FFI_TYPE_LONGDOUBLE != FFI_TYPE_DOUBLE</font></i>
<a name='L460'>
<a name='L461'>                        <b>case</b> <a href='../D/1221.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT64</a>:
<a name='L462'>                        <b>case</b> <a href='../D/1188.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT64</a>:
<a name='L463'>                                <i><font color='green'>/*      'long long' arguments are passed as two words, but</font></i>
<a name='L464'><i><font color='green'>                                        either both words must fit in registers or both go</font></i>
<a name='L465'><i><font color='green'>                                        on the stack.  If they go on the stack, they must</font></i>
<a name='L466'><i><font color='green'>                                        be 8-byte-aligned.  */</font></i>
<a name='L467'>                                <b>if</b> (intarg_count == <a href='../D/2357.html' title='Multiple defined in 2 places.'>NUM_GPR_ARG_REGISTERS</a> - 1
<a name='L468'>                                        || (intarg_count &gt;= <a href='../D/2357.html' title='Multiple defined in 2 places.'>NUM_GPR_ARG_REGISTERS</a>
<a name='L469'>                                        &amp;&amp; intarg_count % 2 != 0))
<a name='L470'>                                        intarg_count++;
<a name='L471'>
<a name='L472'>                                intarg_count += <a href='../D/2156.html' title='Multiple defined in 4 places.'>MODE_CHOICE</a>(2,1);
<a name='L473'>
<a name='L474'>                                <b>break</b>;
<a name='L475'>
<a name='L476'>                        <b>case</b> <a href='../D/1202.html' title='Multiple defined in 3 places.'>FFI_TYPE_STRUCT</a>:
<a name='L477'>                                size_al = (*ptr)-&gt;size;
<a name='L478'>                                <i><font color='green'>/*      If the first member of the struct is a double, then align</font></i>
<a name='L479'><i><font color='green'>                                        the struct to double-word.  */</font></i>
<a name='L480'>                                <b>if</b> ((*ptr)-&gt;elements[0]-&gt;type == <a href='../D/1180.html' title='Multiple defined in 3 places.'>FFI_TYPE_DOUBLE</a>)
<a name='L481'>                                        size_al = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>((*ptr)-&gt;size, 8);
<a name='L482'>
<a name='L483'><font color='darkred'>#if</font> <b>defined</b>(__ppc64__)
<a name='L484'>                                <i><font color='green'>// Look for FP struct members.</font></i>
<a name='L485'>                                <b>unsigned</b> <b>int</b>    j;
<a name='L486'>
<a name='L487'>                                <b>for</b> (j = 0; (*ptr)-&gt;elements[j] != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>; j++)
<a name='L488'>                                <font color='red'>{</font>
<a name='L489'>                                        <b>if</b> ((*ptr)-&gt;elements[j]-&gt;type == <a href='../D/1181.html' title='Multiple defined in 3 places.'>FFI_TYPE_FLOAT</a> ||
<a name='L490'>                                                (*ptr)-&gt;elements[j]-&gt;type == <a href='../D/1180.html' title='Multiple defined in 3 places.'>FFI_TYPE_DOUBLE</a>)
<a name='L491'>                                        <font color='red'>{</font>
<a name='L492'>                                                fparg_count++;
<a name='L493'>
<a name='L494'>                                                <b>if</b> (fparg_count &gt; <a href='../D/2354.html' title='Multiple defined in 2 places.'>NUM_FPR_ARG_REGISTERS</a>)
<a name='L495'>                                                        intarg_count++;
<a name='L496'>                                        <font color='red'>}</font>
<a name='L497'>                                        <b>else</b> <b>if</b> ((*ptr)-&gt;elements[j]-&gt;type == <a href='../D/1184.html' title='Multiple defined in 8 places.'>FFI_TYPE_LONGDOUBLE</a>)
<a name='L498'>                                        <font color='red'>{</font>
<a name='L499'>                                                fparg_count += 2;
<a name='L500'>
<a name='L501'>                                                <b>if</b> (fparg_count &gt; <a href='../D/2354.html' title='Multiple defined in 2 places.'>NUM_FPR_ARG_REGISTERS</a> + 1)
<a name='L502'>                                                        intarg_count += 2;
<a name='L503'>                                        <font color='red'>}</font>
<a name='L504'>                                        <b>else</b>
<a name='L505'>                                                intarg_count++;
<a name='L506'>                                <font color='red'>}</font>
<a name='L507'><font color='darkred'>#elif</font> <b>defined</b>(__ppc__)
<a name='L508'>                                intarg_count += (size_al + 3) / 4;
<a name='L509'><font color='darkred'>#else</font>
<a name='L510'><font color='darkred'>#error</font> undefined architecture
<a name='L511'><font color='darkred'>#endif</font>
<a name='L512'>
<a name='L513'>                                <b>break</b>;
<a name='L514'>
<a name='L515'>                        <b>default</b>:
<a name='L516'>                                <i><font color='green'>/*      Everything else is passed as a 4/8-byte word in a GPR, either</font></i>
<a name='L517'><i><font color='green'>                                        the object itself or a pointer to it.  */</font></i>
<a name='L518'>                                intarg_count++;
<a name='L519'>                                <b>break</b>;
<a name='L520'>                <font color='red'>}</font>
<a name='L521'>        <font color='red'>}</font>
<a name='L522'>
<a name='L523'>        <i><font color='green'>/* Space for the FPR registers, if needed.  */</font></i>
<a name='L524'>        <b>if</b> (fparg_count != 0)
<a name='L525'>        <font color='red'>{</font>
<a name='L526'>                <a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> |= <a href='../D/1251.html' title='Multiple defined in 3 places.'>FLAG_FP_ARGUMENTS</a>;
<a name='L527'><font color='darkred'>#if</font> <b>defined</b>(__ppc64__)
<a name='L528'>                <a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> += (<a href='../D/2354.html' title='Multiple defined in 2 places.'>NUM_FPR_ARG_REGISTERS</a> + 1) * <b>sizeof</b>(<b>double</b>);
<a name='L529'><font color='darkred'>#elif</font> <b>defined</b>(__ppc__)
<a name='L530'>                <a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> += <a href='../D/2354.html' title='Multiple defined in 2 places.'>NUM_FPR_ARG_REGISTERS</a> * <b>sizeof</b>(<b>double</b>);
<a name='L531'><font color='darkred'>#else</font>
<a name='L532'><font color='darkred'>#error</font> undefined architecture
<a name='L533'><font color='darkred'>#endif</font>
<a name='L534'>        <font color='red'>}</font>
<a name='L535'>
<a name='L536'>        <i><font color='green'>/* Stack space.  */</font></i>
<a name='L537'><font color='darkred'>#if</font> <b>defined</b>(__ppc64__)
<a name='L538'>        <b>if</b> ((intarg_count + fparg_count) &gt; <a href='../D/2357.html' title='Multiple defined in 2 places.'>NUM_GPR_ARG_REGISTERS</a>)
<a name='L539'>                <a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> += (intarg_count + fparg_count) * <b>sizeof</b>(<b>long</b>);
<a name='L540'><font color='darkred'>#elif</font> <b>defined</b>(__ppc__)
<a name='L541'>        <b>if</b> ((intarg_count + 2 * fparg_count) &gt; <a href='../D/2357.html' title='Multiple defined in 2 places.'>NUM_GPR_ARG_REGISTERS</a>)
<a name='L542'>                <a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> += (intarg_count + 2 * fparg_count) * <b>sizeof</b>(<b>long</b>);
<a name='L543'><font color='darkred'>#else</font>
<a name='L544'><font color='darkred'>#error</font> undefined architecture
<a name='L545'><font color='darkred'>#endif</font>
<a name='L546'>        <b>else</b>
<a name='L547'>                <a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> += <a href='../D/2357.html' title='Multiple defined in 2 places.'>NUM_GPR_ARG_REGISTERS</a> * <b>sizeof</b>(<b>long</b>);
<a name='L548'>
<a name='L549'>        <i><font color='green'>/* The stack space allocated needs to be a multiple of 16/32 bytes.  */</font></i>
<a name='L550'>        <a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> = SF_ROUND(<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>);
<a name='L551'>
<a name='L552'>        cif-&gt;<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a> = <a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a>;
<a name='L553'>        cif-&gt;<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> = <a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>;
<a name='L554'>
<a name='L555'>        <b>return</b> <a href='../D/1165.html' title='Multiple defined in 3 places.'>FFI_OK</a>;
<a name='L556'><font color='red'>}</font>
<a name='L557'>
<a name='L558'><i><font color='green'>/*@-declundef@*/</font></i>
<a name='L559'><i><font color='green'>/*@-exportheader@*/</font></i>
<a name='L560'><b>extern</b> <b>void</b>
<a name='L561'>ffi_call_AIX(
<a name='L562'><i><font color='green'>/*@out@*/</font></i>       extended_cif*,
<a name='L563'>                        <b>unsigned</b>,
<a name='L564'>                        <b>unsigned</b>,
<a name='L565'><i><font color='green'>/*@out@*/</font></i>       <b>unsigned</b>*,
<a name='L566'>                        <b>void</b> (*fn)(<b>void</b>),
<a name='L567'>                        <b>void</b> (*fn2)(extended_cif*, <b>unsigned</b> *<b>const</b>));
<a name='L568'>
<a name='L569'><b>extern</b> <b>void</b>
<a name='L570'>ffi_call_DARWIN(
<a name='L571'><i><font color='green'>/*@out@*/</font></i>       extended_cif*,
<a name='L572'>                        <b>unsigned</b> <b>long</b>,
<a name='L573'>                        <b>unsigned</b>,
<a name='L574'><i><font color='green'>/*@out@*/</font></i>       <b>unsigned</b>*,
<a name='L575'>                        <b>void</b> (*fn)(<b>void</b>),
<a name='L576'>                        <b>void</b> (*fn2)(extended_cif*, <b>unsigned</b> *<b>const</b>));
<a name='L577'><i><font color='green'>/*@=declundef@*/</font></i>
<a name='L578'><i><font color='green'>/*@=exportheader@*/</font></i>
<a name='L579'>
<a name='L580'><b>void</b>
<a name='L581'><a href='../R/7684.html' title='Multiple refered from 112 places.'>ffi_call</a>(
<a name='L582'><i><font color='green'>/*@dependent@*/</font></i> ffi_cif*        cif,
<a name='L583'>                                <b>void</b>            (*fn)(<b>void</b>),
<a name='L584'><i><font color='green'>/*@out@*/</font></i>               <b>void</b>*           rvalue,
<a name='L585'><i><font color='green'>/*@dependent@*/</font></i> <b>void</b>**          avalue)
<a name='L586'><font color='red'>{</font>
<a name='L587'>        <a href='../D/8426.html' title='Multiple defined in 5 places.'>extended_cif</a> ecif;
<a name='L588'>
<a name='L589'>        ecif.cif = cif;
<a name='L590'>        ecif.avalue = avalue;
<a name='L591'>
<a name='L592'>        <i><font color='green'>/*      If the return value is a struct and we don't have a return</font></i>
<a name='L593'><i><font color='green'>                value address then we need to make one.  */</font></i>
<a name='L594'>        <b>if</b> ((rvalue == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) &amp;&amp;
<a name='L595'>                (cif-&gt;rtype-&gt;type == <a href='../D/1202.html' title='Multiple defined in 3 places.'>FFI_TYPE_STRUCT</a>))
<a name='L596'>        <font color='red'>{</font>
<a name='L597'>                <i><font color='green'>/*@-sysunrecog@*/</font></i>
<a name='L598'>                ecif.rvalue = <a href='../D/6714.html' title='Multiple defined in 6 places.'>alloca</a>(cif-&gt;rtype-&gt;size);
<a name='L599'>                <i><font color='green'>/*@=sysunrecog@*/</font></i>
<a name='L600'>        <font color='red'>}</font>
<a name='L601'>        <b>else</b>
<a name='L602'>                ecif.rvalue = rvalue;
<a name='L603'>
<a name='L604'>        <b>switch</b> (cif-&gt;abi)
<a name='L605'>        <font color='red'>{</font>
<a name='L606'>                <b>case</b> <a href='../D/1113.html' title='Multiple defined in 6 places.'>FFI_AIX</a>:
<a name='L607'>                        <i><font color='green'>/*@-usedef@*/</font></i>
<a name='L608'>                        ffi_call_AIX(&amp;ecif, -cif-&gt;<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>,
<a name='L609'>                                cif-&gt;<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a>, ecif.rvalue, <a href='../S/2334.html#L39' title='Defined at 39 in Modules/_ctypes/libffi/src/mips/n32.S.'>fn</a>, <a href='../D/8505.html' title='Multiple defined in 17 places.'>ffi_prep_args</a>);
<a name='L610'>                        <i><font color='green'>/*@=usedef@*/</font></i>
<a name='L611'>                        <b>break</b>;
<a name='L612'>
<a name='L613'>                <b>case</b> <a href='../D/1129.html' title='Multiple defined in 6 places.'>FFI_DARWIN</a>:
<a name='L614'>                        <i><font color='green'>/*@-usedef@*/</font></i>
<a name='L615'>                        ffi_call_DARWIN(&amp;ecif, -(<b>long</b>)cif-&gt;<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>,
<a name='L616'>                                cif-&gt;<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a>, ecif.rvalue, <a href='../S/2334.html#L39' title='Defined at 39 in Modules/_ctypes/libffi/src/mips/n32.S.'>fn</a>, <a href='../D/8505.html' title='Multiple defined in 17 places.'>ffi_prep_args</a>);
<a name='L617'>                        <i><font color='green'>/*@=usedef@*/</font></i>
<a name='L618'>                        <b>break</b>;
<a name='L619'>
<a name='L620'>                <b>default</b>:
<a name='L621'>                        <a href='../D/1120.html' title='Multiple defined in 8 places.'>FFI_ASSERT</a>(0);
<a name='L622'>                        <b>break</b>;
<a name='L623'>    <font color='red'>}</font>
<a name='L624'><font color='red'>}</font>
<a name='L625'>
<a name='L626'><i><font color='green'>/* here I'd like to add the stack frame layout we use in darwin_closure.S</font></i>
<a name='L627'><i><font color='green'>   and aix_clsoure.S</font></i>
<a name='L628'><i><font color='green'></font></i>
<a name='L629'><i><font color='green'>   SP previous -&gt; +---------------------------------------+ &lt;--- child frame</font></i>
<a name='L630'><i><font color='green'>                  | back chain to caller 4                |</font></i>
<a name='L631'><i><font color='green'>                  +---------------------------------------+ 4</font></i>
<a name='L632'><i><font color='green'>                  | saved CR 4                            |</font></i>
<a name='L633'><i><font color='green'>                  +---------------------------------------+ 8</font></i>
<a name='L634'><i><font color='green'>                  | saved LR 4                            |</font></i>
<a name='L635'><i><font color='green'>                  +---------------------------------------+ 12</font></i>
<a name='L636'><i><font color='green'>                  | reserved for compilers 4              |</font></i>
<a name='L637'><i><font color='green'>                  +---------------------------------------+ 16</font></i>
<a name='L638'><i><font color='green'>                  | reserved for binders 4                |</font></i>
<a name='L639'><i><font color='green'>                  +---------------------------------------+ 20</font></i>
<a name='L640'><i><font color='green'>                  | saved TOC pointer 4                   |</font></i>
<a name='L641'><i><font color='green'>                  +---------------------------------------+ 24</font></i>
<a name='L642'><i><font color='green'>                  | always reserved 8*4=32 (previous GPRs)|</font></i>
<a name='L643'><i><font color='green'>                  | according to the linkage convention   |</font></i>
<a name='L644'><i><font color='green'>                  | from AIX                              |</font></i>
<a name='L645'><i><font color='green'>                  +---------------------------------------+ 56</font></i>
<a name='L646'><i><font color='green'>                  | our FPR area 13*8=104                 |</font></i>
<a name='L647'><i><font color='green'>                  | f1                                    |</font></i>
<a name='L648'><i><font color='green'>                  | .                                     |</font></i>
<a name='L649'><i><font color='green'>                  | f13                                   |</font></i>
<a name='L650'><i><font color='green'>                  +---------------------------------------+ 160</font></i>
<a name='L651'><i><font color='green'>                  | result area 8                         |</font></i>
<a name='L652'><i><font color='green'>                  +---------------------------------------+ 168</font></i>
<a name='L653'><i><font color='green'>                  | alignement to the next multiple of 16 |</font></i>
<a name='L654'><i><font color='green'>SP current --&gt;    +---------------------------------------+ 176 &lt;- parent frame</font></i>
<a name='L655'><i><font color='green'>                  | back chain to caller 4                |</font></i>
<a name='L656'><i><font color='green'>                  +---------------------------------------+ 180</font></i>
<a name='L657'><i><font color='green'>                  | saved CR 4                            |</font></i>
<a name='L658'><i><font color='green'>                  +---------------------------------------+ 184</font></i>
<a name='L659'><i><font color='green'>                  | saved LR 4                            |</font></i>
<a name='L660'><i><font color='green'>                  +---------------------------------------+ 188</font></i>
<a name='L661'><i><font color='green'>                  | reserved for compilers 4              |</font></i>
<a name='L662'><i><font color='green'>                  +---------------------------------------+ 192</font></i>
<a name='L663'><i><font color='green'>                  | reserved for binders 4                |</font></i>
<a name='L664'><i><font color='green'>                  +---------------------------------------+ 196</font></i>
<a name='L665'><i><font color='green'>                  | saved TOC pointer 4                   |</font></i>
<a name='L666'><i><font color='green'>                  +---------------------------------------+ 200</font></i>
<a name='L667'><i><font color='green'>                  | always reserved 8*4=32  we store our  |</font></i>
<a name='L668'><i><font color='green'>                  | GPRs here                             |</font></i>
<a name='L669'><i><font color='green'>                  | r3                                    |</font></i>
<a name='L670'><i><font color='green'>                  | .                                     |</font></i>
<a name='L671'><i><font color='green'>                  | r10                                   |</font></i>
<a name='L672'><i><font color='green'>                  +---------------------------------------+ 232</font></i>
<a name='L673'><i><font color='green'>                  | overflow part                         |</font></i>
<a name='L674'><i><font color='green'>                  +---------------------------------------+ xxx</font></i>
<a name='L675'><i><font color='green'>                  | ????                                  |</font></i>
<a name='L676'><i><font color='green'>                  +---------------------------------------+ xxx</font></i>
<a name='L677'><i><font color='green'>*/</font></i>
<a name='L678'>
<a name='L679'><font color='darkred'>#if</font> !<b>defined</b>(<a href='../S/2537.html#L63' title='Defined at 63 in Modules/_ctypes/libffi_osx/include/ffi.h.'>POWERPC_DARWIN</a>)
<a name='L680'>
<a name='L681'><font color='darkred'>#define</font> <a href='../R/1936.html' title='Multiple refered from 2 places.'>MIN_LINE_SIZE</a> 32
<a name='L682'>
<a name='L683'><b>static</b> <b>void</b>
<a name='L684'><a href='../R/7872.html' title='Multiple refered from 6 places.'>flush_icache</a>(
<a name='L685'>        <b>char</b>*   addr)
<a name='L686'><font color='red'>{</font>
<a name='L687'><font color='darkred'>#ifndef</font> _AIX
<a name='L688'>        <b>__asm__</b> <b>volatile</b> (
<a name='L689'>                "dcbf 0,%0\n"
<a name='L690'>                "sync\n"
<a name='L691'>                "icbi 0,%0\n"
<a name='L692'>                "sync\n"
<a name='L693'>                "isync"
<a name='L694'>                : : "r" (addr) : "memory");
<a name='L695'><font color='darkred'>#endif</font>
<a name='L696'><font color='red'>}</font>
<a name='L697'>
<a name='L698'><b>static</b> <b>void</b>
<a name='L699'><a href='../R/7875.html' title='Multiple refered from 3 places.'>flush_range</a>(
<a name='L700'>        <b>char</b>*   addr,
<a name='L701'>        <b>int</b>             size)
<a name='L702'><font color='red'>{</font>
<a name='L703'>        <b>int</b> i;
<a name='L704'>
<a name='L705'>        <b>for</b> (i = 0; i &lt; size; i += <a href='../D/2138.html' title='Multiple defined in 2 places.'>MIN_LINE_SIZE</a>)
<a name='L706'>                <a href='../D/8671.html' title='Multiple defined in 3 places.'>flush_icache</a>(addr + i);
<a name='L707'>
<a name='L708'>        <a href='../D/8671.html' title='Multiple defined in 3 places.'>flush_icache</a>(addr + size - 1);
<a name='L709'><font color='red'>}</font>
<a name='L710'>
<a name='L711'><font color='darkred'>#endif</font>  <i><font color='green'>// !defined(POWERPC_DARWIN)</font></i>
<a name='L712'>
<a name='L713'><a href='../D/8530.html' title='Multiple defined in 4 places.'>ffi_status</a>
<a name='L714'><a href='../R/7715.html' title='Multiple refered from 3 places.'>ffi_prep_closure</a>(
<a name='L715'>        ffi_closure*    closure,
<a name='L716'>        ffi_cif*                cif,
<a name='L717'>        <b>void</b>                    (*fun)(ffi_cif*, <b>void</b>*, <b>void</b>**, <b>void</b>*),
<a name='L718'>        <b>void</b>*                   user_data)
<a name='L719'><font color='red'>{</font>
<a name='L720'>        <b>switch</b> (cif-&gt;abi)
<a name='L721'>        <font color='red'>{</font>
<a name='L722'>                <b>case</b> <a href='../D/1129.html' title='Multiple defined in 6 places.'>FFI_DARWIN</a>:
<a name='L723'>                <font color='red'>{</font>
<a name='L724'>                        <a href='../D/1120.html' title='Multiple defined in 8 places.'>FFI_ASSERT</a> (cif-&gt;abi == <a href='../D/1129.html' title='Multiple defined in 6 places.'>FFI_DARWIN</a>);
<a name='L725'>
<a name='L726'>                        <b>unsigned</b> <b>int</b>*   tramp = (<b>unsigned</b> <b>int</b>*)&amp;closure-&gt;tramp[0];
<a name='L727'>
<a name='L728'><font color='darkred'>#if</font> <b>defined</b>(__ppc64__)
<a name='L729'>                        tramp[0] = 0x7c0802a6;  <i><font color='green'>//      mflr    r0</font></i>
<a name='L730'>                        tramp[1] = 0x429f0005;  <i><font color='green'>//      bcl             20,31,+0x8</font></i>
<a name='L731'>                        tramp[2] = 0x7d6802a6;  <i><font color='green'>//      mflr    r11</font></i>
<a name='L732'>                        tramp[3] = 0x7c0803a6;  <i><font color='green'>//      mtlr    r0</font></i>
<a name='L733'>                        tramp[4] = 0xe98b0018;  <i><font color='green'>//      ld              r12,24(r11)</font></i>
<a name='L734'>                        tramp[5] = 0x7d8903a6;  <i><font color='green'>//      mtctr   r12</font></i>
<a name='L735'>                        tramp[6] = 0xe96b0020;  <i><font color='green'>//      ld              r11,32(r11)</font></i>
<a name='L736'>                        tramp[7] = 0x4e800420;  <i><font color='green'>//      bctr</font></i>
<a name='L737'>                        *(<b>unsigned</b> <b>long</b>*)&amp;tramp[8] = (<b>unsigned</b> <b>long</b>)ffi_closure_ASM;
<a name='L738'>                        *(<b>unsigned</b> <b>long</b>*)&amp;tramp[10] = (<b>unsigned</b> <b>long</b>)closure;
<a name='L739'><font color='darkred'>#elif</font> <b>defined</b>(__ppc__)
<a name='L740'>                        tramp[0] = 0x7c0802a6;  <i><font color='green'>//      mflr    r0</font></i>
<a name='L741'>                        tramp[1] = 0x429f0005;  <i><font color='green'>//      bcl             20,31,+0x8</font></i>
<a name='L742'>                        tramp[2] = 0x7d6802a6;  <i><font color='green'>//      mflr    r11</font></i>
<a name='L743'>                        tramp[3] = 0x7c0803a6;  <i><font color='green'>//      mtlr    r0</font></i>
<a name='L744'>                        tramp[4] = 0x818b0018;  <i><font color='green'>//      lwz             r12,24(r11)</font></i>
<a name='L745'>                        tramp[5] = 0x7d8903a6;  <i><font color='green'>//      mtctr   r12</font></i>
<a name='L746'>                        tramp[6] = 0x816b001c;  <i><font color='green'>//      lwz             r11,28(r11)</font></i>
<a name='L747'>                        tramp[7] = 0x4e800420;  <i><font color='green'>//      bctr</font></i>
<a name='L748'>                        tramp[8] = (<b>unsigned</b> <b>long</b>)ffi_closure_ASM;
<a name='L749'>                        tramp[9] = (<b>unsigned</b> <b>long</b>)closure;
<a name='L750'><font color='darkred'>#else</font>
<a name='L751'><font color='darkred'>#error</font> undefined architecture
<a name='L752'><font color='darkred'>#endif</font>
<a name='L753'>
<a name='L754'>                        closure-&gt;cif = cif;
<a name='L755'>                        closure-&gt;fun = fun;
<a name='L756'>                        closure-&gt;user_data = user_data;
<a name='L757'>
<a name='L758'>                        <i><font color='green'>// Flush the icache. Only necessary on Darwin.</font></i>
<a name='L759'><font color='darkred'>#if</font> <b>defined</b>(<a href='../S/2537.html#L63' title='Defined at 63 in Modules/_ctypes/libffi_osx/include/ffi.h.'>POWERPC_DARWIN</a>)
<a name='L760'>                        sys_icache_invalidate(closure-&gt;tramp, <a href='../D/1174.html' title='Multiple defined in 35 places.'>FFI_TRAMPOLINE_SIZE</a>);
<a name='L761'><font color='darkred'>#else</font>
<a name='L762'>                        <a href='../D/8674.html' title='Multiple defined in 2 places.'>flush_range</a>(closure-&gt;tramp, <a href='../D/1174.html' title='Multiple defined in 35 places.'>FFI_TRAMPOLINE_SIZE</a>);
<a name='L763'><font color='darkred'>#endif</font>
<a name='L764'>
<a name='L765'>                        <b>break</b>;
<a name='L766'>                <font color='red'>}</font>
<a name='L767'>
<a name='L768'>                <b>case</b> <a href='../D/1113.html' title='Multiple defined in 6 places.'>FFI_AIX</a>:
<a name='L769'>                <font color='red'>{</font>
<a name='L770'>                        <a href='../D/1120.html' title='Multiple defined in 8 places.'>FFI_ASSERT</a> (cif-&gt;abi == <a href='../D/1113.html' title='Multiple defined in 6 places.'>FFI_AIX</a>);
<a name='L771'>
<a name='L772'>                        <a href='../D/8470.html' title='Multiple defined in 3 places.'>ffi_aix_trampoline_struct</a>*      tramp_aix =
<a name='L773'>                                (<a href='../D/8470.html' title='Multiple defined in 3 places.'>ffi_aix_trampoline_struct</a>*)(closure-&gt;tramp);
<a name='L774'>                        <a href='../D/6697.html' title='Multiple defined in 2 places.'>aix_fd</a>* fd = (<a href='../D/6697.html' title='Multiple defined in 2 places.'>aix_fd</a>*)(<b>void</b>*)ffi_closure_ASM;
<a name='L775'>
<a name='L776'>                        tramp_aix-&gt;code_pointer = fd-&gt;code_pointer;
<a name='L777'>                        tramp_aix-&gt;toc = fd-&gt;toc;
<a name='L778'>                        tramp_aix-&gt;static_chain = closure;
<a name='L779'>                        closure-&gt;cif = cif;
<a name='L780'>                        closure-&gt;fun = fun;
<a name='L781'>                        closure-&gt;user_data = user_data;
<a name='L782'>                        <b>break</b>;
<a name='L783'>                <font color='red'>}</font>
<a name='L784'>
<a name='L785'>                <b>default</b>:
<a name='L786'>                        <b>return</b> <a href='../D/1123.html' title='Multiple defined in 3 places.'>FFI_BAD_ABI</a>;
<a name='L787'>        <font color='red'>}</font>
<a name='L788'>
<a name='L789'>        <b>return</b> <a href='../D/1165.html' title='Multiple defined in 3 places.'>FFI_OK</a>;
<a name='L790'><font color='red'>}</font>
<a name='L791'>
<a name='L792'><font color='darkred'>#if</font> <b>defined</b>(__ppc__)
<a name='L793'>        <b>typedef</b> <b>double</b> <a href='../R/8621.html' title='Multiple refered from 4 places.'>ldbits</a>[2];
<a name='L794'>
<a name='L795'>        <b>typedef</b> <b>union</b>
<a name='L796'>        <font color='red'>{</font>
<a name='L797'>                <a href='../D/9436.html' title='Multiple defined in 2 places.'>ldbits</a> lb;
<a name='L798'>                <b>long</b> <b>double</b> ld;
<a name='L799'>        <font color='red'>}</font> <a href='../R/8624.html' title='Multiple refered from 2 places.'>ldu</a>;
<a name='L800'><font color='darkred'>#endif</font>
<a name='L801'>
<a name='L802'><b>typedef</b> <b>union</b>
<a name='L803'><font color='red'>{</font>
<a name='L804'>        <b>float</b>   f;
<a name='L805'>        <b>double</b>  d;
<a name='L806'><font color='red'>}</font> <a href='../R/7699.html' title='Multiple refered from 2 places.'>ffi_dblfl</a>;
<a name='L807'>
<a name='L808'><i><font color='green'>/*      The trampoline invokes ffi_closure_ASM, and on entry, r11 holds the</font></i>
<a name='L809'><i><font color='green'>        address of the closure. After storing the registers that could possibly</font></i>
<a name='L810'><i><font color='green'>        contain parameters to be passed into the stack frame and setting up space</font></i>
<a name='L811'><i><font color='green'>        for a return value, ffi_closure_ASM invokes the following helper function</font></i>
<a name='L812'><i><font color='green'>        to do most of the work.  */</font></i>
<a name='L813'><b>int</b>
<a name='L814'><a href='../S/2349.html#L712' title='Refered from 712 in Modules/_ctypes/libffi/src/powerpc/ffi_darwin.c.'>ffi_closure_helper_DARWIN</a>(
<a name='L815'>        ffi_closure*    closure,
<a name='L816'>        <b>void</b>*                   rvalue,
<a name='L817'>        <b>unsigned</b> <b>long</b>*  pgr,
<a name='L818'>        ffi_dblfl*              pfr)
<a name='L819'><font color='red'>{</font>
<a name='L820'>        <i><font color='green'>/*      rvalue is the pointer to space for return value in closure assembly</font></i>
<a name='L821'><i><font color='green'>                pgr is the pointer to where r3-r10 are stored in ffi_closure_ASM</font></i>
<a name='L822'><i><font color='green'>                pfr is the pointer to where f1-f13 are stored in ffi_closure_ASM.  */</font></i>
<a name='L823'>
<a name='L824'><font color='darkred'>#if</font> <b>defined</b>(__ppc__)
<a name='L825'>        <a href='../D/9439.html' title='Multiple defined in 2 places.'>ldu</a>     temp_ld;
<a name='L826'><font color='darkred'>#endif</font>
<a name='L827'>
<a name='L828'>        <b>double</b>                          temp;
<a name='L829'>        <b>unsigned</b> <b>int</b>            i;
<a name='L830'>        <b>unsigned</b> <b>int</b>            nf = 0; <i><font color='green'>/* number of FPRs already used.  */</font></i>
<a name='L831'>        <b>unsigned</b> <b>int</b>            ng = 0; <i><font color='green'>/* number of GPRs already used.  */</font></i>
<a name='L832'>        <a href='../D/8477.html' title='Multiple defined in 4 places.'>ffi_cif</a>*                        cif = closure-&gt;cif;
<a name='L833'>        <b>long</b>                            avn = cif-&gt;nargs;
<a name='L834'>        <b>void</b>**                          avalue = <a href='../D/6714.html' title='Multiple defined in 6 places.'>alloca</a>(cif-&gt;nargs * <b>sizeof</b>(<b>void</b>*));
<a name='L835'>        <a href='../D/8534.html' title='Multiple defined in 3 places.'>ffi_type</a>**                      arg_types = cif-&gt;arg_types;
<a name='L836'>
<a name='L837'>        <i><font color='green'>/*      Copy the caller's structure return value address so that the closure</font></i>
<a name='L838'><i><font color='green'>                returns the data directly to the caller.  */</font></i>
<a name='L839'><font color='darkred'>#if</font> <b>defined</b>(__ppc64__)
<a name='L840'>        <b>if</b> (cif-&gt;rtype-&gt;type == <a href='../D/1202.html' title='Multiple defined in 3 places.'>FFI_TYPE_STRUCT</a> &amp;&amp;
<a name='L841'>                <a href='../S/2547.html#L1608' title='Defined at 1608 in Modules/_ctypes/libffi_osx/powerpc/ppc-ffi_darwin.c.'>ffi64_stret_needs_ptr</a>(cif-&gt;rtype, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>))
<a name='L842'><font color='darkred'>#elif</font> <b>defined</b>(__ppc__)
<a name='L843'>        <b>if</b> (cif-&gt;rtype-&gt;type == <a href='../D/1202.html' title='Multiple defined in 3 places.'>FFI_TYPE_STRUCT</a>)
<a name='L844'><font color='darkred'>#else</font>
<a name='L845'><font color='darkred'>#error</font> undefined architecture
<a name='L846'><font color='darkred'>#endif</font>
<a name='L847'>        <font color='red'>{</font>
<a name='L848'>                rvalue = (<b>void</b>*)*pgr;
<a name='L849'>                pgr++;
<a name='L850'>                ng++;
<a name='L851'>        <font color='red'>}</font>
<a name='L852'>
<a name='L853'>        <i><font color='green'>/* Grab the addresses of the arguments from the stack frame.  */</font></i>
<a name='L854'>        <b>for</b> (i = 0; i &lt; avn; i++)
<a name='L855'>        <font color='red'>{</font>
<a name='L856'>                <b>switch</b> (arg_types[i]-&gt;type)
<a name='L857'>                <font color='red'>{</font>
<a name='L858'>                        <b>case</b> <a href='../D/1189.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT8</a>:
<a name='L859'>                        <b>case</b> <a href='../D/1222.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT8</a>:
<a name='L860'>                                avalue[i] = (<b>char</b>*)pgr + <a href='../D/2156.html' title='Multiple defined in 4 places.'>MODE_CHOICE</a>(3,7);
<a name='L861'>                                ng++;
<a name='L862'>                                pgr++;
<a name='L863'>                                <b>break</b>;
<a name='L864'>
<a name='L865'>                        <b>case</b> <a href='../D/1186.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT16</a>:
<a name='L866'>                        <b>case</b> <a href='../D/1219.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT16</a>:
<a name='L867'>                                avalue[i] = (<b>char</b>*)pgr + <a href='../D/2156.html' title='Multiple defined in 4 places.'>MODE_CHOICE</a>(2,6);
<a name='L868'>                                ng++;
<a name='L869'>                                pgr++;
<a name='L870'>                                <b>break</b>;
<a name='L871'>
<a name='L872'><font color='darkred'>#if</font> <b>defined</b>(__ppc__)
<a name='L873'>                        <b>case</b> <a href='../D/1185.html' title='Multiple defined in 3 places.'>FFI_TYPE_POINTER</a>:
<a name='L874'><font color='darkred'>#endif</font>
<a name='L875'>                        <b>case</b> <a href='../D/1187.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT32</a>:
<a name='L876'>                        <b>case</b> <a href='../D/1220.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT32</a>:
<a name='L877'>                                avalue[i] = (<b>char</b>*)pgr + <a href='../D/2156.html' title='Multiple defined in 4 places.'>MODE_CHOICE</a>(0,4);
<a name='L878'>                                ng++;
<a name='L879'>                                pgr++;
<a name='L880'>
<a name='L881'>                                <b>break</b>;
<a name='L882'>
<a name='L883'>                        <b>case</b> <a href='../D/1202.html' title='Multiple defined in 3 places.'>FFI_TYPE_STRUCT</a>:
<a name='L884'>                                <b>if</b> (cif-&gt;abi == <a href='../D/1129.html' title='Multiple defined in 6 places.'>FFI_DARWIN</a>)
<a name='L885'>                                <font color='red'>{</font>
<a name='L886'><font color='darkred'>#if</font> <b>defined</b>(__ppc64__)
<a name='L887'>                                        <b>unsigned</b> <b>int</b>    gprSize = 0;
<a name='L888'>                                        <b>unsigned</b> <b>int</b>    fprSize = 0;
<a name='L889'>                                        <b>unsigned</b> <b>int</b>    savedFPRSize = fprSize;
<a name='L890'>
<a name='L891'>                                        avalue[i] = <a href='../D/6714.html' title='Multiple defined in 6 places.'>alloca</a>(arg_types[i]-&gt;size);
<a name='L892'>                                        <a href='../S/2547.html#L1031' title='Defined at 1031 in Modules/_ctypes/libffi_osx/powerpc/ppc-ffi_darwin.c.'>ffi64_struct_to_ram_form</a>(arg_types[i], (<b>const</b> <b>char</b>*)pgr,
<a name='L893'>                                                &amp;gprSize, (<b>const</b> <b>char</b>*)pfr, &amp;fprSize, &amp;nf, avalue[i], <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L894'> 
<a name='L895'>                                        ng      += gprSize / <b>sizeof</b>(<b>long</b>);
<a name='L896'>                                        pgr     += gprSize / <b>sizeof</b>(<b>long</b>);
<a name='L897'>                                        pfr     += (fprSize - savedFPRSize) / <b>sizeof</b>(<b>double</b>);
<a name='L898'>
<a name='L899'><font color='darkred'>#elif</font> <b>defined</b>(__ppc__)
<a name='L900'>                                        <i><font color='green'>/*      Structures that match the basic modes (QI 1 byte, HI 2 bytes,</font></i>
<a name='L901'><i><font color='green'>                                                SI 4 bytes) are aligned as if they were those modes.  */</font></i>
<a name='L902'>                                        <b>unsigned</b> <b>int</b>    size_al = size_al = arg_types[i]-&gt;size;
<a name='L903'>
<a name='L904'>                                        <i><font color='green'>/*      If the first member of the struct is a double, then align</font></i>
<a name='L905'><i><font color='green'>                                                the struct to double-word.  */</font></i>
<a name='L906'>                                        <b>if</b> (arg_types[i]-&gt;elements[0]-&gt;type == <a href='../D/1180.html' title='Multiple defined in 3 places.'>FFI_TYPE_DOUBLE</a>)
<a name='L907'>                                                size_al = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(arg_types[i]-&gt;size, 8);
<a name='L908'>
<a name='L909'>                                        <b>if</b> (size_al &lt; 3)
<a name='L910'>                                                avalue[i] = (<b>void</b>*)pgr + <a href='../D/2156.html' title='Multiple defined in 4 places.'>MODE_CHOICE</a>(4,8) - size_al;
<a name='L911'>                                        <b>else</b>
<a name='L912'>                                                avalue[i] = (<b>void</b>*)pgr;
<a name='L913'>
<a name='L914'>                                        ng      += (size_al + 3) / <b>sizeof</b>(<b>long</b>);
<a name='L915'>                                        pgr += (size_al + 3) / <b>sizeof</b>(<b>long</b>);
<a name='L916'><font color='darkred'>#else</font>
<a name='L917'><font color='darkred'>#error</font> undefined architecture
<a name='L918'><font color='darkred'>#endif</font>
<a name='L919'>                                <font color='red'>}</font>
<a name='L920'>
<a name='L921'>                                <b>break</b>;
<a name='L922'>
<a name='L923'><font color='darkred'>#if</font> <b>defined</b>(__ppc64__)
<a name='L924'>                        <b>case</b> <a href='../D/1185.html' title='Multiple defined in 3 places.'>FFI_TYPE_POINTER</a>:
<a name='L925'><font color='darkred'>#endif</font>
<a name='L926'>                        <b>case</b> <a href='../D/1188.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT64</a>:
<a name='L927'>                        <b>case</b> <a href='../D/1221.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT64</a>:
<a name='L928'>                                <i><font color='green'>/* Long long ints are passed in 1 or 2 GPRs.  */</font></i>
<a name='L929'>                                avalue[i] = pgr;
<a name='L930'>                                ng += <a href='../D/2156.html' title='Multiple defined in 4 places.'>MODE_CHOICE</a>(2,1);
<a name='L931'>                                pgr += <a href='../D/2156.html' title='Multiple defined in 4 places.'>MODE_CHOICE</a>(2,1);
<a name='L932'>
<a name='L933'>                                <b>break</b>;
<a name='L934'>
<a name='L935'>                        <b>case</b> <a href='../D/1181.html' title='Multiple defined in 3 places.'>FFI_TYPE_FLOAT</a>:
<a name='L936'>                                <i><font color='green'>/*      A float value consumes a GPR.</font></i>
<a name='L937'><i><font color='green'>                                        There are 13 64-bit floating point registers.  */</font></i>
<a name='L938'>                                <b>if</b> (nf &lt; <a href='../D/2354.html' title='Multiple defined in 2 places.'>NUM_FPR_ARG_REGISTERS</a>)
<a name='L939'>                                <font color='red'>{</font>
<a name='L940'>                                        temp = pfr-&gt;d;
<a name='L941'>                                        pfr-&gt;f = (<b>float</b>)temp;
<a name='L942'>                                        avalue[i] = pfr;
<a name='L943'>                                        pfr++;
<a name='L944'>                                <font color='red'>}</font>
<a name='L945'>                                <b>else</b>
<a name='L946'>                                        avalue[i] = pgr;
<a name='L947'>
<a name='L948'>                                nf++;
<a name='L949'>                                ng++;
<a name='L950'>                                pgr++;
<a name='L951'>                                <b>break</b>;
<a name='L952'>
<a name='L953'>                        <b>case</b> <a href='../D/1180.html' title='Multiple defined in 3 places.'>FFI_TYPE_DOUBLE</a>:
<a name='L954'>                                <i><font color='green'>/*      A double value consumes one or two GPRs.</font></i>
<a name='L955'><i><font color='green'>                                        There are 13 64bit floating point registers.  */</font></i>
<a name='L956'>                                <b>if</b> (nf &lt; <a href='../D/2354.html' title='Multiple defined in 2 places.'>NUM_FPR_ARG_REGISTERS</a>)
<a name='L957'>                                <font color='red'>{</font>
<a name='L958'>                                        avalue[i] = pfr;
<a name='L959'>                                        pfr++;
<a name='L960'>                                <font color='red'>}</font>
<a name='L961'>                                <b>else</b>
<a name='L962'>                                        avalue[i] = pgr;
<a name='L963'>
<a name='L964'>                                nf++;
<a name='L965'>                                ng += <a href='../D/2156.html' title='Multiple defined in 4 places.'>MODE_CHOICE</a>(2,1);
<a name='L966'>                                pgr += <a href='../D/2156.html' title='Multiple defined in 4 places.'>MODE_CHOICE</a>(2,1);
<a name='L967'>
<a name='L968'>                                <b>break</b>;
<a name='L969'>
<a name='L970'><font color='darkred'>#if</font> <a href='../D/1184.html' title='Multiple defined in 8 places.'>FFI_TYPE_LONGDOUBLE</a> != <a href='../D/1180.html' title='Multiple defined in 3 places.'>FFI_TYPE_DOUBLE</a>
<a name='L971'>
<a name='L972'>                        <b>case</b> <a href='../D/1184.html' title='Multiple defined in 8 places.'>FFI_TYPE_LONGDOUBLE</a>:
<a name='L973'><font color='darkred'>#if</font> <b>defined</b>(__ppc64__)
<a name='L974'>                                <b>if</b> (nf &lt; <a href='../D/2354.html' title='Multiple defined in 2 places.'>NUM_FPR_ARG_REGISTERS</a>)
<a name='L975'>                                <font color='red'>{</font>
<a name='L976'>                                        avalue[i] = pfr;
<a name='L977'>                                        pfr += 2;
<a name='L978'>                                <font color='red'>}</font>
<a name='L979'><font color='darkred'>#elif</font> <b>defined</b>(__ppc__)
<a name='L980'>                                <i><font color='green'>/*      A long double value consumes 2/4 GPRs and 2 FPRs.</font></i>
<a name='L981'><i><font color='green'>                                        There are 13 64bit floating point registers.  */</font></i>
<a name='L982'>                                <b>if</b> (nf &lt; <a href='../D/2354.html' title='Multiple defined in 2 places.'>NUM_FPR_ARG_REGISTERS</a> - 1)
<a name='L983'>                                <font color='red'>{</font>
<a name='L984'>                                        avalue[i] = pfr;
<a name='L985'>                                        pfr += 2;
<a name='L986'>                                <font color='red'>}</font>
<a name='L987'>                                <i><font color='green'>/*      Here we have the situation where one part of the long double</font></i>
<a name='L988'><i><font color='green'>                                        is stored in fpr13 and the other part is already on the stack.</font></i>
<a name='L989'><i><font color='green'>                                        We use a union to pass the long double to avalue[i].  */</font></i>
<a name='L990'>                                <b>else</b> <b>if</b> (nf == <a href='../D/2354.html' title='Multiple defined in 2 places.'>NUM_FPR_ARG_REGISTERS</a> - 1)
<a name='L991'>                                <font color='red'>{</font>
<a name='L992'>                                        <a href='../D/9803.html' title='Multiple defined in 4 places.'>memcpy</a> (&amp;temp_ld.lb[0], pfr, <b>sizeof</b>(temp_ld.lb[0]));
<a name='L993'>                                        <a href='../D/9803.html' title='Multiple defined in 4 places.'>memcpy</a> (&amp;temp_ld.lb[1], pgr + 2, <b>sizeof</b>(temp_ld.lb[1]));
<a name='L994'>                                        avalue[i] = &amp;temp_ld.ld;
<a name='L995'>                                <font color='red'>}</font>
<a name='L996'><font color='darkred'>#else</font>
<a name='L997'><font color='darkred'>#error</font> undefined architecture
<a name='L998'><font color='darkred'>#endif</font>
<a name='L999'>                                <b>else</b>
<a name='L1000'>                                        avalue[i] = pgr;
<a name='L1001'>
<a name='L1002'>                                nf += 2;
<a name='L1003'>                                ng += <a href='../D/2156.html' title='Multiple defined in 4 places.'>MODE_CHOICE</a>(4,2);
<a name='L1004'>                                pgr += <a href='../D/2156.html' title='Multiple defined in 4 places.'>MODE_CHOICE</a>(4,2);
<a name='L1005'>
<a name='L1006'>                                <b>break</b>;
<a name='L1007'>
<a name='L1008'><font color='darkred'>#endif</font>  <i><font color='green'>/*      FFI_TYPE_LONGDOUBLE != FFI_TYPE_DOUBLE  */</font></i>
<a name='L1009'>
<a name='L1010'>                        <b>default</b>:
<a name='L1011'>                                <a href='../D/1120.html' title='Multiple defined in 8 places.'>FFI_ASSERT</a>(0);
<a name='L1012'>                                <b>break</b>;
<a name='L1013'>                <font color='red'>}</font>
<a name='L1014'>        <font color='red'>}</font>
<a name='L1015'>
<a name='L1016'>        (closure-&gt;fun)(cif, rvalue, avalue, closure-&gt;user_data);
<a name='L1017'>
<a name='L1018'>        <i><font color='green'>/* Tell ffi_closure_ASM to perform return type promotions.  */</font></i>
<a name='L1019'>        <b>return</b> cif-&gt;rtype-&gt;type;
<a name='L1020'><font color='red'>}</font>
<a name='L1021'>
<a name='L1022'><font color='darkred'>#if</font> <b>defined</b>(__ppc64__)
<a name='L1023'>
<a name='L1024'><i><font color='green'>/*      ffi64_struct_to_ram_form</font></i>
<a name='L1025'><i><font color='green'></font></i>
<a name='L1026'><i><font color='green'>        Rebuild a struct's natural layout from buffers of concatenated registers.</font></i>
<a name='L1027'><i><font color='green'>        Return the number of registers used.</font></i>
<a name='L1028'><i><font color='green'>        inGPRs[0-7] == r3, inFPRs[0-7] == f1 ...</font></i>
<a name='L1029'><i><font color='green'>*/</font></i>
<a name='L1030'><b>void</b>
<a name='L1031'><a href='../R/7678.html' title='Multiple refered from 3 places.'>ffi64_struct_to_ram_form</a>(
<a name='L1032'>        <b>const</b> ffi_type* inType,
<a name='L1033'>        <b>const</b> <b>char</b>*             inGPRs,
<a name='L1034'>        <b>unsigned</b> <b>int</b>*   ioGPRMarker,
<a name='L1035'>        <b>const</b> <b>char</b>*             inFPRs,
<a name='L1036'>        <b>unsigned</b> <b>int</b>*   ioFPRMarker,
<a name='L1037'>        <b>unsigned</b> <b>int</b>*   ioFPRsUsed,
<a name='L1038'>        <b>char</b>*                   outStruct,      <i><font color='green'>// caller-allocated</font></i>
<a name='L1039'>        <b>unsigned</b> <b>int</b>*   ioStructMarker)
<a name='L1040'><font color='red'>{</font>
<a name='L1041'>        <b>unsigned</b> <b>int</b>    srcGMarker              = 0;
<a name='L1042'>        <b>unsigned</b> <b>int</b>    srcFMarker              = 0;
<a name='L1043'>        <b>unsigned</b> <b>int</b>    savedFMarker    = 0;
<a name='L1044'>        <b>unsigned</b> <b>int</b>    fprsUsed                = 0;
<a name='L1045'>        <b>unsigned</b> <b>int</b>    savedFPRsUsed   = 0;
<a name='L1046'>        <b>unsigned</b> <b>int</b>    destMarker              = 0;
<a name='L1047'>
<a name='L1048'>        <b>static</b> <b>unsigned</b> <b>int</b>     recurseCount    = 0;
<a name='L1049'>
<a name='L1050'>        <b>if</b> (ioGPRMarker)
<a name='L1051'>                srcGMarker      = *ioGPRMarker;
<a name='L1052'>
<a name='L1053'>        <b>if</b> (ioFPRMarker)
<a name='L1054'>        <font color='red'>{</font>
<a name='L1055'>                srcFMarker              = *ioFPRMarker;
<a name='L1056'>                savedFMarker    = srcFMarker;
<a name='L1057'>        <font color='red'>}</font>
<a name='L1058'>
<a name='L1059'>        <b>if</b> (ioFPRsUsed)
<a name='L1060'>        <font color='red'>{</font>
<a name='L1061'>                fprsUsed                = *ioFPRsUsed;
<a name='L1062'>                savedFPRsUsed   = fprsUsed;
<a name='L1063'>        <font color='red'>}</font>
<a name='L1064'>
<a name='L1065'>        <b>if</b> (ioStructMarker)
<a name='L1066'>                destMarker      = *ioStructMarker;
<a name='L1067'>
<a name='L1068'>        <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>                  i;
<a name='L1069'>
<a name='L1070'>        <b>switch</b> (inType-&gt;size)
<a name='L1071'>        <font color='red'>{</font>
<a name='L1072'>                <b>case</b> 1: <b>case</b> 2: <b>case</b> 4:
<a name='L1073'>                        srcGMarker += 8 - inType-&gt;size;
<a name='L1074'>                        <b>break</b>;
<a name='L1075'>
<a name='L1076'>                <b>default</b>:
<a name='L1077'>                        <b>break</b>;
<a name='L1078'>        <font color='red'>}</font>
<a name='L1079'>
<a name='L1080'>        <b>for</b> (i = 0; inType-&gt;elements[i] != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>; i++)
<a name='L1081'>        <font color='red'>{</font>
<a name='L1082'>                <b>switch</b> (inType-&gt;elements[i]-&gt;type)
<a name='L1083'>                <font color='red'>{</font>
<a name='L1084'>                        <b>case</b> <a href='../D/1181.html' title='Multiple defined in 3 places.'>FFI_TYPE_FLOAT</a>:
<a name='L1085'>                                srcFMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(srcFMarker, 4);
<a name='L1086'>                                srcGMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(srcGMarker, 4);
<a name='L1087'>                                destMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(destMarker, 4);
<a name='L1088'>
<a name='L1089'>                                <b>if</b> (fprsUsed &lt; <a href='../D/2354.html' title='Multiple defined in 2 places.'>NUM_FPR_ARG_REGISTERS</a>)
<a name='L1090'>                                <font color='red'>{</font>
<a name='L1091'>                                        *(<b>float</b>*)&amp;outStruct[destMarker] =
<a name='L1092'>                                                (<b>float</b>)*(<b>double</b>*)&amp;inFPRs[srcFMarker];
<a name='L1093'>                                        srcFMarker += 8;
<a name='L1094'>                                        fprsUsed++;
<a name='L1095'>                                <font color='red'>}</font>
<a name='L1096'>                                <b>else</b>
<a name='L1097'>                                        *(<b>float</b>*)&amp;outStruct[destMarker] =
<a name='L1098'>                                                (<b>float</b>)*(<b>double</b>*)&amp;inGPRs[srcGMarker];
<a name='L1099'>
<a name='L1100'>                                srcGMarker += 4;
<a name='L1101'>                                destMarker += 4;
<a name='L1102'>
<a name='L1103'>                                <i><font color='green'>// Skip to next GPR if next element won't fit and we're</font></i>
<a name='L1104'>                                <i><font color='green'>// not already at a register boundary.</font></i>
<a name='L1105'>                                <b>if</b> (inType-&gt;elements[i + 1] != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; (destMarker % 8))
<a name='L1106'>                                <font color='red'>{</font>
<a name='L1107'>                                        <b>if</b> (!<a href='../S/2544.html#L53' title='Defined at 53 in Modules/_ctypes/libffi_osx/powerpc/ppc-darwin.h.'>FFI_TYPE_1_BYTE</a>(inType-&gt;elements[i + 1]-&gt;type) &amp;&amp;
<a name='L1108'>                                                (!<a href='../S/2544.html#L54' title='Defined at 54 in Modules/_ctypes/libffi_osx/powerpc/ppc-darwin.h.'>FFI_TYPE_2_BYTE</a>(inType-&gt;elements[i + 1]-&gt;type) ||
<a name='L1109'>                                                (<a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(srcGMarker, 8) - srcGMarker) &lt; 2) &amp;&amp;
<a name='L1110'>                                                (!<a href='../S/2544.html#L55' title='Defined at 55 in Modules/_ctypes/libffi_osx/powerpc/ppc-darwin.h.'>FFI_TYPE_4_BYTE</a>(inType-&gt;elements[i + 1]-&gt;type) ||
<a name='L1111'>                                                (<a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(srcGMarker, 8) - srcGMarker) &lt; 4))
<a name='L1112'>                                                srcGMarker      = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(srcGMarker, 8);
<a name='L1113'>                                <font color='red'>}</font>
<a name='L1114'>
<a name='L1115'>                                <b>break</b>;
<a name='L1116'>
<a name='L1117'>                        <b>case</b> <a href='../D/1180.html' title='Multiple defined in 3 places.'>FFI_TYPE_DOUBLE</a>:
<a name='L1118'>                                srcFMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(srcFMarker, 8);
<a name='L1119'>                                destMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(destMarker, 8);
<a name='L1120'>
<a name='L1121'>                                <b>if</b> (fprsUsed &lt; <a href='../D/2354.html' title='Multiple defined in 2 places.'>NUM_FPR_ARG_REGISTERS</a>)
<a name='L1122'>                                <font color='red'>{</font>
<a name='L1123'>                                        *(<b>double</b>*)&amp;outStruct[destMarker]        =
<a name='L1124'>                                                *(<b>double</b>*)&amp;inFPRs[srcFMarker];
<a name='L1125'>                                        srcFMarker += 8;
<a name='L1126'>                                        fprsUsed++;
<a name='L1127'>                                <font color='red'>}</font>
<a name='L1128'>                                <b>else</b>
<a name='L1129'>                                        *(<b>double</b>*)&amp;outStruct[destMarker]        =
<a name='L1130'>                                                *(<b>double</b>*)&amp;inGPRs[srcGMarker];
<a name='L1131'>
<a name='L1132'>                                destMarker += 8;
<a name='L1133'>
<a name='L1134'>                                <i><font color='green'>// Skip next GPR</font></i>
<a name='L1135'>                                srcGMarker += 8;
<a name='L1136'>                                srcGMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(srcGMarker, 8);
<a name='L1137'>
<a name='L1138'>                                <b>break</b>;
<a name='L1139'>
<a name='L1140'>                        <b>case</b> <a href='../D/1184.html' title='Multiple defined in 8 places.'>FFI_TYPE_LONGDOUBLE</a>:
<a name='L1141'>                                destMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(destMarker, 16);
<a name='L1142'>
<a name='L1143'>                                <b>if</b> (fprsUsed &lt; <a href='../D/2354.html' title='Multiple defined in 2 places.'>NUM_FPR_ARG_REGISTERS</a>)
<a name='L1144'>                                <font color='red'>{</font>
<a name='L1145'>                                        srcFMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(srcFMarker, 8);
<a name='L1146'>                                        srcGMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(srcGMarker, 8);
<a name='L1147'>                                        *(<b>long</b> <b>double</b>*)&amp;outStruct[destMarker]   =
<a name='L1148'>                                                *(<b>long</b> <b>double</b>*)&amp;inFPRs[srcFMarker];
<a name='L1149'>                                        srcFMarker += 16;
<a name='L1150'>                                        fprsUsed += 2;
<a name='L1151'>                                <font color='red'>}</font>
<a name='L1152'>                                <b>else</b>
<a name='L1153'>                                <font color='red'>{</font>
<a name='L1154'>                                        srcFMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(srcFMarker, 16);
<a name='L1155'>                                        srcGMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(srcGMarker, 16);
<a name='L1156'>                                        *(<b>long</b> <b>double</b>*)&amp;outStruct[destMarker]   =
<a name='L1157'>                                                *(<b>long</b> <b>double</b>*)&amp;inGPRs[srcGMarker];
<a name='L1158'>                                <font color='red'>}</font>
<a name='L1159'>
<a name='L1160'>                                destMarker += 16;
<a name='L1161'>
<a name='L1162'>                                <i><font color='green'>// Skip next 2 GPRs</font></i>
<a name='L1163'>                                srcGMarker += 16;
<a name='L1164'>                                srcGMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(srcGMarker, 8);
<a name='L1165'>
<a name='L1166'>                                <b>break</b>;
<a name='L1167'>
<a name='L1168'>                        <b>case</b> <a href='../D/1222.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT8</a>:
<a name='L1169'>                        <b>case</b> <a href='../D/1189.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT8</a>:
<a name='L1170'>                        <font color='red'>{</font>
<a name='L1171'>                                <b>if</b> (inType-&gt;alignment == 1)     <i><font color='green'>// chars only</font></i>
<a name='L1172'>                                <font color='red'>{</font>
<a name='L1173'>                                        <b>if</b> (inType-&gt;size == 1)
<a name='L1174'>                                                outStruct[destMarker++] = inGPRs[srcGMarker++];
<a name='L1175'>                                        <b>else</b> <b>if</b> (inType-&gt;size == 2)
<a name='L1176'>                                        <font color='red'>{</font>
<a name='L1177'>                                                outStruct[destMarker++] = inGPRs[srcGMarker++];
<a name='L1178'>                                                outStruct[destMarker++] = inGPRs[srcGMarker++];
<a name='L1179'>                                                i++;
<a name='L1180'>                                        <font color='red'>}</font>
<a name='L1181'>                                        <b>else</b>
<a name='L1182'>                                        <font color='red'>{</font>
<a name='L1183'>                                                <a href='../D/9803.html' title='Multiple defined in 4 places.'>memcpy</a>(&amp;outStruct[destMarker],
<a name='L1184'>                                                        &amp;inGPRs[srcGMarker], inType-&gt;size);
<a name='L1185'>                                                srcGMarker += inType-&gt;size;
<a name='L1186'>                                                destMarker += inType-&gt;size;
<a name='L1187'>                                                i += inType-&gt;size - 1;
<a name='L1188'>                                        <font color='red'>}</font>
<a name='L1189'>                                <font color='red'>}</font>
<a name='L1190'>                                <b>else</b>    <i><font color='green'>// chars and other stuff</font></i>
<a name='L1191'>                                <font color='red'>{</font>
<a name='L1192'>                                        outStruct[destMarker++] = inGPRs[srcGMarker++];
<a name='L1193'>
<a name='L1194'>                                        <i><font color='green'>// Skip to next GPR if next element won't fit and we're</font></i>
<a name='L1195'>                                        <i><font color='green'>// not already at a register boundary.</font></i>
<a name='L1196'>                                        <b>if</b> (inType-&gt;elements[i + 1] != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; (srcGMarker % 8))
<a name='L1197'>                                        <font color='red'>{</font>
<a name='L1198'>                                                <b>if</b> (!<a href='../S/2544.html#L53' title='Defined at 53 in Modules/_ctypes/libffi_osx/powerpc/ppc-darwin.h.'>FFI_TYPE_1_BYTE</a>(inType-&gt;elements[i + 1]-&gt;type) &amp;&amp;
<a name='L1199'>                                                        (!<a href='../S/2544.html#L54' title='Defined at 54 in Modules/_ctypes/libffi_osx/powerpc/ppc-darwin.h.'>FFI_TYPE_2_BYTE</a>(inType-&gt;elements[i + 1]-&gt;type) ||
<a name='L1200'>                                                        (<a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(srcGMarker, 8) - srcGMarker) &lt; 2) &amp;&amp;
<a name='L1201'>                                                        (!<a href='../S/2544.html#L55' title='Defined at 55 in Modules/_ctypes/libffi_osx/powerpc/ppc-darwin.h.'>FFI_TYPE_4_BYTE</a>(inType-&gt;elements[i + 1]-&gt;type) ||
<a name='L1202'>                                                        (<a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(srcGMarker, 8) - srcGMarker) &lt; 4))
<a name='L1203'>                                                        srcGMarker      = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(srcGMarker, inType-&gt;alignment); <i><font color='green'>// was 8</font></i>
<a name='L1204'>                                        <font color='red'>}</font>
<a name='L1205'>                                <font color='red'>}</font>
<a name='L1206'>
<a name='L1207'>                                <b>break</b>;
<a name='L1208'>                        <font color='red'>}</font>
<a name='L1209'>
<a name='L1210'>                        <b>case</b> <a href='../D/1219.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT16</a>:
<a name='L1211'>                        <b>case</b> <a href='../D/1186.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT16</a>:
<a name='L1212'>                                srcGMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(srcGMarker, 2);
<a name='L1213'>                                destMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(destMarker, 2);
<a name='L1214'>
<a name='L1215'>                                *(<b>short</b>*)&amp;outStruct[destMarker] =
<a name='L1216'>                                        *(<b>short</b>*)&amp;inGPRs[srcGMarker];
<a name='L1217'>                                srcGMarker += 2;
<a name='L1218'>                                destMarker += 2;
<a name='L1219'>
<a name='L1220'>                                <b>break</b>;
<a name='L1221'>
<a name='L1222'>                        <b>case</b> <a href='../D/1182.html' title='Multiple defined in 3 places.'>FFI_TYPE_INT</a>:
<a name='L1223'>                        <b>case</b> <a href='../D/1220.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT32</a>:
<a name='L1224'>                        <b>case</b> <a href='../D/1187.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT32</a>:
<a name='L1225'>                                srcGMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(srcGMarker, 4);
<a name='L1226'>                                destMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(destMarker, 4);
<a name='L1227'>
<a name='L1228'>                                *(<b>int</b>*)&amp;outStruct[destMarker] =
<a name='L1229'>                                        *(<b>int</b>*)&amp;inGPRs[srcGMarker];
<a name='L1230'>                                srcGMarker += 4;
<a name='L1231'>                                destMarker += 4;
<a name='L1232'>
<a name='L1233'>                                <b>break</b>;
<a name='L1234'>
<a name='L1235'>                        <b>case</b> <a href='../D/1185.html' title='Multiple defined in 3 places.'>FFI_TYPE_POINTER</a>:
<a name='L1236'>                        <b>case</b> <a href='../D/1221.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT64</a>:
<a name='L1237'>                        <b>case</b> <a href='../D/1188.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT64</a>:
<a name='L1238'>                                srcGMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(srcGMarker, 8);
<a name='L1239'>                                destMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(destMarker, 8);
<a name='L1240'>
<a name='L1241'>                                *(<b>long</b> <b>long</b>*)&amp;outStruct[destMarker] =
<a name='L1242'>                                        *(<b>long</b> <b>long</b>*)&amp;inGPRs[srcGMarker];
<a name='L1243'>                                srcGMarker += 8;
<a name='L1244'>                                destMarker += 8;
<a name='L1245'>
<a name='L1246'>                                <b>break</b>;
<a name='L1247'>
<a name='L1248'>                        <b>case</b> <a href='../D/1202.html' title='Multiple defined in 3 places.'>FFI_TYPE_STRUCT</a>:
<a name='L1249'>                                recurseCount++;
<a name='L1250'>                                <a href='../S/2547.html#L1031' title='Defined at 1031 in Modules/_ctypes/libffi_osx/powerpc/ppc-ffi_darwin.c.'>ffi64_struct_to_ram_form</a>(inType-&gt;elements[i], inGPRs,
<a name='L1251'>                                        &amp;srcGMarker, inFPRs, &amp;srcFMarker, &amp;fprsUsed,
<a name='L1252'>                                        outStruct, &amp;destMarker);
<a name='L1253'>                                recurseCount--;
<a name='L1254'>                                <b>break</b>;
<a name='L1255'>
<a name='L1256'>                        <b>default</b>:
<a name='L1257'>                                <a href='../D/1120.html' title='Multiple defined in 8 places.'>FFI_ASSERT</a>(0);  <i><font color='green'>// unknown element type</font></i>
<a name='L1258'>                                <b>break</b>;
<a name='L1259'>                <font color='red'>}</font>
<a name='L1260'>        <font color='red'>}</font>
<a name='L1261'>
<a name='L1262'>        srcGMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(srcGMarker, inType-&gt;alignment);
<a name='L1263'>
<a name='L1264'>        <i><font color='green'>// Take care of the special case for 16-byte structs, but not for</font></i>
<a name='L1265'>        <i><font color='green'>// nested structs.</font></i>
<a name='L1266'>        <b>if</b> (recurseCount == 0 &amp;&amp; srcGMarker == 16)
<a name='L1267'>        <font color='red'>{</font>
<a name='L1268'>                *(<b>long</b> <b>double</b>*)&amp;outStruct[0] = *(<b>long</b> <b>double</b>*)&amp;inGPRs[0];
<a name='L1269'>                srcFMarker      = savedFMarker;
<a name='L1270'>                fprsUsed        = savedFPRsUsed;
<a name='L1271'>        <font color='red'>}</font>
<a name='L1272'>
<a name='L1273'>        <b>if</b> (ioGPRMarker)
<a name='L1274'>                *ioGPRMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(srcGMarker, 8);
<a name='L1275'>
<a name='L1276'>        <b>if</b> (ioFPRMarker)
<a name='L1277'>                *ioFPRMarker = srcFMarker;
<a name='L1278'>
<a name='L1279'>        <b>if</b> (ioFPRsUsed)
<a name='L1280'>                *ioFPRsUsed     = fprsUsed;
<a name='L1281'>
<a name='L1282'>        <b>if</b> (ioStructMarker)
<a name='L1283'>                *ioStructMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(destMarker, 8);
<a name='L1284'><font color='red'>}</font>
<a name='L1285'>
<a name='L1286'><i><font color='green'>/*      ffi64_struct_to_reg_form</font></i>
<a name='L1287'><i><font color='green'></font></i>
<a name='L1288'><i><font color='green'>        Copy a struct's elements into buffers that can be sliced into registers.</font></i>
<a name='L1289'><i><font color='green'>        Return the sizes of the output buffers in bytes. Pass NULL buffer pointers</font></i>
<a name='L1290'><i><font color='green'>        to calculate size only.</font></i>
<a name='L1291'><i><font color='green'>        outGPRs[0-7] == r3, outFPRs[0-7] == f1 ...</font></i>
<a name='L1292'><i><font color='green'>*/</font></i>
<a name='L1293'><b>void</b>
<a name='L1294'><a href='../R/7679.html' title='Multiple refered from 4 places.'>ffi64_struct_to_reg_form</a>(
<a name='L1295'>        <b>const</b> ffi_type* inType,
<a name='L1296'>        <b>const</b> <b>char</b>*             inStruct,
<a name='L1297'>        <b>unsigned</b> <b>int</b>*   ioStructMarker,
<a name='L1298'>        <b>unsigned</b> <b>int</b>*   ioFPRsUsed,
<a name='L1299'>        <b>char</b>*                   outGPRs,        <i><font color='green'>// caller-allocated</font></i>
<a name='L1300'>        <b>unsigned</b> <b>int</b>*   ioGPRSize,
<a name='L1301'>        <b>char</b>*                   outFPRs,        <i><font color='green'>// caller-allocated</font></i>
<a name='L1302'>        <b>unsigned</b> <b>int</b>*   ioFPRSize)
<a name='L1303'><font color='red'>{</font>
<a name='L1304'>        <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>                  i;
<a name='L1305'>        <b>unsigned</b> <b>int</b>    srcMarker               = 0;
<a name='L1306'>        <b>unsigned</b> <b>int</b>    destGMarker             = 0;
<a name='L1307'>        <b>unsigned</b> <b>int</b>    destFMarker             = 0;
<a name='L1308'>        <b>unsigned</b> <b>int</b>    savedFMarker    = 0;
<a name='L1309'>        <b>unsigned</b> <b>int</b>    fprsUsed                = 0;
<a name='L1310'>        <b>unsigned</b> <b>int</b>    savedFPRsUsed   = 0;
<a name='L1311'>
<a name='L1312'>        <b>static</b> <b>unsigned</b> <b>int</b>     recurseCount    = 0;
<a name='L1313'>
<a name='L1314'>        <b>if</b> (ioStructMarker)
<a name='L1315'>                srcMarker       = *ioStructMarker;
<a name='L1316'>
<a name='L1317'>        <b>if</b> (ioFPRsUsed)
<a name='L1318'>        <font color='red'>{</font>
<a name='L1319'>                fprsUsed                = *ioFPRsUsed;
<a name='L1320'>                savedFPRsUsed   = fprsUsed;
<a name='L1321'>        <font color='red'>}</font>
<a name='L1322'>
<a name='L1323'>        <b>if</b> (ioGPRSize)
<a name='L1324'>                destGMarker     = *ioGPRSize;
<a name='L1325'>
<a name='L1326'>        <b>if</b> (ioFPRSize)
<a name='L1327'>        <font color='red'>{</font>
<a name='L1328'>                destFMarker             = *ioFPRSize;
<a name='L1329'>                savedFMarker    = destFMarker;
<a name='L1330'>        <font color='red'>}</font>
<a name='L1331'>
<a name='L1332'>        <b>switch</b> (inType-&gt;size)
<a name='L1333'>        <font color='red'>{</font>
<a name='L1334'>                <b>case</b> 1: <b>case</b> 2: <b>case</b> 4:
<a name='L1335'>                        destGMarker += 8 - inType-&gt;size;
<a name='L1336'>                        <b>break</b>;
<a name='L1337'>
<a name='L1338'>                <b>default</b>:
<a name='L1339'>                        <b>break</b>;
<a name='L1340'>        <font color='red'>}</font>
<a name='L1341'>
<a name='L1342'>        <b>for</b> (i = 0; inType-&gt;elements[i] != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>; i++)
<a name='L1343'>        <font color='red'>{</font>
<a name='L1344'>                <b>switch</b> (inType-&gt;elements[i]-&gt;type)
<a name='L1345'>                <font color='red'>{</font>
<a name='L1346'>                        <i><font color='green'>// Shadow floating-point types in GPRs for vararg and pre-ANSI</font></i>
<a name='L1347'>                        <i><font color='green'>// functions.</font></i>
<a name='L1348'>                        <b>case</b> <a href='../D/1181.html' title='Multiple defined in 3 places.'>FFI_TYPE_FLOAT</a>:
<a name='L1349'>                                <i><font color='green'>// Nudge markers to next 4/8-byte boundary</font></i>
<a name='L1350'>                                srcMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(srcMarker, 4);
<a name='L1351'>                                destGMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(destGMarker, 4);
<a name='L1352'>                                destFMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(destFMarker, 8);
<a name='L1353'>
<a name='L1354'>                                <b>if</b> (fprsUsed &lt; <a href='../D/2354.html' title='Multiple defined in 2 places.'>NUM_FPR_ARG_REGISTERS</a>)
<a name='L1355'>                                <font color='red'>{</font>
<a name='L1356'>                                        <b>if</b> (outFPRs != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; inStruct != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1357'>                                                *(<b>double</b>*)&amp;outFPRs[destFMarker] =
<a name='L1358'>                                                        (<b>double</b>)*(<b>float</b>*)&amp;inStruct[srcMarker];
<a name='L1359'>
<a name='L1360'>                                        destFMarker += 8;
<a name='L1361'>                                        fprsUsed++;
<a name='L1362'>                                <font color='red'>}</font>
<a name='L1363'>
<a name='L1364'>                                <b>if</b> (outGPRs != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; inStruct != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1365'>                                        *(<b>double</b>*)&amp;outGPRs[destGMarker] =
<a name='L1366'>                                                (<b>double</b>)*(<b>float</b>*)&amp;inStruct[srcMarker];
<a name='L1367'>
<a name='L1368'>                                srcMarker += 4;
<a name='L1369'>                                destGMarker += 4;
<a name='L1370'>
<a name='L1371'>                                <i><font color='green'>// Skip to next GPR if next element won't fit and we're</font></i>
<a name='L1372'>                                <i><font color='green'>// not already at a register boundary.</font></i>
<a name='L1373'>                                <b>if</b> (inType-&gt;elements[i + 1] != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; (srcMarker % 8))
<a name='L1374'>                                <font color='red'>{</font>
<a name='L1375'>                                        <b>if</b> (!<a href='../S/2544.html#L53' title='Defined at 53 in Modules/_ctypes/libffi_osx/powerpc/ppc-darwin.h.'>FFI_TYPE_1_BYTE</a>(inType-&gt;elements[i + 1]-&gt;type) &amp;&amp;
<a name='L1376'>                                                (!<a href='../S/2544.html#L54' title='Defined at 54 in Modules/_ctypes/libffi_osx/powerpc/ppc-darwin.h.'>FFI_TYPE_2_BYTE</a>(inType-&gt;elements[i + 1]-&gt;type) ||
<a name='L1377'>                                                (<a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(destGMarker, 8) - destGMarker) &lt; 2) &amp;&amp;
<a name='L1378'>                                                (!<a href='../S/2544.html#L55' title='Defined at 55 in Modules/_ctypes/libffi_osx/powerpc/ppc-darwin.h.'>FFI_TYPE_4_BYTE</a>(inType-&gt;elements[i + 1]-&gt;type) ||
<a name='L1379'>                                                (<a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(destGMarker, 8) - destGMarker) &lt; 4))
<a name='L1380'>                                                destGMarker     = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(destGMarker, 8);
<a name='L1381'>                                <font color='red'>}</font>
<a name='L1382'>
<a name='L1383'>                                <b>break</b>;
<a name='L1384'>
<a name='L1385'>                        <b>case</b> <a href='../D/1180.html' title='Multiple defined in 3 places.'>FFI_TYPE_DOUBLE</a>:
<a name='L1386'>                                srcMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(srcMarker, 8);
<a name='L1387'>                                destFMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(destFMarker, 8);
<a name='L1388'>
<a name='L1389'>                                <b>if</b> (fprsUsed &lt; <a href='../D/2354.html' title='Multiple defined in 2 places.'>NUM_FPR_ARG_REGISTERS</a>)
<a name='L1390'>                                <font color='red'>{</font>
<a name='L1391'>                                        <b>if</b> (outFPRs != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; inStruct != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1392'>                                                *(<b>double</b>*)&amp;outFPRs[destFMarker] =
<a name='L1393'>                                                        *(<b>double</b>*)&amp;inStruct[srcMarker];
<a name='L1394'>
<a name='L1395'>                                        destFMarker += 8;
<a name='L1396'>                                        fprsUsed++;
<a name='L1397'>                                <font color='red'>}</font>
<a name='L1398'>
<a name='L1399'>                                <b>if</b> (outGPRs != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; inStruct != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1400'>                                        *(<b>double</b>*)&amp;outGPRs[destGMarker] =
<a name='L1401'>                                                *(<b>double</b>*)&amp;inStruct[srcMarker];
<a name='L1402'>
<a name='L1403'>                                srcMarker += 8;
<a name='L1404'>
<a name='L1405'>                                <i><font color='green'>// Skip next GPR</font></i>
<a name='L1406'>                                destGMarker += 8;
<a name='L1407'>                                destGMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(destGMarker, 8);
<a name='L1408'>
<a name='L1409'>                                <b>break</b>;
<a name='L1410'>
<a name='L1411'>                        <b>case</b> <a href='../D/1184.html' title='Multiple defined in 8 places.'>FFI_TYPE_LONGDOUBLE</a>:
<a name='L1412'>                                srcMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(srcMarker, 16);
<a name='L1413'>
<a name='L1414'>                                <b>if</b> (fprsUsed &lt; <a href='../D/2354.html' title='Multiple defined in 2 places.'>NUM_FPR_ARG_REGISTERS</a>)
<a name='L1415'>                                <font color='red'>{</font>
<a name='L1416'>                                        destFMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(destFMarker, 8);
<a name='L1417'>                                        destGMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(destGMarker, 8);
<a name='L1418'>
<a name='L1419'>                                        <b>if</b> (outFPRs != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; inStruct != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1420'>                                                *(<b>long</b> <b>double</b>*)&amp;outFPRs[destFMarker] =
<a name='L1421'>                                                        *(<b>long</b> <b>double</b>*)&amp;inStruct[srcMarker];
<a name='L1422'>
<a name='L1423'>                                        <b>if</b> (outGPRs != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; inStruct != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1424'>                                                *(<b>long</b> <b>double</b>*)&amp;outGPRs[destGMarker] =
<a name='L1425'>                                                        *(<b>long</b> <b>double</b>*)&amp;inStruct[srcMarker];
<a name='L1426'>
<a name='L1427'>                                        destFMarker += 16;
<a name='L1428'>                                        fprsUsed += 2;
<a name='L1429'>                                <font color='red'>}</font>
<a name='L1430'>                                <b>else</b>
<a name='L1431'>                                <font color='red'>{</font>
<a name='L1432'>                                        destGMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(destGMarker, 16);
<a name='L1433'>
<a name='L1434'>                                         <b>if</b> (outGPRs != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; inStruct != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1435'>                                                *(<b>long</b> <b>double</b>*)&amp;outGPRs[destGMarker] =
<a name='L1436'>                                                        *(<b>long</b> <b>double</b>*)&amp;inStruct[srcMarker];
<a name='L1437'>                                <font color='red'>}</font>
<a name='L1438'>
<a name='L1439'>                                srcMarker += 16;
<a name='L1440'>                                destGMarker += 16;      <i><font color='green'>// Skip next 2 GPRs</font></i>
<a name='L1441'>                                destGMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(destGMarker, 8);    <i><font color='green'>// was 16</font></i>
<a name='L1442'>
<a name='L1443'>                                <b>break</b>;
<a name='L1444'>
<a name='L1445'>                        <b>case</b> <a href='../D/1222.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT8</a>:
<a name='L1446'>                        <b>case</b> <a href='../D/1189.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT8</a>:
<a name='L1447'>                                <b>if</b> (inType-&gt;alignment == 1)     <i><font color='green'>// bytes only</font></i>
<a name='L1448'>                                <font color='red'>{</font>
<a name='L1449'>                                        <b>if</b> (inType-&gt;size == 1)
<a name='L1450'>                                        <font color='red'>{</font>
<a name='L1451'>                                                <b>if</b> (outGPRs != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; inStruct != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1452'>                                                        outGPRs[destGMarker] = inStruct[srcMarker];
<a name='L1453'>
<a name='L1454'>                                                srcMarker++;
<a name='L1455'>                                                destGMarker++;
<a name='L1456'>                                        <font color='red'>}</font>
<a name='L1457'>                                        <b>else</b> <b>if</b> (inType-&gt;size == 2)
<a name='L1458'>                                        <font color='red'>{</font>
<a name='L1459'>                                                <b>if</b> (outGPRs != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; inStruct != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1460'>                                                <font color='red'>{</font>
<a name='L1461'>                                                        outGPRs[destGMarker] = inStruct[srcMarker];
<a name='L1462'>                                                        outGPRs[destGMarker + 1] = inStruct[srcMarker + 1];
<a name='L1463'>                                                <font color='red'>}</font>
<a name='L1464'>
<a name='L1465'>                                                srcMarker += 2;
<a name='L1466'>                                                destGMarker += 2;
<a name='L1467'>
<a name='L1468'>                                                i++;
<a name='L1469'>                                        <font color='red'>}</font>
<a name='L1470'>                                        <b>else</b>
<a name='L1471'>                                        <font color='red'>{</font>
<a name='L1472'>                                                <b>if</b> (outGPRs != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; inStruct != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1473'>                                                <font color='red'>{</font>
<a name='L1474'>                                                        <i><font color='green'>// Avoid memcpy for small chunks.</font></i>
<a name='L1475'>                                                        <b>if</b> (inType-&gt;size &lt;= <b>sizeof</b>(<b>long</b>))
<a name='L1476'>                                                                *(<b>long</b>*)&amp;outGPRs[destGMarker] =
<a name='L1477'>                                                                        *(<b>long</b>*)&amp;inStruct[srcMarker];
<a name='L1478'>                                                        <b>else</b>
<a name='L1479'>                                                                <a href='../D/9803.html' title='Multiple defined in 4 places.'>memcpy</a>(&amp;outGPRs[destGMarker],
<a name='L1480'>                                                                        &amp;inStruct[srcMarker], inType-&gt;size);
<a name='L1481'>                                                <font color='red'>}</font>
<a name='L1482'>                                                
<a name='L1483'>                                                srcMarker += inType-&gt;size;
<a name='L1484'>                                                destGMarker += inType-&gt;size;
<a name='L1485'>                                                i += inType-&gt;size - 1;
<a name='L1486'>                                        <font color='red'>}</font>
<a name='L1487'>                                <font color='red'>}</font>
<a name='L1488'>                                <b>else</b>    <i><font color='green'>// bytes and other stuff</font></i>
<a name='L1489'>                                <font color='red'>{</font>
<a name='L1490'>                                        <b>if</b> (outGPRs != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; inStruct != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1491'>                                                outGPRs[destGMarker] = inStruct[srcMarker];
<a name='L1492'>
<a name='L1493'>                                        srcMarker++;
<a name='L1494'>                                        destGMarker++;
<a name='L1495'>
<a name='L1496'>                                        <i><font color='green'>// Skip to next GPR if next element won't fit and we're</font></i>
<a name='L1497'>                                        <i><font color='green'>// not already at a register boundary.</font></i>
<a name='L1498'>                                        <b>if</b> (inType-&gt;elements[i + 1] != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; (destGMarker % 8))
<a name='L1499'>                                        <font color='red'>{</font>
<a name='L1500'>                                                <b>if</b> (!<a href='../S/2544.html#L53' title='Defined at 53 in Modules/_ctypes/libffi_osx/powerpc/ppc-darwin.h.'>FFI_TYPE_1_BYTE</a>(inType-&gt;elements[i + 1]-&gt;type) &amp;&amp;
<a name='L1501'>                                                        (!<a href='../S/2544.html#L54' title='Defined at 54 in Modules/_ctypes/libffi_osx/powerpc/ppc-darwin.h.'>FFI_TYPE_2_BYTE</a>(inType-&gt;elements[i + 1]-&gt;type) ||
<a name='L1502'>                                                        (<a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(destGMarker, 8) - destGMarker) &lt; 2) &amp;&amp;
<a name='L1503'>                                                        (!<a href='../S/2544.html#L55' title='Defined at 55 in Modules/_ctypes/libffi_osx/powerpc/ppc-darwin.h.'>FFI_TYPE_4_BYTE</a>(inType-&gt;elements[i + 1]-&gt;type) ||
<a name='L1504'>                                                        (<a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(destGMarker, 8) - destGMarker) &lt; 4))
<a name='L1505'>                                                        destGMarker     = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(destGMarker, inType-&gt;alignment);        <i><font color='green'>// was 8</font></i>
<a name='L1506'>                                        <font color='red'>}</font>
<a name='L1507'>                                <font color='red'>}</font>
<a name='L1508'>
<a name='L1509'>                                <b>break</b>;
<a name='L1510'>
<a name='L1511'>                        <b>case</b> <a href='../D/1219.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT16</a>:
<a name='L1512'>                        <b>case</b> <a href='../D/1186.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT16</a>:
<a name='L1513'>                                srcMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(srcMarker, 2);
<a name='L1514'>                                destGMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(destGMarker, 2);
<a name='L1515'>
<a name='L1516'>                                <b>if</b> (outGPRs != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; inStruct != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1517'>                                        *(<b>short</b>*)&amp;outGPRs[destGMarker] =
<a name='L1518'>                                                *(<b>short</b>*)&amp;inStruct[srcMarker];
<a name='L1519'>
<a name='L1520'>                                srcMarker += 2;
<a name='L1521'>                                destGMarker += 2;
<a name='L1522'>
<a name='L1523'>                                <b>if</b> (inType-&gt;elements[i + 1] == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1524'>                                        destGMarker     = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(destGMarker, inType-&gt;alignment);
<a name='L1525'>
<a name='L1526'>                                <b>break</b>;
<a name='L1527'>
<a name='L1528'>                        <b>case</b> <a href='../D/1182.html' title='Multiple defined in 3 places.'>FFI_TYPE_INT</a>:
<a name='L1529'>                        <b>case</b> <a href='../D/1220.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT32</a>:
<a name='L1530'>                        <b>case</b> <a href='../D/1187.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT32</a>:
<a name='L1531'>                                srcMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(srcMarker, 4);
<a name='L1532'>                                destGMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(destGMarker, 4);
<a name='L1533'>
<a name='L1534'>                                <b>if</b> (outGPRs != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; inStruct != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1535'>                                        *(<b>int</b>*)&amp;outGPRs[destGMarker] =
<a name='L1536'>                                                *(<b>int</b>*)&amp;inStruct[srcMarker];
<a name='L1537'>
<a name='L1538'>                                srcMarker += 4;
<a name='L1539'>                                destGMarker += 4;
<a name='L1540'>
<a name='L1541'>                                <b>break</b>;
<a name='L1542'>
<a name='L1543'>                        <b>case</b> <a href='../D/1185.html' title='Multiple defined in 3 places.'>FFI_TYPE_POINTER</a>:
<a name='L1544'>                        <b>case</b> <a href='../D/1221.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT64</a>:
<a name='L1545'>                        <b>case</b> <a href='../D/1188.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT64</a>:
<a name='L1546'>                                srcMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(srcMarker, 8);
<a name='L1547'>                                destGMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(destGMarker, 8);
<a name='L1548'>
<a name='L1549'>                                <b>if</b> (outGPRs != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; inStruct != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1550'>                                        *(<b>long</b> <b>long</b>*)&amp;outGPRs[destGMarker] =
<a name='L1551'>                                                *(<b>long</b> <b>long</b>*)&amp;inStruct[srcMarker];
<a name='L1552'>
<a name='L1553'>                                srcMarker += 8;
<a name='L1554'>                                destGMarker += 8;
<a name='L1555'>
<a name='L1556'>                                <b>if</b> (inType-&gt;elements[i + 1] == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1557'>                                        destGMarker     = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(destGMarker, inType-&gt;alignment);
<a name='L1558'>
<a name='L1559'>                                <b>break</b>;
<a name='L1560'>
<a name='L1561'>                        <b>case</b> <a href='../D/1202.html' title='Multiple defined in 3 places.'>FFI_TYPE_STRUCT</a>:
<a name='L1562'>                                recurseCount++;
<a name='L1563'>                                <a href='../S/2547.html#L1294' title='Defined at 1294 in Modules/_ctypes/libffi_osx/powerpc/ppc-ffi_darwin.c.'>ffi64_struct_to_reg_form</a>(inType-&gt;elements[i],
<a name='L1564'>                                        inStruct, &amp;srcMarker, &amp;fprsUsed, outGPRs, 
<a name='L1565'>                                        &amp;destGMarker, outFPRs, &amp;destFMarker);
<a name='L1566'>                                recurseCount--;
<a name='L1567'>                                <b>break</b>;
<a name='L1568'>
<a name='L1569'>                        <b>default</b>:
<a name='L1570'>                                <a href='../D/1120.html' title='Multiple defined in 8 places.'>FFI_ASSERT</a>(0);
<a name='L1571'>                                <b>break</b>;
<a name='L1572'>                <font color='red'>}</font>
<a name='L1573'>        <font color='red'>}</font>
<a name='L1574'>
<a name='L1575'>        destGMarker     = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(destGMarker, inType-&gt;alignment);
<a name='L1576'>
<a name='L1577'>        <i><font color='green'>// Take care of the special case for 16-byte structs, but not for</font></i>
<a name='L1578'>        <i><font color='green'>// nested structs.</font></i>
<a name='L1579'>        <b>if</b> (recurseCount == 0 &amp;&amp; destGMarker == 16)
<a name='L1580'>        <font color='red'>{</font>
<a name='L1581'>                <b>if</b> (outGPRs != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; inStruct != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1582'>                        *(<b>long</b> <b>double</b>*)&amp;outGPRs[0] = *(<b>long</b> <b>double</b>*)&amp;inStruct[0];
<a name='L1583'>
<a name='L1584'>                destFMarker     = savedFMarker;
<a name='L1585'>                fprsUsed        = savedFPRsUsed;
<a name='L1586'>        <font color='red'>}</font>
<a name='L1587'>
<a name='L1588'>        <b>if</b> (ioStructMarker)
<a name='L1589'>                *ioStructMarker = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(srcMarker, 8);
<a name='L1590'>
<a name='L1591'>        <b>if</b> (ioFPRsUsed)
<a name='L1592'>                *ioFPRsUsed     = fprsUsed;
<a name='L1593'>
<a name='L1594'>        <b>if</b> (ioGPRSize)
<a name='L1595'>                *ioGPRSize = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(destGMarker, 8);
<a name='L1596'>
<a name='L1597'>        <b>if</b> (ioFPRSize)
<a name='L1598'>                *ioFPRSize = <a href='../D/55.html' title='Multiple defined in 4 places.'>ALIGN</a>(destFMarker, 8);
<a name='L1599'><font color='red'>}</font>
<a name='L1600'>
<a name='L1601'><i><font color='green'>/*      ffi64_stret_needs_ptr</font></i>
<a name='L1602'><i><font color='green'></font></i>
<a name='L1603'><i><font color='green'>        Determine whether a returned struct needs a pointer in r3 or can fit</font></i>
<a name='L1604'><i><font color='green'>        in registers.</font></i>
<a name='L1605'><i><font color='green'>*/</font></i>
<a name='L1606'>
<a name='L1607'>bool
<a name='L1608'><a href='../R/7676.html' title='Multiple refered from 4 places.'>ffi64_stret_needs_ptr</a>(
<a name='L1609'>        <b>const</b> ffi_type* inType,
<a name='L1610'>        <b>unsigned</b> <b>short</b>* ioGPRCount,
<a name='L1611'>        <b>unsigned</b> <b>short</b>* ioFPRCount)
<a name='L1612'><font color='red'>{</font>
<a name='L1613'>        <i><font color='green'>// Obvious case first- struct is larger than combined FPR size.</font></i>
<a name='L1614'>        <b>if</b> (inType-&gt;size &gt; 14 * 8)
<a name='L1615'>                <b>return</b> true;
<a name='L1616'>
<a name='L1617'>        <i><font color='green'>// Now the struct can physically fit in registers, determine if it</font></i>
<a name='L1618'>        <i><font color='green'>// also fits logically.</font></i>
<a name='L1619'>        bool                    needsPtr        = false;
<a name='L1620'>        <b>unsigned</b> <b>short</b>  gprsUsed        = 0;
<a name='L1621'>        <b>unsigned</b> <b>short</b>  fprsUsed        = 0;
<a name='L1622'>        <a href='../D/11182.html' title='Multiple defined in 2 places.'>size_t</a>                  i;
<a name='L1623'>
<a name='L1624'>        <b>if</b> (ioGPRCount)
<a name='L1625'>                gprsUsed = *ioGPRCount;
<a name='L1626'>
<a name='L1627'>        <b>if</b> (ioFPRCount)
<a name='L1628'>                fprsUsed = *ioFPRCount;
<a name='L1629'>
<a name='L1630'>        <b>for</b> (i = 0; inType-&gt;elements[i] != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; !needsPtr; i++)
<a name='L1631'>        <font color='red'>{</font>
<a name='L1632'>                <b>switch</b> (inType-&gt;elements[i]-&gt;type)
<a name='L1633'>                <font color='red'>{</font>
<a name='L1634'>                        <b>case</b> <a href='../D/1181.html' title='Multiple defined in 3 places.'>FFI_TYPE_FLOAT</a>:
<a name='L1635'>                        <b>case</b> <a href='../D/1180.html' title='Multiple defined in 3 places.'>FFI_TYPE_DOUBLE</a>:
<a name='L1636'>                                gprsUsed++;
<a name='L1637'>                                fprsUsed++;
<a name='L1638'>
<a name='L1639'>                                <b>if</b> (fprsUsed &gt; 13)
<a name='L1640'>                                        needsPtr = true;
<a name='L1641'>
<a name='L1642'>                                <b>break</b>;
<a name='L1643'>
<a name='L1644'>                        <b>case</b> <a href='../D/1184.html' title='Multiple defined in 8 places.'>FFI_TYPE_LONGDOUBLE</a>:
<a name='L1645'>                                gprsUsed += 2;
<a name='L1646'>                                fprsUsed += 2;
<a name='L1647'>
<a name='L1648'>                                <b>if</b> (fprsUsed &gt; 14)
<a name='L1649'>                                        needsPtr = true;
<a name='L1650'>
<a name='L1651'>                                <b>break</b>;
<a name='L1652'>
<a name='L1653'>                        <b>case</b> <a href='../D/1222.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT8</a>:
<a name='L1654'>                        <b>case</b> <a href='../D/1189.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT8</a>:
<a name='L1655'>                        <font color='red'>{</font>
<a name='L1656'>                                gprsUsed++;
<a name='L1657'>
<a name='L1658'>                                <b>if</b> (gprsUsed &gt; 8)
<a name='L1659'>                                <font color='red'>{</font>
<a name='L1660'>                                        needsPtr = true;
<a name='L1661'>                                        <b>break</b>;
<a name='L1662'>                                <font color='red'>}</font>
<a name='L1663'>
<a name='L1664'>                                <b>if</b> (inType-&gt;elements[i + 1] == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)    <i><font color='green'>// last byte in the struct</font></i>
<a name='L1665'>                                        <b>break</b>;
<a name='L1666'>
<a name='L1667'>                                <i><font color='green'>// Count possible contiguous bytes ahead, up to 8.</font></i>
<a name='L1668'>                                <b>unsigned</b> <b>short</b> j;
<a name='L1669'>
<a name='L1670'>                                <b>for</b> (j = 1; j &lt; 8; j++)
<a name='L1671'>                                <font color='red'>{</font>
<a name='L1672'>                                        <b>if</b> (inType-&gt;elements[i + j] == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> ||
<a name='L1673'>                                                !<a href='../S/2544.html#L53' title='Defined at 53 in Modules/_ctypes/libffi_osx/powerpc/ppc-darwin.h.'>FFI_TYPE_1_BYTE</a>(inType-&gt;elements[i + j]-&gt;type))
<a name='L1674'>                                                <b>break</b>;
<a name='L1675'>                                <font color='red'>}</font>
<a name='L1676'>
<a name='L1677'>                                i += j - 1;     <i><font color='green'>// allow for i++ before the test condition</font></i>
<a name='L1678'>
<a name='L1679'>                                <b>break</b>;
<a name='L1680'>                        <font color='red'>}</font>
<a name='L1681'>
<a name='L1682'>                        <b>case</b> <a href='../D/1219.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT16</a>:
<a name='L1683'>                        <b>case</b> <a href='../D/1186.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT16</a>:
<a name='L1684'>                        <b>case</b> <a href='../D/1182.html' title='Multiple defined in 3 places.'>FFI_TYPE_INT</a>:
<a name='L1685'>                        <b>case</b> <a href='../D/1220.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT32</a>:
<a name='L1686'>                        <b>case</b> <a href='../D/1187.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT32</a>:
<a name='L1687'>                        <b>case</b> <a href='../D/1185.html' title='Multiple defined in 3 places.'>FFI_TYPE_POINTER</a>:
<a name='L1688'>                        <b>case</b> <a href='../D/1221.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT64</a>:
<a name='L1689'>                        <b>case</b> <a href='../D/1188.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT64</a>:
<a name='L1690'>                                gprsUsed++;
<a name='L1691'>
<a name='L1692'>                                <b>if</b> (gprsUsed &gt; 8)
<a name='L1693'>                                        needsPtr = true;
<a name='L1694'>
<a name='L1695'>                                <b>break</b>;
<a name='L1696'>
<a name='L1697'>                        <b>case</b> <a href='../D/1202.html' title='Multiple defined in 3 places.'>FFI_TYPE_STRUCT</a>:
<a name='L1698'>                                needsPtr = <a href='../S/2547.html#L1608' title='Defined at 1608 in Modules/_ctypes/libffi_osx/powerpc/ppc-ffi_darwin.c.'>ffi64_stret_needs_ptr</a>(
<a name='L1699'>                                        inType-&gt;elements[i], &amp;gprsUsed, &amp;fprsUsed);
<a name='L1700'>
<a name='L1701'>                                <b>break</b>;
<a name='L1702'>
<a name='L1703'>                        <b>default</b>:
<a name='L1704'>                                <a href='../D/1120.html' title='Multiple defined in 8 places.'>FFI_ASSERT</a>(0);
<a name='L1705'>                                <b>break</b>;
<a name='L1706'>                <font color='red'>}</font>
<a name='L1707'>        <font color='red'>}</font>
<a name='L1708'>
<a name='L1709'>        <b>if</b> (ioGPRCount)
<a name='L1710'>                *ioGPRCount = gprsUsed;
<a name='L1711'>
<a name='L1712'>        <b>if</b> (ioFPRCount)
<a name='L1713'>                *ioFPRCount = fprsUsed;
<a name='L1714'>
<a name='L1715'>        <b>return</b> needsPtr;
<a name='L1716'><font color='red'>}</font>
<a name='L1717'>
<a name='L1718'><i><font color='green'>/*      ffi64_data_size</font></i>
<a name='L1719'><i><font color='green'></font></i>
<a name='L1720'><i><font color='green'>        Calculate the size in bytes of an ffi type.</font></i>
<a name='L1721'><i><font color='green'>*/</font></i>
<a name='L1722'>
<a name='L1723'><b>unsigned</b> <b>int</b>
<a name='L1724'>ffi64_data_size(
<a name='L1725'>        <b>const</b> ffi_type* inType)
<a name='L1726'><font color='red'>{</font>
<a name='L1727'>        <b>unsigned</b> <b>int</b>    size = 0;
<a name='L1728'>
<a name='L1729'>        <b>switch</b> (inType-&gt;type)
<a name='L1730'>        <font color='red'>{</font>
<a name='L1731'>                <b>case</b> <a href='../D/1222.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT8</a>:
<a name='L1732'>                <b>case</b> <a href='../D/1189.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT8</a>:
<a name='L1733'>                        size = 1;
<a name='L1734'>                        <b>break</b>;
<a name='L1735'>
<a name='L1736'>                <b>case</b> <a href='../D/1219.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT16</a>:
<a name='L1737'>                <b>case</b> <a href='../D/1186.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT16</a>:
<a name='L1738'>                        size = 2;
<a name='L1739'>                        <b>break</b>;
<a name='L1740'>
<a name='L1741'>                <b>case</b> <a href='../D/1182.html' title='Multiple defined in 3 places.'>FFI_TYPE_INT</a>:
<a name='L1742'>                <b>case</b> <a href='../D/1220.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT32</a>:
<a name='L1743'>                <b>case</b> <a href='../D/1187.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT32</a>:
<a name='L1744'>                <b>case</b> <a href='../D/1181.html' title='Multiple defined in 3 places.'>FFI_TYPE_FLOAT</a>:
<a name='L1745'>                        size = 4;
<a name='L1746'>                        <b>break</b>;
<a name='L1747'>
<a name='L1748'>                <b>case</b> <a href='../D/1185.html' title='Multiple defined in 3 places.'>FFI_TYPE_POINTER</a>:
<a name='L1749'>                <b>case</b> <a href='../D/1221.html' title='Multiple defined in 3 places.'>FFI_TYPE_UINT64</a>:
<a name='L1750'>                <b>case</b> <a href='../D/1188.html' title='Multiple defined in 3 places.'>FFI_TYPE_SINT64</a>:
<a name='L1751'>                <b>case</b> <a href='../D/1180.html' title='Multiple defined in 3 places.'>FFI_TYPE_DOUBLE</a>:
<a name='L1752'>                        size = 8;
<a name='L1753'>                        <b>break</b>;
<a name='L1754'>
<a name='L1755'>                <b>case</b> <a href='../D/1184.html' title='Multiple defined in 8 places.'>FFI_TYPE_LONGDOUBLE</a>:
<a name='L1756'>                        size = 16;
<a name='L1757'>                        <b>break</b>;
<a name='L1758'>
<a name='L1759'>                <b>case</b> <a href='../D/1202.html' title='Multiple defined in 3 places.'>FFI_TYPE_STRUCT</a>:
<a name='L1760'>                        <a href='../S/2547.html#L1294' title='Defined at 1294 in Modules/_ctypes/libffi_osx/powerpc/ppc-ffi_darwin.c.'>ffi64_struct_to_reg_form</a>(
<a name='L1761'>                                inType, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, &amp;size, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L1762'>                        <b>break</b>;
<a name='L1763'>
<a name='L1764'>                <b>case</b> <a href='../D/1223.html' title='Multiple defined in 3 places.'>FFI_TYPE_VOID</a>:
<a name='L1765'>                        <b>break</b>;
<a name='L1766'>
<a name='L1767'>                <b>default</b>:
<a name='L1768'>                        <a href='../D/1120.html' title='Multiple defined in 8 places.'>FFI_ASSERT</a>(0);
<a name='L1769'>                        <b>break</b>;
<a name='L1770'>        <font color='red'>}</font>
<a name='L1771'>
<a name='L1772'>        <b>return</b> size;
<a name='L1773'><font color='red'>}</font>
<a name='L1774'>
<a name='L1775'><font color='darkred'>#endif</font>  <i><font color='green'>/*      defined(__ppc64__)      */</font></i>
<a name='L1776'><font color='darkred'>#endif</font>  <i><font color='green'>/* __ppc__ || __ppc64__ */</font></i>
</pre>
<hr>
<a name='BOTTOM'>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L91'>[^]</a><a href='#L1724'>[v]</a><a href='#TOP'>[top]</a>[bottom]<a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
</body>
</html>
