<html>
<head>
<title>Modules/_ssl.c</title>
<meta name='robots' content='noindex,nofollow'>
<meta name='generator' content='GLOBAL-5.8.1'>
</head>
<body text='#191970' bgcolor='#f5f5dc' vlink='gray'>
<a name='TOP'><h2><a href='../mains.html'>root</a>/<a href='../files/3353.html'>Modules</a>/_ssl.c</h2>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L172'>[^]</a><a href='#L2037'>[v]</a>[top]<a href='#BOTTOM'>[bottom]</a><a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
<hr>
<h2>DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href='#L172' title='Defined at 172.'>PySSL_SetError</a>
<li><a href='#L263' title='Defined at 263.'>_setSSLError</a>
<li><a href='#L283' title='Defined at 283.'>newPySSLSocket</a>
<li><a href='#L335' title='Defined at 335.'>PySSL_SSLdo_handshake</a>
<li><a href='#L407' title='Defined at 407.'>_create_tuple_for_attribute</a>
<li><a href='#L453' title='Defined at 453.'>_create_tuple_for_X509_NAME</a>
<li><a href='#L547' title='Defined at 547.'>_get_peer_alt_names</a>
<li><a href='#L703' title='Defined at 703.'>_decode_certificate</a>
<li><a href='#L831' title='Defined at 831.'>PySSL_test_decode_certificate</a>
<li><a href='#L872' title='Defined at 872.'>PySSL_peercert</a>
<li><a href='#L923' title='Defined at 923.'>PySSL_cipher</a>
<li><a href='#L971' title='Defined at 971.'>PySSL_dealloc</a>
<li><a href='#L987' title='Defined at 987.'>check_socket_and_wait_for_timeout</a>
<li><a href='#L1051' title='Defined at 1051.'>PySSL_SSLwrite</a>
<li><a href='#L1140' title='Defined at 1140.'>PySSL_SSLpending</a>
<li><a href='#L1159' title='Defined at 1159.'>PySSL_SSLread</a>
<li><a href='#L1287' title='Defined at 1287.'>PySSL_SSLshutdown</a>
<li><a href='#L1436' title='Defined at 1436.'>context_new</a>
<li><a href='#L1492' title='Defined at 1492.'>context_dealloc</a>
<li><a href='#L1499' title='Defined at 1499.'>set_ciphers</a>
<li><a href='#L1520' title='Defined at 1520.'>get_verify_mode</a>
<li><a href='#L1536' title='Defined at 1536.'>set_verify_mode</a>
<li><a href='#L1557' title='Defined at 1557.'>get_options</a>
<li><a href='#L1563' title='Defined at 1563.'>set_options</a>
<li><a href='#L1586' title='Defined at 1586.'>load_cert_chain</a>
<li><a href='#L1658' title='Defined at 1658.'>load_verify_locations</a>
<li><a href='#L1714' title='Defined at 1714.'>context_wrap_socket</a>
<li><a href='#L1750' title='Defined at 1750.'>session_stats</a>
<li><a href='#L1789' title='Defined at 1789.'>set_default_verify_paths</a>
<li><a href='#L1869' title='Defined at 1869.'>PySSL_RAND_add</a>
<li><a href='#L1889' title='Defined at 1889.'>PySSL_RAND_status</a>
<li><a href='#L1902' title='Defined at 1902.'>PySSL_RAND_egd</a>
<li><a href='#L1957' title='Defined at 1957.'>_ssl_thread_id_function</a>
<li><a href='#L1988' title='Defined at 1988.'>_setup_ssl_threads</a>
<li><a href='#L2037' title='Defined at 2037.'>PyInit__ssl</a>
</ol>
<hr>
<pre>
<a name='L1'><i><font color='green'>/* SSL socket module</font></i>
<a name='L2'><i><font color='green'></font></i>
<a name='L3'><i><font color='green'>   SSL support based on patches by Brian E Gallew and Laszlo Kovacs.</font></i>
<a name='L4'><i><font color='green'>   Re-worked a bit by Bill Janssen to add server-side support and</font></i>
<a name='L5'><i><font color='green'>   certificate decoding.  Chris Stawarz contributed some non-blocking</font></i>
<a name='L6'><i><font color='green'>   patches.</font></i>
<a name='L7'><i><font color='green'></font></i>
<a name='L8'><i><font color='green'>   This module is imported by ssl.py. It should *not* be used</font></i>
<a name='L9'><i><font color='green'>   directly.</font></i>
<a name='L10'><i><font color='green'></font></i>
<a name='L11'><i><font color='green'>   XXX should partial writes be enabled, SSL_MODE_ENABLE_PARTIAL_WRITE?</font></i>
<a name='L12'><i><font color='green'></font></i>
<a name='L13'><i><font color='green'>   XXX integrate several "shutdown modes" as suggested in</font></i>
<a name='L14'><i><font color='green'>       http://bugs.python.org/issue8108#msg102867 ?</font></i>
<a name='L15'><i><font color='green'>*/</font></i>
<a name='L16'>
<a name='L17'><font color='darkred'>#include</font> "<a href='570.html'>Python.h</a>"
<a name='L18'>
<a name='L19'><font color='darkred'>#ifdef</font> <a href='../D/5537.html' title='Multiple defined in 3 places.'>WITH_THREAD</a>
<a name='L20'><font color='darkred'>#include</font> "<a href='572.html'>pythread.h</a>"
<a name='L21'><font color='darkred'>#define</font> <a href='../R/3342.html' title='Multiple refered from 16 places.'>PySSL_BEGIN_ALLOW_THREADS</a> <font color='red'>{</font> \
<a name='L22'>            <a href='../D/3832.html' title='Multiple defined in 2 places.'>PyThreadState</a> *_save = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;  \
<a name='L23'>            <b>if</b> (_ssl_locks_count&gt;0) <font color='red'>{</font>_save = <a href='../S/3091.html#L422' title='Defined at 422 in Python/ceval.c.'>PyEval_SaveThread</a>();<font color='red'>}</font>
<a name='L24'><font color='darkred'>#define</font> PySSL_BLOCK_THREADS     <b>if</b> (_ssl_locks_count&gt;0)<font color='red'>{</font><a href='../S/3091.html#L435' title='Defined at 435 in Python/ceval.c.'>PyEval_RestoreThread</a>(_save)<font color='red'>}</font>;
<a name='L25'><font color='darkred'>#define</font> PySSL_UNBLOCK_THREADS   <b>if</b> (_ssl_locks_count&gt;0)<font color='red'>{</font>_save = <a href='../S/3091.html#L422' title='Defined at 422 in Python/ceval.c.'>PyEval_SaveThread</a>()<font color='red'>}</font>;
<a name='L26'><font color='darkred'>#define</font> <a href='../R/3343.html' title='Multiple refered from 16 places.'>PySSL_END_ALLOW_THREADS</a> <b>if</b> (_ssl_locks_count&gt;0)<font color='red'>{</font><a href='../S/3091.html#L435' title='Defined at 435 in Python/ceval.c.'>PyEval_RestoreThread</a>(_save);<font color='red'>}</font> \
<a name='L27'>         <font color='red'>}</font>
<a name='L28'>
<a name='L29'><font color='darkred'>#else</font>   <i><font color='green'>/* no WITH_THREAD */</font></i>
<a name='L30'>
<a name='L31'><font color='darkred'>#define</font> <a href='../R/3342.html' title='Multiple refered from 16 places.'>PySSL_BEGIN_ALLOW_THREADS</a>
<a name='L32'><font color='darkred'>#define</font> PySSL_BLOCK_THREADS
<a name='L33'><font color='darkred'>#define</font> PySSL_UNBLOCK_THREADS
<a name='L34'><font color='darkred'>#define</font> <a href='../R/3343.html' title='Multiple refered from 16 places.'>PySSL_END_ALLOW_THREADS</a>
<a name='L35'>
<a name='L36'><font color='darkred'>#endif</font>
<a name='L37'>
<a name='L38'><b>enum</b> <a href='../S/2612.html#L178' title='Refered from 178 in Modules/_ssl.c.'>py_ssl_error</a> <font color='red'>{</font>
<a name='L39'>    <i><font color='green'>/* these mirror ssl.h */</font></i>
<a name='L40'>    <a href='../S/2612.html#L178' title='Refered from 178 in Modules/_ssl.c.'>PY_SSL_ERROR_NONE</a>,
<a name='L41'>    <a href='../R/2399.html' title='Multiple refered from 2 places.'>PY_SSL_ERROR_SSL</a>,
<a name='L42'>    <a href='../R/2402.html' title='Multiple refered from 2 places.'>PY_SSL_ERROR_WANT_READ</a>,
<a name='L43'>    <a href='../R/2403.html' title='Multiple refered from 2 places.'>PY_SSL_ERROR_WANT_WRITE</a>,
<a name='L44'>    <a href='../R/2404.html' title='Multiple refered from 2 places.'>PY_SSL_ERROR_WANT_X509_LOOKUP</a>,
<a name='L45'>    <a href='../R/2400.html' title='Multiple refered from 3 places.'>PY_SSL_ERROR_SYSCALL</a>,     <i><font color='green'>/* look at error stack/return value/errno */</font></i>
<a name='L46'>    <a href='../R/2405.html' title='Multiple refered from 2 places.'>PY_SSL_ERROR_ZERO_RETURN</a>,
<a name='L47'>    <a href='../R/2401.html' title='Multiple refered from 2 places.'>PY_SSL_ERROR_WANT_CONNECT</a>,
<a name='L48'>    <i><font color='green'>/* start of non ssl.h errorcodes */</font></i>
<a name='L49'>    <a href='../R/2395.html' title='Multiple refered from 2 places.'>PY_SSL_ERROR_EOF</a>,         <i><font color='green'>/* special case of SSL_ERROR_SYSCALL */</font></i>
<a name='L50'>    <a href='../R/2398.html' title='Multiple refered from 4 places.'>PY_SSL_ERROR_NO_SOCKET</a>,   <i><font color='green'>/* socket has been GC'd */</font></i>
<a name='L51'>    <a href='../R/2396.html' title='Multiple refered from 2 places.'>PY_SSL_ERROR_INVALID_ERROR_CODE</a>
<a name='L52'><font color='red'>}</font>;
<a name='L53'>
<a name='L54'><b>enum</b> py_ssl_server_or_client <font color='red'>{</font>
<a name='L55'>    <a href='../S/2612.html#L323' title='Refered from 323 in Modules/_ssl.c.'>PY_SSL_CLIENT</a>,
<a name='L56'>    PY_SSL_SERVER
<a name='L57'><font color='red'>}</font>;
<a name='L58'>
<a name='L59'><b>enum</b> py_ssl_cert_requirements <font color='red'>{</font>
<a name='L60'>    <a href='../R/2391.html' title='Multiple refered from 3 places.'>PY_SSL_CERT_NONE</a>,
<a name='L61'>    <a href='../R/2392.html' title='Multiple refered from 3 places.'>PY_SSL_CERT_OPTIONAL</a>,
<a name='L62'>    <a href='../R/2393.html' title='Multiple refered from 3 places.'>PY_SSL_CERT_REQUIRED</a>
<a name='L63'><font color='red'>}</font>;
<a name='L64'>
<a name='L65'><b>enum</b> py_ssl_version <font color='red'>{</font>
<a name='L66'>    <a href='../R/2406.html' title='Multiple refered from 2 places.'>PY_SSL_VERSION_SSL2</a>,
<a name='L67'>    <a href='../R/2408.html' title='Multiple refered from 2 places.'>PY_SSL_VERSION_SSL3</a>,
<a name='L68'>    <a href='../R/2407.html' title='Multiple refered from 3 places.'>PY_SSL_VERSION_SSL23</a>,
<a name='L69'>    <a href='../R/2409.html' title='Multiple refered from 2 places.'>PY_SSL_VERSION_TLS1</a>
<a name='L70'><font color='red'>}</font>;
<a name='L71'>
<a name='L72'><i><font color='green'>/* Include symbols from _socket module */</font></i>
<a name='L73'><font color='darkred'>#include</font> "<a href='2712.html'>socketmodule.h</a>"
<a name='L74'>
<a name='L75'><b>static</b> <a href='../S/2712.html#L200' title='Defined at 200 in Modules/socketmodule.h.'>PySocketModule_APIObject</a> PySocketModule;
<a name='L76'>
<a name='L77'><font color='darkred'>#if</font> <b>defined</b>(HAVE_POLL_H)
<a name='L78'><font color='darkred'>#include</font> &lt;poll.h&gt;
<a name='L79'><font color='darkred'>#elif</font> <b>defined</b>(HAVE_SYS_POLL_H)
<a name='L80'><font color='darkred'>#include</font> &lt;sys/poll.h&gt;
<a name='L81'><font color='darkred'>#endif</font>
<a name='L82'>
<a name='L83'><i><font color='green'>/* Include OpenSSL header files */</font></i>
<a name='L84'><font color='darkred'>#include</font> "openssl/rsa.h"
<a name='L85'><font color='darkred'>#include</font> "openssl/crypto.h"
<a name='L86'><font color='darkred'>#include</font> "openssl/x509.h"
<a name='L87'><font color='darkred'>#include</font> "openssl/x509v3.h"
<a name='L88'><font color='darkred'>#include</font> "openssl/pem.h"
<a name='L89'><font color='darkred'>#include</font> "openssl/ssl.h"
<a name='L90'><font color='darkred'>#include</font> "openssl/err.h"
<a name='L91'><font color='darkred'>#include</font> "openssl/rand.h"
<a name='L92'>
<a name='L93'><i><font color='green'>/* SSL error object */</font></i>
<a name='L94'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *PySSLErrorObject;
<a name='L95'>
<a name='L96'><font color='darkred'>#ifdef</font> <a href='../D/5537.html' title='Multiple defined in 3 places.'>WITH_THREAD</a>
<a name='L97'>
<a name='L98'><i><font color='green'>/* serves as a flag to see whether we've initialized the SSL thread support. */</font></i>
<a name='L99'><i><font color='green'>/* 0 means no, greater than 0 means yes */</font></i>
<a name='L100'>
<a name='L101'><b>static</b> <b>unsigned</b> <b>int</b> _ssl_locks_count = 0;
<a name='L102'>
<a name='L103'><font color='darkred'>#endif</font> <i><font color='green'>/* def WITH_THREAD */</font></i>
<a name='L104'>
<a name='L105'><i><font color='green'>/* SSL socket object */</font></i>
<a name='L106'>
<a name='L107'><font color='darkred'>#define</font> <a href='../S/2612.html#L409' title='Refered from 409 in Modules/_ssl.c.'>X509_NAME_MAXLEN</a> 256
<a name='L108'>
<a name='L109'><i><font color='green'>/* RAND_* APIs got added to OpenSSL in 0.9.5 */</font></i>
<a name='L110'><font color='darkred'>#if</font> OPENSSL_VERSION_NUMBER &gt;= 0x0090500fL
<a name='L111'><font color='darkred'># define</font> <a href='../R/1387.html' title='Multiple refered from 2 places.'>HAVE_OPENSSL_RAND</a> 1
<a name='L112'><font color='darkred'>#else</font>
<a name='L113'><font color='darkred'># undef</font> <a href='../R/1387.html' title='Multiple refered from 2 places.'>HAVE_OPENSSL_RAND</a>
<a name='L114'><font color='darkred'>#endif</font>
<a name='L115'>
<a name='L116'><i><font color='green'>/* SSL_CTX_clear_options() and SSL_clear_options() were first added in</font></i>
<a name='L117'><i><font color='green'> * OpenSSL 0.9.8m but do not appear in some 0.9.9-dev versions such the</font></i>
<a name='L118'><i><font color='green'> * 0.9.9 from "May 2008" that NetBSD 5.0 uses. */</font></i>
<a name='L119'><font color='darkred'>#if</font> OPENSSL_VERSION_NUMBER &gt;= 0x009080dfL &amp;&amp; OPENSSL_VERSION_NUMBER != 0x00909000L
<a name='L120'><font color='darkred'># define</font> <a href='../S/2612.html#L1572' title='Refered from 1572 in Modules/_ssl.c.'>HAVE_SSL_CTX_CLEAR_OPTIONS</a>
<a name='L121'><font color='darkred'>#else</font>
<a name='L122'><font color='darkred'># undef</font> <a href='../S/2612.html#L1572' title='Refered from 1572 in Modules/_ssl.c.'>HAVE_SSL_CTX_CLEAR_OPTIONS</a>
<a name='L123'><font color='darkred'>#endif</font>
<a name='L124'>
<a name='L125'><b>typedef</b> <b>struct</b> <font color='red'>{</font>
<a name='L126'>    <a href='../S/544.html#L82' title='Defined at 82 in Include/object.h.'>PyObject_HEAD</a>
<a name='L127'>    SSL_CTX *ctx;
<a name='L128'><font color='red'>}</font> <a href='../R/3340.html' title='Multiple refered from 3 places.'>PySSLContext</a>;
<a name='L129'>
<a name='L130'><b>typedef</b> <b>struct</b> <font color='red'>{</font>
<a name='L131'>    <a href='../S/544.html#L82' title='Defined at 82 in Include/object.h.'>PyObject_HEAD</a>
<a name='L132'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *Socket; <i><font color='green'>/* weakref to socket on which we're layered */</font></i>
<a name='L133'>    SSL *ssl;
<a name='L134'>    X509 *peer_cert;
<a name='L135'>    <b>int</b> shutdown_seen_zero;
<a name='L136'><font color='red'>}</font> <a href='../R/3341.html' title='Multiple refered from 4 places.'>PySSLSocket</a>;
<a name='L137'>
<a name='L138'><b>static</b> <a href='../D/3899.html' title='Multiple defined in 3 places.'>PyTypeObject</a> PySSLContext_Type;
<a name='L139'><b>static</b> <a href='../D/3899.html' title='Multiple defined in 3 places.'>PyTypeObject</a> PySSLSocket_Type;
<a name='L140'>
<a name='L141'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *<a href='../S/2612.html#L1051' title='Defined at 1051 in Modules/_ssl.c.'>PySSL_SSLwrite</a>(PySSLSocket *self, PyObject *args);
<a name='L142'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *<a href='../S/2612.html#L1159' title='Defined at 1159 in Modules/_ssl.c.'>PySSL_SSLread</a>(PySSLSocket *self, PyObject *args);
<a name='L143'><b>static</b> <b>int</b> <a href='../S/2612.html#L987' title='Defined at 987 in Modules/_ssl.c.'>check_socket_and_wait_for_timeout</a>(PySocketSockObject *s,
<a name='L144'>                                             <b>int</b> writing);
<a name='L145'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *<a href='../S/2612.html#L872' title='Defined at 872 in Modules/_ssl.c.'>PySSL_peercert</a>(PySSLSocket *self, PyObject *args);
<a name='L146'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *<a href='../S/2612.html#L923' title='Defined at 923 in Modules/_ssl.c.'>PySSL_cipher</a>(PySSLSocket *self);
<a name='L147'>
<a name='L148'><font color='darkred'>#define</font> PySSLContext_Check(v)   (<a href='../D/4259.html' title='Multiple defined in 5 places.'>Py_TYPE</a>(v) == &amp;PySSLContext_Type)
<a name='L149'><font color='darkred'>#define</font> PySSLSocket_Check(v)    (<a href='../D/4259.html' title='Multiple defined in 5 places.'>Py_TYPE</a>(v) == &amp;PySSLSocket_Type)
<a name='L150'>
<a name='L151'><b>typedef</b> <b>enum</b> <font color='red'>{</font>
<a name='L152'>    <a href='../R/4206.html' title='Multiple refered from 4 places.'>SOCKET_IS_NONBLOCKING</a>,
<a name='L153'>    <a href='../S/2612.html#L995' title='Refered from 995 in Modules/_ssl.c.'>SOCKET_IS_BLOCKING</a>,
<a name='L154'>    <a href='../R/4204.html' title='Multiple refered from 7 places.'>SOCKET_HAS_TIMED_OUT</a>,
<a name='L155'>    <a href='../R/4203.html' title='Multiple refered from 5 places.'>SOCKET_HAS_BEEN_CLOSED</a>,
<a name='L156'>    <a href='../R/4209.html' title='Multiple refered from 5 places.'>SOCKET_TOO_LARGE_FOR_SELECT</a>,
<a name='L157'>    <a href='../R/4207.html' title='Multiple refered from 5 places.'>SOCKET_OPERATION_OK</a>
<a name='L158'><font color='red'>}</font> timeout_state;
<a name='L159'>
<a name='L160'><i><font color='green'>/* Wrap error strings with filename and line # */</font></i>
<a name='L161'><font color='darkred'>#define</font> <a href='../S/2612.html#L162' title='Refered from 162 in Modules/_ssl.c.'>STRINGIFY1</a>(x) #x
<a name='L162'><font color='darkred'>#define</font> <a href='../S/2612.html#L164' title='Refered from 164 in Modules/_ssl.c.'>STRINGIFY2</a>(x) <a href='../S/2612.html#L161' title='Defined at 161 in Modules/_ssl.c.'>STRINGIFY1</a>(x)
<a name='L163'><font color='darkred'>#define</font> <a href='../S/2612.html#L164' title='Refered from 164 in Modules/_ssl.c.'>ERRSTR1</a>(x,y,z) (x ":" y ": " z)
<a name='L164'><font color='darkred'>#define</font> <a href='../R/890.html' title='Multiple refered from 4 places.'>ERRSTR</a>(x) <a href='../S/2612.html#L163' title='Defined at 163 in Modules/_ssl.c.'>ERRSTR1</a>("_ssl.c", <a href='../S/2612.html#L162' title='Defined at 162 in Modules/_ssl.c.'>STRINGIFY2</a>(__LINE__), x)
<a name='L165'>
<a name='L166'><i><font color='green'>/* XXX It might be helpful to augment the error message generated</font></i>
<a name='L167'><i><font color='green'>   below with the name of the SSL function that generated the error.</font></i>
<a name='L168'><i><font color='green'>   I expect it's obvious most of the time.</font></i>
<a name='L169'><i><font color='green'>*/</font></i>
<a name='L170'>
<a name='L171'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L172'><a href='../R/3352.html' title='Multiple refered from 6 places.'>PySSL_SetError</a>(PySSLSocket *obj, <b>int</b> ret, <b>char</b> *filename, <b>int</b> lineno)
<a name='L173'><font color='red'>{</font>
<a name='L174'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *v;
<a name='L175'>    <b>char</b> buf[2048];
<a name='L176'>    <b>char</b> *errstr;
<a name='L177'>    <b>int</b> err;
<a name='L178'>    <b>enum</b> <a href='../S/2612.html#L38' title='Defined at 38 in Modules/_ssl.c.'>py_ssl_error</a> p = <a href='../S/2612.html#L40' title='Defined at 40 in Modules/_ssl.c.'>PY_SSL_ERROR_NONE</a>;
<a name='L179'>
<a name='L180'>    <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(ret &lt;= 0);
<a name='L181'>
<a name='L182'>    <b>if</b> (obj-&gt;ssl != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L183'>        err = SSL_get_error(obj-&gt;ssl, ret);
<a name='L184'>
<a name='L185'>        <b>switch</b> (err) <font color='red'>{</font>
<a name='L186'>        <b>case</b> SSL_ERROR_ZERO_RETURN:
<a name='L187'>            errstr = "TLS/SSL connection has been closed";
<a name='L188'>            p = <a href='../S/2612.html#L46' title='Defined at 46 in Modules/_ssl.c.'>PY_SSL_ERROR_ZERO_RETURN</a>;
<a name='L189'>            <b>break</b>;
<a name='L190'>        <b>case</b> SSL_ERROR_WANT_READ:
<a name='L191'>            errstr = "The operation did not complete (read)";
<a name='L192'>            p = <a href='../S/2612.html#L42' title='Defined at 42 in Modules/_ssl.c.'>PY_SSL_ERROR_WANT_READ</a>;
<a name='L193'>            <b>break</b>;
<a name='L194'>        <b>case</b> SSL_ERROR_WANT_WRITE:
<a name='L195'>            p = <a href='../S/2612.html#L43' title='Defined at 43 in Modules/_ssl.c.'>PY_SSL_ERROR_WANT_WRITE</a>;
<a name='L196'>            errstr = "The operation did not complete (write)";
<a name='L197'>            <b>break</b>;
<a name='L198'>        <b>case</b> SSL_ERROR_WANT_X509_LOOKUP:
<a name='L199'>            p = <a href='../S/2612.html#L44' title='Defined at 44 in Modules/_ssl.c.'>PY_SSL_ERROR_WANT_X509_LOOKUP</a>;
<a name='L200'>            errstr = "The operation did not complete (X509 lookup)";
<a name='L201'>            <b>break</b>;
<a name='L202'>        <b>case</b> SSL_ERROR_WANT_CONNECT:
<a name='L203'>            p = <a href='../S/2612.html#L47' title='Defined at 47 in Modules/_ssl.c.'>PY_SSL_ERROR_WANT_CONNECT</a>;
<a name='L204'>            errstr = "The operation did not complete (connect)";
<a name='L205'>            <b>break</b>;
<a name='L206'>        <b>case</b> SSL_ERROR_SYSCALL:
<a name='L207'>        <font color='red'>{</font>
<a name='L208'>            <b>unsigned</b> <b>long</b> e = ERR_get_error();
<a name='L209'>            <b>if</b> (e == 0) <font color='red'>{</font>
<a name='L210'>                <a href='../S/2712.html#L143' title='Defined at 143 in Modules/socketmodule.h.'>PySocketSockObject</a> *s
<a name='L211'>                  = (<a href='../S/2712.html#L143' title='Defined at 143 in Modules/socketmodule.h.'>PySocketSockObject</a> *) <a href='../S/2830.html#L842' title='Defined at 842 in Objects/weakrefobject.c.'>PyWeakref_GetObject</a>(obj-&gt;Socket);
<a name='L212'>                <b>if</b> (ret == 0 || (((<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *)s) == Py_None)) <font color='red'>{</font>
<a name='L213'>                    p = <a href='../S/2612.html#L49' title='Defined at 49 in Modules/_ssl.c.'>PY_SSL_ERROR_EOF</a>;
<a name='L214'>                    errstr = "EOF occurred in violation of protocol";
<a name='L215'>                <font color='red'>}</font> <b>else</b> <b>if</b> (ret == -1) <font color='red'>{</font>
<a name='L216'>                    <i><font color='green'>/* underlying BIO reported an I/O error */</font></i>
<a name='L217'>                    Py_INCREF(s);
<a name='L218'>                    ERR_clear_error();
<a name='L219'>                    v = s-&gt;errorhandler();
<a name='L220'>                    Py_DECREF(s);
<a name='L221'>                    <b>return</b> v;
<a name='L222'>                <font color='red'>}</font> <b>else</b> <font color='red'>{</font> <i><font color='green'>/* possible? */</font></i>
<a name='L223'>                    p = <a href='../S/2612.html#L45' title='Defined at 45 in Modules/_ssl.c.'>PY_SSL_ERROR_SYSCALL</a>;
<a name='L224'>                    errstr = "Some I/O error occurred";
<a name='L225'>                <font color='red'>}</font>
<a name='L226'>            <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L227'>                p = <a href='../S/2612.html#L45' title='Defined at 45 in Modules/_ssl.c.'>PY_SSL_ERROR_SYSCALL</a>;
<a name='L228'>                <i><font color='green'>/* XXX Protected by global interpreter lock */</font></i>
<a name='L229'>                errstr = ERR_error_string(e, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L230'>            <font color='red'>}</font>
<a name='L231'>            <b>break</b>;
<a name='L232'>        <font color='red'>}</font>
<a name='L233'>        <b>case</b> SSL_ERROR_SSL:
<a name='L234'>        <font color='red'>{</font>
<a name='L235'>            <b>unsigned</b> <b>long</b> e = ERR_get_error();
<a name='L236'>            p = <a href='../S/2612.html#L41' title='Defined at 41 in Modules/_ssl.c.'>PY_SSL_ERROR_SSL</a>;
<a name='L237'>            <b>if</b> (e != 0)
<a name='L238'>                <i><font color='green'>/* XXX Protected by global interpreter lock */</font></i>
<a name='L239'>                errstr = ERR_error_string(e, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L240'>            <b>else</b> <font color='red'>{</font>              <i><font color='green'>/* possible? */</font></i>
<a name='L241'>                errstr = "A failure in the SSL library occurred";
<a name='L242'>            <font color='red'>}</font>
<a name='L243'>            <b>break</b>;
<a name='L244'>        <font color='red'>}</font>
<a name='L245'>        <b>default</b>:
<a name='L246'>            p = <a href='../S/2612.html#L51' title='Defined at 51 in Modules/_ssl.c.'>PY_SSL_ERROR_INVALID_ERROR_CODE</a>;
<a name='L247'>            errstr = "Invalid error code";
<a name='L248'>        <font color='red'>}</font>
<a name='L249'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L250'>        errstr = ERR_error_string(ERR_peek_last_error(), <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L251'>    <font color='red'>}</font>
<a name='L252'>    <a href='../S/3126.html#L41' title='Defined at 41 in Python/mysnprintf.c.'>PyOS_snprintf</a>(buf, <b>sizeof</b>(buf), "_ssl.c:%d: %s", lineno, errstr);
<a name='L253'>    ERR_clear_error();
<a name='L254'>    v = <a href='../D/4089.html' title='Multiple defined in 2 places.'>Py_BuildValue</a>("(is)", p, buf);
<a name='L255'>    <b>if</b> (v != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L256'>        <a href='../S/3106.html#L53' title='Defined at 53 in Python/errors.c.'>PyErr_SetObject</a>(PySSLErrorObject, v);
<a name='L257'>        Py_DECREF(v);
<a name='L258'>    <font color='red'>}</font>
<a name='L259'>    <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L260'><font color='red'>}</font>
<a name='L261'>
<a name='L262'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L263'><a href='../R/5835.html' title='Multiple refered from 15 places.'>_setSSLError</a> (<b>char</b> *errstr, <b>int</b> errcode, <b>char</b> *filename, <b>int</b> lineno) <font color='red'>{</font>
<a name='L264'>
<a name='L265'>    <b>char</b> buf[2048];
<a name='L266'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *v;
<a name='L267'>
<a name='L268'>    <b>if</b> (errstr == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L269'>        errcode = ERR_peek_last_error();
<a name='L270'>        errstr = ERR_error_string(errcode, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L271'>    <font color='red'>}</font>
<a name='L272'>    <a href='../S/3126.html#L41' title='Defined at 41 in Python/mysnprintf.c.'>PyOS_snprintf</a>(buf, <b>sizeof</b>(buf), "_ssl.c:%d: %s", lineno, errstr);
<a name='L273'>    ERR_clear_error();
<a name='L274'>    v = <a href='../D/4089.html' title='Multiple defined in 2 places.'>Py_BuildValue</a>("(is)", errcode, buf);
<a name='L275'>    <b>if</b> (v != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L276'>        <a href='../S/3106.html#L53' title='Defined at 53 in Python/errors.c.'>PyErr_SetObject</a>(PySSLErrorObject, v);
<a name='L277'>        Py_DECREF(v);
<a name='L278'>    <font color='red'>}</font>
<a name='L279'>    <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L280'><font color='red'>}</font>
<a name='L281'>
<a name='L282'><b>static</b> <a href='../S/2612.html#L136' title='Defined at 136 in Modules/_ssl.c.'>PySSLSocket</a> *
<a name='L283'><a href='../S/2612.html#L1742' title='Refered from 1742 in Modules/_ssl.c.'>newPySSLSocket</a>(SSL_CTX *ctx, PySocketSockObject *sock,
<a name='L284'>               <b>enum</b> py_ssl_server_or_client socket_type,
<a name='L285'>               <b>char</b> *server_hostname)
<a name='L286'><font color='red'>{</font>
<a name='L287'>    <a href='../S/2612.html#L136' title='Defined at 136 in Modules/_ssl.c.'>PySSLSocket</a> *self;
<a name='L288'>
<a name='L289'>    self = PyObject_New(<a href='../S/2612.html#L136' title='Defined at 136 in Modules/_ssl.c.'>PySSLSocket</a>, &amp;PySSLSocket_Type);
<a name='L290'>    <b>if</b> (self == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L291'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L292'>
<a name='L293'>    self-&gt;peer_cert = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L294'>    self-&gt;ssl = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L295'>    self-&gt;Socket = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L296'>
<a name='L297'>    <i><font color='green'>/* Make sure the SSL error state is initialized */</font></i>
<a name='L298'>    (<b>void</b>) ERR_get_state();
<a name='L299'>    ERR_clear_error();
<a name='L300'>
<a name='L301'>    <a href='../D/3715.html' title='Multiple defined in 2 places.'>PySSL_BEGIN_ALLOW_THREADS</a>
<a name='L302'>    self-&gt;ssl = SSL_new(ctx);
<a name='L303'>    <a href='../D/3717.html' title='Multiple defined in 2 places.'>PySSL_END_ALLOW_THREADS</a>
<a name='L304'>    SSL_set_fd(self-&gt;ssl, sock-&gt;sock_fd);
<a name='L305'><font color='darkred'>#ifdef</font> SSL_MODE_AUTO_RETRY
<a name='L306'>    SSL_set_mode(self-&gt;ssl, SSL_MODE_AUTO_RETRY);
<a name='L307'><font color='darkred'>#endif</font>
<a name='L308'>
<a name='L309'><font color='darkred'>#ifdef</font> SSL_CTRL_SET_TLSEXT_HOSTNAME
<a name='L310'>    <b>if</b> (server_hostname != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L311'>        SSL_set_tlsext_host_name(self-&gt;ssl, server_hostname);
<a name='L312'><font color='darkred'>#endif</font>
<a name='L313'>
<a name='L314'>    <i><font color='green'>/* If the socket is in non-blocking mode or timeout mode, set the BIO</font></i>
<a name='L315'><i><font color='green'>     * to non-blocking mode (blocking is the default)</font></i>
<a name='L316'><i><font color='green'>     */</font></i>
<a name='L317'>    <b>if</b> (sock-&gt;sock_timeout &gt;= 0.0) <font color='red'>{</font>
<a name='L318'>        BIO_set_nbio(SSL_get_rbio(self-&gt;ssl), 1);
<a name='L319'>        BIO_set_nbio(SSL_get_wbio(self-&gt;ssl), 1);
<a name='L320'>    <font color='red'>}</font>
<a name='L321'>
<a name='L322'>    <a href='../D/3715.html' title='Multiple defined in 2 places.'>PySSL_BEGIN_ALLOW_THREADS</a>
<a name='L323'>    <b>if</b> (socket_type == <a href='../S/2612.html#L55' title='Defined at 55 in Modules/_ssl.c.'>PY_SSL_CLIENT</a>)
<a name='L324'>        SSL_set_connect_state(self-&gt;ssl);
<a name='L325'>    <b>else</b>
<a name='L326'>        SSL_set_accept_state(self-&gt;ssl);
<a name='L327'>    <a href='../D/3717.html' title='Multiple defined in 2 places.'>PySSL_END_ALLOW_THREADS</a>
<a name='L328'>
<a name='L329'>    self-&gt;Socket = <a href='../S/2830.html#L719' title='Defined at 719 in Objects/weakrefobject.c.'>PyWeakref_NewRef</a>((<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *) sock, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L330'>    <b>return</b> self;
<a name='L331'><font color='red'>}</font>
<a name='L332'>
<a name='L333'><i><font color='green'>/* SSL object methods */</font></i>
<a name='L334'>
<a name='L335'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *<a href='../S/2612.html#L1383' title='Refered from 1383 in Modules/_ssl.c.'>PySSL_SSLdo_handshake</a>(PySSLSocket *self)
<a name='L336'><font color='red'>{</font>
<a name='L337'>    <b>int</b> ret;
<a name='L338'>    <b>int</b> err;
<a name='L339'>    <b>int</b> sockstate, nonblocking;
<a name='L340'>    <a href='../S/2712.html#L143' title='Defined at 143 in Modules/socketmodule.h.'>PySocketSockObject</a> *sock
<a name='L341'>      = (<a href='../S/2712.html#L143' title='Defined at 143 in Modules/socketmodule.h.'>PySocketSockObject</a> *) <a href='../S/2830.html#L842' title='Defined at 842 in Objects/weakrefobject.c.'>PyWeakref_GetObject</a>(self-&gt;Socket);
<a name='L342'>
<a name='L343'>    <b>if</b> (((<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a>*)sock) == Py_None) <font color='red'>{</font>
<a name='L344'>        <a href='../S/2612.html#L263' title='Defined at 263 in Modules/_ssl.c.'>_setSSLError</a>("Underlying socket connection gone",
<a name='L345'>                     <a href='../S/2612.html#L50' title='Defined at 50 in Modules/_ssl.c.'>PY_SSL_ERROR_NO_SOCKET</a>, __FILE__, __LINE__);
<a name='L346'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L347'>    <font color='red'>}</font>
<a name='L348'>    Py_INCREF(sock);
<a name='L349'>
<a name='L350'>    <i><font color='green'>/* just in case the blocking state of the socket has been changed */</font></i>
<a name='L351'>    nonblocking = (sock-&gt;sock_timeout &gt;= 0.0);
<a name='L352'>    BIO_set_nbio(SSL_get_rbio(self-&gt;ssl), nonblocking);
<a name='L353'>    BIO_set_nbio(SSL_get_wbio(self-&gt;ssl), nonblocking);
<a name='L354'>
<a name='L355'>    <i><font color='green'>/* Actually negotiate SSL connection */</font></i>
<a name='L356'>    <i><font color='green'>/* XXX If SSL_do_handshake() returns 0, it's also a failure. */</font></i>
<a name='L357'>    sockstate = 0;
<a name='L358'>    <b>do</b> <font color='red'>{</font>
<a name='L359'>        <a href='../D/3715.html' title='Multiple defined in 2 places.'>PySSL_BEGIN_ALLOW_THREADS</a>
<a name='L360'>        ret = SSL_do_handshake(self-&gt;ssl);
<a name='L361'>        err = SSL_get_error(self-&gt;ssl, ret);
<a name='L362'>        <a href='../D/3717.html' title='Multiple defined in 2 places.'>PySSL_END_ALLOW_THREADS</a>
<a name='L363'>        <b>if</b> (<a href='../D/3143.html' title='Multiple defined in 2 places.'>PyErr_CheckSignals</a>())
<a name='L364'>            <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L365'>        <b>if</b> (err == SSL_ERROR_WANT_READ) <font color='red'>{</font>
<a name='L366'>            sockstate = <a href='../S/2612.html#L987' title='Defined at 987 in Modules/_ssl.c.'>check_socket_and_wait_for_timeout</a>(sock, 0);
<a name='L367'>        <font color='red'>}</font> <b>else</b> <b>if</b> (err == SSL_ERROR_WANT_WRITE) <font color='red'>{</font>
<a name='L368'>            sockstate = <a href='../S/2612.html#L987' title='Defined at 987 in Modules/_ssl.c.'>check_socket_and_wait_for_timeout</a>(sock, 1);
<a name='L369'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L370'>            sockstate = <a href='../S/2612.html#L157' title='Defined at 157 in Modules/_ssl.c.'>SOCKET_OPERATION_OK</a>;
<a name='L371'>        <font color='red'>}</font>
<a name='L372'>        <b>if</b> (sockstate == <a href='../S/2612.html#L154' title='Defined at 154 in Modules/_ssl.c.'>SOCKET_HAS_TIMED_OUT</a>) <font color='red'>{</font>
<a name='L373'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PySocketModule.timeout_error,
<a name='L374'>                            <a href='../S/2612.html#L164' title='Defined at 164 in Modules/_ssl.c.'>ERRSTR</a>("The handshake operation timed out"));
<a name='L375'>            <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L376'>        <font color='red'>}</font> <b>else</b> <b>if</b> (sockstate == <a href='../S/2612.html#L155' title='Defined at 155 in Modules/_ssl.c.'>SOCKET_HAS_BEEN_CLOSED</a>) <font color='red'>{</font>
<a name='L377'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PySSLErrorObject,
<a name='L378'>                            <a href='../S/2612.html#L164' title='Defined at 164 in Modules/_ssl.c.'>ERRSTR</a>("Underlying socket has been closed."));
<a name='L379'>            <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L380'>        <font color='red'>}</font> <b>else</b> <b>if</b> (sockstate == <a href='../S/2612.html#L156' title='Defined at 156 in Modules/_ssl.c.'>SOCKET_TOO_LARGE_FOR_SELECT</a>) <font color='red'>{</font>
<a name='L381'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PySSLErrorObject,
<a name='L382'>                            <a href='../S/2612.html#L164' title='Defined at 164 in Modules/_ssl.c.'>ERRSTR</a>("Underlying socket too large for select()."));
<a name='L383'>            <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L384'>        <font color='red'>}</font> <b>else</b> <b>if</b> (sockstate == <a href='../S/2612.html#L152' title='Defined at 152 in Modules/_ssl.c.'>SOCKET_IS_NONBLOCKING</a>) <font color='red'>{</font>
<a name='L385'>            <b>break</b>;
<a name='L386'>        <font color='red'>}</font>
<a name='L387'>    <font color='red'>}</font> <b>while</b> (err == SSL_ERROR_WANT_READ || err == SSL_ERROR_WANT_WRITE);
<a name='L388'>    Py_DECREF(sock);
<a name='L389'>    <b>if</b> (ret &lt; 1)
<a name='L390'>        <b>return</b> <a href='../S/2612.html#L172' title='Defined at 172 in Modules/_ssl.c.'>PySSL_SetError</a>(self, ret, __FILE__, __LINE__);
<a name='L391'>
<a name='L392'>    <b>if</b> (self-&gt;peer_cert)
<a name='L393'>        X509_free (self-&gt;peer_cert);
<a name='L394'>    <a href='../D/3715.html' title='Multiple defined in 2 places.'>PySSL_BEGIN_ALLOW_THREADS</a>
<a name='L395'>    self-&gt;peer_cert = SSL_get_peer_certificate(self-&gt;ssl);
<a name='L396'>    <a href='../D/3717.html' title='Multiple defined in 2 places.'>PySSL_END_ALLOW_THREADS</a>
<a name='L397'>
<a name='L398'>    Py_INCREF(Py_None);
<a name='L399'>    <b>return</b> Py_None;
<a name='L400'>
<a name='L401'><a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>:
<a name='L402'>    Py_DECREF(sock);
<a name='L403'>    <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L404'><font color='red'>}</font>
<a name='L405'>
<a name='L406'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L407'><a href='../S/2612.html#L505' title='Refered from 505 in Modules/_ssl.c.'>_create_tuple_for_attribute</a> (ASN1_OBJECT *name, ASN1_STRING *value) <font color='red'>{</font>
<a name='L408'>
<a name='L409'>    <b>char</b> namebuf[<a href='../S/2612.html#L107' title='Defined at 107 in Modules/_ssl.c.'>X509_NAME_MAXLEN</a>];
<a name='L410'>    <b>int</b> buflen;
<a name='L411'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *name_obj;
<a name='L412'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *value_obj;
<a name='L413'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *attr;
<a name='L414'>    <b>unsigned</b> <b>char</b> *valuebuf = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L415'>
<a name='L416'>    buflen = OBJ_obj2txt(namebuf, <b>sizeof</b>(namebuf), name, 0);
<a name='L417'>    <b>if</b> (buflen &lt; 0) <font color='red'>{</font>
<a name='L418'>        <a href='../S/2612.html#L263' title='Defined at 263 in Modules/_ssl.c.'>_setSSLError</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, 0, __FILE__, __LINE__);
<a name='L419'>        <b>goto</b> fail;
<a name='L420'>    <font color='red'>}</font>
<a name='L421'>    name_obj = <a href='../D/4013.html' title='Multiple defined in 3 places.'>PyUnicode_FromStringAndSize</a>(namebuf, buflen);
<a name='L422'>    <b>if</b> (name_obj == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L423'>        <b>goto</b> fail;
<a name='L424'>
<a name='L425'>    buflen = ASN1_STRING_to_UTF8(&amp;valuebuf, <a href='../S/2252.html#L27' title='Defined at 27 in Modules/_ctypes/ctypes.h.'>value</a>);
<a name='L426'>    <b>if</b> (buflen &lt; 0) <font color='red'>{</font>
<a name='L427'>        <a href='../S/2612.html#L263' title='Defined at 263 in Modules/_ssl.c.'>_setSSLError</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, 0, __FILE__, __LINE__);
<a name='L428'>        Py_DECREF(name_obj);
<a name='L429'>        <b>goto</b> fail;
<a name='L430'>    <font color='red'>}</font>
<a name='L431'>    value_obj = <a href='../D/3987.html' title='Multiple defined in 3 places.'>PyUnicode_DecodeUTF8</a>((<b>char</b> *) valuebuf,
<a name='L432'>                                     buflen, "strict");
<a name='L433'>    OPENSSL_free(valuebuf);
<a name='L434'>    <b>if</b> (value_obj == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L435'>        Py_DECREF(name_obj);
<a name='L436'>        <b>goto</b> fail;
<a name='L437'>    <font color='red'>}</font>
<a name='L438'>    attr = <a href='../S/2823.html#L49' title='Defined at 49 in Objects/tupleobject.c.'>PyTuple_New</a>(2);
<a name='L439'>    <b>if</b> (attr == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L440'>        Py_DECREF(name_obj);
<a name='L441'>        Py_DECREF(value_obj);
<a name='L442'>        <b>goto</b> fail;
<a name='L443'>    <font color='red'>}</font>
<a name='L444'>    PyTuple_SET_ITEM(attr, 0, name_obj);
<a name='L445'>    PyTuple_SET_ITEM(attr, 1, value_obj);
<a name='L446'>    <b>return</b> attr;
<a name='L447'>
<a name='L448'>  fail:
<a name='L449'>    <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L450'><font color='red'>}</font>
<a name='L451'>
<a name='L452'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L453'><a href='../R/5732.html' title='Multiple refered from 3 places.'>_create_tuple_for_X509_NAME</a> (X509_NAME *xname)
<a name='L454'><font color='red'>{</font>
<a name='L455'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *dn = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;    <i><font color='green'>/* tuple which represents the "distinguished name" */</font></i>
<a name='L456'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *rdn = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;   <i><font color='green'>/* tuple to hold a "relative distinguished name" */</font></i>
<a name='L457'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *rdnt;
<a name='L458'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *attr = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;   <i><font color='green'>/* tuple to hold an attribute */</font></i>
<a name='L459'>    <b>int</b> entry_count = X509_NAME_entry_count(xname);
<a name='L460'>    X509_NAME_ENTRY *entry;
<a name='L461'>    ASN1_OBJECT *name;
<a name='L462'>    ASN1_STRING *<a href='../S/2252.html#L27' title='Defined at 27 in Modules/_ctypes/ctypes.h.'>value</a>;
<a name='L463'>    <b>int</b> index_counter;
<a name='L464'>    <b>int</b> rdn_level = -1;
<a name='L465'>    <b>int</b> retcode;
<a name='L466'>
<a name='L467'>    dn = <a href='../S/2796.html#L113' title='Defined at 113 in Objects/listobject.c.'>PyList_New</a>(0);
<a name='L468'>    <b>if</b> (dn == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L469'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L470'>    <i><font color='green'>/* now create another tuple to hold the top-level RDN */</font></i>
<a name='L471'>    rdn = <a href='../S/2796.html#L113' title='Defined at 113 in Objects/listobject.c.'>PyList_New</a>(0);
<a name='L472'>    <b>if</b> (rdn == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L473'>        <b>goto</b> fail0;
<a name='L474'>
<a name='L475'>    <b>for</b> (index_counter = 0;
<a name='L476'>         index_counter &lt; entry_count;
<a name='L477'>         index_counter++)
<a name='L478'>    <font color='red'>{</font>
<a name='L479'>        entry = X509_NAME_get_entry(xname, index_counter);
<a name='L480'>
<a name='L481'>        <i><font color='green'>/* check to see if we've gotten to a new RDN */</font></i>
<a name='L482'>        <b>if</b> (rdn_level &gt;= 0) <font color='red'>{</font>
<a name='L483'>            <b>if</b> (rdn_level != entry-&gt;set) <font color='red'>{</font>
<a name='L484'>                <i><font color='green'>/* yes, new RDN */</font></i>
<a name='L485'>                <i><font color='green'>/* add old RDN to DN */</font></i>
<a name='L486'>                rdnt = <a href='../S/2796.html#L2092' title='Defined at 2092 in Objects/listobject.c.'>PyList_AsTuple</a>(rdn);
<a name='L487'>                Py_DECREF(rdn);
<a name='L488'>                <b>if</b> (rdnt == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L489'>                    <b>goto</b> fail0;
<a name='L490'>                retcode = <a href='../S/2796.html#L286' title='Defined at 286 in Objects/listobject.c.'>PyList_Append</a>(dn, rdnt);
<a name='L491'>                Py_DECREF(rdnt);
<a name='L492'>                <b>if</b> (retcode &lt; 0)
<a name='L493'>                    <b>goto</b> fail0;
<a name='L494'>                <i><font color='green'>/* create new RDN */</font></i>
<a name='L495'>                rdn = <a href='../S/2796.html#L113' title='Defined at 113 in Objects/listobject.c.'>PyList_New</a>(0);
<a name='L496'>                <b>if</b> (rdn == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L497'>                    <b>goto</b> fail0;
<a name='L498'>            <font color='red'>}</font>
<a name='L499'>        <font color='red'>}</font>
<a name='L500'>        rdn_level = entry-&gt;set;
<a name='L501'>
<a name='L502'>        <i><font color='green'>/* now add this attribute to the current RDN */</font></i>
<a name='L503'>        name = X509_NAME_ENTRY_get_object(entry);
<a name='L504'>        <a href='../S/2252.html#L27' title='Defined at 27 in Modules/_ctypes/ctypes.h.'>value</a> = X509_NAME_ENTRY_get_data(entry);
<a name='L505'>        attr = <a href='../S/2612.html#L407' title='Defined at 407 in Modules/_ssl.c.'>_create_tuple_for_attribute</a>(name, <a href='../S/2252.html#L27' title='Defined at 27 in Modules/_ctypes/ctypes.h.'>value</a>);
<a name='L506'>        <i><font color='green'>/*</font></i>
<a name='L507'><i><font color='green'>        fprintf(stderr, "RDN level %d, attribute %s: %s\n",</font></i>
<a name='L508'><i><font color='green'>            entry-&gt;set,</font></i>
<a name='L509'><i><font color='green'>            PyBytes_AS_STRING(PyTuple_GET_ITEM(attr, 0)),</font></i>
<a name='L510'><i><font color='green'>            PyBytes_AS_STRING(PyTuple_GET_ITEM(attr, 1)));</font></i>
<a name='L511'><i><font color='green'>        */</font></i>
<a name='L512'>        <b>if</b> (attr == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L513'>            <b>goto</b> fail1;
<a name='L514'>        retcode = <a href='../S/2796.html#L286' title='Defined at 286 in Objects/listobject.c.'>PyList_Append</a>(rdn, attr);
<a name='L515'>        Py_DECREF(attr);
<a name='L516'>        <b>if</b> (retcode &lt; 0)
<a name='L517'>            <b>goto</b> fail1;
<a name='L518'>    <font color='red'>}</font>
<a name='L519'>    <i><font color='green'>/* now, there's typically a dangling RDN */</font></i>
<a name='L520'>    <b>if</b> ((rdn != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) &amp;&amp; (<a href='../S/2796.html#L166' title='Defined at 166 in Objects/listobject.c.'>PyList_Size</a>(rdn) &gt; 0)) <font color='red'>{</font>
<a name='L521'>        rdnt = <a href='../S/2796.html#L2092' title='Defined at 2092 in Objects/listobject.c.'>PyList_AsTuple</a>(rdn);
<a name='L522'>        Py_DECREF(rdn);
<a name='L523'>        <b>if</b> (rdnt == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L524'>            <b>goto</b> fail0;
<a name='L525'>        retcode = <a href='../S/2796.html#L286' title='Defined at 286 in Objects/listobject.c.'>PyList_Append</a>(dn, rdnt);
<a name='L526'>        Py_DECREF(rdnt);
<a name='L527'>        <b>if</b> (retcode &lt; 0)
<a name='L528'>            <b>goto</b> fail0;
<a name='L529'>    <font color='red'>}</font>
<a name='L530'>
<a name='L531'>    <i><font color='green'>/* convert list to tuple */</font></i>
<a name='L532'>    rdnt = <a href='../S/2796.html#L2092' title='Defined at 2092 in Objects/listobject.c.'>PyList_AsTuple</a>(dn);
<a name='L533'>    Py_DECREF(dn);
<a name='L534'>    <b>if</b> (rdnt == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L535'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L536'>    <b>return</b> rdnt;
<a name='L537'>
<a name='L538'>  fail1:
<a name='L539'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(rdn);
<a name='L540'>
<a name='L541'>  fail0:
<a name='L542'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(dn);
<a name='L543'>    <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L544'><font color='red'>}</font>
<a name='L545'>
<a name='L546'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L547'><a href='../S/2612.html#L806' title='Refered from 806 in Modules/_ssl.c.'>_get_peer_alt_names</a> (X509 *certificate) <font color='red'>{</font>
<a name='L548'>
<a name='L549'>    <i><font color='green'>/* this code follows the procedure outlined in</font></i>
<a name='L550'><i><font color='green'>       OpenSSL's crypto/x509v3/v3_prn.c:X509v3_EXT_print()</font></i>
<a name='L551'><i><font color='green'>       function to extract the STACK_OF(GENERAL_NAME),</font></i>
<a name='L552'><i><font color='green'>       then iterates through the stack to add the</font></i>
<a name='L553'><i><font color='green'>       names. */</font></i>
<a name='L554'>
<a name='L555'>    <b>int</b> i, j;
<a name='L556'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *peer_alt_names = Py_None;
<a name='L557'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *v, *t;
<a name='L558'>    X509_EXTENSION *ext = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L559'>    GENERAL_NAMES *names = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L560'>    GENERAL_NAME *name;
<a name='L561'>    <b>const</b> X509V3_EXT_METHOD *method;
<a name='L562'>    BIO *biobuf = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L563'>    <b>char</b> buf[2048];
<a name='L564'>    <b>char</b> *vptr;
<a name='L565'>    <b>int</b> len;
<a name='L566'>    <i><font color='green'>/* Issue #2973: ASN1_item_d2i() API changed in OpenSSL 0.9.6m */</font></i>
<a name='L567'><font color='darkred'>#if</font> OPENSSL_VERSION_NUMBER &gt;= 0x009060dfL
<a name='L568'>    <b>const</b> <b>unsigned</b> <b>char</b> *p;
<a name='L569'><font color='darkred'>#else</font>
<a name='L570'>    <b>unsigned</b> <b>char</b> *p;
<a name='L571'><font color='darkred'>#endif</font>
<a name='L572'>
<a name='L573'>    <b>if</b> (certificate == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L574'>        <b>return</b> peer_alt_names;
<a name='L575'>
<a name='L576'>    <i><font color='green'>/* get a memory buffer */</font></i>
<a name='L577'>    biobuf = BIO_new(BIO_s_mem());
<a name='L578'>
<a name='L579'>    i = 0;
<a name='L580'>    <b>while</b> ((i = X509_get_ext_by_NID(
<a name='L581'>                    certificate, NID_subject_alt_name, i)) &gt;= 0) <font color='red'>{</font>
<a name='L582'>
<a name='L583'>        <b>if</b> (peer_alt_names == Py_None) <font color='red'>{</font>
<a name='L584'>            peer_alt_names = <a href='../S/2796.html#L113' title='Defined at 113 in Objects/listobject.c.'>PyList_New</a>(0);
<a name='L585'>            <b>if</b> (peer_alt_names == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L586'>                <b>goto</b> fail;
<a name='L587'>        <font color='red'>}</font>
<a name='L588'>
<a name='L589'>        <i><font color='green'>/* now decode the altName */</font></i>
<a name='L590'>        ext = X509_get_ext(certificate, i);
<a name='L591'>        <b>if</b>(!(method = X509V3_EXT_get(ext))) <font color='red'>{</font>
<a name='L592'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>
<a name='L593'>              (PySSLErrorObject,
<a name='L594'>               <a href='../S/2612.html#L164' title='Defined at 164 in Modules/_ssl.c.'>ERRSTR</a>("No method for internalizing subjectAltName!"));
<a name='L595'>            <b>goto</b> fail;
<a name='L596'>        <font color='red'>}</font>
<a name='L597'>
<a name='L598'>        p = ext-&gt;<a href='../S/2252.html#L27' title='Defined at 27 in Modules/_ctypes/ctypes.h.'>value</a>-&gt;data;
<a name='L599'>        <b>if</b> (method-&gt;it)
<a name='L600'>            names = (GENERAL_NAMES*)
<a name='L601'>              (ASN1_item_d2i(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L602'>                             &amp;p,
<a name='L603'>                             ext-&gt;<a href='../S/2252.html#L27' title='Defined at 27 in Modules/_ctypes/ctypes.h.'>value</a>-&gt;length,
<a name='L604'>                             ASN1_ITEM_ptr(method-&gt;it)));
<a name='L605'>        <b>else</b>
<a name='L606'>            names = (GENERAL_NAMES*)
<a name='L607'>              (method-&gt;d2i(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L608'>                           &amp;p,
<a name='L609'>                           ext-&gt;<a href='../S/2252.html#L27' title='Defined at 27 in Modules/_ctypes/ctypes.h.'>value</a>-&gt;length));
<a name='L610'>
<a name='L611'>        <b>for</b>(j = 0; j &lt; sk_GENERAL_NAME_num(names); j++) <font color='red'>{</font>
<a name='L612'>
<a name='L613'>            <i><font color='green'>/* get a rendering of each name in the set of names */</font></i>
<a name='L614'>
<a name='L615'>            name = sk_GENERAL_NAME_value(names, j);
<a name='L616'>            <b>if</b> (name-&gt;type == GEN_DIRNAME) <font color='red'>{</font>
<a name='L617'>
<a name='L618'>                <i><font color='green'>/* we special-case DirName as a tuple of</font></i>
<a name='L619'><i><font color='green'>                   tuples of attributes */</font></i>
<a name='L620'>
<a name='L621'>                t = <a href='../S/2823.html#L49' title='Defined at 49 in Objects/tupleobject.c.'>PyTuple_New</a>(2);
<a name='L622'>                <b>if</b> (t == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L623'>                    <b>goto</b> fail;
<a name='L624'>                <font color='red'>}</font>
<a name='L625'>
<a name='L626'>                v = <a href='../D/4012.html' title='Multiple defined in 3 places.'>PyUnicode_FromString</a>("DirName");
<a name='L627'>                <b>if</b> (v == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L628'>                    Py_DECREF(t);
<a name='L629'>                    <b>goto</b> fail;
<a name='L630'>                <font color='red'>}</font>
<a name='L631'>                PyTuple_SET_ITEM(t, 0, v);
<a name='L632'>
<a name='L633'>                v = <a href='../S/2612.html#L453' title='Defined at 453 in Modules/_ssl.c.'>_create_tuple_for_X509_NAME</a> (name-&gt;d.dirn);
<a name='L634'>                <b>if</b> (v == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L635'>                    Py_DECREF(t);
<a name='L636'>                    <b>goto</b> fail;
<a name='L637'>                <font color='red'>}</font>
<a name='L638'>                PyTuple_SET_ITEM(t, 1, v);
<a name='L639'>
<a name='L640'>            <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L641'>
<a name='L642'>                <i><font color='green'>/* for everything else, we use the OpenSSL print form */</font></i>
<a name='L643'>
<a name='L644'>                (<b>void</b>) BIO_reset(biobuf);
<a name='L645'>                GENERAL_NAME_print(biobuf, name);
<a name='L646'>                len = BIO_gets(biobuf, buf, <b>sizeof</b>(buf)-1);
<a name='L647'>                <b>if</b> (len &lt; 0) <font color='red'>{</font>
<a name='L648'>                    <a href='../S/2612.html#L263' title='Defined at 263 in Modules/_ssl.c.'>_setSSLError</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, 0, __FILE__, __LINE__);
<a name='L649'>                    <b>goto</b> fail;
<a name='L650'>                <font color='red'>}</font>
<a name='L651'>                vptr = strchr(buf, ':');
<a name='L652'>                <b>if</b> (vptr == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L653'>                    <b>goto</b> fail;
<a name='L654'>                t = <a href='../S/2823.html#L49' title='Defined at 49 in Objects/tupleobject.c.'>PyTuple_New</a>(2);
<a name='L655'>                <b>if</b> (t == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L656'>                    <b>goto</b> fail;
<a name='L657'>                v = <a href='../D/4013.html' title='Multiple defined in 3 places.'>PyUnicode_FromStringAndSize</a>(buf, (vptr - buf));
<a name='L658'>                <b>if</b> (v == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L659'>                    Py_DECREF(t);
<a name='L660'>                    <b>goto</b> fail;
<a name='L661'>                <font color='red'>}</font>
<a name='L662'>                PyTuple_SET_ITEM(t, 0, v);
<a name='L663'>                v = <a href='../D/4013.html' title='Multiple defined in 3 places.'>PyUnicode_FromStringAndSize</a>((vptr + 1),
<a name='L664'>                                                (len - (vptr - buf + 1)));
<a name='L665'>                <b>if</b> (v == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L666'>                    Py_DECREF(t);
<a name='L667'>                    <b>goto</b> fail;
<a name='L668'>                <font color='red'>}</font>
<a name='L669'>                PyTuple_SET_ITEM(t, 1, v);
<a name='L670'>            <font color='red'>}</font>
<a name='L671'>
<a name='L672'>            <i><font color='green'>/* and add that rendering to the list */</font></i>
<a name='L673'>
<a name='L674'>            <b>if</b> (<a href='../S/2796.html#L286' title='Defined at 286 in Objects/listobject.c.'>PyList_Append</a>(peer_alt_names, t) &lt; 0) <font color='red'>{</font>
<a name='L675'>                Py_DECREF(t);
<a name='L676'>                <b>goto</b> fail;
<a name='L677'>            <font color='red'>}</font>
<a name='L678'>            Py_DECREF(t);
<a name='L679'>        <font color='red'>}</font>
<a name='L680'>    <font color='red'>}</font>
<a name='L681'>    BIO_free(biobuf);
<a name='L682'>    <b>if</b> (peer_alt_names != Py_None) <font color='red'>{</font>
<a name='L683'>        v = <a href='../S/2796.html#L2092' title='Defined at 2092 in Objects/listobject.c.'>PyList_AsTuple</a>(peer_alt_names);
<a name='L684'>        Py_DECREF(peer_alt_names);
<a name='L685'>        <b>return</b> v;
<a name='L686'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L687'>        <b>return</b> peer_alt_names;
<a name='L688'>    <font color='red'>}</font>
<a name='L689'>
<a name='L690'>
<a name='L691'>  fail:
<a name='L692'>    <b>if</b> (biobuf != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L693'>        BIO_free(biobuf);
<a name='L694'>
<a name='L695'>    <b>if</b> (peer_alt_names != Py_None) <font color='red'>{</font>
<a name='L696'>        <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(peer_alt_names);
<a name='L697'>    <font color='red'>}</font>
<a name='L698'>
<a name='L699'>    <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L700'><font color='red'>}</font>
<a name='L701'>
<a name='L702'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L703'><a href='../R/5743.html' title='Multiple refered from 2 places.'>_decode_certificate</a>(X509 *certificate) <font color='red'>{</font>
<a name='L704'>
<a name='L705'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *retval = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L706'>    BIO *biobuf = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L707'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *peer;
<a name='L708'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *peer_alt_names = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L709'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *issuer;
<a name='L710'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *version;
<a name='L711'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *sn_obj;
<a name='L712'>    ASN1_INTEGER *serialNumber;
<a name='L713'>    <b>char</b> buf[2048];
<a name='L714'>    <b>int</b> len;
<a name='L715'>    ASN1_TIME *notBefore, *notAfter;
<a name='L716'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *pnotBefore, *pnotAfter;
<a name='L717'>
<a name='L718'>    retval = <a href='../S/2787.html#L233' title='Defined at 233 in Objects/dictobject.c.'>PyDict_New</a>();
<a name='L719'>    <b>if</b> (retval == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L720'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L721'>
<a name='L722'>    peer = <a href='../S/2612.html#L453' title='Defined at 453 in Modules/_ssl.c.'>_create_tuple_for_X509_NAME</a>(
<a name='L723'>        X509_get_subject_name(certificate));
<a name='L724'>    <b>if</b> (peer == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L725'>        <b>goto</b> fail0;
<a name='L726'>    <b>if</b> (<a href='../S/2787.html#L2180' title='Defined at 2180 in Objects/dictobject.c.'>PyDict_SetItemString</a>(retval, (<b>const</b> <b>char</b> *) "subject", peer) &lt; 0) <font color='red'>{</font>
<a name='L727'>        Py_DECREF(peer);
<a name='L728'>        <b>goto</b> fail0;
<a name='L729'>    <font color='red'>}</font>
<a name='L730'>    Py_DECREF(peer);
<a name='L731'>
<a name='L732'>    issuer = <a href='../S/2612.html#L453' title='Defined at 453 in Modules/_ssl.c.'>_create_tuple_for_X509_NAME</a>(
<a name='L733'>        X509_get_issuer_name(certificate));
<a name='L734'>    <b>if</b> (issuer == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L735'>        <b>goto</b> fail0;
<a name='L736'>    <b>if</b> (<a href='../S/2787.html#L2180' title='Defined at 2180 in Objects/dictobject.c.'>PyDict_SetItemString</a>(retval, (<b>const</b> <b>char</b> *)"issuer", issuer) &lt; 0) <font color='red'>{</font>
<a name='L737'>        Py_DECREF(issuer);
<a name='L738'>        <b>goto</b> fail0;
<a name='L739'>    <font color='red'>}</font>
<a name='L740'>    Py_DECREF(issuer);
<a name='L741'>
<a name='L742'>    version = <a href='../S/2799.html#L176' title='Defined at 176 in Objects/longobject.c.'>PyLong_FromLong</a>(X509_get_version(certificate) + 1);
<a name='L743'>    <b>if</b> (<a href='../S/2787.html#L2180' title='Defined at 2180 in Objects/dictobject.c.'>PyDict_SetItemString</a>(retval, "version", version) &lt; 0) <font color='red'>{</font>
<a name='L744'>        Py_DECREF(version);
<a name='L745'>        <b>goto</b> fail0;
<a name='L746'>    <font color='red'>}</font>
<a name='L747'>    Py_DECREF(version);
<a name='L748'>
<a name='L749'>    <i><font color='green'>/* get a memory buffer */</font></i>
<a name='L750'>    biobuf = BIO_new(BIO_s_mem());
<a name='L751'>
<a name='L752'>    (<b>void</b>) BIO_reset(biobuf);
<a name='L753'>    serialNumber = X509_get_serialNumber(certificate);
<a name='L754'>    <i><font color='green'>/* should not exceed 20 octets, 160 bits, so buf is big enough */</font></i>
<a name='L755'>    i2a_ASN1_INTEGER(biobuf, serialNumber);
<a name='L756'>    len = BIO_gets(biobuf, buf, <b>sizeof</b>(buf)-1);
<a name='L757'>    <b>if</b> (len &lt; 0) <font color='red'>{</font>
<a name='L758'>        <a href='../S/2612.html#L263' title='Defined at 263 in Modules/_ssl.c.'>_setSSLError</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, 0, __FILE__, __LINE__);
<a name='L759'>        <b>goto</b> fail1;
<a name='L760'>    <font color='red'>}</font>
<a name='L761'>    sn_obj = <a href='../D/4013.html' title='Multiple defined in 3 places.'>PyUnicode_FromStringAndSize</a>(buf, len);
<a name='L762'>    <b>if</b> (sn_obj == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L763'>        <b>goto</b> fail1;
<a name='L764'>    <b>if</b> (<a href='../S/2787.html#L2180' title='Defined at 2180 in Objects/dictobject.c.'>PyDict_SetItemString</a>(retval, "serialNumber", sn_obj) &lt; 0) <font color='red'>{</font>
<a name='L765'>        Py_DECREF(sn_obj);
<a name='L766'>        <b>goto</b> fail1;
<a name='L767'>    <font color='red'>}</font>
<a name='L768'>    Py_DECREF(sn_obj);
<a name='L769'>
<a name='L770'>    (<b>void</b>) BIO_reset(biobuf);
<a name='L771'>    notBefore = X509_get_notBefore(certificate);
<a name='L772'>    ASN1_TIME_print(biobuf, notBefore);
<a name='L773'>    len = BIO_gets(biobuf, buf, <b>sizeof</b>(buf)-1);
<a name='L774'>    <b>if</b> (len &lt; 0) <font color='red'>{</font>
<a name='L775'>        <a href='../S/2612.html#L263' title='Defined at 263 in Modules/_ssl.c.'>_setSSLError</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, 0, __FILE__, __LINE__);
<a name='L776'>        <b>goto</b> fail1;
<a name='L777'>    <font color='red'>}</font>
<a name='L778'>    pnotBefore = <a href='../D/4013.html' title='Multiple defined in 3 places.'>PyUnicode_FromStringAndSize</a>(buf, len);
<a name='L779'>    <b>if</b> (pnotBefore == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L780'>        <b>goto</b> fail1;
<a name='L781'>    <b>if</b> (<a href='../S/2787.html#L2180' title='Defined at 2180 in Objects/dictobject.c.'>PyDict_SetItemString</a>(retval, "notBefore", pnotBefore) &lt; 0) <font color='red'>{</font>
<a name='L782'>        Py_DECREF(pnotBefore);
<a name='L783'>        <b>goto</b> fail1;
<a name='L784'>    <font color='red'>}</font>
<a name='L785'>    Py_DECREF(pnotBefore);
<a name='L786'>
<a name='L787'>    (<b>void</b>) BIO_reset(biobuf);
<a name='L788'>    notAfter = X509_get_notAfter(certificate);
<a name='L789'>    ASN1_TIME_print(biobuf, notAfter);
<a name='L790'>    len = BIO_gets(biobuf, buf, <b>sizeof</b>(buf)-1);
<a name='L791'>    <b>if</b> (len &lt; 0) <font color='red'>{</font>
<a name='L792'>        <a href='../S/2612.html#L263' title='Defined at 263 in Modules/_ssl.c.'>_setSSLError</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, 0, __FILE__, __LINE__);
<a name='L793'>        <b>goto</b> fail1;
<a name='L794'>    <font color='red'>}</font>
<a name='L795'>    pnotAfter = <a href='../D/4013.html' title='Multiple defined in 3 places.'>PyUnicode_FromStringAndSize</a>(buf, len);
<a name='L796'>    <b>if</b> (pnotAfter == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L797'>        <b>goto</b> fail1;
<a name='L798'>    <b>if</b> (<a href='../S/2787.html#L2180' title='Defined at 2180 in Objects/dictobject.c.'>PyDict_SetItemString</a>(retval, "notAfter", pnotAfter) &lt; 0) <font color='red'>{</font>
<a name='L799'>        Py_DECREF(pnotAfter);
<a name='L800'>        <b>goto</b> fail1;
<a name='L801'>    <font color='red'>}</font>
<a name='L802'>    Py_DECREF(pnotAfter);
<a name='L803'>
<a name='L804'>    <i><font color='green'>/* Now look for subjectAltName */</font></i>
<a name='L805'>
<a name='L806'>    peer_alt_names = <a href='../S/2612.html#L547' title='Defined at 547 in Modules/_ssl.c.'>_get_peer_alt_names</a>(certificate);
<a name='L807'>    <b>if</b> (peer_alt_names == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L808'>        <b>goto</b> fail1;
<a name='L809'>    <b>else</b> <b>if</b> (peer_alt_names != Py_None) <font color='red'>{</font>
<a name='L810'>        <b>if</b> (<a href='../S/2787.html#L2180' title='Defined at 2180 in Objects/dictobject.c.'>PyDict_SetItemString</a>(retval, "subjectAltName",
<a name='L811'>                                 peer_alt_names) &lt; 0) <font color='red'>{</font>
<a name='L812'>            Py_DECREF(peer_alt_names);
<a name='L813'>            <b>goto</b> fail1;
<a name='L814'>        <font color='red'>}</font>
<a name='L815'>        Py_DECREF(peer_alt_names);
<a name='L816'>    <font color='red'>}</font>
<a name='L817'>
<a name='L818'>    BIO_free(biobuf);
<a name='L819'>    <b>return</b> retval;
<a name='L820'>
<a name='L821'>  fail1:
<a name='L822'>    <b>if</b> (biobuf != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L823'>        BIO_free(biobuf);
<a name='L824'>  fail0:
<a name='L825'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(retval);
<a name='L826'>    <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L827'><font color='red'>}</font>
<a name='L828'>
<a name='L829'>
<a name='L830'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L831'><a href='../S/2612.html#L1936' title='Refered from 1936 in Modules/_ssl.c.'>PySSL_test_decode_certificate</a> (PyObject *mod, PyObject *args) <font color='red'>{</font>
<a name='L832'>
<a name='L833'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *retval = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L834'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *filename;
<a name='L835'>    X509 *x=<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L836'>    BIO *cert;
<a name='L837'>
<a name='L838'>    <b>if</b> (!<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "O&amp;:test_decode_certificate",
<a name='L839'>                          <a href='../D/4003.html' title='Multiple defined in 3 places.'>PyUnicode_FSConverter</a>, &amp;filename))
<a name='L840'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L841'>
<a name='L842'>    <b>if</b> ((cert=BIO_new(BIO_s_file())) == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L843'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PySSLErrorObject,
<a name='L844'>                        "Can't malloc memory to read file");
<a name='L845'>        <b>goto</b> fail0;
<a name='L846'>    <font color='red'>}</font>
<a name='L847'>
<a name='L848'>    <b>if</b> (BIO_read_filename(cert, <a href='../S/2779.html#L517' title='Defined at 517 in Objects/bytesobject.c.'>PyBytes_AsString</a>(filename)) &lt;= 0) <font color='red'>{</font>
<a name='L849'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PySSLErrorObject,
<a name='L850'>                        "Can't open file");
<a name='L851'>        <b>goto</b> fail0;
<a name='L852'>    <font color='red'>}</font>
<a name='L853'>
<a name='L854'>    x = PEM_read_bio_X509_AUX(cert,<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L855'>    <b>if</b> (x == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L856'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PySSLErrorObject,
<a name='L857'>                        "Error decoding PEM-encoded file");
<a name='L858'>        <b>goto</b> fail0;
<a name='L859'>    <font color='red'>}</font>
<a name='L860'>
<a name='L861'>    retval = <a href='../S/2612.html#L703' title='Defined at 703 in Modules/_ssl.c.'>_decode_certificate</a>(x);
<a name='L862'>    X509_free(x);
<a name='L863'>
<a name='L864'>  fail0:
<a name='L865'>    Py_DECREF(filename);
<a name='L866'>    <b>if</b> (cert != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) BIO_free(cert);
<a name='L867'>    <b>return</b> retval;
<a name='L868'><font color='red'>}</font>
<a name='L869'>
<a name='L870'>
<a name='L871'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L872'><a href='../R/3355.html' title='Multiple refered from 2 places.'>PySSL_peercert</a>(PySSLSocket *self, PyObject *args)
<a name='L873'><font color='red'>{</font>
<a name='L874'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *retval = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L875'>    <b>int</b> len;
<a name='L876'>    <b>int</b> verification;
<a name='L877'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *binary_mode = Py_None;
<a name='L878'>
<a name='L879'>    <b>if</b> (!<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "|O:peer_certificate", &amp;binary_mode))
<a name='L880'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L881'>
<a name='L882'>    <b>if</b> (!self-&gt;peer_cert)
<a name='L883'>        <a href='../S/2562.html#L112' title='Defined at 112 in Modules/_elementtree.c.'>Py_RETURN_NONE</a>;
<a name='L884'>
<a name='L885'>    <b>if</b> (<a href='../S/2803.html#L1140' title='Defined at 1140 in Objects/object.c.'>PyObject_IsTrue</a>(binary_mode)) <font color='red'>{</font>
<a name='L886'>        <i><font color='green'>/* return cert in DER-encoded format */</font></i>
<a name='L887'>
<a name='L888'>        <b>unsigned</b> <b>char</b> *bytes_buf = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L889'>
<a name='L890'>        bytes_buf = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L891'>        len = i2d_X509(self-&gt;peer_cert, &amp;bytes_buf);
<a name='L892'>        <b>if</b> (len &lt; 0) <font color='red'>{</font>
<a name='L893'>            <a href='../S/2612.html#L172' title='Defined at 172 in Modules/_ssl.c.'>PySSL_SetError</a>(self, len, __FILE__, __LINE__);
<a name='L894'>            <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L895'>        <font color='red'>}</font>
<a name='L896'>        <i><font color='green'>/* this is actually an immutable bytes sequence */</font></i>
<a name='L897'>        retval = <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>
<a name='L898'>          ((<b>const</b> <b>char</b> *) bytes_buf, len);
<a name='L899'>        OPENSSL_free(bytes_buf);
<a name='L900'>        <b>return</b> retval;
<a name='L901'>
<a name='L902'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L903'>        verification = SSL_CTX_get_verify_mode(SSL_get_SSL_CTX(self-&gt;ssl));
<a name='L904'>        <b>if</b> ((verification &amp; SSL_VERIFY_PEER) == 0)
<a name='L905'>            <b>return</b> <a href='../S/2787.html#L233' title='Defined at 233 in Objects/dictobject.c.'>PyDict_New</a>();
<a name='L906'>        <b>else</b>
<a name='L907'>            <b>return</b> <a href='../S/2612.html#L703' title='Defined at 703 in Modules/_ssl.c.'>_decode_certificate</a>(self-&gt;peer_cert);
<a name='L908'>    <font color='red'>}</font>
<a name='L909'><font color='red'>}</font>
<a name='L910'>
<a name='L911'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(PySSL_peercert_doc,
<a name='L912'>"peer_certificate([der=False]) -&gt; certificate\n\
<a name='L913'>\n\
<a name='L914'>Returns the certificate for the peer.  If no certificate was provided,\n\
<a name='L915'>returns None.  If a certificate was provided, but not validated, returns\n\
<a name='L916'>an empty dictionary.  Otherwise returns a dict containing information\n\
<a name='L917'>about the peer certificate.\n\
<a name='L918'>\n\
<a name='L919'>If the optional argument is True, returns a DER-encoded copy of the\n\
<a name='L920'>peer certificate, or None if no certificate was provided.  This will\n\
<a name='L921'>return the certificate even if it wasn't validated.");
<a name='L922'>
<a name='L923'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *<a href='../R/3353.html' title='Multiple refered from 2 places.'>PySSL_cipher</a> (PySSLSocket *self) <font color='red'>{</font>
<a name='L924'>
<a name='L925'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *retval, *v;
<a name='L926'>    <b>const</b> SSL_CIPHER *current;
<a name='L927'>    <b>char</b> *cipher_name;
<a name='L928'>    <b>char</b> *cipher_protocol;
<a name='L929'>
<a name='L930'>    <b>if</b> (self-&gt;ssl == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L931'>        <a href='../S/2562.html#L112' title='Defined at 112 in Modules/_elementtree.c.'>Py_RETURN_NONE</a>;
<a name='L932'>    current = SSL_get_current_cipher(self-&gt;ssl);
<a name='L933'>    <b>if</b> (current == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L934'>        <a href='../S/2562.html#L112' title='Defined at 112 in Modules/_elementtree.c.'>Py_RETURN_NONE</a>;
<a name='L935'>
<a name='L936'>    retval = <a href='../S/2823.html#L49' title='Defined at 49 in Objects/tupleobject.c.'>PyTuple_New</a>(3);
<a name='L937'>    <b>if</b> (retval == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L938'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L939'>
<a name='L940'>    cipher_name = (<b>char</b> *) SSL_CIPHER_get_name(current);
<a name='L941'>    <b>if</b> (cipher_name == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L942'>        Py_INCREF(Py_None);
<a name='L943'>        PyTuple_SET_ITEM(retval, 0, Py_None);
<a name='L944'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L945'>        v = <a href='../D/4012.html' title='Multiple defined in 3 places.'>PyUnicode_FromString</a>(cipher_name);
<a name='L946'>        <b>if</b> (v == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L947'>            <b>goto</b> fail0;
<a name='L948'>        PyTuple_SET_ITEM(retval, 0, v);
<a name='L949'>    <font color='red'>}</font>
<a name='L950'>    cipher_protocol = SSL_CIPHER_get_version(current);
<a name='L951'>    <b>if</b> (cipher_protocol == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L952'>        Py_INCREF(Py_None);
<a name='L953'>        PyTuple_SET_ITEM(retval, 1, Py_None);
<a name='L954'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L955'>        v = <a href='../D/4012.html' title='Multiple defined in 3 places.'>PyUnicode_FromString</a>(cipher_protocol);
<a name='L956'>        <b>if</b> (v == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L957'>            <b>goto</b> fail0;
<a name='L958'>        PyTuple_SET_ITEM(retval, 1, v);
<a name='L959'>    <font color='red'>}</font>
<a name='L960'>    v = <a href='../S/2799.html#L176' title='Defined at 176 in Objects/longobject.c.'>PyLong_FromLong</a>(SSL_CIPHER_get_bits(current, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>));
<a name='L961'>    <b>if</b> (v == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L962'>        <b>goto</b> fail0;
<a name='L963'>    PyTuple_SET_ITEM(retval, 2, v);
<a name='L964'>    <b>return</b> retval;
<a name='L965'>
<a name='L966'>  fail0:
<a name='L967'>    Py_DECREF(retval);
<a name='L968'>    <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L969'><font color='red'>}</font>
<a name='L970'>
<a name='L971'><b>static</b> <b>void</b> <a href='../S/2612.html#L1404' title='Refered from 1404 in Modules/_ssl.c.'>PySSL_dealloc</a>(PySSLSocket *self)
<a name='L972'><font color='red'>{</font>
<a name='L973'>    <b>if</b> (self-&gt;peer_cert)        <i><font color='green'>/* Possible not to have one? */</font></i>
<a name='L974'>        X509_free (self-&gt;peer_cert);
<a name='L975'>    <b>if</b> (self-&gt;ssl)
<a name='L976'>        SSL_free(self-&gt;ssl);
<a name='L977'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(self-&gt;Socket);
<a name='L978'>    PyObject_Del(self);
<a name='L979'><font color='red'>}</font>
<a name='L980'>
<a name='L981'><i><font color='green'>/* If the socket has a timeout, do a select()/poll() on the socket.</font></i>
<a name='L982'><i><font color='green'>   The argument writing indicates the direction.</font></i>
<a name='L983'><i><font color='green'>   Returns one of the possibilities in the timeout_state enum (above).</font></i>
<a name='L984'><i><font color='green'> */</font></i>
<a name='L985'>
<a name='L986'><b>static</b> <b>int</b>
<a name='L987'><a href='../R/6642.html' title='Multiple refered from 11 places.'>check_socket_and_wait_for_timeout</a>(PySocketSockObject *s, <b>int</b> writing)
<a name='L988'><font color='red'>{</font>
<a name='L989'>    fd_set fds;
<a name='L990'>    <b>struct</b> timeval tv;
<a name='L991'>    <b>int</b> rc;
<a name='L992'>
<a name='L993'>    <i><font color='green'>/* Nothing to do unless we're in timeout mode (not non-blocking) */</font></i>
<a name='L994'>    <b>if</b> (s-&gt;sock_timeout &lt; 0.0)
<a name='L995'>        <b>return</b> <a href='../S/2612.html#L153' title='Defined at 153 in Modules/_ssl.c.'>SOCKET_IS_BLOCKING</a>;
<a name='L996'>    <b>else</b> <b>if</b> (s-&gt;sock_timeout == 0.0)
<a name='L997'>        <b>return</b> <a href='../S/2612.html#L152' title='Defined at 152 in Modules/_ssl.c.'>SOCKET_IS_NONBLOCKING</a>;
<a name='L998'>
<a name='L999'>    <i><font color='green'>/* Guard against closed socket */</font></i>
<a name='L1000'>    <b>if</b> (s-&gt;sock_fd &lt; 0)
<a name='L1001'>        <b>return</b> <a href='../S/2612.html#L155' title='Defined at 155 in Modules/_ssl.c.'>SOCKET_HAS_BEEN_CLOSED</a>;
<a name='L1002'>
<a name='L1003'>    <i><font color='green'>/* Prefer poll, if available, since you can poll() any fd</font></i>
<a name='L1004'><i><font color='green'>     * which can't be done with select(). */</font></i>
<a name='L1005'><font color='darkred'>#ifdef</font> HAVE_POLL
<a name='L1006'>    <font color='red'>{</font>
<a name='L1007'>        <b>struct</b> pollfd pollfd;
<a name='L1008'>        <b>int</b> timeout;
<a name='L1009'>
<a name='L1010'>        pollfd.fd = s-&gt;sock_fd;
<a name='L1011'>        pollfd.events = writing ? POLLOUT : POLLIN;
<a name='L1012'>
<a name='L1013'>        <i><font color='green'>/* s-&gt;sock_timeout is in seconds, timeout in ms */</font></i>
<a name='L1014'>        timeout = (<b>int</b>)(s-&gt;sock_timeout * 1000 + 0.5);
<a name='L1015'>        <a href='../D/3715.html' title='Multiple defined in 2 places.'>PySSL_BEGIN_ALLOW_THREADS</a>
<a name='L1016'>        rc = poll(&amp;pollfd, 1, timeout);
<a name='L1017'>        <a href='../D/3717.html' title='Multiple defined in 2 places.'>PySSL_END_ALLOW_THREADS</a>
<a name='L1018'>
<a name='L1019'>        <b>goto</b> normal_return;
<a name='L1020'>    <font color='red'>}</font>
<a name='L1021'><font color='darkred'>#endif</font>
<a name='L1022'>
<a name='L1023'>    <i><font color='green'>/* Guard against socket too large for select*/</font></i>
<a name='L1024'><font color='darkred'>#ifndef</font> <a href='../S/2906.html#L758' title='Defined at 758 in PC/pyconfig.h.'>Py_SOCKET_FD_CAN_BE_GE_FD_SETSIZE</a>
<a name='L1025'>    <b>if</b> (s-&gt;sock_fd &gt;= <a href='../D/1101.html' title='Multiple defined in 2 places.'>FD_SETSIZE</a>)
<a name='L1026'>        <b>return</b> <a href='../S/2612.html#L156' title='Defined at 156 in Modules/_ssl.c.'>SOCKET_TOO_LARGE_FOR_SELECT</a>;
<a name='L1027'><font color='darkred'>#endif</font>
<a name='L1028'>
<a name='L1029'>    <i><font color='green'>/* Construct the arguments to select */</font></i>
<a name='L1030'>    tv.tv_sec = (<b>int</b>)s-&gt;sock_timeout;
<a name='L1031'>    tv.tv_usec = (<b>int</b>)((s-&gt;sock_timeout - tv.tv_sec) * 1e6);
<a name='L1032'>    FD_ZERO(&amp;fds);
<a name='L1033'>    FD_SET(s-&gt;sock_fd, &amp;fds);
<a name='L1034'>
<a name='L1035'>    <i><font color='green'>/* See if the socket is ready */</font></i>
<a name='L1036'>    <a href='../D/3715.html' title='Multiple defined in 2 places.'>PySSL_BEGIN_ALLOW_THREADS</a>
<a name='L1037'>    <b>if</b> (writing)
<a name='L1038'>        rc = select(s-&gt;sock_fd+1, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, &amp;fds, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, &amp;tv);
<a name='L1039'>    <b>else</b>
<a name='L1040'>        rc = select(s-&gt;sock_fd+1, &amp;fds, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, &amp;tv);
<a name='L1041'>    <a href='../D/3717.html' title='Multiple defined in 2 places.'>PySSL_END_ALLOW_THREADS</a>
<a name='L1042'>
<a name='L1043'><font color='darkred'>#ifdef</font> HAVE_POLL
<a name='L1044'>normal_return:
<a name='L1045'><font color='darkred'>#endif</font>
<a name='L1046'>    <i><font color='green'>/* Return SOCKET_TIMED_OUT on timeout, SOCKET_OPERATION_OK otherwise</font></i>
<a name='L1047'><i><font color='green'>       (when we are able to write or when there's something to read) */</font></i>
<a name='L1048'>    <b>return</b> rc == 0 ? <a href='../S/2612.html#L154' title='Defined at 154 in Modules/_ssl.c.'>SOCKET_HAS_TIMED_OUT</a> : <a href='../S/2612.html#L157' title='Defined at 157 in Modules/_ssl.c.'>SOCKET_OPERATION_OK</a>;
<a name='L1049'><font color='red'>}</font>
<a name='L1050'>
<a name='L1051'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *<a href='../R/3351.html' title='Multiple refered from 2 places.'>PySSL_SSLwrite</a>(PySSLSocket *self, PyObject *args)
<a name='L1052'><font color='red'>{</font>
<a name='L1053'>    <a href='../S/544.html#L163' title='Defined at 163 in Include/object.h.'>Py_buffer</a> buf;
<a name='L1054'>    <b>int</b> len;
<a name='L1055'>    <b>int</b> sockstate;
<a name='L1056'>    <b>int</b> err;
<a name='L1057'>    <b>int</b> nonblocking;
<a name='L1058'>    <a href='../S/2712.html#L143' title='Defined at 143 in Modules/socketmodule.h.'>PySocketSockObject</a> *sock
<a name='L1059'>      = (<a href='../S/2712.html#L143' title='Defined at 143 in Modules/socketmodule.h.'>PySocketSockObject</a> *) <a href='../S/2830.html#L842' title='Defined at 842 in Objects/weakrefobject.c.'>PyWeakref_GetObject</a>(self-&gt;Socket);
<a name='L1060'>
<a name='L1061'>    <b>if</b> (((<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a>*)sock) == Py_None) <font color='red'>{</font>
<a name='L1062'>        <a href='../S/2612.html#L263' title='Defined at 263 in Modules/_ssl.c.'>_setSSLError</a>("Underlying socket connection gone",
<a name='L1063'>                     <a href='../S/2612.html#L50' title='Defined at 50 in Modules/_ssl.c.'>PY_SSL_ERROR_NO_SOCKET</a>, __FILE__, __LINE__);
<a name='L1064'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1065'>    <font color='red'>}</font>
<a name='L1066'>    Py_INCREF(sock);
<a name='L1067'>
<a name='L1068'>    <b>if</b> (!<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "y*:write", &amp;buf)) <font color='red'>{</font>
<a name='L1069'>        Py_DECREF(sock);
<a name='L1070'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1071'>    <font color='red'>}</font>
<a name='L1072'>
<a name='L1073'>    <i><font color='green'>/* just in case the blocking state of the socket has been changed */</font></i>
<a name='L1074'>    nonblocking = (sock-&gt;sock_timeout &gt;= 0.0);
<a name='L1075'>    BIO_set_nbio(SSL_get_rbio(self-&gt;ssl), nonblocking);
<a name='L1076'>    BIO_set_nbio(SSL_get_wbio(self-&gt;ssl), nonblocking);
<a name='L1077'>
<a name='L1078'>    sockstate = <a href='../S/2612.html#L987' title='Defined at 987 in Modules/_ssl.c.'>check_socket_and_wait_for_timeout</a>(sock, 1);
<a name='L1079'>    <b>if</b> (sockstate == <a href='../S/2612.html#L154' title='Defined at 154 in Modules/_ssl.c.'>SOCKET_HAS_TIMED_OUT</a>) <font color='red'>{</font>
<a name='L1080'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PySocketModule.timeout_error,
<a name='L1081'>                        "The write operation timed out");
<a name='L1082'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1083'>    <font color='red'>}</font> <b>else</b> <b>if</b> (sockstate == <a href='../S/2612.html#L155' title='Defined at 155 in Modules/_ssl.c.'>SOCKET_HAS_BEEN_CLOSED</a>) <font color='red'>{</font>
<a name='L1084'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PySSLErrorObject,
<a name='L1085'>                        "Underlying socket has been closed.");
<a name='L1086'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1087'>    <font color='red'>}</font> <b>else</b> <b>if</b> (sockstate == <a href='../S/2612.html#L156' title='Defined at 156 in Modules/_ssl.c.'>SOCKET_TOO_LARGE_FOR_SELECT</a>) <font color='red'>{</font>
<a name='L1088'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PySSLErrorObject,
<a name='L1089'>                        "Underlying socket too large for select().");
<a name='L1090'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1091'>    <font color='red'>}</font>
<a name='L1092'>    <b>do</b> <font color='red'>{</font>
<a name='L1093'>        err = 0;
<a name='L1094'>        <a href='../D/3715.html' title='Multiple defined in 2 places.'>PySSL_BEGIN_ALLOW_THREADS</a>
<a name='L1095'>        len = SSL_write(self-&gt;ssl, buf.buf, buf.len);
<a name='L1096'>        err = SSL_get_error(self-&gt;ssl, len);
<a name='L1097'>        <a href='../D/3717.html' title='Multiple defined in 2 places.'>PySSL_END_ALLOW_THREADS</a>
<a name='L1098'>        <b>if</b> (<a href='../D/3143.html' title='Multiple defined in 2 places.'>PyErr_CheckSignals</a>()) <font color='red'>{</font>
<a name='L1099'>            <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1100'>        <font color='red'>}</font>
<a name='L1101'>        <b>if</b> (err == SSL_ERROR_WANT_READ) <font color='red'>{</font>
<a name='L1102'>            sockstate = <a href='../S/2612.html#L987' title='Defined at 987 in Modules/_ssl.c.'>check_socket_and_wait_for_timeout</a>(sock, 0);
<a name='L1103'>        <font color='red'>}</font> <b>else</b> <b>if</b> (err == SSL_ERROR_WANT_WRITE) <font color='red'>{</font>
<a name='L1104'>            sockstate = <a href='../S/2612.html#L987' title='Defined at 987 in Modules/_ssl.c.'>check_socket_and_wait_for_timeout</a>(sock, 1);
<a name='L1105'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1106'>            sockstate = <a href='../S/2612.html#L157' title='Defined at 157 in Modules/_ssl.c.'>SOCKET_OPERATION_OK</a>;
<a name='L1107'>        <font color='red'>}</font>
<a name='L1108'>        <b>if</b> (sockstate == <a href='../S/2612.html#L154' title='Defined at 154 in Modules/_ssl.c.'>SOCKET_HAS_TIMED_OUT</a>) <font color='red'>{</font>
<a name='L1109'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PySocketModule.timeout_error,
<a name='L1110'>                            "The write operation timed out");
<a name='L1111'>            <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1112'>        <font color='red'>}</font> <b>else</b> <b>if</b> (sockstate == <a href='../S/2612.html#L155' title='Defined at 155 in Modules/_ssl.c.'>SOCKET_HAS_BEEN_CLOSED</a>) <font color='red'>{</font>
<a name='L1113'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PySSLErrorObject,
<a name='L1114'>                            "Underlying socket has been closed.");
<a name='L1115'>            <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1116'>        <font color='red'>}</font> <b>else</b> <b>if</b> (sockstate == <a href='../S/2612.html#L152' title='Defined at 152 in Modules/_ssl.c.'>SOCKET_IS_NONBLOCKING</a>) <font color='red'>{</font>
<a name='L1117'>            <b>break</b>;
<a name='L1118'>        <font color='red'>}</font>
<a name='L1119'>    <font color='red'>}</font> <b>while</b> (err == SSL_ERROR_WANT_READ || err == SSL_ERROR_WANT_WRITE);
<a name='L1120'>
<a name='L1121'>    Py_DECREF(sock);
<a name='L1122'>    <a href='../S/2775.html#L684' title='Defined at 684 in Objects/abstract.c.'>PyBuffer_Release</a>(&amp;buf);
<a name='L1123'>    <b>if</b> (len &gt; 0)
<a name='L1124'>        <b>return</b> <a href='../S/2799.html#L176' title='Defined at 176 in Objects/longobject.c.'>PyLong_FromLong</a>(len);
<a name='L1125'>    <b>else</b>
<a name='L1126'>        <b>return</b> <a href='../S/2612.html#L172' title='Defined at 172 in Modules/_ssl.c.'>PySSL_SetError</a>(self, len, __FILE__, __LINE__);
<a name='L1127'>
<a name='L1128'><a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>:
<a name='L1129'>    Py_DECREF(sock);
<a name='L1130'>    <a href='../S/2775.html#L684' title='Defined at 684 in Objects/abstract.c.'>PyBuffer_Release</a>(&amp;buf);
<a name='L1131'>    <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1132'><font color='red'>}</font>
<a name='L1133'>
<a name='L1134'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(PySSL_SSLwrite_doc,
<a name='L1135'>"write(s) -&gt; len\n\
<a name='L1136'>\n\
<a name='L1137'>Writes the string s into the SSL object.  Returns the number\n\
<a name='L1138'>of bytes written.");
<a name='L1139'>
<a name='L1140'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *<a href='../S/2612.html#L1388' title='Refered from 1388 in Modules/_ssl.c.'>PySSL_SSLpending</a>(PySSLSocket *self)
<a name='L1141'><font color='red'>{</font>
<a name='L1142'>    <b>int</b> count = 0;
<a name='L1143'>
<a name='L1144'>    <a href='../D/3715.html' title='Multiple defined in 2 places.'>PySSL_BEGIN_ALLOW_THREADS</a>
<a name='L1145'>    count = SSL_pending(self-&gt;ssl);
<a name='L1146'>    <a href='../D/3717.html' title='Multiple defined in 2 places.'>PySSL_END_ALLOW_THREADS</a>
<a name='L1147'>    <b>if</b> (count &lt; 0)
<a name='L1148'>        <b>return</b> <a href='../S/2612.html#L172' title='Defined at 172 in Modules/_ssl.c.'>PySSL_SetError</a>(self, count, __FILE__, __LINE__);
<a name='L1149'>    <b>else</b>
<a name='L1150'>        <b>return</b> <a href='../S/2799.html#L176' title='Defined at 176 in Objects/longobject.c.'>PyLong_FromLong</a>(count);
<a name='L1151'><font color='red'>}</font>
<a name='L1152'>
<a name='L1153'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(PySSL_SSLpending_doc,
<a name='L1154'>"pending() -&gt; count\n\
<a name='L1155'>\n\
<a name='L1156'>Returns the number of already decrypted bytes available for read,\n\
<a name='L1157'>pending on the connection.\n");
<a name='L1158'>
<a name='L1159'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *<a href='../R/3349.html' title='Multiple refered from 2 places.'>PySSL_SSLread</a>(PySSLSocket *self, PyObject *args)
<a name='L1160'><font color='red'>{</font>
<a name='L1161'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *dest = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1162'>    <a href='../S/544.html#L163' title='Defined at 163 in Include/object.h.'>Py_buffer</a> buf;
<a name='L1163'>    <b>char</b> *mem;
<a name='L1164'>    <b>int</b> len, count;
<a name='L1165'>    <b>int</b> buf_passed = 0;
<a name='L1166'>    <b>int</b> sockstate;
<a name='L1167'>    <b>int</b> err;
<a name='L1168'>    <b>int</b> nonblocking;
<a name='L1169'>    <a href='../S/2712.html#L143' title='Defined at 143 in Modules/socketmodule.h.'>PySocketSockObject</a> *sock
<a name='L1170'>      = (<a href='../S/2712.html#L143' title='Defined at 143 in Modules/socketmodule.h.'>PySocketSockObject</a> *) <a href='../S/2830.html#L842' title='Defined at 842 in Objects/weakrefobject.c.'>PyWeakref_GetObject</a>(self-&gt;Socket);
<a name='L1171'>
<a name='L1172'>    <b>if</b> (((<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a>*)sock) == Py_None) <font color='red'>{</font>
<a name='L1173'>        <a href='../S/2612.html#L263' title='Defined at 263 in Modules/_ssl.c.'>_setSSLError</a>("Underlying socket connection gone",
<a name='L1174'>                     <a href='../S/2612.html#L50' title='Defined at 50 in Modules/_ssl.c.'>PY_SSL_ERROR_NO_SOCKET</a>, __FILE__, __LINE__);
<a name='L1175'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1176'>    <font color='red'>}</font>
<a name='L1177'>    Py_INCREF(sock);
<a name='L1178'>
<a name='L1179'>    buf.obj = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1180'>    buf.buf = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1181'>    <b>if</b> (!<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "i|w*:read", &amp;len, &amp;buf))
<a name='L1182'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1183'>
<a name='L1184'>    <b>if</b> ((buf.buf == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) &amp;&amp; (buf.obj == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)) <font color='red'>{</font>
<a name='L1185'>        dest = <a href='../S/2779.html#L70' title='Defined at 70 in Objects/bytesobject.c.'>PyBytes_FromStringAndSize</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, len);
<a name='L1186'>        <b>if</b> (dest == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1187'>            <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1188'>        mem = PyBytes_AS_STRING(dest);
<a name='L1189'>    <font color='red'>}</font>
<a name='L1190'>    <b>else</b> <font color='red'>{</font>
<a name='L1191'>        buf_passed = 1;
<a name='L1192'>        mem = buf.buf;
<a name='L1193'>        <b>if</b> (len &lt;= 0 || len &gt; buf.len) <font color='red'>{</font>
<a name='L1194'>            len = (<b>int</b>) buf.len;
<a name='L1195'>            <b>if</b> (buf.len != len) <font color='red'>{</font>
<a name='L1196'>                <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_OverflowError,
<a name='L1197'>                                "maximum length can't fit in a C 'int'");
<a name='L1198'>                <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1199'>            <font color='red'>}</font>
<a name='L1200'>        <font color='red'>}</font>
<a name='L1201'>    <font color='red'>}</font>
<a name='L1202'>
<a name='L1203'>    <i><font color='green'>/* just in case the blocking state of the socket has been changed */</font></i>
<a name='L1204'>    nonblocking = (sock-&gt;sock_timeout &gt;= 0.0);
<a name='L1205'>    BIO_set_nbio(SSL_get_rbio(self-&gt;ssl), nonblocking);
<a name='L1206'>    BIO_set_nbio(SSL_get_wbio(self-&gt;ssl), nonblocking);
<a name='L1207'>
<a name='L1208'>    <i><font color='green'>/* first check if there are bytes ready to be read */</font></i>
<a name='L1209'>    <a href='../D/3715.html' title='Multiple defined in 2 places.'>PySSL_BEGIN_ALLOW_THREADS</a>
<a name='L1210'>    count = SSL_pending(self-&gt;ssl);
<a name='L1211'>    <a href='../D/3717.html' title='Multiple defined in 2 places.'>PySSL_END_ALLOW_THREADS</a>
<a name='L1212'>
<a name='L1213'>    <b>if</b> (!count) <font color='red'>{</font>
<a name='L1214'>        sockstate = <a href='../S/2612.html#L987' title='Defined at 987 in Modules/_ssl.c.'>check_socket_and_wait_for_timeout</a>(sock, 0);
<a name='L1215'>        <b>if</b> (sockstate == <a href='../S/2612.html#L154' title='Defined at 154 in Modules/_ssl.c.'>SOCKET_HAS_TIMED_OUT</a>) <font color='red'>{</font>
<a name='L1216'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PySocketModule.timeout_error,
<a name='L1217'>                            "The read operation timed out");
<a name='L1218'>            <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1219'>        <font color='red'>}</font> <b>else</b> <b>if</b> (sockstate == <a href='../S/2612.html#L156' title='Defined at 156 in Modules/_ssl.c.'>SOCKET_TOO_LARGE_FOR_SELECT</a>) <font color='red'>{</font>
<a name='L1220'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PySSLErrorObject,
<a name='L1221'>                            "Underlying socket too large for select().");
<a name='L1222'>            <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1223'>        <font color='red'>}</font> <b>else</b> <b>if</b> (sockstate == <a href='../S/2612.html#L155' title='Defined at 155 in Modules/_ssl.c.'>SOCKET_HAS_BEEN_CLOSED</a>) <font color='red'>{</font>
<a name='L1224'>            count = 0;
<a name='L1225'>            <b>goto</b> done;
<a name='L1226'>        <font color='red'>}</font>
<a name='L1227'>    <font color='red'>}</font>
<a name='L1228'>    <b>do</b> <font color='red'>{</font>
<a name='L1229'>        err = 0;
<a name='L1230'>        <a href='../D/3715.html' title='Multiple defined in 2 places.'>PySSL_BEGIN_ALLOW_THREADS</a>
<a name='L1231'>        count = SSL_read(self-&gt;ssl, mem, len);
<a name='L1232'>        err = SSL_get_error(self-&gt;ssl, count);
<a name='L1233'>        <a href='../D/3717.html' title='Multiple defined in 2 places.'>PySSL_END_ALLOW_THREADS</a>
<a name='L1234'>        <b>if</b> (<a href='../D/3143.html' title='Multiple defined in 2 places.'>PyErr_CheckSignals</a>())
<a name='L1235'>            <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1236'>        <b>if</b> (err == SSL_ERROR_WANT_READ) <font color='red'>{</font>
<a name='L1237'>            sockstate = <a href='../S/2612.html#L987' title='Defined at 987 in Modules/_ssl.c.'>check_socket_and_wait_for_timeout</a>(sock, 0);
<a name='L1238'>        <font color='red'>}</font> <b>else</b> <b>if</b> (err == SSL_ERROR_WANT_WRITE) <font color='red'>{</font>
<a name='L1239'>            sockstate = <a href='../S/2612.html#L987' title='Defined at 987 in Modules/_ssl.c.'>check_socket_and_wait_for_timeout</a>(sock, 1);
<a name='L1240'>        <font color='red'>}</font> <b>else</b> <b>if</b> ((err == SSL_ERROR_ZERO_RETURN) &amp;&amp;
<a name='L1241'>                   (SSL_get_shutdown(self-&gt;ssl) ==
<a name='L1242'>                    SSL_RECEIVED_SHUTDOWN))
<a name='L1243'>        <font color='red'>{</font>
<a name='L1244'>            count = 0;
<a name='L1245'>            <b>goto</b> done;
<a name='L1246'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1247'>            sockstate = <a href='../S/2612.html#L157' title='Defined at 157 in Modules/_ssl.c.'>SOCKET_OPERATION_OK</a>;
<a name='L1248'>        <font color='red'>}</font>
<a name='L1249'>        <b>if</b> (sockstate == <a href='../S/2612.html#L154' title='Defined at 154 in Modules/_ssl.c.'>SOCKET_HAS_TIMED_OUT</a>) <font color='red'>{</font>
<a name='L1250'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PySocketModule.timeout_error,
<a name='L1251'>                            "The read operation timed out");
<a name='L1252'>            <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1253'>        <font color='red'>}</font> <b>else</b> <b>if</b> (sockstate == <a href='../S/2612.html#L152' title='Defined at 152 in Modules/_ssl.c.'>SOCKET_IS_NONBLOCKING</a>) <font color='red'>{</font>
<a name='L1254'>            <b>break</b>;
<a name='L1255'>        <font color='red'>}</font>
<a name='L1256'>    <font color='red'>}</font> <b>while</b> (err == SSL_ERROR_WANT_READ || err == SSL_ERROR_WANT_WRITE);
<a name='L1257'>    <b>if</b> (count &lt;= 0) <font color='red'>{</font>
<a name='L1258'>        <a href='../S/2612.html#L172' title='Defined at 172 in Modules/_ssl.c.'>PySSL_SetError</a>(self, count, __FILE__, __LINE__);
<a name='L1259'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1260'>    <font color='red'>}</font>
<a name='L1261'>
<a name='L1262'>done:
<a name='L1263'>    Py_DECREF(sock);
<a name='L1264'>    <b>if</b> (!buf_passed) <font color='red'>{</font>
<a name='L1265'>        <a href='../S/2779.html#L2822' title='Defined at 2822 in Objects/bytesobject.c.'>_PyBytes_Resize</a>(&amp;dest, count);
<a name='L1266'>        <b>return</b> dest;
<a name='L1267'>    <font color='red'>}</font>
<a name='L1268'>    <b>else</b> <font color='red'>{</font>
<a name='L1269'>        <a href='../S/2775.html#L684' title='Defined at 684 in Objects/abstract.c.'>PyBuffer_Release</a>(&amp;buf);
<a name='L1270'>        <b>return</b> <a href='../S/2799.html#L176' title='Defined at 176 in Objects/longobject.c.'>PyLong_FromLong</a>(count);
<a name='L1271'>    <font color='red'>}</font>
<a name='L1272'>
<a name='L1273'><a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>:
<a name='L1274'>    Py_DECREF(sock);
<a name='L1275'>    <b>if</b> (!buf_passed)
<a name='L1276'>        <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(dest);
<a name='L1277'>    <b>else</b>
<a name='L1278'>        <a href='../S/2775.html#L684' title='Defined at 684 in Objects/abstract.c.'>PyBuffer_Release</a>(&amp;buf);
<a name='L1279'>    <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1280'><font color='red'>}</font>
<a name='L1281'>
<a name='L1282'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(PySSL_SSLread_doc,
<a name='L1283'>"read([len]) -&gt; string\n\
<a name='L1284'>\n\
<a name='L1285'>Read up to len bytes from the SSL socket.");
<a name='L1286'>
<a name='L1287'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *<a href='../S/2612.html#L1393' title='Refered from 1393 in Modules/_ssl.c.'>PySSL_SSLshutdown</a>(PySSLSocket *self)
<a name='L1288'><font color='red'>{</font>
<a name='L1289'>    <b>int</b> err, ssl_err, sockstate, nonblocking;
<a name='L1290'>    <b>int</b> zeros = 0;
<a name='L1291'>    <a href='../S/2712.html#L143' title='Defined at 143 in Modules/socketmodule.h.'>PySocketSockObject</a> *sock
<a name='L1292'>      = (<a href='../S/2712.html#L143' title='Defined at 143 in Modules/socketmodule.h.'>PySocketSockObject</a> *) <a href='../S/2830.html#L842' title='Defined at 842 in Objects/weakrefobject.c.'>PyWeakref_GetObject</a>(self-&gt;Socket);
<a name='L1293'>
<a name='L1294'>    <i><font color='green'>/* Guard against closed socket */</font></i>
<a name='L1295'>    <b>if</b> ((((<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a>*)sock) == Py_None) || (sock-&gt;sock_fd &lt; 0)) <font color='red'>{</font>
<a name='L1296'>        <a href='../S/2612.html#L263' title='Defined at 263 in Modules/_ssl.c.'>_setSSLError</a>("Underlying socket connection gone",
<a name='L1297'>                     <a href='../S/2612.html#L50' title='Defined at 50 in Modules/_ssl.c.'>PY_SSL_ERROR_NO_SOCKET</a>, __FILE__, __LINE__);
<a name='L1298'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1299'>    <font color='red'>}</font>
<a name='L1300'>    Py_INCREF(sock);
<a name='L1301'>
<a name='L1302'>    <i><font color='green'>/* Just in case the blocking state of the socket has been changed */</font></i>
<a name='L1303'>    nonblocking = (sock-&gt;sock_timeout &gt;= 0.0);
<a name='L1304'>    BIO_set_nbio(SSL_get_rbio(self-&gt;ssl), nonblocking);
<a name='L1305'>    BIO_set_nbio(SSL_get_wbio(self-&gt;ssl), nonblocking);
<a name='L1306'>
<a name='L1307'>    <b>while</b> (1) <font color='red'>{</font>
<a name='L1308'>        <a href='../D/3715.html' title='Multiple defined in 2 places.'>PySSL_BEGIN_ALLOW_THREADS</a>
<a name='L1309'>        <i><font color='green'>/* Disable read-ahead so that unwrap can work correctly.</font></i>
<a name='L1310'><i><font color='green'>         * Otherwise OpenSSL might read in too much data,</font></i>
<a name='L1311'><i><font color='green'>         * eating clear text data that happens to be</font></i>
<a name='L1312'><i><font color='green'>         * transmitted after the SSL shutdown.</font></i>
<a name='L1313'><i><font color='green'>         * Should be safe to call repeatedly everytime this</font></i>
<a name='L1314'><i><font color='green'>         * function is used and the shutdown_seen_zero != 0</font></i>
<a name='L1315'><i><font color='green'>         * condition is met.</font></i>
<a name='L1316'><i><font color='green'>         */</font></i>
<a name='L1317'>        <b>if</b> (self-&gt;shutdown_seen_zero)
<a name='L1318'>            SSL_set_read_ahead(self-&gt;ssl, 0);
<a name='L1319'>        err = SSL_shutdown(self-&gt;ssl);
<a name='L1320'>        <a href='../D/3717.html' title='Multiple defined in 2 places.'>PySSL_END_ALLOW_THREADS</a>
<a name='L1321'>        <i><font color='green'>/* If err == 1, a secure shutdown with SSL_shutdown() is complete */</font></i>
<a name='L1322'>        <b>if</b> (err &gt; 0)
<a name='L1323'>            <b>break</b>;
<a name='L1324'>        <b>if</b> (err == 0) <font color='red'>{</font>
<a name='L1325'>            <i><font color='green'>/* Don't loop endlessly; instead preserve legacy</font></i>
<a name='L1326'><i><font color='green'>               behaviour of trying SSL_shutdown() only twice.</font></i>
<a name='L1327'><i><font color='green'>               This looks necessary for OpenSSL &lt; 0.9.8m */</font></i>
<a name='L1328'>            <b>if</b> (++zeros &gt; 1)
<a name='L1329'>                <b>break</b>;
<a name='L1330'>            <i><font color='green'>/* Shutdown was sent, now try receiving */</font></i>
<a name='L1331'>            self-&gt;shutdown_seen_zero = 1;
<a name='L1332'>            <b>continue</b>;
<a name='L1333'>        <font color='red'>}</font>
<a name='L1334'>
<a name='L1335'>        <i><font color='green'>/* Possibly retry shutdown until timeout or failure */</font></i>
<a name='L1336'>        ssl_err = SSL_get_error(self-&gt;ssl, err);
<a name='L1337'>        <b>if</b> (ssl_err == SSL_ERROR_WANT_READ)
<a name='L1338'>            sockstate = <a href='../S/2612.html#L987' title='Defined at 987 in Modules/_ssl.c.'>check_socket_and_wait_for_timeout</a>(sock, 0);
<a name='L1339'>        <b>else</b> <b>if</b> (ssl_err == SSL_ERROR_WANT_WRITE)
<a name='L1340'>            sockstate = <a href='../S/2612.html#L987' title='Defined at 987 in Modules/_ssl.c.'>check_socket_and_wait_for_timeout</a>(sock, 1);
<a name='L1341'>        <b>else</b>
<a name='L1342'>            <b>break</b>;
<a name='L1343'>        <b>if</b> (sockstate == <a href='../S/2612.html#L154' title='Defined at 154 in Modules/_ssl.c.'>SOCKET_HAS_TIMED_OUT</a>) <font color='red'>{</font>
<a name='L1344'>            <b>if</b> (ssl_err == SSL_ERROR_WANT_READ)
<a name='L1345'>                <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PySocketModule.timeout_error,
<a name='L1346'>                                "The read operation timed out");
<a name='L1347'>            <b>else</b>
<a name='L1348'>                <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PySocketModule.timeout_error,
<a name='L1349'>                                "The write operation timed out");
<a name='L1350'>            <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1351'>        <font color='red'>}</font>
<a name='L1352'>        <b>else</b> <b>if</b> (sockstate == <a href='../S/2612.html#L156' title='Defined at 156 in Modules/_ssl.c.'>SOCKET_TOO_LARGE_FOR_SELECT</a>) <font color='red'>{</font>
<a name='L1353'>            <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PySSLErrorObject,
<a name='L1354'>                            "Underlying socket too large for select().");
<a name='L1355'>            <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1356'>        <font color='red'>}</font>
<a name='L1357'>        <b>else</b> <b>if</b> (sockstate != <a href='../S/2612.html#L157' title='Defined at 157 in Modules/_ssl.c.'>SOCKET_OPERATION_OK</a>)
<a name='L1358'>            <i><font color='green'>/* Retain the SSL error code */</font></i>
<a name='L1359'>            <b>break</b>;
<a name='L1360'>    <font color='red'>}</font>
<a name='L1361'>
<a name='L1362'>    <b>if</b> (err &lt; 0) <font color='red'>{</font>
<a name='L1363'>        Py_DECREF(sock);
<a name='L1364'>        <b>return</b> <a href='../S/2612.html#L172' title='Defined at 172 in Modules/_ssl.c.'>PySSL_SetError</a>(self, err, __FILE__, __LINE__);
<a name='L1365'>    <font color='red'>}</font>
<a name='L1366'>    <b>else</b>
<a name='L1367'>        <i><font color='green'>/* It's already INCREF'ed */</font></i>
<a name='L1368'>        <b>return</b> (<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *) sock;
<a name='L1369'>
<a name='L1370'><a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>:
<a name='L1371'>    Py_DECREF(sock);
<a name='L1372'>    <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1373'><font color='red'>}</font>
<a name='L1374'>
<a name='L1375'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(PySSL_SSLshutdown_doc,
<a name='L1376'>"shutdown(s) -&gt; socket\n\
<a name='L1377'>\n\
<a name='L1378'>Does the SSL shutdown handshake with the remote end, and returns\n\
<a name='L1379'>the underlying socket object.");
<a name='L1380'>
<a name='L1381'>
<a name='L1382'><b>static</b> <a href='../D/3525.html' title='Multiple defined in 3 places.'>PyMethodDef</a> PySSLMethods[] = <font color='red'>{</font>
<a name='L1383'>    <font color='red'>{</font>"do_handshake", (PyCFunction)<a href='../S/2612.html#L335' title='Defined at 335 in Modules/_ssl.c.'>PySSL_SSLdo_handshake</a>, <a href='../S/2858.html#L634' title='Defined at 634 in PC/bdist_wininst/install.c.'>METH_NOARGS</a><font color='red'>}</font>,
<a name='L1384'>    <font color='red'>{</font>"write", (PyCFunction)<a href='../S/2612.html#L1051' title='Defined at 1051 in Modules/_ssl.c.'>PySSL_SSLwrite</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a>,
<a name='L1385'>     PySSL_SSLwrite_doc<font color='red'>}</font>,
<a name='L1386'>    <font color='red'>{</font>"read", (PyCFunction)<a href='../S/2612.html#L1159' title='Defined at 1159 in Modules/_ssl.c.'>PySSL_SSLread</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a>,
<a name='L1387'>     PySSL_SSLread_doc<font color='red'>}</font>,
<a name='L1388'>    <font color='red'>{</font>"pending", (PyCFunction)<a href='../S/2612.html#L1140' title='Defined at 1140 in Modules/_ssl.c.'>PySSL_SSLpending</a>, <a href='../S/2858.html#L634' title='Defined at 634 in PC/bdist_wininst/install.c.'>METH_NOARGS</a>,
<a name='L1389'>     PySSL_SSLpending_doc<font color='red'>}</font>,
<a name='L1390'>    <font color='red'>{</font>"peer_certificate", (PyCFunction)<a href='../S/2612.html#L872' title='Defined at 872 in Modules/_ssl.c.'>PySSL_peercert</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a>,
<a name='L1391'>     PySSL_peercert_doc<font color='red'>}</font>,
<a name='L1392'>    <font color='red'>{</font>"cipher", (PyCFunction)<a href='../S/2612.html#L923' title='Defined at 923 in Modules/_ssl.c.'>PySSL_cipher</a>, <a href='../S/2858.html#L634' title='Defined at 634 in PC/bdist_wininst/install.c.'>METH_NOARGS</a><font color='red'>}</font>,
<a name='L1393'>    <font color='red'>{</font>"shutdown", (PyCFunction)<a href='../S/2612.html#L1287' title='Defined at 1287 in Modules/_ssl.c.'>PySSL_SSLshutdown</a>, <a href='../S/2858.html#L634' title='Defined at 634 in PC/bdist_wininst/install.c.'>METH_NOARGS</a>,
<a name='L1394'>     PySSL_SSLshutdown_doc<font color='red'>}</font>,
<a name='L1395'>    <font color='red'>{</font><a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>
<a name='L1396'><font color='red'>}</font>;
<a name='L1397'>
<a name='L1398'><b>static</b> <a href='../D/3899.html' title='Multiple defined in 3 places.'>PyTypeObject</a> PySSLSocket_Type = <font color='red'>{</font>
<a name='L1399'>    <a href='../D/4042.html' title='Multiple defined in 3 places.'>PyVarObject_HEAD_INIT</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, 0)
<a name='L1400'>    "_ssl._SSLSocket",                  <i><font color='green'>/*tp_name*/</font></i>
<a name='L1401'>    <b>sizeof</b>(<a href='../S/2612.html#L136' title='Defined at 136 in Modules/_ssl.c.'>PySSLSocket</a>),                <i><font color='green'>/*tp_basicsize*/</font></i>
<a name='L1402'>    0,                                  <i><font color='green'>/*tp_itemsize*/</font></i>
<a name='L1403'>    <i><font color='green'>/* methods */</font></i>
<a name='L1404'>    (<a href='../D/8095.html' title='Multiple defined in 2 places.'>destructor</a>)<a href='../S/2612.html#L971' title='Defined at 971 in Modules/_ssl.c.'>PySSL_dealloc</a>,          <i><font color='green'>/*tp_dealloc*/</font></i>
<a name='L1405'>    0,                                  <i><font color='green'>/*tp_print*/</font></i>
<a name='L1406'>    0,                                  <i><font color='green'>/*tp_getattr*/</font></i>
<a name='L1407'>    0,                                  <i><font color='green'>/*tp_setattr*/</font></i>
<a name='L1408'>    0,                                  <i><font color='green'>/*tp_reserved*/</font></i>
<a name='L1409'>    0,                                  <i><font color='green'>/*tp_repr*/</font></i>
<a name='L1410'>    0,                                  <i><font color='green'>/*tp_as_number*/</font></i>
<a name='L1411'>    0,                                  <i><font color='green'>/*tp_as_sequence*/</font></i>
<a name='L1412'>    0,                                  <i><font color='green'>/*tp_as_mapping*/</font></i>
<a name='L1413'>    0,                                  <i><font color='green'>/*tp_hash*/</font></i>
<a name='L1414'>    0,                                  <i><font color='green'>/*tp_call*/</font></i>
<a name='L1415'>    0,                                  <i><font color='green'>/*tp_str*/</font></i>
<a name='L1416'>    0,                                  <i><font color='green'>/*tp_getattro*/</font></i>
<a name='L1417'>    0,                                  <i><font color='green'>/*tp_setattro*/</font></i>
<a name='L1418'>    0,                                  <i><font color='green'>/*tp_as_buffer*/</font></i>
<a name='L1419'>    Py_TPFLAGS_DEFAULT,                 <i><font color='green'>/*tp_flags*/</font></i>
<a name='L1420'>    0,                                  <i><font color='green'>/*tp_doc*/</font></i>
<a name='L1421'>    0,                                  <i><font color='green'>/*tp_traverse*/</font></i>
<a name='L1422'>    0,                                  <i><font color='green'>/*tp_clear*/</font></i>
<a name='L1423'>    0,                                  <i><font color='green'>/*tp_richcompare*/</font></i>
<a name='L1424'>    0,                                  <i><font color='green'>/*tp_weaklistoffset*/</font></i>
<a name='L1425'>    0,                                  <i><font color='green'>/*tp_iter*/</font></i>
<a name='L1426'>    0,                                  <i><font color='green'>/*tp_iternext*/</font></i>
<a name='L1427'>    PySSLMethods,                       <i><font color='green'>/*tp_methods*/</font></i>
<a name='L1428'><font color='red'>}</font>;
<a name='L1429'>
<a name='L1430'>
<a name='L1431'><i><font color='green'>/*</font></i>
<a name='L1432'><i><font color='green'> * _SSLContext objects</font></i>
<a name='L1433'><i><font color='green'> */</font></i>
<a name='L1434'>
<a name='L1435'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1436'><a href='../S/2612.html#L1860' title='Refered from 1860 in Modules/_ssl.c.'>context_new</a>(PyTypeObject *type, PyObject *args, PyObject *kwds)
<a name='L1437'><font color='red'>{</font>
<a name='L1438'>    <b>char</b> *kwlist[] = <font color='red'>{</font>"protocol", <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>;
<a name='L1439'>    <a href='../S/2612.html#L128' title='Defined at 128 in Modules/_ssl.c.'>PySSLContext</a> *self;
<a name='L1440'>    <b>int</b> proto_version = <a href='../S/2612.html#L68' title='Defined at 68 in Modules/_ssl.c.'>PY_SSL_VERSION_SSL23</a>;
<a name='L1441'>    SSL_CTX *ctx = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1442'>
<a name='L1443'>    <b>if</b> (!<a href='../D/2732.html' title='Multiple defined in 2 places.'>PyArg_ParseTupleAndKeywords</a>(
<a name='L1444'>        <a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, kwds, "i:_SSLContext", kwlist,
<a name='L1445'>        &amp;proto_version))
<a name='L1446'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1447'>
<a name='L1448'>    <a href='../D/3715.html' title='Multiple defined in 2 places.'>PySSL_BEGIN_ALLOW_THREADS</a>
<a name='L1449'>    <b>if</b> (proto_version == <a href='../S/2612.html#L69' title='Defined at 69 in Modules/_ssl.c.'>PY_SSL_VERSION_TLS1</a>)
<a name='L1450'>        ctx = SSL_CTX_new(TLSv1_method());
<a name='L1451'>    <b>else</b> <b>if</b> (proto_version == <a href='../S/2612.html#L67' title='Defined at 67 in Modules/_ssl.c.'>PY_SSL_VERSION_SSL3</a>)
<a name='L1452'>        ctx = SSL_CTX_new(SSLv3_method());
<a name='L1453'>    <b>else</b> <b>if</b> (proto_version == <a href='../S/2612.html#L66' title='Defined at 66 in Modules/_ssl.c.'>PY_SSL_VERSION_SSL2</a>)
<a name='L1454'>        ctx = SSL_CTX_new(SSLv2_method());
<a name='L1455'>    <b>else</b> <b>if</b> (proto_version == <a href='../S/2612.html#L68' title='Defined at 68 in Modules/_ssl.c.'>PY_SSL_VERSION_SSL23</a>)
<a name='L1456'>        ctx = SSL_CTX_new(SSLv23_method());
<a name='L1457'>    <b>else</b>
<a name='L1458'>        proto_version = -1;
<a name='L1459'>    <a href='../D/3717.html' title='Multiple defined in 2 places.'>PySSL_END_ALLOW_THREADS</a>
<a name='L1460'>
<a name='L1461'>    <b>if</b> (proto_version == -1) <font color='red'>{</font>
<a name='L1462'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError,
<a name='L1463'>                        "invalid protocol version");
<a name='L1464'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1465'>    <font color='red'>}</font>
<a name='L1466'>    <b>if</b> (ctx == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L1467'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PySSLErrorObject,
<a name='L1468'>                        "failed to allocate SSL context");
<a name='L1469'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1470'>    <font color='red'>}</font>
<a name='L1471'>
<a name='L1472'>    <a href='../D/6814.html' title='Multiple defined in 2 places.'>assert</a>(type != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; type-&gt;tp_alloc != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L1473'>    self = (<a href='../S/2612.html#L128' title='Defined at 128 in Modules/_ssl.c.'>PySSLContext</a> *) type-&gt;tp_alloc(type, 0);
<a name='L1474'>    <b>if</b> (self == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L1475'>        SSL_CTX_free(ctx);
<a name='L1476'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1477'>    <font color='red'>}</font>
<a name='L1478'>    self-&gt;ctx = ctx;
<a name='L1479'>    <i><font color='green'>/* Defaults */</font></i>
<a name='L1480'>    SSL_CTX_set_verify(self-&gt;ctx, SSL_VERIFY_NONE, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L1481'>    SSL_CTX_set_options(self-&gt;ctx, SSL_OP_ALL);
<a name='L1482'>
<a name='L1483'><font color='darkred'>#define</font> <a href='../R/4138.html' title='Multiple refered from 2 places.'>SID_CTX</a> "Python"
<a name='L1484'>    SSL_CTX_set_session_id_context(self-&gt;ctx, (<b>const</b> <b>unsigned</b> <b>char</b> *) <a href='../D/4702.html' title='Multiple defined in 2 places.'>SID_CTX</a>,
<a name='L1485'>                                   <b>sizeof</b>(<a href='../D/4702.html' title='Multiple defined in 2 places.'>SID_CTX</a>));
<a name='L1486'><font color='darkred'>#undef</font> <a href='../R/4138.html' title='Multiple refered from 2 places.'>SID_CTX</a>
<a name='L1487'>
<a name='L1488'>    <b>return</b> (<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *)self;
<a name='L1489'><font color='red'>}</font>
<a name='L1490'>
<a name='L1491'><b>static</b> <b>void</b>
<a name='L1492'><a href='../S/2612.html#L1827' title='Refered from 1827 in Modules/_ssl.c.'>context_dealloc</a>(PySSLContext *self)
<a name='L1493'><font color='red'>{</font>
<a name='L1494'>    SSL_CTX_free(self-&gt;ctx);
<a name='L1495'>    <a href='../D/4259.html' title='Multiple defined in 5 places.'>Py_TYPE</a>(self)-&gt;tp_free(self);
<a name='L1496'><font color='red'>}</font>
<a name='L1497'>
<a name='L1498'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1499'><a href='../S/2612.html#L1809' title='Refered from 1809 in Modules/_ssl.c.'>set_ciphers</a>(PySSLContext *self, PyObject *args)
<a name='L1500'><font color='red'>{</font>
<a name='L1501'>    <b>int</b> ret;
<a name='L1502'>    <b>const</b> <b>char</b> *cipherlist;
<a name='L1503'>
<a name='L1504'>    <b>if</b> (!<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "s:set_ciphers", &amp;cipherlist))
<a name='L1505'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1506'>    ret = SSL_CTX_set_cipher_list(self-&gt;ctx, cipherlist);
<a name='L1507'>    <b>if</b> (ret == 0) <font color='red'>{</font>
<a name='L1508'>        <i><font color='green'>/* Clearing the error queue is necessary on some OpenSSL versions,</font></i>
<a name='L1509'><i><font color='green'>           otherwise the error will be reported again when another SSL call</font></i>
<a name='L1510'><i><font color='green'>           is done. */</font></i>
<a name='L1511'>        ERR_clear_error();
<a name='L1512'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PySSLErrorObject,
<a name='L1513'>                        "No cipher can be selected.");
<a name='L1514'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1515'>    <font color='red'>}</font>
<a name='L1516'>    <a href='../S/2562.html#L112' title='Defined at 112 in Modules/_elementtree.c.'>Py_RETURN_NONE</a>;
<a name='L1517'><font color='red'>}</font>
<a name='L1518'>
<a name='L1519'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1520'><a href='../S/2612.html#L1801' title='Refered from 1801 in Modules/_ssl.c.'>get_verify_mode</a>(PySSLContext *self, <b>void</b> *c)
<a name='L1521'><font color='red'>{</font>
<a name='L1522'>    <b>switch</b> (SSL_CTX_get_verify_mode(self-&gt;ctx)) <font color='red'>{</font>
<a name='L1523'>    <b>case</b> SSL_VERIFY_NONE:
<a name='L1524'>        <b>return</b> <a href='../S/2799.html#L176' title='Defined at 176 in Objects/longobject.c.'>PyLong_FromLong</a>(<a href='../S/2612.html#L60' title='Defined at 60 in Modules/_ssl.c.'>PY_SSL_CERT_NONE</a>);
<a name='L1525'>    <b>case</b> SSL_VERIFY_PEER:
<a name='L1526'>        <b>return</b> <a href='../S/2799.html#L176' title='Defined at 176 in Objects/longobject.c.'>PyLong_FromLong</a>(<a href='../S/2612.html#L61' title='Defined at 61 in Modules/_ssl.c.'>PY_SSL_CERT_OPTIONAL</a>);
<a name='L1527'>    <b>case</b> SSL_VERIFY_PEER | SSL_VERIFY_FAIL_IF_NO_PEER_CERT:
<a name='L1528'>        <b>return</b> <a href='../S/2799.html#L176' title='Defined at 176 in Objects/longobject.c.'>PyLong_FromLong</a>(<a href='../S/2612.html#L62' title='Defined at 62 in Modules/_ssl.c.'>PY_SSL_CERT_REQUIRED</a>);
<a name='L1529'>    <font color='red'>}</font>
<a name='L1530'>    <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PySSLErrorObject,
<a name='L1531'>                    "invalid return value from SSL_CTX_get_verify_mode");
<a name='L1532'>    <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1533'><font color='red'>}</font>
<a name='L1534'>
<a name='L1535'><b>static</b> <b>int</b>
<a name='L1536'><a href='../S/2612.html#L1802' title='Refered from 1802 in Modules/_ssl.c.'>set_verify_mode</a>(PySSLContext *self, PyObject *arg, <b>void</b> *c)
<a name='L1537'><font color='red'>{</font>
<a name='L1538'>    <b>int</b> n, mode;
<a name='L1539'>    <b>if</b> (!<a href='../S/541.html#L15' title='Defined at 15 in Include/modsupport.h.'>PyArg_Parse</a>(<a href='../D/6730.html' title='Multiple defined in 2 places.'>arg</a>, "i", &amp;n))
<a name='L1540'>        <b>return</b> -1;
<a name='L1541'>    <b>if</b> (n == <a href='../S/2612.html#L60' title='Defined at 60 in Modules/_ssl.c.'>PY_SSL_CERT_NONE</a>)
<a name='L1542'>        mode = SSL_VERIFY_NONE;
<a name='L1543'>    <b>else</b> <b>if</b> (n == <a href='../S/2612.html#L61' title='Defined at 61 in Modules/_ssl.c.'>PY_SSL_CERT_OPTIONAL</a>)
<a name='L1544'>        mode = SSL_VERIFY_PEER;
<a name='L1545'>    <b>else</b> <b>if</b> (n == <a href='../S/2612.html#L62' title='Defined at 62 in Modules/_ssl.c.'>PY_SSL_CERT_REQUIRED</a>)
<a name='L1546'>        mode = SSL_VERIFY_PEER | SSL_VERIFY_FAIL_IF_NO_PEER_CERT;
<a name='L1547'>    <b>else</b> <font color='red'>{</font>
<a name='L1548'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError,
<a name='L1549'>                        "invalid value for verify_mode");
<a name='L1550'>        <b>return</b> -1;
<a name='L1551'>    <font color='red'>}</font>
<a name='L1552'>    SSL_CTX_set_verify(self-&gt;ctx, mode, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L1553'>    <b>return</b> 0;
<a name='L1554'><font color='red'>}</font>
<a name='L1555'>
<a name='L1556'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1557'><a href='../S/2612.html#L1799' title='Refered from 1799 in Modules/_ssl.c.'>get_options</a>(PySSLContext *self, <b>void</b> *c)
<a name='L1558'><font color='red'>{</font>
<a name='L1559'>    <b>return</b> <a href='../S/2799.html#L176' title='Defined at 176 in Objects/longobject.c.'>PyLong_FromLong</a>(SSL_CTX_get_options(self-&gt;ctx));
<a name='L1560'><font color='red'>}</font>
<a name='L1561'>
<a name='L1562'><b>static</b> <b>int</b>
<a name='L1563'><a href='../S/2612.html#L1800' title='Refered from 1800 in Modules/_ssl.c.'>set_options</a>(PySSLContext *self, PyObject *arg, <b>void</b> *c)
<a name='L1564'><font color='red'>{</font>
<a name='L1565'>    <b>long</b> new_opts, opts, set, clear;
<a name='L1566'>    <b>if</b> (!<a href='../S/541.html#L15' title='Defined at 15 in Include/modsupport.h.'>PyArg_Parse</a>(<a href='../D/6730.html' title='Multiple defined in 2 places.'>arg</a>, "l", &amp;new_opts))
<a name='L1567'>        <b>return</b> -1;
<a name='L1568'>    opts = SSL_CTX_get_options(self-&gt;ctx);
<a name='L1569'>    clear = opts &amp; ~new_opts;
<a name='L1570'>    set = ~opts &amp; new_opts;
<a name='L1571'>    <b>if</b> (clear) <font color='red'>{</font>
<a name='L1572'><font color='darkred'>#ifdef</font> <a href='../D/1563.html' title='Multiple defined in 2 places.'>HAVE_SSL_CTX_CLEAR_OPTIONS</a>
<a name='L1573'>        SSL_CTX_clear_options(self-&gt;ctx, clear);
<a name='L1574'><font color='darkred'>#else</font>
<a name='L1575'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError,
<a name='L1576'>                        "can't clear options before OpenSSL 0.9.8m");
<a name='L1577'>        <b>return</b> -1;
<a name='L1578'><font color='darkred'>#endif</font>
<a name='L1579'>    <font color='red'>}</font>
<a name='L1580'>    <b>if</b> (set)
<a name='L1581'>        SSL_CTX_set_options(self-&gt;ctx, set);
<a name='L1582'>    <b>return</b> 0;
<a name='L1583'><font color='red'>}</font>
<a name='L1584'>
<a name='L1585'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1586'><a href='../S/2612.html#L1811' title='Refered from 1811 in Modules/_ssl.c.'>load_cert_chain</a>(PySSLContext *self, PyObject *args, PyObject *kwds)
<a name='L1587'><font color='red'>{</font>
<a name='L1588'>    <b>char</b> *kwlist[] = <font color='red'>{</font>"certfile", "keyfile", <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>;
<a name='L1589'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *certfile, *keyfile = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1590'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *certfile_bytes = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, *keyfile_bytes = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1591'>    <b>int</b> r;
<a name='L1592'>
<a name='L1593'>    errno = 0;
<a name='L1594'>    ERR_clear_error();
<a name='L1595'>    <b>if</b> (!<a href='../D/2732.html' title='Multiple defined in 2 places.'>PyArg_ParseTupleAndKeywords</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, kwds,
<a name='L1596'>        "O|O:load_cert_chain", kwlist,
<a name='L1597'>        &amp;certfile, &amp;keyfile))
<a name='L1598'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1599'>    <b>if</b> (keyfile == Py_None)
<a name='L1600'>        keyfile = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1601'>    <b>if</b> (!<a href='../D/4003.html' title='Multiple defined in 3 places.'>PyUnicode_FSConverter</a>(certfile, &amp;certfile_bytes)) <font color='red'>{</font>
<a name='L1602'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_TypeError,
<a name='L1603'>                        "certfile should be a valid filesystem path");
<a name='L1604'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1605'>    <font color='red'>}</font>
<a name='L1606'>    <b>if</b> (keyfile &amp;&amp; !<a href='../D/4003.html' title='Multiple defined in 3 places.'>PyUnicode_FSConverter</a>(keyfile, &amp;keyfile_bytes)) <font color='red'>{</font>
<a name='L1607'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_TypeError,
<a name='L1608'>                        "keyfile should be a valid filesystem path");
<a name='L1609'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1610'>    <font color='red'>}</font>
<a name='L1611'>    <a href='../D/3715.html' title='Multiple defined in 2 places.'>PySSL_BEGIN_ALLOW_THREADS</a>
<a name='L1612'>    r = SSL_CTX_use_certificate_chain_file(self-&gt;ctx,
<a name='L1613'>        PyBytes_AS_STRING(certfile_bytes));
<a name='L1614'>    <a href='../D/3717.html' title='Multiple defined in 2 places.'>PySSL_END_ALLOW_THREADS</a>
<a name='L1615'>    <b>if</b> (r != 1) <font color='red'>{</font>
<a name='L1616'>        <b>if</b> (errno != 0) <font color='red'>{</font>
<a name='L1617'>            ERR_clear_error();
<a name='L1618'>            <a href='../S/3106.html#L452' title='Defined at 452 in Python/errors.c.'>PyErr_SetFromErrno</a>(PyExc_IOError);
<a name='L1619'>        <font color='red'>}</font>
<a name='L1620'>        <b>else</b> <font color='red'>{</font>
<a name='L1621'>            <a href='../S/2612.html#L263' title='Defined at 263 in Modules/_ssl.c.'>_setSSLError</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, 0, __FILE__, __LINE__);
<a name='L1622'>        <font color='red'>}</font>
<a name='L1623'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1624'>    <font color='red'>}</font>
<a name='L1625'>    <a href='../D/3715.html' title='Multiple defined in 2 places.'>PySSL_BEGIN_ALLOW_THREADS</a>
<a name='L1626'>    r = SSL_CTX_use_RSAPrivateKey_file(self-&gt;ctx,
<a name='L1627'>        PyBytes_AS_STRING(keyfile ? keyfile_bytes : certfile_bytes),
<a name='L1628'>        SSL_FILETYPE_PEM);
<a name='L1629'>    <a href='../D/3717.html' title='Multiple defined in 2 places.'>PySSL_END_ALLOW_THREADS</a>
<a name='L1630'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(keyfile_bytes);
<a name='L1631'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(certfile_bytes);
<a name='L1632'>    <b>if</b> (r != 1) <font color='red'>{</font>
<a name='L1633'>        <b>if</b> (errno != 0) <font color='red'>{</font>
<a name='L1634'>            ERR_clear_error();
<a name='L1635'>            <a href='../S/3106.html#L452' title='Defined at 452 in Python/errors.c.'>PyErr_SetFromErrno</a>(PyExc_IOError);
<a name='L1636'>        <font color='red'>}</font>
<a name='L1637'>        <b>else</b> <font color='red'>{</font>
<a name='L1638'>            <a href='../S/2612.html#L263' title='Defined at 263 in Modules/_ssl.c.'>_setSSLError</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, 0, __FILE__, __LINE__);
<a name='L1639'>        <font color='red'>}</font>
<a name='L1640'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1641'>    <font color='red'>}</font>
<a name='L1642'>    <a href='../D/3715.html' title='Multiple defined in 2 places.'>PySSL_BEGIN_ALLOW_THREADS</a>
<a name='L1643'>    r = SSL_CTX_check_private_key(self-&gt;ctx);
<a name='L1644'>    <a href='../D/3717.html' title='Multiple defined in 2 places.'>PySSL_END_ALLOW_THREADS</a>
<a name='L1645'>    <b>if</b> (r != 1) <font color='red'>{</font>
<a name='L1646'>        <a href='../S/2612.html#L263' title='Defined at 263 in Modules/_ssl.c.'>_setSSLError</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, 0, __FILE__, __LINE__);
<a name='L1647'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1648'>    <font color='red'>}</font>
<a name='L1649'>    <a href='../S/2562.html#L112' title='Defined at 112 in Modules/_elementtree.c.'>Py_RETURN_NONE</a>;
<a name='L1650'>
<a name='L1651'><a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>:
<a name='L1652'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(keyfile_bytes);
<a name='L1653'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(certfile_bytes);
<a name='L1654'>    <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1655'><font color='red'>}</font>
<a name='L1656'>
<a name='L1657'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1658'><a href='../S/2612.html#L1813' title='Refered from 1813 in Modules/_ssl.c.'>load_verify_locations</a>(PySSLContext *self, PyObject *args, PyObject *kwds)
<a name='L1659'><font color='red'>{</font>
<a name='L1660'>    <b>char</b> *kwlist[] = <font color='red'>{</font>"cafile", "capath", <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>;
<a name='L1661'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *cafile = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, *capath = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1662'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *cafile_bytes = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, *capath_bytes = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1663'>    <b>const</b> <b>char</b> *cafile_buf = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, *capath_buf = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1664'>    <b>int</b> r;
<a name='L1665'>
<a name='L1666'>    errno = 0;
<a name='L1667'>    <b>if</b> (!<a href='../D/2732.html' title='Multiple defined in 2 places.'>PyArg_ParseTupleAndKeywords</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, kwds,
<a name='L1668'>        "|OO:load_verify_locations", kwlist,
<a name='L1669'>        &amp;cafile, &amp;capath))
<a name='L1670'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1671'>    <b>if</b> (cafile == Py_None)
<a name='L1672'>        cafile = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1673'>    <b>if</b> (capath == Py_None)
<a name='L1674'>        capath = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1675'>    <b>if</b> (cafile == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> &amp;&amp; capath == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L1676'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_TypeError,
<a name='L1677'>                        "cafile and capath cannot be both omitted");
<a name='L1678'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1679'>    <font color='red'>}</font>
<a name='L1680'>    <b>if</b> (cafile &amp;&amp; !<a href='../D/4003.html' title='Multiple defined in 3 places.'>PyUnicode_FSConverter</a>(cafile, &amp;cafile_bytes)) <font color='red'>{</font>
<a name='L1681'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_TypeError,
<a name='L1682'>                        "cafile should be a valid filesystem path");
<a name='L1683'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1684'>    <font color='red'>}</font>
<a name='L1685'>    <b>if</b> (capath &amp;&amp; !<a href='../D/4003.html' title='Multiple defined in 3 places.'>PyUnicode_FSConverter</a>(capath, &amp;capath_bytes)) <font color='red'>{</font>
<a name='L1686'>        <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(cafile_bytes);
<a name='L1687'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_TypeError,
<a name='L1688'>                        "capath should be a valid filesystem path");
<a name='L1689'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1690'>    <font color='red'>}</font>
<a name='L1691'>    <b>if</b> (cafile)
<a name='L1692'>        cafile_buf = PyBytes_AS_STRING(cafile_bytes);
<a name='L1693'>    <b>if</b> (capath)
<a name='L1694'>        capath_buf = PyBytes_AS_STRING(capath_bytes);
<a name='L1695'>    <a href='../D/3715.html' title='Multiple defined in 2 places.'>PySSL_BEGIN_ALLOW_THREADS</a>
<a name='L1696'>    r = SSL_CTX_load_verify_locations(self-&gt;ctx, cafile_buf, capath_buf);
<a name='L1697'>    <a href='../D/3717.html' title='Multiple defined in 2 places.'>PySSL_END_ALLOW_THREADS</a>
<a name='L1698'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(cafile_bytes);
<a name='L1699'>    <a href='../S/544.html#L767' title='Defined at 767 in Include/object.h.'>Py_XDECREF</a>(capath_bytes);
<a name='L1700'>    <b>if</b> (r != 1) <font color='red'>{</font>
<a name='L1701'>        <b>if</b> (errno != 0) <font color='red'>{</font>
<a name='L1702'>            ERR_clear_error();
<a name='L1703'>            <a href='../S/3106.html#L452' title='Defined at 452 in Python/errors.c.'>PyErr_SetFromErrno</a>(PyExc_IOError);
<a name='L1704'>        <font color='red'>}</font>
<a name='L1705'>        <b>else</b> <font color='red'>{</font>
<a name='L1706'>            <a href='../S/2612.html#L263' title='Defined at 263 in Modules/_ssl.c.'>_setSSLError</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, 0, __FILE__, __LINE__);
<a name='L1707'>        <font color='red'>}</font>
<a name='L1708'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1709'>    <font color='red'>}</font>
<a name='L1710'>    <a href='../S/2562.html#L112' title='Defined at 112 in Modules/_elementtree.c.'>Py_RETURN_NONE</a>;
<a name='L1711'><font color='red'>}</font>
<a name='L1712'>
<a name='L1713'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1714'><a href='../S/2612.html#L1807' title='Refered from 1807 in Modules/_ssl.c.'>context_wrap_socket</a>(PySSLContext *self, PyObject *args, PyObject *kwds)
<a name='L1715'><font color='red'>{</font>
<a name='L1716'>    <b>char</b> *kwlist[] = <font color='red'>{</font>"sock", "server_side", "server_hostname", <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>;
<a name='L1717'>    <a href='../S/2712.html#L143' title='Defined at 143 in Modules/socketmodule.h.'>PySocketSockObject</a> *sock;
<a name='L1718'>    <b>int</b> server_side = 0;
<a name='L1719'>    <b>char</b> *hostname = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1720'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *hostname_obj, *res;
<a name='L1721'>
<a name='L1722'>    <i><font color='green'>/* server_hostname is either None (or absent), or to be encoded</font></i>
<a name='L1723'><i><font color='green'>       using the idna encoding. */</font></i>
<a name='L1724'>    <b>if</b> (!<a href='../D/2732.html' title='Multiple defined in 2 places.'>PyArg_ParseTupleAndKeywords</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, kwds, "O!i|O!:_wrap_socket", kwlist,
<a name='L1725'>                                     PySocketModule.Sock_Type,
<a name='L1726'>                                     &amp;sock, &amp;server_side,
<a name='L1727'>                                     <a href='../D/4259.html' title='Multiple defined in 5 places.'>Py_TYPE</a>(Py_None), &amp;hostname_obj)) <font color='red'>{</font>
<a name='L1728'>        <a href='../S/3106.html#L318' title='Defined at 318 in Python/errors.c.'>PyErr_Clear</a>();
<a name='L1729'>        <b>if</b> (!<a href='../D/2732.html' title='Multiple defined in 2 places.'>PyArg_ParseTupleAndKeywords</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, kwds, "O!iet:_wrap_socket", kwlist,
<a name='L1730'>            PySocketModule.Sock_Type,
<a name='L1731'>            &amp;sock, &amp;server_side,
<a name='L1732'>            "idna", &amp;hostname))
<a name='L1733'>            <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1734'><font color='darkred'>#ifndef</font> SSL_CTRL_SET_TLSEXT_HOSTNAME
<a name='L1735'>        <a href='../S/2803.html#L1781' title='Defined at 1781 in Objects/object.c.'>PyMem_Free</a>(hostname);
<a name='L1736'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PyExc_ValueError, "server_hostname is not supported "
<a name='L1737'>                        "by your OpenSSL library");
<a name='L1738'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1739'><font color='darkred'>#endif</font>
<a name='L1740'>    <font color='red'>}</font>
<a name='L1741'>
<a name='L1742'>    res = (<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *) <a href='../S/2612.html#L283' title='Defined at 283 in Modules/_ssl.c.'>newPySSLSocket</a>(self-&gt;ctx, sock, server_side,
<a name='L1743'>                                      hostname);
<a name='L1744'>    <b>if</b> (hostname != <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1745'>        <a href='../S/2803.html#L1781' title='Defined at 1781 in Objects/object.c.'>PyMem_Free</a>(hostname);
<a name='L1746'>    <b>return</b> res;
<a name='L1747'><font color='red'>}</font>
<a name='L1748'>
<a name='L1749'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1750'><a href='../S/2612.html#L1815' title='Refered from 1815 in Modules/_ssl.c.'>session_stats</a>(PySSLContext *self, PyObject *unused)
<a name='L1751'><font color='red'>{</font>
<a name='L1752'>    <b>int</b> r;
<a name='L1753'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *<a href='../S/2252.html#L27' title='Defined at 27 in Modules/_ctypes/ctypes.h.'>value</a>, *stats = <a href='../S/2787.html#L233' title='Defined at 233 in Objects/dictobject.c.'>PyDict_New</a>();
<a name='L1754'>    <b>if</b> (!stats)
<a name='L1755'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1756'>
<a name='L1757'><font color='darkred'>#define</font> <a href='../R/29.html' title='Multiple refered from 12 places.'>ADD_STATS</a>(SSL_NAME, KEY_NAME) \
<a name='L1758'>    <a href='../S/2252.html#L27' title='Defined at 27 in Modules/_ctypes/ctypes.h.'>value</a> = <a href='../S/2799.html#L176' title='Defined at 176 in Objects/longobject.c.'>PyLong_FromLong</a>(SSL_CTX_sess_ ## SSL_NAME (self-&gt;ctx)); \
<a name='L1759'>    <b>if</b> (<a href='../S/2252.html#L27' title='Defined at 27 in Modules/_ctypes/ctypes.h.'>value</a> == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) \
<a name='L1760'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>; \
<a name='L1761'>    r = <a href='../S/2787.html#L2180' title='Defined at 2180 in Objects/dictobject.c.'>PyDict_SetItemString</a>(stats, KEY_NAME, <a href='../S/2252.html#L27' title='Defined at 27 in Modules/_ctypes/ctypes.h.'>value</a>); \
<a name='L1762'>    Py_DECREF(<a href='../S/2252.html#L27' title='Defined at 27 in Modules/_ctypes/ctypes.h.'>value</a>); \
<a name='L1763'>    <b>if</b> (r &lt; 0) \
<a name='L1764'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L1765'>
<a name='L1766'>    <a href='../D/39.html' title='Multiple defined in 2 places.'>ADD_STATS</a>(number, "number");
<a name='L1767'>    <a href='../D/39.html' title='Multiple defined in 2 places.'>ADD_STATS</a>(connect, "connect");
<a name='L1768'>    <a href='../D/39.html' title='Multiple defined in 2 places.'>ADD_STATS</a>(connect_good, "connect_good");
<a name='L1769'>    <a href='../D/39.html' title='Multiple defined in 2 places.'>ADD_STATS</a>(connect_renegotiate, "connect_renegotiate");
<a name='L1770'>    <a href='../D/39.html' title='Multiple defined in 2 places.'>ADD_STATS</a>(accept, "accept");
<a name='L1771'>    <a href='../D/39.html' title='Multiple defined in 2 places.'>ADD_STATS</a>(accept_good, "accept_good");
<a name='L1772'>    <a href='../D/39.html' title='Multiple defined in 2 places.'>ADD_STATS</a>(accept_renegotiate, "accept_renegotiate");
<a name='L1773'>    <a href='../D/39.html' title='Multiple defined in 2 places.'>ADD_STATS</a>(accept, "accept");
<a name='L1774'>    <a href='../D/39.html' title='Multiple defined in 2 places.'>ADD_STATS</a>(hits, "hits");
<a name='L1775'>    <a href='../D/39.html' title='Multiple defined in 2 places.'>ADD_STATS</a>(misses, "misses");
<a name='L1776'>    <a href='../D/39.html' title='Multiple defined in 2 places.'>ADD_STATS</a>(timeouts, "timeouts");
<a name='L1777'>    <a href='../D/39.html' title='Multiple defined in 2 places.'>ADD_STATS</a>(cache_full, "cache_full");
<a name='L1778'>
<a name='L1779'><font color='darkred'>#undef</font> <a href='../R/29.html' title='Multiple refered from 12 places.'>ADD_STATS</a>
<a name='L1780'>
<a name='L1781'>    <b>return</b> stats;
<a name='L1782'>
<a name='L1783'><a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>:
<a name='L1784'>    Py_DECREF(stats);
<a name='L1785'>    <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1786'><font color='red'>}</font>
<a name='L1787'>
<a name='L1788'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1789'><a href='../S/2612.html#L1817' title='Refered from 1817 in Modules/_ssl.c.'>set_default_verify_paths</a>(PySSLContext *self, PyObject *unused)
<a name='L1790'><font color='red'>{</font>
<a name='L1791'>    <b>if</b> (!SSL_CTX_set_default_verify_paths(self-&gt;ctx)) <font color='red'>{</font>
<a name='L1792'>        <a href='../S/2612.html#L263' title='Defined at 263 in Modules/_ssl.c.'>_setSSLError</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, 0, __FILE__, __LINE__);
<a name='L1793'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1794'>    <font color='red'>}</font>
<a name='L1795'>    <a href='../S/2562.html#L112' title='Defined at 112 in Modules/_elementtree.c.'>Py_RETURN_NONE</a>;
<a name='L1796'><font color='red'>}</font>
<a name='L1797'>
<a name='L1798'><b>static</b> <a href='../D/3272.html' title='Multiple defined in 2 places.'>PyGetSetDef</a> context_getsetlist[] = <font color='red'>{</font>
<a name='L1799'>    <font color='red'>{</font>"options", (getter) <a href='../S/2612.html#L1557' title='Defined at 1557 in Modules/_ssl.c.'>get_options</a>,
<a name='L1800'>                (setter) <a href='../S/2612.html#L1563' title='Defined at 1563 in Modules/_ssl.c.'>set_options</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>,
<a name='L1801'>    <font color='red'>{</font>"verify_mode", (getter) <a href='../S/2612.html#L1520' title='Defined at 1520 in Modules/_ssl.c.'>get_verify_mode</a>,
<a name='L1802'>                    (setter) <a href='../S/2612.html#L1536' title='Defined at 1536 in Modules/_ssl.c.'>set_verify_mode</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>,
<a name='L1803'>    <font color='red'>{</font><a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>,            <i><font color='green'>/* sentinel */</font></i>
<a name='L1804'><font color='red'>}</font>;
<a name='L1805'>
<a name='L1806'><b>static</b> <b>struct</b> <a href='../D/3525.html' title='Multiple defined in 3 places.'>PyMethodDef</a> context_methods[] = <font color='red'>{</font>
<a name='L1807'>    <font color='red'>{</font>"_wrap_socket", (PyCFunction) <a href='../S/2612.html#L1714' title='Defined at 1714 in Modules/_ssl.c.'>context_wrap_socket</a>,
<a name='L1808'>                       <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a> | METH_KEYWORDS, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>,
<a name='L1809'>    <font color='red'>{</font>"set_ciphers", (PyCFunction) <a href='../S/2612.html#L1499' title='Defined at 1499 in Modules/_ssl.c.'>set_ciphers</a>,
<a name='L1810'>                    <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>,
<a name='L1811'>    <font color='red'>{</font>"load_cert_chain", (PyCFunction) <a href='../S/2612.html#L1586' title='Defined at 1586 in Modules/_ssl.c.'>load_cert_chain</a>,
<a name='L1812'>                        <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a> | METH_KEYWORDS, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>,
<a name='L1813'>    <font color='red'>{</font>"load_verify_locations", (PyCFunction) <a href='../S/2612.html#L1658' title='Defined at 1658 in Modules/_ssl.c.'>load_verify_locations</a>,
<a name='L1814'>                              <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a> | METH_KEYWORDS, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>,
<a name='L1815'>    <font color='red'>{</font>"session_stats", (PyCFunction) <a href='../S/2612.html#L1750' title='Defined at 1750 in Modules/_ssl.c.'>session_stats</a>,
<a name='L1816'>                      <a href='../S/2858.html#L634' title='Defined at 634 in PC/bdist_wininst/install.c.'>METH_NOARGS</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>,
<a name='L1817'>    <font color='red'>{</font>"set_default_verify_paths", (PyCFunction) <a href='../S/2612.html#L1789' title='Defined at 1789 in Modules/_ssl.c.'>set_default_verify_paths</a>,
<a name='L1818'>                                 <a href='../S/2858.html#L634' title='Defined at 634 in PC/bdist_wininst/install.c.'>METH_NOARGS</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>,
<a name='L1819'>    <font color='red'>{</font><a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>        <i><font color='green'>/* sentinel */</font></i>
<a name='L1820'><font color='red'>}</font>;
<a name='L1821'>
<a name='L1822'><b>static</b> <a href='../D/3899.html' title='Multiple defined in 3 places.'>PyTypeObject</a> PySSLContext_Type = <font color='red'>{</font>
<a name='L1823'>    <a href='../D/4042.html' title='Multiple defined in 3 places.'>PyVarObject_HEAD_INIT</a>(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, 0)
<a name='L1824'>    "_ssl._SSLContext",                        <i><font color='green'>/*tp_name*/</font></i>
<a name='L1825'>    <b>sizeof</b>(<a href='../S/2612.html#L128' title='Defined at 128 in Modules/_ssl.c.'>PySSLContext</a>),                      <i><font color='green'>/*tp_basicsize*/</font></i>
<a name='L1826'>    0,                                         <i><font color='green'>/*tp_itemsize*/</font></i>
<a name='L1827'>    (<a href='../D/8095.html' title='Multiple defined in 2 places.'>destructor</a>)<a href='../S/2612.html#L1492' title='Defined at 1492 in Modules/_ssl.c.'>context_dealloc</a>,               <i><font color='green'>/*tp_dealloc*/</font></i>
<a name='L1828'>    0,                                         <i><font color='green'>/*tp_print*/</font></i>
<a name='L1829'>    0,                                         <i><font color='green'>/*tp_getattr*/</font></i>
<a name='L1830'>    0,                                         <i><font color='green'>/*tp_setattr*/</font></i>
<a name='L1831'>    0,                                         <i><font color='green'>/*tp_reserved*/</font></i>
<a name='L1832'>    0,                                         <i><font color='green'>/*tp_repr*/</font></i>
<a name='L1833'>    0,                                         <i><font color='green'>/*tp_as_number*/</font></i>
<a name='L1834'>    0,                                         <i><font color='green'>/*tp_as_sequence*/</font></i>
<a name='L1835'>    0,                                         <i><font color='green'>/*tp_as_mapping*/</font></i>
<a name='L1836'>    0,                                         <i><font color='green'>/*tp_hash*/</font></i>
<a name='L1837'>    0,                                         <i><font color='green'>/*tp_call*/</font></i>
<a name='L1838'>    0,                                         <i><font color='green'>/*tp_str*/</font></i>
<a name='L1839'>    0,                                         <i><font color='green'>/*tp_getattro*/</font></i>
<a name='L1840'>    0,                                         <i><font color='green'>/*tp_setattro*/</font></i>
<a name='L1841'>    0,                                         <i><font color='green'>/*tp_as_buffer*/</font></i>
<a name='L1842'>    Py_TPFLAGS_DEFAULT | Py_TPFLAGS_BASETYPE,  <i><font color='green'>/*tp_flags*/</font></i>
<a name='L1843'>    0,                                         <i><font color='green'>/*tp_doc*/</font></i>
<a name='L1844'>    0,                                         <i><font color='green'>/*tp_traverse*/</font></i>
<a name='L1845'>    0,                                         <i><font color='green'>/*tp_clear*/</font></i>
<a name='L1846'>    0,                                         <i><font color='green'>/*tp_richcompare*/</font></i>
<a name='L1847'>    0,                                         <i><font color='green'>/*tp_weaklistoffset*/</font></i>
<a name='L1848'>    0,                                         <i><font color='green'>/*tp_iter*/</font></i>
<a name='L1849'>    0,                                         <i><font color='green'>/*tp_iternext*/</font></i>
<a name='L1850'>    context_methods,                           <i><font color='green'>/*tp_methods*/</font></i>
<a name='L1851'>    0,                                         <i><font color='green'>/*tp_members*/</font></i>
<a name='L1852'>    context_getsetlist,                        <i><font color='green'>/*tp_getset*/</font></i>
<a name='L1853'>    0,                                         <i><font color='green'>/*tp_base*/</font></i>
<a name='L1854'>    0,                                         <i><font color='green'>/*tp_dict*/</font></i>
<a name='L1855'>    0,                                         <i><font color='green'>/*tp_descr_get*/</font></i>
<a name='L1856'>    0,                                         <i><font color='green'>/*tp_descr_set*/</font></i>
<a name='L1857'>    0,                                         <i><font color='green'>/*tp_dictoffset*/</font></i>
<a name='L1858'>    0,                                         <i><font color='green'>/*tp_init*/</font></i>
<a name='L1859'>    0,                                         <i><font color='green'>/*tp_alloc*/</font></i>
<a name='L1860'>    <a href='../S/2612.html#L1436' title='Defined at 1436 in Modules/_ssl.c.'>context_new</a>,                               <i><font color='green'>/*tp_new*/</font></i>
<a name='L1861'><font color='red'>}</font>;
<a name='L1862'>
<a name='L1863'>
<a name='L1864'>
<a name='L1865'><font color='darkred'>#ifdef</font> <a href='../D/1542.html' title='Multiple defined in 2 places.'>HAVE_OPENSSL_RAND</a>
<a name='L1866'>
<a name='L1867'><i><font color='green'>/* helper routines for seeding the SSL PRNG */</font></i>
<a name='L1868'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1869'><a href='../S/2612.html#L1939' title='Refered from 1939 in Modules/_ssl.c.'>PySSL_RAND_add</a>(PyObject *self, PyObject *args)
<a name='L1870'><font color='red'>{</font>
<a name='L1871'>    <b>char</b> *buf;
<a name='L1872'>    <b>int</b> len;
<a name='L1873'>    <b>double</b> entropy;
<a name='L1874'>
<a name='L1875'>    <b>if</b> (!<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "s#d:RAND_add", &amp;buf, &amp;len, &amp;entropy))
<a name='L1876'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1877'>    RAND_add(buf, len, entropy);
<a name='L1878'>    Py_INCREF(Py_None);
<a name='L1879'>    <b>return</b> Py_None;
<a name='L1880'><font color='red'>}</font>
<a name='L1881'>
<a name='L1882'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(PySSL_RAND_add_doc,
<a name='L1883'>"RAND_add(string, entropy)\n\
<a name='L1884'>\n\
<a name='L1885'>Mix string into the OpenSSL PRNG state.  entropy (a float) is a lower\n\
<a name='L1886'>bound on the entropy contained in string.  See RFC 1750.");
<a name='L1887'>
<a name='L1888'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1889'><a href='../S/2612.html#L1943' title='Refered from 1943 in Modules/_ssl.c.'>PySSL_RAND_status</a>(PyObject *self)
<a name='L1890'><font color='red'>{</font>
<a name='L1891'>    <b>return</b> <a href='../S/2799.html#L176' title='Defined at 176 in Objects/longobject.c.'>PyLong_FromLong</a>(RAND_status());
<a name='L1892'><font color='red'>}</font>
<a name='L1893'>
<a name='L1894'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(PySSL_RAND_status_doc,
<a name='L1895'>"RAND_status() -&gt; 0 or 1\n\
<a name='L1896'>\n\
<a name='L1897'>Returns 1 if the OpenSSL PRNG has been seeded with enough data and 0 if not.\n\
<a name='L1898'>It is necessary to seed the PRNG with RAND_add() on some platforms before\n\
<a name='L1899'>using the ssl() function.");
<a name='L1900'>
<a name='L1901'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *
<a name='L1902'><a href='../S/2612.html#L1941' title='Refered from 1941 in Modules/_ssl.c.'>PySSL_RAND_egd</a>(PyObject *self, PyObject *args)
<a name='L1903'><font color='red'>{</font>
<a name='L1904'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *path;
<a name='L1905'>    <b>int</b> <a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>;
<a name='L1906'>
<a name='L1907'>    <b>if</b> (!<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "O&amp;|i:RAND_egd",
<a name='L1908'>                          <a href='../D/4003.html' title='Multiple defined in 3 places.'>PyUnicode_FSConverter</a>, &amp;path))
<a name='L1909'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1910'>
<a name='L1911'>    <a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> = RAND_egd(<a href='../S/2779.html#L517' title='Defined at 517 in Objects/bytesobject.c.'>PyBytes_AsString</a>(path));
<a name='L1912'>    Py_DECREF(path);
<a name='L1913'>    <b>if</b> (<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a> == -1) <font color='red'>{</font>
<a name='L1914'>        <a href='../S/3106.html#L122' title='Defined at 122 in Python/errors.c.'>PyErr_SetString</a>(PySSLErrorObject,
<a name='L1915'>                        "EGD connection failed or EGD did not return "
<a name='L1916'>                        "enough data to seed the PRNG");
<a name='L1917'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1918'>    <font color='red'>}</font>
<a name='L1919'>    <b>return</b> <a href='../S/2799.html#L176' title='Defined at 176 in Objects/longobject.c.'>PyLong_FromLong</a>(<a href='../D/7205.html' title='Multiple defined in 2 places.'>bytes</a>);
<a name='L1920'><font color='red'>}</font>
<a name='L1921'>
<a name='L1922'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(PySSL_RAND_egd_doc,
<a name='L1923'>"RAND_egd(path) -&gt; bytes\n\
<a name='L1924'>\n\
<a name='L1925'>Queries the entropy gather daemon (EGD) on the socket named by 'path'.\n\
<a name='L1926'>Returns number of bytes read.  Raises SSLError if connection to EGD\n\
<a name='L1927'>fails or if it does provide enough data to seed PRNG.");
<a name='L1928'>
<a name='L1929'><font color='darkred'>#endif</font>
<a name='L1930'>
<a name='L1931'>
<a name='L1932'>
<a name='L1933'><i><font color='green'>/* List of functions exported by this module. */</font></i>
<a name='L1934'>
<a name='L1935'><b>static</b> <a href='../D/3525.html' title='Multiple defined in 3 places.'>PyMethodDef</a> PySSL_methods[] = <font color='red'>{</font>
<a name='L1936'>    <font color='red'>{</font>"_test_decode_cert",       <a href='../S/2612.html#L831' title='Defined at 831 in Modules/_ssl.c.'>PySSL_test_decode_certificate</a>,
<a name='L1937'>     <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a><font color='red'>}</font>,
<a name='L1938'><font color='darkred'>#ifdef</font> <a href='../D/1542.html' title='Multiple defined in 2 places.'>HAVE_OPENSSL_RAND</a>
<a name='L1939'>    <font color='red'>{</font>"RAND_add",            <a href='../S/2612.html#L1869' title='Defined at 1869 in Modules/_ssl.c.'>PySSL_RAND_add</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a>,
<a name='L1940'>     PySSL_RAND_add_doc<font color='red'>}</font>,
<a name='L1941'>    <font color='red'>{</font>"RAND_egd",            <a href='../S/2612.html#L1902' title='Defined at 1902 in Modules/_ssl.c.'>PySSL_RAND_egd</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a>,
<a name='L1942'>     PySSL_RAND_egd_doc<font color='red'>}</font>,
<a name='L1943'>    <font color='red'>{</font>"RAND_status",         (PyCFunction)<a href='../S/2612.html#L1889' title='Defined at 1889 in Modules/_ssl.c.'>PySSL_RAND_status</a>, <a href='../S/2858.html#L634' title='Defined at 634 in PC/bdist_wininst/install.c.'>METH_NOARGS</a>,
<a name='L1944'>     PySSL_RAND_status_doc<font color='red'>}</font>,
<a name='L1945'><font color='darkred'>#endif</font>
<a name='L1946'>    <font color='red'>{</font><a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,                  <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>            <i><font color='green'>/* Sentinel */</font></i>
<a name='L1947'><font color='red'>}</font>;
<a name='L1948'>
<a name='L1949'>
<a name='L1950'><font color='darkred'>#ifdef</font> <a href='../D/5537.html' title='Multiple defined in 3 places.'>WITH_THREAD</a>
<a name='L1951'>
<a name='L1952'><i><font color='green'>/* an implementation of OpenSSL threading operations in terms</font></i>
<a name='L1953'><i><font color='green'>   of the Python C thread library */</font></i>
<a name='L1954'>
<a name='L1955'><b>static</b> <a href='../S/572.html#L5' title='Defined at 5 in Include/pythread.h.'>PyThread_type_lock</a> *_ssl_locks = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1956'>
<a name='L1957'><b>static</b> <b>unsigned</b> <b>long</b> <a href='../S/2612.html#L2012' title='Refered from 2012 in Modules/_ssl.c.'>_ssl_thread_id_function</a> (<b>void</b>) <font color='red'>{</font>
<a name='L1958'>    <b>return</b> <a href='../D/3856.html' title='Multiple defined in 10 places.'>PyThread_get_thread_ident</a>();
<a name='L1959'><font color='red'>}</font>
<a name='L1960'>
<a name='L1961'><b>static</b> <b>void</b> <a href='../S/2612.html#L2011' title='Refered from 2011 in Modules/_ssl.c.'>_ssl_thread_locking_function</a>
<a name='L1962'>    (<b>int</b> mode, <b>int</b> n, <b>const</b> <b>char</b> *file, <b>int</b> line) <font color='red'>{</font>
<a name='L1963'>    <i><font color='green'>/* this function is needed to perform locking on shared data</font></i>
<a name='L1964'><i><font color='green'>       structures. (Note that OpenSSL uses a number of global data</font></i>
<a name='L1965'><i><font color='green'>       structures that will be implicitly shared whenever multiple</font></i>
<a name='L1966'><i><font color='green'>       threads use OpenSSL.) Multi-threaded applications will</font></i>
<a name='L1967'><i><font color='green'>       crash at random if it is not set.</font></i>
<a name='L1968'><i><font color='green'></font></i>
<a name='L1969'><i><font color='green'>       locking_function() must be able to handle up to</font></i>
<a name='L1970'><i><font color='green'>       CRYPTO_num_locks() different mutex locks. It sets the n-th</font></i>
<a name='L1971'><i><font color='green'>       lock if mode &amp; CRYPTO_LOCK, and releases it otherwise.</font></i>
<a name='L1972'><i><font color='green'></font></i>
<a name='L1973'><i><font color='green'>       file and line are the file number of the function setting the</font></i>
<a name='L1974'><i><font color='green'>       lock. They can be useful for debugging.</font></i>
<a name='L1975'><i><font color='green'>    */</font></i>
<a name='L1976'>
<a name='L1977'>    <b>if</b> ((_ssl_locks == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) ||
<a name='L1978'>        (n &lt; 0) || ((<b>unsigned</b>)n &gt;= _ssl_locks_count))
<a name='L1979'>        <b>return</b>;
<a name='L1980'>
<a name='L1981'>    <b>if</b> (mode &amp; CRYPTO_LOCK) <font color='red'>{</font>
<a name='L1982'>        <a href='../D/3846.html' title='Multiple defined in 10 places.'>PyThread_acquire_lock</a>(_ssl_locks[n], 1);
<a name='L1983'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1984'>        <a href='../D/3858.html' title='Multiple defined in 11 places.'>PyThread_release_lock</a>(_ssl_locks[n]);
<a name='L1985'>    <font color='red'>}</font>
<a name='L1986'><font color='red'>}</font>
<a name='L1987'>
<a name='L1988'><b>static</b> <b>int</b> <a href='../S/2612.html#L2065' title='Refered from 2065 in Modules/_ssl.c.'>_setup_ssl_threads</a>(<b>void</b>) <font color='red'>{</font>
<a name='L1989'>
<a name='L1990'>    <b>unsigned</b> <b>int</b> i;
<a name='L1991'>
<a name='L1992'>    <b>if</b> (_ssl_locks == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L1993'>        _ssl_locks_count = CRYPTO_num_locks();
<a name='L1994'>        _ssl_locks = (<a href='../S/572.html#L5' title='Defined at 5 in Include/pythread.h.'>PyThread_type_lock</a> *)
<a name='L1995'>            malloc(<b>sizeof</b>(<a href='../S/572.html#L5' title='Defined at 5 in Include/pythread.h.'>PyThread_type_lock</a>) * _ssl_locks_count);
<a name='L1996'>        <b>if</b> (_ssl_locks == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L1997'>            <b>return</b> 0;
<a name='L1998'>        memset(_ssl_locks, 0,
<a name='L1999'>               <b>sizeof</b>(<a href='../S/572.html#L5' title='Defined at 5 in Include/pythread.h.'>PyThread_type_lock</a>) * _ssl_locks_count);
<a name='L2000'>        <b>for</b> (i = 0;  i &lt; _ssl_locks_count;  i++) <font color='red'>{</font>
<a name='L2001'>            _ssl_locks[i] = <a href='../D/3848.html' title='Multiple defined in 11 places.'>PyThread_allocate_lock</a>();
<a name='L2002'>            <b>if</b> (_ssl_locks[i] == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>) <font color='red'>{</font>
<a name='L2003'>                <b>unsigned</b> <b>int</b> j;
<a name='L2004'>                <b>for</b> (j = 0;  j &lt; i;  j++) <font color='red'>{</font>
<a name='L2005'>                    <a href='../D/3853.html' title='Multiple defined in 11 places.'>PyThread_free_lock</a>(_ssl_locks[j]);
<a name='L2006'>                <font color='red'>}</font>
<a name='L2007'>                free(_ssl_locks);
<a name='L2008'>                <b>return</b> 0;
<a name='L2009'>            <font color='red'>}</font>
<a name='L2010'>        <font color='red'>}</font>
<a name='L2011'>        CRYPTO_set_locking_callback(<a href='../S/2612.html#L1961' title='Defined at 1961 in Modules/_ssl.c.'>_ssl_thread_locking_function</a>);
<a name='L2012'>        CRYPTO_set_id_callback(<a href='../S/2612.html#L1957' title='Defined at 1957 in Modules/_ssl.c.'>_ssl_thread_id_function</a>);
<a name='L2013'>    <font color='red'>}</font>
<a name='L2014'>    <b>return</b> 1;
<a name='L2015'><font color='red'>}</font>
<a name='L2016'>
<a name='L2017'><font color='darkred'>#endif</font>  <i><font color='green'>/* def HAVE_THREAD */</font></i>
<a name='L2018'>
<a name='L2019'><a href='../D/3131.html' title='Multiple defined in 2 places.'>PyDoc_STRVAR</a>(module_doc,
<a name='L2020'>"Implementation module for SSL socket operations.  See the socket module\n\
<a name='L2021'>for documentation.");
<a name='L2022'>
<a name='L2023'>
<a name='L2024'><b>static</b> <b>struct</b> <a href='../D/3534.html' title='Multiple defined in 2 places.'>PyModuleDef</a> _sslmodule = <font color='red'>{</font>
<a name='L2025'>    <a href='../S/542.html#L33' title='Defined at 33 in Include/moduleobject.h.'>PyModuleDef_HEAD_INIT</a>,
<a name='L2026'>    "_ssl",
<a name='L2027'>    module_doc,
<a name='L2028'>    -1,
<a name='L2029'>    PySSL_methods,
<a name='L2030'>    <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L2031'>    <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L2032'>    <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L2033'>    <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>
<a name='L2034'><font color='red'>}</font>;
<a name='L2035'>
<a name='L2036'><a href='../D/3482.html' title='Multiple defined in 10 places.'>PyMODINIT_FUNC</a>
<a name='L2037'>PyInit__ssl(<b>void</b>)
<a name='L2038'><font color='red'>{</font>
<a name='L2039'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *m, *d, *r;
<a name='L2040'>    <b>unsigned</b> <b>long</b> libver;
<a name='L2041'>    <b>unsigned</b> <b>int</b> major, minor, fix, patch, status;
<a name='L2042'>    <a href='../S/2712.html#L200' title='Defined at 200 in Modules/socketmodule.h.'>PySocketModule_APIObject</a> *socket_api;
<a name='L2043'>
<a name='L2044'>    <b>if</b> (<a href='../S/2824.html#L3799' title='Defined at 3799 in Objects/typeobject.c.'>PyType_Ready</a>(&amp;PySSLContext_Type) &lt; 0)
<a name='L2045'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L2046'>    <b>if</b> (<a href='../S/2824.html#L3799' title='Defined at 3799 in Objects/typeobject.c.'>PyType_Ready</a>(&amp;PySSLSocket_Type) &lt; 0)
<a name='L2047'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L2048'>
<a name='L2049'>    m = PyModule_Create(&amp;_sslmodule);
<a name='L2050'>    <b>if</b> (m == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L2051'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L2052'>    d = <a href='../S/2802.html#L159' title='Defined at 159 in Objects/moduleobject.c.'>PyModule_GetDict</a>(m);
<a name='L2053'>
<a name='L2054'>    <i><font color='green'>/* Load _socket module and its C API */</font></i>
<a name='L2055'>    socket_api = <a href='../S/2712.html#L202' title='Defined at 202 in Modules/socketmodule.h.'>PySocketModule_ImportModuleAndAPI</a>();
<a name='L2056'>    <b>if</b> (!socket_api)
<a name='L2057'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L2058'>    PySocketModule = *socket_api;
<a name='L2059'>
<a name='L2060'>    <i><font color='green'>/* Init OpenSSL */</font></i>
<a name='L2061'>    SSL_load_error_strings();
<a name='L2062'>    SSL_library_init();
<a name='L2063'><font color='darkred'>#ifdef</font> <a href='../D/5537.html' title='Multiple defined in 3 places.'>WITH_THREAD</a>
<a name='L2064'>    <i><font color='green'>/* note that this will start threading if not already started */</font></i>
<a name='L2065'>    <b>if</b> (!<a href='../S/2612.html#L1988' title='Defined at 1988 in Modules/_ssl.c.'>_setup_ssl_threads</a>()) <font color='red'>{</font>
<a name='L2066'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L2067'>    <font color='red'>}</font>
<a name='L2068'><font color='darkred'>#endif</font>
<a name='L2069'>    OpenSSL_add_all_algorithms();
<a name='L2070'>
<a name='L2071'>    <i><font color='green'>/* Add symbols to module dict */</font></i>
<a name='L2072'>    PySSLErrorObject = <a href='../S/3106.html#L621' title='Defined at 621 in Python/errors.c.'>PyErr_NewException</a>("ssl.SSLError",
<a name='L2073'>                                          PySocketModule.<a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>,
<a name='L2074'>                                          <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L2075'>    <b>if</b> (PySSLErrorObject == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L2076'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L2077'>    <b>if</b> (<a href='../S/2787.html#L2180' title='Defined at 2180 in Objects/dictobject.c.'>PyDict_SetItemString</a>(d, "SSLError", PySSLErrorObject) != 0)
<a name='L2078'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L2079'>    <b>if</b> (<a href='../S/2787.html#L2180' title='Defined at 2180 in Objects/dictobject.c.'>PyDict_SetItemString</a>(d, "_SSLContext",
<a name='L2080'>                             (<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *)&amp;PySSLContext_Type) != 0)
<a name='L2081'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L2082'>    <b>if</b> (<a href='../S/2787.html#L2180' title='Defined at 2180 in Objects/dictobject.c.'>PyDict_SetItemString</a>(d, "_SSLSocket",
<a name='L2083'>                             (<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *)&amp;PySSLSocket_Type) != 0)
<a name='L2084'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L2085'>    <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "SSL_ERROR_ZERO_RETURN",
<a name='L2086'>                            <a href='../S/2612.html#L46' title='Defined at 46 in Modules/_ssl.c.'>PY_SSL_ERROR_ZERO_RETURN</a>);
<a name='L2087'>    <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "SSL_ERROR_WANT_READ",
<a name='L2088'>                            <a href='../S/2612.html#L42' title='Defined at 42 in Modules/_ssl.c.'>PY_SSL_ERROR_WANT_READ</a>);
<a name='L2089'>    <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "SSL_ERROR_WANT_WRITE",
<a name='L2090'>                            <a href='../S/2612.html#L43' title='Defined at 43 in Modules/_ssl.c.'>PY_SSL_ERROR_WANT_WRITE</a>);
<a name='L2091'>    <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "SSL_ERROR_WANT_X509_LOOKUP",
<a name='L2092'>                            <a href='../S/2612.html#L44' title='Defined at 44 in Modules/_ssl.c.'>PY_SSL_ERROR_WANT_X509_LOOKUP</a>);
<a name='L2093'>    <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "SSL_ERROR_SYSCALL",
<a name='L2094'>                            <a href='../S/2612.html#L45' title='Defined at 45 in Modules/_ssl.c.'>PY_SSL_ERROR_SYSCALL</a>);
<a name='L2095'>    <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "SSL_ERROR_SSL",
<a name='L2096'>                            <a href='../S/2612.html#L41' title='Defined at 41 in Modules/_ssl.c.'>PY_SSL_ERROR_SSL</a>);
<a name='L2097'>    <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "SSL_ERROR_WANT_CONNECT",
<a name='L2098'>                            <a href='../S/2612.html#L47' title='Defined at 47 in Modules/_ssl.c.'>PY_SSL_ERROR_WANT_CONNECT</a>);
<a name='L2099'>    <i><font color='green'>/* non ssl.h errorcodes */</font></i>
<a name='L2100'>    <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "SSL_ERROR_EOF",
<a name='L2101'>                            <a href='../S/2612.html#L49' title='Defined at 49 in Modules/_ssl.c.'>PY_SSL_ERROR_EOF</a>);
<a name='L2102'>    <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "SSL_ERROR_INVALID_ERROR_CODE",
<a name='L2103'>                            <a href='../S/2612.html#L51' title='Defined at 51 in Modules/_ssl.c.'>PY_SSL_ERROR_INVALID_ERROR_CODE</a>);
<a name='L2104'>    <i><font color='green'>/* cert requirements */</font></i>
<a name='L2105'>    <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "CERT_NONE",
<a name='L2106'>                            <a href='../S/2612.html#L60' title='Defined at 60 in Modules/_ssl.c.'>PY_SSL_CERT_NONE</a>);
<a name='L2107'>    <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "CERT_OPTIONAL",
<a name='L2108'>                            <a href='../S/2612.html#L61' title='Defined at 61 in Modules/_ssl.c.'>PY_SSL_CERT_OPTIONAL</a>);
<a name='L2109'>    <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "CERT_REQUIRED",
<a name='L2110'>                            <a href='../S/2612.html#L62' title='Defined at 62 in Modules/_ssl.c.'>PY_SSL_CERT_REQUIRED</a>);
<a name='L2111'>
<a name='L2112'>    <i><font color='green'>/* protocol versions */</font></i>
<a name='L2113'>    <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "PROTOCOL_SSLv2",
<a name='L2114'>                            <a href='../S/2612.html#L66' title='Defined at 66 in Modules/_ssl.c.'>PY_SSL_VERSION_SSL2</a>);
<a name='L2115'>    <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "PROTOCOL_SSLv3",
<a name='L2116'>                            <a href='../S/2612.html#L67' title='Defined at 67 in Modules/_ssl.c.'>PY_SSL_VERSION_SSL3</a>);
<a name='L2117'>    <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "PROTOCOL_SSLv23",
<a name='L2118'>                            <a href='../S/2612.html#L68' title='Defined at 68 in Modules/_ssl.c.'>PY_SSL_VERSION_SSL23</a>);
<a name='L2119'>    <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "PROTOCOL_TLSv1",
<a name='L2120'>                            <a href='../S/2612.html#L69' title='Defined at 69 in Modules/_ssl.c.'>PY_SSL_VERSION_TLS1</a>);
<a name='L2121'>
<a name='L2122'>    <i><font color='green'>/* protocol options */</font></i>
<a name='L2123'>    <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "OP_ALL", SSL_OP_ALL);
<a name='L2124'>    <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "OP_NO_SSLv2", SSL_OP_NO_SSLv2);
<a name='L2125'>    <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "OP_NO_SSLv3", SSL_OP_NO_SSLv3);
<a name='L2126'>    <a href='../S/3125.html#L554' title='Defined at 554 in Python/modsupport.c.'>PyModule_AddIntConstant</a>(m, "OP_NO_TLSv1", SSL_OP_NO_TLSv1);
<a name='L2127'>
<a name='L2128'><font color='darkred'>#ifdef</font> SSL_CTRL_SET_TLSEXT_HOSTNAME
<a name='L2129'>    r = Py_True;
<a name='L2130'><font color='darkred'>#else</font>
<a name='L2131'>    r = Py_False;
<a name='L2132'><font color='darkred'>#endif</font>
<a name='L2133'>    Py_INCREF(r);
<a name='L2134'>    <a href='../S/3125.html#L525' title='Defined at 525 in Python/modsupport.c.'>PyModule_AddObject</a>(m, "HAS_SNI", r);
<a name='L2135'>
<a name='L2136'>    <i><font color='green'>/* OpenSSL version */</font></i>
<a name='L2137'>    <i><font color='green'>/* SSLeay() gives us the version of the library linked against,</font></i>
<a name='L2138'><i><font color='green'>       which could be different from the headers version.</font></i>
<a name='L2139'><i><font color='green'>    */</font></i>
<a name='L2140'>    libver = SSLeay();
<a name='L2141'>    r = <a href='../S/2799.html#L245' title='Defined at 245 in Objects/longobject.c.'>PyLong_FromUnsignedLong</a>(libver);
<a name='L2142'>    <b>if</b> (r == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L2143'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L2144'>    <b>if</b> (<a href='../S/3125.html#L525' title='Defined at 525 in Python/modsupport.c.'>PyModule_AddObject</a>(m, "OPENSSL_VERSION_NUMBER", r))
<a name='L2145'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L2146'>    status = libver &amp; 0xF;
<a name='L2147'>    libver &gt;&gt;= 4;
<a name='L2148'>    patch = libver &amp; 0xFF;
<a name='L2149'>    libver &gt;&gt;= 8;
<a name='L2150'>    fix = libver &amp; 0xFF;
<a name='L2151'>    libver &gt;&gt;= 8;
<a name='L2152'>    minor = libver &amp; 0xFF;
<a name='L2153'>    libver &gt;&gt;= 8;
<a name='L2154'>    major = libver &amp; 0xFF;
<a name='L2155'>    r = <a href='../D/4089.html' title='Multiple defined in 2 places.'>Py_BuildValue</a>("IIIII", major, minor, fix, patch, status);
<a name='L2156'>    <b>if</b> (r == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> || <a href='../S/3125.html#L525' title='Defined at 525 in Python/modsupport.c.'>PyModule_AddObject</a>(m, "OPENSSL_VERSION_INFO", r))
<a name='L2157'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L2158'>    r = <a href='../D/4012.html' title='Multiple defined in 3 places.'>PyUnicode_FromString</a>(SSLeay_version(SSLEAY_VERSION));
<a name='L2159'>    <b>if</b> (r == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> || <a href='../S/3125.html#L525' title='Defined at 525 in Python/modsupport.c.'>PyModule_AddObject</a>(m, "OPENSSL_VERSION", r))
<a name='L2160'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L2161'>
<a name='L2162'>    <b>return</b> m;
<a name='L2163'><font color='red'>}</font>
</pre>
<hr>
<a name='BOTTOM'>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L172'>[^]</a><a href='#L2037'>[v]</a><a href='#TOP'>[top]</a>[bottom]<a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
</body>
</html>
