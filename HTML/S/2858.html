<html>
<head>
<title>PC/bdist_wininst/install.c</title>
<meta name='robots' content='noindex,nofollow'>
<meta name='generator' content='GLOBAL-5.8.1'>
</head>
<body text='#191970' bgcolor='#f5f5dc' vlink='gray'>
<a name='TOP'><h2><a href='../mains.html'>root</a>/<a href='../files/3393.html'>PC</a>/<a href='../files/3396.html'>bdist_wininst</a>/install.c</h2>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L186'>[^]</a><a href='#L2645'>[v]</a>[top]<a href='#BOTTOM'>[bottom]</a><a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
<hr>
<h2>DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href='#L186' title='Defined at 186.'>unescape</a>
<li><a href='#L228' title='Defined at 228.'>set_failure_reason</a>
<li><a href='#L235' title='Defined at 235.'>get_failure_reason</a>
<li><a href='#L242' title='Defined at 242.'>add_to_filelist</a>
<li><a href='#L251' title='Defined at 251.'>do_compile_files</a>
<li><a href='#L305' title='Defined at 305.'>widen_string</a>
<li><a href='#L329' title='Defined at 329.'>compile_filelist</a>
<li><a href='#L430' title='Defined at 430.'>FileCreated</a>
<li><a href='#L439' title='Defined at 439.'>DirectoryCreated</a>
<li><a href='#L448' title='Defined at 448.'>GetSpecialFolderPath</a>
<li><a href='#L498' title='Defined at 498.'>CreateShortcut</a>
<li><a href='#L617' title='Defined at 617.'>PyMessageBox</a>
<li><a href='#L628' title='Defined at 628.'>GetRootHKey</a>
<li><a href='#L646' title='Defined at 646.'>LoadPythonDll</a>
<li><a href='#L673' title='Defined at 673.'>prepare_script_environment</a>
<li><a href='#L719' title='Defined at 719.'>do_run_installscript</a>
<li><a href='#L788' title='Defined at 788.'>run_installscript</a>
<li><a href='#L838' title='Defined at 838.'>do_run_simple_script</a>
<li><a href='#L861' title='Defined at 861.'>run_simple_script</a>
<li><a href='#L921' title='Defined at 921.'>SystemError</a>
<li><a href='#L948' title='Defined at 948.'>notify</a>
<li><a href='#L1005' title='Defined at 1005.'>MapExistingFile</a>
<li><a href='#L1034' title='Defined at 1034.'>create_bitmap</a>
<li><a href='#L1063' title='Defined at 1063.'>ExtractInstallData</a>
<li><a href='#L1128' title='Defined at 1128.'>PumpMessages</a>
<li><a href='#L1138' title='Defined at 1138.'>WindowProc</a>
<li><a href='#L1162' title='Defined at 1162.'>CreateBackground</a>
<li><a href='#L1203' title='Defined at 1203.'>CenterWindow</a>
<li><a href='#L1220' title='Defined at 1220.'>IntroDlgProc</a>
<li><a href='#L1271' title='Defined at 1271.'>StatusRoutine</a>
<li><a href='#L1316' title='Defined at 1316.'>get_sys_prefix</a>
<li><a href='#L1378' title='Defined at 1378.'>CheckPythonExe</a>
<li><a href='#L1405' title='Defined at 1405.'>GetOtherPythonVersion</a>
<li><a href='#L1463' title='Defined at 1463.'>GetPythonVersions</a>
<li><a href='#L1515' title='Defined at 1515.'>HasLocalMachinePrivs</a>
<li><a href='#L1540' title='Defined at 1540.'>CheckRootKey</a>
<li><a href='#L1559' title='Defined at 1559.'>GetScheme</a>
<li><a href='#L1569' title='Defined at 1569.'>SelectPythonDlgProc</a>
<li><a href='#L1732' title='Defined at 1732.'>OpenLogfile</a>
<li><a href='#L1844' title='Defined at 1844.'>CloseLogfile</a>
<li><a href='#L1861' title='Defined at 1861.'>InstallFilesDlgProc</a>
<li><a href='#L2016' title='Defined at 2016.'>FinishedDlgProc</a>
<li><a href='#L2097' title='Defined at 2097.'>RunWizard</a>
<li><a href='#L2151' title='Defined at 2151.'>MyIsUserAnAdmin</a>
<li><a href='#L2172' title='Defined at 2172.'>NeedAutoUAC</a>
<li><a href='#L2192' title='Defined at 2192.'>PlatformSupportsUAC</a>
<li><a href='#L2211' title='Defined at 2211.'>SpawnUAC</a>
<li><a href='#L2225' title='Defined at 2225.'>DoInstall</a>
<li><a href='#L2301' title='Defined at 2301.'>compare</a>
<li><a href='#L2315' title='Defined at 2315.'>remove_exe</a>
<li><a href='#L2355' title='Defined at 2355.'>DeleteRegistryKey</a>
<li><a href='#L2396' title='Defined at 2396.'>DeleteRegistryValue</a>
<li><a href='#L2438' title='Defined at 2438.'>MyDeleteFile</a>
<li><a href='#L2449' title='Defined at 2449.'>MyRemoveDirectory</a>
<li><a href='#L2460' title='Defined at 2460.'>Run_RemoveScript</a>
<li><a href='#L2496' title='Defined at 2496.'>DoUninstall</a>
<li><a href='#L2645' title='Defined at 2645.'>WinMain</a>
</ol>
<hr>
<pre>
<a name='L1'><i><font color='green'>/*</font></i>
<a name='L2'><i><font color='green'>  IMPORTANT NOTE: IF THIS FILE IS CHANGED, WININST-6.EXE MUST BE RECOMPILED</font></i>
<a name='L3'><i><font color='green'>  WITH THE MSVC6 WININST.DSW WORKSPACE FILE MANUALLY, AND WININST-7.1.EXE MUST</font></i>
<a name='L4'><i><font color='green'>  BE RECOMPILED WITH THE MSVC 2003.NET WININST-7.1.VCPROJ FILE MANUALLY.</font></i>
<a name='L5'><i><font color='green'></font></i>
<a name='L6'><i><font color='green'>  IF CHANGES TO THIS FILE ARE CHECKED INTO PYTHON CVS, THE RECOMPILED BINARIES</font></i>
<a name='L7'><i><font color='green'>  MUST BE CHECKED IN AS WELL!</font></i>
<a name='L8'><i><font color='green'>*/</font></i>
<a name='L9'>
<a name='L10'><i><font color='green'>/*</font></i>
<a name='L11'><i><font color='green'> * Written by Thomas Heller, May 2000</font></i>
<a name='L12'><i><font color='green'> *</font></i>
<a name='L13'><i><font color='green'> * $Id: install.c 81032 2010-05-09 15:52:27Z antoine.pitrou $</font></i>
<a name='L14'><i><font color='green'> */</font></i>
<a name='L15'>
<a name='L16'><i><font color='green'>/*</font></i>
<a name='L17'><i><font color='green'> * Windows Installer program for distutils.</font></i>
<a name='L18'><i><font color='green'> *</font></i>
<a name='L19'><i><font color='green'> * (a kind of self-extracting zip-file)</font></i>
<a name='L20'><i><font color='green'> *</font></i>
<a name='L21'><i><font color='green'> * At runtime, the exefile has appended:</font></i>
<a name='L22'><i><font color='green'> * - compressed setup-data in ini-format, containing the following sections:</font></i>
<a name='L23'><i><font color='green'> *      [metadata]</font></i>
<a name='L24'><i><font color='green'> *      author=Greg Ward</font></i>
<a name='L25'><i><font color='green'> *      author_email=gward@python.net</font></i>
<a name='L26'><i><font color='green'> *      description=Python Distribution Utilities</font></i>
<a name='L27'><i><font color='green'> *      licence=Python</font></i>
<a name='L28'><i><font color='green'> *      name=Distutils</font></i>
<a name='L29'><i><font color='green'> *      url=http://www.python.org/sigs/distutils-sig/</font></i>
<a name='L30'><i><font color='green'> *      version=0.9pre</font></i>
<a name='L31'><i><font color='green'> *</font></i>
<a name='L32'><i><font color='green'> *      [Setup]</font></i>
<a name='L33'><i><font color='green'> *      info= text to be displayed in the edit-box</font></i>
<a name='L34'><i><font color='green'> *      title= to be displayed by this program</font></i>
<a name='L35'><i><font color='green'> *      target_version = if present, python version required</font></i>
<a name='L36'><i><font color='green'> *      pyc_compile = if 0, do not compile py to pyc</font></i>
<a name='L37'><i><font color='green'> *      pyo_compile = if 0, do not compile py to pyo</font></i>
<a name='L38'><i><font color='green'> *</font></i>
<a name='L39'><i><font color='green'> * - a struct meta_data_hdr, describing the above</font></i>
<a name='L40'><i><font color='green'> * - a zip-file, containing the modules to be installed.</font></i>
<a name='L41'><i><font color='green'> *   for the format see http://www.pkware.com/appnote.html</font></i>
<a name='L42'><i><font color='green'> *</font></i>
<a name='L43'><i><font color='green'> * What does this program do?</font></i>
<a name='L44'><i><font color='green'> * - the setup-data is uncompressed and written to a temporary file.</font></i>
<a name='L45'><i><font color='green'> * - setup-data is queried with GetPrivateProfile... calls</font></i>
<a name='L46'><i><font color='green'> * - [metadata] - info is displayed in the dialog box</font></i>
<a name='L47'><i><font color='green'> * - The registry is searched for installations of python</font></i>
<a name='L48'><i><font color='green'> * - The user can select the python version to use.</font></i>
<a name='L49'><i><font color='green'> * - The python-installation directory (sys.prefix) is displayed</font></i>
<a name='L50'><i><font color='green'> * - When the start-button is pressed, files from the zip-archive</font></i>
<a name='L51'><i><font color='green'> *   are extracted to the file system. All .py filenames are stored</font></i>
<a name='L52'><i><font color='green'> *   in a list.</font></i>
<a name='L53'><i><font color='green'> */</font></i>
<a name='L54'><i><font color='green'>/*</font></i>
<a name='L55'><i><font color='green'> * Includes now an uninstaller.</font></i>
<a name='L56'><i><font color='green'> */</font></i>
<a name='L57'>
<a name='L58'><i><font color='green'>/*</font></i>
<a name='L59'><i><font color='green'> * To Do:</font></i>
<a name='L60'><i><font color='green'> *</font></i>
<a name='L61'><i><font color='green'> * display some explanation when no python version is found</font></i>
<a name='L62'><i><font color='green'> * instead showing the user an empty listbox to select something from.</font></i>
<a name='L63'><i><font color='green'> *</font></i>
<a name='L64'><i><font color='green'> * Finish the code so that we can use other python installations</font></i>
<a name='L65'><i><font color='green'> * additionaly to those found in the registry,</font></i>
<a name='L66'><i><font color='green'> * and then #define USE_OTHER_PYTHON_VERSIONS</font></i>
<a name='L67'><i><font color='green'> *</font></i>
<a name='L68'><i><font color='green'> *  - install a help-button, which will display something meaningful</font></i>
<a name='L69'><i><font color='green'> *    to the poor user.</font></i>
<a name='L70'><i><font color='green'> *    text to the user</font></i>
<a name='L71'><i><font color='green'> *  - should there be a possibility to display a README file</font></i>
<a name='L72'><i><font color='green'> *    before starting the installation (if one is present in the archive)</font></i>
<a name='L73'><i><font color='green'> *  - more comments about what the code does(?)</font></i>
<a name='L74'><i><font color='green'> *</font></i>
<a name='L75'><i><font color='green'> *  - evolve this into a full blown installer (???)</font></i>
<a name='L76'><i><font color='green'> */</font></i>
<a name='L77'>
<a name='L78'><font color='darkred'>#include</font> &lt;windows.h&gt;
<a name='L79'><font color='darkred'>#include</font> &lt;commctrl.h&gt;
<a name='L80'><font color='darkred'>#include</font> &lt;imagehlp.h&gt;
<a name='L81'><font color='darkred'>#include</font> &lt;objbase.h&gt;
<a name='L82'><font color='darkred'>#include</font> &lt;shlobj.h&gt;
<a name='L83'><font color='darkred'>#include</font> &lt;objidl.h&gt;
<a name='L84'><font color='darkred'>#include</font> "<a href='2861.html'>resource.h</a>"
<a name='L85'>
<a name='L86'><font color='darkred'>#include</font> &lt;stdio.h&gt;
<a name='L87'><font color='darkred'>#include</font> &lt;stdlib.h&gt;
<a name='L88'><font color='darkred'>#include</font> &lt;stdarg.h&gt;
<a name='L89'><font color='darkred'>#include</font> &lt;string.h&gt;
<a name='L90'><font color='darkred'>#include</font> &lt;time.h&gt;
<a name='L91'><font color='darkred'>#include</font> &lt;sys/types.h&gt;
<a name='L92'><font color='darkred'>#include</font> &lt;sys/stat.h&gt;
<a name='L93'><font color='darkred'>#include</font> &lt;malloc.h&gt;
<a name='L94'><font color='darkred'>#include</font> &lt;io.h&gt;
<a name='L95'><font color='darkred'>#include</font> &lt;fcntl.h&gt;
<a name='L96'>
<a name='L97'><font color='darkred'>#include</font> "<a href='2856.html'>archive.h</a>"
<a name='L98'>
<a name='L99'><i><font color='green'>/* Only for debugging!</font></i>
<a name='L100'><i><font color='green'>   static int dprintf(char *fmt, ...)</font></i>
<a name='L101'><i><font color='green'>   {</font></i>
<a name='L102'><i><font color='green'>   char Buffer[4096];</font></i>
<a name='L103'><i><font color='green'>   va_list marker;</font></i>
<a name='L104'><i><font color='green'>   int result;</font></i>
<a name='L105'><i><font color='green'></font></i>
<a name='L106'><i><font color='green'>   va_start(marker, fmt);</font></i>
<a name='L107'><i><font color='green'>   result = wvsprintf(Buffer, fmt, marker);</font></i>
<a name='L108'><i><font color='green'>   OutputDebugString(Buffer);</font></i>
<a name='L109'><i><font color='green'>   return result;</font></i>
<a name='L110'><i><font color='green'>   }</font></i>
<a name='L111'><i><font color='green'>*/</font></i>
<a name='L112'>
<a name='L113'><i><font color='green'>/* Bah: global variables */</font></i>
<a name='L114'>FILE *logfile;
<a name='L115'>
<a name='L116'><b>char</b> modulename[<a href='../S/2696.html#L2498' title='Defined at 2498 in Modules/posixmodule.c.'>MAX_PATH</a>];
<a name='L117'>wchar_t wmodulename[<a href='../S/2696.html#L2498' title='Defined at 2498 in Modules/posixmodule.c.'>MAX_PATH</a>];
<a name='L118'>
<a name='L119'>HWND hwndMain;
<a name='L120'>HWND hDialog;
<a name='L121'>
<a name='L122'><b>char</b> *ini_file;                 <i><font color='green'>/* Full pathname of ini-file */</font></i>
<a name='L123'><i><font color='green'>/* From ini-file */</font></i>
<a name='L124'><b>char</b> info[4096];                <i><font color='green'>/* [Setup] info= */</font></i>
<a name='L125'><b>char</b> title[80];                 <i><font color='green'>/* [Setup] title=, contains package name</font></i>
<a name='L126'><i><font color='green'>                                   including version: "Distutils-1.0.1" */</font></i>
<a name='L127'><b>char</b> target_version[10];        <i><font color='green'>/* [Setup] target_version=, required python</font></i>
<a name='L128'><i><font color='green'>                                   version or empty string */</font></i>
<a name='L129'><b>char</b> build_info[80];            <i><font color='green'>/* [Setup] build_info=, distutils version</font></i>
<a name='L130'><i><font color='green'>                                   and build date */</font></i>
<a name='L131'>
<a name='L132'><b>char</b> meta_name[80];             <i><font color='green'>/* package name without version like</font></i>
<a name='L133'><i><font color='green'>                                   'Distutils' */</font></i>
<a name='L134'><b>char</b> install_script[<a href='../S/2696.html#L2498' title='Defined at 2498 in Modules/posixmodule.c.'>MAX_PATH</a>];
<a name='L135'><b>char</b> *pre_install_script; <i><font color='green'>/* run before we install a single file */</font></i>
<a name='L136'>
<a name='L137'><b>char</b> user_access_control[10]; <i><font color='green'>// one of 'auto', 'force', otherwise none.</font></i>
<a name='L138'>
<a name='L139'><b>int</b> py_major, py_minor;         <i><font color='green'>/* Python version selected for installation */</font></i>
<a name='L140'>
<a name='L141'><b>char</b> *arc_data;                 <i><font color='green'>/* memory mapped archive */</font></i>
<a name='L142'>DWORD arc_size;                 <i><font color='green'>/* number of bytes in archive */</font></i>
<a name='L143'><b>int</b> exe_size;                   <i><font color='green'>/* number of bytes for exe-file portion */</font></i>
<a name='L144'><b>char</b> python_dir[<a href='../S/2696.html#L2498' title='Defined at 2498 in Modules/posixmodule.c.'>MAX_PATH</a>];
<a name='L145'><b>char</b> pythondll[<a href='../S/2696.html#L2498' title='Defined at 2498 in Modules/posixmodule.c.'>MAX_PATH</a>];
<a name='L146'><a href='../S/2583.html#L42' title='Defined at 42 in Modules/_multiprocessing/multiprocessing.h.'>BOOL</a> pyc_compile, pyo_compile;
<a name='L147'><i><font color='green'>/* Either HKLM or HKCU, depending on where Python itself is registered, and</font></i>
<a name='L148'><i><font color='green'>   the permissions of the current user. */</font></i>
<a name='L149'>HKEY hkey_root = (HKEY)-1;
<a name='L150'>
<a name='L151'><a href='../S/2583.html#L42' title='Defined at 42 in Modules/_multiprocessing/multiprocessing.h.'>BOOL</a> success;                   <i><font color='green'>/* Installation successfull? */</font></i>
<a name='L152'><b>char</b> *failure_reason = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L153'>
<a name='L154'><a href='../S/2583.html#L40' title='Defined at 40 in Modules/_multiprocessing/multiprocessing.h.'>HANDLE</a> hBitmap;
<a name='L155'><b>char</b> *bitmap_bytes;
<a name='L156'>
<a name='L157'>
<a name='L158'><font color='darkred'>#define</font> <a href='../R/4908.html' title='Multiple refered from 2 places.'>WM_NUMFILES</a> WM_USER+1
<a name='L159'><i><font color='green'>/* wParam: 0, lParam: total number of files */</font></i>
<a name='L160'><font color='darkred'>#define</font> <a href='../R/4907.html' title='Multiple refered from 2 places.'>WM_NEXTFILE</a> WM_USER+2
<a name='L161'><i><font color='green'>/* wParam: number of this file */</font></i>
<a name='L162'><i><font color='green'>/* lParam: points to pathname */</font></i>
<a name='L163'>
<a name='L164'><b>static</b> <a href='../S/2583.html#L42' title='Defined at 42 in Modules/_multiprocessing/multiprocessing.h.'>BOOL</a> <a href='../S/2858.html#L948' title='Defined at 948 in PC/bdist_wininst/install.c.'>notify</a>(<b>int</b> code, <b>char</b> *fmt, ...);
<a name='L165'>
<a name='L166'><i><font color='green'>/* Note: If scheme.prefix is nonempty, it must end with a '\'! */</font></i>
<a name='L167'><i><font color='green'>/* Note: purelib must be the FIRST entry! */</font></i>
<a name='L168'><a href='../S/2856.html#L75' title='Defined at 75 in PC/bdist_wininst/archive.h.'>SCHEME</a> old_scheme[] = <font color='red'>{</font>
<a name='L169'>    <font color='red'>{</font> "PURELIB", "" <font color='red'>}</font>,
<a name='L170'>    <font color='red'>{</font> "PLATLIB", "" <font color='red'>}</font>,
<a name='L171'>    <font color='red'>{</font> "HEADERS", "" <font color='red'>}</font>, <i><font color='green'>/* 'Include/dist_name' part already in archive */</font></i>
<a name='L172'>    <font color='red'>{</font> "SCRIPTS", "Scripts\\" <font color='red'>}</font>,
<a name='L173'>    <font color='red'>{</font> "DATA", "" <font color='red'>}</font>,
<a name='L174'>    <font color='red'>{</font> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> <font color='red'>}</font>,
<a name='L175'><font color='red'>}</font>;
<a name='L176'>
<a name='L177'><a href='../S/2856.html#L75' title='Defined at 75 in PC/bdist_wininst/archive.h.'>SCHEME</a> new_scheme[] = <font color='red'>{</font>
<a name='L178'>    <font color='red'>{</font> "PURELIB", "Lib\\site-packages\\" <font color='red'>}</font>,
<a name='L179'>    <font color='red'>{</font> "PLATLIB", "Lib\\site-packages\\" <font color='red'>}</font>,
<a name='L180'>    <font color='red'>{</font> "HEADERS", "" <font color='red'>}</font>, <i><font color='green'>/* 'Include/dist_name' part already in archive */</font></i>
<a name='L181'>    <font color='red'>{</font> "SCRIPTS", "Scripts\\" <font color='red'>}</font>,
<a name='L182'>    <font color='red'>{</font> "DATA", "" <font color='red'>}</font>,
<a name='L183'>    <font color='red'>{</font> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> <font color='red'>}</font>,
<a name='L184'><font color='red'>}</font>;
<a name='L185'>
<a name='L186'><b>static</b> <b>void</b> <a href='../R/11060.html' title='Multiple refered from 2 places.'>unescape</a>(<b>char</b> *dst, <b>char</b> *src, <b>unsigned</b> size)
<a name='L187'><font color='red'>{</font>
<a name='L188'>    <b>char</b> *eon;
<a name='L189'>    <b>char</b> ch;
<a name='L190'>
<a name='L191'>    <b>while</b> (src &amp;&amp; *src &amp;&amp; (size &gt; 2)) <font color='red'>{</font>
<a name='L192'>        <b>if</b> (*src == '\\') <font color='red'>{</font>
<a name='L193'>            <b>switch</b> (*++src) <font color='red'>{</font>
<a name='L194'>            <b>case</b> 'n':
<a name='L195'>                ++src;
<a name='L196'>                *dst++ = '\r';
<a name='L197'>                *dst++ = '\n';
<a name='L198'>                size -= 2;
<a name='L199'>                <b>break</b>;
<a name='L200'>            <b>case</b> 'r':
<a name='L201'>                ++src;
<a name='L202'>                *dst++ = '\r';
<a name='L203'>                --size;
<a name='L204'>                <b>break</b>;
<a name='L205'>            <b>case</b> '0': <b>case</b> '1': <b>case</b> '2': <b>case</b> '3':
<a name='L206'>                ch = (<b>char</b>)strtol(src, &amp;eon, 8);
<a name='L207'>                <b>if</b> (ch == '\n') <font color='red'>{</font>
<a name='L208'>                    *dst++ = '\r';
<a name='L209'>                    --size;
<a name='L210'>                <font color='red'>}</font>
<a name='L211'>                *dst++ = ch;
<a name='L212'>                --size;
<a name='L213'>                src = eon;
<a name='L214'>            <font color='red'>}</font>
<a name='L215'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L216'>            *dst++ = *src++;
<a name='L217'>            --size;
<a name='L218'>        <font color='red'>}</font>
<a name='L219'>    <font color='red'>}</font>
<a name='L220'>    *dst = '\0';
<a name='L221'><font color='red'>}</font>
<a name='L222'>
<a name='L223'><b>static</b> <b>struct</b> <a href='../R/10722.html' title='Multiple refered from 5 places.'>tagFile</a> <font color='red'>{</font>
<a name='L224'>    <b>char</b> *path;
<a name='L225'>    <b>struct</b> <a href='../S/2858.html#L223' title='Defined at 223 in PC/bdist_wininst/install.c.'>tagFile</a> *next;
<a name='L226'><font color='red'>}</font> *file_list = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L227'>
<a name='L228'><b>static</b> <b>void</b> <a href='../R/10203.html' title='Multiple refered from 4 places.'>set_failure_reason</a>(<b>char</b> *reason)
<a name='L229'><font color='red'>{</font>
<a name='L230'>    <b>if</b> (failure_reason)
<a name='L231'>    free(failure_reason);
<a name='L232'>    failure_reason = <a href='../D/11408.html' title='Multiple defined in 2 places.'>strdup</a>(reason);
<a name='L233'>    success = <a href='../D/1087.html' title='Multiple defined in 3 places.'>FALSE</a>;
<a name='L234'><font color='red'>}</font>
<a name='L235'><b>static</b> <b>char</b> *<a href='../S/2858.html#L2026' title='Refered from 2026 in PC/bdist_wininst/install.c.'>get_failure_reason</a>()
<a name='L236'><font color='red'>{</font>
<a name='L237'>    <b>if</b> (!failure_reason)
<a name='L238'>    <b>return</b> "Installation failed.";
<a name='L239'>    <b>return</b> failure_reason;
<a name='L240'><font color='red'>}</font>
<a name='L241'>
<a name='L242'><b>static</b> <b>void</b> <a href='../S/2858.html#L981' title='Refered from 981 in PC/bdist_wininst/install.c.'>add_to_filelist</a>(<b>char</b> *path)
<a name='L243'><font color='red'>{</font>
<a name='L244'>    <b>struct</b> <a href='../S/2858.html#L223' title='Defined at 223 in PC/bdist_wininst/install.c.'>tagFile</a> *p;
<a name='L245'>    p = (<b>struct</b> <a href='../S/2858.html#L223' title='Defined at 223 in PC/bdist_wininst/install.c.'>tagFile</a> *)malloc(<b>sizeof</b>(<b>struct</b> <a href='../S/2858.html#L223' title='Defined at 223 in PC/bdist_wininst/install.c.'>tagFile</a>));
<a name='L246'>    p-&gt;path = <a href='../D/11408.html' title='Multiple defined in 2 places.'>strdup</a>(path);
<a name='L247'>    p-&gt;next = file_list;
<a name='L248'>    file_list = p;
<a name='L249'><font color='red'>}</font>
<a name='L250'>
<a name='L251'><b>static</b> <b>int</b> <a href='../S/2858.html#L354' title='Refered from 354 in PC/bdist_wininst/install.c.'>do_compile_files</a>(<b>int</b> (__cdecl * PyRun_SimpleString)(<b>char</b> *),
<a name='L252'>                             <b>int</b> optimize)
<a name='L253'><font color='red'>{</font>
<a name='L254'>    <b>struct</b> <a href='../S/2858.html#L223' title='Defined at 223 in PC/bdist_wininst/install.c.'>tagFile</a> *p;
<a name='L255'>    <b>int</b> total, n;
<a name='L256'>    <b>char</b> Buffer[<a href='../S/2696.html#L2498' title='Defined at 2498 in Modules/posixmodule.c.'>MAX_PATH</a> + 64];
<a name='L257'>    <b>int</b> errors = 0;
<a name='L258'>
<a name='L259'>    total = 0;
<a name='L260'>    p = file_list;
<a name='L261'>    <b>while</b> (p) <font color='red'>{</font>
<a name='L262'>        ++total;
<a name='L263'>        p = p-&gt;next;
<a name='L264'>    <font color='red'>}</font>
<a name='L265'>    SendDlgItemMessage(hDialog, <a href='../S/2861.html#L24' title='Defined at 24 in PC/bdist_wininst/resource.h.'>IDC_PROGRESS</a>, PBM_SETRANGE, 0,
<a name='L266'>                        MAKELPARAM(0, total));
<a name='L267'>    SendDlgItemMessage(hDialog, <a href='../S/2861.html#L24' title='Defined at 24 in PC/bdist_wininst/resource.h.'>IDC_PROGRESS</a>, PBM_SETPOS, 0, 0);
<a name='L268'>
<a name='L269'>    n = 0;
<a name='L270'>    p = file_list;
<a name='L271'>    <b>while</b> (p) <font color='red'>{</font>
<a name='L272'>        ++n;
<a name='L273'>        wsprintf(Buffer,
<a name='L274'>                  "import py_compile; py_compile.compile (r'%s')",
<a name='L275'>                  p-&gt;path);
<a name='L276'>        <b>if</b> (<a href='../S/3138.html#L2444' title='Defined at 2444 in Python/pythonrun.c.'>PyRun_SimpleString</a>(Buffer)) <font color='red'>{</font>
<a name='L277'>            ++errors;
<a name='L278'>        <font color='red'>}</font>
<a name='L279'>        <i><font color='green'>/* We send the notification even if the files could not</font></i>
<a name='L280'><i><font color='green'>         * be created so that the uninstaller will remove them</font></i>
<a name='L281'><i><font color='green'>         * in case they are created later.</font></i>
<a name='L282'><i><font color='green'>         */</font></i>
<a name='L283'>        wsprintf(Buffer, "%s%c", p-&gt;path, optimize ? 'o' : 'c');
<a name='L284'>        <a href='../S/2858.html#L948' title='Defined at 948 in PC/bdist_wininst/install.c.'>notify</a>(<a href='../S/2856.html#L100' title='Defined at 100 in PC/bdist_wininst/archive.h.'>FILE_CREATED</a>, Buffer);
<a name='L285'>
<a name='L286'>        SendDlgItemMessage(hDialog, <a href='../S/2861.html#L24' title='Defined at 24 in PC/bdist_wininst/resource.h.'>IDC_PROGRESS</a>, PBM_SETPOS, n, 0);
<a name='L287'>        SetDlgItemText(hDialog, <a href='../S/2861.html#L25' title='Defined at 25 in PC/bdist_wininst/resource.h.'>IDC_INFO</a>, p-&gt;path);
<a name='L288'>        p = p-&gt;next;
<a name='L289'>    <font color='red'>}</font>
<a name='L290'>    <b>return</b> errors;
<a name='L291'><font color='red'>}</font>
<a name='L292'>
<a name='L293'><font color='darkred'>#define</font> <a href='../R/690.html' title='Multiple refered from 26 places.'>DECLPROC</a>(dll, result, name, args)\
<a name='L294'>    <b>typedef</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> (*__PROC__##name) <a href='../R/5981.html' title='Multiple refered from 2895 places.'>args</a>;\
<a name='L295'>    <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> (*name)<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a> = (__PROC__##name)<a href='../D/1434.html' title='Multiple defined in 2 places.'>GetProcAddress</a>(dll, #name)
<a name='L296'>
<a name='L297'>
<a name='L298'><font color='darkred'>#define</font> <a href='../S/2858.html#L336' title='Refered from 336 in PC/bdist_wininst/install.c.'>DECLVAR</a>(dll, type, name)\
<a name='L299'>    type *name = (type*)<a href='../D/1434.html' title='Multiple defined in 2 places.'>GetProcAddress</a>(dll, #name)
<a name='L300'>
<a name='L301'><b>typedef</b> <b>void</b> <a href='../R/3241.html' title='Multiple refered from 10003 places.'>PyObject</a>;
<a name='L302'>
<a name='L303'><i><font color='green'>// Convert a "char *" string to "whcar_t *", or NULL on error.</font></i>
<a name='L304'><i><font color='green'>// Result string must be free'd</font></i>
<a name='L305'>wchar_t *<a href='../S/2858.html#L761' title='Refered from 761 in PC/bdist_wininst/install.c.'>widen_string</a>(<b>char</b> *src)
<a name='L306'><font color='red'>{</font>
<a name='L307'>    wchar_t *<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L308'>    DWORD dest_cch;
<a name='L309'>    <b>int</b> src_len = strlen(src) + 1; <i><font color='green'>// include NULL term in all ops</font></i>
<a name='L310'>    <i><font color='green'>/* use MultiByteToWideChar() to see how much we need. */</font></i>
<a name='L311'>    <i><font color='green'>/* NOTE: this will include the null-term in the length */</font></i>
<a name='L312'>    dest_cch = MultiByteToWideChar(CP_ACP, 0, src, src_len, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, 0);
<a name='L313'>    <i><font color='green'>// alloc the buffer</font></i>
<a name='L314'>    <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = (wchar_t *)malloc(dest_cch * <b>sizeof</b>(wchar_t));
<a name='L315'>    <b>if</b> (<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>==<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)
<a name='L316'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L317'>    <i><font color='green'>/* do the conversion */</font></i>
<a name='L318'>    <b>if</b> (0==MultiByteToWideChar(CP_ACP, 0, src, src_len, <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>, dest_cch)) <font color='red'>{</font>
<a name='L319'>        free(<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>);
<a name='L320'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L321'>    <font color='red'>}</font>
<a name='L322'>    <b>return</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L323'><font color='red'>}</font>
<a name='L324'>
<a name='L325'><i><font color='green'>/*</font></i>
<a name='L326'><i><font color='green'> * Returns number of files which failed to compile,</font></i>
<a name='L327'><i><font color='green'> * -1 if python could not be loaded at all</font></i>
<a name='L328'><i><font color='green'> */</font></i>
<a name='L329'><b>static</b> <b>int</b> <a href='../R/6834.html' title='Multiple refered from 2 places.'>compile_filelist</a>(HINSTANCE hPython, <a href='../S/2583.html#L42' title='Defined at 42 in Modules/_multiprocessing/multiprocessing.h.'>BOOL</a> optimize_flag)
<a name='L330'><font color='red'>{</font>
<a name='L331'>    <a href='../S/2858.html#L293' title='Defined at 293 in PC/bdist_wininst/install.c.'>DECLPROC</a>(hPython, <b>void</b>, <a href='../S/3138.html#L319' title='Defined at 319 in Python/pythonrun.c.'>Py_Initialize</a>, (<b>void</b>));
<a name='L332'>    <a href='../S/2858.html#L293' title='Defined at 293 in PC/bdist_wininst/install.c.'>DECLPROC</a>(hPython, <b>void</b>, <a href='../S/3138.html#L667' title='Defined at 667 in Python/pythonrun.c.'>Py_SetProgramName</a>, (wchar_t *));
<a name='L333'>    <a href='../S/2858.html#L293' title='Defined at 293 in PC/bdist_wininst/install.c.'>DECLPROC</a>(hPython, <b>void</b>, <a href='../S/3138.html#L370' title='Defined at 370 in Python/pythonrun.c.'>Py_Finalize</a>, (<b>void</b>));
<a name='L334'>    <a href='../S/2858.html#L293' title='Defined at 293 in PC/bdist_wininst/install.c.'>DECLPROC</a>(hPython, <b>int</b>, <a href='../S/3138.html#L2444' title='Defined at 2444 in Python/pythonrun.c.'>PyRun_SimpleString</a>, (<b>char</b> *));
<a name='L335'>    <a href='../S/2858.html#L293' title='Defined at 293 in PC/bdist_wininst/install.c.'>DECLPROC</a>(hPython, <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *, <a href='../S/3144.html#L44' title='Defined at 44 in Python/sysmodule.c.'>PySys_GetObject</a>, (<b>char</b> *));
<a name='L336'>    <a href='../S/2858.html#L298' title='Defined at 298 in PC/bdist_wininst/install.c.'>DECLVAR</a>(hPython, <b>int</b>, Py_OptimizeFlag);
<a name='L337'>
<a name='L338'>    <b>int</b> errors = 0;
<a name='L339'>    <b>struct</b> <a href='../S/2858.html#L223' title='Defined at 223 in PC/bdist_wininst/install.c.'>tagFile</a> *p = file_list;
<a name='L340'>
<a name='L341'>    <b>if</b> (!p)
<a name='L342'>        <b>return</b> 0;
<a name='L343'>
<a name='L344'>    <b>if</b> (!<a href='../S/3138.html#L319' title='Defined at 319 in Python/pythonrun.c.'>Py_Initialize</a> || !<a href='../S/3138.html#L667' title='Defined at 667 in Python/pythonrun.c.'>Py_SetProgramName</a> || !<a href='../S/3138.html#L370' title='Defined at 370 in Python/pythonrun.c.'>Py_Finalize</a>)
<a name='L345'>        <b>return</b> -1;
<a name='L346'>
<a name='L347'>    <b>if</b> (!<a href='../S/3138.html#L2444' title='Defined at 2444 in Python/pythonrun.c.'>PyRun_SimpleString</a> || !<a href='../S/3144.html#L44' title='Defined at 44 in Python/sysmodule.c.'>PySys_GetObject</a> || !Py_OptimizeFlag)
<a name='L348'>        <b>return</b> -1;
<a name='L349'>
<a name='L350'>    *Py_OptimizeFlag = optimize_flag ? 1 : 0;
<a name='L351'>    <a href='../S/3138.html#L667' title='Defined at 667 in Python/pythonrun.c.'>Py_SetProgramName</a>(wmodulename);
<a name='L352'>    <a href='../S/3138.html#L319' title='Defined at 319 in Python/pythonrun.c.'>Py_Initialize</a>();
<a name='L353'>
<a name='L354'>    errors += <a href='../S/2858.html#L251' title='Defined at 251 in PC/bdist_wininst/install.c.'>do_compile_files</a>(<a href='../S/3138.html#L2444' title='Defined at 2444 in Python/pythonrun.c.'>PyRun_SimpleString</a>, optimize_flag);
<a name='L355'>    <a href='../S/3138.html#L370' title='Defined at 370 in Python/pythonrun.c.'>Py_Finalize</a>();
<a name='L356'>
<a name='L357'>    <b>return</b> errors;
<a name='L358'><font color='red'>}</font>
<a name='L359'>
<a name='L360'><b>typedef</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *(*PyCFunction)(PyObject *, PyObject *);
<a name='L361'>
<a name='L362'><b>struct</b> <a href='../R/3180.html' title='Multiple refered from 255 places.'>PyMethodDef</a> <font color='red'>{</font>
<a name='L363'>    <b>char</b>        *ml_name;
<a name='L364'>    PyCFunction  ml_meth;
<a name='L365'>    <b>int</b>                  ml_flags;
<a name='L366'>    <b>char</b>        *ml_doc;
<a name='L367'><font color='red'>}</font>;
<a name='L368'><b>typedef</b> <b>struct</b> <a href='../R/3180.html' title='Multiple refered from 255 places.'>PyMethodDef</a> <a href='../D/3525.html' title='Multiple defined in 3 places.'>PyMethodDef</a>;
<a name='L369'>
<a name='L370'><i><font color='green'>// XXX - all of these are potentially fragile!  We load and unload</font></i>
<a name='L371'><i><font color='green'>// the Python DLL multiple times - so storing functions pointers</font></i>
<a name='L372'><i><font color='green'>// is dangerous (although things *look* OK at present)</font></i>
<a name='L373'><i><font color='green'>// Better might be to roll prepare_script_environment() into</font></i>
<a name='L374'><i><font color='green'>// LoadPythonDll(), and create a new UnloadPythonDLL() which also</font></i>
<a name='L375'><i><font color='green'>// clears the global pointers.</font></i>
<a name='L376'><b>void</b> *(*g_Py_BuildValue)(<b>char</b> *, ...);
<a name='L377'><b>int</b> (*g_PyArg_ParseTuple)(<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *, <b>char</b> *, ...);
<a name='L378'><a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> * (*g_PyLong_FromVoidPtr)(<b>void</b> *);
<a name='L379'>
<a name='L380'><a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *g_PyExc_ValueError;
<a name='L381'><a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *g_PyExc_OSError;
<a name='L382'>
<a name='L383'><a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *(*g_PyErr_Format)(<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *, <b>char</b> *, ...);
<a name='L384'>
<a name='L385'><font color='darkred'>#define</font> <a href='../R/715.html' title='Multiple refered from 10 places.'>DEF_CSIDL</a>(name) <font color='red'>{</font> name, #name <font color='red'>}</font>
<a name='L386'>
<a name='L387'><b>struct</b> <font color='red'>{</font>
<a name='L388'>    <b>int</b> nFolder;
<a name='L389'>    <b>char</b> *name;
<a name='L390'><font color='red'>}</font> csidl_names[] = <font color='red'>{</font>
<a name='L391'>    <i><font color='green'>/* Startup menu for all users.</font></i>
<a name='L392'><i><font color='green'>       NT only */</font></i>
<a name='L393'>    <a href='../S/2858.html#L385' title='Defined at 385 in PC/bdist_wininst/install.c.'>DEF_CSIDL</a>(CSIDL_COMMON_STARTMENU),
<a name='L394'>    <i><font color='green'>/* Startup menu. */</font></i>
<a name='L395'>    <a href='../S/2858.html#L385' title='Defined at 385 in PC/bdist_wininst/install.c.'>DEF_CSIDL</a>(CSIDL_STARTMENU),
<a name='L396'>
<a name='L397'><i><font color='green'>/*    DEF_CSIDL(CSIDL_COMMON_APPDATA), */</font></i>
<a name='L398'><i><font color='green'>/*    DEF_CSIDL(CSIDL_LOCAL_APPDATA), */</font></i>
<a name='L399'>    <i><font color='green'>/* Repository for application-specific data.</font></i>
<a name='L400'><i><font color='green'>       Needs Internet Explorer 4.0 */</font></i>
<a name='L401'>    <a href='../S/2858.html#L385' title='Defined at 385 in PC/bdist_wininst/install.c.'>DEF_CSIDL</a>(CSIDL_APPDATA),
<a name='L402'>
<a name='L403'>    <i><font color='green'>/* The desktop for all users.</font></i>
<a name='L404'><i><font color='green'>       NT only */</font></i>
<a name='L405'>    <a href='../S/2858.html#L385' title='Defined at 385 in PC/bdist_wininst/install.c.'>DEF_CSIDL</a>(CSIDL_COMMON_DESKTOPDIRECTORY),
<a name='L406'>    <i><font color='green'>/* The desktop. */</font></i>
<a name='L407'>    <a href='../S/2858.html#L385' title='Defined at 385 in PC/bdist_wininst/install.c.'>DEF_CSIDL</a>(CSIDL_DESKTOPDIRECTORY),
<a name='L408'>
<a name='L409'>    <i><font color='green'>/* Startup folder for all users.</font></i>
<a name='L410'><i><font color='green'>       NT only */</font></i>
<a name='L411'>    <a href='../S/2858.html#L385' title='Defined at 385 in PC/bdist_wininst/install.c.'>DEF_CSIDL</a>(CSIDL_COMMON_STARTUP),
<a name='L412'>    <i><font color='green'>/* Startup folder. */</font></i>
<a name='L413'>    <a href='../S/2858.html#L385' title='Defined at 385 in PC/bdist_wininst/install.c.'>DEF_CSIDL</a>(CSIDL_STARTUP),
<a name='L414'>
<a name='L415'>    <i><font color='green'>/* Programs item in the start menu for all users.</font></i>
<a name='L416'><i><font color='green'>       NT only */</font></i>
<a name='L417'>    <a href='../S/2858.html#L385' title='Defined at 385 in PC/bdist_wininst/install.c.'>DEF_CSIDL</a>(CSIDL_COMMON_PROGRAMS),
<a name='L418'>    <i><font color='green'>/* Program item in the user's start menu. */</font></i>
<a name='L419'>    <a href='../S/2858.html#L385' title='Defined at 385 in PC/bdist_wininst/install.c.'>DEF_CSIDL</a>(CSIDL_PROGRAMS),
<a name='L420'>
<a name='L421'><i><font color='green'>/*    DEF_CSIDL(CSIDL_PROGRAM_FILES_COMMON), */</font></i>
<a name='L422'><i><font color='green'>/*    DEF_CSIDL(CSIDL_PROGRAM_FILES), */</font></i>
<a name='L423'>
<a name='L424'>    <i><font color='green'>/* Virtual folder containing fonts. */</font></i>
<a name='L425'>    <a href='../S/2858.html#L385' title='Defined at 385 in PC/bdist_wininst/install.c.'>DEF_CSIDL</a>(CSIDL_FONTS),
<a name='L426'><font color='red'>}</font>;
<a name='L427'>
<a name='L428'><font color='darkred'>#define</font> <a href='../R/735.html' title='Multiple refered from 2 places.'>DIM</a>(a) (<b>sizeof</b>(a) / <b>sizeof</b>((a)[0]))
<a name='L429'>
<a name='L430'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *<a href='../S/2858.html#L641' title='Refered from 641 in PC/bdist_wininst/install.c.'>FileCreated</a>(PyObject *self, PyObject *args)
<a name='L431'><font color='red'>{</font>
<a name='L432'>    <b>char</b> *path;
<a name='L433'>    <b>if</b> (!g_PyArg_ParseTuple(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "s", &amp;path))
<a name='L434'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L435'>    <a href='../S/2858.html#L948' title='Defined at 948 in PC/bdist_wininst/install.c.'>notify</a>(<a href='../S/2856.html#L100' title='Defined at 100 in PC/bdist_wininst/archive.h.'>FILE_CREATED</a>, path);
<a name='L436'>    <b>return</b> g_Py_BuildValue("");
<a name='L437'><font color='red'>}</font>
<a name='L438'>
<a name='L439'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *<a href='../S/2858.html#L642' title='Refered from 642 in PC/bdist_wininst/install.c.'>DirectoryCreated</a>(PyObject *self, PyObject *args)
<a name='L440'><font color='red'>{</font>
<a name='L441'>    <b>char</b> *path;
<a name='L442'>    <b>if</b> (!g_PyArg_ParseTuple(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "s", &amp;path))
<a name='L443'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L444'>    <a href='../S/2858.html#L948' title='Defined at 948 in PC/bdist_wininst/install.c.'>notify</a>(<a href='../S/2856.html#L98' title='Defined at 98 in PC/bdist_wininst/archive.h.'>DIR_CREATED</a>, path);
<a name='L445'>    <b>return</b> g_Py_BuildValue("");
<a name='L446'><font color='red'>}</font>
<a name='L447'>
<a name='L448'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *<a href='../S/2858.html#L639' title='Refered from 639 in PC/bdist_wininst/install.c.'>GetSpecialFolderPath</a>(PyObject *self, PyObject *args)
<a name='L449'><font color='red'>{</font>
<a name='L450'>    <b>char</b> *name;
<a name='L451'>    <b>char</b> lpszPath[<a href='../S/2696.html#L2498' title='Defined at 2498 in Modules/posixmodule.c.'>MAX_PATH</a>];
<a name='L452'>    <b>int</b> i;
<a name='L453'>    <b>static</b> HRESULT (WINAPI *My_SHGetSpecialFolderPath)(HWND hwnd,
<a name='L454'>                                                       LPTSTR lpszPath,
<a name='L455'>                                                       <b>int</b> nFolder,
<a name='L456'>                                                       <a href='../S/2583.html#L42' title='Defined at 42 in Modules/_multiprocessing/multiprocessing.h.'>BOOL</a> fCreate);
<a name='L457'>
<a name='L458'>    <b>if</b> (!My_SHGetSpecialFolderPath) <font color='red'>{</font>
<a name='L459'>        HINSTANCE hLib = LoadLibrary("shell32.dll");
<a name='L460'>        <b>if</b> (!hLib) <font color='red'>{</font>
<a name='L461'>            g_PyErr_Format(g_PyExc_OSError,
<a name='L462'>                           "function not available");
<a name='L463'>            <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L464'>        <font color='red'>}</font>
<a name='L465'>        My_SHGetSpecialFolderPath = (<a href='../S/2583.html#L42' title='Defined at 42 in Modules/_multiprocessing/multiprocessing.h.'>BOOL</a> (WINAPI *)(HWND, LPTSTR,
<a name='L466'>                                                     <b>int</b>, <a href='../S/2583.html#L42' title='Defined at 42 in Modules/_multiprocessing/multiprocessing.h.'>BOOL</a>))
<a name='L467'>            <a href='../D/1434.html' title='Multiple defined in 2 places.'>GetProcAddress</a>(hLib,
<a name='L468'>                           "SHGetSpecialFolderPathA");
<a name='L469'>    <font color='red'>}</font>
<a name='L470'>
<a name='L471'>    <b>if</b> (!g_PyArg_ParseTuple(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "s", &amp;name))
<a name='L472'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L473'>
<a name='L474'>    <b>if</b> (!My_SHGetSpecialFolderPath) <font color='red'>{</font>
<a name='L475'>        g_PyErr_Format(g_PyExc_OSError, "function not available");
<a name='L476'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L477'>    <font color='red'>}</font>
<a name='L478'>
<a name='L479'>    <b>for</b> (i = 0; i &lt; <a href='../S/2858.html#L428' title='Defined at 428 in PC/bdist_wininst/install.c.'>DIM</a>(csidl_names); ++i) <font color='red'>{</font>
<a name='L480'>        <b>if</b> (0 == strcmpi(csidl_names[i].name, name)) <font color='red'>{</font>
<a name='L481'>            <b>int</b> nFolder;
<a name='L482'>            nFolder = csidl_names[i].nFolder;
<a name='L483'>            <b>if</b> (My_SHGetSpecialFolderPath(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, lpszPath,
<a name='L484'>                                          nFolder, 0))
<a name='L485'>                <b>return</b> g_Py_BuildValue("s", lpszPath);
<a name='L486'>            <b>else</b> <font color='red'>{</font>
<a name='L487'>                g_PyErr_Format(g_PyExc_OSError,
<a name='L488'>                               "no such folder (%s)", name);
<a name='L489'>                <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L490'>            <font color='red'>}</font>
<a name='L491'>
<a name='L492'>        <font color='red'>}</font>
<a name='L493'>    <font color='red'>}</font>;
<a name='L494'>    g_PyErr_Format(g_PyExc_ValueError, "unknown CSIDL (%s)", name);
<a name='L495'>    <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L496'><font color='red'>}</font>
<a name='L497'>
<a name='L498'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *<a href='../S/2858.html#L638' title='Refered from 638 in PC/bdist_wininst/install.c.'>CreateShortcut</a>(PyObject *self, PyObject *args)
<a name='L499'><font color='red'>{</font>
<a name='L500'>    <b>char</b> *path; <i><font color='green'>/* path and filename */</font></i>
<a name='L501'>    <b>char</b> *description;
<a name='L502'>    <b>char</b> *filename;
<a name='L503'>
<a name='L504'>    <b>char</b> *<a href='../D/6737.html' title='Multiple defined in 2 places.'>arguments</a> = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L505'>    <b>char</b> *iconpath = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L506'>    <b>int</b> iconindex = 0;
<a name='L507'>    <b>char</b> *workdir = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L508'>
<a name='L509'>    WCHAR wszFilename[<a href='../S/2696.html#L2498' title='Defined at 2498 in Modules/posixmodule.c.'>MAX_PATH</a>];
<a name='L510'>
<a name='L511'>    IShellLink *ps1 = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L512'>    IPersistFile *pPf = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L513'>
<a name='L514'>    HRESULT hr;
<a name='L515'>
<a name='L516'>    hr = CoInitialize(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L517'>    <b>if</b> (FAILED(hr)) <font color='red'>{</font>
<a name='L518'>        g_PyErr_Format(g_PyExc_OSError,
<a name='L519'>                       "CoInitialize failed, error 0x%x", hr);
<a name='L520'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L521'>    <font color='red'>}</font>
<a name='L522'>
<a name='L523'>    <b>if</b> (!g_PyArg_ParseTuple(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "sss|sssi",
<a name='L524'>                            &amp;path, &amp;description, &amp;filename,
<a name='L525'>                            &amp;<a href='../D/6737.html' title='Multiple defined in 2 places.'>arguments</a>, &amp;workdir, &amp;iconpath, &amp;iconindex))
<a name='L526'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L527'>
<a name='L528'>    hr = CoCreateInstance(&amp;CLSID_ShellLink,
<a name='L529'>                          <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L530'>                          CLSCTX_INPROC_SERVER,
<a name='L531'>                          &amp;IID_IShellLink,
<a name='L532'>                          &amp;ps1);
<a name='L533'>    <b>if</b> (FAILED(hr)) <font color='red'>{</font>
<a name='L534'>        g_PyErr_Format(g_PyExc_OSError,
<a name='L535'>                       "CoCreateInstance failed, error 0x%x", hr);
<a name='L536'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L537'>    <font color='red'>}</font>
<a name='L538'>
<a name='L539'>    hr = ps1-&gt;lpVtbl-&gt;QueryInterface(ps1, &amp;IID_IPersistFile,
<a name='L540'>                                     (<b>void</b> **)&amp;pPf);
<a name='L541'>    <b>if</b> (FAILED(hr)) <font color='red'>{</font>
<a name='L542'>        g_PyErr_Format(g_PyExc_OSError,
<a name='L543'>                       "QueryInterface(IPersistFile) error 0x%x", hr);
<a name='L544'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L545'>    <font color='red'>}</font>
<a name='L546'>
<a name='L547'>
<a name='L548'>    hr = ps1-&gt;lpVtbl-&gt;SetPath(ps1, path);
<a name='L549'>    <b>if</b> (FAILED(hr)) <font color='red'>{</font>
<a name='L550'>        g_PyErr_Format(g_PyExc_OSError,
<a name='L551'>                       "SetPath() failed, error 0x%x", hr);
<a name='L552'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L553'>    <font color='red'>}</font>
<a name='L554'>
<a name='L555'>    hr = ps1-&gt;lpVtbl-&gt;SetDescription(ps1, description);
<a name='L556'>    <b>if</b> (FAILED(hr)) <font color='red'>{</font>
<a name='L557'>        g_PyErr_Format(g_PyExc_OSError,
<a name='L558'>                       "SetDescription() failed, error 0x%x", hr);
<a name='L559'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L560'>    <font color='red'>}</font>
<a name='L561'>
<a name='L562'>    <b>if</b> (<a href='../D/6737.html' title='Multiple defined in 2 places.'>arguments</a>) <font color='red'>{</font>
<a name='L563'>        hr = ps1-&gt;lpVtbl-&gt;SetArguments(ps1, <a href='../D/6737.html' title='Multiple defined in 2 places.'>arguments</a>);
<a name='L564'>        <b>if</b> (FAILED(hr)) <font color='red'>{</font>
<a name='L565'>            g_PyErr_Format(g_PyExc_OSError,
<a name='L566'>                           "SetArguments() error 0x%x", hr);
<a name='L567'>            <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L568'>        <font color='red'>}</font>
<a name='L569'>    <font color='red'>}</font>
<a name='L570'>
<a name='L571'>    <b>if</b> (iconpath) <font color='red'>{</font>
<a name='L572'>        hr = ps1-&gt;lpVtbl-&gt;SetIconLocation(ps1, iconpath, iconindex);
<a name='L573'>        <b>if</b> (FAILED(hr)) <font color='red'>{</font>
<a name='L574'>            g_PyErr_Format(g_PyExc_OSError,
<a name='L575'>                           "SetIconLocation() error 0x%x", hr);
<a name='L576'>            <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L577'>        <font color='red'>}</font>
<a name='L578'>    <font color='red'>}</font>
<a name='L579'>
<a name='L580'>    <b>if</b> (workdir) <font color='red'>{</font>
<a name='L581'>        hr = ps1-&gt;lpVtbl-&gt;SetWorkingDirectory(ps1, workdir);
<a name='L582'>        <b>if</b> (FAILED(hr)) <font color='red'>{</font>
<a name='L583'>            g_PyErr_Format(g_PyExc_OSError,
<a name='L584'>                           "SetWorkingDirectory() error 0x%x", hr);
<a name='L585'>            <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L586'>        <font color='red'>}</font>
<a name='L587'>    <font color='red'>}</font>
<a name='L588'>
<a name='L589'>    MultiByteToWideChar(CP_ACP, 0,
<a name='L590'>                        filename, -1,
<a name='L591'>                        wszFilename, <a href='../S/2696.html#L2498' title='Defined at 2498 in Modules/posixmodule.c.'>MAX_PATH</a>);
<a name='L592'>
<a name='L593'>    hr = pPf-&gt;lpVtbl-&gt;Save(pPf, wszFilename, <a href='../D/5177.html' title='Multiple defined in 3 places.'>TRUE</a>);
<a name='L594'>    <b>if</b> (FAILED(hr)) <font color='red'>{</font>
<a name='L595'>        g_PyErr_Format(g_PyExc_OSError,
<a name='L596'>                       "Failed to create shortcut '%s' - error 0x%x", filename, hr);
<a name='L597'>        <b>goto</b> <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>;
<a name='L598'>    <font color='red'>}</font>
<a name='L599'>
<a name='L600'>    pPf-&gt;lpVtbl-&gt;Release(pPf);
<a name='L601'>    ps1-&gt;lpVtbl-&gt;Release(ps1);
<a name='L602'>    CoUninitialize();
<a name='L603'>    <b>return</b> g_Py_BuildValue("");
<a name='L604'>
<a name='L605'>  <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>:
<a name='L606'>    <b>if</b> (pPf)
<a name='L607'>        pPf-&gt;lpVtbl-&gt;Release(pPf);
<a name='L608'>
<a name='L609'>    <b>if</b> (ps1)
<a name='L610'>        ps1-&gt;lpVtbl-&gt;Release(ps1);
<a name='L611'>
<a name='L612'>    CoUninitialize();
<a name='L613'>
<a name='L614'>    <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L615'><font color='red'>}</font>
<a name='L616'>
<a name='L617'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *<a href='../S/2858.html#L643' title='Refered from 643 in PC/bdist_wininst/install.c.'>PyMessageBox</a>(PyObject *self, PyObject *args)
<a name='L618'><font color='red'>{</font>
<a name='L619'>    <b>int</b> rc;
<a name='L620'>    <b>char</b> *text, *caption;
<a name='L621'>    <b>int</b> <a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a>;
<a name='L622'>    <b>if</b> (!g_PyArg_ParseTuple(<a href='../S/2858.html#L294' title='Defined at 294 in PC/bdist_wininst/install.c.'>args</a>, "ssi", &amp;text, &amp;caption, &amp;<a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a>))
<a name='L623'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L624'>    rc = MessageBox(GetFocus(), text, caption, <a href='../D/8626.html' title='Multiple defined in 2 places.'>flags</a>);
<a name='L625'>    <b>return</b> g_Py_BuildValue("i", rc);
<a name='L626'><font color='red'>}</font>
<a name='L627'>
<a name='L628'><b>static</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *<a href='../S/2858.html#L640' title='Refered from 640 in PC/bdist_wininst/install.c.'>GetRootHKey</a>(PyObject *self)
<a name='L629'><font color='red'>{</font>
<a name='L630'>    <b>return</b> g_PyLong_FromVoidPtr(hkey_root);
<a name='L631'><font color='red'>}</font>
<a name='L632'>
<a name='L633'><font color='darkred'>#define</font> <a href='../R/1920.html' title='Multiple refered from 1129 places.'>METH_VARARGS</a> 0x0001
<a name='L634'><font color='darkred'>#define</font> <a href='../R/1919.html' title='Multiple refered from 601 places.'>METH_NOARGS</a>   0x0004
<a name='L635'><b>typedef</b> <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *(*PyCFunction)(PyObject *, PyObject *);
<a name='L636'>
<a name='L637'><a href='../D/3525.html' title='Multiple defined in 3 places.'>PyMethodDef</a> meth[] = <font color='red'>{</font>
<a name='L638'>    <font color='red'>{</font>"create_shortcut", <a href='../S/2858.html#L498' title='Defined at 498 in PC/bdist_wininst/install.c.'>CreateShortcut</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>,
<a name='L639'>    <font color='red'>{</font>"get_special_folder_path", <a href='../S/2858.html#L448' title='Defined at 448 in PC/bdist_wininst/install.c.'>GetSpecialFolderPath</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>,
<a name='L640'>    <font color='red'>{</font>"get_root_hkey", (PyCFunction)<a href='../S/2858.html#L628' title='Defined at 628 in PC/bdist_wininst/install.c.'>GetRootHKey</a>, <a href='../S/2858.html#L634' title='Defined at 634 in PC/bdist_wininst/install.c.'>METH_NOARGS</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>,
<a name='L641'>    <font color='red'>{</font>"file_created", <a href='../S/2858.html#L430' title='Defined at 430 in PC/bdist_wininst/install.c.'>FileCreated</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>,
<a name='L642'>    <font color='red'>{</font>"directory_created", <a href='../S/2858.html#L439' title='Defined at 439 in PC/bdist_wininst/install.c.'>DirectoryCreated</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>,
<a name='L643'>    <font color='red'>{</font>"message_box", <a href='../S/2858.html#L617' title='Defined at 617 in PC/bdist_wininst/install.c.'>PyMessageBox</a>, <a href='../S/2858.html#L633' title='Defined at 633 in PC/bdist_wininst/install.c.'>METH_VARARGS</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>,
<a name='L644'><font color='red'>}</font>;
<a name='L645'>
<a name='L646'><b>static</b> HINSTANCE <a href='../R/1797.html' title='Multiple refered from 4 places.'>LoadPythonDll</a>(<b>char</b> *fname)
<a name='L647'><font color='red'>{</font>
<a name='L648'>    <b>char</b> fullpath[_MAX_PATH];
<a name='L649'>    <a href='../S/2588.html#L25' title='Defined at 25 in Modules/_pickle.c.'>LONG</a> size = <b>sizeof</b>(fullpath);
<a name='L650'>    <b>char</b> subkey_name[80];
<a name='L651'>    <b>char</b> <a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>[260 + 12];
<a name='L652'>    HINSTANCE h;
<a name='L653'>
<a name='L654'>    <i><font color='green'>/* make sure PYTHONHOME is set, to that sys.path is initialized correctly */</font></i>
<a name='L655'>    wsprintf(<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>, "PYTHONHOME=%s", python_dir);
<a name='L656'>    _putenv(<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>);
<a name='L657'>    h = LoadLibrary(fname);
<a name='L658'>    <b>if</b> (h)
<a name='L659'>        <b>return</b> h;
<a name='L660'>    wsprintf(subkey_name,
<a name='L661'>             "SOFTWARE\\Python\\PythonCore\\%d.%d\\InstallPath",
<a name='L662'>             py_major, py_minor);
<a name='L663'>    <b>if</b> (ERROR_SUCCESS != RegQueryValue(HKEY_CURRENT_USER, subkey_name,
<a name='L664'>                                       fullpath, &amp;size) &amp;&amp;
<a name='L665'>        ERROR_SUCCESS != RegQueryValue(HKEY_LOCAL_MACHINE, subkey_name,
<a name='L666'>                                       fullpath, &amp;size))
<a name='L667'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L668'>    strcat(fullpath, "\\");
<a name='L669'>    strcat(fullpath, fname);
<a name='L670'>    <b>return</b> LoadLibrary(fullpath);
<a name='L671'><font color='red'>}</font>
<a name='L672'>
<a name='L673'><b>static</b> <b>int</b> <a href='../R/9701.html' title='Multiple refered from 2 places.'>prepare_script_environment</a>(HINSTANCE hPython)
<a name='L674'><font color='red'>{</font>
<a name='L675'>    <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *mod;
<a name='L676'>    <a href='../S/2858.html#L293' title='Defined at 293 in PC/bdist_wininst/install.c.'>DECLPROC</a>(hPython, <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *, <a href='../S/3120.html#L2325' title='Defined at 2325 in Python/import.c.'>PyImport_ImportModule</a>, (<b>char</b> *));
<a name='L677'>    <a href='../S/2858.html#L293' title='Defined at 293 in PC/bdist_wininst/install.c.'>DECLPROC</a>(hPython, <b>int</b>, <a href='../S/2803.html#L806' title='Defined at 806 in Objects/object.c.'>PyObject_SetAttrString</a>, (<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *, <b>char</b> *, <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *));
<a name='L678'>    <a href='../S/2858.html#L293' title='Defined at 293 in PC/bdist_wininst/install.c.'>DECLPROC</a>(hPython, <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *, <a href='../S/2803.html#L779' title='Defined at 779 in Objects/object.c.'>PyObject_GetAttrString</a>, (<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *, <b>char</b> *));
<a name='L679'>    <a href='../S/2858.html#L293' title='Defined at 293 in PC/bdist_wininst/install.c.'>DECLPROC</a>(hPython, <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *, <a href='../D/2860.html' title='Multiple defined in 2 places.'>PyCFunction_New</a>, (<a href='../D/3525.html' title='Multiple defined in 3 places.'>PyMethodDef</a> *, <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *));
<a name='L680'>    <a href='../S/2858.html#L293' title='Defined at 293 in PC/bdist_wininst/install.c.'>DECLPROC</a>(hPython, <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *, <a href='../D/4089.html' title='Multiple defined in 2 places.'>Py_BuildValue</a>, (<b>char</b> *, ...));
<a name='L681'>    <a href='../S/2858.html#L293' title='Defined at 293 in PC/bdist_wininst/install.c.'>DECLPROC</a>(hPython, <b>int</b>, <a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>, (<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *, <b>char</b> *, ...));
<a name='L682'>    <a href='../S/2858.html#L293' title='Defined at 293 in PC/bdist_wininst/install.c.'>DECLPROC</a>(hPython, <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *, <a href='../S/3106.html#L600' title='Defined at 600 in Python/errors.c.'>PyErr_Format</a>, (<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *, <b>char</b> *));
<a name='L683'>    <a href='../S/2858.html#L293' title='Defined at 293 in PC/bdist_wininst/install.c.'>DECLPROC</a>(hPython, <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *, <a href='../S/2799.html#L929' title='Defined at 929 in Objects/longobject.c.'>PyLong_FromVoidPtr</a>, (<b>void</b> *));
<a name='L684'>    <b>if</b> (!<a href='../S/3120.html#L2325' title='Defined at 2325 in Python/import.c.'>PyImport_ImportModule</a> || !<a href='../S/2803.html#L779' title='Defined at 779 in Objects/object.c.'>PyObject_GetAttrString</a> ||
<a name='L685'>        !<a href='../S/2803.html#L806' title='Defined at 806 in Objects/object.c.'>PyObject_SetAttrString</a> || !<a href='../D/2860.html' title='Multiple defined in 2 places.'>PyCFunction_New</a>)
<a name='L686'>        <b>return</b> 1;
<a name='L687'>    <b>if</b> (!<a href='../D/4089.html' title='Multiple defined in 2 places.'>Py_BuildValue</a> || !<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a> || !<a href='../S/3106.html#L600' title='Defined at 600 in Python/errors.c.'>PyErr_Format</a>)
<a name='L688'>        <b>return</b> 1;
<a name='L689'>
<a name='L690'>    mod = <a href='../S/3120.html#L2325' title='Defined at 2325 in Python/import.c.'>PyImport_ImportModule</a>("builtins");
<a name='L691'>    <b>if</b> (mod) <font color='red'>{</font>
<a name='L692'>        <b>int</b> i;
<a name='L693'>        g_PyExc_ValueError = <a href='../S/2803.html#L779' title='Defined at 779 in Objects/object.c.'>PyObject_GetAttrString</a>(mod, "ValueError");
<a name='L694'>        g_PyExc_OSError = <a href='../S/2803.html#L779' title='Defined at 779 in Objects/object.c.'>PyObject_GetAttrString</a>(mod, "OSError");
<a name='L695'>        <b>for</b> (i = 0; i &lt; <a href='../S/2858.html#L428' title='Defined at 428 in PC/bdist_wininst/install.c.'>DIM</a>(meth); ++i) <font color='red'>{</font>
<a name='L696'>            <a href='../S/2803.html#L806' title='Defined at 806 in Objects/object.c.'>PyObject_SetAttrString</a>(mod, meth[i].ml_name,
<a name='L697'>                                   <a href='../D/2860.html' title='Multiple defined in 2 places.'>PyCFunction_New</a>(&amp;meth[i], <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>));
<a name='L698'>        <font color='red'>}</font>
<a name='L699'>    <font color='red'>}</font>
<a name='L700'>    g_Py_BuildValue = <a href='../D/4089.html' title='Multiple defined in 2 places.'>Py_BuildValue</a>;
<a name='L701'>    g_PyArg_ParseTuple = <a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>;
<a name='L702'>    g_PyErr_Format = <a href='../S/3106.html#L600' title='Defined at 600 in Python/errors.c.'>PyErr_Format</a>;
<a name='L703'>    g_PyLong_FromVoidPtr = <a href='../S/2799.html#L929' title='Defined at 929 in Objects/longobject.c.'>PyLong_FromVoidPtr</a>;
<a name='L704'>
<a name='L705'>    <b>return</b> 0;
<a name='L706'><font color='red'>}</font>
<a name='L707'>
<a name='L708'><i><font color='green'>/*</font></i>
<a name='L709'><i><font color='green'> * This function returns one of the following error codes:</font></i>
<a name='L710'><i><font color='green'> * 1 if the Python-dll does not export the functions we need</font></i>
<a name='L711'><i><font color='green'> * 2 if no install-script is specified in pathname</font></i>
<a name='L712'><i><font color='green'> * 3 if the install-script file could not be opened</font></i>
<a name='L713'><i><font color='green'> * the return value of PyRun_SimpleString() otherwise,</font></i>
<a name='L714'><i><font color='green'> * which is 0 if everything is ok, -1 if an exception had occurred</font></i>
<a name='L715'><i><font color='green'> * in the install-script.</font></i>
<a name='L716'><i><font color='green'> */</font></i>
<a name='L717'>
<a name='L718'><b>static</b> <b>int</b>
<a name='L719'><a href='../S/2858.html#L818' title='Refered from 818 in PC/bdist_wininst/install.c.'>do_run_installscript</a>(HINSTANCE hPython, <b>char</b> *pathname, <b>int</b> argc, <b>char</b> **argv)
<a name='L720'><font color='red'>{</font>
<a name='L721'>    <b>int</b> fh, <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>, i;
<a name='L722'>    <b>static</b> wchar_t *wargv[256];
<a name='L723'>    <a href='../S/2858.html#L293' title='Defined at 293 in PC/bdist_wininst/install.c.'>DECLPROC</a>(hPython, <b>void</b>, <a href='../S/3138.html#L319' title='Defined at 319 in Python/pythonrun.c.'>Py_Initialize</a>, (<b>void</b>));
<a name='L724'>    <a href='../S/2858.html#L293' title='Defined at 293 in PC/bdist_wininst/install.c.'>DECLPROC</a>(hPython, <b>int</b>, <a href='../S/3144.html#L1917' title='Defined at 1917 in Python/sysmodule.c.'>PySys_SetArgv</a>, (<b>int</b>, wchar_t **));
<a name='L725'>    <a href='../S/2858.html#L293' title='Defined at 293 in PC/bdist_wininst/install.c.'>DECLPROC</a>(hPython, <b>int</b>, <a href='../S/3138.html#L2444' title='Defined at 2444 in Python/pythonrun.c.'>PyRun_SimpleString</a>, (<b>char</b> *));
<a name='L726'>    <a href='../S/2858.html#L293' title='Defined at 293 in PC/bdist_wininst/install.c.'>DECLPROC</a>(hPython, <b>void</b>, <a href='../S/3138.html#L370' title='Defined at 370 in Python/pythonrun.c.'>Py_Finalize</a>, (<b>void</b>));
<a name='L727'>    <a href='../S/2858.html#L293' title='Defined at 293 in PC/bdist_wininst/install.c.'>DECLPROC</a>(hPython, <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *, <a href='../D/4089.html' title='Multiple defined in 2 places.'>Py_BuildValue</a>, (<b>char</b> *, ...));
<a name='L728'>    <a href='../S/2858.html#L293' title='Defined at 293 in PC/bdist_wininst/install.c.'>DECLPROC</a>(hPython, <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *, <a href='../D/2860.html' title='Multiple defined in 2 places.'>PyCFunction_New</a>,
<a name='L729'>             (<a href='../D/3525.html' title='Multiple defined in 3 places.'>PyMethodDef</a> *, <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *));
<a name='L730'>    <a href='../S/2858.html#L293' title='Defined at 293 in PC/bdist_wininst/install.c.'>DECLPROC</a>(hPython, <b>int</b>, <a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a>, (<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *, <b>char</b> *, ...));
<a name='L731'>    <a href='../S/2858.html#L293' title='Defined at 293 in PC/bdist_wininst/install.c.'>DECLPROC</a>(hPython, <a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *, <a href='../S/3106.html#L600' title='Defined at 600 in Python/errors.c.'>PyErr_Format</a>, (<a href='../D/3593.html' title='Multiple defined in 2 places.'>PyObject</a> *, <b>char</b> *));
<a name='L732'>
<a name='L733'>    <b>if</b> (!<a href='../S/3138.html#L319' title='Defined at 319 in Python/pythonrun.c.'>Py_Initialize</a> || !<a href='../S/3144.html#L1917' title='Defined at 1917 in Python/sysmodule.c.'>PySys_SetArgv</a>
<a name='L734'>        || !<a href='../S/3138.html#L2444' title='Defined at 2444 in Python/pythonrun.c.'>PyRun_SimpleString</a> || !<a href='../S/3138.html#L370' title='Defined at 370 in Python/pythonrun.c.'>Py_Finalize</a>)
<a name='L735'>        <b>return</b> 1;
<a name='L736'>
<a name='L737'>    <b>if</b> (!<a href='../D/4089.html' title='Multiple defined in 2 places.'>Py_BuildValue</a> || !<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a> || !<a href='../S/3106.html#L600' title='Defined at 600 in Python/errors.c.'>PyErr_Format</a>)
<a name='L738'>        <b>return</b> 1;
<a name='L739'>
<a name='L740'>    <b>if</b> (!<a href='../D/2860.html' title='Multiple defined in 2 places.'>PyCFunction_New</a> || !<a href='../D/2731.html' title='Multiple defined in 2 places.'>PyArg_ParseTuple</a> || !<a href='../S/3106.html#L600' title='Defined at 600 in Python/errors.c.'>PyErr_Format</a>)
<a name='L741'>        <b>return</b> 1;
<a name='L742'>
<a name='L743'>    <b>if</b> (pathname == <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a> || pathname[0] == '\0')
<a name='L744'>        <b>return</b> 2;
<a name='L745'>
<a name='L746'>    fh = open(pathname, _O_RDONLY);
<a name='L747'>    <b>if</b> (-1 == fh) <font color='red'>{</font>
<a name='L748'>        fprintf(stderr, "Could not open postinstall-script %s\n",
<a name='L749'>            pathname);
<a name='L750'>        <b>return</b> 3;
<a name='L751'>    <font color='red'>}</font>
<a name='L752'>
<a name='L753'>    SetDlgItemText(hDialog, <a href='../S/2861.html#L25' title='Defined at 25 in PC/bdist_wininst/resource.h.'>IDC_INFO</a>, "Running Script...");
<a name='L754'>
<a name='L755'>    <a href='../S/3138.html#L319' title='Defined at 319 in Python/pythonrun.c.'>Py_Initialize</a>();
<a name='L756'>
<a name='L757'>    <a href='../S/2858.html#L673' title='Defined at 673 in PC/bdist_wininst/install.c.'>prepare_script_environment</a>(hPython);
<a name='L758'>    <i><font color='green'>// widen the argv array for py3k.</font></i>
<a name='L759'>    memset(wargv, 0, <b>sizeof</b>(wargv));
<a name='L760'>    <b>for</b> (i=0;i&lt;argc;i++)
<a name='L761'>        wargv[i] = argv[i] ? <a href='../S/2858.html#L305' title='Defined at 305 in PC/bdist_wininst/install.c.'>widen_string</a>(argv[i]) : <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L762'>    <a href='../S/3144.html#L1917' title='Defined at 1917 in Python/sysmodule.c.'>PySys_SetArgv</a>(argc, wargv);
<a name='L763'>    <i><font color='green'>// free the strings we just widened.</font></i>
<a name='L764'>    <b>for</b> (i=0;i&lt;argc;i++)
<a name='L765'>        <b>if</b> (wargv[i])
<a name='L766'>            free(wargv[i]);
<a name='L767'>
<a name='L768'>    <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = 3;
<a name='L769'>    <font color='red'>{</font>
<a name='L770'>        <b>struct</b> _stat statbuf;
<a name='L771'>        <b>if</b>(0 == _fstat(fh, &amp;statbuf)) <font color='red'>{</font>
<a name='L772'>            <b>char</b> *script = <a href='../D/6714.html' title='Multiple defined in 6 places.'>alloca</a>(statbuf.st_size + 5);
<a name='L773'>            <b>int</b> n = read(fh, script, statbuf.st_size);
<a name='L774'>            <b>if</b> (n &gt; 0) <font color='red'>{</font>
<a name='L775'>                script[n] = '\n';
<a name='L776'>                script[n+1] = 0;
<a name='L777'>                <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = <a href='../S/3138.html#L2444' title='Defined at 2444 in Python/pythonrun.c.'>PyRun_SimpleString</a>(script);
<a name='L778'>            <font color='red'>}</font>
<a name='L779'>        <font color='red'>}</font>
<a name='L780'>    <font color='red'>}</font>
<a name='L781'>    <a href='../S/3138.html#L370' title='Defined at 370 in Python/pythonrun.c.'>Py_Finalize</a>();
<a name='L782'>
<a name='L783'>    close(fh);
<a name='L784'>    <b>return</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L785'><font color='red'>}</font>
<a name='L786'>
<a name='L787'><b>static</b> <b>int</b>
<a name='L788'><a href='../R/10070.html' title='Multiple refered from 2 places.'>run_installscript</a>(<b>char</b> *pathname, <b>int</b> argc, <b>char</b> **argv, <b>char</b> **pOutput)
<a name='L789'><font color='red'>{</font>
<a name='L790'>    HINSTANCE hPython;
<a name='L791'>    <b>int</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = 1;
<a name='L792'>    <b>int</b> out_buf_size;
<a name='L793'>    <a href='../S/2583.html#L40' title='Defined at 40 in Modules/_multiprocessing/multiprocessing.h.'>HANDLE</a> redirected, old_stderr, old_stdout;
<a name='L794'>    <b>char</b> *tempname;
<a name='L795'>
<a name='L796'>    *pOutput = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L797'>
<a name='L798'>    tempname = tempnam(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L799'>    <i><font color='green'>// We use a static CRT while the Python version we load uses</font></i>
<a name='L800'>    <i><font color='green'>// the CRT from one of various possibile DLLs.  As a result we</font></i>
<a name='L801'>    <i><font color='green'>// need to redirect the standard handles using the API rather</font></i>
<a name='L802'>    <i><font color='green'>// than the CRT.</font></i>
<a name='L803'>    redirected = CreateFile(
<a name='L804'>                                    tempname,
<a name='L805'>                                    GENERIC_WRITE | GENERIC_READ,
<a name='L806'>                                    FILE_SHARE_READ,
<a name='L807'>                                    <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L808'>                                    CREATE_ALWAYS,
<a name='L809'>                                    FILE_ATTRIBUTE_NORMAL | FILE_FLAG_WRITE_THROUGH,
<a name='L810'>                                    <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L811'>    old_stdout = GetStdHandle(STD_OUTPUT_HANDLE);
<a name='L812'>    old_stderr = GetStdHandle(STD_ERROR_HANDLE);
<a name='L813'>    SetStdHandle(STD_OUTPUT_HANDLE, redirected);
<a name='L814'>    SetStdHandle(STD_ERROR_HANDLE, redirected);
<a name='L815'>
<a name='L816'>    hPython = <a href='../S/2858.html#L646' title='Defined at 646 in PC/bdist_wininst/install.c.'>LoadPythonDll</a>(pythondll);
<a name='L817'>    <b>if</b> (hPython) <font color='red'>{</font>
<a name='L818'>        <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = <a href='../S/2858.html#L719' title='Defined at 719 in PC/bdist_wininst/install.c.'>do_run_installscript</a>(hPython, pathname, argc, argv);
<a name='L819'>        FreeLibrary(hPython);
<a name='L820'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L821'>        fprintf(stderr, "*** Could not load Python ***");
<a name='L822'>    <font color='red'>}</font>
<a name='L823'>    SetStdHandle(STD_OUTPUT_HANDLE, old_stdout);
<a name='L824'>    SetStdHandle(STD_ERROR_HANDLE, old_stderr);
<a name='L825'>    out_buf_size = <a href='../S/2252.html#L7' title='Defined at 7 in Modules/_ctypes/ctypes.h.'>min</a>(GetFileSize(redirected, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>), 4096);
<a name='L826'>    *pOutput = malloc(out_buf_size+1);
<a name='L827'>    <b>if</b> (*pOutput) <font color='red'>{</font>
<a name='L828'>        DWORD nread = 0;
<a name='L829'>        SetFilePointer(redirected, 0, 0, FILE_BEGIN);
<a name='L830'>        ReadFile(redirected, *pOutput, out_buf_size, &amp;nread, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L831'>        (*pOutput)[nread] = '\0';
<a name='L832'>    <font color='red'>}</font>
<a name='L833'>    CloseHandle(redirected);
<a name='L834'>    DeleteFile(tempname);
<a name='L835'>    <b>return</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L836'><font color='red'>}</font>
<a name='L837'>
<a name='L838'><b>static</b> <b>int</b> <a href='../S/2858.html#L887' title='Refered from 887 in PC/bdist_wininst/install.c.'>do_run_simple_script</a>(HINSTANCE hPython, <b>char</b> *script)
<a name='L839'><font color='red'>{</font>
<a name='L840'>    <b>int</b> rc;
<a name='L841'>    <a href='../S/2858.html#L293' title='Defined at 293 in PC/bdist_wininst/install.c.'>DECLPROC</a>(hPython, <b>void</b>, <a href='../S/3138.html#L319' title='Defined at 319 in Python/pythonrun.c.'>Py_Initialize</a>, (<b>void</b>));
<a name='L842'>    <a href='../S/2858.html#L293' title='Defined at 293 in PC/bdist_wininst/install.c.'>DECLPROC</a>(hPython, <b>void</b>, <a href='../S/3138.html#L667' title='Defined at 667 in Python/pythonrun.c.'>Py_SetProgramName</a>, (wchar_t *));
<a name='L843'>    <a href='../S/2858.html#L293' title='Defined at 293 in PC/bdist_wininst/install.c.'>DECLPROC</a>(hPython, <b>void</b>, <a href='../S/3138.html#L370' title='Defined at 370 in Python/pythonrun.c.'>Py_Finalize</a>, (<b>void</b>));
<a name='L844'>    <a href='../S/2858.html#L293' title='Defined at 293 in PC/bdist_wininst/install.c.'>DECLPROC</a>(hPython, <b>int</b>, <a href='../S/3138.html#L2444' title='Defined at 2444 in Python/pythonrun.c.'>PyRun_SimpleString</a>, (<b>char</b> *));
<a name='L845'>    <a href='../S/2858.html#L293' title='Defined at 293 in PC/bdist_wininst/install.c.'>DECLPROC</a>(hPython, <b>void</b>, <a href='../S/3138.html#L1342' title='Defined at 1342 in Python/pythonrun.c.'>PyErr_Print</a>, (<b>void</b>));
<a name='L846'>
<a name='L847'>    <b>if</b> (!<a href='../S/3138.html#L319' title='Defined at 319 in Python/pythonrun.c.'>Py_Initialize</a> || !<a href='../S/3138.html#L667' title='Defined at 667 in Python/pythonrun.c.'>Py_SetProgramName</a> || !<a href='../S/3138.html#L370' title='Defined at 370 in Python/pythonrun.c.'>Py_Finalize</a> ||
<a name='L848'>        !<a href='../S/3138.html#L2444' title='Defined at 2444 in Python/pythonrun.c.'>PyRun_SimpleString</a> || !<a href='../S/3138.html#L1342' title='Defined at 1342 in Python/pythonrun.c.'>PyErr_Print</a>)
<a name='L849'>        <b>return</b> -1;
<a name='L850'>
<a name='L851'>    <a href='../S/3138.html#L667' title='Defined at 667 in Python/pythonrun.c.'>Py_SetProgramName</a>(wmodulename);
<a name='L852'>    <a href='../S/3138.html#L319' title='Defined at 319 in Python/pythonrun.c.'>Py_Initialize</a>();
<a name='L853'>    <a href='../S/2858.html#L673' title='Defined at 673 in PC/bdist_wininst/install.c.'>prepare_script_environment</a>(hPython);
<a name='L854'>    rc = <a href='../S/3138.html#L2444' title='Defined at 2444 in Python/pythonrun.c.'>PyRun_SimpleString</a>(script);
<a name='L855'>    <b>if</b> (rc)
<a name='L856'>        <a href='../S/3138.html#L1342' title='Defined at 1342 in Python/pythonrun.c.'>PyErr_Print</a>();
<a name='L857'>    <a href='../S/3138.html#L370' title='Defined at 370 in Python/pythonrun.c.'>Py_Finalize</a>();
<a name='L858'>    <b>return</b> rc;
<a name='L859'><font color='red'>}</font>
<a name='L860'>
<a name='L861'><b>static</b> <b>int</b> <a href='../S/2858.html#L1955' title='Refered from 1955 in PC/bdist_wininst/install.c.'>run_simple_script</a>(<b>char</b> *script)
<a name='L862'><font color='red'>{</font>
<a name='L863'>    <b>int</b> rc;
<a name='L864'>    HINSTANCE hPython;
<a name='L865'>    <b>char</b> *tempname = tempnam(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L866'>    <i><font color='green'>// Redirect output using win32 API - see comments above...</font></i>
<a name='L867'>    <a href='../S/2583.html#L40' title='Defined at 40 in Modules/_multiprocessing/multiprocessing.h.'>HANDLE</a> redirected = CreateFile(
<a name='L868'>                                    tempname,
<a name='L869'>                                    GENERIC_WRITE | GENERIC_READ,
<a name='L870'>                                    FILE_SHARE_READ,
<a name='L871'>                                    <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L872'>                                    CREATE_ALWAYS,
<a name='L873'>                                    FILE_ATTRIBUTE_NORMAL | FILE_FLAG_WRITE_THROUGH,
<a name='L874'>                                    <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L875'>    <a href='../S/2583.html#L40' title='Defined at 40 in Modules/_multiprocessing/multiprocessing.h.'>HANDLE</a> old_stdout = GetStdHandle(STD_OUTPUT_HANDLE);
<a name='L876'>    <a href='../S/2583.html#L40' title='Defined at 40 in Modules/_multiprocessing/multiprocessing.h.'>HANDLE</a> old_stderr = GetStdHandle(STD_ERROR_HANDLE);
<a name='L877'>    SetStdHandle(STD_OUTPUT_HANDLE, redirected);
<a name='L878'>    SetStdHandle(STD_ERROR_HANDLE, redirected);
<a name='L879'>
<a name='L880'>    hPython = <a href='../S/2858.html#L646' title='Defined at 646 in PC/bdist_wininst/install.c.'>LoadPythonDll</a>(pythondll);
<a name='L881'>    <b>if</b> (!hPython) <font color='red'>{</font>
<a name='L882'>        <b>char</b> reason[128];
<a name='L883'>        wsprintf(reason, "Can't load Python for pre-install script (%d)", GetLastError());
<a name='L884'>        <a href='../S/2858.html#L228' title='Defined at 228 in PC/bdist_wininst/install.c.'>set_failure_reason</a>(reason);
<a name='L885'>        <b>return</b> -1;
<a name='L886'>    <font color='red'>}</font>
<a name='L887'>    rc = <a href='../S/2858.html#L838' title='Defined at 838 in PC/bdist_wininst/install.c.'>do_run_simple_script</a>(hPython, script);
<a name='L888'>    FreeLibrary(hPython);
<a name='L889'>    SetStdHandle(STD_OUTPUT_HANDLE, old_stdout);
<a name='L890'>    SetStdHandle(STD_ERROR_HANDLE, old_stderr);
<a name='L891'>    <i><font color='green'>/* We only care about the output when we fail.  If the script works</font></i>
<a name='L892'><i><font color='green'>       OK, then we discard it</font></i>
<a name='L893'><i><font color='green'>    */</font></i>
<a name='L894'>    <b>if</b> (rc) <font color='red'>{</font>
<a name='L895'>        <b>int</b> err_buf_size;
<a name='L896'>        <b>char</b> *err_buf;
<a name='L897'>        <b>const</b> <b>char</b> *<a href='../S/2664.html#L148' title='Defined at 148 in Modules/expat/xmlparse.c.'>prefix</a> = "Running the pre-installation script failed\r\n";
<a name='L898'>        <b>int</b> prefix_len = strlen(<a href='../S/2664.html#L148' title='Defined at 148 in Modules/expat/xmlparse.c.'>prefix</a>);
<a name='L899'>        err_buf_size = GetFileSize(redirected, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L900'>        <b>if</b> (err_buf_size==INVALID_FILE_SIZE) <i><font color='green'>// an error - let's try anyway...</font></i>
<a name='L901'>            err_buf_size = 4096;
<a name='L902'>        err_buf = malloc(prefix_len + err_buf_size + 1);
<a name='L903'>        <b>if</b> (err_buf) <font color='red'>{</font>
<a name='L904'>            DWORD n = 0;
<a name='L905'>            strcpy(err_buf, <a href='../S/2664.html#L148' title='Defined at 148 in Modules/expat/xmlparse.c.'>prefix</a>);
<a name='L906'>            SetFilePointer(redirected, 0, 0, FILE_BEGIN);
<a name='L907'>            ReadFile(redirected, err_buf+prefix_len, err_buf_size, &amp;n, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L908'>            err_buf[prefix_len+n] = '\0';
<a name='L909'>            <a href='../S/2858.html#L228' title='Defined at 228 in PC/bdist_wininst/install.c.'>set_failure_reason</a>(err_buf);
<a name='L910'>            free(err_buf);
<a name='L911'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L912'>            <a href='../S/2858.html#L228' title='Defined at 228 in PC/bdist_wininst/install.c.'>set_failure_reason</a>("Out of memory!");
<a name='L913'>        <font color='red'>}</font>
<a name='L914'>    <font color='red'>}</font>
<a name='L915'>    CloseHandle(redirected);
<a name='L916'>    DeleteFile(tempname);
<a name='L917'>    <b>return</b> rc;
<a name='L918'><font color='red'>}</font>
<a name='L919'>
<a name='L920'>
<a name='L921'><b>static</b> <a href='../S/2583.html#L42' title='Defined at 42 in Modules/_multiprocessing/multiprocessing.h.'>BOOL</a> <a href='../R/4516.html' title='Multiple refered from 14 places.'>SystemError</a>(<b>int</b> error, <b>char</b> *msg)
<a name='L922'><font color='red'>{</font>
<a name='L923'>    <b>char</b> Buffer[1024];
<a name='L924'>    <b>int</b> n;
<a name='L925'>
<a name='L926'>    <b>if</b> (<a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>) <font color='red'>{</font>
<a name='L927'>        LPVOID lpMsgBuf;
<a name='L928'>        FormatMessage(
<a name='L929'>            FORMAT_MESSAGE_ALLOCATE_BUFFER |
<a name='L930'>            FORMAT_MESSAGE_FROM_SYSTEM,
<a name='L931'>            <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L932'>            <a href='../D/8389.html' title='Multiple defined in 3 places.'>error</a>,
<a name='L933'>            MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT),
<a name='L934'>            (LPSTR)&amp;lpMsgBuf,
<a name='L935'>            0,
<a name='L936'>            <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>
<a name='L937'>            );
<a name='L938'>        strncpy(Buffer, lpMsgBuf, <b>sizeof</b>(Buffer));
<a name='L939'>        LocalFree(lpMsgBuf);
<a name='L940'>    <font color='red'>}</font> <b>else</b>
<a name='L941'>        Buffer[0] = '\0';
<a name='L942'>    n = lstrlen(Buffer);
<a name='L943'>    _snprintf(Buffer+n, <b>sizeof</b>(Buffer)-n, msg);
<a name='L944'>    MessageBox(hwndMain, Buffer, "Runtime Error", MB_OK | MB_ICONSTOP);
<a name='L945'>    <b>return</b> <a href='../D/1087.html' title='Multiple defined in 3 places.'>FALSE</a>;
<a name='L946'><font color='red'>}</font>
<a name='L947'>
<a name='L948'><b>static</b> <a href='../S/2583.html#L42' title='Defined at 42 in Modules/_multiprocessing/multiprocessing.h.'>BOOL</a> <a href='../R/9286.html' title='Multiple refered from 32 places.'>notify</a> (<b>int</b> code, <b>char</b> *fmt, ...)
<a name='L949'><font color='red'>{</font>
<a name='L950'>    <b>char</b> Buffer[1024];
<a name='L951'>    va_list <a href='../S/2588.html#L3787' title='Defined at 3787 in Modules/_pickle.c.'>marker</a>;
<a name='L952'>    <a href='../S/2583.html#L42' title='Defined at 42 in Modules/_multiprocessing/multiprocessing.h.'>BOOL</a> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = <a href='../D/5177.html' title='Multiple defined in 3 places.'>TRUE</a>;
<a name='L953'>    <b>int</b> a, <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a>;
<a name='L954'>    <b>char</b> *cp;
<a name='L955'>
<a name='L956'>    va_start(<a href='../S/2588.html#L3787' title='Defined at 3787 in Modules/_pickle.c.'>marker</a>, fmt);
<a name='L957'>    _vsnprintf(Buffer, <b>sizeof</b>(Buffer), fmt, <a href='../S/2588.html#L3787' title='Defined at 3787 in Modules/_pickle.c.'>marker</a>);
<a name='L958'>
<a name='L959'>    <b>switch</b> (<a href='../S/2755.html#L28' title='Defined at 28 in Modules/zlib/inftrees.h.'>code</a>) <font color='red'>{</font>
<a name='L960'><i><font color='green'>/* Questions */</font></i>
<a name='L961'>    <b>case</b> <a href='../S/2856.html#L99' title='Defined at 99 in PC/bdist_wininst/archive.h.'>CAN_OVERWRITE</a>:
<a name='L962'>        <b>break</b>;
<a name='L963'>
<a name='L964'><i><font color='green'>/* Information notification */</font></i>
<a name='L965'>    <b>case</b> <a href='../S/2856.html#L98' title='Defined at 98 in PC/bdist_wininst/archive.h.'>DIR_CREATED</a>:
<a name='L966'>        <b>if</b> (logfile)
<a name='L967'>            fprintf(logfile, "100 Made Dir: %s\n", fmt);
<a name='L968'>        <b>break</b>;
<a name='L969'>
<a name='L970'>    <b>case</b> <a href='../S/2856.html#L100' title='Defined at 100 in PC/bdist_wininst/archive.h.'>FILE_CREATED</a>:
<a name='L971'>        <b>if</b> (logfile)
<a name='L972'>            fprintf(logfile, "200 File Copy: %s\n", fmt);
<a name='L973'>        <b>goto</b> add_to_filelist_label;
<a name='L974'>        <b>break</b>;
<a name='L975'>
<a name='L976'>    <b>case</b> <a href='../S/2856.html#L104' title='Defined at 104 in PC/bdist_wininst/archive.h.'>FILE_OVERWRITTEN</a>:
<a name='L977'>        <b>if</b> (logfile)
<a name='L978'>            fprintf(logfile, "200 File Overwrite: %s\n", fmt);
<a name='L979'>      add_to_filelist_label:
<a name='L980'>        <b>if</b> ((cp = strrchr(fmt, '.')) &amp;&amp; (0 == strcmp (cp, ".py")))
<a name='L981'>            <a href='../S/2858.html#L242' title='Defined at 242 in PC/bdist_wininst/install.c.'>add_to_filelist</a>(fmt);
<a name='L982'>        <b>break</b>;
<a name='L983'>
<a name='L984'><i><font color='green'>/* Error Messages */</font></i>
<a name='L985'>    <b>case</b> <a href='../S/2856.html#L101' title='Defined at 101 in PC/bdist_wininst/archive.h.'>ZLIB_ERROR</a>:
<a name='L986'>        MessageBox(GetFocus(), Buffer, "Error",
<a name='L987'>                    MB_OK | MB_ICONWARNING);
<a name='L988'>        <b>break</b>;
<a name='L989'>
<a name='L990'>    <b>case</b> <a href='../S/2856.html#L102' title='Defined at 102 in PC/bdist_wininst/archive.h.'>SYSTEM_ERROR</a>:
<a name='L991'>        <a href='../S/2858.html#L921' title='Defined at 921 in PC/bdist_wininst/install.c.'>SystemError</a>(GetLastError(), Buffer);
<a name='L992'>        <b>break</b>;
<a name='L993'>
<a name='L994'>    <b>case</b> <a href='../S/2856.html#L103' title='Defined at 103 in PC/bdist_wininst/archive.h.'>NUM_FILES</a>:
<a name='L995'>        a = va_arg(<a href='../S/2588.html#L3787' title='Defined at 3787 in Modules/_pickle.c.'>marker</a>, <b>int</b>);
<a name='L996'>        <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a> = va_arg(<a href='../S/2588.html#L3787' title='Defined at 3787 in Modules/_pickle.c.'>marker</a>, <b>int</b>);
<a name='L997'>        SendMessage(hDialog, <a href='../S/2858.html#L158' title='Defined at 158 in PC/bdist_wininst/install.c.'>WM_NUMFILES</a>, 0, MAKELPARAM(0, a));
<a name='L998'>        SendMessage(hDialog, <a href='../S/2858.html#L160' title='Defined at 160 in PC/bdist_wininst/install.c.'>WM_NEXTFILE</a>, <a href='../D/6949.html' title='Multiple defined in 12 places.'>b</a>,(LPARAM)fmt);
<a name='L999'>    <font color='red'>}</font>
<a name='L1000'>    va_end(<a href='../S/2588.html#L3787' title='Defined at 3787 in Modules/_pickle.c.'>marker</a>);
<a name='L1001'>
<a name='L1002'>    <b>return</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L1003'><font color='red'>}</font>
<a name='L1004'>
<a name='L1005'><b>static</b> <b>char</b> *<a href='../S/2858.html#L2656' title='Refered from 2656 in PC/bdist_wininst/install.c.'>MapExistingFile</a>(<b>char</b> *pathname, DWORD *psize)
<a name='L1006'><font color='red'>{</font>
<a name='L1007'>    <a href='../S/2583.html#L40' title='Defined at 40 in Modules/_multiprocessing/multiprocessing.h.'>HANDLE</a> hFile, hFileMapping;
<a name='L1008'>    DWORD nSizeLow, nSizeHigh;
<a name='L1009'>    <b>char</b> *data;
<a name='L1010'>
<a name='L1011'>    hFile = CreateFile(pathname,
<a name='L1012'>                        GENERIC_READ, FILE_SHARE_READ, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L1013'>                        OPEN_EXISTING,
<a name='L1014'>                        FILE_ATTRIBUTE_NORMAL, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L1015'>    <b>if</b> (hFile == <a href='../S/2583.html#L47' title='Defined at 47 in Modules/_multiprocessing/multiprocessing.h.'>INVALID_HANDLE_VALUE</a>)
<a name='L1016'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1017'>    nSizeLow = GetFileSize(hFile, &amp;nSizeHigh);
<a name='L1018'>    hFileMapping = CreateFileMapping(hFile,
<a name='L1019'>                                      <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, PAGE_READONLY, 0, 0, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L1020'>    CloseHandle(hFile);
<a name='L1021'>
<a name='L1022'>    <b>if</b> (hFileMapping == <a href='../S/2583.html#L47' title='Defined at 47 in Modules/_multiprocessing/multiprocessing.h.'>INVALID_HANDLE_VALUE</a>)
<a name='L1023'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1024'>
<a name='L1025'>    data = MapViewOfFile(hFileMapping,
<a name='L1026'>                          FILE_MAP_READ, 0, 0, 0);
<a name='L1027'>
<a name='L1028'>    CloseHandle(hFileMapping);
<a name='L1029'>    *psize = nSizeLow;
<a name='L1030'>    <b>return</b> data;
<a name='L1031'><font color='red'>}</font>
<a name='L1032'>
<a name='L1033'>
<a name='L1034'><b>static</b> <b>void</b> <a href='../S/2858.html#L1227' title='Refered from 1227 in PC/bdist_wininst/install.c.'>create_bitmap</a>(HWND hwnd)
<a name='L1035'><font color='red'>{</font>
<a name='L1036'>    BITMAPFILEHEADER *bfh;
<a name='L1037'>    BITMAPINFO *bi;
<a name='L1038'>    HDC hdc;
<a name='L1039'>
<a name='L1040'>    <b>if</b> (!bitmap_bytes)
<a name='L1041'>        <b>return</b>;
<a name='L1042'>
<a name='L1043'>    <b>if</b> (hBitmap)
<a name='L1044'>        <b>return</b>;
<a name='L1045'>
<a name='L1046'>    hdc = GetDC(hwnd);
<a name='L1047'>
<a name='L1048'>    bfh = (BITMAPFILEHEADER *)bitmap_bytes;
<a name='L1049'>    bi = (BITMAPINFO *)(bitmap_bytes + <b>sizeof</b>(BITMAPFILEHEADER));
<a name='L1050'>
<a name='L1051'>    hBitmap = CreateDIBitmap(hdc,
<a name='L1052'>                             &amp;bi-&gt;bmiHeader,
<a name='L1053'>                             CBM_INIT,
<a name='L1054'>                             bitmap_bytes + bfh-&gt;bfOffBits,
<a name='L1055'>                             bi,
<a name='L1056'>                             DIB_RGB_COLORS);
<a name='L1057'>    ReleaseDC(hwnd, hdc);
<a name='L1058'><font color='red'>}</font>
<a name='L1059'>
<a name='L1060'><i><font color='green'>/* Extract everything we need to begin the installation.  Currently this</font></i>
<a name='L1061'><i><font color='green'>   is the INI filename with install data, and the raw pre-install script</font></i>
<a name='L1062'><i><font color='green'>*/</font></i>
<a name='L1063'><b>static</b> <a href='../S/2583.html#L42' title='Defined at 42 in Modules/_multiprocessing/multiprocessing.h.'>BOOL</a> <a href='../S/2858.html#L2674' title='Refered from 2674 in PC/bdist_wininst/install.c.'>ExtractInstallData</a>(<b>char</b> *data, DWORD size, <b>int</b> *pexe_size,
<a name='L1064'>                               <b>char</b> **out_ini_file, <b>char</b> **out_preinstall_script)
<a name='L1065'><font color='red'>{</font>
<a name='L1066'>    <i><font color='green'>/* read the end of central directory record */</font></i>
<a name='L1067'>    <b>struct</b> <a href='../S/2856.html#L16' title='Defined at 16 in PC/bdist_wininst/archive.h.'>eof_cdir</a> *pe = (<b>struct</b> <a href='../S/2856.html#L16' title='Defined at 16 in PC/bdist_wininst/archive.h.'>eof_cdir</a> *)&amp;data[size - <b>sizeof</b>
<a name='L1068'>                                                   (<b>struct</b> <a href='../S/2856.html#L16' title='Defined at 16 in PC/bdist_wininst/archive.h.'>eof_cdir</a>)];
<a name='L1069'>
<a name='L1070'>    <b>int</b> arc_start = size - <b>sizeof</b> (<b>struct</b> <a href='../S/2856.html#L16' title='Defined at 16 in PC/bdist_wininst/archive.h.'>eof_cdir</a>) - pe-&gt;nBytesCDir -
<a name='L1071'>        pe-&gt;ofsCDir;
<a name='L1072'>
<a name='L1073'>    <b>int</b> ofs = arc_start - <b>sizeof</b> (<b>struct</b> <a href='../S/2856.html#L62' title='Defined at 62 in PC/bdist_wininst/archive.h.'>meta_data_hdr</a>);
<a name='L1074'>
<a name='L1075'>    <i><font color='green'>/* read meta_data info */</font></i>
<a name='L1076'>    <b>struct</b> <a href='../S/2856.html#L62' title='Defined at 62 in PC/bdist_wininst/archive.h.'>meta_data_hdr</a> *pmd = (<b>struct</b> <a href='../S/2856.html#L62' title='Defined at 62 in PC/bdist_wininst/archive.h.'>meta_data_hdr</a> *)&amp;data[ofs];
<a name='L1077'>    <b>char</b> *src, *dst;
<a name='L1078'>    <b>char</b> *ini_file;
<a name='L1079'>    <b>char</b> tempdir[<a href='../S/2696.html#L2498' title='Defined at 2498 in Modules/posixmodule.c.'>MAX_PATH</a>];
<a name='L1080'>
<a name='L1081'>    <i><font color='green'>/* ensure that if we fail, we don't have garbage out pointers */</font></i>
<a name='L1082'>    *out_ini_file = *out_preinstall_script = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1083'>
<a name='L1084'>    <b>if</b> (pe-&gt;<a href='../S/2664.html#L175' title='Defined at 175 in Modules/expat/xmlparse.c.'>tag</a> != 0x06054b50) <font color='red'>{</font>
<a name='L1085'>        <b>return</b> <a href='../D/1087.html' title='Multiple defined in 3 places.'>FALSE</a>;
<a name='L1086'>    <font color='red'>}</font>
<a name='L1087'>
<a name='L1088'>    <b>if</b> (pmd-&gt;<a href='../S/2664.html#L175' title='Defined at 175 in Modules/expat/xmlparse.c.'>tag</a> != 0x1234567B) <font color='red'>{</font>
<a name='L1089'>        <b>return</b> <a href='../S/2858.html#L921' title='Defined at 921 in PC/bdist_wininst/install.c.'>SystemError</a>(0,
<a name='L1090'>                   "Invalid cfgdata magic number (see bdist_wininst.py)");
<a name='L1091'>    <font color='red'>}</font>
<a name='L1092'>    <b>if</b> (ofs &lt; 0) <font color='red'>{</font>
<a name='L1093'>        <b>return</b> <a href='../D/1087.html' title='Multiple defined in 3 places.'>FALSE</a>;
<a name='L1094'>    <font color='red'>}</font>
<a name='L1095'>
<a name='L1096'>    <b>if</b> (pmd-&gt;bitmap_size) <font color='red'>{</font>
<a name='L1097'>        <i><font color='green'>/* Store pointer to bitmap bytes */</font></i>
<a name='L1098'>        bitmap_bytes = (<b>char</b> *)pmd - pmd-&gt;uncomp_size - pmd-&gt;bitmap_size;
<a name='L1099'>    <font color='red'>}</font>
<a name='L1100'>
<a name='L1101'>    *pexe_size = ofs - pmd-&gt;uncomp_size - pmd-&gt;bitmap_size;
<a name='L1102'>
<a name='L1103'>    src = ((<b>char</b> *)pmd) - pmd-&gt;uncomp_size;
<a name='L1104'>    ini_file = malloc(<a href='../S/2696.html#L2498' title='Defined at 2498 in Modules/posixmodule.c.'>MAX_PATH</a>); <i><font color='green'>/* will be returned, so do not free it */</font></i>
<a name='L1105'>    <b>if</b> (!ini_file)
<a name='L1106'>        <b>return</b> <a href='../D/1087.html' title='Multiple defined in 3 places.'>FALSE</a>;
<a name='L1107'>    <b>if</b> (!GetTempPath(<b>sizeof</b>(tempdir), tempdir)
<a name='L1108'>        || !GetTempFileName(tempdir, "~du", 0, ini_file)) <font color='red'>{</font>
<a name='L1109'>        <a href='../S/2858.html#L921' title='Defined at 921 in PC/bdist_wininst/install.c.'>SystemError</a>(GetLastError(),
<a name='L1110'>                     "Could not create temporary file");
<a name='L1111'>        <b>return</b> <a href='../D/1087.html' title='Multiple defined in 3 places.'>FALSE</a>;
<a name='L1112'>    <font color='red'>}</font>
<a name='L1113'>
<a name='L1114'>    dst = <a href='../S/2857.html#L60' title='Defined at 60 in PC/bdist_wininst/extract.c.'>map_new_file</a>(CREATE_ALWAYS, ini_file, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, pmd-&gt;uncomp_size,
<a name='L1115'>                        0, 0, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><i><font color='green'>/*notify*/</font></i>);
<a name='L1116'>    <b>if</b> (!dst)
<a name='L1117'>        <b>return</b> <a href='../D/1087.html' title='Multiple defined in 3 places.'>FALSE</a>;
<a name='L1118'>    <i><font color='green'>/* Up to the first \0 is the INI file data. */</font></i>
<a name='L1119'>    strncpy(dst, src, pmd-&gt;uncomp_size);
<a name='L1120'>    src += strlen(dst) + 1;
<a name='L1121'>    <i><font color='green'>/* Up to next \0 is the pre-install script */</font></i>
<a name='L1122'>    *out_preinstall_script = <a href='../D/11408.html' title='Multiple defined in 2 places.'>strdup</a>(src);
<a name='L1123'>    *out_ini_file = ini_file;
<a name='L1124'>    UnmapViewOfFile(dst);
<a name='L1125'>    <b>return</b> <a href='../D/5177.html' title='Multiple defined in 3 places.'>TRUE</a>;
<a name='L1126'><font color='red'>}</font>
<a name='L1127'>
<a name='L1128'><b>static</b> <b>void</b> <a href='../R/2472.html' title='Multiple refered from 2 places.'>PumpMessages</a>(<b>void</b>)
<a name='L1129'><font color='red'>{</font>
<a name='L1130'>    MSG msg;
<a name='L1131'>    <b>while</b> (PeekMessage(&amp;msg, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, 0, 0, PM_REMOVE)) <font color='red'>{</font>
<a name='L1132'>        TranslateMessage(&amp;msg);
<a name='L1133'>        DispatchMessage(&amp;msg);
<a name='L1134'>    <font color='red'>}</font>
<a name='L1135'><font color='red'>}</font>
<a name='L1136'>
<a name='L1137'>LRESULT CALLBACK
<a name='L1138'><a href='../S/2858.html#L1169' title='Refered from 1169 in PC/bdist_wininst/install.c.'>WindowProc</a>(HWND hwnd, UINT msg, WPARAM wParam, LPARAM lParam)
<a name='L1139'><font color='red'>{</font>
<a name='L1140'>    HDC hdc;
<a name='L1141'>    HFONT hFont;
<a name='L1142'>    <b>int</b> h;
<a name='L1143'>    PAINTSTRUCT ps;
<a name='L1144'>    <b>switch</b> (msg) <font color='red'>{</font>
<a name='L1145'>    <b>case</b> WM_PAINT:
<a name='L1146'>        hdc = BeginPaint(hwnd, &amp;ps);
<a name='L1147'>        h = GetSystemMetrics(SM_CYSCREEN) / 10;
<a name='L1148'>        hFont = CreateFont(h, 0, 0, 0, 700, <a href='../D/5177.html' title='Multiple defined in 3 places.'>TRUE</a>,
<a name='L1149'>                            0, 0, 0, 0, 0, 0, 0, "Times Roman");
<a name='L1150'>        hFont = SelectObject(hdc, hFont);
<a name='L1151'>        SetBkMode(hdc, TRANSPARENT);
<a name='L1152'>        TextOut(hdc, 15, 15, title, strlen(title));
<a name='L1153'>        SetTextColor(hdc, RGB(255, 255, 255));
<a name='L1154'>        TextOut(hdc, 10, 10, title, strlen(title));
<a name='L1155'>        DeleteObject(SelectObject(hdc, hFont));
<a name='L1156'>        EndPaint(hwnd, &amp;ps);
<a name='L1157'>        <b>return</b> 0;
<a name='L1158'>    <font color='red'>}</font>
<a name='L1159'>    <b>return</b> DefWindowProc(hwnd, msg, wParam, lParam);
<a name='L1160'><font color='red'>}</font>
<a name='L1161'>
<a name='L1162'><b>static</b> HWND <a href='../S/2858.html#L2284' title='Refered from 2284 in PC/bdist_wininst/install.c.'>CreateBackground</a>(<b>char</b> *title)
<a name='L1163'><font color='red'>{</font>
<a name='L1164'>    WNDCLASS wc;
<a name='L1165'>    HWND hwnd;
<a name='L1166'>    <b>char</b> <a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>[4096];
<a name='L1167'>
<a name='L1168'>    wc.style = CS_VREDRAW | CS_HREDRAW;
<a name='L1169'>    wc.lpfnWndProc = <a href='../S/2858.html#L1138' title='Defined at 1138 in PC/bdist_wininst/install.c.'>WindowProc</a>;
<a name='L1170'>    wc.cbWndExtra = 0;
<a name='L1171'>    wc.cbClsExtra = 0;
<a name='L1172'>    wc.hInstance = GetModuleHandle(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L1173'>    wc.hIcon = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1174'>    wc.hCursor = LoadCursor(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, IDC_ARROW);
<a name='L1175'>    wc.hbrBackground = CreateSolidBrush(RGB(0, 0, 128));
<a name='L1176'>    wc.lpszMenuName = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1177'>    wc.lpszClassName = "SetupWindowClass";
<a name='L1178'>
<a name='L1179'>    <b>if</b> (!RegisterClass(&amp;wc))
<a name='L1180'>        MessageBox(hwndMain,
<a name='L1181'>                    "Could not register window class",
<a name='L1182'>                    "Setup.exe", MB_OK);
<a name='L1183'>
<a name='L1184'>    wsprintf(<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>, "Setup %s", title);
<a name='L1185'>    hwnd = CreateWindow("SetupWindowClass",
<a name='L1186'>                         <a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>,
<a name='L1187'>                         0,
<a name='L1188'>                         0, 0,
<a name='L1189'>                         GetSystemMetrics(SM_CXFULLSCREEN),
<a name='L1190'>                         GetSystemMetrics(SM_CYFULLSCREEN),
<a name='L1191'>                         <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L1192'>                         <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L1193'>                         GetModuleHandle(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>),
<a name='L1194'>                         <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L1195'>    ShowWindow(hwnd, SW_SHOWMAXIMIZED);
<a name='L1196'>    UpdateWindow(hwnd);
<a name='L1197'>    <b>return</b> hwnd;
<a name='L1198'><font color='red'>}</font>
<a name='L1199'>
<a name='L1200'><i><font color='green'>/*</font></i>
<a name='L1201'><i><font color='green'> * Center a window on the screen</font></i>
<a name='L1202'><i><font color='green'> */</font></i>
<a name='L1203'><b>static</b> <b>void</b> <a href='../S/2858.html#L1231' title='Refered from 1231 in PC/bdist_wininst/install.c.'>CenterWindow</a>(HWND hwnd)
<a name='L1204'><font color='red'>{</font>
<a name='L1205'>    <a href='../S/2247.html#L513' title='Defined at 513 in Modules/_ctypes/_ctypes_test.c.'>RECT</a> rc;
<a name='L1206'>    <b>int</b> w, h;
<a name='L1207'>
<a name='L1208'>    GetWindowRect(hwnd, &amp;rc);
<a name='L1209'>    w = GetSystemMetrics(SM_CXSCREEN);
<a name='L1210'>    h = GetSystemMetrics(SM_CYSCREEN);
<a name='L1211'>    MoveWindow(hwnd,
<a name='L1212'>               (w - (rc.right-rc.left))/2,
<a name='L1213'>               (h - (rc.bottom-rc.top))/2,
<a name='L1214'>                rc.right-rc.left, rc.bottom-rc.top, <a href='../D/1087.html' title='Multiple defined in 3 places.'>FALSE</a>);
<a name='L1215'><font color='red'>}</font>
<a name='L1216'>
<a name='L1217'><font color='darkred'>#include</font> &lt;prsht.h&gt;
<a name='L1218'>
<a name='L1219'><a href='../S/2583.html#L42' title='Defined at 42 in Modules/_multiprocessing/multiprocessing.h.'>BOOL</a> CALLBACK
<a name='L1220'><a href='../S/2858.html#L2108' title='Refered from 2108 in PC/bdist_wininst/install.c.'>IntroDlgProc</a>(HWND hwnd, UINT msg, WPARAM wParam, LPARAM lParam)
<a name='L1221'><font color='red'>{</font>
<a name='L1222'>    LPNMHDR lpnm;
<a name='L1223'>    <b>char</b> Buffer[4096];
<a name='L1224'>
<a name='L1225'>    <b>switch</b> (msg) <font color='red'>{</font>
<a name='L1226'>    <b>case</b> WM_INITDIALOG:
<a name='L1227'>        <a href='../S/2858.html#L1034' title='Defined at 1034 in PC/bdist_wininst/install.c.'>create_bitmap</a>(hwnd);
<a name='L1228'>        <b>if</b>(hBitmap)
<a name='L1229'>            SendDlgItemMessage(hwnd, <a href='../S/2861.html#L35' title='Defined at 35 in PC/bdist_wininst/resource.h.'>IDC_BITMAP</a>, STM_SETIMAGE,
<a name='L1230'>                               IMAGE_BITMAP, (LPARAM)hBitmap);
<a name='L1231'>        <a href='../S/2858.html#L1203' title='Defined at 1203 in PC/bdist_wininst/install.c.'>CenterWindow</a>(GetParent(hwnd));
<a name='L1232'>        wsprintf(Buffer,
<a name='L1233'>                  "This Wizard will install %s on your computer. "
<a name='L1234'>                  "Click Next to continue "
<a name='L1235'>                  "or Cancel to exit the Setup Wizard.",
<a name='L1236'>                  meta_name);
<a name='L1237'>        SetDlgItemText(hwnd, <a href='../S/2861.html#L22' title='Defined at 22 in PC/bdist_wininst/resource.h.'>IDC_TITLE</a>, Buffer);
<a name='L1238'>        SetDlgItemText(hwnd, <a href='../S/2861.html#L32' title='Defined at 32 in PC/bdist_wininst/resource.h.'>IDC_INTRO_TEXT</a>, info);
<a name='L1239'>        SetDlgItemText(hwnd, <a href='../S/2861.html#L34' title='Defined at 34 in PC/bdist_wininst/resource.h.'>IDC_BUILD_INFO</a>, build_info);
<a name='L1240'>        <b>return</b> <a href='../D/1087.html' title='Multiple defined in 3 places.'>FALSE</a>;
<a name='L1241'>
<a name='L1242'>    <b>case</b> WM_NOTIFY:
<a name='L1243'>        lpnm = (LPNMHDR) lParam;
<a name='L1244'>
<a name='L1245'>        <b>switch</b> (lpnm-&gt;<a href='../S/2755.html#L28' title='Defined at 28 in Modules/zlib/inftrees.h.'>code</a>) <font color='red'>{</font>
<a name='L1246'>        <b>case</b> PSN_SETACTIVE:
<a name='L1247'>            PropSheet_SetWizButtons(GetParent(hwnd), PSWIZB_NEXT);
<a name='L1248'>            <b>break</b>;
<a name='L1249'>
<a name='L1250'>        <b>case</b> PSN_WIZNEXT:
<a name='L1251'>            <b>break</b>;
<a name='L1252'>
<a name='L1253'>        <b>case</b> PSN_RESET:
<a name='L1254'>            <b>break</b>;
<a name='L1255'>
<a name='L1256'>        <b>default</b>:
<a name='L1257'>            <b>break</b>;
<a name='L1258'>        <font color='red'>}</font>
<a name='L1259'>    <font color='red'>}</font>
<a name='L1260'>    <b>return</b> <a href='../D/1087.html' title='Multiple defined in 3 places.'>FALSE</a>;
<a name='L1261'><font color='red'>}</font>
<a name='L1262'>
<a name='L1263'><font color='darkred'>#ifdef</font> USE_OTHER_PYTHON_VERSIONS
<a name='L1264'><i><font color='green'>/* These are really private variables used to communicate</font></i>
<a name='L1265'><i><font color='green'> * between StatusRoutine and CheckPythonExe</font></i>
<a name='L1266'><i><font color='green'> */</font></i>
<a name='L1267'><b>char</b> bound_image_dll[_MAX_PATH];
<a name='L1268'><b>int</b> bound_image_major;
<a name='L1269'><b>int</b> bound_image_minor;
<a name='L1270'>
<a name='L1271'><b>static</b> <a href='../S/2583.html#L42' title='Defined at 42 in Modules/_multiprocessing/multiprocessing.h.'>BOOL</a> <a href='../S/2247.html#L182' title='Defined at 182 in Modules/_ctypes/_ctypes_test.c.'>__stdcall</a> <a href='../S/2858.html#L1385' title='Refered from 1385 in PC/bdist_wininst/install.c.'>StatusRoutine</a>(IMAGEHLP_STATUS_REASON reason,
<a name='L1272'>                                    PSTR ImageName,
<a name='L1273'>                                    PSTR DllName,
<a name='L1274'>                                    ULONG Va,
<a name='L1275'>                                    ULONG Parameter)
<a name='L1276'><font color='red'>{</font>
<a name='L1277'>    <b>char</b> fname[_MAX_PATH];
<a name='L1278'>    <b>int</b> int_version;
<a name='L1279'>
<a name='L1280'>    <b>switch</b>(reason) <font color='red'>{</font>
<a name='L1281'>    <b>case</b> BindOutOfMemory:
<a name='L1282'>    <b>case</b> BindRvaToVaFailed:
<a name='L1283'>    <b>case</b> BindNoRoomInImage:
<a name='L1284'>    <b>case</b> BindImportProcedureFailed:
<a name='L1285'>        <b>break</b>;
<a name='L1286'>
<a name='L1287'>    <b>case</b> BindImportProcedure:
<a name='L1288'>    <b>case</b> BindForwarder:
<a name='L1289'>    <b>case</b> BindForwarderNOT:
<a name='L1290'>    <b>case</b> BindImageModified:
<a name='L1291'>    <b>case</b> BindExpandFileHeaders:
<a name='L1292'>    <b>case</b> BindImageComplete:
<a name='L1293'>    <b>case</b> BindSymbolsNotUpdated:
<a name='L1294'>    <b>case</b> BindMismatchedSymbols:
<a name='L1295'>    <b>case</b> BindImportModuleFailed:
<a name='L1296'>        <b>break</b>;
<a name='L1297'>
<a name='L1298'>    <b>case</b> BindImportModule:
<a name='L1299'>        <b>if</b> (1 == sscanf(DllName, "python%d", &amp;int_version)) <font color='red'>{</font>
<a name='L1300'>            SearchPath(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, DllName, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, <b>sizeof</b>(fname),
<a name='L1301'>                       fname, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L1302'>            strcpy(bound_image_dll, fname);
<a name='L1303'>            bound_image_major = int_version / 10;
<a name='L1304'>            bound_image_minor = int_version % 10;
<a name='L1305'>            OutputDebugString("BOUND ");
<a name='L1306'>            OutputDebugString(fname);
<a name='L1307'>            OutputDebugString("\n");
<a name='L1308'>        <font color='red'>}</font>
<a name='L1309'>        <b>break</b>;
<a name='L1310'>    <font color='red'>}</font>
<a name='L1311'>    <b>return</b> <a href='../D/5177.html' title='Multiple defined in 3 places.'>TRUE</a>;
<a name='L1312'><font color='red'>}</font>
<a name='L1313'>
<a name='L1314'><i><font color='green'>/*</font></i>
<a name='L1315'><i><font color='green'> */</font></i>
<a name='L1316'><b>static</b> LPSTR <a href='../S/2858.html#L1397' title='Refered from 1397 in PC/bdist_wininst/install.c.'>get_sys_prefix</a>(LPSTR exe, LPSTR dll)
<a name='L1317'><font color='red'>{</font>
<a name='L1318'>    <b>void</b> (__cdecl * <a href='../S/3138.html#L319' title='Defined at 319 in Python/pythonrun.c.'>Py_Initialize</a>)(<b>void</b>);
<a name='L1319'>    <b>void</b> (__cdecl * <a href='../S/3138.html#L667' title='Defined at 667 in Python/pythonrun.c.'>Py_SetProgramName</a>)(<b>char</b> *);
<a name='L1320'>    <b>void</b> (__cdecl * <a href='../S/3138.html#L370' title='Defined at 370 in Python/pythonrun.c.'>Py_Finalize</a>)(<b>void</b>);
<a name='L1321'>    <b>void</b>* (__cdecl * <a href='../S/3144.html#L44' title='Defined at 44 in Python/sysmodule.c.'>PySys_GetObject</a>)(<b>char</b> *);
<a name='L1322'>    <b>void</b> (__cdecl * <a href='../S/3144.html#L1917' title='Defined at 1917 in Python/sysmodule.c.'>PySys_SetArgv</a>)(<b>int</b>, <b>char</b> **);
<a name='L1323'>    <b>char</b>* (__cdecl * <a href='../D/4145.html' title='Multiple defined in 4 places.'>Py_GetPrefix</a>)(<b>void</b>);
<a name='L1324'>    <b>char</b>* (__cdecl * <a href='../D/4143.html' title='Multiple defined in 4 places.'>Py_GetPath</a>)(<b>void</b>);
<a name='L1325'>    HINSTANCE hPython;
<a name='L1326'>    LPSTR <a href='../S/2664.html#L148' title='Defined at 148 in Modules/expat/xmlparse.c.'>prefix</a> = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1327'>    <b>int</b> (__cdecl * <a href='../S/3138.html#L2444' title='Defined at 2444 in Python/pythonrun.c.'>PyRun_SimpleString</a>)(<b>char</b> *);
<a name='L1328'>
<a name='L1329'>    <font color='red'>{</font>
<a name='L1330'>        <b>char</b> Buffer[256];
<a name='L1331'>        wsprintf(Buffer, "PYTHONHOME=%s", exe);
<a name='L1332'>        *strrchr(Buffer, '\\') = '\0';
<a name='L1333'><i><font color='green'>//      MessageBox(GetFocus(), Buffer, "PYTHONHOME", MB_OK);</font></i>
<a name='L1334'>                _putenv(Buffer);
<a name='L1335'>                _putenv("PYTHONPATH=");
<a name='L1336'>    <font color='red'>}</font>
<a name='L1337'>
<a name='L1338'>    hPython = LoadLibrary(dll);
<a name='L1339'>    <b>if</b> (!hPython)
<a name='L1340'>        <b>return</b> <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1341'>    <a href='../S/3138.html#L319' title='Defined at 319 in Python/pythonrun.c.'>Py_Initialize</a> = (<b>void</b> (*)(<b>void</b>))<a href='../D/1434.html' title='Multiple defined in 2 places.'>GetProcAddress</a>
<a name='L1342'>        (hPython,"Py_Initialize");
<a name='L1343'>
<a name='L1344'>    <a href='../S/3144.html#L1917' title='Defined at 1917 in Python/sysmodule.c.'>PySys_SetArgv</a> = (<b>void</b> (*)(<b>int</b>, <b>char</b> **))<a href='../D/1434.html' title='Multiple defined in 2 places.'>GetProcAddress</a>
<a name='L1345'>        (hPython,"PySys_SetArgv");
<a name='L1346'>
<a name='L1347'>    <a href='../S/3138.html#L2444' title='Defined at 2444 in Python/pythonrun.c.'>PyRun_SimpleString</a> = (<b>int</b> (*)(<b>char</b> *))<a href='../D/1434.html' title='Multiple defined in 2 places.'>GetProcAddress</a>
<a name='L1348'>        (hPython,"PyRun_SimpleString");
<a name='L1349'>
<a name='L1350'>    <a href='../S/3138.html#L667' title='Defined at 667 in Python/pythonrun.c.'>Py_SetProgramName</a> = (<b>void</b> (*)(<b>char</b> *))<a href='../D/1434.html' title='Multiple defined in 2 places.'>GetProcAddress</a>
<a name='L1351'>        (hPython,"Py_SetProgramName");
<a name='L1352'>
<a name='L1353'>    <a href='../S/3144.html#L44' title='Defined at 44 in Python/sysmodule.c.'>PySys_GetObject</a> = (<b>void</b>* (*)(<b>char</b> *))<a href='../D/1434.html' title='Multiple defined in 2 places.'>GetProcAddress</a>
<a name='L1354'>        (hPython,"PySys_GetObject");
<a name='L1355'>
<a name='L1356'>    <a href='../D/4145.html' title='Multiple defined in 4 places.'>Py_GetPrefix</a> = (<b>char</b> * (*)(<b>void</b>))<a href='../D/1434.html' title='Multiple defined in 2 places.'>GetProcAddress</a>
<a name='L1357'>        (hPython,"Py_GetPrefix");
<a name='L1358'>
<a name='L1359'>    <a href='../D/4143.html' title='Multiple defined in 4 places.'>Py_GetPath</a> = (<b>char</b> * (*)(<b>void</b>))<a href='../D/1434.html' title='Multiple defined in 2 places.'>GetProcAddress</a>
<a name='L1360'>        (hPython,"Py_GetPath");
<a name='L1361'>
<a name='L1362'>    <a href='../S/3138.html#L370' title='Defined at 370 in Python/pythonrun.c.'>Py_Finalize</a> = (<b>void</b> (*)(<b>void</b>))<a href='../D/1434.html' title='Multiple defined in 2 places.'>GetProcAddress</a>(hPython,
<a name='L1363'>                                                  "Py_Finalize");
<a name='L1364'>    <a href='../S/3138.html#L667' title='Defined at 667 in Python/pythonrun.c.'>Py_SetProgramName</a>(exe);
<a name='L1365'>    <a href='../S/3138.html#L319' title='Defined at 319 in Python/pythonrun.c.'>Py_Initialize</a>();
<a name='L1366'>    <a href='../S/3144.html#L1917' title='Defined at 1917 in Python/sysmodule.c.'>PySys_SetArgv</a>(1, &amp;exe);
<a name='L1367'>
<a name='L1368'>    MessageBox(GetFocus(), <a href='../D/4145.html' title='Multiple defined in 4 places.'>Py_GetPrefix</a>(), "PREFIX", MB_OK);
<a name='L1369'>    MessageBox(GetFocus(), <a href='../D/4143.html' title='Multiple defined in 4 places.'>Py_GetPath</a>(), "PATH", MB_OK);
<a name='L1370'>
<a name='L1371'>    <a href='../S/3138.html#L370' title='Defined at 370 in Python/pythonrun.c.'>Py_Finalize</a>();
<a name='L1372'>    FreeLibrary(hPython);
<a name='L1373'>
<a name='L1374'>    <b>return</b> <a href='../S/2664.html#L148' title='Defined at 148 in Modules/expat/xmlparse.c.'>prefix</a>;
<a name='L1375'><font color='red'>}</font>
<a name='L1376'>
<a name='L1377'><b>static</b> <a href='../S/2583.html#L42' title='Defined at 42 in Modules/_multiprocessing/multiprocessing.h.'>BOOL</a>
<a name='L1378'><a href='../S/2858.html#L1435' title='Refered from 1435 in PC/bdist_wininst/install.c.'>CheckPythonExe</a>(LPSTR pathname, LPSTR version, <b>int</b> *pmajor, <b>int</b> *pminor)
<a name='L1379'><font color='red'>{</font>
<a name='L1380'>    bound_image_dll[0] = '\0';
<a name='L1381'>    <b>if</b> (!BindImageEx(BIND_NO_BOUND_IMPORTS | BIND_NO_UPDATE | BIND_ALL_IMAGES,
<a name='L1382'>                     pathname,
<a name='L1383'>                     <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L1384'>                     <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L1385'>                     <a href='../S/2858.html#L1271' title='Defined at 1271 in PC/bdist_wininst/install.c.'>StatusRoutine</a>))
<a name='L1386'>        <b>return</b> <a href='../S/2858.html#L921' title='Defined at 921 in PC/bdist_wininst/install.c.'>SystemError</a>(0, "Could not bind image");
<a name='L1387'>    <b>if</b> (bound_image_dll[0] == '\0')
<a name='L1388'>        <b>return</b> <a href='../S/2858.html#L921' title='Defined at 921 in PC/bdist_wininst/install.c.'>SystemError</a>(0, "Does not seem to be a python executable");
<a name='L1389'>    *pmajor = bound_image_major;
<a name='L1390'>    *pminor = bound_image_minor;
<a name='L1391'>    <b>if</b> (version &amp;&amp; *version) <font color='red'>{</font>
<a name='L1392'>        <b>char</b> core_version[12];
<a name='L1393'>        wsprintf(core_version, "%d.%d", bound_image_major, bound_image_minor);
<a name='L1394'>        <b>if</b> (strcmp(version, core_version))
<a name='L1395'>            <b>return</b> <a href='../S/2858.html#L921' title='Defined at 921 in PC/bdist_wininst/install.c.'>SystemError</a>(0, "Wrong Python version");
<a name='L1396'>    <font color='red'>}</font>
<a name='L1397'>    <a href='../S/2858.html#L1316' title='Defined at 1316 in PC/bdist_wininst/install.c.'>get_sys_prefix</a>(pathname, bound_image_dll);
<a name='L1398'>    <b>return</b> <a href='../D/5177.html' title='Multiple defined in 3 places.'>TRUE</a>;
<a name='L1399'><font color='red'>}</font>
<a name='L1400'>
<a name='L1401'><i><font color='green'>/*</font></i>
<a name='L1402'><i><font color='green'> * Browse for other python versions. Insert it into the listbox specified</font></i>
<a name='L1403'><i><font color='green'> * by hwnd. version, if not NULL or empty, is the version required.</font></i>
<a name='L1404'><i><font color='green'> */</font></i>
<a name='L1405'><b>static</b> <a href='../S/2583.html#L42' title='Defined at 42 in Modules/_multiprocessing/multiprocessing.h.'>BOOL</a> GetOtherPythonVersion(HWND hwnd, LPSTR version)
<a name='L1406'><font color='red'>{</font>
<a name='L1407'>    <b>char</b> vers_name[_MAX_PATH + 80];
<a name='L1408'>    DWORD itemindex;
<a name='L1409'>    OPENFILENAME of;
<a name='L1410'>    <b>char</b> pathname[_MAX_PATH];
<a name='L1411'>    DWORD <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L1412'>
<a name='L1413'>    strcpy(pathname, "python.exe");
<a name='L1414'>
<a name='L1415'>    memset(&amp;of, 0, <b>sizeof</b>(of));
<a name='L1416'>    of.lStructSize = <b>sizeof</b>(OPENFILENAME);
<a name='L1417'>    of.hwndOwner = GetParent(hwnd);
<a name='L1418'>    of.hInstance = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1419'>    of.lpstrFilter = "python.exe\0python.exe\0";
<a name='L1420'>    of.lpstrCustomFilter = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1421'>    of.nMaxCustFilter = 0;
<a name='L1422'>    of.nFilterIndex = 1;
<a name='L1423'>    of.lpstrFile = pathname;
<a name='L1424'>    of.nMaxFile = <b>sizeof</b>(pathname);
<a name='L1425'>    of.lpstrFileTitle = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1426'>    of.nMaxFileTitle = 0;
<a name='L1427'>    of.lpstrInitialDir = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L1428'>    of.lpstrTitle = "Python executable";
<a name='L1429'>    of.Flags = OFN_FILEMUSTEXIST | OFN_PATHMUSTEXIST;
<a name='L1430'>    of.lpstrDefExt = "exe";
<a name='L1431'>
<a name='L1432'>    <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = GetOpenFileName(&amp;of);
<a name='L1433'>    <b>if</b> (<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>) <font color='red'>{</font>
<a name='L1434'>        <b>int</b> major, minor;
<a name='L1435'>        <b>if</b> (!<a href='../S/2858.html#L1378' title='Defined at 1378 in PC/bdist_wininst/install.c.'>CheckPythonExe</a>(pathname, version, &amp;major, &amp;minor)) <font color='red'>{</font>
<a name='L1436'>            <b>return</b> <a href='../D/1087.html' title='Multiple defined in 3 places.'>FALSE</a>;
<a name='L1437'>        <font color='red'>}</font>
<a name='L1438'>        *strrchr(pathname, '\\') = '\0';
<a name='L1439'>        wsprintf(vers_name, "Python Version %d.%d in %s",
<a name='L1440'>                  major, minor, pathname);
<a name='L1441'>        itemindex = SendMessage(hwnd, LB_INSERTSTRING, -1,
<a name='L1442'>                                (LPARAM)(LPSTR)vers_name);
<a name='L1443'>        SendMessage(hwnd, LB_SETCURSEL, itemindex, 0);
<a name='L1444'>        SendMessage(hwnd, LB_SETITEMDATA, itemindex,
<a name='L1445'>                    (LPARAM)(LPSTR)<a href='../D/11408.html' title='Multiple defined in 2 places.'>strdup</a>(pathname));
<a name='L1446'>        <b>return</b> <a href='../D/5177.html' title='Multiple defined in 3 places.'>TRUE</a>;
<a name='L1447'>    <font color='red'>}</font>
<a name='L1448'>    <b>return</b> <a href='../D/1087.html' title='Multiple defined in 3 places.'>FALSE</a>;
<a name='L1449'><font color='red'>}</font>
<a name='L1450'><font color='darkred'>#endif</font> <i><font color='green'>/* USE_OTHER_PYTHON_VERSIONS */</font></i>
<a name='L1451'>
<a name='L1452'><b>typedef</b> <b>struct</b> _InstalledVersionInfo <font color='red'>{</font>
<a name='L1453'>    <b>char</b> <a href='../S/2664.html#L148' title='Defined at 148 in Modules/expat/xmlparse.c.'>prefix</a>[<a href='../S/2696.html#L2498' title='Defined at 2498 in Modules/posixmodule.c.'>MAX_PATH</a>+1]; <i><font color='green'>// sys.prefix directory.</font></i>
<a name='L1454'>    HKEY hkey; <i><font color='green'>// Is this Python in HKCU or HKLM?</font></i>
<a name='L1455'><font color='red'>}</font> <a href='../R/1630.html' title='Multiple refered from 4 places.'>InstalledVersionInfo</a>;
<a name='L1456'>
<a name='L1457'>
<a name='L1458'><i><font color='green'>/*</font></i>
<a name='L1459'><i><font color='green'> * Fill the listbox specified by hwnd with all python versions found</font></i>
<a name='L1460'><i><font color='green'> * in the registry. version, if not NULL or empty, is the version</font></i>
<a name='L1461'><i><font color='green'> * required.</font></i>
<a name='L1462'><i><font color='green'> */</font></i>
<a name='L1463'><b>static</b> <a href='../S/2583.html#L42' title='Defined at 42 in Modules/_multiprocessing/multiprocessing.h.'>BOOL</a> <a href='../R/1292.html' title='Multiple refered from 2 places.'>GetPythonVersions</a>(HWND hwnd, HKEY hkRoot, LPSTR version)
<a name='L1464'><font color='red'>{</font>
<a name='L1465'>    DWORD index = 0;
<a name='L1466'>    <b>char</b> core_version[80];
<a name='L1467'>    HKEY hKey;
<a name='L1468'>    <a href='../S/2583.html#L42' title='Defined at 42 in Modules/_multiprocessing/multiprocessing.h.'>BOOL</a> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = <a href='../D/5177.html' title='Multiple defined in 3 places.'>TRUE</a>;
<a name='L1469'>    DWORD bufsize;
<a name='L1470'>
<a name='L1471'>    <b>if</b> (ERROR_SUCCESS != RegOpenKeyEx(hkRoot,
<a name='L1472'>                                       "Software\\Python\\PythonCore",
<a name='L1473'>                                       0,       KEY_READ, &amp;hKey))
<a name='L1474'>        <b>return</b> <a href='../D/1087.html' title='Multiple defined in 3 places.'>FALSE</a>;
<a name='L1475'>    bufsize = <b>sizeof</b>(core_version);
<a name='L1476'>    <b>while</b> (ERROR_SUCCESS == RegEnumKeyEx(hKey, index,
<a name='L1477'>                                          core_version, &amp;bufsize, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L1478'>                                          <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>)) <font color='red'>{</font>
<a name='L1479'>        <b>char</b> subkey_name[80], vers_name[80];
<a name='L1480'>        <b>int</b> itemindex;
<a name='L1481'>        DWORD value_size;
<a name='L1482'>        HKEY hk;
<a name='L1483'>
<a name='L1484'>        bufsize = <b>sizeof</b>(core_version);
<a name='L1485'>        ++index;
<a name='L1486'>        <b>if</b> (version &amp;&amp; *version &amp;&amp; strcmp(version, core_version))
<a name='L1487'>            <b>continue</b>;
<a name='L1488'>
<a name='L1489'>        wsprintf(vers_name, "Python Version %s (found in registry)",
<a name='L1490'>                  core_version);
<a name='L1491'>        wsprintf(subkey_name,
<a name='L1492'>                  "Software\\Python\\PythonCore\\%s\\InstallPath",
<a name='L1493'>                  core_version);
<a name='L1494'>        <b>if</b> (ERROR_SUCCESS == RegOpenKeyEx(hkRoot, subkey_name, 0, KEY_READ, &amp;hk)) <font color='red'>{</font>
<a name='L1495'>            <a href='../S/2858.html#L1455' title='Defined at 1455 in PC/bdist_wininst/install.c.'>InstalledVersionInfo</a> *ivi =
<a name='L1496'>                  (<a href='../S/2858.html#L1455' title='Defined at 1455 in PC/bdist_wininst/install.c.'>InstalledVersionInfo</a> *)malloc(<b>sizeof</b>(<a href='../S/2858.html#L1455' title='Defined at 1455 in PC/bdist_wininst/install.c.'>InstalledVersionInfo</a>));
<a name='L1497'>            value_size = <b>sizeof</b>(ivi-&gt;<a href='../S/2664.html#L148' title='Defined at 148 in Modules/expat/xmlparse.c.'>prefix</a>);
<a name='L1498'>            <b>if</b> (ivi &amp;&amp;
<a name='L1499'>                ERROR_SUCCESS == RegQueryValueEx(hk, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L1500'>                                                 ivi-&gt;<a href='../S/2664.html#L148' title='Defined at 148 in Modules/expat/xmlparse.c.'>prefix</a>, &amp;value_size)) <font color='red'>{</font>
<a name='L1501'>                itemindex = SendMessage(hwnd, LB_ADDSTRING, 0,
<a name='L1502'>                                        (LPARAM)(LPSTR)vers_name);
<a name='L1503'>                ivi-&gt;hkey = hkRoot;
<a name='L1504'>                SendMessage(hwnd, LB_SETITEMDATA, itemindex,
<a name='L1505'>                            (LPARAM)(LPSTR)ivi);
<a name='L1506'>            <font color='red'>}</font>
<a name='L1507'>            RegCloseKey(hk);
<a name='L1508'>        <font color='red'>}</font>
<a name='L1509'>    <font color='red'>}</font>
<a name='L1510'>    RegCloseKey(hKey);
<a name='L1511'>    <b>return</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L1512'><font color='red'>}</font>
<a name='L1513'>
<a name='L1514'><i><font color='green'>/* Determine if the current user can write to HKEY_LOCAL_MACHINE */</font></i>
<a name='L1515'><a href='../S/2583.html#L42' title='Defined at 42 in Modules/_multiprocessing/multiprocessing.h.'>BOOL</a> <a href='../R/1468.html' title='Multiple refered from 3 places.'>HasLocalMachinePrivs</a>()
<a name='L1516'><font color='red'>{</font>
<a name='L1517'>                HKEY hKey;
<a name='L1518'>                DWORD <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L1519'>                <b>static</b> <b>char</b> KeyName[] =
<a name='L1520'>                        "Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall";
<a name='L1521'>
<a name='L1522'>                <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = RegOpenKeyEx(HKEY_LOCAL_MACHINE,
<a name='L1523'>                                          KeyName,
<a name='L1524'>                                          0,
<a name='L1525'>                                          KEY_CREATE_SUB_KEY,
<a name='L1526'>                                          &amp;hKey);
<a name='L1527'>                <b>if</b> (<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>==0)
<a name='L1528'>                        RegCloseKey(hKey);
<a name='L1529'>                <b>return</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>==0;
<a name='L1530'><font color='red'>}</font>
<a name='L1531'>
<a name='L1532'><i><font color='green'>// Check the root registry key to use - either HKLM or HKCU.</font></i>
<a name='L1533'><i><font color='green'>// If Python is installed in HKCU, then our extension also must be installed</font></i>
<a name='L1534'><i><font color='green'>// in HKCU - as Python won't be available for other users, we shouldn't either</font></i>
<a name='L1535'><i><font color='green'>// (and will fail if we are!)</font></i>
<a name='L1536'><i><font color='green'>// If Python is installed in HKLM, then we will also prefer to use HKLM, but</font></i>
<a name='L1537'><i><font color='green'>// this may not be possible - so we silently fall back to HKCU.</font></i>
<a name='L1538'><i><font color='green'>//</font></i>
<a name='L1539'><i><font color='green'>// We assume hkey_root is already set to where Python itself is installed.</font></i>
<a name='L1540'><b>void</b> <a href='../S/2858.html#L1926' title='Refered from 1926 in PC/bdist_wininst/install.c.'>CheckRootKey</a>(HWND hwnd)
<a name='L1541'><font color='red'>{</font>
<a name='L1542'>    <b>if</b> (hkey_root==HKEY_CURRENT_USER) <font color='red'>{</font>
<a name='L1543'>        ; <i><font color='green'>// as above, always install ourself in HKCU too.</font></i>
<a name='L1544'>    <font color='red'>}</font> <b>else</b> <b>if</b> (hkey_root==HKEY_LOCAL_MACHINE) <font color='red'>{</font>
<a name='L1545'>        <i><font color='green'>// Python in HKLM, but we may or may not have permissions there.</font></i>
<a name='L1546'>        <i><font color='green'>// Open the uninstall key with 'create' permissions - if this fails,</font></i>
<a name='L1547'>        <i><font color='green'>// we don't have permission.</font></i>
<a name='L1548'>        <b>if</b> (!<a href='../S/2858.html#L1515' title='Defined at 1515 in PC/bdist_wininst/install.c.'>HasLocalMachinePrivs</a>())
<a name='L1549'>            hkey_root = HKEY_CURRENT_USER;
<a name='L1550'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1551'>        MessageBox(hwnd, "Don't know Python's installation type",
<a name='L1552'>                           "Strange", MB_OK | MB_ICONSTOP);
<a name='L1553'>        <i><font color='green'>/* Default to wherever they can, but preferring HKLM */</font></i>
<a name='L1554'>        hkey_root = <a href='../S/2858.html#L1515' title='Defined at 1515 in PC/bdist_wininst/install.c.'>HasLocalMachinePrivs</a>() ? HKEY_LOCAL_MACHINE : HKEY_CURRENT_USER;
<a name='L1555'>    <font color='red'>}</font>
<a name='L1556'><font color='red'>}</font>
<a name='L1557'>
<a name='L1558'><i><font color='green'>/* Return the installation scheme depending on Python version number */</font></i>
<a name='L1559'><a href='../S/2856.html#L75' title='Defined at 75 in PC/bdist_wininst/archive.h.'>SCHEME</a> *<a href='../R/1296.html' title='Multiple refered from 2 places.'>GetScheme</a>(<b>int</b> major, <b>int</b> minor)
<a name='L1560'><font color='red'>{</font>
<a name='L1561'>    <b>if</b> (major &gt; 2)
<a name='L1562'>        <b>return</b> new_scheme;
<a name='L1563'>    <b>else</b> <b>if</b>((major == 2) &amp;&amp; (minor &gt;= 2))
<a name='L1564'>        <b>return</b> new_scheme;
<a name='L1565'>    <b>return</b> old_scheme;
<a name='L1566'><font color='red'>}</font>
<a name='L1567'>
<a name='L1568'><a href='../S/2583.html#L42' title='Defined at 42 in Modules/_multiprocessing/multiprocessing.h.'>BOOL</a> CALLBACK
<a name='L1569'><a href='../S/2858.html#L2116' title='Refered from 2116 in PC/bdist_wininst/install.c.'>SelectPythonDlgProc</a>(HWND hwnd, UINT msg, WPARAM wParam, LPARAM lParam)
<a name='L1570'><font color='red'>{</font>
<a name='L1571'>    LPNMHDR lpnm;
<a name='L1572'>
<a name='L1573'>    <b>switch</b> (msg) <font color='red'>{</font>
<a name='L1574'>    <b>case</b> WM_INITDIALOG:
<a name='L1575'>        <b>if</b> (hBitmap)
<a name='L1576'>            SendDlgItemMessage(hwnd, <a href='../S/2861.html#L35' title='Defined at 35 in PC/bdist_wininst/resource.h.'>IDC_BITMAP</a>, STM_SETIMAGE,
<a name='L1577'>                               IMAGE_BITMAP, (LPARAM)hBitmap);
<a name='L1578'>        <a href='../S/2858.html#L1463' title='Defined at 1463 in PC/bdist_wininst/install.c.'>GetPythonVersions</a>(GetDlgItem(hwnd, <a href='../S/2861.html#L33' title='Defined at 33 in PC/bdist_wininst/resource.h.'>IDC_VERSIONS_LIST</a>),
<a name='L1579'>                           HKEY_LOCAL_MACHINE, target_version);
<a name='L1580'>        <a href='../S/2858.html#L1463' title='Defined at 1463 in PC/bdist_wininst/install.c.'>GetPythonVersions</a>(GetDlgItem(hwnd, <a href='../S/2861.html#L33' title='Defined at 33 in PC/bdist_wininst/resource.h.'>IDC_VERSIONS_LIST</a>),
<a name='L1581'>                           HKEY_CURRENT_USER, target_version);
<a name='L1582'>        <font color='red'>{</font>               <i><font color='green'>/* select the last entry which is the highest python</font></i>
<a name='L1583'><i><font color='green'>                   version found */</font></i>
<a name='L1584'>            <b>int</b> count;
<a name='L1585'>            count = SendDlgItemMessage(hwnd, <a href='../S/2861.html#L33' title='Defined at 33 in PC/bdist_wininst/resource.h.'>IDC_VERSIONS_LIST</a>,
<a name='L1586'>                                        LB_GETCOUNT, 0, 0);
<a name='L1587'>            <b>if</b> (count &amp;&amp; count != LB_ERR)
<a name='L1588'>                SendDlgItemMessage(hwnd, <a href='../S/2861.html#L33' title='Defined at 33 in PC/bdist_wininst/resource.h.'>IDC_VERSIONS_LIST</a>, LB_SETCURSEL,
<a name='L1589'>                                    count-1, 0);
<a name='L1590'>
<a name='L1591'>            <i><font color='green'>/* If a specific Python version is required,</font></i>
<a name='L1592'><i><font color='green'>             * display a prominent notice showing this fact.</font></i>
<a name='L1593'><i><font color='green'>             */</font></i>
<a name='L1594'>            <b>if</b> (target_version &amp;&amp; target_version[0]) <font color='red'>{</font>
<a name='L1595'>                <b>char</b> <a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>[4096];
<a name='L1596'>                wsprintf(<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>,
<a name='L1597'>                         "Python %s is required for this package. "
<a name='L1598'>                         "Select installation to use:",
<a name='L1599'>                         target_version);
<a name='L1600'>                SetDlgItemText(hwnd, <a href='../S/2861.html#L22' title='Defined at 22 in PC/bdist_wininst/resource.h.'>IDC_TITLE</a>, <a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>);
<a name='L1601'>            <font color='red'>}</font>
<a name='L1602'>
<a name='L1603'>            <b>if</b> (count == 0) <font color='red'>{</font>
<a name='L1604'>                <b>char</b> Buffer[4096];
<a name='L1605'>                <b>char</b> *msg;
<a name='L1606'>                <b>if</b> (target_version &amp;&amp; target_version[0]) <font color='red'>{</font>
<a name='L1607'>                    wsprintf(Buffer,
<a name='L1608'>                             "Python version %s required, which was not found"
<a name='L1609'>                             " in the registry.", target_version);
<a name='L1610'>                    msg = Buffer;
<a name='L1611'>                <font color='red'>}</font> <b>else</b>
<a name='L1612'>                    msg = "No Python installation found in the registry.";
<a name='L1613'>                MessageBox(hwnd, msg, "Cannot install",
<a name='L1614'>                           MB_OK | MB_ICONSTOP);
<a name='L1615'>            <font color='red'>}</font>
<a name='L1616'>        <font color='red'>}</font>
<a name='L1617'>        <b>goto</b> UpdateInstallDir;
<a name='L1618'>        <b>break</b>;
<a name='L1619'>
<a name='L1620'>    <b>case</b> WM_COMMAND:
<a name='L1621'>        <b>switch</b> (LOWORD(wParam)) <font color='red'>{</font>
<a name='L1622'><i><font color='green'>/*</font></i>
<a name='L1623'><i><font color='green'>  case IDC_OTHERPYTHON:</font></i>
<a name='L1624'><i><font color='green'>  if (GetOtherPythonVersion(GetDlgItem(hwnd, IDC_VERSIONS_LIST),</font></i>
<a name='L1625'><i><font color='green'>  target_version))</font></i>
<a name='L1626'><i><font color='green'>  goto UpdateInstallDir;</font></i>
<a name='L1627'><i><font color='green'>  break;</font></i>
<a name='L1628'><i><font color='green'>*/</font></i>
<a name='L1629'>        <b>case</b> <a href='../S/2861.html#L33' title='Defined at 33 in PC/bdist_wininst/resource.h.'>IDC_VERSIONS_LIST</a>:
<a name='L1630'>            <b>switch</b> (HIWORD(wParam)) <font color='red'>{</font>
<a name='L1631'>                <b>int</b> id;
<a name='L1632'>            <b>case</b> LBN_SELCHANGE:
<a name='L1633'>              UpdateInstallDir:
<a name='L1634'>                PropSheet_SetWizButtons(GetParent(hwnd),
<a name='L1635'>                                        PSWIZB_BACK | PSWIZB_NEXT);
<a name='L1636'>                id = SendDlgItemMessage(hwnd, <a href='../S/2861.html#L33' title='Defined at 33 in PC/bdist_wininst/resource.h.'>IDC_VERSIONS_LIST</a>,
<a name='L1637'>                                         LB_GETCURSEL, 0, 0);
<a name='L1638'>                <b>if</b> (id == LB_ERR) <font color='red'>{</font>
<a name='L1639'>                    PropSheet_SetWizButtons(GetParent(hwnd),
<a name='L1640'>                                            PSWIZB_BACK);
<a name='L1641'>                    SetDlgItemText(hwnd, <a href='../S/2861.html#L27' title='Defined at 27 in PC/bdist_wininst/resource.h.'>IDC_PATH</a>, "");
<a name='L1642'>                    SetDlgItemText(hwnd, <a href='../S/2861.html#L29' title='Defined at 29 in PC/bdist_wininst/resource.h.'>IDC_INSTALL_PATH</a>, "");
<a name='L1643'>                    strcpy(python_dir, "");
<a name='L1644'>                    strcpy(pythondll, "");
<a name='L1645'>                <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1646'>                    <b>char</b> *pbuf;
<a name='L1647'>                    <b>int</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L1648'>                    <a href='../S/2858.html#L1455' title='Defined at 1455 in PC/bdist_wininst/install.c.'>InstalledVersionInfo</a> *ivi;
<a name='L1649'>                    PropSheet_SetWizButtons(GetParent(hwnd),
<a name='L1650'>                                            PSWIZB_BACK | PSWIZB_NEXT);
<a name='L1651'>                    <i><font color='green'>/* Get the python directory */</font></i>
<a name='L1652'>            ivi = (<a href='../S/2858.html#L1455' title='Defined at 1455 in PC/bdist_wininst/install.c.'>InstalledVersionInfo</a> *)
<a name='L1653'>                        SendDlgItemMessage(hwnd,
<a name='L1654'>                                                                <a href='../S/2861.html#L33' title='Defined at 33 in PC/bdist_wininst/resource.h.'>IDC_VERSIONS_LIST</a>,
<a name='L1655'>                                                                LB_GETITEMDATA,
<a name='L1656'>                                                                id,
<a name='L1657'>                                                                0);
<a name='L1658'>            hkey_root = ivi-&gt;hkey;
<a name='L1659'>                                strcpy(python_dir, ivi-&gt;<a href='../S/2664.html#L148' title='Defined at 148 in Modules/expat/xmlparse.c.'>prefix</a>);
<a name='L1660'>                                SetDlgItemText(hwnd, <a href='../S/2861.html#L27' title='Defined at 27 in PC/bdist_wininst/resource.h.'>IDC_PATH</a>, python_dir);
<a name='L1661'>                                <i><font color='green'>/* retrieve the python version and pythondll to use */</font></i>
<a name='L1662'>                    <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = SendDlgItemMessage(hwnd, <a href='../S/2861.html#L33' title='Defined at 33 in PC/bdist_wininst/resource.h.'>IDC_VERSIONS_LIST</a>,
<a name='L1663'>                                                 LB_GETTEXTLEN, (WPARAM)id, 0);
<a name='L1664'>                    pbuf = (<b>char</b> *)malloc(<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> + 1);
<a name='L1665'>                    <b>if</b> (pbuf) <font color='red'>{</font>
<a name='L1666'>                        <i><font color='green'>/* guess the name of the python-dll */</font></i>
<a name='L1667'>                        SendDlgItemMessage(hwnd, <a href='../S/2861.html#L33' title='Defined at 33 in PC/bdist_wininst/resource.h.'>IDC_VERSIONS_LIST</a>,
<a name='L1668'>                                            LB_GETTEXT, (WPARAM)id,
<a name='L1669'>                                            (LPARAM)pbuf);
<a name='L1670'>                        <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = sscanf(pbuf, "Python Version %d.%d",
<a name='L1671'>                                         &amp;py_major, &amp;py_minor);
<a name='L1672'>                        <b>if</b> (<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> == 2) <font color='red'>{</font>
<a name='L1673'><font color='darkred'>#ifdef</font> _DEBUG
<a name='L1674'>                            wsprintf(pythondll, "python%d%d_d.dll",
<a name='L1675'>                                     py_major, py_minor);
<a name='L1676'><font color='darkred'>#else</font>
<a name='L1677'>                            wsprintf(pythondll, "python%d%d.dll",
<a name='L1678'>                                     py_major, py_minor);
<a name='L1679'><font color='darkred'>#endif</font>
<a name='L1680'>                        <font color='red'>}</font>
<a name='L1681'>                        free(pbuf);
<a name='L1682'>                    <font color='red'>}</font> <b>else</b>
<a name='L1683'>                        strcpy(pythondll, "");
<a name='L1684'>                    <i><font color='green'>/* retrieve the scheme for this version */</font></i>
<a name='L1685'>                    <font color='red'>{</font>
<a name='L1686'>                        <b>char</b> install_path[_MAX_PATH];
<a name='L1687'>                        <a href='../S/2856.html#L75' title='Defined at 75 in PC/bdist_wininst/archive.h.'>SCHEME</a> *scheme = <a href='../S/2858.html#L1559' title='Defined at 1559 in PC/bdist_wininst/install.c.'>GetScheme</a>(py_major, py_minor);
<a name='L1688'>                        strcpy(install_path, python_dir);
<a name='L1689'>                        <b>if</b> (install_path[strlen(install_path)-1] != '\\')
<a name='L1690'>                            strcat(install_path, "\\");
<a name='L1691'>                        strcat(install_path, scheme[0].<a href='../S/2664.html#L148' title='Defined at 148 in Modules/expat/xmlparse.c.'>prefix</a>);
<a name='L1692'>                        SetDlgItemText(hwnd, <a href='../S/2861.html#L29' title='Defined at 29 in PC/bdist_wininst/resource.h.'>IDC_INSTALL_PATH</a>, install_path);
<a name='L1693'>                    <font color='red'>}</font>
<a name='L1694'>                <font color='red'>}</font>
<a name='L1695'>            <font color='red'>}</font>
<a name='L1696'>            <b>break</b>;
<a name='L1697'>        <font color='red'>}</font>
<a name='L1698'>        <b>return</b> 0;
<a name='L1699'>
<a name='L1700'>    <b>case</b> WM_NOTIFY:
<a name='L1701'>        lpnm = (LPNMHDR) lParam;
<a name='L1702'>
<a name='L1703'>        <b>switch</b> (lpnm-&gt;<a href='../S/2755.html#L28' title='Defined at 28 in Modules/zlib/inftrees.h.'>code</a>) <font color='red'>{</font>
<a name='L1704'>            <b>int</b> id;
<a name='L1705'>        <b>case</b> PSN_SETACTIVE:
<a name='L1706'>            id = SendDlgItemMessage(hwnd, <a href='../S/2861.html#L33' title='Defined at 33 in PC/bdist_wininst/resource.h.'>IDC_VERSIONS_LIST</a>,
<a name='L1707'>                                     LB_GETCURSEL, 0, 0);
<a name='L1708'>            <b>if</b> (id == LB_ERR)
<a name='L1709'>                PropSheet_SetWizButtons(GetParent(hwnd),
<a name='L1710'>                                        PSWIZB_BACK);
<a name='L1711'>            <b>else</b>
<a name='L1712'>                PropSheet_SetWizButtons(GetParent(hwnd),
<a name='L1713'>                                        PSWIZB_BACK | PSWIZB_NEXT);
<a name='L1714'>            <b>break</b>;
<a name='L1715'>
<a name='L1716'>        <b>case</b> PSN_WIZNEXT:
<a name='L1717'>            <b>break</b>;
<a name='L1718'>
<a name='L1719'>        <b>case</b> PSN_WIZFINISH:
<a name='L1720'>            <b>break</b>;
<a name='L1721'>
<a name='L1722'>        <b>case</b> PSN_RESET:
<a name='L1723'>            <b>break</b>;
<a name='L1724'>
<a name='L1725'>        <b>default</b>:
<a name='L1726'>            <b>break</b>;
<a name='L1727'>        <font color='red'>}</font>
<a name='L1728'>    <font color='red'>}</font>
<a name='L1729'>    <b>return</b> 0;
<a name='L1730'><font color='red'>}</font>
<a name='L1731'>
<a name='L1732'><b>static</b> <a href='../S/2583.html#L42' title='Defined at 42 in Modules/_multiprocessing/multiprocessing.h.'>BOOL</a> <a href='../S/2858.html#L1928' title='Refered from 1928 in PC/bdist_wininst/install.c.'>OpenLogfile</a>(<b>char</b> *dir)
<a name='L1733'><font color='red'>{</font>
<a name='L1734'>    <b>char</b> <a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>[_MAX_PATH+1];
<a name='L1735'>    time_t ltime;
<a name='L1736'>    <b>struct</b> tm *now;
<a name='L1737'>    <b>long</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L1738'>    HKEY hKey, hSubkey;
<a name='L1739'>    <b>char</b> subkey_name[256];
<a name='L1740'>    <b>static</b> <b>char</b> KeyName[] =
<a name='L1741'>        "Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall";
<a name='L1742'>    <b>const</b> <b>char</b> *root_name = (hkey_root==HKEY_LOCAL_MACHINE ?
<a name='L1743'>                            "HKEY_LOCAL_MACHINE" : "HKEY_CURRENT_USER");
<a name='L1744'>    DWORD disposition;
<a name='L1745'>
<a name='L1746'>    <i><font color='green'>/* Use Create, as the Uninstall subkey may not exist under HKCU.</font></i>
<a name='L1747'><i><font color='green'>       Use CreateKeyEx, so we can specify a SAM specifying write access</font></i>
<a name='L1748'><i><font color='green'>    */</font></i>
<a name='L1749'>        <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = RegCreateKeyEx(hkey_root,
<a name='L1750'>                      KeyName,
<a name='L1751'>                      0, <i><font color='green'>/* reserved */</font></i>
<a name='L1752'>                  <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, <i><font color='green'>/* class */</font></i>
<a name='L1753'>                  0, <i><font color='green'>/* options */</font></i>
<a name='L1754'>                  KEY_CREATE_SUB_KEY, <i><font color='green'>/* sam */</font></i>
<a name='L1755'>                  <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, <i><font color='green'>/* security */</font></i>
<a name='L1756'>                  &amp;hKey, <i><font color='green'>/* result key */</font></i>
<a name='L1757'>                  <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>); <i><font color='green'>/* disposition */</font></i>
<a name='L1758'>    <b>if</b> (<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> != ERROR_SUCCESS) <font color='red'>{</font>
<a name='L1759'>        <b>if</b> (<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> == ERROR_ACCESS_DENIED) <font color='red'>{</font>
<a name='L1760'>            <i><font color='green'>/* This should no longer be able to happen - we have already</font></i>
<a name='L1761'><i><font color='green'>               checked if they have permissions in HKLM, and all users</font></i>
<a name='L1762'><i><font color='green'>               should have write access to HKCU.</font></i>
<a name='L1763'><i><font color='green'>            */</font></i>
<a name='L1764'>            MessageBox(GetFocus(),
<a name='L1765'>                       "You do not seem to have sufficient access rights\n"
<a name='L1766'>                       "on this machine to install this software",
<a name='L1767'>                       <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L1768'>                       MB_OK | MB_ICONSTOP);
<a name='L1769'>            <b>return</b> <a href='../D/1087.html' title='Multiple defined in 3 places.'>FALSE</a>;
<a name='L1770'>        <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L1771'>            MessageBox(GetFocus(), KeyName, "Could not open key", MB_OK);
<a name='L1772'>        <font color='red'>}</font>
<a name='L1773'>    <font color='red'>}</font>
<a name='L1774'>
<a name='L1775'>    sprintf(<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>, "%s\\%s-wininst.log", dir, meta_name);
<a name='L1776'>    logfile = fopen(<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>, "a");
<a name='L1777'>    time(&amp;ltime);
<a name='L1778'>    now = localtime(&amp;ltime);
<a name='L1779'>    strftime(<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>, <b>sizeof</b>(<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>),
<a name='L1780'>             "*** Installation started %Y/%m/%d %H:%M ***\n",
<a name='L1781'>             localtime(&amp;ltime));
<a name='L1782'>    fprintf(logfile, <a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>);
<a name='L1783'>    fprintf(logfile, "Source: %s\n", modulename);
<a name='L1784'>
<a name='L1785'>    <i><font color='green'>/* Root key must be first entry processed by uninstaller. */</font></i>
<a name='L1786'>    fprintf(logfile, "999 Root Key: %s\n", root_name);
<a name='L1787'>
<a name='L1788'>    sprintf(subkey_name, "%s-py%d.%d", meta_name, py_major, py_minor);
<a name='L1789'>
<a name='L1790'>    <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = RegCreateKeyEx(hKey, subkey_name,
<a name='L1791'>                            0, <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, 0,
<a name='L1792'>                            KEY_WRITE,
<a name='L1793'>                            <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L1794'>                            &amp;hSubkey,
<a name='L1795'>                            &amp;disposition);
<a name='L1796'>
<a name='L1797'>    <b>if</b> (<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> != ERROR_SUCCESS)
<a name='L1798'>        MessageBox(GetFocus(), subkey_name, "Could not create key", MB_OK);
<a name='L1799'>
<a name='L1800'>    RegCloseKey(hKey);
<a name='L1801'>
<a name='L1802'>    <b>if</b> (disposition == REG_CREATED_NEW_KEY)
<a name='L1803'>        fprintf(logfile, "020 Reg DB Key: [%s]%s\n", KeyName, subkey_name);
<a name='L1804'>
<a name='L1805'>    sprintf(<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>, "Python %d.%d %s", py_major, py_minor, title);
<a name='L1806'>
<a name='L1807'>    <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = RegSetValueEx(hSubkey, "DisplayName",
<a name='L1808'>                           0,
<a name='L1809'>                           REG_SZ,
<a name='L1810'>                           <a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>,
<a name='L1811'>                           strlen(<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>)+1);
<a name='L1812'>
<a name='L1813'>    <b>if</b> (<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> != ERROR_SUCCESS)
<a name='L1814'>        MessageBox(GetFocus(), <a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>, "Could not set key value", MB_OK);
<a name='L1815'>
<a name='L1816'>    fprintf(logfile, "040 Reg DB Value: [%s\\%s]%s=%s\n",
<a name='L1817'>        KeyName, subkey_name, "DisplayName", <a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>);
<a name='L1818'>
<a name='L1819'>    <font color='red'>{</font>
<a name='L1820'>        FILE *fp;
<a name='L1821'>        sprintf(<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>, "%s\\Remove%s.exe", dir, meta_name);
<a name='L1822'>        fp = fopen(<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>, "wb");
<a name='L1823'>        fwrite(arc_data, exe_size, 1, fp);
<a name='L1824'>        fclose(fp);
<a name='L1825'>
<a name='L1826'>        sprintf(<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>, "\"%s\\Remove%s.exe\" -u \"%s\\%s-wininst.log\"",
<a name='L1827'>            dir, meta_name, dir, meta_name);
<a name='L1828'>
<a name='L1829'>        <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = RegSetValueEx(hSubkey, "UninstallString",
<a name='L1830'>                               0,
<a name='L1831'>                               REG_SZ,
<a name='L1832'>                               <a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>,
<a name='L1833'>                               strlen(<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>)+1);
<a name='L1834'>
<a name='L1835'>        <b>if</b> (<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> != ERROR_SUCCESS)
<a name='L1836'>            MessageBox(GetFocus(), <a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>, "Could not set key value", MB_OK);
<a name='L1837'>
<a name='L1838'>        fprintf(logfile, "040 Reg DB Value: [%s\\%s]%s=%s\n",
<a name='L1839'>            KeyName, subkey_name, "UninstallString", <a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>);
<a name='L1840'>    <font color='red'>}</font>
<a name='L1841'>    <b>return</b> <a href='../D/5177.html' title='Multiple defined in 3 places.'>TRUE</a>;
<a name='L1842'><font color='red'>}</font>
<a name='L1843'>
<a name='L1844'><b>static</b> <b>void</b> <a href='../S/2858.html#L2068' title='Refered from 2068 in PC/bdist_wininst/install.c.'>CloseLogfile</a>(<b>void</b>)
<a name='L1845'><font color='red'>{</font>
<a name='L1846'>    <b>char</b> <a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>[_MAX_PATH+1];
<a name='L1847'>    time_t ltime;
<a name='L1848'>    <b>struct</b> tm *now;
<a name='L1849'>
<a name='L1850'>    time(&amp;ltime);
<a name='L1851'>    now = localtime(&amp;ltime);
<a name='L1852'>    strftime(<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>, <b>sizeof</b>(<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>),
<a name='L1853'>             "*** Installation finished %Y/%m/%d %H:%M ***\n",
<a name='L1854'>             localtime(&amp;ltime));
<a name='L1855'>    fprintf(logfile, <a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>);
<a name='L1856'>    <b>if</b> (logfile)
<a name='L1857'>        fclose(logfile);
<a name='L1858'><font color='red'>}</font>
<a name='L1859'>
<a name='L1860'><a href='../S/2583.html#L42' title='Defined at 42 in Modules/_multiprocessing/multiprocessing.h.'>BOOL</a> CALLBACK
<a name='L1861'><a href='../S/2858.html#L2123' title='Refered from 2123 in PC/bdist_wininst/install.c.'>InstallFilesDlgProc</a>(HWND hwnd, UINT msg, WPARAM wParam, LPARAM lParam)
<a name='L1862'><font color='red'>{</font>
<a name='L1863'>    LPNMHDR lpnm;
<a name='L1864'>    <b>char</b> Buffer[4096];
<a name='L1865'>    <a href='../S/2856.html#L75' title='Defined at 75 in PC/bdist_wininst/archive.h.'>SCHEME</a> *scheme;
<a name='L1866'>
<a name='L1867'>    <b>switch</b> (msg) <font color='red'>{</font>
<a name='L1868'>    <b>case</b> WM_INITDIALOG:
<a name='L1869'>        <b>if</b> (hBitmap)
<a name='L1870'>            SendDlgItemMessage(hwnd, <a href='../S/2861.html#L35' title='Defined at 35 in PC/bdist_wininst/resource.h.'>IDC_BITMAP</a>, STM_SETIMAGE,
<a name='L1871'>                               IMAGE_BITMAP, (LPARAM)hBitmap);
<a name='L1872'>        wsprintf(Buffer,
<a name='L1873'>                  "Click Next to begin the installation of %s. "
<a name='L1874'>                  "If you want to review or change any of your "
<a name='L1875'>                  " installation settings, click Back. "
<a name='L1876'>                  "Click Cancel to exit the wizard.",
<a name='L1877'>                  meta_name);
<a name='L1878'>        SetDlgItemText(hwnd, <a href='../S/2861.html#L22' title='Defined at 22 in PC/bdist_wininst/resource.h.'>IDC_TITLE</a>, Buffer);
<a name='L1879'>        SetDlgItemText(hwnd, <a href='../S/2861.html#L25' title='Defined at 25 in PC/bdist_wininst/resource.h.'>IDC_INFO</a>, "Ready to install");
<a name='L1880'>        <b>break</b>;
<a name='L1881'>
<a name='L1882'>    <b>case</b> <a href='../S/2858.html#L158' title='Defined at 158 in PC/bdist_wininst/install.c.'>WM_NUMFILES</a>:
<a name='L1883'>        SendDlgItemMessage(hwnd, <a href='../S/2861.html#L24' title='Defined at 24 in PC/bdist_wininst/resource.h.'>IDC_PROGRESS</a>, PBM_SETRANGE, 0, lParam);
<a name='L1884'>        <a href='../S/2858.html#L1128' title='Defined at 1128 in PC/bdist_wininst/install.c.'>PumpMessages</a>();
<a name='L1885'>        <b>return</b> <a href='../D/5177.html' title='Multiple defined in 3 places.'>TRUE</a>;
<a name='L1886'>
<a name='L1887'>    <b>case</b> <a href='../S/2858.html#L160' title='Defined at 160 in PC/bdist_wininst/install.c.'>WM_NEXTFILE</a>:
<a name='L1888'>        SendDlgItemMessage(hwnd, <a href='../S/2861.html#L24' title='Defined at 24 in PC/bdist_wininst/resource.h.'>IDC_PROGRESS</a>, PBM_SETPOS, wParam,
<a name='L1889'>                            0);
<a name='L1890'>        SetDlgItemText(hwnd, <a href='../S/2861.html#L25' title='Defined at 25 in PC/bdist_wininst/resource.h.'>IDC_INFO</a>, (LPSTR)lParam);
<a name='L1891'>        <a href='../S/2858.html#L1128' title='Defined at 1128 in PC/bdist_wininst/install.c.'>PumpMessages</a>();
<a name='L1892'>        <b>return</b> <a href='../D/5177.html' title='Multiple defined in 3 places.'>TRUE</a>;
<a name='L1893'>
<a name='L1894'>    <b>case</b> WM_NOTIFY:
<a name='L1895'>        lpnm = (LPNMHDR) lParam;
<a name='L1896'>
<a name='L1897'>        <b>switch</b> (lpnm-&gt;<a href='../S/2755.html#L28' title='Defined at 28 in Modules/zlib/inftrees.h.'>code</a>) <font color='red'>{</font>
<a name='L1898'>        <b>case</b> PSN_SETACTIVE:
<a name='L1899'>            PropSheet_SetWizButtons(GetParent(hwnd),
<a name='L1900'>                                    PSWIZB_BACK | PSWIZB_NEXT);
<a name='L1901'>            <b>break</b>;
<a name='L1902'>
<a name='L1903'>        <b>case</b> PSN_WIZFINISH:
<a name='L1904'>            <b>break</b>;
<a name='L1905'>
<a name='L1906'>        <b>case</b> PSN_WIZNEXT:
<a name='L1907'>            <i><font color='green'>/* Handle a Next button click here */</font></i>
<a name='L1908'>            hDialog = hwnd;
<a name='L1909'>            success = <a href='../D/5177.html' title='Multiple defined in 3 places.'>TRUE</a>;
<a name='L1910'>
<a name='L1911'>            <i><font color='green'>/* Disable the buttons while we work.  Sending CANCELTOCLOSE has</font></i>
<a name='L1912'><i><font color='green'>              the effect of disabling the cancel button, which is a) as we</font></i>
<a name='L1913'><i><font color='green'>              do everything synchronously we can't cancel, and b) the next</font></i>
<a name='L1914'><i><font color='green'>              step is 'finished', when it is too late to cancel anyway.</font></i>
<a name='L1915'><i><font color='green'>              The next step being 'Finished' means we also don't need to</font></i>
<a name='L1916'><i><font color='green'>              restore the button state back */</font></i>
<a name='L1917'>            PropSheet_SetWizButtons(GetParent(hwnd), 0);
<a name='L1918'>            SendMessage(GetParent(hwnd), PSM_CANCELTOCLOSE, 0, 0);
<a name='L1919'>            <i><font color='green'>/* Make sure the installation directory name ends in a */</font></i>
<a name='L1920'>            <i><font color='green'>/* backslash */</font></i>
<a name='L1921'>            <b>if</b> (python_dir[strlen(python_dir)-1] != '\\')
<a name='L1922'>                strcat(python_dir, "\\");
<a name='L1923'>            <i><font color='green'>/* Strip the trailing backslash again */</font></i>
<a name='L1924'>            python_dir[strlen(python_dir)-1] = '\0';
<a name='L1925'>
<a name='L1926'>            <a href='../S/2858.html#L1540' title='Defined at 1540 in PC/bdist_wininst/install.c.'>CheckRootKey</a>(hwnd);
<a name='L1927'>
<a name='L1928'>            <b>if</b> (!<a href='../S/2858.html#L1732' title='Defined at 1732 in PC/bdist_wininst/install.c.'>OpenLogfile</a>(python_dir))
<a name='L1929'>                <b>break</b>;
<a name='L1930'>
<a name='L1931'><i><font color='green'>/*</font></i>
<a name='L1932'><i><font color='green'> * The scheme we have to use depends on the Python version...</font></i>
<a name='L1933'><i><font color='green'> if sys.version &lt; "2.2":</font></i>
<a name='L1934'><i><font color='green'> WINDOWS_SCHEME = {</font></i>
<a name='L1935'><i><font color='green'> 'purelib': '$base',</font></i>
<a name='L1936'><i><font color='green'> 'platlib': '$base',</font></i>
<a name='L1937'><i><font color='green'> 'headers': '$base/Include/$dist_name',</font></i>
<a name='L1938'><i><font color='green'> 'scripts': '$base/Scripts',</font></i>
<a name='L1939'><i><font color='green'> 'data'   : '$base',</font></i>
<a name='L1940'><i><font color='green'> }</font></i>
<a name='L1941'><i><font color='green'> else:</font></i>
<a name='L1942'><i><font color='green'> WINDOWS_SCHEME = {</font></i>
<a name='L1943'><i><font color='green'> 'purelib': '$base/Lib/site-packages',</font></i>
<a name='L1944'><i><font color='green'> 'platlib': '$base/Lib/site-packages',</font></i>
<a name='L1945'><i><font color='green'> 'headers': '$base/Include/$dist_name',</font></i>
<a name='L1946'><i><font color='green'> 'scripts': '$base/Scripts',</font></i>
<a name='L1947'><i><font color='green'> 'data'   : '$base',</font></i>
<a name='L1948'><i><font color='green'> }</font></i>
<a name='L1949'><i><font color='green'>*/</font></i>
<a name='L1950'>            scheme = <a href='../S/2858.html#L1559' title='Defined at 1559 in PC/bdist_wininst/install.c.'>GetScheme</a>(py_major, py_minor);
<a name='L1951'>            <i><font color='green'>/* Run the pre-install script. */</font></i>
<a name='L1952'>            <b>if</b> (pre_install_script &amp;&amp; *pre_install_script) <font color='red'>{</font>
<a name='L1953'>                SetDlgItemText (hwnd, <a href='../S/2861.html#L22' title='Defined at 22 in PC/bdist_wininst/resource.h.'>IDC_TITLE</a>,
<a name='L1954'>                                "Running pre-installation script");
<a name='L1955'>                <a href='../S/2858.html#L861' title='Defined at 861 in PC/bdist_wininst/install.c.'>run_simple_script</a>(pre_install_script);
<a name='L1956'>            <font color='red'>}</font>
<a name='L1957'>            <b>if</b> (!success) <font color='red'>{</font>
<a name='L1958'>                <b>break</b>;
<a name='L1959'>            <font color='red'>}</font>
<a name='L1960'>            <i><font color='green'>/* Extract all files from the archive */</font></i>
<a name='L1961'>            SetDlgItemText(hwnd, <a href='../S/2861.html#L22' title='Defined at 22 in PC/bdist_wininst/resource.h.'>IDC_TITLE</a>, "Installing files...");
<a name='L1962'>            <b>if</b> (!<a href='../S/2857.html#L203' title='Defined at 203 in PC/bdist_wininst/extract.c.'>unzip_archive</a> (scheme,
<a name='L1963'>                                python_dir, arc_data,
<a name='L1964'>                                arc_size, <a href='../S/2858.html#L948' title='Defined at 948 in PC/bdist_wininst/install.c.'>notify</a>))
<a name='L1965'>                <a href='../S/2858.html#L228' title='Defined at 228 in PC/bdist_wininst/install.c.'>set_failure_reason</a>("Failed to unzip installation files");
<a name='L1966'>            <i><font color='green'>/* Compile the py-files */</font></i>
<a name='L1967'>            <b>if</b> (success &amp;&amp; pyc_compile) <font color='red'>{</font>
<a name='L1968'>                <b>int</b> errors;
<a name='L1969'>                HINSTANCE hPython;
<a name='L1970'>                SetDlgItemText(hwnd, <a href='../S/2861.html#L22' title='Defined at 22 in PC/bdist_wininst/resource.h.'>IDC_TITLE</a>,
<a name='L1971'>                                "Compiling files to .pyc...");
<a name='L1972'>
<a name='L1973'>                SetDlgItemText(hDialog, <a href='../S/2861.html#L25' title='Defined at 25 in PC/bdist_wininst/resource.h.'>IDC_INFO</a>, "Loading python...");
<a name='L1974'>                hPython = <a href='../S/2858.html#L646' title='Defined at 646 in PC/bdist_wininst/install.c.'>LoadPythonDll</a>(pythondll);
<a name='L1975'>                <b>if</b> (hPython) <font color='red'>{</font>
<a name='L1976'>                    errors = <a href='../S/2858.html#L329' title='Defined at 329 in PC/bdist_wininst/install.c.'>compile_filelist</a>(hPython, <a href='../D/1087.html' title='Multiple defined in 3 places.'>FALSE</a>);
<a name='L1977'>                    FreeLibrary(hPython);
<a name='L1978'>                <font color='red'>}</font>
<a name='L1979'>                <i><font color='green'>/* Compilation errors are intentionally ignored:</font></i>
<a name='L1980'><i><font color='green'>                 * Python2.0 contains a bug which will result</font></i>
<a name='L1981'><i><font color='green'>                 * in sys.path containing garbage under certain</font></i>
<a name='L1982'><i><font color='green'>                 * circumstances, and an error message will only</font></i>
<a name='L1983'><i><font color='green'>                 * confuse the user.</font></i>
<a name='L1984'><i><font color='green'>                 */</font></i>
<a name='L1985'>            <font color='red'>}</font>
<a name='L1986'>            <b>if</b> (success &amp;&amp; pyo_compile) <font color='red'>{</font>
<a name='L1987'>                <b>int</b> errors;
<a name='L1988'>                HINSTANCE hPython;
<a name='L1989'>                SetDlgItemText(hwnd, <a href='../S/2861.html#L22' title='Defined at 22 in PC/bdist_wininst/resource.h.'>IDC_TITLE</a>,
<a name='L1990'>                                "Compiling files to .pyo...");
<a name='L1991'>
<a name='L1992'>                SetDlgItemText(hDialog, <a href='../S/2861.html#L25' title='Defined at 25 in PC/bdist_wininst/resource.h.'>IDC_INFO</a>, "Loading python...");
<a name='L1993'>                hPython = <a href='../S/2858.html#L646' title='Defined at 646 in PC/bdist_wininst/install.c.'>LoadPythonDll</a>(pythondll);
<a name='L1994'>                <b>if</b> (hPython) <font color='red'>{</font>
<a name='L1995'>                    errors = <a href='../S/2858.html#L329' title='Defined at 329 in PC/bdist_wininst/install.c.'>compile_filelist</a>(hPython, <a href='../D/5177.html' title='Multiple defined in 3 places.'>TRUE</a>);
<a name='L1996'>                    FreeLibrary(hPython);
<a name='L1997'>                <font color='red'>}</font>
<a name='L1998'>                <i><font color='green'>/* Errors ignored: see above */</font></i>
<a name='L1999'>            <font color='red'>}</font>
<a name='L2000'>
<a name='L2001'>
<a name='L2002'>            <b>break</b>;
<a name='L2003'>
<a name='L2004'>        <b>case</b> PSN_RESET:
<a name='L2005'>            <b>break</b>;
<a name='L2006'>
<a name='L2007'>        <b>default</b>:
<a name='L2008'>            <b>break</b>;
<a name='L2009'>        <font color='red'>}</font>
<a name='L2010'>    <font color='red'>}</font>
<a name='L2011'>    <b>return</b> 0;
<a name='L2012'><font color='red'>}</font>
<a name='L2013'>
<a name='L2014'>
<a name='L2015'><a href='../S/2583.html#L42' title='Defined at 42 in Modules/_multiprocessing/multiprocessing.h.'>BOOL</a> CALLBACK
<a name='L2016'><a href='../S/2858.html#L2130' title='Refered from 2130 in PC/bdist_wininst/install.c.'>FinishedDlgProc</a>(HWND hwnd, UINT msg, WPARAM wParam, LPARAM lParam)
<a name='L2017'><font color='red'>{</font>
<a name='L2018'>    LPNMHDR lpnm;
<a name='L2019'>
<a name='L2020'>    <b>switch</b> (msg) <font color='red'>{</font>
<a name='L2021'>    <b>case</b> WM_INITDIALOG:
<a name='L2022'>        <b>if</b> (hBitmap)
<a name='L2023'>            SendDlgItemMessage(hwnd, <a href='../S/2861.html#L35' title='Defined at 35 in PC/bdist_wininst/resource.h.'>IDC_BITMAP</a>, STM_SETIMAGE,
<a name='L2024'>                               IMAGE_BITMAP, (LPARAM)hBitmap);
<a name='L2025'>        <b>if</b> (!success)
<a name='L2026'>            SetDlgItemText(hwnd, <a href='../S/2861.html#L25' title='Defined at 25 in PC/bdist_wininst/resource.h.'>IDC_INFO</a>, <a href='../S/2858.html#L235' title='Defined at 235 in PC/bdist_wininst/install.c.'>get_failure_reason</a>());
<a name='L2027'>
<a name='L2028'>        <i><font color='green'>/* async delay: will show the dialog box completely before</font></i>
<a name='L2029'><i><font color='green'>           the install_script is started */</font></i>
<a name='L2030'>        PostMessage(hwnd, WM_USER, 0, 0L);
<a name='L2031'>        <b>return</b> <a href='../D/5177.html' title='Multiple defined in 3 places.'>TRUE</a>;
<a name='L2032'>
<a name='L2033'>    <b>case</b> WM_USER:
<a name='L2034'>
<a name='L2035'>        <b>if</b> (success &amp;&amp; install_script &amp;&amp; install_script[0]) <font color='red'>{</font>
<a name='L2036'>            <b>char</b> fname[<a href='../S/2696.html#L2498' title='Defined at 2498 in Modules/posixmodule.c.'>MAX_PATH</a>];
<a name='L2037'>            <b>char</b> *<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>;
<a name='L2038'>            HCURSOR hCursor;
<a name='L2039'>            <b>int</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L2040'>
<a name='L2041'>            <b>char</b> *argv[3] = <font color='red'>{</font><a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, "-install", <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>;
<a name='L2042'>
<a name='L2043'>            SetDlgItemText(hwnd, <a href='../S/2861.html#L22' title='Defined at 22 in PC/bdist_wininst/resource.h.'>IDC_TITLE</a>,
<a name='L2044'>                            "Please wait while running postinstall script...");
<a name='L2045'>            strcpy(fname, python_dir);
<a name='L2046'>            strcat(fname, "\\Scripts\\");
<a name='L2047'>            strcat(fname, install_script);
<a name='L2048'>
<a name='L2049'>            <b>if</b> (logfile)
<a name='L2050'>                fprintf(logfile, "300 Run Script: [%s]%s\n", pythondll, fname);
<a name='L2051'>
<a name='L2052'>            hCursor = SetCursor(LoadCursor(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, IDC_WAIT));
<a name='L2053'>
<a name='L2054'>            argv[0] = fname;
<a name='L2055'>
<a name='L2056'>            <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = <a href='../S/2858.html#L788' title='Defined at 788 in PC/bdist_wininst/install.c.'>run_installscript</a>(fname, 2, argv, &amp;<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>);
<a name='L2057'>            <b>if</b> (0 != <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>) <font color='red'>{</font>
<a name='L2058'>                fprintf(stderr, "*** run_installscript: internal error 0x%X ***\n", <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>);
<a name='L2059'>            <font color='red'>}</font>
<a name='L2060'>            <b>if</b> (<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>)
<a name='L2061'>                SetDlgItemText(hwnd, <a href='../S/2861.html#L25' title='Defined at 25 in PC/bdist_wininst/resource.h.'>IDC_INFO</a>, <a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>);
<a name='L2062'>            SetDlgItemText(hwnd, <a href='../S/2861.html#L22' title='Defined at 22 in PC/bdist_wininst/resource.h.'>IDC_TITLE</a>,
<a name='L2063'>                            "Postinstall script finished.\n"
<a name='L2064'>                            "Click the Finish button to exit the Setup wizard.");
<a name='L2065'>
<a name='L2066'>            free(<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>);
<a name='L2067'>            SetCursor(hCursor);
<a name='L2068'>            <a href='../S/2858.html#L1844' title='Defined at 1844 in PC/bdist_wininst/install.c.'>CloseLogfile</a>();
<a name='L2069'>        <font color='red'>}</font>
<a name='L2070'>
<a name='L2071'>        <b>return</b> <a href='../D/5177.html' title='Multiple defined in 3 places.'>TRUE</a>;
<a name='L2072'>
<a name='L2073'>    <b>case</b> WM_NOTIFY:
<a name='L2074'>        lpnm = (LPNMHDR) lParam;
<a name='L2075'>
<a name='L2076'>        <b>switch</b> (lpnm-&gt;<a href='../S/2755.html#L28' title='Defined at 28 in Modules/zlib/inftrees.h.'>code</a>) <font color='red'>{</font>
<a name='L2077'>        <b>case</b> PSN_SETACTIVE: <i><font color='green'>/* Enable the Finish button */</font></i>
<a name='L2078'>            PropSheet_SetWizButtons(GetParent(hwnd), PSWIZB_FINISH);
<a name='L2079'>            <b>break</b>;
<a name='L2080'>
<a name='L2081'>        <b>case</b> PSN_WIZNEXT:
<a name='L2082'>            <b>break</b>;
<a name='L2083'>
<a name='L2084'>        <b>case</b> PSN_WIZFINISH:
<a name='L2085'>            <b>break</b>;
<a name='L2086'>
<a name='L2087'>        <b>case</b> PSN_RESET:
<a name='L2088'>            <b>break</b>;
<a name='L2089'>
<a name='L2090'>        <b>default</b>:
<a name='L2091'>            <b>break</b>;
<a name='L2092'>        <font color='red'>}</font>
<a name='L2093'>    <font color='red'>}</font>
<a name='L2094'>    <b>return</b> 0;
<a name='L2095'><font color='red'>}</font>
<a name='L2096'>
<a name='L2097'><b>void</b> <a href='../S/2858.html#L2286' title='Refered from 2286 in PC/bdist_wininst/install.c.'>RunWizard</a>(HWND hwnd)
<a name='L2098'><font color='red'>{</font>
<a name='L2099'>    PROPSHEETPAGE   psp =       <font color='red'>{</font>0<font color='red'>}</font>;
<a name='L2100'>    HPROPSHEETPAGE  ahpsp[4] =  <font color='red'>{</font>0<font color='red'>}</font>;
<a name='L2101'>    PROPSHEETHEADER psh =       <font color='red'>{</font>0<font color='red'>}</font>;
<a name='L2102'>
<a name='L2103'>    <i><font color='green'>/* Display module information */</font></i>
<a name='L2104'>    psp.dwSize =        <b>sizeof</b>(psp);
<a name='L2105'>    psp.dwFlags =       PSP_DEFAULT|PSP_HIDEHEADER;
<a name='L2106'>    psp.hInstance =     GetModuleHandle (<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L2107'>    psp.lParam =        0;
<a name='L2108'>    psp.pfnDlgProc =    <a href='../S/2858.html#L1220' title='Defined at 1220 in PC/bdist_wininst/install.c.'>IntroDlgProc</a>;
<a name='L2109'>    psp.pszTemplate =   MAKEINTRESOURCE(<a href='../S/2861.html#L16' title='Defined at 16 in PC/bdist_wininst/resource.h.'>IDD_INTRO</a>);
<a name='L2110'>
<a name='L2111'>    ahpsp[0] =          CreatePropertySheetPage(&amp;psp);
<a name='L2112'>
<a name='L2113'>    <i><font color='green'>/* Select python version to use */</font></i>
<a name='L2114'>    psp.dwFlags =       PSP_DEFAULT|PSP_HIDEHEADER;
<a name='L2115'>    psp.pszTemplate =       MAKEINTRESOURCE(<a href='../S/2861.html#L17' title='Defined at 17 in PC/bdist_wininst/resource.h.'>IDD_SELECTPYTHON</a>);
<a name='L2116'>    psp.pfnDlgProc =        <a href='../S/2858.html#L1569' title='Defined at 1569 in PC/bdist_wininst/install.c.'>SelectPythonDlgProc</a>;
<a name='L2117'>
<a name='L2118'>    ahpsp[1] =              CreatePropertySheetPage(&amp;psp);
<a name='L2119'>
<a name='L2120'>    <i><font color='green'>/* Install the files */</font></i>
<a name='L2121'>    psp.dwFlags =           PSP_DEFAULT|PSP_HIDEHEADER;
<a name='L2122'>    psp.pszTemplate =       MAKEINTRESOURCE(<a href='../S/2861.html#L18' title='Defined at 18 in PC/bdist_wininst/resource.h.'>IDD_INSTALLFILES</a>);
<a name='L2123'>    psp.pfnDlgProc =        <a href='../S/2858.html#L1861' title='Defined at 1861 in PC/bdist_wininst/install.c.'>InstallFilesDlgProc</a>;
<a name='L2124'>
<a name='L2125'>    ahpsp[2] =              CreatePropertySheetPage(&amp;psp);
<a name='L2126'>
<a name='L2127'>    <i><font color='green'>/* Show success or failure */</font></i>
<a name='L2128'>    psp.dwFlags =           PSP_DEFAULT|PSP_HIDEHEADER;
<a name='L2129'>    psp.pszTemplate =       MAKEINTRESOURCE(<a href='../S/2861.html#L19' title='Defined at 19 in PC/bdist_wininst/resource.h.'>IDD_FINISHED</a>);
<a name='L2130'>    psp.pfnDlgProc =        <a href='../S/2858.html#L2016' title='Defined at 2016 in PC/bdist_wininst/install.c.'>FinishedDlgProc</a>;
<a name='L2131'>
<a name='L2132'>    ahpsp[3] =              CreatePropertySheetPage(&amp;psp);
<a name='L2133'>
<a name='L2134'>    <i><font color='green'>/* Create the property sheet */</font></i>
<a name='L2135'>    psh.dwSize =            <b>sizeof</b>(psh);
<a name='L2136'>    psh.hInstance =         GetModuleHandle(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>);
<a name='L2137'>    psh.hwndParent =        hwnd;
<a name='L2138'>    psh.phpage =            ahpsp;
<a name='L2139'>    psh.dwFlags =           PSH_WIZARD<i><font color='green'>/*97*/</font></i><i><font color='green'>/*|PSH_WATERMARK|PSH_HEADER*/</font></i>;
<a name='L2140'>        psh.pszbmWatermark =    <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L2141'>        psh.pszbmHeader =       <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L2142'>        psh.nStartPage =        0;
<a name='L2143'>        psh.nPages =            4;
<a name='L2144'>
<a name='L2145'>        PropertySheet(&amp;psh);
<a name='L2146'><font color='red'>}</font>
<a name='L2147'>
<a name='L2148'><i><font color='green'>// subtly different from HasLocalMachinePrivs(), in that after executing</font></i>
<a name='L2149'><i><font color='green'>// an 'elevated' process, we expect this to return TRUE - but there is no</font></i>
<a name='L2150'><i><font color='green'>// such implication for HasLocalMachinePrivs</font></i>
<a name='L2151'><a href='../S/2583.html#L42' title='Defined at 42 in Modules/_multiprocessing/multiprocessing.h.'>BOOL</a> <a href='../R/2040.html' title='Multiple refered from 2 places.'>MyIsUserAnAdmin</a>()
<a name='L2152'><font color='red'>{</font>
<a name='L2153'>    <b>typedef</b> <a href='../S/2583.html#L42' title='Defined at 42 in Modules/_multiprocessing/multiprocessing.h.'>BOOL</a> (WINAPI *PFNIsUserAnAdmin)();
<a name='L2154'>    <b>static</b> PFNIsUserAnAdmin pfnIsUserAnAdmin = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L2155'>    HMODULE shell32;
<a name='L2156'>    <i><font color='green'>// This function isn't guaranteed to be available (and it can't hurt</font></i>
<a name='L2157'>    <i><font color='green'>// to leave the library loaded)</font></i>
<a name='L2158'>    <b>if</b> (0 == (shell32=LoadLibrary("shell32.dll")))
<a name='L2159'>        <b>return</b> <a href='../D/1087.html' title='Multiple defined in 3 places.'>FALSE</a>;
<a name='L2160'>    <b>if</b> (0 == (pfnIsUserAnAdmin=(PFNIsUserAnAdmin)<a href='../D/1434.html' title='Multiple defined in 2 places.'>GetProcAddress</a>(shell32, "IsUserAnAdmin")))
<a name='L2161'>        <b>return</b> <a href='../D/1087.html' title='Multiple defined in 3 places.'>FALSE</a>;
<a name='L2162'>    <b>return</b> (*pfnIsUserAnAdmin)();
<a name='L2163'><font color='red'>}</font>
<a name='L2164'>
<a name='L2165'><i><font color='green'>// Some magic for Vista's UAC.  If there is a target_version, and</font></i>
<a name='L2166'><i><font color='green'>// if that target version is installed in the registry under</font></i>
<a name='L2167'><i><font color='green'>// HKLM, and we are not current administrator, then</font></i>
<a name='L2168'><i><font color='green'>// re-execute ourselves requesting elevation.</font></i>
<a name='L2169'><i><font color='green'>// Split into 2 functions - "should we elevate" and "spawn elevated"</font></i>
<a name='L2170'>
<a name='L2171'><i><font color='green'>// Returns TRUE if we should spawn an elevated child</font></i>
<a name='L2172'><a href='../S/2583.html#L42' title='Defined at 42 in Modules/_multiprocessing/multiprocessing.h.'>BOOL</a> <a href='../S/2858.html#L2271' title='Refered from 2271 in PC/bdist_wininst/install.c.'>NeedAutoUAC</a>()
<a name='L2173'><font color='red'>{</font>
<a name='L2174'>    HKEY hk;
<a name='L2175'>    <b>char</b> key_name[80];
<a name='L2176'>    <i><font color='green'>// no Python version info == we can't know yet.</font></i>
<a name='L2177'>    <b>if</b> (target_version[0] == '\0')
<a name='L2178'>        <b>return</b> <a href='../D/1087.html' title='Multiple defined in 3 places.'>FALSE</a>;
<a name='L2179'>    <i><font color='green'>// see how python is current installed</font></i>
<a name='L2180'>    wsprintf(key_name,
<a name='L2181'>                     "Software\\Python\\PythonCore\\%s\\InstallPath",
<a name='L2182'>                     target_version);
<a name='L2183'>    <b>if</b> (ERROR_SUCCESS != RegOpenKeyEx(HKEY_LOCAL_MACHINE,
<a name='L2184'>                                      key_name, 0, KEY_READ, &amp;hk))
<a name='L2185'>        <b>return</b> <a href='../D/1087.html' title='Multiple defined in 3 places.'>FALSE</a>;
<a name='L2186'>    RegCloseKey(hk);
<a name='L2187'>    <i><font color='green'>// Python is installed in HKLM - we must elevate.</font></i>
<a name='L2188'>    <b>return</b> <a href='../D/5177.html' title='Multiple defined in 3 places.'>TRUE</a>;
<a name='L2189'><font color='red'>}</font>
<a name='L2190'>
<a name='L2191'><i><font color='green'>// Returns TRUE if the platform supports UAC.</font></i>
<a name='L2192'><a href='../S/2583.html#L42' title='Defined at 42 in Modules/_multiprocessing/multiprocessing.h.'>BOOL</a> <a href='../R/2451.html' title='Multiple refered from 2 places.'>PlatformSupportsUAC</a>()
<a name='L2193'><font color='red'>{</font>
<a name='L2194'>    <i><font color='green'>// Note that win2k does seem to support ShellExecute with 'runas',</font></i>
<a name='L2195'>    <i><font color='green'>// but does *not* support IsUserAnAdmin - so we just pretend things</font></i>
<a name='L2196'>    <i><font color='green'>// only work on XP and later.</font></i>
<a name='L2197'>    <a href='../S/2583.html#L42' title='Defined at 42 in Modules/_multiprocessing/multiprocessing.h.'>BOOL</a> bIsWindowsXPorLater;
<a name='L2198'>    OSVERSIONINFO winverinfo;
<a name='L2199'>    winverinfo.dwOSVersionInfoSize = <b>sizeof</b>(winverinfo);
<a name='L2200'>    <b>if</b> (!GetVersionEx(&amp;winverinfo))
<a name='L2201'>        <b>return</b> <a href='../D/1087.html' title='Multiple defined in 3 places.'>FALSE</a>; <i><font color='green'>// something bad has gone wrong</font></i>
<a name='L2202'>    bIsWindowsXPorLater =
<a name='L2203'>       ( (winverinfo.dwMajorVersion &gt; 5) ||
<a name='L2204'>       ( (winverinfo.dwMajorVersion == 5) &amp;&amp; (winverinfo.dwMinorVersion &gt;= 1) ));
<a name='L2205'>    <b>return</b> bIsWindowsXPorLater;
<a name='L2206'><font color='red'>}</font>
<a name='L2207'>
<a name='L2208'><i><font color='green'>// Spawn ourself as an elevated application.  On failure, a message is</font></i>
<a name='L2209'><i><font color='green'>// displayed to the user - but this app will always terminate, even</font></i>
<a name='L2210'><i><font color='green'>// on error.</font></i>
<a name='L2211'><b>void</b> <a href='../R/4492.html' title='Multiple refered from 2 places.'>SpawnUAC</a>()
<a name='L2212'><font color='red'>{</font>
<a name='L2213'>    <i><font color='green'>// interesting failure scenario that has been seen: initial executable</font></i>
<a name='L2214'>    <i><font color='green'>// runs from a network drive - but once elevated, that network share</font></i>
<a name='L2215'>    <i><font color='green'>// isn't seen, and ShellExecute fails with SE_ERR_ACCESSDENIED.</font></i>
<a name='L2216'>    <b>int</b> ret = (<b>int</b>)ShellExecute(0, "runas", modulename, "", <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L2217'>                                SW_SHOWNORMAL);
<a name='L2218'>    <b>if</b> (ret &lt;= 32) <font color='red'>{</font>
<a name='L2219'>        <b>char</b> msg[128];
<a name='L2220'>        wsprintf(msg, "Failed to start elevated process (ShellExecute returned %d)", ret);
<a name='L2221'>        MessageBox(0, msg, "Setup", MB_OK | MB_ICONERROR);
<a name='L2222'>    <font color='red'>}</font>
<a name='L2223'><font color='red'>}</font>
<a name='L2224'>
<a name='L2225'><b>int</b> <a href='../S/2858.html#L2676' title='Refered from 2676 in PC/bdist_wininst/install.c.'>DoInstall</a>(<b>void</b>)
<a name='L2226'><font color='red'>{</font>
<a name='L2227'>    <b>char</b> ini_buffer[4096];
<a name='L2228'>
<a name='L2229'>    <i><font color='green'>/* Read installation information */</font></i>
<a name='L2230'>    GetPrivateProfileString("Setup", "title", "", ini_buffer,
<a name='L2231'>                             <b>sizeof</b>(ini_buffer), ini_file);
<a name='L2232'>    <a href='../S/2858.html#L186' title='Defined at 186 in PC/bdist_wininst/install.c.'>unescape</a>(title, ini_buffer, <b>sizeof</b>(title));
<a name='L2233'>
<a name='L2234'>    GetPrivateProfileString("Setup", "info", "", ini_buffer,
<a name='L2235'>                             <b>sizeof</b>(ini_buffer), ini_file);
<a name='L2236'>    <a href='../S/2858.html#L186' title='Defined at 186 in PC/bdist_wininst/install.c.'>unescape</a>(info, ini_buffer, <b>sizeof</b>(info));
<a name='L2237'>
<a name='L2238'>    GetPrivateProfileString("Setup", "build_info", "", build_info,
<a name='L2239'>                             <b>sizeof</b>(build_info), ini_file);
<a name='L2240'>
<a name='L2241'>    pyc_compile = GetPrivateProfileInt("Setup", "target_compile", 1,
<a name='L2242'>                                        ini_file);
<a name='L2243'>    pyo_compile = GetPrivateProfileInt("Setup", "target_optimize", 1,
<a name='L2244'>                                        ini_file);
<a name='L2245'>
<a name='L2246'>    GetPrivateProfileString("Setup", "target_version", "",
<a name='L2247'>                             target_version, <b>sizeof</b>(target_version),
<a name='L2248'>                             ini_file);
<a name='L2249'>
<a name='L2250'>    GetPrivateProfileString("metadata", "name", "",
<a name='L2251'>                             meta_name, <b>sizeof</b>(meta_name),
<a name='L2252'>                             ini_file);
<a name='L2253'>
<a name='L2254'>    GetPrivateProfileString("Setup", "install_script", "",
<a name='L2255'>                             install_script, <b>sizeof</b>(install_script),
<a name='L2256'>                             ini_file);
<a name='L2257'>
<a name='L2258'>    GetPrivateProfileString("Setup", "user_access_control", "",
<a name='L2259'>                             user_access_control, <b>sizeof</b>(user_access_control), ini_file);
<a name='L2260'>
<a name='L2261'>    <i><font color='green'>// See if we need to do the Vista UAC magic.</font></i>
<a name='L2262'>    <b>if</b> (strcmp(user_access_control, "force")==0) <font color='red'>{</font>
<a name='L2263'>        <b>if</b> (<a href='../S/2858.html#L2192' title='Defined at 2192 in PC/bdist_wininst/install.c.'>PlatformSupportsUAC</a>() &amp;&amp; !<a href='../S/2858.html#L2151' title='Defined at 2151 in PC/bdist_wininst/install.c.'>MyIsUserAnAdmin</a>()) <font color='red'>{</font>
<a name='L2264'>            <a href='../S/2858.html#L2211' title='Defined at 2211 in PC/bdist_wininst/install.c.'>SpawnUAC</a>();
<a name='L2265'>            <b>return</b> 0;
<a name='L2266'>        <font color='red'>}</font>
<a name='L2267'>        <i><font color='green'>// already admin - keep going</font></i>
<a name='L2268'>    <font color='red'>}</font> <b>else</b> <b>if</b> (strcmp(user_access_control, "auto")==0) <font color='red'>{</font>
<a name='L2269'>        <i><font color='green'>// Check if it looks like we need UAC control, based</font></i>
<a name='L2270'>        <i><font color='green'>// on how Python itself was installed.</font></i>
<a name='L2271'>        <b>if</b> (<a href='../S/2858.html#L2192' title='Defined at 2192 in PC/bdist_wininst/install.c.'>PlatformSupportsUAC</a>() &amp;&amp; !<a href='../S/2858.html#L2151' title='Defined at 2151 in PC/bdist_wininst/install.c.'>MyIsUserAnAdmin</a>() &amp;&amp; <a href='../S/2858.html#L2172' title='Defined at 2172 in PC/bdist_wininst/install.c.'>NeedAutoUAC</a>()) <font color='red'>{</font>
<a name='L2272'>            <a href='../S/2858.html#L2211' title='Defined at 2211 in PC/bdist_wininst/install.c.'>SpawnUAC</a>();
<a name='L2273'>            <b>return</b> 0;
<a name='L2274'>        <font color='red'>}</font>
<a name='L2275'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L2276'>        <i><font color='green'>// display a warning about unknown values - only the developer</font></i>
<a name='L2277'>        <i><font color='green'>// of the extension will see it (until they fix it!)</font></i>
<a name='L2278'>        <b>if</b> (user_access_control[0] &amp;&amp; strcmp(user_access_control, "none") != 0) <font color='red'>{</font>
<a name='L2279'>            MessageBox(GetFocus(), "Bad user_access_control value", "oops", MB_OK);
<a name='L2280'>        <i><font color='green'>// nothing to do.</font></i>
<a name='L2281'>        <font color='red'>}</font>
<a name='L2282'>    <font color='red'>}</font>
<a name='L2283'>
<a name='L2284'>    hwndMain = <a href='../S/2858.html#L1162' title='Defined at 1162 in PC/bdist_wininst/install.c.'>CreateBackground</a>(title);
<a name='L2285'>
<a name='L2286'>    <a href='../S/2858.html#L2097' title='Defined at 2097 in PC/bdist_wininst/install.c.'>RunWizard</a>(hwndMain);
<a name='L2287'>
<a name='L2288'>    <i><font color='green'>/* Clean up */</font></i>
<a name='L2289'>    UnmapViewOfFile(arc_data);
<a name='L2290'>    <b>if</b> (ini_file)
<a name='L2291'>        DeleteFile(ini_file);
<a name='L2292'>
<a name='L2293'>    <b>if</b> (hBitmap)
<a name='L2294'>        DeleteObject(hBitmap);
<a name='L2295'>
<a name='L2296'>    <b>return</b> 0;
<a name='L2297'><font color='red'>}</font>
<a name='L2298'>
<a name='L2299'><i><font color='green'>/*********************** uninstall section ******************************/</font></i>
<a name='L2300'>
<a name='L2301'><b>static</b> <b>int</b> <a href='../R/6829.html' title='Multiple refered from 2 places.'>compare</a>(<b>const</b> <b>void</b> *p1, <b>const</b> <b>void</b> *p2)
<a name='L2302'><font color='red'>{</font>
<a name='L2303'>    <b>return</b> strcmp(*(<b>char</b> **)p2, *(<b>char</b> **)p1);
<a name='L2304'><font color='red'>}</font>
<a name='L2305'>
<a name='L2306'><i><font color='green'>/*</font></i>
<a name='L2307'><i><font color='green'> * Commit suicide (remove the uninstaller itself).</font></i>
<a name='L2308'><i><font color='green'> *</font></i>
<a name='L2309'><i><font color='green'> * Create a batch file to first remove the uninstaller</font></i>
<a name='L2310'><i><font color='green'> * (will succeed after it has finished), then the batch file itself.</font></i>
<a name='L2311'><i><font color='green'> *</font></i>
<a name='L2312'><i><font color='green'> * This technique has been demonstrated by Jeff Richter,</font></i>
<a name='L2313'><i><font color='green'> * MSJ 1/1996</font></i>
<a name='L2314'><i><font color='green'> */</font></i>
<a name='L2315'><b>void</b> <a href='../S/2858.html#L2641' title='Refered from 2641 in PC/bdist_wininst/install.c.'>remove_exe</a>(<b>void</b>)
<a name='L2316'><font color='red'>{</font>
<a name='L2317'>    <b>char</b> exename[_MAX_PATH];
<a name='L2318'>    <b>char</b> batname[_MAX_PATH];
<a name='L2319'>    FILE *fp;
<a name='L2320'>    STARTUPINFO si;
<a name='L2321'>    PROCESS_INFORMATION pi;
<a name='L2322'>
<a name='L2323'>    GetModuleFileName(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, exename, <b>sizeof</b>(exename));
<a name='L2324'>    sprintf(batname, "%s.bat", exename);
<a name='L2325'>    fp = fopen(batname, "w");
<a name='L2326'>    fprintf(fp, ":Repeat\n");
<a name='L2327'>    fprintf(fp, "del \"%s\"\n", exename);
<a name='L2328'>    fprintf(fp, "if exist \"%s\" goto Repeat\n", exename);
<a name='L2329'>    fprintf(fp, "del \"%s\"\n", batname);
<a name='L2330'>    fclose(fp);
<a name='L2331'>
<a name='L2332'>    ZeroMemory(&amp;si, <b>sizeof</b>(si));
<a name='L2333'>    si.cb = <b>sizeof</b>(si);
<a name='L2334'>    si.dwFlags = STARTF_USESHOWWINDOW;
<a name='L2335'>    si.wShowWindow = SW_HIDE;
<a name='L2336'>    <b>if</b> (CreateProcess(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L2337'>                      batname,
<a name='L2338'>                      <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L2339'>                      <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L2340'>                      <a href='../D/1087.html' title='Multiple defined in 3 places.'>FALSE</a>,
<a name='L2341'>                      CREATE_SUSPENDED | IDLE_PRIORITY_CLASS,
<a name='L2342'>                      <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L2343'>                      "\\",
<a name='L2344'>                      &amp;si,
<a name='L2345'>                      &amp;pi)) <font color='red'>{</font>
<a name='L2346'>        SetThreadPriority(pi.hThread, THREAD_PRIORITY_IDLE);
<a name='L2347'>        SetThreadPriority(GetCurrentThread(), THREAD_PRIORITY_TIME_CRITICAL);
<a name='L2348'>        SetPriorityClass(GetCurrentProcess(), HIGH_PRIORITY_CLASS);
<a name='L2349'>        CloseHandle(pi.hProcess);
<a name='L2350'>        ResumeThread(pi.hThread);
<a name='L2351'>        CloseHandle(pi.hThread);
<a name='L2352'>    <font color='red'>}</font>
<a name='L2353'><font color='red'>}</font>
<a name='L2354'>
<a name='L2355'><b>void</b> <a href='../S/2858.html#L2616' title='Refered from 2616 in PC/bdist_wininst/install.c.'>DeleteRegistryKey</a>(<b>char</b> *string)
<a name='L2356'><font color='red'>{</font>
<a name='L2357'>    <b>char</b> *keyname;
<a name='L2358'>    <b>char</b> *subkeyname;
<a name='L2359'>    <b>char</b> *delim;
<a name='L2360'>    HKEY hKey;
<a name='L2361'>    <b>long</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L2362'>    <b>char</b> *line;
<a name='L2363'>
<a name='L2364'>    line = <a href='../D/11408.html' title='Multiple defined in 2 places.'>strdup</a>(<a href='../S/500.html#L5' title='Defined at 5 in Include/asdl.h.'>string</a>); <i><font color='green'>/* so we can change it */</font></i>
<a name='L2365'>
<a name='L2366'>    keyname = strchr(line, '[');
<a name='L2367'>    <b>if</b> (!keyname)
<a name='L2368'>        <b>return</b>;
<a name='L2369'>    ++keyname;
<a name='L2370'>
<a name='L2371'>    subkeyname = strchr(keyname, ']');
<a name='L2372'>    <b>if</b> (!subkeyname)
<a name='L2373'>        <b>return</b>;
<a name='L2374'>    *subkeyname++='\0';
<a name='L2375'>    delim = strchr(subkeyname, '\n');
<a name='L2376'>    <b>if</b> (delim)
<a name='L2377'>        *delim = '\0';
<a name='L2378'>
<a name='L2379'>    <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = RegOpenKeyEx(hkey_root,
<a name='L2380'>                          keyname,
<a name='L2381'>                          0,
<a name='L2382'>                          KEY_WRITE,
<a name='L2383'>                          &amp;hKey);
<a name='L2384'>
<a name='L2385'>    <b>if</b> (<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> != ERROR_SUCCESS)
<a name='L2386'>        MessageBox(GetFocus(), <a href='../S/500.html#L5' title='Defined at 5 in Include/asdl.h.'>string</a>, "Could not open key", MB_OK);
<a name='L2387'>    <b>else</b> <font color='red'>{</font>
<a name='L2388'>        <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = RegDeleteKey(hKey, subkeyname);
<a name='L2389'>        <b>if</b> (<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> != ERROR_SUCCESS &amp;&amp; <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> != ERROR_FILE_NOT_FOUND)
<a name='L2390'>            MessageBox(GetFocus(), <a href='../S/500.html#L5' title='Defined at 5 in Include/asdl.h.'>string</a>, "Could not delete key", MB_OK);
<a name='L2391'>        RegCloseKey(hKey);
<a name='L2392'>    <font color='red'>}</font>
<a name='L2393'>    free(line);
<a name='L2394'><font color='red'>}</font>
<a name='L2395'>
<a name='L2396'><b>void</b> <a href='../S/2858.html#L2618' title='Refered from 2618 in PC/bdist_wininst/install.c.'>DeleteRegistryValue</a>(<b>char</b> *string)
<a name='L2397'><font color='red'>{</font>
<a name='L2398'>    <b>char</b> *keyname;
<a name='L2399'>    <b>char</b> *valuename;
<a name='L2400'>    <b>char</b> *<a href='../S/2252.html#L27' title='Defined at 27 in Modules/_ctypes/ctypes.h.'>value</a>;
<a name='L2401'>    HKEY hKey;
<a name='L2402'>    <b>long</b> <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a>;
<a name='L2403'>    <b>char</b> *line;
<a name='L2404'>
<a name='L2405'>    line = <a href='../D/11408.html' title='Multiple defined in 2 places.'>strdup</a>(<a href='../S/500.html#L5' title='Defined at 5 in Include/asdl.h.'>string</a>); <i><font color='green'>/* so we can change it */</font></i>
<a name='L2406'>
<a name='L2407'><i><font color='green'>/* Format is 'Reg DB Value: [key]name=value' */</font></i>
<a name='L2408'>    keyname = strchr(line, '[');
<a name='L2409'>    <b>if</b> (!keyname)
<a name='L2410'>        <b>return</b>;
<a name='L2411'>    ++keyname;
<a name='L2412'>    valuename = strchr(keyname, ']');
<a name='L2413'>    <b>if</b> (!valuename)
<a name='L2414'>        <b>return</b>;
<a name='L2415'>    *valuename++ = '\0';
<a name='L2416'>    <a href='../S/2252.html#L27' title='Defined at 27 in Modules/_ctypes/ctypes.h.'>value</a> = strchr(valuename, '=');
<a name='L2417'>    <b>if</b> (!<a href='../S/2252.html#L27' title='Defined at 27 in Modules/_ctypes/ctypes.h.'>value</a>)
<a name='L2418'>        <b>return</b>;
<a name='L2419'>
<a name='L2420'>    *<a href='../S/2252.html#L27' title='Defined at 27 in Modules/_ctypes/ctypes.h.'>value</a>++ = '\0';
<a name='L2421'>
<a name='L2422'>    <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = RegOpenKeyEx(hkey_root,
<a name='L2423'>                          keyname,
<a name='L2424'>                          0,
<a name='L2425'>                          KEY_WRITE,
<a name='L2426'>                          &amp;hKey);
<a name='L2427'>    <b>if</b> (<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> != ERROR_SUCCESS)
<a name='L2428'>        MessageBox(GetFocus(), <a href='../S/500.html#L5' title='Defined at 5 in Include/asdl.h.'>string</a>, "Could not open key", MB_OK);
<a name='L2429'>    <b>else</b> <font color='red'>{</font>
<a name='L2430'>        <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> = RegDeleteValue(hKey, valuename);
<a name='L2431'>        <b>if</b> (<a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> != ERROR_SUCCESS &amp;&amp; <a href='../S/2250.html#L579' title='Defined at 579 in Modules/_ctypes/callproc.c.'>result</a> != ERROR_FILE_NOT_FOUND)
<a name='L2432'>            MessageBox(GetFocus(), <a href='../S/500.html#L5' title='Defined at 5 in Include/asdl.h.'>string</a>, "Could not delete value", MB_OK);
<a name='L2433'>        RegCloseKey(hKey);
<a name='L2434'>    <font color='red'>}</font>
<a name='L2435'>    free(line);
<a name='L2436'><font color='red'>}</font>
<a name='L2437'>
<a name='L2438'><a href='../S/2583.html#L42' title='Defined at 42 in Modules/_multiprocessing/multiprocessing.h.'>BOOL</a> <a href='../R/2038.html' title='Multiple refered from 2 places.'>MyDeleteFile</a>(<b>char</b> *line)
<a name='L2439'><font color='red'>{</font>
<a name='L2440'>    <b>char</b> *pathname = strchr(line, ':');
<a name='L2441'>    <b>if</b> (!pathname)
<a name='L2442'>        <b>return</b> <a href='../D/1087.html' title='Multiple defined in 3 places.'>FALSE</a>;
<a name='L2443'>    ++pathname;
<a name='L2444'>    <b>while</b> (<a href='../D/9346.html' title='Multiple defined in 2 places.'>isspace</a>(*pathname))
<a name='L2445'>        ++pathname;
<a name='L2446'>    <b>return</b> DeleteFile(pathname);
<a name='L2447'><font color='red'>}</font>
<a name='L2448'>
<a name='L2449'><a href='../S/2583.html#L42' title='Defined at 42 in Modules/_multiprocessing/multiprocessing.h.'>BOOL</a> <a href='../S/2858.html#L2589' title='Refered from 2589 in PC/bdist_wininst/install.c.'>MyRemoveDirectory</a>(<b>char</b> *line)
<a name='L2450'><font color='red'>{</font>
<a name='L2451'>    <b>char</b> *pathname = strchr(line, ':');
<a name='L2452'>    <b>if</b> (!pathname)
<a name='L2453'>        <b>return</b> <a href='../D/1087.html' title='Multiple defined in 3 places.'>FALSE</a>;
<a name='L2454'>    ++pathname;
<a name='L2455'>    <b>while</b> (<a href='../D/9346.html' title='Multiple defined in 2 places.'>isspace</a>(*pathname))
<a name='L2456'>        ++pathname;
<a name='L2457'>    <b>return</b> RemoveDirectory(pathname);
<a name='L2458'><font color='red'>}</font>
<a name='L2459'>
<a name='L2460'><a href='../S/2583.html#L42' title='Defined at 42 in Modules/_multiprocessing/multiprocessing.h.'>BOOL</a> <a href='../S/2858.html#L2620' title='Refered from 2620 in PC/bdist_wininst/install.c.'>Run_RemoveScript</a>(<b>char</b> *line)
<a name='L2461'><font color='red'>{</font>
<a name='L2462'>    <b>char</b> *dllname;
<a name='L2463'>    <b>char</b> *scriptname;
<a name='L2464'>    <b>static</b> <b>char</b> lastscript[<a href='../S/2696.html#L2498' title='Defined at 2498 in Modules/posixmodule.c.'>MAX_PATH</a>];
<a name='L2465'>
<a name='L2466'><i><font color='green'>/* Format is 'Run Scripts: [pythondll]scriptname' */</font></i>
<a name='L2467'><i><font color='green'>/* XXX Currently, pythondll carries no path!!! */</font></i>
<a name='L2468'>    dllname = strchr(line, '[');
<a name='L2469'>    <b>if</b> (!dllname)
<a name='L2470'>        <b>return</b> <a href='../D/1087.html' title='Multiple defined in 3 places.'>FALSE</a>;
<a name='L2471'>    ++dllname;
<a name='L2472'>    scriptname = strchr(dllname, ']');
<a name='L2473'>    <b>if</b> (!scriptname)
<a name='L2474'>        <b>return</b> <a href='../D/1087.html' title='Multiple defined in 3 places.'>FALSE</a>;
<a name='L2475'>    *scriptname++ = '\0';
<a name='L2476'>    <i><font color='green'>/* this function may be called more than one time with the same</font></i>
<a name='L2477'><i><font color='green'>       script, only run it one time */</font></i>
<a name='L2478'>    <b>if</b> (strcmp(lastscript, scriptname)) <font color='red'>{</font>
<a name='L2479'>        <b>char</b> *argv[3] = <font color='red'>{</font><a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, "-remove", <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a><font color='red'>}</font>;
<a name='L2480'>        <b>char</b> *<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a> = <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>;
<a name='L2481'>
<a name='L2482'>        argv[0] = scriptname;
<a name='L2483'>
<a name='L2484'>        <b>if</b> (0 != <a href='../S/2858.html#L788' title='Defined at 788 in PC/bdist_wininst/install.c.'>run_installscript</a>(scriptname, 2, argv, &amp;<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>))
<a name='L2485'>            fprintf(stderr, "*** Could not run installation script ***");
<a name='L2486'>
<a name='L2487'>        <b>if</b> (<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a> &amp;&amp; <a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>[0])
<a name='L2488'>            MessageBox(GetFocus(), <a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>, "uninstall-script", MB_OK);
<a name='L2489'>        free(<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>);
<a name='L2490'>
<a name='L2491'>        strcpy(lastscript, scriptname);
<a name='L2492'>    <font color='red'>}</font>
<a name='L2493'>    <b>return</b> <a href='../D/5177.html' title='Multiple defined in 3 places.'>TRUE</a>;
<a name='L2494'><font color='red'>}</font>
<a name='L2495'>
<a name='L2496'><b>int</b> <a href='../S/2858.html#L2679' title='Refered from 2679 in PC/bdist_wininst/install.c.'>DoUninstall</a>(<b>int</b> argc, <b>char</b> **argv)
<a name='L2497'><font color='red'>{</font>
<a name='L2498'>    FILE *logfile;
<a name='L2499'>    <b>char</b> <a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>[4096];
<a name='L2500'>    <b>int</b> nLines = 0;
<a name='L2501'>    <b>int</b> i;
<a name='L2502'>    <b>char</b> *cp;
<a name='L2503'>    <b>int</b> nFiles = 0;
<a name='L2504'>    <b>int</b> nDirs = 0;
<a name='L2505'>    <b>int</b> nErrors = 0;
<a name='L2506'>    <b>char</b> **lines;
<a name='L2507'>    <b>int</b> lines_buffer_size = 10;
<a name='L2508'>
<a name='L2509'>    <b>if</b> (argc != 3) <font color='red'>{</font>
<a name='L2510'>        MessageBox(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L2511'>                   "Wrong number of args",
<a name='L2512'>                   <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L2513'>                   MB_OK);
<a name='L2514'>        <b>return</b> 1; <i><font color='green'>/* Error */</font></i>
<a name='L2515'>    <font color='red'>}</font>
<a name='L2516'>    <b>if</b> (strcmp(argv[1], "-u")) <font color='red'>{</font>
<a name='L2517'>        MessageBox(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L2518'>                   "2. arg is not -u",
<a name='L2519'>                   <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L2520'>                   MB_OK);
<a name='L2521'>        <b>return</b> 1; <i><font color='green'>/* Error */</font></i>
<a name='L2522'>    <font color='red'>}</font>
<a name='L2523'>
<a name='L2524'>    logfile = fopen(argv[2], "r");
<a name='L2525'>    <b>if</b> (!logfile) <font color='red'>{</font>
<a name='L2526'>        MessageBox(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L2527'>                   "could not open logfile",
<a name='L2528'>                   <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L2529'>                   MB_OK);
<a name='L2530'>        <b>return</b> 1; <i><font color='green'>/* Error */</font></i>
<a name='L2531'>    <font color='red'>}</font>
<a name='L2532'>
<a name='L2533'>    lines = (<b>char</b> **)malloc(<b>sizeof</b>(<b>char</b> *) * lines_buffer_size);
<a name='L2534'>    <b>if</b> (!lines)
<a name='L2535'>        <b>return</b> <a href='../S/2858.html#L921' title='Defined at 921 in PC/bdist_wininst/install.c.'>SystemError</a>(0, "Out of memory");
<a name='L2536'>
<a name='L2537'>    <i><font color='green'>/* Read the whole logfile, realloacting the buffer */</font></i>
<a name='L2538'>    <b>while</b> (fgets(<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>, <b>sizeof</b>(<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>), logfile)) <font color='red'>{</font>
<a name='L2539'>        <b>int</b> len = strlen(<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>);
<a name='L2540'>        <i><font color='green'>/* remove trailing white space */</font></i>
<a name='L2541'>        <b>while</b> (<a href='../D/9346.html' title='Multiple defined in 2 places.'>isspace</a>(<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>[len-1]))
<a name='L2542'>            len -= 1;
<a name='L2543'>        <a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>[len] = '\0';
<a name='L2544'>        lines[nLines++] = <a href='../D/11408.html' title='Multiple defined in 2 places.'>strdup</a>(<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>);
<a name='L2545'>        <b>if</b> (nLines &gt;= lines_buffer_size) <font color='red'>{</font>
<a name='L2546'>            lines_buffer_size += 10;
<a name='L2547'>            lines = (<b>char</b> **)realloc(lines,
<a name='L2548'>                                     <b>sizeof</b>(<b>char</b> *) * lines_buffer_size);
<a name='L2549'>            <b>if</b> (!lines)
<a name='L2550'>                <b>return</b> <a href='../S/2858.html#L921' title='Defined at 921 in PC/bdist_wininst/install.c.'>SystemError</a>(0, "Out of memory");
<a name='L2551'>        <font color='red'>}</font>
<a name='L2552'>    <font color='red'>}</font>
<a name='L2553'>    fclose(logfile);
<a name='L2554'>
<a name='L2555'>    <i><font color='green'>/* Sort all the lines, so that highest 3-digit codes are first */</font></i>
<a name='L2556'>    qsort(&amp;lines[0], nLines, <b>sizeof</b>(<b>char</b> *),
<a name='L2557'>          <a href='../S/2858.html#L2301' title='Defined at 2301 in PC/bdist_wininst/install.c.'>compare</a>);
<a name='L2558'>
<a name='L2559'>    <b>if</b> (IDYES != MessageBox(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L2560'>                            "Are you sure you want to remove\n"
<a name='L2561'>                            "this package from your computer?",
<a name='L2562'>                            "Please confirm",
<a name='L2563'>                            MB_YESNO | MB_ICONQUESTION))
<a name='L2564'>        <b>return</b> 0;
<a name='L2565'>
<a name='L2566'>    hkey_root = HKEY_LOCAL_MACHINE;
<a name='L2567'>    cp = "";
<a name='L2568'>    <b>for</b> (i = 0; i &lt; nLines; ++i) <font color='red'>{</font>
<a name='L2569'>        <i><font color='green'>/* Ignore duplicate lines */</font></i>
<a name='L2570'>        <b>if</b> (strcmp(cp, lines[i])) <font color='red'>{</font>
<a name='L2571'>            <b>int</b> ign;
<a name='L2572'>            cp = lines[i];
<a name='L2573'>            <i><font color='green'>/* Parse the lines */</font></i>
<a name='L2574'>            <b>if</b> (2 == sscanf(cp, "%d Root Key: %s", &amp;ign, &amp;<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>)) <font color='red'>{</font>
<a name='L2575'>                <b>if</b> (strcmp(<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>, "HKEY_CURRENT_USER")==0)
<a name='L2576'>                    hkey_root = HKEY_CURRENT_USER;
<a name='L2577'>                <b>else</b> <font color='red'>{</font>
<a name='L2578'>                    <i><font color='green'>// HKLM - check they have permissions.</font></i>
<a name='L2579'>                    <b>if</b> (!<a href='../S/2858.html#L1515' title='Defined at 1515 in PC/bdist_wininst/install.c.'>HasLocalMachinePrivs</a>()) <font color='red'>{</font>
<a name='L2580'>                        MessageBox(GetFocus(),
<a name='L2581'>                                   "You do not seem to have sufficient access rights\n"
<a name='L2582'>                                   "on this machine to uninstall this software",
<a name='L2583'>                                   <a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>,
<a name='L2584'>                                   MB_OK | MB_ICONSTOP);
<a name='L2585'>                        <b>return</b> 1; <i><font color='green'>/* Error */</font></i>
<a name='L2586'>                    <font color='red'>}</font>
<a name='L2587'>                <font color='red'>}</font>
<a name='L2588'>            <font color='red'>}</font> <b>else</b> <b>if</b> (2 == sscanf(cp, "%d Made Dir: %s", &amp;ign, &amp;<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>)) <font color='red'>{</font>
<a name='L2589'>                <b>if</b> (<a href='../S/2858.html#L2449' title='Defined at 2449 in PC/bdist_wininst/install.c.'>MyRemoveDirectory</a>(cp))
<a name='L2590'>                    ++nDirs;
<a name='L2591'>                <b>else</b> <font color='red'>{</font>
<a name='L2592'>                    <b>int</b> <a href='../S/2755.html#L28' title='Defined at 28 in Modules/zlib/inftrees.h.'>code</a> = GetLastError();
<a name='L2593'>                    <b>if</b> (<a href='../S/2755.html#L28' title='Defined at 28 in Modules/zlib/inftrees.h.'>code</a> != 2 &amp;&amp; <a href='../S/2755.html#L28' title='Defined at 28 in Modules/zlib/inftrees.h.'>code</a> != 3) <font color='red'>{</font> <i><font color='green'>/* file or path not found */</font></i>
<a name='L2594'>                        ++nErrors;
<a name='L2595'>                    <font color='red'>}</font>
<a name='L2596'>                <font color='red'>}</font>
<a name='L2597'>            <font color='red'>}</font> <b>else</b> <b>if</b> (2 == sscanf(cp, "%d File Copy: %s", &amp;ign, &amp;<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>)) <font color='red'>{</font>
<a name='L2598'>                <b>if</b> (<a href='../S/2858.html#L2438' title='Defined at 2438 in PC/bdist_wininst/install.c.'>MyDeleteFile</a>(cp))
<a name='L2599'>                    ++nFiles;
<a name='L2600'>                <b>else</b> <font color='red'>{</font>
<a name='L2601'>                    <b>int</b> <a href='../S/2755.html#L28' title='Defined at 28 in Modules/zlib/inftrees.h.'>code</a> = GetLastError();
<a name='L2602'>                    <b>if</b> (<a href='../S/2755.html#L28' title='Defined at 28 in Modules/zlib/inftrees.h.'>code</a> != 2 &amp;&amp; <a href='../S/2755.html#L28' title='Defined at 28 in Modules/zlib/inftrees.h.'>code</a> != 3) <font color='red'>{</font> <i><font color='green'>/* file or path not found */</font></i>
<a name='L2603'>                        ++nErrors;
<a name='L2604'>                    <font color='red'>}</font>
<a name='L2605'>                <font color='red'>}</font>
<a name='L2606'>            <font color='red'>}</font> <b>else</b> <b>if</b> (2 == sscanf(cp, "%d File Overwrite: %s", &amp;ign, &amp;<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>)) <font color='red'>{</font>
<a name='L2607'>                <b>if</b> (<a href='../S/2858.html#L2438' title='Defined at 2438 in PC/bdist_wininst/install.c.'>MyDeleteFile</a>(cp))
<a name='L2608'>                    ++nFiles;
<a name='L2609'>                <b>else</b> <font color='red'>{</font>
<a name='L2610'>                    <b>int</b> <a href='../S/2755.html#L28' title='Defined at 28 in Modules/zlib/inftrees.h.'>code</a> = GetLastError();
<a name='L2611'>                    <b>if</b> (<a href='../S/2755.html#L28' title='Defined at 28 in Modules/zlib/inftrees.h.'>code</a> != 2 &amp;&amp; <a href='../S/2755.html#L28' title='Defined at 28 in Modules/zlib/inftrees.h.'>code</a> != 3) <font color='red'>{</font> <i><font color='green'>/* file or path not found */</font></i>
<a name='L2612'>                        ++nErrors;
<a name='L2613'>                    <font color='red'>}</font>
<a name='L2614'>                <font color='red'>}</font>
<a name='L2615'>            <font color='red'>}</font> <b>else</b> <b>if</b> (2 == sscanf(cp, "%d Reg DB Key: %s", &amp;ign, &amp;<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>)) <font color='red'>{</font>
<a name='L2616'>                <a href='../S/2858.html#L2355' title='Defined at 2355 in PC/bdist_wininst/install.c.'>DeleteRegistryKey</a>(cp);
<a name='L2617'>            <font color='red'>}</font> <b>else</b> <b>if</b> (2 == sscanf(cp, "%d Reg DB Value: %s", &amp;ign, &amp;<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>)) <font color='red'>{</font>
<a name='L2618'>                <a href='../S/2858.html#L2396' title='Defined at 2396 in PC/bdist_wininst/install.c.'>DeleteRegistryValue</a>(cp);
<a name='L2619'>            <font color='red'>}</font> <b>else</b> <b>if</b> (2 == sscanf(cp, "%d Run Script: %s", &amp;ign, &amp;<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>)) <font color='red'>{</font>
<a name='L2620'>                <a href='../S/2858.html#L2460' title='Defined at 2460 in PC/bdist_wininst/install.c.'>Run_RemoveScript</a>(cp);
<a name='L2621'>            <font color='red'>}</font>
<a name='L2622'>        <font color='red'>}</font>
<a name='L2623'>    <font color='red'>}</font>
<a name='L2624'>
<a name='L2625'>    <b>if</b> (DeleteFile(argv[2])) <font color='red'>{</font>
<a name='L2626'>        ++nFiles;
<a name='L2627'>    <font color='red'>}</font> <b>else</b> <font color='red'>{</font>
<a name='L2628'>        ++nErrors;
<a name='L2629'>        <a href='../S/2858.html#L921' title='Defined at 921 in PC/bdist_wininst/install.c.'>SystemError</a>(GetLastError(), argv[2]);
<a name='L2630'>    <font color='red'>}</font>
<a name='L2631'>    <b>if</b> (nErrors)
<a name='L2632'>        wsprintf(<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>,
<a name='L2633'>                 "%d files and %d directories removed\n"
<a name='L2634'>                 "%d files or directories could not be removed",
<a name='L2635'>                 nFiles, nDirs, nErrors);
<a name='L2636'>    <b>else</b>
<a name='L2637'>        wsprintf(<a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>, "%d files and %d directories removed",
<a name='L2638'>                 nFiles, nDirs);
<a name='L2639'>    MessageBox(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, <a href='../S/2664.html#L607' title='Defined at 607 in Modules/expat/xmlparse.c.'>buffer</a>, "Uninstall Finished!",
<a name='L2640'>               MB_OK | MB_ICONINFORMATION);
<a name='L2641'>    <a href='../S/2858.html#L2315' title='Defined at 2315 in PC/bdist_wininst/install.c.'>remove_exe</a>();
<a name='L2642'>    <b>return</b> 0;
<a name='L2643'><font color='red'>}</font>
<a name='L2644'>
<a name='L2645'><b>int</b> WINAPI WinMain(HINSTANCE hInst, HINSTANCE hPrevInst,
<a name='L2646'>                    LPSTR lpszCmdLine, <a href='../D/1741.html' title='Multiple defined in 2 places.'>INT</a> nCmdShow)
<a name='L2647'><font color='red'>{</font>
<a name='L2648'>    <b>extern</b> <b>int</b> __argc;
<a name='L2649'>    <b>extern</b> <b>char</b> **__argv;
<a name='L2650'>    <b>char</b> *basename;
<a name='L2651'>
<a name='L2652'>    GetModuleFileName(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, modulename, <b>sizeof</b>(modulename));
<a name='L2653'>    GetModuleFileNameW(<a href='../S/2891.html#L5' title='Defined at 5 in PC/os2emx/dllentry.c.'>NULL</a>, wmodulename, <b>sizeof</b>(wmodulename)/<b>sizeof</b>(wmodulename[0]));
<a name='L2654'>
<a name='L2655'>    <i><font color='green'>/* Map the executable file to memory */</font></i>
<a name='L2656'>    arc_data = <a href='../S/2858.html#L1005' title='Defined at 1005 in PC/bdist_wininst/install.c.'>MapExistingFile</a>(modulename, &amp;arc_size);
<a name='L2657'>    <b>if</b> (!arc_data) <font color='red'>{</font>
<a name='L2658'>        <a href='../S/2858.html#L921' title='Defined at 921 in PC/bdist_wininst/install.c.'>SystemError</a>(GetLastError(), "Could not open archive");
<a name='L2659'>        <b>return</b> 1;
<a name='L2660'>    <font color='red'>}</font>
<a name='L2661'>
<a name='L2662'>    <i><font color='green'>/* OK. So this program can act as installer (self-extracting</font></i>
<a name='L2663'><i><font color='green'>     * zip-file, or as uninstaller when started with '-u logfile'</font></i>
<a name='L2664'><i><font color='green'>     * command line flags.</font></i>
<a name='L2665'><i><font color='green'>     *</font></i>
<a name='L2666'><i><font color='green'>     * The installer is usually started without command line flags,</font></i>
<a name='L2667'><i><font color='green'>     * and the uninstaller is usually started with the '-u logfile'</font></i>
<a name='L2668'><i><font color='green'>     * flag. What to do if some innocent user double-clicks the</font></i>
<a name='L2669'><i><font color='green'>     * exe-file?</font></i>
<a name='L2670'><i><font color='green'>     * The following implements a defensive strategy...</font></i>
<a name='L2671'><i><font color='green'>     */</font></i>
<a name='L2672'>
<a name='L2673'>    <i><font color='green'>/* Try to extract the configuration data into a temporary file */</font></i>
<a name='L2674'>    <b>if</b> (<a href='../S/2858.html#L1063' title='Defined at 1063 in PC/bdist_wininst/install.c.'>ExtractInstallData</a>(arc_data, arc_size, &amp;exe_size,
<a name='L2675'>                           &amp;ini_file, &amp;pre_install_script))
<a name='L2676'>        <b>return</b> <a href='../S/2858.html#L2225' title='Defined at 2225 in PC/bdist_wininst/install.c.'>DoInstall</a>();
<a name='L2677'>
<a name='L2678'>    <b>if</b> (!ini_file &amp;&amp; __argc &gt; 1) <font color='red'>{</font>
<a name='L2679'>        <b>return</b> <a href='../S/2858.html#L2496' title='Defined at 2496 in PC/bdist_wininst/install.c.'>DoUninstall</a>(__argc, __argv);
<a name='L2680'>    <font color='red'>}</font>
<a name='L2681'>
<a name='L2682'>
<a name='L2683'>    basename = strrchr(modulename, '\\');
<a name='L2684'>    <b>if</b> (basename)
<a name='L2685'>        ++basename;
<a name='L2686'>
<a name='L2687'>    <i><font color='green'>/* Last guess about the purpose of this program */</font></i>
<a name='L2688'>    <b>if</b> (basename &amp;&amp; (0 == strncmp(basename, "Remove", 6)))
<a name='L2689'>        <a href='../S/2858.html#L921' title='Defined at 921 in PC/bdist_wininst/install.c.'>SystemError</a>(0, "This program is normally started by windows");
<a name='L2690'>    <b>else</b>
<a name='L2691'>        <a href='../S/2858.html#L921' title='Defined at 921 in PC/bdist_wininst/install.c.'>SystemError</a>(0, "Setup program invalid or damaged");
<a name='L2692'>    <b>return</b> 1;
<a name='L2693'><font color='red'>}</font>
</pre>
<hr>
<a name='BOTTOM'>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L186'>[^]</a><a href='#L2645'>[v]</a><a href='#TOP'>[top]</a>[bottom]<a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
</body>
</html>
